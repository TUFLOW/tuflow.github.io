<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Simulation Construction | TUFLOW CATCH User Manual</title>
  <meta name="description" content="Section 4 Simulation Construction | TUFLOW CATCH User Manual" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Simulation Construction | TUFLOW CATCH User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/1024in300px_Blue-01.svg" />
  <meta property="og:description" content="Section 4 Simulation Construction | TUFLOW CATCH User Manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Simulation Construction | TUFLOW CATCH User Manual" />
  
  <meta name="twitter:description" content="Section 4 Simulation Construction | TUFLOW CATCH User Manual" />
  <meta name="twitter:image" content="/images/1024in300px_Blue-01.svg" />

<meta name="author" content="" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/TUFLOW.ico" type="image/x-icon" />
<link rel="prev" href="ProcessDescriptions-1.html"/>
<link rel="next" href="AppCommands.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://www.tuflow.com"><img src="images/1024in300px_Blue-01.svg" style="width:246px;height:68px;"></a></li>

<li class="divider"></li>
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#about-this-manual"><i class="fa fa-check"></i>About this manual</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#how-to-use-this-manual"><i class="fa fa-check"></i>How to use this manual</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#navigation"><i class="fa fa-check"></i>Navigation</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#searching"><i class="fa fa-check"></i>Searching</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#tables"><i class="fa fa-check"></i>Tables</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#commands"><i class="fa fa-check"></i>Commands</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#parameter-notation"><i class="fa fa-check"></i>Parameter notation</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#feedback"><i class="fa fa-check"></i>Feedback</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="Overview-1.html"><a href="Overview-1.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Overview-1.html"><a href="Overview-1.html#OverviewContext-2"><i class="fa fa-check"></i><b>1.1</b> Context</a></li>
<li class="chapter" data-level="1.2" data-path="Overview-1.html"><a href="Overview-1.html#Features-2"><i class="fa fa-check"></i><b>1.2</b> Features</a></li>
<li class="chapter" data-level="1.3" data-path="Overview-1.html"><a href="Overview-1.html#Configs-2"><i class="fa fa-check"></i><b>1.3</b> Configurations</a></li>
<li class="chapter" data-level="1.4" data-path="Overview-1.html"><a href="Overview-1.html#Science-2"><i class="fa fa-check"></i><b>1.4</b> Science</a></li>
<li class="chapter" data-level="1.5" data-path="Overview-1.html"><a href="Overview-1.html#Support-2"><i class="fa fa-check"></i><b>1.5</b> Support</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Architecture-1.html"><a href="Architecture-1.html"><i class="fa fa-check"></i><b>2</b> Architecture</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Architecture-1.html"><a href="Architecture-1.html#ArchitectureContext-2"><i class="fa fa-check"></i><b>2.1</b> Context</a></li>
<li class="chapter" data-level="2.2" data-path="Architecture-1.html"><a href="Architecture-1.html#CA-2"><i class="fa fa-check"></i><b>2.2</b> Core Architecture</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="Architecture-1.html"><a href="Architecture-1.html#ExCoord-3"><i class="fa fa-check"></i><b>2.2.1</b> Execution Coordination</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html"><i class="fa fa-check"></i><b>3</b> Process Descriptions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html#ProcessDescriptionsGeo-2"><i class="fa fa-check"></i><b>3.1</b> Geolocation</a></li>
<li class="chapter" data-level="3.2" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html#ProcessDescriptionsPollExp-2"><i class="fa fa-check"></i><b>3.2</b> Pollutant Export</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html#ProcessDescriptionsConst-3"><i class="fa fa-check"></i><b>3.2.1</b> Constant</a></li>
<li class="chapter" data-level="3.2.2" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html#ProcessDescriptionsTS-3"><i class="fa fa-check"></i><b>3.2.2</b> Timeseries</a></li>
<li class="chapter" data-level="3.2.3" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html#ProcessDescriptionsAccWO-3"><i class="fa fa-check"></i><b>3.2.3</b> Accumulation and washoff</a></li>
<li class="chapter" data-level="3.2.4" data-path="ProcessDescriptions-1.html"><a href="ProcessDescriptions-1.html#ProcessDescriptionsSS-3"><i class="fa fa-check"></i><b>3.2.4</b> Shear Stress</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html"><i class="fa fa-check"></i><b>4</b> Simulation Construction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimulationConstructionContext-2"><i class="fa fa-check"></i><b>4.1</b> Context</a></li>
<li class="chapter" data-level="4.2" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimulationConstructionInit-2"><i class="fa fa-check"></i><b>4.2</b> Initialisation</a></li>
<li class="chapter" data-level="4.3" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SCGeneral-2"><i class="fa fa-check"></i><b>4.3</b> General arrangement</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SCGeneralTCC-2"><i class="fa fa-check"></i><b>4.3.1</b> Control file</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SCIntent-2"><i class="fa fa-check"></i><b>4.4</b> Intent</a></li>
<li class="chapter" data-level="4.5" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SCInit-2"><i class="fa fa-check"></i><b>4.5</b> Initialisation</a></li>
<li class="chapter" data-level="4.6" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#TFVCommands-2"><i class="fa fa-check"></i><b>4.6</b> TUFLOW FV control file commands</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#WQMActivation-3"><i class="fa fa-check"></i><b>4.6.1</b> WQ Module activation</a></li>
<li class="chapter" data-level="4.6.2" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#InitBCCond-3"><i class="fa fa-check"></i><b>4.6.2</b> Initial and boundary conditions</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#WQctrlfil-2"><i class="fa fa-check"></i><b>4.7</b> Water quality control file commands</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimCtrls-3"><i class="fa fa-check"></i><b>4.7.1</b> Part 1: Simulation controls</a></li>
<li class="chapter" data-level="4.7.2" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#ConModSttngs-3"><i class="fa fa-check"></i><b>4.7.2</b> Part 2: Constituent model settings</a></li>
<li class="chapter" data-level="4.7.3" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#MatSpecs-3"><i class="fa fa-check"></i><b>4.7.3</b> Part 3: Material specifications</a></li>
<li class="chapter" data-level="4.7.4" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimSetSum-2"><i class="fa fa-check"></i><b>4.7.4</b> Summary</a></li>
<li class="chapter" data-level="4.7.5" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimSetLog-2"><i class="fa fa-check"></i><b>4.7.5</b> Log files</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimSetSimClDO-2"><i class="fa fa-check"></i><b>4.8</b> Simulation Class: DO</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#PrereqDO-3"><i class="fa fa-check"></i><b>4.8.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.8.2" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#SimCtrlsDO-3"><i class="fa fa-check"></i><b>4.8.2</b> Part 1: Simulation specification</a></li>
<li class="chapter" data-level="4.8.3" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#ConModSttngsDO-3"><i class="fa fa-check"></i><b>4.8.3</b> Part 2: Constituent model specification</a></li>
<li class="chapter" data-level="4.8.4" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#MatSpecsDO-3"><i class="fa fa-check"></i><b>4.8.4</b> Part 3: Material specification</a></li>
<li class="chapter" data-level="4.8.5" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#ConOrdDO-3"><i class="fa fa-check"></i><b>4.8.5</b> Constituent ordering</a></li>
<li class="chapter" data-level="4.8.6" data-path="SimulationConstruction-1.html"><a href="SimulationConstruction-1.html#ExampleDO"><i class="fa fa-check"></i><b>4.8.6</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="AppCommands.html"><a href="AppCommands.html"><i class="fa fa-check"></i><b>5</b> Commands</a></li>
<li class="divider"></li>
<li><a href="https://www.tuflow.com"><img src="images/1024in300px_Blue-01.svg" style="width:246px;height:68px;"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><h0 style="color:rgb(0,85,129);">TUFLOW CATCH User Manual</h0></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SimulationConstruction-1" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Section 4</span> Simulation Construction<a href="SimulationConstruction-1.html#SimulationConstruction-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="SimulationConstructionContext-2" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Context<a href="SimulationConstruction-1.html#SimulationConstructionContext-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Previous sections have presented the architecture and processes available within TUFLOW CATCH. This section describes the construction of a TUFLOW CATCH simulation. This includes descriptions of all commands, with hyperlinks to the Appendices where commands and explanations are listed in a searchable and sortable table for ease of access.</p>
</div>
<div id="SimulationConstructionInit-2" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Initialisation<a href="SimulationConstruction-1.html#SimulationConstructionInit-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW CATCH requires construction of a suite of folder substructures to support simulations. Ideally, these should be all co-located at the same folder level underneath a single directory that sits within an overall project directory. These substructures correspond to each of the three products used in a TUFLOW CATCH simulation and should be names as follows:</p>
<ul>
<li>TUFLOWCATCH2</li>
<li>TUFLOW (TUFLOW HPC)</li>
<li>TUFLOWFV</li>
</ul>
<p>Each of these substructures has its own subfolder structure, consistent with those suggested for each for standalone TUFLOW HPC and TUFLOW FV modelling studies. For consistency, the suggested TUFLOWCATCH substructure is also similar.</p>
<p>To assist with this set up, and indeed more broadly with the initialisation, execution and results interrogation of a TUFLOW CATCH simulation, a freely available TUFLOW CATCH QGIS plugin has been developed. TUFLOW eLearning resources (also free of charge) have been prepared to support deployment and use of this TUFLOW CATCH plugin, and as such the content of that resource is not repeated here. Users are however encouraged to access this resource before initialising their first TUFLOW CATCH simulation: using this plugin is seen as a core component of the set up of a TUFLOW CATCH simulation. Doing so manually is discouraged. The eLearning materials can be accessed by:</p>
<ul>
<li>Registering for TUFLOW eLearning <a href = "https://elearning.tuflow.com/login/index.php">here</a> if not already registered</li>
<li>Emailing <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> noting the registered username and with a request access to the TUFLOW CATCH plugin eLearning course</li>
<li>Following instructions subsequently provided to access the course</li>
<li>Complete the course</li>
</ul>
<p>On completion of the course, users will be able to initialise a TUFLOW CATCH simulation in the desired geographical projection system, complete with automatically populated templates for all control files. The sections below assume that this initialisation process has occurred and describe the resulting general arrangements and subsequent construction of a TUFLOW CATCH simulation.</p>
</div>
<div id="SCGeneral-2" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> General arrangement<a href="SimulationConstruction-1.html#SCGeneral-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="SCGeneralTCC-2" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Control file<a href="SimulationConstruction-1.html#SCGeneralTCC-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A TUFLOW CATCH simulation is set up and executed by constructing a TUFLOW CATCH control file, extension *.tcc. This control file has four separate but linked blocks:</p>
<ol>
<li>Global commands</li>
<li>TUFLOW HPC commands</li>
<li>Pollutant export commands</li>
<li>TUFLOW FV commands</li>
</ol>
<p>All blocks must be included in the above order, but can be optionally switched on and off with a single command (rather than extensive line commenting) to suit modelling needs. For example, a user working only on HPC model build tasks can turn off the pollutant export and TUFLOW FV sections and continue building a TUFLOW HPC model as per normal, without the need to always run all components of TUFLOW CATCH.
### Folder structure {#SCGeneralFS-2}</p>
</div>
</div>
<div id="SCIntent-2" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Intent<a href="SimulationConstruction-1.html#SCIntent-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW CATCH coordinates and executes TUFLOW HPC, a pollutant export model and TUFLOW FV, all automatically and with no direct user input required to affect this linkage. This does not mean that TUFLOW CATCH cannot be run until all models (TUFLOW HPC, pollutant export and TUFLOW FV) are fully constructed. To the contrary, the intention is that for application to integrated catchment studies that will at some stage need to draw on the power of TUFLOW CATCH, the single TUFLOW CATCH control file is used as the common control file for all model construction from project inception, even where this construction is undertaken in parallel by multiple users. The reason for this is that, for example, the TUFLOW HPC block of the TUFLOW CATCH control file is nothing other than a standard TUFLOW HPC *.tcf control file, with a small number of additional TUFLOW CATCH commands. This is intentional, and means that an experienced (or beginner) TUFLOW HPC modeller can follow normal model set up processes and procedures to construct the TUFLOW HPC component of TUFLOW CATCH model, unhindered, but via the TUFLOW CATCH control file arrangement. The same logic applies to users constructing the TUFLOW FV sections of a TUFLOW CATCH model - the TUFLOW HPC sections of the TUFLOW CATCH control file can be turned off and TUFLOW FV model construction commenced as usual through the *.tcc rather than *.fvc control file. Users in teams that adopt this approach may want to consider using versioning control software to manage concurrent multiple user contributions.</p>
<p>It is understood that in some legacy cases, existing TUFLOW HPC or TUFLOW FV models (that were originally built outside TUFLOW CATCH) will need to be converted into a block of a TUFLOW CATCH control file. If this is the case, then the process is a matter of copying and pasting from the original control files into the relevant TUFLOW CATCH control file block and populating the supporting folder structures with model data. The key change that will be required on pasting into a *.tcc block will be to change file path references to be to the folder structure associated with the TUFLOW CATCH simulation (see Section ). This is only required from the *.tcc as it points to immediately called files, and no further.</p>
</div>
<div id="SCInit-2" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Initialisation<a href="SimulationConstruction-1.html#SCInit-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW FV and WQ Module control file commands are presented following.</p>
</div>
<div id="TFVCommands-2" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> TUFLOW FV control file commands<a href="SimulationConstruction-1.html#TFVCommands-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A TUFLOW FV simulation is executed as described in the TUFLOW FV user manual. If the WQ Module is to be activated in a simulation then the following commands are to be included.</p>
<div id="WQMActivation-3" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> WQ Module activation<a href="SimulationConstruction-1.html#WQMActivation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Activation of the WQ Module is affected by specification of the following mandatory command in the TUFLOW control file:</p>
<blockquote>
<p><a href="AppCommands.html#FVActivateWQM">water quality model ==</a> <a href="AppCommands.html#FVActivateWQM">TUFLOW</a></p>
</blockquote>
<p>Following this activation, TUFLOW FV will look for the specification of the name of the separate WQ Module control file via the following mandatory command:</p>
<blockquote>
<p><a href="AppCommands.html#FVWQMCtrlFl">water quality control file ==</a> <a href="AppCommands.html#FVWQMCtrlFl">&lt;<em>water quality control file name</em>&gt;.fvwq</a></p>
</blockquote>
<p>This *.fvwq is separate to the *.fvc and contains user specified information that describes the configuration of the water quality simulation. If the *.fvwq is located in the same directory as the *.fvc, then this filename specification needs no associated path. It is recommended however that the *.fvwq be located in a directory separate to the *.fvc so that log and other related water quality specific files can be easily curated. If this approach is adopted, the following additional *.fvc command is required, noting that the folder path is specified as relative to the folder in which the *.fvc resides:</p>
<blockquote>
<p><a href="AppCommands.html#FVWQMCtrlDr">water quality model directory ==</a> <a href="AppCommands.html#FVWQMCtrlDr">&lt;<em>relative path to WQ directory</em>&gt;<span class="math inline">\(\backslash\)</span></a></p>
</blockquote>
<p>This command must terminate in a <span class="math inline">\(\backslash\)</span> character. If this command is issued, then the *.fvwq water quality control file must be located in the directory specified.</p>
<p>In certain circumstances, executing water quality calculations in shallow cells can cause numerical instabilities. To control this behaviour, the WQ Module allows for water quality calculations to be switched off in cells that have depths less than a specified minimum (advection dispersion calculations will however continue to be performed - it is only the water quality-related non-conservative transformations that are turned off). This minimum depth (in meters) is specified in the TUFLOW FV *.fvc via the command:</p>
<blockquote>
<p><a href="AppCommands.html#FVWQMmindpth">cell water quality depth ==</a> <a href="#WQParMinWQDepth"><span class="math inline">\(d_{min-wq}\)</span></a></p>
</blockquote>
<p>If this command is not issued then the default minimum depth of 0.01m (1cm) is applied.</p>
<p>This command parallels the TUFLOW FV command that controls the execution of hydrodynamic calculations as a function of water depth:</p>
<blockquote>
<p>cell wet/dry depths == cell dry depth (m), cell wet depth (m)</p>
</blockquote>
<p>In this TUFLOW FV command:</p>
<ul>
<li>The cell dry depth value (default = 1.0e-06 m) corresponds to the water depth below which a cell is dropped completely from hydrodynamic (TUFLOW FV) computations (subject to the status of surrounding cells) and is therefore considered to be ‘dry’. Cells that have dried in a given time step are given a stat value of 0 in all TUFLOW FV results files, so this stat field acts as a mask to determine which cells are wet and dry when using post processing tools and or scripts. Dry cells are not contoured in QGIS or SMS when viewed, but appear as transparent. If set to a negative value the cell dry depth is set to zero.</li>
<li>The cell wet depth value (default = 1.0e-02 m) corresponds to the water depth below which a cell’s momentum is set to zero in order to avoid unphysical velocities at very low depths. The cell is not considered to be dry and therefore has a stat value of -1. If this value is less than or equal to the cell dry depth, it is set to the cell dry depth.</li>
</ul>
<p>Given this, it is therefore recommended that across these commands and/or defaults, a user ensures that the following holds (as it does for the default values noted above):</p>
<p><span class="math display" id="eq:equ-wet-dry-depth">\[\begin{equation}
  \text{cell dry depth} \lt \text{cell wet depth} \lt \text{cell water quality depth}
    \tag{4.1}
\end{equation}\]</span></p>
<p>If, for example, cell water quality depth is set to a value less than cell dry depth, then water quality calculations will be attempted on cells that TUFLOW FV considers to be dry, which is to be avoided. If a situation arose where it was absolutely necessary, then cell water quality depth could be set to a value less than cell wet depth (but still greater than cell dry depth), but this is not recommended. To summarise, and if the recommended relative magnitudes of depths presented in Equation <a href="SimulationConstruction-1.html#eq:equ-wet-dry-depth">(4.1)</a> is adopted, then the following applies:</p>
<ul>
<li>water depth <span class="math inline">\(\gt\)</span> cell water quality depth: water quality calculations and momentum calculations performed</li>
<li>cell water quality depth <span class="math inline">\(\gt\)</span> water depth <span class="math inline">\(\gt\)</span> cell wet depth : water quality calculations switched off, momentum calculations performed (advection and dispersion calculations also performed on water quality variables)</li>
<li>cell wet depth <span class="math inline">\(\gt\)</span> water depth <span class="math inline">\(\gt\)</span> cell dry depth: water quality calculations switched off, momentum calculations switched off (advection and dispersion calculations also performed)</li>
<li>cell dry depth <span class="math inline">\(\gt\)</span> water depth: no calculations performed - cell is considered dry</li>
</ul>
<p>To support debugging, water quality calculations can also be turned off completely for all cells and all timesteps by issuing this command in the TUFLOW FV *.fvc:</p>
<blockquote>
<p><a href="AppCommands.html#FVWQMdisableWQ">disable water quality model ==</a> <a href="#WQParDisableWQ"><span class="math inline">\(B_{disable-wq}\)</span></a></p>
</blockquote>
<p>and setting <span class="math inline">\(B_{disable-wq}\)</span> = 1. Omitting this command, or setting <span class="math inline">\(B_{disable-wq}\)</span> to zero (“0”) instead of one (“1”), will activate water quality calculations. If this command is set to one (“1”), then the WQ Module will still initialise are report as such, but when TUFLOW executes, the module will not be called.</p>
<p>Consistent with their specification in the *.fvc, the status of these latter two commands and their arguments are reported in the TUFLOW FV log file, rather than the WQ Module log file.</p>
<p>An example block of these five commands that together activate the WQ Module, point TUFLOW FV to the water quality control file ..<span class="math inline">\(\backslash\)</span>WQ<span class="math inline">\(\backslash\)</span>Model_000.fvwq and set the minimum depth for executing water quality calculations to 5 centimetres is:</p>
<pre><code>water quality model == TUFLOW
water quality model directory == ..\WQ\
water quality control file == .\Model_000.fvwq
cell water quality depth == 0.05
disable water quality model == 0</code></pre>
</div>
<div id="InitBCCond-3" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Initial and boundary conditions<a href="SimulationConstruction-1.html#InitBCCond-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In addition to activating the WQ Module and specifying its control file, WQ Module initial and boundary condition information is also set through the TUFLOW FV control file. The processes for doing so are described below. These are followed by discussion of the related matter of constituent ordering within initial and boundary condition specifications.</p>
<div id="ICGeneral-4" class="section level4 hasAnchor" number="4.6.2.1">
<h4><span class="header-section-number">4.6.2.1</span> Initial conditions<a href="SimulationConstruction-1.html#ICGeneral-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Water quality initial conditions are specified within or via the TUFLOW FV control file, akin to the manner in which the sediment initial conditions are set on behalf of the sediment transport module. This specification is mandatory.</p>
<p>There are currently a number of ways that water quality initial conditions may be specified. All are affected through TUFLOW FV commands which are described in the TUFLOW FV user manual. If no water quality initial conditions are specified, then a simulation will not execute. The specifications relevant to water quality simulations are described below. The potential limitations of some of these approaches are recognised and will be addressed in future release of the WQ Module.</p>
<div id="ICRst-5" class="section level5 hasAnchor" number="4.6.2.1.1">
<h5><span class="header-section-number">4.6.2.1.1</span> Restart files<a href="SimulationConstruction-1.html#ICRst-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Restart files are binary files that are generated from previous simulations. These can be used as inputs to initialise water quality simulations, provided that the restart and simulation model geometries, and water quality simulation computed variables and units are identical. A restart file is specified for all simulated quantities (not just water quality) and is controlled through commands described in the TUFLOW FV user manual. The key command is</p>
<blockquote>
<p><a href="AppCommands.html#FVRestart">restart ==</a> <a href="AppCommands.html#FVRestart">&lt;<em>restart file name</em>&gt;.rst</a></p>
</blockquote>
<p>Most often, restart files are located in the <code>log</code> directory, but this is not mandatory.</p>
</div>
<div id="ICGlob-5" class="section level5 hasAnchor" number="4.6.2.1.2">
<h5><span class="header-section-number">4.6.2.1.2</span> Globally uniform<a href="SimulationConstruction-1.html#ICGlob-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Globally uniform (i.e. across all spatial dimensions) initial conditions are set via a command issued from within the TUFLOW FV control file. This is often useful in setting initial conditions for simple small water bodies or at the commencement of a modelling process where initial conditions are set to be placeholders and updated at a later time. The command to do so is:</p>
<blockquote>
<p><a href="AppCommands.html#FVInitWQGlob">initial wq concentration ==</a> <a href="AppCommands.html#FVInitWQGlob">ordered initial conditions</a></p>
</blockquote>
<p>Each water quality computed variable is set to a single value everywhere. These initial concentrations must be specified in a particular order and this order is described in the following sections for different simulation classes. If the above command is used to set water quality initial conditions, then it must be accompanied by parallel commands that set globally uniform salinity, temperature (and optionally sediment) initial conditions:</p>
<pre><code>initial temperature == 15.0
initial Water Level == 1.00
initial sediment concentration == 10.0 
initial salinity == 3.5</code></pre>
<p>Setting a mix of globally uniform and other initial conditions (such as profile, 2d or 3d) is not permitted.</p>
</div>
<div id="ICGlobLat-5" class="section level5 hasAnchor" number="4.6.2.1.3">
<h5><span class="header-section-number">4.6.2.1.3</span> Globally laterally uniform<a href="SimulationConstruction-1.html#ICGlobLat-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Globally laterally uniform initial conditions use an initial profile to set hydrodynamic and water quality computed variable concentrations to be everywhere the same laterally, but to vary vertically. This is often useful in setting initial conditions for deep stationary water bodies such as lakes or reservoirs. The command to do so is:</p>
<blockquote>
<p><a href="AppCommands.html#FVInitWQProf">initial scalar profile ==</a> <a href="AppCommands.html#FVInitWQProf">&lt;<em>initial condition file name</em>&gt;.csv</a></p>
</blockquote>
<p>An example of the form of the text file argument <em>initial condition file name</em>.csv for simulating five water quality constituents is:</p>
<pre><code>Depth,Sal,temp,sed_1,WQ_1,WQ_2,WQ_3,WQ_4,WQ_5
0.0,2.0,22.0,5.0,8.0,22.0,2.6,1.4,0.5
10.0,2.5,15.0,15.0,5.0,32.0,2.6,1.4,0.2
20.0,3.0,10.0,25.0,0.0,42.0,5.6,5.4,0.1</code></pre>
<p>If the above command is used, then it must include profile information that also sets laterally uniform salinity, temperature (and optionally sediment) initial conditions. Setting a mix of laterally uniform and other initial conditions (such as globally uniform, 2d or 3d) is not permitted.</p>
<p>The order of these columns in the argument csv file is not important, but the columns headers are keywords and must be used as shown. For example, the following structure for <em>initial condition file name</em>.csv is permitted:</p>
<pre><code>Depth,temp,WQ_3,Sal,sed_1,WQ_4,WQ_1,WQ_2,WQ_5
0,22,2.6,2,5,1.4,8,22,0.5
10,15,2.6,2.5,15,1.4,5,32,0.2
20,10,3,3,25,5.4,0,42,0.1</code></pre>
<p>Notwithstanding this, it is still considered best practise to develop initial and boundary condition files that have a logically sequential order. Water quality initial conditions headers are labelled “WQ_1”, “WQ_2” onward, and the match between these header labels and water quality computed variables is set by the computed variable ordering of the simulation class deployed.</p>
</div>
<div id="ICGlobVert-5" class="section level5 hasAnchor" number="4.6.2.1.4">
<h5><span class="header-section-number">4.6.2.1.4</span> Globally vertically uniform<a href="SimulationConstruction-1.html#ICGlobVert-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Globally vertically uniform initial conditions use an initial two dimensional map to set hydrodynamic and water quality computed variable concentrations to be everywhere the same vertically, but to vary laterally. This is often useful in setting initial conditions for shallow water bodies that have horizontal concentration gradients such as small estuaries or urban lakes. The command to do so is:</p>
<blockquote>
<p><a href="AppCommands.html#FVInitWQ2D">initial condition 2d ==</a> <a href="AppCommands.html#FVInitWQ2D">&lt;<em>initial condition file name</em>&gt;.csv</a></p>
</blockquote>
<p>An example of the form of the text file argument <em>initial condition file name</em>.csv for simulating five water quality constituents is:</p>
<pre><code>ID,WL,sal,temp,sed_1,WQ_1
1,1.0,3.5,15,10.0,8.0
2,1.0,3.5,15,10.0,7.5
3,1.0,3.5,15,10.0,7.0
4,1.0,3.5,15,10.0,6.5</code></pre>
<p>If the above command is used, then it must include information that also sets vertically uniform salinity and temperature (and optionally sediment) initial conditions, as well as water level. Setting a mix of vertically uniform and other initial conditions (such as globally uniform, laterally uniform or 3d) is not permitted.</p>
<p>The order of these columns in the argument csv file is not important, but the columns headers are keywords and must be used as shown. For example, the following structure for <em>initial condition file name</em>.csv is permitted:</p>
<pre><code>ID,WQ_1,WL,sed_1,sal,temp
1,8.0,1.0,10.0,3.5,15
2,7.5,1.0,10.0,3.5,15
3,7.0,1.0,10.0,3.5,15
4,6.5,1.0,10.0,3.5,15</code></pre>
<p>Notwithstanding this, it is still considered best practise to develop initial and boundary condition files that have a logically sequential order. Water quality initial conditions headers are labelled “WQ_1”, “WQ_2” onward, and the match between these header labels and water quality computed variables is set by the computed variable ordering of the simulation class deployed.</p>
</div>
<div id="ICGlob3d-5" class="section level5 hasAnchor" number="4.6.2.1.5">
<h5><span class="header-section-number">4.6.2.1.5</span> Globally varying<a href="SimulationConstruction-1.html#ICGlob3d-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Globally variable initial conditions use an initial three dimensional map to set hydrodynamic and water quality computed variable concentrations at each 3D cell. This is analogous to using a restart file. The command to do so is:</p>
<blockquote>
<p><a href="AppCommands.html#FVInitWQ3D">initial condition 3d ==</a> <a href="AppCommands.html#FVInitWQ3D">&lt;<em>initial condition file name</em>&gt;.csv</a></p>
</blockquote>
<p>An example of the form of the text file argument <em>initial condition file name</em>.csv for simulating five water quality constituents is as follows, noting that the “ID” column refers to a three dimensional cell ID, rather than the two dimensional column ID used in the <code>initial condition 2d ==</code> command.</p>
<pre><code>ID,WL,sal,temp,sed_1,WQ_1
1,1.0,3.5,15,10.0,8.0
2,1.0,3.5,14,10.0,7.5
3,1.0,3.5,13,10.0,7.0
4,1.0,3.5,12,8.0,6.5
5,1.0,3.5,15,10.0,8.0
6,1.0,3.5,14,10.0,7.4
7,1.0,3.5,13,10.0,7.1
8,1.0,3.5,11,9.0,6.6</code></pre>
<p>If the above command is used, then it must include information that also sets globally varying salinity and temperature (and optionally sediment) initial conditions, as well as water level. Setting a mix of vertically uniform and other initial conditions (such as globally uniform, laterally uniform or 2d) is not permitted.</p>
<p>The order of these columns in the argument csv file is not important, but the columns headers are keywords and must be used as shown. For example, the following structure for <em>initial condition file name</em>.csv is permitted:</p>
<pre><code>ID,WQ_1,WL,sed_1,sal,temp
1,8.0,1.0,10.0,3.5,15
2,7.5,1.0,10.0,3.5,14
3,7.0,1.0,10.0,3.5,13
4,6.5,1.0,8.0,3.5,12
5,8.0,1.0,10.0,3.5,15
6,7.4,1.0,10.0,3.5,14
7,7.1,1.0,10.0,3.5,13
8,6.6,1.0,9.0,3.5,12</code></pre>
<p>Notwithstanding this, it is still considered best practise to develop initial and boundary condition files that have a logically sequential order. Water quality initial conditions headers are labelled “WQ_1”, “WQ_2” onward, and the match between these header labels and water quality computed variables is set by the computed variable ordering of the simulation class deployed.</p>
</div>
</div>
<div id="BCGeneral-4" class="section level4 hasAnchor" number="4.6.2.2">
<h4><span class="header-section-number">4.6.2.2</span> Boundary conditions<a href="SimulationConstruction-1.html#BCGeneral-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Water quality boundary conditions are also specified via the *.fvc file, either directly or via an include statement that points TUFLOW FV to a subsidiary boundary condition control file(s). This specification of water quality variable concentrations is optional, so in early water quality model construction stages this specification can be omitted. Omitted water quality boundary conditions will be set to zero. It is not recommended that this approach be taken beyond initial simulation setup stages, but that it be used only to develop a water quality simulation to the point where it executes without issuing error or unwanted warning messages. At this point, all water quality boundary conditions should be assigned.</p>
<p>All TUFLOW boundary conditions that specify water temperature or salinity will also require specification of the behaviour of simulated water quality variables. Common boundary conditions to which this applies include inflows (e.g. types Q, QC, QN, QG and others) and tidal boundaries (e.g. types WLS). Wave and meteorological boundary conditions do not need specification of water quality conditions.</p>
<p>As for initial conditions, boundary conditions that use columnar data structures (e.g. *.csv files) are interpreted using column headers specified in an <a href="SimulationConstruction-1.html#Ordering-4">expected order</a> within calling TUFLOW FV BC blocks. Further detail and the associated ordering is provided in the following sections (sections <a href="SimulationConstruction-1.html#SimSetSimClDO-2">4.8</a>, <a href="#SimSetSimClInorg-2"><strong>??</strong></a> and <a href="#SimSetSimClOrg-2"><strong>??</strong></a> for simulation classes DO, inorganics and organics, respectively).</p>
</div>
<div id="Ordering-4" class="section level4 hasAnchor" number="4.6.2.3">
<h4><span class="header-section-number">4.6.2.3</span> Ordering<a href="SimulationConstruction-1.html#Ordering-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Specification of initial conditions and most boundary conditions presently relies on listing water quality variables in a particular order. This applies in all instances when water quality initial or boundary conditions are provided in columnar or list form, which is most frequently in text file format. This is conceptually similar to the manner in which TUFLOW FV also relies on ordering of its initial and boundary conditions.</p>
<p>Future releases of TUFLOW FV will allow alternative methods for specification of initial and boundary conditions that do not rely on assumed ordering. In the interim however, the following applies.</p>
<div id="OrderIC-5" class="section level5 hasAnchor" number="4.6.2.3.1">
<h5><span class="header-section-number">4.6.2.3.1</span> Initial Conditions<a href="SimulationConstruction-1.html#OrderIC-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Initial conditions, if set using means other than a restart file, must be specified with water quality constituents in a preset order (globally uniform), or be referenced using incrementally numbered headers as “WQ_1”, “WQ_2” etc (profile, 2d or 3d, see Section <a href="SimulationConstruction-1.html#ICGeneral-4">4.6.2.1</a>).</p>
<p>For globally uniform initial conditions (Section <a href="SimulationConstruction-1.html#ICGlob-5">4.6.2.1.2</a>), the following *.fvc command can be used for a typical inorganics simulation class:</p>
<blockquote>
<p><a href="AppCommands.html#FVInitWQGlob">initial wq concentration ==</a> 7.5, 0.0, 4.2, 10.5, 0.6, 5.5</p>
</blockquote>
<p>There are no references to headers or variable names, but TUFLOW FV assumes that these numbers correspond to the ordered variables of the particular configuration of the inorganics simulation class returned to it from the WQ Module. In this example, this ordering is:</p>
<ul>
<li>Dissolved oxygen (7.5 mg/L)</li>
<li>Silicate (0.0 mg/L)</li>
<li>Ammonium (4.2 mg/L)</li>
<li>Nitrate (10.5 mg/L)</li>
<li>Filterable reactive phosphorus (0.6 mg/L), and</li>
<li>One phytoplankton group (5.5 <span class="math inline">\(\mu\)</span>g/L)</li>
</ul>
<p>The expected ordering is the same as that for boundary condition specifications, as described below.</p>
<p>For other initial condition specifications that involve providing csv files, the headers “WQ_1”, “WQ_2” etc must be used to denote water quality initial conditions. The ordering of the associated columns does not matter, however the assignment of a computed variable initial condition to a “WQ_XX” header (where XX is a number) does rely on the ordering described below - the first water quality computed variable expected should be headed “WQ_1” and so on.</p>
</div>
<div id="OrderBC-5" class="section level5 hasAnchor" number="4.6.2.3.2">
<h5><span class="header-section-number">4.6.2.3.2</span> Boundary Conditions<a href="SimulationConstruction-1.html#OrderBC-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Ordering of water quality boundary conditions is only important when specifying header information via the <code>bc header ==</code> (or equivalent) command within a TUFLOW FV *.fvc file BC block. It is in these commands (where comma separated header strings are specified) that TUFLOW FV expects a particular order of TUFLOW FV and WQ Module constituents. No column ordering is expected in boundary condition data files themselves. Ordering is only expected in the order of headers specified within a BC block within an TUFLOW FV control file. This is best illustrated by example.</p>
<p>If a user has elected to deploy the inorganics simulation class without sediment, then the following will be simulated (beyond the basic velocity and water level hydrodynamic variable suite):</p>
<ul>
<li>Salinity</li>
<li>Temperature</li>
<li>Dissolved oxygen</li>
<li>Silicate</li>
<li>Ammonium</li>
<li>Nitrate</li>
<li>Filterable reactive phosphorus</li>
<li>One (assumed for this example, but can be multiple) phytoplankton group</li>
</ul>
<p>These will eventually need proper boundary condition specification in boundary condition blocks and have supporting data provided in (usually) text files. In a simple model with only one WL boundary condition, a <code>bc block</code> of the following form would be required as a minimum to properly specify the hydrodynamic and water quality boundaries:</p>
<blockquote>
<p>bc == WL, 1, datafile.csv <br>
<span class="math inline">\(\blockindent\)</span> bc header == time, wsel, sali, temp, DOxy, SiO4, NH41, nitr, frph, bluegreen <br>
end bc <br></p>
</blockquote>
<p>To be clear:</p>
<ul>
<li><p>The names listed on the <code>bc header ==</code> line (time, wse etc.) are not keywords or special names, and can be any names that a user chooses</p></li>
<li><p>TUFLOW FV will however, assume that these names (whatever they have been set to) have been listed in such an order that they have a one to one correspondence to the ten computed variables as follows:</p>
<ol style="list-style-type: decimal">
<li>time <span class="math inline">\(\rightarrow\)</span> Time stamp</li>
<li>wsel <span class="math inline">\(\rightarrow\)</span> Water surface elevation</li>
<li>sali <span class="math inline">\(\rightarrow\)</span> Salinity</li>
<li>temp <span class="math inline">\(\rightarrow\)</span> Temperature</li>
<li>DOxy <span class="math inline">\(\rightarrow\)</span> Dissolved oxygen</li>
<li>SiO4 <span class="math inline">\(\rightarrow\)</span> Silicate</li>
<li>NH41 <span class="math inline">\(\rightarrow\)</span> Ammonium</li>
<li>nitr <span class="math inline">\(\rightarrow\)</span> Nitrate</li>
<li>frph <span class="math inline">\(\rightarrow\)</span> Filterable reactive phosphorus</li>
<li>bluegreen <span class="math inline">\(\rightarrow\)</span> Phytoplankton group one</li>
</ol></li>
<li><p>TUFLOW then matches the user specified names to the expected simulation variables, based on this ordering, to then interrogate boundary condition files.</p></li>
</ul>
<p>Following the above matching, TUFLOW FV interrogates the relevant boundary condition file (“datafile.csv” in the example above), where this file can have its columns arranged in any order: the order of these columns does not matter because TUFLOW FV will use the mapping previously developed via the <code>bc header ==</code> command to look through all data file columns one by one, searching for the headers specified, regardless of the actual ordering of boundary condition file columns. For example, the silicate boundary condition data could be positioned in column 14 of the boundary condition file, but as long as it is labelled with the correct header (“SiO4” as specified in <code>bc header ==</code>), TUFLOW FV will know to assign column 14 of the boundary condition data file to the silicate computed variable.</p>
<p>Ordering is set by the user’s selection of simulation class and constituent models, and is explicitly listed in each simulation class section (Sections <a href="SimulationConstruction-1.html#ConOrdDO-3">4.8.5</a>, <a href="#ConOrdInorg-3"><strong>??</strong></a> and <a href="#ConOrdOrg-3"><strong>??</strong></a> for DO, inorganics and organics, respectively). The expected ordering for a particular simulation is also reported in the simulation water quality log file for checking.</p>
</div>
</div>
</div>
</div>
<div id="WQctrlfil-2" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Water quality control file commands<a href="SimulationConstruction-1.html#WQctrlfil-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The water quality control file comprises three parts, with each part containing different types of commands and flags. Whilst it is recommended that these parts be kept separate and in the order described below (especially given how complex water quality simulations can become), doing so is not mandatory and commands or command blocks may be entered in any order.</p>
<p>These parts are as follows, with the first two mirroring the architecture described in Section <a href="Architecture-1.html#Architecture-1">2</a>:</p>
<ol style="list-style-type: decimal">
<li>Simulation controls (i.e. simulation class)</li>
<li>Constituent model settings (i.e. constituent model class)</li>
<li>Material specifications</li>
</ol>
<p>Notwithstanding this, a WQ Module control file need not contain any commands, and can be completely blank. This is by design, and intended to allow users to rapidly set up and execute a TUFLOW water quality simulation. If the water quality control file is left blank, then the WQ Module will:</p>
<ul>
<li>Construct a simulation using the dissolved oxygen simulation class (which is the simplest class)</li>
<li>Set the simulation units to mg/L</li>
<li>Set library defaults for all parameters</li>
<li>Set the water quality model timestep to the default</li>
<li>Assign zero dissolved oxygen concentration to all boundary conditions. This is by design, and will assist in ensuring that the subsequent user-defined updating of boundary conditions is thorough and complete (zero dissolved oxygen boundary conditions are rare and therefore easily identifiable).</li>
</ul>
<p>Initial conditions will also need to be specified in the TUFLOW FV control file as per Section <a href="SimulationConstruction-1.html#InitBCCond-3">4.6.2</a>. Specification of boundary conditions can be deferred.</p>
<p>The water quality control file sections are described below. Details specific to each simulation class and constituent model are provided in subsequent sections</p>
<div id="SimCtrls-3" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Part 1: Simulation controls<a href="SimulationConstruction-1.html#SimCtrls-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simulation controls set the high level operation of the WQ Module and are not specific to a simulation class. All are optional. Available commands set the:</p>
<ul>
<li>Simulation class via <a href="AppCommands.html#WQSimulationClass">simulation class ==</a></li>
<li>Timestep <a href="#WQdt">dt</a> (in seconds) at which TUFLOW calls the WQ Module via <a href="AppCommands.html#WQWqDt">wq dt ==</a></li>
<li>Units of simulation via <a href="AppCommands.html#WQWqUnits">wq units ==</a></li>
<li>Frequency of equilibrium substepping <a href="#WQFss">fess</a> (in number of timesteps) to execute non-kinetic equilibrium calculations via <a href="AppCommands.html#WQWqEQSS">wq equilibrium substeps ==</a></li>
<li>Reporting or suppression of minimum / maximum concentration exceedances (see Section <a href="SimulationConstruction-1.html#ConModSttngs-3">4.7.2</a>) via <a href="AppCommands.html#WQSuppressMinMax">report min max warnings ==</a></li>
</ul>
<p>A typical simulation control section might therefore look like the following:</p>
<pre><code>simulation class == DO
wq dt == 600.0
wq units == mgl
wq equilibrium substeps == 1
report min max warnings == on</code></pre>
</div>
<div id="ConModSttngs-3" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Part 2: Constituent model settings<a href="SimulationConstruction-1.html#ConModSttngs-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Constituent model settings are those that:</p>
<ul>
<li>Specify the constituent model to be used within each preset constituent model class. These are referred to as constituent model blocks</li>
<li>Set the parameters for each of these constituent models, as commands within these blocks</li>
</ul>
<p>All are optional, however if a constituent model block is initiated then it requires an <code>end XXXX model</code> command to terminate the block, where XXXX is the name of the constituent model class, such as inorganic nitrogen. An example of a user selecting to use the adsorbed filterable reactive phosphorous constituent model (that is a model available within the inorganic phosphorus constituent model class), and setting some parameters within that model is as follows:</p>
<pre><code>inorganic phosphorus model == frpads
  atmospheric deposition == 12.6, 0.5
end inorganic phosphorus model</code></pre>
<p>Parameters not specified by the user are set to library defaults.</p>
<p>All constituent models allow for constraining (and then reporting) the predictions of their respective computed variable concentrations via the setting of minimum and maximum limits, if desired. This is often useful in identifying unusual model behaviours or instabilities. Where exceedences of these limits are identified by the WQ Module:</p>
<ul>
<li>Time and model cell information is written to the WQ Module log file in real time. This allows for easy identification of potential model issues via periodic examination of the WQ Module log file, rather than waiting for simulation completion</li>
<li>The WQ Module resets the computed concentration to the relevant specified minimum or maximum concentration</li>
</ul>
<p>The above resetting will result in mass conservation errors. It should not be relied on to artificially control the behaviour of an otherwise unstable or runaway water quality simulation. Rather, this functionality should be used as a convenient way to check model performance and flag potential issues, with a view to then implementing corrective action. Equally, suppressing warnings written to the WQ log file using the <a href="AppCommands.html#WQSuppressMinMax">report min max warnings ==</a> command described in Section <a href="SimulationConstruction-1.html#SimCtrls-3">4.7.1</a> is not recommended because doing so may mask underlying model construction issues.</p>
<p>These limits are optionally specified in each constituent model block. An example that sets these limits for ammonium is:</p>
<blockquote>
<p>ammonium min max == 0.0, 25.0</p>
</blockquote>
<p>Although in the strictest sense, sediment (benthic) flux half saturation concentrations and temperature coefficients are benthic properties, the WQ Module does not yet support these parameters being applied on a spatially varying basis (i.e. per material). As such, these are considered to be constituent model global parameters and so are set in this part of the water quality control file, i.e. within respective constituent model blocks. An example that sets an oxygen half saturation and temperature coefficient for benthic flux is:</p>
<blockquote>
<p>oxygen benthic == 5.0, 1.08</p>
</blockquote>
</div>
<div id="MatSpecs-3" class="section level3 hasAnchor" number="4.7.3">
<h3><span class="header-section-number">4.7.3</span> Part 3: Material specifications<a href="SimulationConstruction-1.html#MatSpecs-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final part of the water quality control file (*.fvwq) provides for specification of benthic (sediment) fluxes, via material blocks. The commands required to commence and terminate a materials block are as follows:</p>
<blockquote>
<p><a href="AppCommands.html#WQInitMatBlck">material ==</a> <a href="AppCommands.html#WQInitMatBlck">&lt;<em>up to 10 comma separated material numbers, or “default”</em>&gt;</a></p>
</blockquote>
<p>and</p>
<blockquote>
<p><a href="AppCommands.html#WQEndMatBlck">end material</a></p>
</blockquote>
<p>This material block nomenclature mirrors that used in the TUFLOW FV and sediment transport control files. An example of specifying oxygen and nitrate benthic fluxes for materials 2, 7 and 12 is:</p>
<pre><code>material == 2, 7, 12
  oxygen flux == -60.0
  nitrate flux == 12.5
end material</code></pre>
<p>The WQ Module allows for specification of a default set of benthic fluxes that are applied across all materials, by using the key word <code>default</code> instead of specifying material numbers in a material block. These defaults can then be progressively overwritten on a material by material basis by specifying subsequent material blocks.</p>
<p>For example, a model that has ten materials in total, eight of which have the same oxygen benthic flux (all materials except 4 and 7), can have its overall oxygen benthic flux specified as:</p>
<pre><code>material == default
  oxygen flux == -60.0
end material

material == 4, 7
  oxygen flux == -20.0
end material</code></pre>
</div>
<div id="SimSetSum-2" class="section level3 hasAnchor" number="4.7.4">
<h3><span class="header-section-number">4.7.4</span> Summary<a href="SimulationConstruction-1.html#SimSetSum-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to set up and execute a water quality simulation using the WQ Module, the following steps are required:</p>
<ul>
<li>Modify the TUFLOW FV control file:
<ul>
<li>Add at least the following commands to TUFLOW FV control file (*.fvc):
<ul>
<li><a href="AppCommands.html#FVActivateWQM">water quality model ==</a> TUFLOW</li>
<li><a href="AppCommands.html#FVWQMCtrlFl">water quality control file ==</a> &lt;<em>water quality control file name</em>&gt;.fvwq</li>
</ul></li>
<li>Optionally add a folder path command to the TUFLOW FV control file (*.fvc) with a trailing backslash:
<ul>
<li><a href="AppCommands.html#FVWQMCtrlDr">water quality model dir ==</a> &lt;<em>relative path to *.fvwq file</em>&gt;<span class="math inline">\(\backslash\)</span></li>
</ul></li>
<li>Add appropriate initial conditions for all water quality constituents, observing <a href="SimulationConstruction-1.html#OrderIC-5">ordering rules</a> where required</li>
<li>Initially optionally add boundary conditions for all water quality constituents, observing <a href="SimulationConstruction-1.html#OrderBC-5">ordering rules</a> in <code>bc header ==</code> commands</li>
</ul></li>
<li>Create the water quality control file with the corresponding name and path</li>
<li>Modify the water quality control file
<ul>
<li>Optionally add to the water quality control file:
<ul>
<li>Part 1: A simulation controls section</li>
<li>Part 2: A constituent model setting section with one or more constituent model blocks with one or more parameter commands</li>
<li>Part 3: A material block specifications section</li>
</ul></li>
</ul></li>
</ul>
<p>Once initially constructed, boundary conditions can be added (if not already in place), and progressive refinement and parameterisation of constituent models and benthic fluxes can be affected. Details of these commands and their options within each specific simulation class are provided in subsequent sections. Subsections are separated into the above water quality control file parts for ease and consistency of reference. All commands are optional.</p>
</div>
<div id="SimSetLog-2" class="section level3 hasAnchor" number="4.7.5">
<h3><span class="header-section-number">4.7.5</span> Log files<a href="SimulationConstruction-1.html#SimSetLog-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Every WQ Module water quality simulation generates a log file that contains an echo of the WQ Module construction and execution commentary. It is written to the same location (and with the same name) as the WQ Module control file, with the file extension “fvwqlog”. This file contains a great deal of information that should be carefully reviewed. Suppressing warnings written to this log file, although possible, is not recommended or encouraged.</p>

</div>
</div>
<div id="SimSetSimClDO-2" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Simulation Class: DO<a href="SimulationConstruction-1.html#SimSetSimClDO-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If no simulation class is specified then a simulation will be automatically constructed using this DO class, and populated with library defaults for all parameters. Computed variables will be:</p>
<ul>
<li>Dissolved oxygen</li>
<li>Pathogens (optional, potentially multiple)</li>
</ul>
<div id="PrereqDO-3" class="section level3 hasAnchor" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> Prerequisites<a href="SimulationConstruction-1.html#PrereqDO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The DO simulation class requires simulation of the following in TUFLOW FV:</p>
<ul>
<li>Hydrodynamics, in either two or three dimensions (including any internal one dimensional structures if present)</li>
<li>Salinity</li>
<li>Temperature</li>
<li>Heat module on (i.e. meteorological forcing is required)</li>
</ul>
<p>Simulation of suspended sediment (via TUFLOW FV’s sediment transport module) is optional, unless attached pathogens are simulated.</p>
</div>
<div id="SimCtrlsDO-3" class="section level3 hasAnchor" number="4.8.2">
<h3><span class="header-section-number">4.8.2</span> Part 1: Simulation specification<a href="SimulationConstruction-1.html#SimCtrlsDO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The DO simulation class is set via</p>
<blockquote>
<p><a href="AppCommands.html#WQSimulationClass">simulation class ==</a> DO</p>
</blockquote>
<p>The other commands in this part are not specific to this simulation class. See section <a href="SimulationConstruction-1.html#SimCtrls-3">4.7.1</a>.</p>
</div>
<div id="ConModSttngsDO-3" class="section level3 hasAnchor" number="4.8.3">
<h3><span class="header-section-number">4.8.3</span> Part 2: Constituent model specification<a href="SimulationConstruction-1.html#ConModSttngsDO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As per Tables <a href="#tab:tab-ConClasses"><strong>??</strong></a> and <a href="#tab:tab-ConClassMods"><strong>??</strong></a>, oxygen is the only mandatory constituent model class available within the DO simulation class, and there is only one oxygen constituent model within that class, with code O2. Pathogens may be optionally simulated (in any simulation class).</p>
<div id="ConModClssOxy-4" class="section level4 hasAnchor" number="4.8.3.1">
<h4><span class="header-section-number">4.8.3.1</span> Model class: Oxygen<a href="SimulationConstruction-1.html#ConModClssOxy-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="ConModO2-5" class="section level5 hasAnchor" number="4.8.3.1.1">
<h5><span class="header-section-number">4.8.3.1.1</span> Constituent model: O2<a href="SimulationConstruction-1.html#ConModO2-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>This constituent model is specified as:</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyMod">oxygen model ==</a> O2</p>
</blockquote>
<p>Minimum and maximum concentrations are specified as:</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyMinMax"><span class="math inline">\(\blockindent\)</span> oxygen min max ==</a> <a href="#WQParMinO2"><span class="math inline">\(\left[DO\right]_{min}^{O_2}\)</span></a>, <a href="#WQParMaxO2"><span class="math inline">\(\left[DO\right]_{max}^{O_2}\)</span></a></p>
</blockquote>
<p>Global benthic parameters (used in Equation <a href="#eq:equ-sed-do-flux">(<strong>??</strong>)</a>) are specified as:</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyBenFlxPars"><span class="math inline">\(\blockindent\)</span> oxygen benthic ==</a> <a href="#WQParKsedO2"><span class="math inline">\(K_{sed-O_2}^{O_2}\)</span></a>, <a href="#WQParthetasedO2"><span class="math inline">\(\theta_{sed}^{O_2}\)</span></a></p>
</blockquote>
<p>The oxygen piston model to be used (in either Equation <a href="#eq:equ-atm-Pv1">(<strong>??</strong>)</a> or Equation <a href="#eq:equ-atm-Pv4">(<strong>??</strong>)</a>) is specified as:</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyPistMod1"><span class="math inline">\(\blockindent\)</span> oxygen piston model ==</a> Wanninkhof92</p>
</blockquote>
<p>or</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyPistMod4"><span class="math inline">\(\blockindent\)</span> oxygen piston model ==</a> Ho16</p>
</blockquote>
<p>The argument (either “Wanninkhof92” or “Ho16”) activates a different oxygen piston model (Equation <a href="#eq:equ-atm-Pv1">(<strong>??</strong>)</a> or Equation <a href="#eq:equ-atm-Pv4">(<strong>??</strong>)</a>, respectively).</p>
<p>Although not strictly necessary, the use of “oxygen” to prefix these block commands is deliberate so as to maintain consistency of command style with other constituent model blocks that include more than one computed variable, such as nitrogen, phosphorus and organics. Nonetheless, if the “oxygen” prefix is omitted within this constituent model block, the WQ Module will still interpret the above commands correctly.</p>
<p>This constituent model block must be terminated using the command:</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyModEnd">end oxygen model</a></p>
</blockquote>
</div>
</div>
<div id="ConModClssPth-4" class="section level4 hasAnchor" number="4.8.3.2">
<h4><span class="header-section-number">4.8.3.2</span> Model class: Pathogens (optional)<a href="SimulationConstruction-1.html#ConModClssPth-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This model class is optional.</p>
<div id="ConModFree-5" class="section level5 hasAnchor" number="4.8.3.2.1">
<h5><span class="header-section-number">4.8.3.2.1</span> Constituent model: Free<a href="SimulationConstruction-1.html#ConModFree-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>This constituent model is specified as:</p>
<blockquote>
<p><a href="#WQPthMod">pathogen model ==</a> free, <em>pathname</em></p>
</blockquote>
<p><em>pathname</em> is any user specified pathogen group name that:</p>
<ul>
<li>Uses only alphanumeric characters</li>
<li>Has no spaces</li>
<li>Excludes the keyword ‘PATH’, and</li>
<li>Is not the same as any other group name</li>
</ul>
<p>Minimum and maximum concentrations are specified as:</p>
<blockquote>
<p><a href="AppCommands.html#WQPthMinMax"><span class="math inline">\(\blockindent\)</span> alive min max ==</a> <a href="#WQParMinPth"><span class="math inline">\(\left[PTH_a\right]_{min}^{pth}\)</span></a>, <a href="#WQParMaxPth"><span class="math inline">\(\left[PTH_a\right]_{max}^{pth}\)</span></a></p>
</blockquote>
<p>Mortality parameters are specified as:</p>
<blockquote>
<p><a href="AppCommands.html#WQPthMort"><span class="math inline">\(\blockindent\)</span> mortality ==</a> <a href="#WQParkdPath"><span class="math inline">\(k_{d}^{pth}\)</span></a>, <a href="#WQParCSMPath"><span class="math inline">\(C_{SM}^{pth}\)</span></a>, <a href="#WQParalphaPath"><span class="math inline">\(\alpha\)</span></a>, <a href="#WQParbetaPath"><span class="math inline">\(\beta\)</span></a>, <a href="#WQParthetamorPath"><span class="math inline">\(\theta_{mor}^{pth}\)</span></a></p>
</blockquote>
<p><span class="math inline">\(\beta\)</span> is not currently used but must be retained as a placeholder in this command for future use.</p>
<p>Light inactivation parameters are specified in three separate but related commands, with one command per light band (visible, UV-A and UV-B):</p>
<blockquote>
<p><a href="AppCommands.html#WQPthvisInvn"><span class="math inline">\(\blockindent\)</span> visible inactivation ==</a> <a href="#WQParkvisPath"><span class="math inline">\(k_{vis}\)</span></a>, <a href="#WQParcSvisPath"><span class="math inline">\(c_{S_{vis}}^{pth}\)</span></a>, <a href="#WQParKDOvisPath"><span class="math inline">\(K_{DO_{vis}}^{pth}\)</span></a></p>
</blockquote>
<blockquote>
<p><a href="AppCommands.html#WQPthuvaInvn"><span class="math inline">\(\blockindent\)</span> uva inactivation ==</a> <a href="#WQParkuvaPath"><span class="math inline">\(k_{uva}\)</span></a>, <a href="#WQParcSuvaPath"><span class="math inline">\(c_{S_{uva}}^{pth}\)</span></a>, <a href="#WQParKDOuvaPath"><span class="math inline">\(K_{DO_{uva}}^{pth}\)</span></a></p>
</blockquote>
<blockquote>
<p><a href="AppCommands.html#WQPthuvbInvn"><span class="math inline">\(\blockindent\)</span> uvb inactivation ==</a> <a href="#WQParkuvbPath"><span class="math inline">\(k_{uvb}\)</span></a>, <a href="#WQParcSuvbPath"><span class="math inline">\(c_{S_{uvb}}^{pth}\)</span></a>, <a href="#WQParKDOuvbPath"><span class="math inline">\(K_{DO_{uvb}}^{pth}\)</span></a></p>
</blockquote>
<p>Settling of non-attached pathogens is specified as follows, with a negative number being a downwards velocity:</p>
<blockquote>
<p><a href="AppCommands.html#WQPthSettleFree"><span class="math inline">\(\blockindent\)</span> settling ==</a> <a href="#WQParVPathAD"><span class="math inline">\(V_{settle}^{pth}\)</span></a></p>
</blockquote>
<p>This constituent model block must be terminated using the command:</p>
<blockquote>
<p><a href="#WQPathModEnd">end pathogen model</a></p>
</blockquote>
</div>
<div id="ConModAtt-5" class="section level5 hasAnchor" number="4.8.3.2.2">
<h5><span class="header-section-number">4.8.3.2.2</span> Constituent model: Attached<a href="SimulationConstruction-1.html#ConModAtt-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>This constituent model must be accompanied by simulation of at least one sediment fraction within the TUFLOW FV sediment transport (ST) module, and is specified as:</p>
<blockquote>
<p><a href="#WQPthMod">pathogen model ==</a> attached, <em>pathname</em></p>
</blockquote>
<p><em>pathname</em> is any user specified pathogen group name that:</p>
<ul>
<li>Uses only alphanumeric characters</li>
<li>Has no spaces</li>
<li>Excludes the keyword ‘PATH’, and</li>
<li>Is not the same as any other group name</li>
</ul>
<p>The commands are the same as those specified within a free pathogen constituent model block (Section <a href="SimulationConstruction-1.html#ConModFree-5">4.8.3.2.1</a>), with the following modification or additions.</p>
<p>Settling is specified for both free and attached pathogens:</p>
<blockquote>
<p><a href="AppCommands.html#WQPthSettleAtt"><span class="math inline">\(\blockindent\)</span> settling ==</a> <a href="#WQParVPathAD"><span class="math inline">\(V_{settle}^{pth}\)</span></a>, <a href="#WQParVPathT"><span class="math inline">\(V_{settle}^{pth_t}\)</span></a></p>
</blockquote>
<p>The target attached pathogen fraction is specified as:</p>
<blockquote>
<p><a href="#WQPthTargAttFrac"><span class="math inline">\(\blockindent\)</span> target attached fraction ==</a> <a href="#WQParfattPth"><span class="math inline">\(f_{att}^{pth}\)</span></a></p>
</blockquote>
<p>This constituent model block must be terminated using the command:</p>
<blockquote>
<p><a href="#WQPathModEnd">end pathogen model</a></p>
</blockquote>
</div>
</div>
</div>
<div id="MatSpecsDO-3" class="section level3 hasAnchor" number="4.8.4">
<h3><span class="header-section-number">4.8.4</span> Part 3: Material specification<a href="SimulationConstruction-1.html#MatSpecsDO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Oxygen benthic flux (used in Equation <a href="#eq:equ-sed-do-flux">(<strong>??</strong>)</a>) is specified within both default and numbered material blocks as:</p>
<blockquote>
<p><a href="AppCommands.html#WQOxyBenFlx"><span class="math inline">\(\blockindent\)</span> oxygen flux ==</a> <a href="#WQParFsedO2"><span class="math inline">\(F_{sed}^{O_2}\)</span></a></p>
</blockquote>
</div>
<div id="ConOrdDO-3" class="section level3 hasAnchor" number="4.8.5">
<h3><span class="header-section-number">4.8.5</span> Constituent ordering<a href="SimulationConstruction-1.html#ConOrdDO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dissolved oxygen is the only mandatory constituent simulated by the WQ Module for this simulation class, and therefore oxygen concentration is specified as the first variable (shown in symbolic form below):</p>
<blockquote>
<p>initial wq concentration == <span class="math inline">\(\left[ DO \right]\)</span></p>
</blockquote>
<p>Similarly, in a <code>bc header ==</code> command within a bc block, oxygen is expected to be the first and only mandatory water quality variable after hydrodynamic boundary conditions.</p>
<blockquote>
<p><span class="math inline">\(\blockindent\)</span>bc header == time, water_elev, sal, temp, clay, sand, DO_mgL</p>
</blockquote>
<p>DO_mgL is the header used to designate oxygen in the related boundary condition file, noting that the DO_mgL column in the boundary condition file can appear in any column in the boundary condition file, and that it does not need to be the seventh column. The header text “DO_mgL” is just an example, and it can be any header desired, as long as it matches the correct column header in the boundary condition file.</p>
<div id="ConOrdDOPath-4" class="section level4 hasAnchor" number="4.8.5.1">
<h4><span class="header-section-number">4.8.5.1</span> Pathogens (optional)<a href="SimulationConstruction-1.html#ConOrdDOPath-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If pathogens are simulated, then their headers are required at the end of any lists, regardless of the other hydrodynamic and water quality constituents simulated. This therefore applies to all simulation classes from DO to organics. Alive and dead pathogens are always required to be specified, in that order, and if attached pathogens are simulated then that attached pathogens header is listed between those of alive and dead. This pattern is repeated for each specified pathogen group, in the order in which pathogen groups are defined via pathogen constituent model blocks in the water quality control file. For example, where two pathogen groups are simulated (called ECOLI and CRYPTO, and defined in that order in the corresponding water quality control file), with ECOLI including attachment, the above bc header would be extended to the following:</p>
<blockquote>
<p><span class="math inline">\(\blockindent\)</span>bc header == time, water_elev, sal, temp, clay, sand, DO_mgL, ECOLI_alive, ECOLI_att, ECOLI_dead, CRYPTO_al, CRYPTO_de</p>
</blockquote>
</div>
</div>
<div id="ExampleDO" class="section level3 hasAnchor" number="4.8.6">
<h3><span class="header-section-number">4.8.6</span> Example<a href="SimulationConstruction-1.html#ExampleDO" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Following is an example of all the available WQ Module <code>simulation class == DO</code> commands. A single material applied as zeros everywhere as the default, other than for materials 1 and 4 where the default flux is overwritten. One (optional) pathogen constituent model block has been included, but is not required.</p>
<pre><code>simulation class == DO
wq dt == 600
wq units == mgl

oxygen model == O2
    oxygen benthic == 4.0, 1.05
    oxygen min max == 0.0, 15.0
end oxygen model

!optional pathogen constituent model block:
pathogen model == free, crypto 
    alive min max == 0.0, 1e7
    mortality == 0.08, 2e-12, 6.1, 1.0, 1.11 
    visible inactivation == 0.082, 0.0067, 0.5 
    uva inactivation == 0.5, 0.0067, 0.5 
    uvb inactivation == 1.0, 0.0067, 0.5 
    settling == -0.03
end pathogen model

material == default
    oxygen flux == 0
end material

material == 1, 4
    oxygen flux == -137.0
end material</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ProcessDescriptions-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="AppCommands.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": false,
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
