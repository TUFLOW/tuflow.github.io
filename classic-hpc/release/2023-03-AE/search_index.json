[["index.html", "TUFLOW Classic/HPC New Release Notes ", " TUFLOW Classic/HPC New Release Notes Release Build 2023-03-AE Updated on 11 Apr 2024 "],["introduction.html", "Introduction Document Updates and Important Notices Summary Licensing", " Introduction Document Updates and Important Notices (in chronological order) March 16, 2023: The 2023-03 Release is a major release that includes several new industry leading features built into the TUFLOW HPC 2D solver. The exciting new features include layered interflow, support for new vector and raster GIS file formats, Sub-Grid Sampling (SGS) enhancements and 2D bridge modelling enhancements. The HPC solver has several new default settings due to the new functionality. Without setting the backward compatibility switches the results will be different, although for most models the differences should be minimal. For TUFLOW Classic, no default settings have changed, however, an update to the Fortran Compiler may mean very slight differences compared to the 2020-10 builds. June 22, 2023: The 2023-03-AB Release update which includes bug fixes and enhancements. A description of bug fixes and other changes are highlighted in light green. September 15, 2023: The 2023-03-AC Release update which includes bug fixes and enhancements. A description of bug fixes and other changes are highlighted in light blue. February 27, 2024: The 2023-03-AD Release update which includes bug fixes and enhancements. A description of bug fixes and other changes are highlighted in light orange. March 21, 2024: The 2023-03-AE Release update which includes a bug fix for HPC when running on multiple GPUs or multiple CPU threads. This change is highlighted in light grey. Note: Any models using 2023-03-AD for HPC simulations should update to 2023-03-AE. See Bug fix for HPC running on multiple GPU/CPU for a detailed description of this issue. This document may be updated from time-to-time with new content from software updates. Summary The TUFLOW Classic/HPC 2023-03 Release introduces major new functionality, along with general enhancements and bug fixes. The major features are as follows: Layered Interflow The new layered interflow feature permits horizontal flow of water through soil layers within the cumulative infiltration layer. Up to 10 vertical layers are supported, each with horizontal advection and vertical infiltration from above. The functionality introduced in the 2023-03 Release is intended to provide a mechanism to improve catchment runoff and inundation modelling. For example: Catchment response for 2D direct rainfall (“rain on grid”) models can be better represented where subsurface transmission affects surface runoff. Longer term, continuous catchment models offer improved prediction of streamflows between rainfall events. The accuracy of real-time flood forecasts can be improved by modelling the drying and draining of catchments between rainfall events. Sub-surface seepage causing inundation, such as seepage under a levee bank through a porous layer (e.g., old gravel river course), causing flooding on the protected side of the levee. New GIS Database Format for Vector and Raster Data The 2023-03 Release increases support for GIS formats with new vector and raster formats supported for both reading and writing of GIS data. These new formats are GeoPackage (vector and raster) and GeoTIFF (raster only). GeoPackage is a widely supported, open GIS database format, built upon an SQLite database (data is stored as a single file with the extension .gpkg). This database format has several benefits, including: Multiple GIS layer can be stored in the single file database. For example, all GIS input layers can be stored in a single GeoPackage file. Supports spatial indexing, greatly reducing loading and viewing times making it much faster to work with in GIS packages. Faster to write from TUFLOW than the shapefile format. Sub-Grid Sampling Enhancements The 2023-03 Release extends the functionality of the Sub-Grid Sampling (SGS) introduced to TUFLOW HPC in the 2020-01 Release. This includes improving performance of start-up times for SGS models through parallelisation and new .xf files, additional options for defining sampling frequency, and improved output mapping. Bridge Enhancements TUFLOW HPC introduces a new 2D bridge modelling option, that simplifies 2D bridge inputs and incorporates the outcomes of a joint research project between Qld Dept of Transport and Main Roads (TMR) and TUFLOW to better quantify bridge deck losses (Collecutt et al., 2022). The 2023-03 Release also includes support for modelling 1D arch bridges. Licensing For perpetual licences, to run simulations using Build 2023-03-AA through 2023-03-AC requires payment of the 2022/2023 annual software maintenance fee (invoiced mid-2022) and for the TUFLOW licence to have been updated (i.e., via RaC/RaU files). For active rental and subscription licences, no updates should be required. Build 2023-03-AD requires payment of the 2023/2024 annual software maintenance fee (invoiced mid-2023) and for the TUFLOW licence to have been updated. For tutorial and demo models, or if running in free demo mode, no licence is required. For any licensing enquiries please contact sales@tuflow.com, or for general support support@tuflow.com. Use of the TUFLOW software in any mode is bound by the TUFLOW Products Licence Agreement. Please refer to the TUFLOW Price List for more details or contact sales@tuflow.com. Note: If running TUFLOW HPC on GPU hardware the NVidia drivers may need to be updated for the 2023-03 Release. This is due to an update in the CUDA compiler version (to CUDA version 11.5). If using TUFLOW HPC on a NVidia GPU device, it is recommended to update the NVidia drivers prior to using the 2023-03 Release. The updated CUDA compiler means that TUFLOW HPC may no longer work on older GPU. For the 2023-03 Release, two executables are provided: 64-bit single precision (TUFLOW_iSP_w64.exe) and 64-bit double precision (TUFLOW_iDP_w64.exe). Note, if using the HPC solver (including Quadtree), it is rare that the double precision version is required due to the nature of the solution scheme. If in doubt, run the model using single and double precision, and if there is no significant change in results use single precision as the simulation will be faster and use less memory. References Collecutt, G., Baeumer, U., Gao, S., &amp; Syme, W. (2022). Bridge Deck Afflux Modelling – Benchmarking of CFD and SWE Codes to Real-World Data. Hydrology &amp; Water Resources Symposium. https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf "],["Overview-1.html", "Section 1 Overview 1.1 2023-03 Release", " Section 1 Overview 1.1 2023-03 Release The 2023-03 Release is a major release that introduces new features and offers significant improvements to the existing sub-grid sampling functionality. A range of general new features, enhancements and bug fixes are also included. These include: New GIS Vector file format – GeoPackage New GIS Raster file formats – GeoTIFF and GeoPackage Layered interflow (Sub-Surface) Flows Sub-Grid Sampling (SGS) improvements 2D bridge modelling enhancements 2D weir flow enhancements EPA SWMM Linking to TUFLOW: On request from USA XPSWMM users, TUFLOW linkage with 1D EPA SWMM has been added as supported functionality in the 2023-03-AD release. This new functionality provides users with an alternative to XPSWMM, within a GIS model build and result viewing environment. Importantly, the computational solution is comparable to using XPSWMM because TUFLOW Classic &amp; HPC are the Classic and Extreme 2D solvers used by XPSWMM. TUFLOW-SWMM tutorials are available from the TUFLOW Wiki. Demonstration of the workflow and automation tools available to support the conversion of XPSWMM models to TUFLOW-SWMM is also provided in the TUFLOW Wiki. A new Chapter in this document (Section 4) details this TUFLOW-SWMM functionality. As always, it is recommended that when switching to a new build with an established model, test runs are carried out and comparisons made between the old and new builds (subtracting the two maximum water level (h) data sets and reviewing any differences is an easy way to do this). If you have any queries on the comparison, or require clarification or more detail on any of the points below, please email support@tuflow.com "],["TwoDDomConstr-1.html", "Section 2 2D Domain Construction 2.1 Quadtree Updates (HPC Only) 2.2 Sub-Grid Sampling (SGS) Changes 2.3 Infiltration and Sub-Surface Flows 2.4 Modelling Bridge Structure in 2D 2.5 Advection Dispersion 2.6 Non-Newtonian Mixing 2.7 Minor Enhancements and Bug Fixes 2.8 2023-03-AB Minor Enhancements and Bug Fixes 2.9 2023-03-AC Minor Enhancements and Bug Fixes 2.10 2023-03-AD Minor Enhancements and Bug Fixes", " Section 2 2D Domain Construction 2.1 Quadtree Updates (HPC Only) The Quadtree mesh refinement functionality, added in the 2020-01 Release, allows the user to vary the resolution of a model using the HPC 2D Solver. The following enhancements have been included in the 2023-03 Release. 2.1.1 Support for Multiple GPU Multiple GPUs are supported for the 2023-03 Release when using a quadtree mesh. For the 2020 Releases, only a single GPU per simulation could be utilised when using quadtree refinement. The functionality for multiple GPUs with Quadtree is the same as for a standard (single resolution) HPC model. Device IDs can be specified in either the .tcf using the “GPU Device ID ==” command, or via the command line with -pu arguments. Device weightings can be specified with the “HPC Device Split ==” .tcf command (refer to Section 8.4 in the 2020 Release Notes). As per standard HPC (without Quadtree) if peer-to-peer GPU access is available between GPU cards, via either an NVLink or via a compatible PCIe configuration, then this is utilised by default. This can be disabled with the command: GPU Peer to Peer Access == DISABLED | {ENABLED IF AVAILABLE} Note: With newer generations of GPUs increasing the CUDA cores and memory, multiple GPUs simulations will realistically be only confined to very large models. 2.1.2 Support for Multiple Nesting GIS Layers The 2023-03 Release supports multiple 2d_qnl (nesting polygon) layers (i.e. multiple “Read GIS Nesting ==” commands in a single .qcf). Previously, TUFLOW would produce ERROR 2846 if more than one GIS nesting command was specified. The order that the GIS layers are specified does not matter; TUFLOW will read in all GIS layers before processing the mesh. The exception to this is for level one nesting polygons where TUFLOW will adopt the last level one polygon that is found. Previously if more than one level one nesting polygon was found, ERROR 2825 was produced. This has been changed to WARNING 2825 and TUFLOW will override the previous level one polygon. 2.1.3 Support “Trigger 1D” for Variable Z Shape The 2023-03 Release supports a “Trigger 1D” option for 2d_vzsh (variable Z shapes) to commence elevation updates based on the water level at a 1D node. The “Trigger 1D PF” can be used to trigger the elevation updates based on the progress of a 1D PF (Pipe Failure) channel. 2.2 Sub-Grid Sampling (SGS) Changes Sub-Grid Sampling (SGS) stores and uses curves representing the sub 2D cell terrain data of the DEMs, TINs and Z shapes used to construct the model instead of each 2D cell and each 2D face having one elevation. This functionality was first introduced in the 2020-01 Release, the following changes to SGS functionality have been included in the 2023-03 Release. 2.2.1 SGS Default Changes There have been several changes to the SGS defaults (if SGS is enabled with the .tcf command “SGS == On”) since the 2020-10 Release. These changes are listed in Table 2.1 and Table 2.2, discussed in the referenced sections. Table 2.1: Changes in SGS Defaults Command 2020 Default 2023 Default Section SGS Approach == Method B Method C Section 2.2.2 SGS Depth Output == Exact Cell Average Section 7.5.3 of the 2020 Release Notes SGS Map Extent \\(\\langle\\)Full or Trim\\(\\rangle\\) == SGS Map Extent Full == h SGS Map Extent Trim == ALL Section 7.5.4 of the 2020 Release Notes SGS Material == ON OFF Section 2.2.4 Table 2.2: Changes in HR Output Defaults Command 2020 Default 2023 Default Section HR Interpolation Approach == Method A Method C Section 2.2.5 HR Thin Z Line Output Adjustment == OFF ON CELL SIDES Section 2.2.6 2.2.2 SGS Approach For the 2023-03 Release “SGS Approach == Method C” is the default setting if SGS is enabled (SGS == ON). Method C was introduced as beta functionality in the 2020-10-AB Build. The previous default “SGS Approach == Method B” processed elevations into elevation-volume curves (for cells) and elevation-flow area/width curves (cell faces) after reading each elevation dataset. The sampled SGS elevations were discarded after processing the dataset for memory efficiency. Method C retains the SGS elevations in memory throughout the pre-processing stage and performs the generation of the curves only at the end of the pre-processing of all elevation data. Whilst this can potentially use more memory (CPU RAM) the approach has considerable benefits in terms of preserving sub-grid elevation data at cells/faces partially affected by terrain data layers and allows TUFLOW to produce high-resolution mapping at the SGS sampling resolution. See Section 3.7.2 in the 2020 Release Notes for details on the SGS Approach Method C. 2.2.3 Setting SGS Sampling Frequency For the 2023-03 Release, when using the SGS Approach Method C (which is the default for Release 2023-03 – refer Section 2.2.1), there are now several ways of setting the SGS sampling frequency. For the 2020-10 Release when using SGS Method C, the SGS Sample Frequency had to be set using the .tcf command “SGS Sample Frequency == \\(\\langle\\)number of sample locations per face\\(\\rangle\\)”. For the 2023-03 Release, in addition to this command, it is also possible to alternatively set a sampling target distance using the new .tcf command: SGS Sample Target Distance == \\(\\langle\\)distance in metres or feet\\(\\rangle\\) TUFLOW requires an odd number of sample locations across a cell face to ensure the mid-point is a sample point. The sampling frequency is calculated as the TUFLOW cell size divided by the target distance then rounded as per Equation (2.1). \\[\\begin{equation} \\text{Sample Frequency} = \\frac{\\text{TUFLOW Cell Size}}{\\text{Target Distance}} + 1 \\tag{2.1} \\end{equation}\\] For example, for a 10m TUFLOW model with a target distance of 1m, the sampling frequency is 11. Even numbers are rounded up to the next highest odd number. The sampling frequency adopted is reported in the .tlf. If neither “SGS Sample Frequency ==” or “SGS Sample Target Distance ==” is set, a scan of the Geometry Control File (.tgc) is performed to find the minimum raster grid resolution used in “Read Grid Zpt ==” commands, and this is used as the sampling target distance to compute the sampling frequency. If there are no gridded elevation datasets, a default sampling frequency of 11 is used. In summary, there are four ways for the SGS Sample Frequency to be defined; in decreasing order of priority they are: “SGS Sample Frequency ==” command. “SGS Sample Target Distance ==” command. Target distance automatically based on the minimum grid elevation resolution in the .tgc. Default Sampling Frequency of 11 per face / 121 per cell. Note: the sampling frequency is capped at 31 by default to avoid long pre-processing times and high memory usage. In general, a sampling frequency smaller than 31 is sufficient for most natural water ways or artificial structures, and users may not benefit from applying a super fine sample distance against the model cell size. However, if required, this upper limit can be increased by using the following tcf command: SGS Max Sample Frequency == \\(\\langle\\)maximum frequency\\(\\rangle\\) Note, a hard limit of 127 per face (16,129 samples per cell) still applies. 2.2.4 SGS Materials For the 2023-03 Release the sub-grid sampling of materials (land-use) has been disabled. This functionality was included in the 2020-10 Release as beta functionality, see Section 3.7.3 of the 2020 Release Notes. Feedback and further testing indicates that additional development is required. Some significant issues have been identified including the large dynamic range in face depths over which the look-up table must be computed, the transition between sheet flow and channel flow, and the inclusion of the effects of eddy viscosity or sub-grid turbulence on the parallel flow analysis. The latter issue in particular needs further research to provide consistency between different cell sizes. This feature is planned to be reinstated for an update to the 2023-03 Release once further research and benchmarking is completed. 2.2.5 High Resolution Interpolation Approach For SGS Method C, the high resolution (HR) raster map output can be output at finer resolution than the 2D model size. It is important to note that this is interpolating cell centre / corners data across the cell. For the 2023-03 Release enhancements have been made to the interpolation approach. Note: High resolution raster outputs are only available for depth (d) and water level (h) output data types. For the 2020-10 Release this was beta functionality, see Section 3.7.4 of the 2020 Release Notes, and the only approach available is described below as “Method A”. For models with traditional hydrology inflows, “Method A” generally produced effective HR maps. However, for models with very shallow flows (such as direct rainfall models), this could produce HR outputs with interpolation artefacts, as illustrated in Figure 2.1. Figure 2.1: Linear Corner Interpolation for High Resolution Water Level at Steep Slope “HR Interpolation Approach== Method B” improves this by introducing sheet flow checks when interpolating. “HR Interpolation Approach == Method C” uses the sheet flow checks and applies a weighting based on the number of wet SGS sampled locations in the cell. Some example HR outputs for a model with direct rainfall and a very coarse 2D cell size are presented in Figure 2.2 to Figure 2.4. “HR Interpolation Approach == Method C” is the default for the 2023-03 Release. Figure 2.2: HR Interpolation Approach == Method A Figure 2.3: HR Interpolation Approach == Method B Figure 2.4: HR Interpolation Approach == Method C (new default) 2.2.6 High Resolution Thin Breaklines When applying thin breaklines only the cell side and cell corner elevations are modified. For models with thin breaklines and HR outputs, the presence of breaklines can be used to affect the HR interpolation. A new .tcf command has been introduced to control this: HR Thin Z Line Output Adjustment == OFF | {ON CELL SIDES} | ON ALIGNMENT The three options provided are: OFF – Thin breaklines do not affect the HR raster interpolation ON CELL SIDES – This prevents interpolation across cell sides that have thin breaklines. ON ALIGNMENT – The location of the breakline within the TUFLOW cell resolution is stored and stops interpolation occurring over this topographic barrier. “HR Thin Z Line Output Adjustment == ON CELL SIDES” is the default for the 2023-03 Release as this is consistent with the computational location which the topographic barrier is applied. Example outputs from a model with a thin breakline are shown in Figure 2.5 to Figure 2.7 for all three options. Figure 2.5: HR Thin Z Line Output Adjustment == OFF Figure 2.6: HR Thin Z Line Output Adjustment == ON CELL SIDES (new default) Figure 2.7: HR Thin Z Line Output Adjustment == ON ALIGNMENT 2.2.7 Parallel Processing for SGS initialisation As noted in Section 2.2.2, SGS Method C (the default if “SGS == On”) retains the SGS elevations in memory throughout the pre-processing stage and performs the generation of the curves only once at the end of the pre-processing. This is a computationally intense exercise, particularly for large models with small SGS sample distances. To speed up model initialisation, this has been configured to utilise multiple CPU cores. By default, all CPU threads will be used for final SGS elevation pre-processing unless the number of threads (-nt[thread count]) command line argument has been specified. For example, to run on 8 threads the command line argument “-nt8” would be used. There is no check for thread licensing used for pre-processing. If the number of threads specified in the command line argument exceeds the number of threads available all threads are used. See also computational and clock time updates in Section 8.8. 2.2.8 XF Files for SGS Method C In addition to the parallelisation of the final SGS elevation pre-processing (described in Section 2.2.7), XF files are now supported for SGS Method C. At the end of the .tgc reading, after all elevation datasets have been processed, an XF file is written if the “XF Files ==” command is set to on (default). The XF file is written to an “xf” folder which sits in the same location as the .tgc. To avoid re-processing when changes are made to .tgc data other than elevation (e.g. active cells, materials, soils, etc.), the XF file is not written with the same filename as the .tgc. Instead, the .xf will be prefixed by “hpc” or “qdt” for HPC and Quadtree simulations respectively and includes the nesting level, cell size. Any text set with the .tcf command “XF Files Include in Filename ==” is included. When reading the pre-processed SGS XF file, a check is done on the final SGS elevations, if these are consistent then the XF file is used. A fix was made to the XF file access check in the 2023-03-AD Build, see Section 8.4.1. 2.2.9 Enhancement for SGS Parameterisation The 2023-03-AD build implements some enhancements for the SGS Parameterisation. Most of the changes are targeted at models that use the hydraulic radius to calculate the bed friction (“SGS Radius Approach == Hydraulic”). Note, this is not the default setting. Some of the changes can cause minor differences in simulation results for SGS models regardless of SGS Radius Approach. 2.2.9.1 Enhancement in SGS Parameter Fitting The 2023-03-AD release improves the SGS parameter fitting process at the cell faces. The improvements include: Better initialisation for the SGS parameters used to calculate the wetted perimeter vs height relationship. Improvements to the iteration process to minimise the fitting error. Models using the default hydraulic resistant approach (“SGS Radius Approach == Resistance”) are not affected by the first change related to the parameter initialisation. However, the second change in fitting iteration can cause minor changes in the SGS parameters for a very limited number of cells, and thus result in marginal difference in modelling results for SGS models. These changes are considered to be bug fixes, and therefore no backward compatibility is provided. Also due to the changes above, the SGS XF file version has been increased, and a new SGS XF file will be automatically generated when running models with Build 2023-03-AD. 2.2.9.2 Enhancement of Hydraulic Radius Implementation The 2023-03-AD build improves the implementation of hydraulic radius for SGS models. When “SGS Radius Approach == Hydraulic” was used to calculate the bed friction prior to the 2023-03-AD build, TUFLOW could underestimate the flow resistance for steep-sided narrow channels. The new approach improves the hydraulic radius implementation to address this issue, and can be activated by using the following command: “SGS Hydraulic Radius == Method B” Note the default approach is “Method A” for backward compatibility. The models using the default hydraulic resistant approach are not affected by this change 2.2.10 Enhancement of Water Level Interpolation at BC Cells with Steep Bed Slope Prior to the 2023-03-AD build, SGS models could generate a slight error in water level at boundary cells with steep bed slopes. This was caused by the HPC solver inadvertently using 1st order spatial interpolation at the boundary cell, while applying 2nd order spatial interpolation everywhere else. This issue can be addressed in the 2023-03-AD build by applying the following command: SGS 2nd Order BC Slope == Method B Note that this issue only occurs at BC cells with steep bed slopes (e.g. &gt; 0.01), and doesn’t affect most real-world model boundaries. Therefore, ‘Method A’ (the original method) remains the default approach for backward compatibility. 2.3 Infiltration and Sub-Surface Flows 2.3.1 Overview The 2023-03 Release permits horizontal flow of the water within the cumulative infiltration layer. Up to 10 vertical layers are supported, each with horizontal advection and vertical filtration from above. Movement of water within the ground in the real world is complex. The functionality introduced in the 2023-03 Release is not intended to replace detailed groundwater modelling, but provides a functional mechanism by which: Catchment response for 2D direct rainfall (“rain on grid”) models can be better calibrated to available river flow data. Long-term catchment models can be constructed that offer some prediction of stream flows long after rainfall events. The accuracy of real-time flood forecasts can be improved by taking into account the drying and draining of catchments that has occurred since the last rainfall event. Sub-surface seepage can cause inundation, such as seepage under a levee bank through a porous layer (e.g., old gravel river course), resulting in flooding on the protected side of the levee. The basic concept is that of dividing the ground into vertical layers, each with a defined thickness (alternatively a z elevation for the bottom of the layer), soil type, and cumulative infiltration. The cumulative infiltration, combined with the porosity defined by the soil type, allows a theoretical “ground water elevation” (also known as a “water table”) to be computed within the layer as shown in Figure 2.8. Figure 2.8: Interflow Concept The vertical (or “convective”) flow of water from the surface water layer into the first (or top) ground water layer (also referred to as the interflow layer) is governed by the soil type infiltration model. The soil types in the top most layer must be one of those defined in Section 6.10 of the 2018 TUFLOW Manual. For layers below the first layer the vertical flow of water, \\(Q^{z}\\), is computed using a “convective” hydraulic conductivity (effectively the same concept as continuing loss): \\[\\begin{equation} Q^{z} = - kdxdy \\tag{2.2} \\end{equation}\\] Where: \\(k\\) is the convective hydraulic conductivity \\(dxdy\\) is the cell area This has required the addition of a new soil type “CO” for layers below the interflow layer. The horizontal advection of water from one cell to the next, \\(Q^{h}\\), is computed using the horizontal hydraulic conductivity of the soil and the horizontal gradient of a variable called the “ground water pressure level”: \\[\\begin{equation} Q^{h} = - k_{h}hp\\frac{de}{dx}dy \\tag{2.3} \\end{equation}\\] Where: \\(k_{h}\\) is the horizontal hydraulic conductivity of the soil (average of the left and right cells used) \\(h\\) is the physical depth of water in the upstream cell (i.e. the ground water elevation less the layer bottom elevation) \\(p\\) is the soil porosity \\(\\frac{de}{dx}\\) is the gradient of the “ground water pressure level” \\(dy\\) the width of the face. For cells that are “unsaturated” the “ground water pressure level” is exactly the ground water elevation within that layer. For cells that are fully saturated, the ground water pressure level is that of the cell in the next layer above (or the water surface elevation if the next layer above is the surface layer). For cells that are “nearly saturated” the ground water pressure level is transitioned between these two options. The threshold at which the transition begins is called the “ground water blending threshold” (refer Section 2.3.8), \\(\\phi\\). \\[\\begin{equation} \\xi = \\frac{\\frac{h}{dz} - \\phi}{(1 - \\phi)} \\tag{2.4} \\end{equation}\\] \\[\\begin{equation} e_{i} = (1 - \\xi)\\left( z_{i} + h_{i} \\right) + \\xi e_{i - 1} \\tag{2.5} \\end{equation}\\] \\[\\begin{equation} e_{0} = {WSE}_{surface} \\tag{2.6} \\end{equation}\\] Where: \\(h\\) is the depth of ground water in the cell \\(dz\\) the vertical thickness of the layer \\(z_{i}\\) the layer bottom elevation \\(e_{i}\\) the resulting ground water pressure level for the layer The layer ordering is such that the surface water layer is “0”, the interflow layer is “1”, and any additional ground water layers range from 2 to N, from top to bottom. If the sum of flows into a layer cell causes it to exceed its soil capacity, the excess is push upwards to the next layer. If this happens for the top-most interflow layer, the excess is pushed into the surface water layer as a “return flow”. This is to be expected in the creek beds but may also happen at the bottom of steep hills where the slope transitions from steep to shallow. Although the above theory appears complex, the implementation within a TUFLOW model is straight forward. The essential steps are: Read a soils (.tsoilf) data file from within the .tcf Define layer thicknesses and soil types in the .tgc Specify locations of groundwater boundaries Add any additional output data types int the .tcf These steps are explained in more detail in the following sections. 2.3.2 Soils File The soils file (.tsoilf) may now include a new column of data for the horizontal hydraulic conductivity of the soils. If omitted, or if all soils used in the model have zero horizontal hydraulic conductivity, then horizontal advection of water will not be considered in the model. Additionally, a new soil type “CO” is required for any layers below the first (i.e. top or interflow) layer. The data columns for CO soils are detailed in Table 2.3. Reading the .tsoilf file is the same as in previous Releases with the .tcf command “Read Soils File ==”. Table 2.3: .tsoilf Parameters Column No No Infiltration Green-Ampt Green-Ampt Horton Initial / Continuing Loss Convective 1 Soil ID Soil ID Soil ID Soil ID Soil ID Soil ID 2 NONE GA GA HO ILCL CO 3 USDA Soil Type (see Table 6-14) Suction (mm or inches) Initial Loss (mm or inches) Initial Loss (mm or inches) Hydraulic Conductivity (mm/h or in/h) 4 Initial Moisture (Fraction) Hydraulic Conductivity (mm/h or in/h) Initial Loss Rate (f0) (mm/h or in/h) Continuing Loss (mm/h or in/h) Porosity (Fraction) 5 Max Ponding Depth (m or ft) Porosity (Fraction) Final Loss Rate (fc) (mm/h or in/h) Porosity (Fraction) Initial Moisture (Fraction) 6 Horizontal Hydraulic Conductivity (mm/h or in/h) Initial Moisture (Fraction) Exponential Decay Rate (k) (h-1 ) Initial Moisture (Fraction) Horizontal Hydraulic Conductivity (mm/h or in/h) 7 Max Ponding Depth (m or ft) Porosity (Fraction) Horizontal Hydraulic Conductivity (mm/h or in/h) 8 Horizontal Hydraulic Conductivity (mm/h or in/h) Initial Moisture (Fraction) 9 Horizontal Hydraulic Conductivity (mm/h or in/h) 2.3.3 TGC Commands Setting Soil Type Setting the soil type for an interflow layer activates the given layer. For example, setting the soil type for interflow layers 1 and 2 will activate 2 vertical interflow layers: Set Soil Layer 1 == 1 ! soil ID of infiltration layer e.g. GA type Set Soil Layer 2 == 5 ! soil ID of a convective layer e.g. CO type Multiple layers can be set simultaneously (the below will activate 3 interflow layers): Set Soil Layer 1 == 1 Set Soil Layer 2,3 == 5 ! sets both layers 2 and 3 to Soil ID 5 This method also works for read GIS and GRID commands: Read GIS Soil Layer 1 == /path/to/file Read GRID Soil Layer 2 == /path/to/file A maximum of 10 vertical layers is permitted and a soil ID should be assigned for each active layer. For example, if interflow layer 2 is active, then soil IDs for layer 1 should be assigned. Note, if the layer number is not specified, it is assumed to be layer 1. Setting Vertical Layer Depths The depth (thickness) of each vertical interflow layer can be set using the following commands: [Set | Read GIS | Read GRID] Soil Thickness Layer N == [value | /path/to/file] [Set | Read GIS | Read GRID] Soil Base Elevation Layer N == [value | /path/to/file] If the soil layer thickness or base elevation is not set for a given layer, it is assumed to be infinite. The soil thickness sets the layer depth from the layer above and soil base elevation sets the absolute elevation of the bottom of the layer. If both methods are specified for a given grid cell, the highest of the two will be adopted. The input units should be in metres or feet. Setting Initial Conditions The initial water level in the interflow layers can also be set via the .tgc using the following commands: [Set | Read GIS | Read GRID] IGW Depth Layer N == [value | /path/to/file] [Set | Read GIS | Read GRID] IGW Level Layer N == [value | /path/to/file] “IGW Depth” is assumed to be the depth of water in the soil (water content divided by porosity). “IGW Level” is assumed to be the level of the water table in each layer. If both methods are specified for a given grid cell, the highest initial condition will be adopted. The input units should be in meters or feet. Note, the initial conditions do not automatically cascade into layers below (i.e. setting the initial water level in the top layer will not automatically set the layers below to be 100% saturated). Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf. 2.3.3.1 Bug Fix for Soil Inputs with XF OFF Build 2023-03-AC fixes a bug when reading a soil layer input and using “XF OFF” (e.g. Read GRID Soil XF OFF == soil.tif). For previous 2023-03 releases, this would cause “ERROR 2579 - Unrecognised command after …” due to additional syntax checking that TUFLOW was undertaking for the new soil commands. 2.3.4 Boundaries At the edge of the active model, two boundary conditions are currently supported: Sealed boundary, no inflow or outflow; and Groundwater level vs time. To specify a groundwater level vs time boundary, a new “GT” type boundary line can be digitised in the 2d_bc file format. This is read into the boundary control file (.tbc) with the “Read GIS BC ==” command. The same groundwater level boundary applies to all vertical layers. If the specified groundwater level is below the elevation at the bottom of the layer, it is dry. If the specified groundwater level is above the elevation at the top of the layer, it is fully saturated. 2.3.5 Groundwater Map Outputs The previous soil layer output data types have been kept, but note that: IR (infiltration rate) will only be reported for the first (top) layer. Reported in mm/hr or in/hr. CI (cumulative infiltration) map output is restricted to models for which the value is indeed cumulative. Specifically, this means only models that have: A single vertical soil layer No horizontal movement of ground water No drying of the soil layer through negative rainfall (Soil Negative Rainfall Approach == None). This is the default approach. For these models the CI output is the “current” water content of the layer (in terms on mm/in of pure liquid), as no water is leaving the soil layer this also represents the cumulative infiltration value. Reported in mm or inches. However, when any of the three options (multiple vertical layers, horizontal movement or negative rainfall) can reduce the groundwater moisture the water content in the layer is no longer a “cumulative value” so output is not available. dGW (depth to groundwater) will be reported for all layers. It is the distance from the ground surface to the ground water level of the layer in question. Reported in m or ft. The new output variables are: GWd (groundwater depth), depth of water for each layer (is cumulative infiltration divided by porosity). Reported in m or ft. GWh (groundwater level), elevation of ground water surface (water table) for each layer. Reported in m or ft. In Build 2023-03-AB, ground water level (GWh) output will now report -99999 on a layer with undefined bed level. GWm (groundwater moisture), dimensionless number in range 0 - 1 representing “fraction full” for each layer. GWq (groundwater unit flow), vector data for the unit flows within each layer. Reported in m2/hr or ft2/hr. Build 2023-03-AB has changed groundwater unit flow units to m2/s or ft2/s. GWv (groundwater velocity), vector data for the velocity within each layer. Reported in m/hr or ft/hr. Build 2023-03-AB has changed groundwater velocity units to m/s or ft/s. 2.3.6 Groundwater Plot Outputs New plot output types have been added to record results from the interflow layers. The following types have been added: PO point: GWd (groundwater depth), depth of water for each layer (is cumulative infiltration divided by porosity), reported in m or ft. GWh (groundwater level), elevation of ground water surface (water table) for each layer, reported in m or ft. GWm (groundwater moisture), dimensionless number in range 0 - 1 representing “fraction full” for each layer. GWq (groundwater unit flow), unit flow magnitude within each layer, reported in m2/hr or ft2/hr. Build 2023-03-AB has changed groundwater unit flow units to m2/s or ft2/s. GWqu (groundwater unit flow u-component), unit flow u-component within each layer, reported in in m2/hr or ft2/hr. Build 2023-03-AB has changed groundwater unit flow units to m2/s or ft2/s. GWqv (groundwater unit flow v-component), unit flow v-component within each layer, reported in in m2/hr or ft2/hr. Build 2023-03-AB has changed groundwater unit flow units to m2/s or ft2/s. GWqa (groundwater unit flow angle), angle of unit flow vector within each layer. Reported in degrees clockwise from north (i.e. a compass bearing). CI (cumulative infiltration) represents the current water content of each layer (mm or in of pure water). This value may increase or decrease depending on the flows into and out of the cell. It is no longer a “cumulative value”. Reported in mm or in. PO line: GWQ (groundwater flow), total flow passing through the given line within each layer. The positive flow convention is left to right looking downstream (same as the ‘Q_’ PO type). Reported in m3/s or ft3/s. PO region: GWVol (groundwater volume), total volume of water within the polygon for each layer. Reported in m3 or ft3. 2.3.7 Groundwater and Advection Dispersion Tracking of advection dispersion constituents when using groundwater layers is supported when running HPC solver. Advection-dispersion is not yet supported in Quadtree. Refer to Section 2.5.3 for commands for setting initial concentrations for sub-surface layers. No dispersion is modelled in the sub-surface layers. Build 2023-03-AD fixes a bug introduced in the 2023-03-AC build, which prevented the tracer in the surface water from infiltrating into the groundwater layers. 2.3.8 Groundwater Blend Threshold Described in Section 2.3.1, when a soil is nearly saturated, the level is transitioned from the level in the current layer to the layer above, as this avoids a sudden change in level as the soil reaches capacity. A “groundwater blend threshold” is used to control this, this threshold has a default value of 0.9, meaning that once a soil exceeds 90% of a soil capacity, the level starts to transition to the level in the layer above. This may be overridden with the .tcf command: GW Blend Threshold == &lt;float&gt; | {0.9} Note that its value must be in range 0 - 0.99. 2.3.9 Initial Moisture and Green-Ampt Infiltration The treatment of initial moisture with the 2023-03 Release is different to the 2020 Releases. For the 2020 Release, a soil capacity was calculated by subtracting the initial moisture fraction from the porosity. This was done to reduce the memory requirements by storing soil capacity instead of both porosity and initial moisture. For the interflow functionality, reducing porosity does not work as both porosity and initial moisture are required to allow a soil to drain correctly. For the 2023-03 Release, both soil initial moisture and porosity are stored. These approaches can produce different results when using the Green-Ampt method. If “Defaults == Pre 2023” is specified, then the previous approach is used. This is only valid if one vertical soil layer is specified. 2.3.10 Improvements in Reading Soil File (.tsoilf) Build 2023-03-AB changes the way that the .tsoilf is read to better handle blank or non-numeric values in columns. Prior to the 2023-03-AB build, TUFLOW would stop reading a line from the .tsoilf at the first column which did not contain numeric values (including blank or text data). This could mean that data in subsequent columns was ignored. For the 2023-03-AB build, each column is processed independently. Extra soil information is now output to the log file. 2.3.11 Bug Fix for Infiltration and Advection Dispersion Build 2023-03-AC fixes a bug which could occur when using both soil infiltration and Advection-Dispersion and only affected the HPC solver. This issue could occur if the model has bounced, and this could cause a negative tracer concentration to be generated. This negative concentration could then propagate into the soil layers. The 2023-03-AC build prevents this from occurring and minor differences in models with soil infiltration and Advection-Dispersion may occur. No backwards compatibility is provided. 2.4 Modelling Bridge Structure in 2D 2.4.1 CFD Benchmarking Study A joint research study between the Queensland Department of Transport and Main Roads (DTMR) and TUFLOW regarding modelling bridge decks that are surcharged, under pressure flow or drowned out, as shown in Figure 2.9, is in progress. This work has involved 2D CFD modelling of a common deck and rails bridge geometry, full scale measurements of a similar bridge under flood, and 3D CFD modelling of the same. Current results have been published (Collecutt et al., 2022), though a brief summary is presented here. Figure 2.9: 2D CFD modelling of deck and rail bridge Numerous 2D CFD models indicated that a generalised form for loss coefficient vs downstream water level above the soffit of the deck, TW, was possible, shown in Figure 2.10 for the case where the under-deck height to bed, hb, was 4 times the deck thickness, T. Figure 2.10: Generalised loss coefficient from 2D CFD modelling of bridge deck and rails A full-scale bridge was gauged and the afflux recorded during a significant overtopping event in February 2022. 3D CFD models of the same bridge and surrounds were run, with reasonable agreement as shown in Figure 2.11. Further, the shape of the results appears very similar to that of the generalised 2D results shown in Figure 2.10. Figure 2.11: Full scale afflux measurements and 3D CFD model results for deck and rail bridge A layered loss model was implemented in TUFLOW HPC as per Section 2.4.2, and a 2D HPC model of the bridge and surrounds was run. The results, shown in Figure 2.12, were in excellent agreement with the measured data. Figure 2.12: TUFLOW HPC afflux results for deck and rail bridge using new 2d_bg layer 2.4.2 New Input Layer for Modelling Bridge Structure in 2D The 2023-03 Release introduces the new BG Shape input layer (2d_bg) to set up bridge structures in 2D domain. The new input layer is read in using the .tgc command “Read GIS BG Shape ==”. The new method is similar to the Method D layered flow constriction approach introduced in the 2020‑10 Release (Section 3.4.2 of the 2020 Release Notes), with the GIS layer attributes tidied up for easier user input. The three layers are now called the “pier layer”, the “deck layer” and the “rail layer” for clarity. The new attributes are: ID = Unique bridge ID. Option = Reserved for future use. Pier_pBlockage = The percentage blockage of the pier Layer. For example, enter ‘5’ for a blockage of 5%. Pier_FLC = Pier layer form loss coefficient. Deck_Soffit = The elevation of the bridge soffit (m or ft). Deck_Depth = The thickness of the bridge deck (m or ft). Deck_Width = The bridge width in the predominant direction of flow (m or ft). Deck_pBlockage = The percentage blockage of the deck layer. Enter ‘100’ for a solid bridge deck obstruction. Rail_Depth = The depth of the rail layer (m or ft). Rail_pBlockage: The percentage blockage of the rail layer. SuperS_FLC: The combined form loss coefficient for the deck and the rail layers. Two layers are treated as a single “super structure” layer in this new bridge method. SuperS_IPf: A factor to set the elevation of the inflection point (IP) at which the transition from pressure flow to drowned flow commences. The default value is 1.6. Cf: A calibration factor used to adjust the automatically generated FLC (default = 1.0). See Section 2.4.3. The 2d_bg layer adjusts the FLC value in the vertical as follows: \\[\\begin{equation} {FLC}_{total} = \\left( {FLC}_{pier} + {FLC}_{SuperS}\\frac{y_{SuperS}}{D_{IP}} \\right)\\frac{(y_{pier} + y_{SuperS})}{y_{total}} \\tag{2.7} \\end{equation}\\] With: \\[\\begin{equation} y_{SuperS,max} = D_{IP} \\tag{2.8} \\end{equation}\\] \\[\\begin{equation} y_{pier,max} = D_{peir} \\tag{2.9} \\end{equation}\\] Where: \\(y_{SuperS}\\) = Depth of water above the bridge soffit in the super structure layer. \\(D_{IP}\\) = Depth to the inflection point from the bridge soffit. \\(y_{pier}\\) = Depth of water in the pier layer. \\(D_{peir}\\) = Depth to the pier layer, i.e. the vertical distance from the bed level to the bridge soffit. \\(y_{total}\\) = Total depth of water from the bed to the water surface level The vertical distribution of the form loss coefficient has the following characteristics: Water level below the deck layer: The same result as the 2d_lfcsh approaches, i.e. a constant form loss based on that specified for the pier layer (\\({FLC}_{pier}\\)) is applied. Water level between the deck soffit and the inflection point: The FLC value is linearly increased from \\({FLC}_{pier}\\) to \\({FLC}_{pier}\\) + \\({FLC}_{SuperS}\\) (the combined form loss coefficient for the superstructure layer). The observations from the CFD and the field measurement indicate the inflection point is located around 1.6 times the bridge deck depth (\\(D_{Deck}\\)) above the bridge soffit. The “Inflection Depth” (\\(D_{IP}\\)) is assumed as: \\[\\begin{equation} D_{IP} = SuperS_{IPf}\\left( D_{Deck}{Blockage}_{Deck} + D_{Rail}{Blockage}_{Rail} \\right) \\tag{2.10} \\end{equation}\\] Note that the effect of partial blockage at the rail layer is considered by adding the rail layer depth (\\(D_{Rail}\\)) to the inflection depth proportionally based on the rail layer blockage (\\({Blockage}_{Rail}\\)). Above the inflection point the FLC gradually reduces with increasing depth (in a similar manner to the 2D Layered Flow Constrictions PORTION and METHOD C approaches), shown in Figure 2.13. This is to simulate the transition to drowned flow and tendency to zero energy losses with increasing depth over the bridge deck. Figure 2.13: 2D BG Shape Attributes and Vertical Distribution of Form Loss Coefficient In addition to the above method, build 2023-03-AD introduces three more methods to calculate the depth averaged FLC: BG FLC Default Approach == [ {LINEAR} | LINEAR-CONSTANT | PARABOLIC | INVERTED-PARABOLIC ] LINEAR: the default option introduced above. The depth averaged FLC value is linearly increased from the bottom of the bridge deck to the inflection point. After the inflection point it gradually reduces. LINEAR-CONSTANT: the depth averaged FLC is linearly increased from the bottom of the bridge deck to the top of the bridge deck. Between the top of the bridge deck and the inflection point, the FLC is kept constant. After the inflection point it gradually reduces. PARABOLIC: the depth averaged FLC is increased using a parabolic function from the bottom of the bridge deck to the inflection point. After the inflection point it gradually reduces. INVERTED-PARABOLIC: the depth averaged FLC is increased using an inverted parabolic function from the bottom of the bridge deck to the inflection point. After the inflection point it gradually reduces. The vertical profiles of the depth averaged FLC values applied by the four methods are illustrated in the Figure 2.14. Figure 2.14: Depth averaged FLC applied by 4 bridge FLC approaches Other key features of the BG layer are: The BG layer does not apply geometry updates. This not only offers simplicity, but also is a desirable option considering that the size of TIN polygons used to modify the bridge bed elevations are often different from the size of polygon used to select BG cell faces. For a line layer a “Deck_Width” value of zero sets the layer as a thin line. It selects one row of faces in the direction of flow, and the FLC value is applied to the faces unchanged. A “Deck_Width” value larger than zero sets the layer as a thick line that selects a whole cell, i.e. two faces in the direction of flow. The FLC values at the faces are divided by two. The wide line feature is not supported by the BG layer. Note, BG polygon shapes are recommended if more than 3 rows of faces must be selected. For a polygon layer, the “Deck_Width” defines the bridge width in the predominant direction of flow. This value is used to distribute the total FLC value to the selected faces, i.e.: \\[\\begin{equation} {FLC}_{face} = \\frac{FLC} {Deck\\_Width} * Cell\\ Size \\tag{2.11} \\end{equation}\\] This means users no longer need to convert the FLC value to “form loss per metre”, which is required by the 2D Layered Flow Constrictions polygons. Note: Build 2023-03-AB caps “Cell Size / Deck_Width” at 1. Previously, a face FLC larger than the original FLC was incorrectly applied when the model cell size is larger than the Deck_Width defined. The point only layer (2d_bg_pts) is also supported. This layer can be used to spatially vary the bridge soffit, the deck depth, and the rail depth. The attributes for this layer include: Deck_Soffit = The elevation of the bridge soffit (m or ft). Deck_Depth = The thickness of the bridge deck (m or ft). Rail_Depth = The depth of the rail layer (m or ft). R1 ~ R3: Reserved for future use. 2.4.3 Automatic Generation of Superstructure FLC Build 2023-03-AC implemented a new feature to automatically generate the superstructure FLC value based on the CFD benchmarking study (Collecutt et al., 2022). This feature has been further developed in build 2023-03-AD. Blank BG FLC Approach == [ {NONE} | METHOD A | METHOD B ] NONE: the default approach, i.e. Superstructure FLC must be specified manually. METHOD A: The blank superstructure FLC values will be calculated based on the ratio of the depth of the pier layer (\\(D_{Pier}\\) in the equations above) and the thickness of the super structure layer: \\[\\begin{equation} T_{SuperS} = D_{Deck}{Blockage}_{Deck} + D_{Rail}{Blockage}_{Rail} \\tag{2.12} \\end{equation}\\] Build 2023-03-AD fixed a bug where ‘SuperS_IPf’ was used in the calculation of \\(T_{SuperS}\\). METHOD B: The blank superstructure FLC values will be calculated based on the ratio of the depth of the pier layer (\\(D_{Pier}\\)) and the thickness of the deck layer: \\[\\begin{equation} T_{SuperS} = D_{Deck}{Blockage}_{Deck} \\tag{2.13} \\end{equation}\\] With Method A and B, the superstructure FLC value is linearly interpolated within the \\(D_{Pier}\\)/\\(T_{SuperS}\\) range of 1~10 and capped at 0.6 and 0.16 outside this range, as shown in the Figure 2.15. Figure 2.15: CFD benchmarking study of FLC vs \\(D_{Pier}\\)/\\(T_{SuperS}\\) ratio (\\(h_{B}\\)/\\(T\\) in the original paper) Build 2023-03-AD introduces a calibration factor (the 2d_bg ‘Cf’ attribute) that is applied as a multiplier to the automatically generated superstructure FLC. 2.4.4 Grouped Structure Output The new 2d_bg layer can be used with 2D plot output structure group outputs (2d_po ‘QS’ type) in the same manner as the 2D Layered FC Shape input (2d_lfcsh). 2.5 Advection Dispersion 2.5.1 HPC Support for Multiple Constituents Per Simulation When using the HPC solver it is now possible to run up to 20 advection-dispersion constituents in a single simulation. This is the same limit as when running advection-dispersion with the Classic solver. Prior to the 2023-03 Release if running advection-dispersion with HPC only a single constituent could be modelled. Advection-dispersion is currently not supported in the Quadtree module. 2.5.2 HPC Support for Constituent Settling and Decay For the 2023-03 Release the HPC solver supports the ability to model constituent settling and/or decay. This functionality is detailed in Section 4.6 of the TUFLOW AD Manual. 2.5.3 Layered Interflow - Advection Dispersion TGC Commands Initial concentrations can be set within the groundwater layers using the following .tgc commands (note, not done in the AD Control File): [Set | Read GIS | Read GRID] IGW Conc Layer N1,N2,..N Tracer M1,M2,..M == [value | /path/to/file] Where: N = The groundwater layer number (able to reference multiple in a single command) M = The tracer number (able to reference multiple in a single command) as ordered in the AD Global Database If a layer number is not referenced, it is assumed to apply to layer 1. Likewise, if a tracer number is not referenced it is assumed to apply to the first tracer. Note, the order that ‘Layer’ and ‘Tracer’ appear in the command does not matter (i.e. tracer numbers could be listed before layer numbers). 2.6 Non-Newtonian Mixing Non-Newtonian viscosity formulation was introduced, for a uniform fluid, in the 2020-01-AA Release. This has now been extended to consider mixing of the non-Newtonian fluid with water. To implement this, a passive tracer must be included in the model, requiring a license for the advection-dispersion (AD) module. The AD setup is the same as detailed in the TUFLOW AD Manual. More than one tracer field is permissible, but the non-Newtonian mixing module will assume that the first tracer represents the fraction of non-Newtonian fluid, in the range 0 to 1. Care must be taken to ensure that boundary data and initialisation commands strictly adhere to this range. Where the tracer value is 1, the properties of the fluid will be exactly the non-Newtonian properties as specified with Viscosity Coefficients command. For tracer values between 0 and 1, the non-Newtonian properties are transitioned using power-law equations for the three variables in the Hershel-Bulkley equation. \\[\\begin{equation} \\xi = a^{m} \\tag{2.14} \\end{equation}\\] \\[\\begin{equation} \\rho&#39; = (1 - a)\\rho_{w} + a\\rho_{NN} \\tag{2.15} \\end{equation}\\] \\[\\begin{equation} K&#39; = (1 - a^{m})\\nu_{w} + a^{m} K_{NN} \\tag{2.16} \\end{equation}\\] \\[\\begin{equation} n&#39; = (1 - a^{o})1.0 + a^{o} n_{NN} \\tag{2.17} \\end{equation}\\] \\[\\begin{equation} \\tau_{0}&#39; = a^{p}\\tau_{0,NN} \\tag{2.18} \\end{equation}\\] Where: \\(a\\) = the tracer value (0~1) \\(m\\) = the non-Newtonian mixing exponent for the viscosity parameter \\(o\\) = the non-Newtonian mixing exponent for the power law parameter \\(p\\) = the non-Newtonian mixing exponent for the yield stress \\(\\rho\\) = density of fluid (kg/m3) \\(\\nu\\) = kinematic viscosity (m2/s) \\(K\\) = the Hershel-Bulkley viscosity parameter (Pa sn) \\(n\\) = the Hershel-Bulkley power law exponent \\(\\tau_{0}\\) = the material yield stress (Pa) and subscripts \\(w\\) denotes water, \\(NN\\) denotes pure non-Newtonian fluid. In the 2023-03-AA and 2023-03-AB builds, only one non-Newtonian mixing exponent was allowed for. The 2023-03-AC build allows for three mixing exponents m, o, p, to be specified. Alternative, if only one mixing exponent is specified, that value is used for all three exponents. The bed fraction and 2D viscosity are computed using the non-Newtonian method with the blended parameters The bed friction is then limited to be no less than that predicted from Manning’s equation, and the 2D viscosity is limited to be no less that that predicted from the Wu viscosity formulation with 3D and 2D coefficients of 7 and 0 respectively. To utilise non-Newtonian mixing in a model, the following is required: Select the non-Newtonian viscosity formulation and specify the coefficients for pure non-Newtonian fluid: Viscosity Formulation == Non-Newtonian Viscosity Coefficients == k, n, muLow, muHigh, tau0 Include a passive tracer as per standard AD setup (refer to the TUFLOW AD Manual), making sure boundary data and initialisation are scaled in range 0 to 1. Specify the mixing exponents, m, o, and p to be used: Non-Newtonian Mixing Exponent == &lt;float&gt; | {0} ! used for all three of m, o, p exponents Non-Newtonian Mixing Exponent == &lt;float&gt;, &lt;float&gt;, &lt;float&gt; | {0, 0, 0} ! m, o, p exponents Note that if the non-Newtonian mixing exponent is not specified it defaults to zero which turns the mixing formulation off, and all fluid in the model will be treated as non-Newtonian regardless of tracer value. 2.7 Minor Enhancements and Bug Fixes 2.7.1 Fix to Memory Efficient Quadtree Meshing Algorithm The 2023-03 Release fixes a bug that could occur when using the .qcf command: Quadtree Mesh Processing Method == Memory Efficient Previously, when there were barely overlapping hidden domains (generated as part of the meshing algorithm) that only just overlapped by one or two cells in the top left corner, sometimes the order of the domains would cause cells to be deactivated incorrectly. This would cause holes in the final generated quadtree mesh. 2.7.2 Duplicate Material IDs When reading in materials files, in either .tmf or .csv, the 2023-03 Release handles duplicate material IDs differently. For the 2023-03 Release duplicate material IDs will now override previous values. This includes if the material ID is contained in the same material file or different material file. Overwriting duplicate data is more consistent with other processing in TUFLOW. WARNING 2564 is issued each time a duplicate ID is encountered. Previously if a duplicate material ID was found, it would be discarded with WARNING 2481. 2.7.3 Duplicate Soil IDs Similar to the duplicate material ID change above, when reading soils files (.tsoilf) duplicate soil IDs will now override previous values in the 2023-03 Release. This includes if the soil ID is contained in the same soil file or different soil file. Overwriting duplicate data is more consistent with other processing in TUFLOW. WARNING 2500 is issued each time a duplicate ID is encountered. 2.7.4 Check Added for Valid Non-Newtonian Coefficients A check has been added if Non-Newtonian formulation has been specified without valid Non-Newtonian coefficients. For build 2023-03-AA onwards ERROR 2572 will be generated if no or invalid coefficients have been specified. 2.7.5 ERROR Message for Overlapping Layered Flow Constriction Shape and 2D Bridge Shape Build 2023-03-AA produces ERROR 2467 when an overlapping Layered Flow Constriction Shape or 2D Bridge Shape is detected. Previously, all the duplicated Layered Flow Constriction Shapes have been processed during the cell side form loss calculation. For TUFLOW Classic, the last read Layered Flow Constriction Shape would be used. However, for TUFLOW HPC, the order to process the Layered Flow Constriction Shapes could not be determined due to the nature of GPU parallel computing. This mean there is no way to check which value was applied in the hydraulic calculation. 2.8 2023-03-AB Minor Enhancements and Bug Fixes 2.8.1 Bug Fix to HR Breakline Adjustment with Output Zone Build 2023-03-AB fixes a memory allocation issue when “HR Thin Z Line Output Adjustment == ON ALIGNMENT” are used in conjunction with Output Zones. Previously, this could cause the simulation to crash without error. 2.8.2 Read GIS / GRID Soil Layer Accepts Multiple Layer Numbers Build 2023-03-AB accepts multiple layer numbers in the GIS / GRID command within the TGC, e.g: Read GIS Soil Layer 1, 2 == gis\\2d_soil_001.gpkg 2.8.3 Un-Deprecated GWD and GWL Commands Build 2023-03-AB un-deprecates the GWD (groundwater depth) and GWL (groundwater level) commands in the TGC which were originally deprecated in favour of the newer “Soil Thickness” and “Soil Base Elevation” commands. However, to conserve backward compatibility, these commands have been un-deprecated when not using the interflow functionality. 2.8.4 Bug Fix HPC GWQ PO Units Build 2023-03-AB fixes the units output from HPC for groundwater flow (line) which was reporting in mm3/s rather than m3/s. Quadtree was correctly reporting in m3/s. 2.8.5 Bug Fix for Ground Water Outputs Build 2023-03-AB fixes an issue which would cause advection-dispersion outputs to be written for groundwater layers if advection-dispersion was being modelled without soils. 2.8.6 Bug Fix for Infiltration Outputs in Classic Build 2023-03-AB fixes an issue where infiltration outputs (CI and IR) were being suppressed when running TUFLOW Classic. For the 2023-03-AA Build, WARNING 2587 was issued and these data types not output. This did not affect the infiltration computations. 2.8.7 Bug Fix for HPC Breakline Memory Release Build 2023-03-AB correctly releases memory when running TUFLOW HPC at the end of the simulation. Previously when running multiple simulations through an external 1D engine, ERROR 3544 could be generated on the second simulation. 2.8.8 Infiltration When No Soil Capacity and Infinite Depth Soil When a soil has an initial moisture fraction greater than the soil porosity (i.e. the soil capacity is zero) TUFLOW issues WARNING 2508. For builds prior to 2023-03-AB, when no soil thickness or soil base elevation is specified (i.e. soil thickness is infinite) and the soil capacity is zero, infiltration occurs despite WARNING 2508 being generated. For build 2023-03-AB this has been fixed so that no infiltration occurs – consistent with the warning message. 2.9 2023-03-AC Minor Enhancements and Bug Fixes 2.9.1 Bug Fix to Default SGS Elevation Build 2023-03-AC fixes an issue that occurred, when using SGS, where the bed elevation defaulted to 0 m if the Set Zpts command was not used. This meant the error message “ERROR 2206 - ZH value not initialised (exceeds 99998 m)” was not triggered correctly. Build 2023-03-AC now sets the default elevation as 99999 m, consistent with non-SGS models. This could also cause the final SGS elevations to be re-processed after each model initialisation, in this case CHECK 3551 was issued. 2.9.2 Bug Fix to Quadtree Clip Region Build 2023-03-AC fixes an issue where, if using multiple clip regions with the Read GRID Zpts command, they could be ignored. This issue could occur if some of the clip regions were located outside of the model domain, or the quadtree sub-domain(s), the entire clip region file was ignored. Build 2023-03-AC only skips those clip regions outside the model domain, and still applies the clip regions located inside the model domain. 2.9.3 Bug Fix to Read TIN Command in HPC Model Build 2023-03-AC fixes an issue that TIN Angles command wasn’t read before the TINs were created in HPC models. This could cause inconsistency between the TINs created by Classic and HPC models. Build 2023-03-AD extends this fix to HPC models with quadtree refinement. 2.9.4 Bug Fix Quadtree 2d_zsh Snapped to Code Build 2023-03-AC fixes an issue that could cause TUFLOW to exit uncleanly. This was caused when a 2d_zsh (or similar e.g. 2d_lfcsh) was snapped along the 2d_code polygon. This bug only affected Quadtree models. 2.9.5 Bug Fix for “Blockage Return Period” Command Prior to Build 2023-03-AC, the “Blockage Return Period == AEP” command is not applied if it’s read after the Blockage Matrix File command. The first column in the matrix file is still treated as “ARI”. Build 2023-03-AC fixes this issue and the “Blockage Return Period == AEP” command can be specified either before or after the Blockage Matrix File command. 2.9.6 Bug Fix for Long Breaklines in Quadtree Prior to Build 2023-03-AC, a long breakline in quadtree model could cause stack overflow issue if it selects more than 10,000 cells. Build 2023-03-AC adds a “ERROR 2859 - Number of quadtree cells selected by a polyline exceeds the limit of 10000” message. If this error is encountered, it is recommended to split the long breakline in to shorter sections. 2.10 2023-03-AD Minor Enhancements and Bug Fixes 2.10.1 Bug Fix HPC Initial Tracer Concentration Build 2023-03-AD fixes a tracer concentration initialisation issue for the HPC Advection-Dispersion module. Previously, the initial tracer concentrations were all set as zero. 2.10.2 Bug Fix for Auto Generated Bridge FLC with ‘Bridge_width’ Build 2023-03-AD fixes an issue where the 2d_bg ‘deck_width’ attribute was not correctly applied to distribute the automatically calculated FLC (Section 2.4.3) to cell faces. 2.10.3 Bug Fix for Longitudinal Profile Output (LP) in Quadtree Models Build 2023-03-AD fixes an issue where the Longitudinal Profile Output (Read GIS LP) could cause memory access violation in Quadtree models. A known issue caused by this memory access violation includes a change to inflow values from a QT boundary. 2.10.4 Bug Fix for Invalid 2d_code Values Build 2023-03-AD introduces stricter checks when reading Code values specified with either the Set Code or Read GIS Code command in the .tgc. Valid options for cell code are: Code -1, inactive cell but included in outputs (HPC and Classic only) Code 0, inactive cell Code 1, active cell Previously, values outside this range could be specified and this code would be included in the grid outputs. For the 2023-03-AD build any values &gt;1 are treated as 1 and a values less than -1 are treated as -1. In both cases WARNING 2905 is output. Note, code values of 2 are output in the _grd check file for cells assigned as boundary cells, and this happens automatically. 2.10.5 Bug Fix for Large SX/HX BC Connections in Quadtree Build 2023-03-AD fixes a stack overflow issue in quadtree models that could occur if a SX/HX connection selects a large number of cells. Prior to Build 2023-03-AD, this could cause the model to crash without error message. References Collecutt, G., Baeumer, U., Gao, S., &amp; Syme, W. (2022). Bridge Deck Afflux Modelling – Benchmarking of CFD and SWE Codes to Real-World Data. Hydrology &amp; Water Resources Symposium. https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf "],["OneDSolv-1.html", "Section 3 1D Solver - ESTRY 3.1 Arch Bridge 3.2 Ability to Model Time Lag in Virtual Pipes 3.3 Enhancement to Adverse Slope Culvert 3.4 Improvement to Structure Flow Level Options 3.5 Automatically Generated 1D HQ Boundaries 3.6 New 1D (ESTRY) Output Variables 3.7 Minor Enhancements and Bug Fixes for 2023-03-AA 3.8 2023-03-AB Minor Enhancements and Bug Fixes 3.9 2023-03-AC Minor Enhancements and Bug Fixes 3.10 2023-03-AD Minor Enhancements and Bug Fixes", " Section 3 1D Solver - ESTRY 3.1 Arch Bridge The 2023-03 Release includes support for arch bridges as 1D channels. The approach is based on the ‘Afflux at Arch Bridges’ (HR Wallingford, 1988). Arch bridges are defined in the 1d_nwk layer as a “BArch” type. The 1d_nwk attributes specific to an arch bridge are outlined below in Table 3.1. The remaining 1d_nwk attributes are consistent with other bridge channels. Table 3.1: Arch Bridges 1D Model Network (1d_nwk) Attribute Descriptions No.  Default GIS Attribute Name Description Type 2 Type “BArch” Char (36) 11 Inlet_type Relative path to arch properties .csv file Char (4) 14 Width Optional skew parameter Char (1) 15 Height Optional calibration coefficient Char (1) 17 HConF Discharge coefficient for orifice flow - use negative value to switch on. Float (15) 19 EntryC Lower transition distance for orifice flow Float (15) 20 ExitC Upper transition distance for orifice flow Float (15) The .csv for the arch properties should contain the columns outlined in Table 3.2. Table 3.2: Arch Bridge Properties .csv Column Description 1 Start chainage for arch opening 2 End chainage for arch opening 3 Springing level 4 Soffit level An example of the 1d_nwk attributes and “Inlet_type” .csv is shown in Figure 3.1. Figure 3.1: Example of 1d_nwk Attibutes and Inlet Type .csv. 3.1.1 Arch Bridge Editor An arch bridge creator and editor tool has been developed for the QGIS TUFLOW Plugin, shown in Figure 3.2. This tool is available from the TUFLOW Plugin Version 3.7. The documentation and examples for this tool can be found at the following TUFLOW Wiki page: https://wiki.tuflow.com/QGIS_TUFLOW_Arch_Bridge_Editor Any and all feedback is welcome and can be addressed to support@tuflow.com. Figure 3.2: QGIS TUFLOW Plugin Arch Bridge Editor 3.1.2 Bug Fix with Modelling Multiple Arch Bridges Build 2023-03-AB fixes a bug that occurred when using multiple arch bridges in the same model. This could cause either a ‘Should not be here’ error message or sometimes no error message, and the arch bridge curves would be applied incorrectly. This could occur when reading in multiple arch bridges in the same 1d_nwk layer or using multiple 1d_nwk layers. If using the ‘BArch’ type, please update to the 2023-03-AB release. 3.1.3 Arch Bridge Error Message Number Assignment Build 2023-03-AB correctly assigns error numbers to the CHECK/WARNING/ERROR messages produced when pre-processing arch bridge inputs. Previously, these may have been reported as ‘ERROR XXXX’. 3.1.4 Arch Bridge Warning Message for Low Blockage The flume experiments in the ‘Afflux at Arch Bridges’ (HR Wallingford, 1988) were conducted with blockage values of 20% ~ 70%. It’s recommended to use the arch bridge feature within this blockage range, especially, as this approach can generate high velocity and instability with low blockage value. Build 2023-03-AD produces WARNING 1450 if the blockage below the springing level is lower than 10%. 3.2 Ability to Model Time Lag in Virtual Pipes Build 2023-03-AB introduces the ability to lag virtual pipe flows from the inlet to the outlet. Two additional attributes are required, and these are output in empty files written with the 2023-03-AB version of TUFLOW. These additional 1d_pit attributes are described in Table 3.3 below. This data is input on the inlets (VPI). Two approaches are available for lagging flows, these are “Shift” and “Decay”. For the shift method, the outflow is lagged shifted by the lag value time, but is otherwise unchanged. The decay method is based on exponential filtering of the inflow. A “current internal volume” is tracked: \\[\\begin{equation} Q(T) = \\int_{0}^{T} [\\dot{Q}_{in}\\,(t)-\\dot{Q}_{out}\\,(t)]dt \\tag{3.1} \\end{equation}\\] The outflow rate is computed from the internal volume and the time constant (the Lag_Value attribute): \\[\\begin{equation} \\dot{Q}_{out}\\,(t) = \\frac{Q(t)}{Lag\\_Value} \\tag{3.2} \\end{equation}\\] Figure 3.3 below shows the lag approaches applied with a lag value of 60 seconds which is input as 0.0167 hours. Figure 3.3: Virtual Pipe Lag Methods All pits with the same VP Network ID (i.e. form a local network) must use the same approach and Lag_Value. Table 3.3: Additional Virtual Pipe Lag (1d_pit) Attribute Descriptions No.  Default GIS Attribute Name Description Type 12 Lag_Approach Sets the lag approach, as described above “None” or Blank - no lag is applied “Shift” – Shift method applied “Decay” – Decay method applied Char (8) 13 Lag_Value Lag value in hours. Float 3.3 Enhancement to Adverse Slope Culvert Build 2023-03-AC includes an enhancement to adverse slope culvert flux calculation. Prior to 2023-03-AC, significant exit loss could be applied at the exit of an adverse slope culvert if the outlet node is dry or close to dry. This is caused by the mis-representation exit flow area and exit velocity. A fix has been introduced in the new Culvert Flow approach: Culvert Flow == Method G Please note that ‘Method E’ is still the default approach in build 2023-03-AC, but ‘Method G’ is likely be the default in the future releases. 3.4 Improvement to Structure Flow Level Options Build 2023-03-AC includes a new option to use energy level at upstream node and water level at downstream node of 1D structures for flux calculation. This option can be applied globally using the .ecf command: Structure Flow Levels == ENERGY UPSTREAM Alternatively it can be changed individually with “EH” flag in the 1d_nwk “Type” attribute. The default option is “Energy”, i.e. using energy levels at both the upstream and the downstream nodes. This approach is applicable to 1D weirs, spillways, gates and dam failure channels. 3.5 Automatically Generated 1D HQ Boundaries Build 2023-03-AD adds new functionality, the ability to generate an automatic HQ boundary using a friction slope. In previous builds a manually defined rating curve was required to be defined in an boundary condition database. To use this new feature, specify “slope=friction_slope” for the “Name” attribute in the 1d_bc point layer defining the HQ boundary. As long as your boundary is sufficiently far from your area of interest, the friction slope can be estimated from the two nearest cross-sections to the downstream boundary. This feature requires a single channel connected to the node and does not work with channels using HW cross-sections with varying roughness. The rating curve is derived using Manning Equation using the ESTRY computed conveyance shown in the *1d_ta_tables.csv check file (shown in Figure 3.4). Figure 3.4: Example 1d_ta_tables.csv check file 3.6 New 1D (ESTRY) Output Variables Build 2023-03-AD adds new output data types to the ESTRY time-series outputs (available in both CSV and NetCDF format). These additional output types are: Qi: integral flow at channels (sometimes called cumulative flow) (m3); and Vol: volume at nodes (nodal storage through time) (m3). These output options can be activated using the Output Data Type command in the .ecf (or 1D Output Data Type within the .tcf) with the values “Vol” for nodal storage volume and “Qi” for integral flow. 3.7 Minor Enhancements and Bug Fixes for 2023-03-AA The 2023-03 Release includes a range of minor enhancements and bug fixes to the 1D solver. 3.7.1 Unused Manning’s n Value Set to Zero in nwk_C Check File and .eof The 2023-03 Release will now show a Manning’s n value of zero in the nwk_C check file and the ESTRY Output File (.eof) if it’s not being used by TUFLOW. Previously if a user had specified a Manning’s n value for a channel type that doesn’t use it (e.g. weirs, bridges), this input value would be shown in some of the output files. This change doesn’t affect any of the computations. 3.7.2 Fixes to Write Check Files [Exclude | Include | None | ALL] == [OFF] The 2023-03 Release fixes the optional, additional commands to the ESTRY Control File (.ecf) command: Write Check Files [Exclude | Include | None | ALL] == \\(\\langle\\)file_path\\(\\rangle\\) | \\(\\langle\\)check_type\\(\\rangle\\) | OFF Previously, adding the keywords ‘Exclude’, ‘Include’, ‘None’, and ‘All’ to the command or setting the command to ‘OFF’ was not working. Adding these keywords will override any settings from the same command specified in the .tcf that affect ESTRY check files. 3.7.3 Pit_A Check File Incorrectly Reporting Width The pit_A check file now correctly reports pit width for ‘Q’ type pits in the 2023-03 Release. This change doesn’t affect any of the computations. 3.7.4 Pit_A Check File Increased Type Attribute Length The 2023-03 Release increases the length of the attribute ‘Type’ in the pit_A check file to eight, which was previously restricted to four. 3.7.5 Incorrect ‘B’ Type Bridge Form Loss Reported in the .eof The 2023-03 Release fixes the form loss reporting in the .eof for ‘B’ type bridges. Previously this could be reported out of order if there were multiple ‘B’ bridges. This change doesn’t affect any of the computations. 3.7.6 Pump Inverts Reported in the .eof The 2023-03 Release now correctly reports pump inverts in the .eof. 3.7.7 1D Pump Point Objects Now Produce ERROR 1438 The 2023-03 Release will produce ERROR 1438 when a point object is used as a 1D pump. Previously TUFLOW would ignore this object. 3.7.8 Pump Curves No Longer Trigger ERROR 1092 and ERROR 1093 The 2023-03 Release no longer generates ERROR 1092 and ERROR 1093 when using pump curves in the pit inlet database. Previously these errors would occur if no width or area was specified for the pump curves (these attributes are not required for pumps). 3.7.9 ERROR 2056 Incorrectly Triggering The 2023-03 Release fixes a bug that could incorrectly trigger ERROR 2056 when an inlet pit with an SX connection was located almost exactly on the 2D domain boundary. 3.7.10 WARNING 2039 Counts All Ignored SX Pit Connections WARNING 2039, which reports the number of ignored pit/node SX connections, will now include SX pit connections that are located outside the 2D domain. Previously this warning message would only report the number of ignored pit SX connections that were located within the 2D domain, but not situated in an active 2D cell. 3.7.11 1D Operable Structures Linked to 2D Water Level (H2D) Updating on Map Update Interval The 2023-03 Release fixes an issue with operable structures that were linked to 2D water levels using the H2D variable type in the .toc. Previously, the operable structure would only update and respond to changes in water level at the map output interval (which can be longer than desired). For the 2023-03 Release, the water levels will update at each timestep. 3.7.12 Linking 1D Operable Structures to 2D PO Points not Functional as Described The 2018 TUFLOW Manual describes an option to base operations on the results from a 2d_po point identifier, rather than coordinates. This functionality now works as described. Previously this would cause an error to be reported. 3.7.13 Bug Fix to Invert Levels used in PF Channel Flow Calculation The 2023-03 Release fixes a bug that could apply incorrect channel inverts for the PF channel flow calculation. Previously, the 1D node inverts were used to determine whether the PF channel was submerged or unsubmerged. This could cause flow calculation issues when the upstream and the downstream nodes were snapped to another 1D channel with lower inverts. As of the 2023-03 Release, the PF channel inverts are now correctly applied. 3.7.14 ERROR 1261 Incorrectly Triggering for 1D PF/DF Channels The 2023-03 Release fixes a bug that could incorrectly trigger ERROR 1261 when the Manning’s n (“n_nF_Cd” attribute) is set as zero for 1D PF/DF channels. The 1D PF/DF channels do not require Manning’s n in their hydraulic calculation. 3.7.15 Enhancement and Bug Fix for PF/DF Channel Check Files The 2023-03 Release fixes a bug in which the information reported by the nwk_C check file didn’t match the input attributes in the 1d_nwk file. The 2023-03 Release will also report the weir factor (Cd) and weir submergence factor (Csf) applied during the simulation to the _TSL_P result file. The bottom width of the DF channel cross-section will be reported in the _O.csv file for checking purpose. 3.7.16 Setting Initial State of 1D DF Channel The 2023-03 Release implemented two .toc commands to set the initial breach status of a 1D DF channel: Depth Breached == \\(\\langle\\)initial breach depth in metres or feet\\(\\rangle\\) Top Width Breached == \\(\\langle\\)initial breach width in metres or feet\\(\\rangle\\) Previously, a DF channel always must start from zero breach depth and width. 3.7.17 WARNING Message for Using Zero Pump Capacity When pump capacity is set to zero using the “Pump Capacity ==” command, the “Pump Shutdown Speed ==” will be also set as zero. This does not turn off a pump that is already operating. The 2023-03 Release produces WARNING 1434 to notify users. The “Pump Operation == OFF” command should be used to turn off a pump completely. 3.7.18 Enhancement Reducing Memory Usage for Operational Channels For operational control channels, the 2023-03 Release determines the number of operational channels in the model for memory allocation. Previous Releases allowed for up to 1,000 operational channels, meaning models with less than this will now use less memory. The 2020-10-AE build of TUFLOW allowed this maximum to be set with the .tcf command: Maximum Operational Controls == \\(\\langle\\)number of operational channels/control definitions\\(\\rangle\\) This command is no longer required and should be removed from the .ecf. If this command is included, it will be ignored. 3.7.19 WARNING/ERROR Message for Using Wrong GIS Type in 1d_nwk The 2023-03 Release produces WARNING/ERROR 2073 if wrong object type is used in 1d_nwk GIS layer to notify users. Only point, line and polyline objects are supported by TUFLOW input. 3.7.20 ERROR Message for Using Bridge Flow == Method A in Structure Routines == 2013 (Default) “Bridge Flow == Method A” is only supported in “Structure Routines == ORIGINAL”. The 2023-03 Release produces ERROR 1442 if “Bridge Flow == Method A” is used in “Structure Routines == 2013”, which replaces the “Should not be here [conchn_2_B_1]” message. 3.7.21 Bug Fix for ERROR 1025 Fixes bug for models with ERROR 1025, which stopped the simulation with message “ERRORS found in 1D input data”. However, the ERROR message was not correctly output to the log or messages layer. 3.7.22 Bug Fix for WARNING 2073 Fixes a bug that could spuriously report WARNING 2073 (Object ignored) for points or lines when a pit search distance was used. The points / lines were being read correctly; the message was spurious. 3.8 2023-03-AB Minor Enhancements and Bug Fixes 3.8.1 Operational Channel Memory Allocation Error Build 2023-03-AB fixes an issue where memory for the operational channels was not correctly allocated in some circumstances leading to a crash in the model. 3.8.2 Operational Channels Handle Multiple AND or OR Statements on Same Line 2023-03-AB fixes a bug where operational channels did not work correctly if the logic included multiple AND statements or multiple OR statements on the same line. 3.8.3 Bug Fix for Virtual Pipe Model Not Writing Output Build 2023-03-AB fixes an issue in HPC simulation with virtual pipes (VP) but no other 1D elements. This caused the 1D results files not to be written at the end of the simulation. 3.8.4 Bug Fix for WLL Should Not Be Here Build 2023-03-AB fixes an issue with 1d_wll that cross multiple channels, this could occasionally cause a “Should not be here [no_in]” to be issued and the simulation to be halted in pre-processing. 3.9 2023-03-AC Minor Enhancements and Bug Fixes 3.9.1 Bug Fix to VPO Connected to 1D Channel Build 2023-03-AC fixes an issue that VPO does not discharge water to 1D channel even if the VPO is snapped to the 1D channel node. Prior to build 2023-03-AC, any VPO outside the active 2D domain has been ignored. The 2D cells overlapping with 1D channels are often disabled (which is the correct configuration). This means the VPO located inside such deactivated 2D domain was not used in the simulation. Build 2023-03-AC now use all VPOs in the virtual pipe flow calculation even if they’re outside the active 2D domain. Note that this could cause difference in simulation results for models that have intentionally put VPOs outside the active 2D domain. “CHECK 2435 - Virtual Pit Inlet/Outlet outside active 2D domain” message is now generated if any VPO is located outside the active 2D domain. 3.9.2 Bug Fix to Water Level Lines (WLL) when Virtual Pipes are Used Build 2023-03-AC fixes an issue that Water Level Lines (WLL) are not generated correctly when virtual pipes are also used in the model. 3.10 2023-03-AD Minor Enhancements and Bug Fixes 3.10.1 Bug Fix to Water Level Lines (WLL) when Snapped to Nodes Build 2023-03-AD fixes an issue with water level lines snapped to nodes. This issue was introduced in 2023-03-AB and could cause the water level lines to be ignored, resulting in gaps in the WLL output. This did not affect the hydraulic computations, and did not affect WLL that crossed channels without snapping. 3.10.2 Bug Fix to Prevent Freeze When Channel is Connected to Same Node Upstream and Downstream Build 2023-03-AD fixes an issue in which the TUFLOW console window could freeze if a user had the same node assigned to both the upstream and downstream sides of a channel. TUFLOW now produces ERROR 1455 identifying the invalid channel. 3.10.3 Bug Fix to Models with 1D Node Names Alphanumerically After “ZZ000” Build 2023-03-AD fixes an issue that could incorrectly write 1D output for models with ESTRY node names that alphanumerically sort after “ZZ000”. This issue only occurred for models that had automatically created hidden nodes (via 2D/2D links or QT boundaries) as the hidden nodes created were not the last in a sorted list. In this case these hidden nodes were output instead of the standard nodes which were be missing from the 1D outputs. A work around was to use Reveal 1D Nodes == ON which would output both standard and hidden 1D Nodes. 3.10.4 Reduced Screen Output for 1D Initialisation Build 2023-03-AD improves 1D model initialisation performance by reducing screen output when alphanumerically sorting ESTRY channel and node names. 3.10.5 Bug Fix for Pits with Large Search Distances Connecting to the Wrong 1D Node Build 2023-03-AD fixes an issue that would sometimes arise where pits where connected to nodes using the Pit Search Distance functionality. When using a large search distance, TUFLOW could connect the pit to the wrong the 1D node (i.e. not the closest node and beyond the pit search distance). 3.10.6 Eliminated Warning 1100 at Manhole Nodes Build 2023-03-AD eliminates “WARNING 1100 Structure crest/invert is below bed of primary upstream/downstream channel” when the connecting node is a manhole. Manholes often feature elevation drops between culverts making the warning unnecessary. References HR Wallingford. (1988). Afflux at Arch Bridges. https://eprints.hrwallingford.com/219/1/SR182-Afflux-arch-bridges-HRWallingford.pdf "],["SWMM-TUFLOW-1.html", "Section 4 1D Solver - SWMM 4.1 Overview 4.2 SWMM-TUFLOW Commands 4.3 SWMM Input Files", " Section 4 1D Solver - SWMM This chapter of the release notes is written in USA English for the predominantly USA centered SWMM user base. 4.1 Overview TUFLOW has supported 1D/2D dynamic coupling since its initial 2D solver development in 1989. Traditionally, 1D (1 Dimensional) linking and associated modeling has been applied using the ESTRY 1D solver. New in the 2023-03-AD Release, TUFLOW’s 1D linking and solver options have been expanded to support the EPA Storm Water Management Model (SWMM). As such, 1D pipe networks or 1D open channels can now be modeled using either the ESTRY, EPA SWMM, or a combination of the two 1D solvers. EPA SWMM is a widely used software program for simulating urban and non-urban watersheds’ hydrologic and hydraulic behavior. Developed in the early 1970s by the Environmental Protection Agency (EPA), the model has since undergone numerous updates and enhancements to become one of the most used 1D stormwater runoff and water quality analysis tools globally, particularly in North America. The primary uses of EPA SWMM include designing and evaluating stormwater management practices, planning, and assessing low-impact development techniques, and developing models for floodplain mapping and emergency response planning. The software allows users to simulate a wide range of storm events and analyze the impact of a range of factors, such as land use changes, climate variability, and water quality control measures, on the performance of stormwater management systems. This document provides background and instructions for using and linking TUFLOW and SWMM together. Refer to the TUFLOW and SWMM user documentation and tutorials to learn how to set up the TUFLOW and SWMM domains. Information on getting started with TUFLOW can be found on the TUFLOW Wiki. Information about EPA SWMM can be found on the EPA SWMM website. 4.1.1 Capabilities Combined TUFLOW (2D) and SWMM (1D) models have a variety of applications and capabilities, including: SWMM 1D inflows from external boundary conditions, rainfall routed through subcatchments, or through 2D links Subcatchment routing including infiltration, groundwater levels, evaporation, and snow melt Low-impact developments (LIDs) for modeling green infrastructure 1D/2D Links through direct connections (HX/SX) or through stormwater inlets (ESTRY pits) Inlets can be a variety of shapes and supports on-sag or on-grade connections Inlets can surcharge into the 2D domain if the 1D pressure head exceeds the 2D water level Scenario support through the ability to combine multiple SWMM project files (inp) is a powerful way to explore multiple setup options without duplicating information All TUFLOW functions including: Quadtree grid refinement Subgrid sampling Rain on grid or source flows Infiltration Interflow (shallow groundwater) The TUFLOW QGIS plugin has been expanded to assist with setting up SWMM models, linking TUFLOW-SWMM models, and viewing SWMM outputs. It includes the following features: Creation of SWMM GeoPackage GIS files that include all the data needed for a SWMM model Conversion of SWMM input files (inp) to and from SWMM GeoPackage files Adding tables to SWMM GeoPackage files Semi-automatic creation of TUFLOW-SWMM linkage Setting of SWMM Junction parameters based on junction usage and location Setting SWMM conduit losses dependent on location in the network and whether connected to inlets Convert XPSWMM 1D/2D links to TUFLOW SWMM links Convert ESTRY layers to SWMM Supports 1D pipe and other integrity tools for SWMM GIS Layers GIS viewing of time-series results including Plan view symbology based on results at the current time Time-series plots through the TUFLOW viewer Both options can be used for animations Currently, TUFLOW does not connect the AD (advection-diffusion) module or the interflow capability to the SWMM network. These are scheduled for a future release, however, if they or other features would be useful to you, please let us know via support@tuflow.com. 4.1.2 Model Setup 4.1.2.1 SWMM Model The SWMM portion of the TUFLOW-SWMM model is read from one or more SWMM project files (inp). These files can be setup within the EPA SWMM GUI, using the GIS tools described in Section 4.1.3, or other tools. The EPA SWMM Website provides documentation on model theory and setup. This manual does not attempt to duplicate all of the information available in other sources for SWMM models but does provide documentation on the GeoPackage format used in the TUFLOW QGIS plugin in Section 4.3. 4.1.2.2 Simulations When running a TUFLOW / SWMM model, TUFLOW controls the execution of the simulation. SWMM input commands are specified within a SWMM control file (*.tscf) documented in Section 4.2. The SWMM control file is referenced in the TUFLOW Control File (*.tcf) using the “SWMM Control File” command documented in Section 4.2.1. The SWMM Control File can reference multiple SWMM input files (inp) potentially varying by scenario. These input files are merged giving preferences to later files allowing for overriding existing features (eg. to upgrade a section of pipe network). After the input files are merged, the final SWMM model will be placed in the TUFLOW output folder and will be executed from there. The report and output files will also be placed in the TUFLOW output folder. 4.1.2.3 1D/2D Domain Linking Connections between 1D and 2D models use SX and HX connections generally defined in 2d_bc layers but sometimes created in other ways. For HX connections, the 2D domain provides a discharge to the 1D domain and receives a water level. SX connections are the reverse. The 2D domain provides a water level and receives a discharge. Whether an HX or SX boundary is used depends on the configuration as described below. There are three categories of connections between 1D and 2D models; Storm-drain inlets: These are connections that use storm drain inlet information to determine the discharge that should flow from the 2D overland flooding into the storm drain system. These connections use an SX connection. These connections require inlet definition in the SWMM inp file and an inlet usage layer as described in Section 4.1.2.4. The inlet usage layer has an automatic SX connection option or they can be connected using SX point, lines, or regions. Direct connections: This type of connection would be used for embankments through a culvert or similar where a storm drain inlet is not used. HX connections are used at junctions (upstream side) and SX connections are used at outfalls (downstream). Subcatchment outlets: Subcatchment runoff can be setup to flow into the 2D domain using a standalone junction that receives the flow connected to SX connections (points, lines, or regions). 4.1.2.4 Inlet Handling 1D inlet configurations, including geometry, are defined in SWMM project (inp) files. The locations of individual inlets and location-specific attributes may be defined in the SWMM project file or in a separate Geographical Information System (GIS) layer. In a pure SWMM model, inlets require the following tables (some are not required if inlet usage is defined separately): Streets: SWMM uses the street cross-section information in this table to help compute storm drain inlet discharges, particularly for on-grade inlets. Conduits (Streets): This table is used to define streets for overland runoff and the slope is used in the storm drain inlet discharges. This table is not used directly when running a TUFLOW-SWMM model because the overland flows are calculated within TUFLOW. However, some of the information is extracted. Inlets: This table defines inlet configurations that describe how to determine inlet discharges. Inlets can be defined based on type and shape such as grates, curbs, combination thereof, or through curves that describe the relationship between depth and inlet discharge or approach flow and inlet discharge. This table defines these parameters. The same inlet configuration can be used in multiple places within the model. Inlet Usage: This identifies the placement of inlets including the street conduit, inlet (configuration), the node receiving the flow, and local parameters including blockage, size of local gutter depressions, and on-grade, on-sag placement, or automatic placement. For a TUFLOW-SWMM model, inlets can be defined, either: Completely using the SWMM input (inp) file format. In this form, all table items listed above (Streets, Conduits, Inlets, and Inlet Usage) are required. In addition, a “2d_bc” layer is required to connect the inlets to the 2D domain. A mix between the SWMM input file format and a “swmm_inlet_usage” GIS layer. Table 4.1 lists the attributes associated with this GIS layer. In this form, the data entry requirement is reduced. SWMM “Inlet Usage” tables are not used, and streets are not required in the “conduits” table (the conduits table will still define the pipe network). Also, automatic inlet connections between the 1D network and 2D domain can be implemented via the “Conn1D_2D” attribute field (instead of manual specification of SX connection cells within a “2d_bc” GIS layer). The Streets and Inlet tables must be defined in the SWMM input (inp) file. Whether inlet usage is defined in SWMM or in a separate GIS layer, the inlet discharges are computed within TUFLOW using modified EPA SWMM 5.2 code before being passed to the SWMM engine for the 1D solution computations. This approach has been selected due to its ability to leverage TUFLOW 2D model results, such as velocities and water levels. If the pressure head in the 1D domain exceeds the 2D water level, the 1D domain will surcharge into the 2D domain. Table 4.1: SWMM Inlet Usage (swmm_inlet_usage) Attribute Descriptions No.  Default GIS Attribute Name Description Type 1 Inlet The name of the inlet defined in the SWMM inp file “INLETS” section Char (100) 2 StreetXSEC The name of the street cross-section that must be included in the SWMM SWMM inp file “Streets” section. Char (100) 3 Elevation The elevation of the inlet. If a value of –99999 is entered, the elevation will be based on the 2D cell’s elevation.   Float 4 SlopePct_Long The longitudinal slope of the street near the inlet. Float 5 Number The number of inlets in series at the location (generally 1). Integer 6 CloggedPct The percentage that the inlet is blocked (defaults to 0.0). Float 7 Qmax The maximum discharge through the inlet (default is 0 which does not enforce a maximum). Float 8 aLocal The depth of a local depression at the inlet (default 0.0). Float 9 wLocal The width of a local depression at the inlet (default 0.0). Float 10 Placement Specifies whether the inlet should be treated as at a sag or on a grade. Options are ON_GRADE, ON_SAG, or AUTOMATIC. AUTOMATIC is the default and will switch between ON_GRADE and ON_SAG depending upon the flow conditions at the inlet. Char(10) 11 Conn1D_2D Used to specify a “SX” connection and any additional flags such as “SXZ” or “SXG” that automatically creates a 2D SX cell and connection at the 2D cell within which the SWMM node occurs. This negates the need to create SX objects in a 2d_bc layer. Flags: “L” – sets the ZU and ZV elevations to be the same as the ZC value only if they are lower. This can improve instabilities where the ZU and ZV values are significantly lower in elevation and can cause a sudden increase in transfer of water to//from the cell when the cell wets. “Z” – Adjust the ZC elevation at each cell at//along//within the 2D SX object to below the 1D node bed elevation where ZC is higher. The ZC elevation is set to the Cell Wet/Dry Depth below the 1D node bed. An error occurs if the minimum ZC elevation plus the Cell Wet//Dry Depth at//along a SX object is not below the connected 1D node bed. Also see SX ZC Check permits the user to define a maximum change in ZC elevation. It is not recommended to use the Z flag without first checking that the reason for the discrepancy in elevations between 1D and 2D domains is appropriate By default, if more than one 2D cell is automatically connected, nodes are assumed to be connected using the Sag (S) approach. To override the default approach, specify “SXG” for an on-grade connection. Char (10) 12 Conn_Width If “SX” is specified for Conn1D_2D, this field controls the number of 2D cells connected as follows. Note this approach is slightly different than is used by TUFLOW-ESTRY models. A positive value indicates the flow width that should be used to compute the number of 2D cells to connect to. TUFLOW will choose the nearest cells that are collectively as wide or wider than the specified flow width. If negative, the number of cells selected is the absolute value of the number specified. For example, a value of –1 would connect the inlet to a single 2D cell. Float 4.1.2.5 ESTRY/SWMM Linking SWMM can be linked to TUFLOW 2D (HPC) as well as ESTRY 1D Networks. The approach is described in Section 8.3 of the 2018 TUFLOW Manual where SWMM is considered an “External 1D Domain.” For SWMM linking, X1DQ connections must be used at SWMM junctions and X1DH connections are used at SWMM outfalls. 4.1.2.6 SWMM Settings 4.1.2.6.1 SWMM Options Table Some SWMM option settings are automatically set by TUFLOW: END_DATE/END_TIME: Set based upon the SWMM START_DATE/START_TIME and the TUFLOW simulation duration. FLOW_UNITS: the flow units are set to match the TUFLOW simulation, either to CFS for US Customary units or CMS for metric units. FLOW_ROUTING: Flow routing is set to DYNWAVE. ALLOW_PONDING: Allow ponding is set to YES. Ponding can be prevented by setting a high value for “YSur” or by setting the junction attribute Apond to 0.0. Only junctions with HX or SX boundaries should have Apond set to 0.0, which will create flooding in the 2D domain when the junction is surcharged. END_DATE/END_TIME: These are set based on the TUFLOW end time and the SWMM start time (simulation duration + start date/time = specified end date/time). VARIABLE_STEP: This is turned off (0). TUFLOW will control the timestep based on the HPC (Heavily Parallelised Compute) timestep and the SWMM Iterations command. 4.1.2.6.2 SWMM Junction Options The junction settings for Ymax (maximum depth), Ysur (surge depth), and Apond (area of ponding) are critical to get accurate and stable results. These values relate to how SWMM handles water that overflows a node. In SWMM, ponding can be on or off but TUFLOW forces ponding to be on when running a TUFLOW-SWMM model. Junctions can pond if the ponding area (Apond) is greater than 0.0. SWMM tracks the volumes stored as ponded water and will reintroduce the water back into the network when there is capacity available. When ponding is on ysur (surge depth) is ignored (any water above Ymax ponds). If the ponding area (apond) is 0.0, water will not pond at a node, but the water can overflow (flood) if the water level in a node exceeds Ymax + Ysur (maximum depth + surcharge water depth). Flooded water is lost through “flooding” and no longer tracked within SWMM. If the node is connected to a 2D domain, the flow is immediately transferred into the connected 2D cells. If ponding is off at a node, there is no limit to how much flow may overflow from a node for a timestep. This can lead to unrealistic overflow discharges. However, this functionality may be preferred for subcatchment outlets so that the full discharge can immediately overflow into the 2D without being throttled by the inlet. If a node can pond (Apond &gt; 0) and is connected to the 2D domain using an inlet or HX connection, TUFLOW will compute the discharge that should be transferred between the 1D and 2D domain. If the water level in the 2D domain is higher than the 1D (potentially ponded) water level, then flow will be from the 2D domain into the 1D. The discharge rate will depend upon the difference in water levels and whether it is connected through an inlet or HX boundary. If the 1D node is ponded (above Ymax) and above the 2D water level, then water will flow from the 1D domain to the 2D domain. If the node has an inlet, the discharge will be computed using the area of the inlet with the orifice equation. The orifice coefficient used can be set using the “SWMM Inlet Surcharge Orifice Coefficient” command described in Section 4.2.2. Recommendations based on the above: If ponding is used, a Ymax value of 0.0 is generally sufficient for all cases. Ymax will be set to the highest adjacent obvert. Ponding will occur at that elevation and discharges to/from the 2D will compare the ponded elevation with the 2D water levels. For nodes with inlets, allowing ponding is often preferable but using a Ymax set to the invert elevation with no ponding (Apond = 0.0) is also valid. This may be the preferred approach for subcatchment outlets to prevent overflow throttling by the inlet. These values can be set using the “Junctions - Set attributes” tool described in Section 4.1.3.1. Junction nodes receiving subcatchment flows. Use ponding determined by other settings or force no ponding as below. Ysur = 0.0 Apond = 0.0 Junction nodes connected to the 2D at an inlet. Ysur = 0.0 Apond = &lt; Approximate manhole area or larger to aid stability &gt; Junction nodes connected to 2D using HX boundaries. Ysur = 0.0 Apond = &lt; Approximate area of connected 2D cells &gt; Junction nodes not connected to 2D (need to prevent flooding which would be lost) Option #1 Ysur = 0.0 Apond = &lt; Positive number &gt; Option #2 Ysur = &lt; higher depth than anticipated (including pressure head )&gt; Apond = 0.0 4.1.2.7 Using TUFLOW BC Database in SWMM It is possible to use curves from the TUFLOW Boundary Condition Database for SWMM input curves using the command “Read BC ” command. This is a powerful feature making it much easier to model a variety of boundary condition events or scenarios. The curve_type should be timeseries for time data such as rainfall or discharge through time or be one of the types supported in the “Curves” section of the SWMM inp file. The curve data will be added to the inp file TUFLOW writes to use for the simulation. The curve name must be specified (matching the BC Database identifier) where the curve is referenced such as in rainfall or inflow inputs. 4.1.3 SWMM GIS Tools A suite of Python tools has been developed to support TUFLOW/SWMM modeling. These tools are available to run as processing scripts in QGIS, via the TUFLOW Plugin. For instructions how to install the Plugin, please refer to the TUFLOW Wiki. These tools use a GeoPackage format for working with the data in GIS using a schema that has been developed to store the data held within an SWMM input file. The GeoPackage representation is mostly a simple conversion of the table oriented SWMM input file (inp). Some GeoPackage tables are modified versions of the SWMM input file. Some of the GeoPackage tables have spatial components (points, lines, and polygons) and others are tables of data with no geometry attributes. Generally, modified tables are a “wide” form of the tables to represent distinct categories of options without using the same column for multiple input parameters. For example, the “XSECTIONS” table has a variety of inputs depending upon whether the shape is from a list of shapes, a custom shape (a closed shape with a Height vs Width table), irregular shape (cross-section-based open channel), or a street cross-section. In the SWMM input file, attributes from multiple types use the same columns while the GeoPackage representation creates a column for each input field. There are separate columns for specified shapes and irregular culvert curves. Depending upon the option selected, many of the fields will not be used. To make things simpler, the subcatchment and subarea SWMM table columns are combined into the subcatchment table. The subarea columns use the prefix “subarea_” and are written to a separate table when exported to the SWMM inp file. 4.1.3.1 GIS Tools The SWMM functionality currently in the TUFLOW QGIS plugin include processing tools accessed from the “Processing Toolbox Panel.” The 1D integrity tools work with SWMM networks in addition to ESTRY. The Geo-Processing tools include a description of the tool, inputs, and outputs when accessed in QGIS. The list of available Geo-Processing Algorithms includes: BC - Create channel endpoint 1D/2D connections: This tool creates a “2d_bc” layer with 1D/2D connections specified for the upstream and downstream side of SWMM channels. This tool can operate on selected or all of the channels within an input layer. HX connections will be created at junctions and SX connections at outfalls. The connections should be reviewed and modified if necessary. Conduits - Assign losses: This tool assign entrance and exit losses to SWMM junctions based on whether a junction receives subcatchment flows, whether it is connected to an inlet, and its location in the network. This tool can be used to edit layers “in-place.” Conduits - Assign node fields: This tool will identify nodes snapped to the ends of conduits and fill in the appropriate “From node” and “To node” fields. This is required for SWMM to associate the conduits with the nodes. This tool can be used to edit layers “in-place.” Convert - ESTRY layers to SWMM: This tool converts individual ESTRY input layers into SWMM format. Supported layers include 1D network layers (lines or points), 1D node layers, 1D pit layers, and 1D table link layers (cross-sections). The Pit inlet database/depth discharge database can be specified for use. Options and reporting tables can optionally be created to make a more complete SWMM input file. Convert - XPSWMM GIS inlet layers to SWMM: This tool will convert GIS layers exported from XPSWMM with the required attributes to SWMM inlet data and a GeoPackage layer for inlet usage. GeoPackage - Add Sections: This tool adds tables (spatial or otherwise) representing SWMM sections to an existing GeoPackage. GeoPackage - Create: This tool creates a SWMM GeoPackage file with the selected SWMM sections. GeoPackage - Create from SWMM inp: This tool converts a SWMM input file to a GeoPackage representation. Even if not necessary, this conversion is often useful because it provides a format supporting GIS objects for visualization and editing. For example, it provides a GIS object that 2d_bc HX and SX boundaries can be snapped to. GeoPackage - Write to SWMM inp: This tool converts a GeoPackage to a SWMM input file. This step is required to use the model with TUFLOW because TUFLOW does not yet directly read the GeoPackage format. Integrity - Make node names unique: SWMM requires unique names for nodes (junctions and outfalls). If multiple nodes are encountered with the same name, this tool will add an incremental number (node_2, node_3, node_4, etc.) to force unique names. Junctions - Downstream junctions to outfalls This tool converts SWMM junctions at the downstream end of conduits to outfalls as required by SWMM. This can be especially helpful for models exported for XPSWMM or converted from GIS data which do not distinguish between junctions and outfalls. Junctions - Set attributes This tool sets the SWMM junction attributes “Ymax” and “Ysur” based on whether they receive subcatchment flows, if they are connected to the 2D domain, and if the connection uses a stormwater drain inlet. Outfalls - Fix multiple connected links: SWMM requires that outfalls be connected to a single 1D channel. This tool will create a small extension (rectangular open channel) to outlets connected to multiple channels, creates a new outlet at the new downstream location, and changes the previous outfall to a junction. The 1D integrity tools now work with SWMM networks. Refer to the documentation for the tools to understand their use: 1D Integrity Tools. Add the “Links–Conduits” to the “1D Network Line Layers” and “Nodes–Junctions” and “Nodes–Outfalls” to the “1D Point Layers” sections of the panel. The other Links types are not yet currently supported. The “Auto Snap” option in the Snapping tool is not yet currently supported for SWMM networks. 4.1.4 SWMM Outputs Model outputs are written by both SWMM and TUFLOW, which can be used to visualize model results. SWMM writes a report file (rpt) and an output file (out) in the TUFLOW results folder with the simulation prefix followed by “_swmm.” The report file can be viewed with a text editor and the output file can be viewed in EPA SWMM or 3rd party tools that support this format such as PySWMM. TUFLOW-SWMM models also output a GeoPackage time-series output file. The file will be written with the other result files and ends with “_ts.gpkg.” This file can be read into the QGIS TUFLOW Viewer using the “Load Results - Time series” from the File menu of the QGIS viewer. When this file is loaded, point and polyline layers will be loaded representing the node and channel results. The layer symbology can be modified to represent model results for the current QGIS time. Profiles can be also be generated for the 1D network. Animations can be created from these results (in combination with 2D results if desired). These layers can also be used to select channels or nodes to display time series results in the TUFLOW viewer and can be combined with ESTRY or PO outputs. More information about the QGIS TUFLOW Viewer can be found on the TUFLOW Wiki. 4.1.5 SWMM Inclusion in TUFLOW 4.1.5.1 SWMM Library Version TUFLOW runs SWMM as a library passing data between SWMM and the 2D domains. The SWMM version used for the hydraulic calculations was created by Open Water Analytics (McDonnell et al., 2021), which is a modified version of the EPA SWMM code. 4.1.5.2 Embedded SWMM Code in TUFLOW TUFLOW has modified EPA SWMM code (not from Open Water Analytics) primarily to embed compute pit (inlet) discharges to include additional TUFLOW functionality for linking 1D and 2D domains. The code was modified for easy inclusion and to allow the discharges to be calculated outside of the SWMM library based on 2D model results. Some minor changes were made to the embedded code that are described in this section. Changes were made to how inlets are handled to better correspond to how “rating curve” based pits are treated in ESTRY and provide better handling when the water level is above the inlet invert. Pit rating curves use a depth vs discharge relationship to determine the volume of flow that passes from the 2D domain into the 1D domain. If the pipe water level is above the inlet invert, but the 2D water level is higher the discharge will be based on the 2D water level minus the 1D water level in the pipe. If the 1D pipe water level is higher, a surcharging discharge is computed using the same curve based on the 1D pipe water level minus the 2D water level. This matches the ESTRY implementation and ensures a smooth transition between inflow and surcharging. The discharge for On-Grade inlets was modified to use a velocity passed from the 2D domain rather than calculating a velocity based on the street cross-section and slope at the inlet. The methodology for assigning On-Grade or On-Sag handling of pits (inlets) was modified in the embedded code. In SWMM pit (inlet) placement of “AUTOMATIC” determines whether a pit should be On-Sag or On-Grade based upon the topography of the street layout. However, in a combined TUFLOW and SWMM model streets may not be fully described because only the cross-section information at inlets is required because 2D flows are modeled in TUFLOW. When running SWMM inside of TUFLOW, whether to treat an automatic placement as On-Sag or On-Grade is determined dynamically based on the inflows to the connected 2D cells. The 2D model provides the approach discharge (along the street) and total discharge for the connected cells. If the approach discharge is over 85% of the total discharge, the pit is modeled as an On-Grade inlet. Otherwise, it is modeled as On-Sag. This approach is currently being tested and is subject to change. For production models it is recommended that users assign On-Grade or On-Sag to each of their inlets until the automatic approach has been established. 4.2 SWMM-TUFLOW Commands This section is a reference for the commands available in a TUFLOW-SWMM model. 4.2.1 TUFLOW Control File Commands (TCF) SWMM Control File == &lt;swmm_control_filename.tscf&gt; This command identifies the SWMM control file, which contains the relevant commands needed to manage the SWMM simulation. 4.2.2 TUFLOW SWMM Control File Commands (TSCF) This section describes SWMM related commands that are used in the TUFLOW SWMM Control File (TSCF). Commands for scenario and event management are not included but are supported, such as “If Scenario,” “If Event,” “Else,” or “End If.” Such commands are described in the TUFLOW manual. Check INP Save Date == [ {ERROR} | WARNING | OFF ] When working within TUFLOW inp files are often generated by the QGIS plugin from GeoPackage files. This command controls settings to alert the user if the GeoPackage has been updated but the inp has not. Checks that the save date of the .inp file is later than the save date of the associated .gpkg file. The two files must be located in the same folder. This command is very useful for detecting the possibility that one or more layers in TUFLOW-SWMM GeoPackage file has been modified but has not been exported prior to running the simulation. For the ERROR option (the default), the simulation terminates and an error message is given. For the WARNING option, a warning is written to the screen and log file, but the simulation proceeds without pausing. It remains the responsibility of the user to check for any warnings. The OFF option disables all checks and no warnings are given. Inlet Surcharge Orifice Coefficient == [0.16] Specifies the coefficient for the orifice equation that is used when an inlet overflows (pressure head is higher than 2D WSE). Output Folder == &lt;Folder&gt; Redirects the SWMM combined inp file and all SWMM output data to another folder. Typically used to write output to your local drive instead of filling up a network drive, or to keep results separate to the input data. A URL path can be used (e.g. \\bmtserv), which is useful for running simulations on other computers, but having the output directed to your local drive or other location (your drive will need to be shared). The default location for 1D output is that specified using Output Folder in the .tcf file for 2D/1D models. Read SWMM == &lt;swmm_inp_filename&gt; This command adds the SWMM input file to the SWMM simulation. Multiple SWMM input files can be specified which will be combined into a single 1D SWMM simulation. Read GIS SWMM Inlet Usage == &lt;swmm_inlet_usage_filename&gt; This command reads a SWMM inlet usage filename to identify locations and attributes of inlets (pits) that connect the 2D TUFLOW and 1D SWMM models. SWMM Iterations == [1] Controls the number of iterations that are run for each 2D timestep. Increasing the number decreases the timestep used by SWMM potentially improving model stability but increasing run time. 4.3 SWMM Input Files A summary of the available input layers is contained within Table 4.2 and a detailed description provided for each in Appendix A. This information has been taken from the SWMM 5 API Guide (EPA, 2023), with modifications. If a GeoPackage is created from an inp file created by EPA SWMM, the following tables may be retained and exported to future inp files but do not affect model simulations and are not documented here: Backdrop Labels Symbols Tags Map Input layers are read into the SWMM Control File with the Read SWMM == command. Table 4.2: SWMM Input layers Category Input Description Geometry Table BC Inflows Specifies external hydrographs and pollutographs that enter the drainage system at specific nodes. Point Table A.1 Curves Curves Describes a relationship between two variables in tabular format. No Geometry Table A.2 Curves Timeseries Describes how a quantity varies over time. No Geometry Table A.3 Groundwater Aquifers Supplies parameters for each unconfined groundwater aquifer in the study area. Aquifers consist of two zones – a lower saturated zone and an upper unsaturated zone with a moving boundary between the two. No Geometry Table A.4 Groundwater Groundwater Supplies parameters that determine the rate of groundwater flow between the aquifer underneath a subcatchment and a node of the conveyance system. Region Table A.5 Groundwater GWF Defines custom groundwater flow equations for specific subcatchments. Region Table A.6 Hydrology Adjustments Specifies optional monthly adjustments to be made to temperature, evaporation rate, rainfall intensity and hydraulic conductivity in each time period of a simulation. No Geometry Table A.7 Hydrology Evaporation Specifies how daily potential evaporation rates vary with time for the study area. No Geometry Table A.8 Hydrology Hydrographs Specifies the shapes of the triangular unit hydrographs that determine the amount of rainfall-dependent infiltration/inflow (RDII) entering the drainage system. No Geometry Table A.9 Hydrology Patterns Specifies time patterns of dry weather flow or quality in the form of adjustment factors applied as multipliers to baseline values. No Geometry Table A.10 Hydrology Raingages Identifies each rain gage that provides rainfall data for the study area. No Geometry Table A.11 Hydrology RDII Specifies the parameters that describe rainfall-dependent infiltration/inflow (RDII) entering the drainage system at specific nodes. Point Table A.12 Hydrology Snowpacks Specifies parameters that govern how snowfall accumulates and melts on the plowable, impervious and pervious surfaces of subcatchments. No Geometry Table A.13 Hydrology Temperature Specifies daily air temperatures, monthly wind speed, and various snowmelt parameters for the study area. Required only when snowmelt is being modeled or when evaporation rates are computed from daily temperatures or are read from an external climate file. No Geometry Table A.14 Inlets Inlet Usage Assigns inlet structures to specific street and open channel conduits. Point Table A.15 Inlets Inlets Defines inlet structure designs used to capture street and channel flow that are sent to below ground sewers. No Geometry Table A.16 LID Lid_controls Defines scale-independent LID controls that can be deployed within subcatchments. No Geometry Table A.17 LID Lid_usage Deploys LID controls within specific subcatchment areas. Region Table A.18 Links Conduits Identifies each conduit link of the drainage system. Conduits are pipes or channels that convey water from one node to another. Line Table A.19 Links Controls Determines how pumps and regulators will be adjusted based on simulation time or conditions at specific nodes and links. No Geometry Table A.20 Links Losses Specifies minor head loss coefficients, flap gates, and seepage rates for conduits. Line Contained within Table A.19 Links Orifices Identifies each orifice link of the drainage system. An orifice link serves to limit the flow exiting a node and is often used to model flow diversions and storage node outlets. Line Table A.21 Links Outlets Identifies each outlet flow control device of the drainage system. These are devices used to model outflows from storage units or flow diversions that have a user-defined relationship between flow rate and water depth. Line Table A.22 Links Pumps Identifies each pump link of the drainage system. Line Table A.23 Links Streets Describes the cross-section geometry of conduits that represent streets. No Geometry Table A.24 Links Transects Describes the cross-section geometry of natural channels or conduits with irregular shapes following the HEC-2 data format. No Geometry Table A.25 and Table A.26 Links Weirs Identifies each weir link of the drainage system. Weirs are used to model flow diversions and storage node outlets. Line Table A.27 Links Xsections Provides cross-section geometric data for conduit and regulator links of the drainage system. Line Contained within Table A.19, Table A.21 and Table A.27. Nodes Dividers Identifies each flow divider node of the drainage system. Flow dividers are junctions with exactly two outflow conduits where the total outflow is divided between the two in a prescribed manner. Point Table A.28 Nodes DWF Specifies dry weather flow and its quality entering the drainage system at specific nodes. No Geometry Table A.29 Nodes Junctions Identifies each junction node of the drainage system. Junctions are points in space where channels and pipes connect together. For sewer systems they can be either connection fittings or manholes. Point Table A.30 Nodes Outfalls Identifies each outfall node (i.e., final downstream boundary) of the drainage system and the corresponding water stage elevation. Only one link can be incident on an outfall node. Point Table A.31 Nodes Storage Identifies each storage node of the drainage system. Storage nodes can have any shape as specified by a surface area versus water depth relation. Point Table A.32 Project Files Identifies optional interface files used or saved by a run. No Geometry Table A.33 Project Options Provides values for various analysis options. No Geometry Table A.34 Project Report Describes the contents of the report file that SWMM produces. No Geometry Table A.35 Project Title Attaches a descriptive title to the project being analyzed. No Geometry Table A.36 Hydrology Infiltration Supplies infiltration parameters for each subcatchment. Rainfall lost to infiltration only occurs over the pervious subarea of a subcatchment. Region Contained within Table A.37 Hydrology Subareas Supplies information about pervious and impervious areas for each subcatchment. Each subcatchment can consist of a pervious subarea, an impervious subarea with depression storage, and an impervious subarea without depression storage. Region Contained within Table A.37 Hydrology Subcatchments Identifies each subcatchment within the study area. Subcatchments are land area units that generate runoff from rainfall. Region Table A.37 WQ Buildup Specifies the rate that pollutants build up over different land uses between rain events. No Geometry Table A.38 WQ Coverages Specifies the percentage of a subcatchment’s area that is covered by each category of land use. Region Table A.39 WQ Landuses Identifies the various categories of land uses within the drainage area. Each subcatchment area can be assigned a different mix of land uses. Each land use can be subjected to a different street sweeping schedule. Land uses are only used in conjunction with pollutant buildup and wash off. No Geometry Table A.40 WQ Loadings Specifies the pollutant buildup that exists on each subcatchment at the start of a simulation. Region Table A.41 WQ Pollutants Identifies the pollutants being analyzed. No Geometry Table A.42 WQ Treatment Specifies the degree of treatment received by pollutants at specific nodes of the drainage system. Point Table A.43 WQ Washoff Specifies the rate at which pollutants are washed off from different land uses during rain events. No Geometry Table A.44 References EPA. (2023). SWMM 5 API Guide. https://epa.gov/system/files/other-files/2023-08/Swmm5.2.4-ApiGuide.zip McDonnell, B., Wu, J. X., Ratliff, K., Mullapudi, A., &amp; Tryby, M. (2021). Open Water Analytics Stormwater Management Model (Version 5.1.13). Zenodo. https://doi.org/10.5281/zenodo.5484299 "],["TwoDSolv-1.html", "Section 5 2D Solvers - Classic/HPC 5.1 Overview 5.2 2D HPC Weir Flow Approach 5.3 Support for Record Gauge Data in HPC 5.4 Support for Automatic Initial Water Level in Quadtree 5.5 Support for Long Profiles in HPC 5.6 Increase in Maximum CPU Threads 5.7 Minor Enhancements and Bug Fixes 5.8 2023-03-AB Minor Enhancements and Bug Fixes 5.9 2023-03-AD Minor Enhancements and Bug Fixes 5.10 2023-03-AE Minor Enhancements and Bug Fixes", " Section 5 2D Solvers - Classic/HPC 5.1 Overview There are no changes in Release 2023-03 to the core 2D Classic solver, however, an update to the Fortran Compiler may mean very slight differences compared to the 2020-10 builds. The new features described in the sections below apply to the 2D HPC solver. 5.2 2D HPC Weir Flow Approach Where flow in the 2D domain becomes upstream controlled, TUFLOW HPC triggers a weir flow approximation by adjusting the water level gradient. The adjustment was originally calibrated to match the broad-crested weir formula. The 2023-03 Release now supports applying the full weir equation in the 2D domain based on the advanced weir equation (5.1). \\[\\begin{equation} Q = {\\frac{2}{3}C_{f}C_{d}C_{sf}W\\sqrt{2g}H_u^{Ex}} \\tag{5.1} \\end{equation}\\] \\[\\begin{equation} C_{sf} = (1-(\\frac{H_{d}}{H_{u}})^{a})^{b} \\tag{5.2} \\end{equation}\\] Where: \\(Q\\) = Flow over the weir face (m3/s or ft3/s). \\(C_{f}\\) = Weir calibration factor. Cf can be either changed globally using the “Set WRF” command, or adjusted locally using the “Read GIS WRF” feature. The default value is 1.0. \\(C_{d}\\) = Weir coefficient. The default is 0.577. \\(C_{sf}\\) = Weir submergence factor based on the Villemonte equation. \\(W\\) = Flow width. For 2D weir approach, this is the length of the weir face (m or ft). \\(H_{u}\\) = Upstream water surface or energy depth relative to the weir invert (m or ft). Can be set by the “HPC Weir Approach” command below. \\(Ex\\) = Weir flow equation exponent. The default value is 1.5. \\(H_{d}\\) = Downstream water surface relative to the weir invert (m or ft). \\(a, b\\) = Exponents used in the Villemonte equation. The default values are 8.55 and 0.556. In the 2023-03 Release, this feature is turned on by default, but can be changed using the following .tcf command: HPC Weir Approach == Method A | Method B | {Method B Energy} “Method A” is the previous method that applies the water level gradient limiter only. “Method B” applies the weir equation and uses the upstream water level above the weir invert as Hu. “Method B Energy” is the new default approach. It applies the weir equation and uses the upstream energy level above the weir invert as Hu. The default coefficients (Cd, Ex, a and b) are based on the parameters used for a Broad-Crested Weir. The following .tcf commands can be used to change them: HPC Thin Weir Parameters == Cd, Ex, a, b HPC Thick Weir Parameters == Cd, Ex, a, b 5.3 Support for Record Gauge Data in HPC The 2023-03 Release adds support for gauge objects in HPC (and Quadtree) which corresponds to the following command in the .tgc and ‘G_’ PO types: Read GIS Objects RECORD GAUGE DATA == \\(\\langle\\)gis_layer\\(\\rangle\\) This functionality is documented in Section 9.8.1 of the 2018 TUFLOW Manual. 5.4 Support for Automatic Initial Water Level in Quadtree The 2023-03 Release adds support for an automatic initial water level (IWL) in Quadtree (previously only available in Classic/HPC). This is implemented using the .tcf command “Set IWL == Auto” and is documented in Section 7.7.1.3 of the 2018 TUFLOW Manual. 5.5 Support for Long Profiles in HPC The 2023-03 Release adds support for long profiles (2d_lp) in HPC and Quadtree. Note: the long profile line processing in Quadtree can sometimes select slightly different cells and results can differ from HPC slightly, even if the 2D results are identical. 5.6 Increase in Maximum CPU Threads The 2023-03 Release increases the maximum number of CPU threads for HPC and Quadtree simulations from 16 to 64. The number of CPU threads can be changed using the “-nt” command line option. If more than the maximum number of CPU threads are requested, ERROR 2485 is reported and the simulation halts. For prior builds this could cause an unrelated error to occur during model initialisation. Note: a modern GPU is likely to provide much faster simulation times than CPU even with lots of CPU cores, a RTX 4080 GPU has almost 10,000 CUDA cores and a RTX 4090 has over 16,000! 5.7 Minor Enhancements and Bug Fixes The 2023-03 Release includes a range of minor enhancements and bug fixes to the 2D solver. 5.7.1 Limiting Manning’s n for Wu Turbulence Calculation When using the Wu turbulence formulation, the υ_3D term has the Manning’s n as a multiplier, the higher the Manning’s n, the higher the turbulence term. Since the timestep used in HPC and Quadtree is dependent on the turbulence, high Manning’s n values, particularly in deep water, can control the timestep. As detailed in Section 5.2.5 of the 2020 Release Notes, from build 2020-10-AB it is possible to set the upper limit for the Manning’s n value used in the turbulence calculation when using the Wu formulation. This only effects the Wu turbulence calculation; the specified Manning’s n is still used for the bed friction term. To specify an upper Manning’s n limit, a third value can be entered in the Viscosity Coefficients command: Viscosity Coefficient == \\(\\langle\\)C3D, C2D, Upper Limiting n\\(\\rangle\\) For the 2023-03 Release the default limiting Manning’s n value is 0.1. For backward compatibility with the 2020 Release this should be set to a 99. For example, to use the default Wu coefficients, with the 2020 defaults of 7 and 0 and no upper limiting Manning’s n value for turbulence the .tcf command would be: Viscosity Coefficient == 7, 0, 99 If any Manning’s n values are specified (fixed or depth-varying Manning’s n) that exceeds the upper limit, WARNING 2583 is issued. 5.7.2 TIN Clip Layers in Quadtree The 2023-03 Release fixes polygon clip layers in Quadtree when reading in TINs using “Read TIN Zpts == \\(\\langle\\)tin\\(\\rangle\\) | \\(\\langle\\)clip_layer\\(\\rangle\\)”. Previously, the clip layer was not being applied and the entire TIN was used. 5.7.3 Change to Treatment of non-Polygon Objects in Geometry Trim Layers The 2023-03 Release changes how invalid clip layer objects are processed when trimming input grid layers (such as using “Read GRID Zpts == \\(\\langle\\)grid\\(\\rangle\\) | \\(\\langle\\)trim.shp\\(\\rangle\\)”). Previously when an invalid object was encountered (e.g., point, polyline, or null object) the entire grid was processed. The behaviour has been changed to be the opposite; invalid objects will now cause TUFLOW to not read in any of the input grid. The previous behaviour could sometimes read in the entire input grid if the clip polygon layer had a null object present that the user was unaware of. Note: For models using SGS, the new behaviour has always been the default, and this has only changed for non-SGS models. 5.7.4 WARNING 3522 Message Text Updated The 2023-03 Release updates the text in WARNING 3522 (SGS parameters are different from XF file) to reference the specific XF file that produced the warning. 5.7.5 New Thick Breakline Face Selection for Quadtree Model The 2023-03 Release improves the method to select cell faces when thick breaklines are used. Previously, refined cell faces might not be raised at changes in mesh resolution, shown in Figure 5.1. The 2023-03 Release ensures all the cell faces surrounding a raised cell are selected by thick breaklines, shown in Figure 5.2, as this is required for the new HPC weir flow approach (Section 5.2). For models using “HPC Weir Approach == Method A” (the previous approach), this change has minimal impact on the modelling result. Figure 5.1: Quadtree Thick Breakline Face Selection 2020-10-AF Figure 5.2: Quadtree Thick Breakline Face Selection 2023-03-AA 5.7.6 Support Read GIS Zpts Polygon Shape in SGS Method C The 2023-03 Release now supports polygon shapes for the “Read GIS Zpts” command in models using “SGS Approach == Method C”. In the 2020-10 Release, “Read GIS Zpts” polygons were only supported with using “SGS Approach == Method B”. 5.7.7 Support Read GRID Zpts ADD Option for SGS Method C The 2023-03 Release also supports the ADD option for the “Read GRID Zpts” command in models using “SGS Approach == Method C”. Prior to this release, the “Read GRID Zpts ADD” command was producing incorrect bed elevation for the model. 5.7.8 Read RowCol Zpts and Read GIS Zpts With Point Layer Now Produce ERROR 3517 in SGS or Quadtree Models The 2023-03 Release will produce ERROR 3517 when Read RowCol Zpts or Read GIS Zpts with a point layer is used in SGS or Quadtree models. Previously TUFLOW would ignore these commands in models using SGS. 5.7.9 Error for TGC Command Read Grid IWL used in .tcf As per the 2018 TUFLOW Manual, the “Read Gridded IWL” command should be specified in the .tgc and not the .tcf. For Build 2023-03-AA, ERROR 2586 will be generated if this command is specified in the .tcf and the simulation is halted. Previously this command was ignored. 5.8 2023-03-AB Minor Enhancements and Bug Fixes 5.8.1 Running Simulations at the Exact Same Time Causes XF File “End Of File” Error When running simulations at the same time through a batch file or runner utility, sometimes the xf files would crash due to both simulations trying to access the xf files at the same time. This generally occurred only when the connection to the hard drive was slow, such as across a network or when using an external drive. Build 2023-03-AB adds changes to better handle collisions that were encountered. However, running from a local hard drive provides the best performance and stability. 5.8.2 Bug Fix for “Should Not Be Here [tE” with HPC and Restart Files Build 2023-03-AB fixes an issue that caused “Should not be here [tE=….” to be output to the console and log outputs at the first model timestep. The model continued to run, and this did not affect behaviour of the model. 5.8.3 Bug Fix for “Should not Be Here [tE” at End of Simulation Build 2023-03-AB fixes an issue that caused “Should not be here [tE=….” to be repeatedly output at the end of the simulation. This caused an infinite loop to occur and the simulation not to write the maximums and final output. This occurred very rarely and only if a very small initial timestep was set for the model. This only occurred for HPC simulations. 5.8.4 Bug Fix for Forward Slash in Check File Path Build 2023-03-AB fixes an issue with “Write Check Files” and forward slashes. If the final character is a “” then this is treated as a path to the check folder, and all check files get written with the simulation name, e.g.: Write Check Files == ..\\check\\ However, if the final character is not a backslash then this is treated a prefix, e.g.: Write Check Files == ..\\check\\run_002 In the above example all files will be written to the ..\\check\\ folder and will use the prefix “run_002” instead of the simulation name. When using a forward slash notation (Write Check Files == ../check/) then this was being treated as a prefix and not a folder path. For build 2023-03-AB both \\ and / are treated as a path. 5.8.5 Bug Fix for Stability Issue with Thick Breaklines Applying the advanced weir equation over thin and thick breaklines was introduced in 2023-03-AA. However, it has become apparent that on rare occasions the depth adjustment applied to faces parallel to the flow (thick breaklines only) can cause a stability issue. The depth adjustment on these faces has been removed in version 2023-03-AB. This may produce very minor changes in results to models with thick breaklines. 5.8.6 Bug Fix for Small HPC models on CPU with a Large Number of Threads Previous versions of HPC (not Quadtree models) could fail to run due to an incorrect decomposition when splitting the model over a large number of CPU threads. This issue is fixed in 2023-03-AB. 5.8.7 Bug Fix with SGS Calculation For SGS Approach Method C, on very (very) rare occasions the SGS calculations for a cell could cause a cell to have a fixed storage instead of a height varying storage. This issue was introduced in 2023-03-AA and has been fixed in 2023-03-AB. For models that did generate an erroneous SGS calculation on a particular cell, a very small change in results may be expected. Due to this issue the XF files (described in Section 2.2.8 need to be updated if moving to the 2023-03-AB build from the 2023-03-AA build. 5.8.8 Bug Fix with Fixed Form Loss Coefficients in Quadtree When applying additional fixed form loss coefficients (“Set FLC”“, Read GIS FLC” and “Read Grid FLC”) within a Quadtree model, the coefficients were being incorrectly applied. This issue is fixed in 2023-03-AB. 5.8.9 Update to CHECK 3505 SGS TIN for Quadtree Model Build 2023-03-AB now only outputs “CHECK 3505 – SGS TIN Outside Model Domain for nesting level 1” when running Quadtree simulations. Previously this check message could be spuriously generated for TIN inputs that were within the base nesting level, but outside the extents of the finer nesting levels. 5.8.10 Bug Fix 2d_lfcsh Layers in Quadtree Snapped to Code Build 2023-03-AB fixes an unreported bug that could incorrectly treat polylines snapped to the code boundary in Quadtree. Previously this had the potential to cause a memory overrun and affect the model in unexpected ways. Not all polyline inputs are affected. Common inputs affected include 2d_zsh (and other breakline inputs), 2d_lfcsh, and 2d_po inputs. 5.9 2023-03-AD Minor Enhancements and Bug Fixes 5.9.1 Bug Fix - HPC Crashing During Initialisation with Exactly 256 Unique Material IDs Build 2023-03-AD fixes a bug when the user specifies exactly 256 unique material IDs. This would cause HPC to crash without an error during initialisation. This would only occur only in TUFLOW HPC and not TUFLOW Classic or Quadtree. Build 2023-03-AD increases the limit of unique material IDs for HPC from 256 to 1,000. This brings TUFLOW HPC in line with TUFLOW Classic and Quadtree. If the user specifies more than 1,000 unique material IDs “ERROR 2116 - Exceeded number of allowable Materials” will be produced. Note, the material ID must be a number between 1 - 32,767. 5.9.2 Bug Fix with Process All Grids Command The TUFLOW control file command: “Process All Grids == {OFF} | ON” controls whether raster input grids that are outside of the model domain are processed or skipped. Build 2023-03-AD fixes a bug where the default approach processed all grids, contrary to the 2018 TUFLOW Manual. From Build 2023-03-AD this correctly defaults to skipping raster grids that are outside the model domain and may provide an improvement in initialisation time compared to prior builds. 5.9.3 Bug Fix with Memory Allocation for Reading Grids with SGS Build 2023-03-AD fixes an issue which could cause “ERROR 3500 - Could not allocate temporary memory (RAM) for processing SGS GRID …(Method C)” to occur when a DEM was partially or completely outside of the TUFLOW model domain. This issue only occurred for the default SGS approach: “SGS Approach == Method C”. 5.9.4 Bug Fix for Cell Width Factor in HPC Build 2023-03-AD fixes an issue with cell width factors (CWF) not being correctly applied in HPC. This issue caused TUFLOW to crash after “Transferring Cell Width Factors (CWF)…” with no message. Note: any models using the HPC solver in conjunction with cell width factors (CWF) should be upgraded to the 2023-03-AD build. 5.9.5 Extra Information in XF Filenames Build 2023-03-AD adds the data type to the XF file name for raster input files read in with the “Read Grid” command. This occurs for all “Read Grid” options (e.g. soil, material, gwd, code, etc.) except for Zpts. This prevents a potential issue when multiple Read Grid” commands use the same dataset but sample the data at different locations. For example, materials are sampled at cell faces and centres, whilst soils are only sampled at cell centres. 5.9.6 Bug Fix for Wide Lines Build 2023-03-AD fixes an issue introduced in the 2023-03-AC build when using a “wide” line (width attribute &gt;1.5 times the cell size) in the layered flow constriction (2d_lfcsh) or the evacuation routes (2d_zshr) file format. For build 2023-03-AC this could cause a Fortran error to occur and the TUFLOW simulation to disappear with no log file output. 5.9.7 Enhancement for HPC and Quadtree Restart Files Build 2023-03-AD adds functionality to restart files to allow data fields to be ignored. To specify which fields to ignore a new command “Restart File Ignore Fields ==” can be set in the .tcf where the fields are any combination of: Geometry (elevations and Manning’s n values) Groundwater (groundwater depths and groundwater tracer concentrations) Maximum (scalar and vector maximums; both values and times, minimum timestep) Rainfall (cumulative rainfall, cumulative rainfall material losses and cumulative cell wet time) TimeOutputCutoff (Time Output Cutoff; time of first inundation and cumulative time inundated) Tracer (surface and groundwater tracer concentrations) Velocity (velocity and turbulence values) WaterLevel (water level) For example: “Restart File Ignore Fields == Geometry Groundwater” will ignore the geometry and groundwater information in the restart file (for these, the values set in the control files are used). By default (without the command above) the geometry information in the restart file is ignored and the .tgc information is used instead. See also HPC Restart Geometry == Restart File | {TGC} command. If the “Restart File Ignore Fields ==” command is included, but does not include geometry then message “WARNING 2902 -‘Restart File Ignore Field’ does not include geometry, overwriting geometry in .tgc with restart file” is issued. Note: Only one of “Restart File Ignore Fields” or “HPC Restart Geometry” should be used, an error is given if both commands are present in a control file. 5.9.8 Quadtree - Removes One Parent Polygon Requirement (Fast Method) Build 2023-03-AD removes the requirement that a nesting polygon can have no more than one parent polygon (i.e. a “level 3” polygon must only sit inside no more than one “level 2” polygon). This removes the occurence of “ERROR 2831 - More than 1 parent polygon for polygon with nesting level”. The memory efficient method has not changed and is still contrained to no more than one parent polygon. 5.9.9 Bug Fix for No Time Series Output in run_stats.txt Build 2023-03-AD fixes an issue that the run_stats.txt file is blank if only maximum map outputs were being written and the “Mass Balance Output Interval” was not specified. 5.9.10 Enhancement Automatic Recreation of Invalid XF Files In previous versions, some incompatible XF files would result in TUFLOW stopping with the message to delete the XF file and rerun. Build 2023-03-AD modifies the code to automatically recreate the incompatible XF files. 5.9.11 Changes to Reported Timestep Efficiency A minor change has been made to the calculation of model 2D efficiency when using HPC (including Quadtree). With 1D/2D linked models, HPC can be called to solve the 2D domain for a timestep that is smaller than what it can actually stably use. An instantaneous 2D efficiency value is computed that represents the ratio of actual 2D timestep to possible 2D timestep. The 2D efficiency value reported to console and log file was intended to represent the time weighted average of this number from the beginning of the simulation. If a 1D/2D linked model starts with a period of dry, the 2D efficiency can be expected to be low during the dry period due to the 1D timestep constraining the model, and then improve once the 2D domain became wet and the 2D timesteps became similar to the 1D timestep. However, there was an error in the calculation method and the reported efficiency value was remaining very low for the remainder of the simulation even though the model was actually running efficiently. This has been corrected and the reported 2D efficiency is now more representative for such models. This code change does not affect time stepping or results in any way. 5.9.12 Fix to Initial Groundwater Map Output Results with “GT” Boundaries Build 2023-03-AD fixes an issue where the groundwater map outputs at the start of the simulation did not reflect the groundwater levels being applied at any groundwater-time (GT) boundaries. Subsequent map output were correct and this change does not affect the hydraulic computations. 5.10 2023-03-AE Minor Enhancements and Bug Fixes 5.10.1 Bug Fix for HPC Running on Multiple GPU/CPU Build 2023-03-AE fixes a critical issue in the 2023-03-AD build when running HPC solver over multiple GPUs or multiple CPU threads (which is the default when solving on CPU). When processing water level and groundwater level boundaries (HT, HQ and GT type boundaries), the 2023-03-AD version could result in incorrect levels being applied at the boundary. This was dependent on which compute device the boundary was within. Any simulations using HPC with multiple GPUs or CPU threads using the 2023-03-AD release should upgrade to 2023-03-AE. This issue did not affect Classic or Quadtree simulations. "],["BndLnks-1.html", "Section 6 Boundaries and Links 6.1 Support for DSS File Format 6.2 SX Momentum 6.3 Structure Loss Adjustment for SX Connected 1D Structures 6.4 Quadtree Parallel Inertia on HT / HX Boundaries 6.5 HPC Support for Boundary Spline Interpolation 6.6 Default HPC Boundary Approach 6.7 QT 2d_bc Point Boundaries No Longer Supported in Classic/HPC 6.8 HQ 2d_bc Point Boundaries No Longer Supported in Classic/HPC/Quadtree 6.9 Support for Holland Cyclone/Hurricane in HPC/Quadtree 6.10 Minor Enhancements and Bug Fixes 6.11 2023-03-AB Minor Enhancements and Bug Fixes 6.12 2023-03-AC Minor Enhancements and Bug Fixes 6.13 2023-03-AD Minor Enhancements and Bug Fixes", " Section 6 Boundaries and Links 6.1 Support for DSS File Format The 2023-03 Release introduces support for time-series data from HEC-DSS files within a boundary condition database. HEC-DSS is a database system for time series, curve, gridded data and more developed by the U.S. Army Corps of Engineers Hydrologic Engineering Center (HEC). See their website at https://www.hec.usace.army.mil/software/hec-dss/ for more information. It is used by the HEC developed models for data input and output. Rather than convert HEC-DSS time-series curves for use in TUFLOW, this data can be accessed directly. HEC-DSS files organise data into paths with six parts (Part A – Part F) that resemble how files are organised on disk. Figure 6.1 shows an example DSS file with a single path, with the curve plotted below. Figure 6.1: Example DSS File To use a HEC-DSS time-series curve within a TUFLOW boundary condition database: Provide the filename in the “Source” column. Leave “Column 1”, which is used for time, blank (DSS files store the time with the curve values). Identify the pathname in “Column 2.” Event placeholders such as event can be used as part of the pathname. Wildcards (*) can be used for parts of the path, however, ensure the wildcards will not select more than one path within the file. The “Add” and “Mult” columns can be used to offset or scale the time-series values, the same as non-DSS time-series curves. Figure 6.2 shows how the time-series curve above could be included in a boundary condition database. A wildcard is used for Part D of the pathname (date range). Note that the pathname must start with a forward slash (/). Figure 6.2: Time-series Curve Example By default, TUFLOW uses the first point in the time-series curve as TUFLOW time-zero. This can be changed using the new command “HEC-DSS Start Date” to identify the date/time that should be used for time-zero. The date should be in the isodate format: yyyy-mm-dd hh:mm:ss, where the time portions are optional. HEC-DSS Start Date == 2022-01-01 Note: Non-time series data such as gridded data from a HEC-DSS file is not supported at this time. Contact support@tuflow.com to request other features that would be beneficial to your workflows. 6.2 SX Momentum 2023-03 Release has improved the handling of momentum flux at SX cells. This change has minor impact on SX cells with sub-critical flow. However, for the SX cells connected to high energy/velocity 1D structures, this enhancement would improve the boundary cell flow behaviour by applying appropriate momentum source/sink. For more details, please refer to the HWRS conference paper (Gao et al., 2022). HPC SX Momentum Approach == Method B Previously, only mass flux has been added to SX cells. For backward capability, please use: HPC SX Momentum Approach == Method A Note: Build 2023-03-AB fixes an minor issue with the reporting of HPC SX Momentum Approach in the .tlf which was missing a new line if Method A was specified. 6.3 Structure Loss Adjustment for SX Connected 1D Structures Build 2020-10-AA introduced a new beta option to extend the adjustment of contraction and expansion losses for 1D culverts and bridges to automatically adjust at 1D/2D SX connections (refer to Section 6.2 in the 2020 Release Notes). This feature has been tested using Venturi flume experiment and real-world flood model (Gao et al., 2022). However, it is still under development and remains as beta functionality. 6.4 Quadtree Parallel Inertia on HT / HX Boundaries For the 2023-03 Release the handling of inertia parallel at head boundaries for Quadtree simulations (“HT” and “HX” type 2d_bc layers) has been changed to “Method B” to provide better consistency with TUFLOW Classic and single level HPC. A new .tcf command has been introduced: Quadtree BC Parallel Inertia Approach == Method A | { Method B} To revert to the 2020 Release method, use “Method A”. 6.5 HPC Support for Boundary Spline Interpolation The 2023-03 Release adds support for boundary cubic spline interpolation (“S” flag in the 2d_bc layer) for HT and QT type boundaries in HPC and Quadtree. Previously, if users specified a spline interpolation HPC would use linear interpolation and no warning message was produced. 6.6 Default HPC Boundary Approach As outlined in Section 6.1.1 of the 2020 Release Notes, HPC Boundary Approach == Method C is now the default. This approach applies a boundary energy correction to HT boundaries but not for HX cells connected to the same node. 6.7 QT 2d_bc Point Boundaries No Longer Supported in Classic/HPC Build 2023-03-AD has removed support for ‘QT’ type boundaries using point geometries in the 2D domain for Classic/HPC models. If a ‘QT’ boundary using point geometry is encountered, TUFLOW will produce “ERROR 2835 - Not expecting point for BC layer with type: QT”. This change aligns Classic/HPC with Quadtree. It is recommended to use line geometry types when adding ‘QT’ boundaries to the 2D domain, however, for old models the command “Defaults == Pre 2023” can be used to enable QT points in Classic/HPC. 6.8 HQ 2d_bc Point Boundaries No Longer Supported in Classic/HPC/Quadtree Build 2023-03-AD has removed support for ‘HQ’ type boundaries using point geometries in the 2D domain for Classic/HPC/Quadtree models. If a ‘HQ’ boundary using point geometry is encountered, TUFLOW will produce “ERROR 2835 - Not expecting point for BC layer with type: HQ”. It is recommended to use line geometry types when adding ‘HQ’ boundaries to the 2D domain, however, for old models the command “Defaults == Pre 2023” can be used to enable HQ points in Classic/HPC. 6.9 Support for Holland Cyclone/Hurricane in HPC/Quadtree Build 2023-03-AD includes support in HPC/Quadtree for cyclone / hurricane wind and pressure fields with the Holland parametric model. Previously this feature was only supported in Classic. This is specified with either of the .tcf commands below, which are treated identically: Read GIS Cyclone == \\(\\langle\\)gis layer\\(\\rangle\\) Read GIS Hurricane == \\(\\langle\\)gis layer\\(\\rangle\\) This command can be used to read a cyclone or hurricane track. The attributes of the GIS layer are listed in Table 6.1 and are all float values. Only the first polyline in the layer is read and used for the track. Points are snapped to the line wherever attribute data are to be assigned. It is not necessary to have points snapped to every vertex of the line – values will be interpolated between the digitised points. There must be points with attribute data snapped to the start and end of the polyline track. The optional No Pressure and No Wind options deactivate the pressure/wind fields respectively. E.g. Read GIS Cyclone No Wind == \\(\\langle\\)gis layer\\(\\rangle\\) will only apply the pressure field and ignore the wind. Table 6.1: GIS Attribute Details for Cyclone (2d_cyc) layer Attribute Number GIS Attribute Description Data Type 1 Time Time in hours Float 2 p0 Pressure at the eye (hPa) Float 3 pn Pressure of surrounds (hPa) Float 4 R Radius to maximum winds (m) Float 5 B See reference below Float 6 rho_air Density of Air (kg/m3). If zero, Density of Air is used. Float 7 km Density of Air (kg/m3). If zero, Density of Air is used. Float 8 ThetaMax See reference below Float 9 DeltaFM See reference below Float 10 bw_speed Background wind speed in m/s (ignored if less than or equal to zero) Float 11 bw_dirn Background wind direction in degrees relative to East (0°), North (90°), etc. Float The generation of the wind and pressure fields are based on Appendix C of “Queensland Climate Change and Community Vulnerability to Tropical Cyclones – Ocean Hazards Assessment – Stage 1” (Queensland Government, 2001). The wind and pressure fields can be output using the WI10 and AP options for Map Output Data Types. The background wind is applied outside R (the radius of maximum winds), if it exceeds the cyclone/hurricane wind speed. Note: that Latitude must be specified (via .tcf command “Latitude == \\(\\langle\\)latitude value\\(\\rangle\\)”). 6.10 Minor Enhancements and Bug Fixes The 2023-03 Release includes a range of minor enhancements and bug fixes relating to boundaries. 6.10.1 Should Not Be Here When Reading TS1 File The 2023-03 Release changes a “Should not be here csv_to_binary[ncolA]” message to ERROR 0628. This error can occur if the TS1 file has become corrupted or if the user accidentally makes manual edits to the file. 6.10.2 Duplicate SA Boundary Names The 2023-03 Release changes the behaviour of HPC and Classic models that use multiple SA polygons with the same boundary name. In the 2023-03 Release, these boundaries are treated separately; as if they were different boundary names with the same hydrograph. Previously, these SA boundaries would be treated as a single boundary and the cells selected by each polygon would be grouped together. If duplicate SA boundary names are encountered, TUFLOW will issue CHECK 2492 in the 2023-03 Release. The old method can be invoked by reverting to the pre-2023 defaults and WARNING 2492 is produced instead of the check message. The previous method is not available in Quadtree as this has always used the 2023 default method. 6.10.3 CSV Inputs Containing Multiple Blocks The 2023-03 Release fixes an issue with XF files and .csv boundary data that could occur if there were multiple blocks of data within the .csv file. The file is considered to have multiple blocks when there is boundary data below other boundary data, for example in in Figure 6.3. Figure 6.3: CSV Input Containing Multiple Blocks If there are multiple blocks, no XF file will be generated in the 2023-03 Release and WARNING 0627 will be issued. Previously TUFLOW would generate an XF file for the first inflow block it read in and ERROR 0141 could be triggered if inflows in other blocks were required (as they would not be present in the XF file). 6.10.4 BC Zero Flow End Fixed in Quadtree The 2023-03 Release fixes the “BC Zero Flow == End” command for Quadtree models. Previously this command was not working and no warning message was produced. 6.10.5 BC Zero Flow CHECK Message The 2023-03 Release adds CHECK 0249 if the “BC Zero Flow ==” command changes the inflow hydrograph (i.e. the current start or end value was non-zero). 6.10.6 Automatic Initial Water Level When Interpolated The 2023-03 Release fixes a bug that could cause the incorrect water level to be applied when using “Set IWL == Auto”. This could happen if the automatic water level at the start time of the simulation required interpolation from the HT boundary data. 6.10.7 SX Region with Z Flag in Quadtree Model The 2023-03 Release fixes a bug that occurred when using a “Z” flag in a 2d_bc “SX” type region. Previously, the Z flag did not lower the cell face and corner elevations in Quadtree models. 6.10.8 Small SX Region Selects At Least One Cell in Quadtree Model Previously, if a small SX region doesn’t select any cell centroid in Quadtree models, the SX region was ignored. In the 2023-03 Release, the centroid of the SX region will be used to select at least one boundary cell. 6.10.9 Check for Correct Attribute for SA RF Boundaries Read GIS SA RF boundaries require 5 GIS attributes compared to the Read GIS SA which only requires a single attribute. For 2023-03-AA a check is performed that the GIS layer has at least 5 attributes and stops with ERROR 2589 if insufficient attributes are present. This can prevent TUFLOW from crashing when reading these boundaries. 6.10.10 Bug Fix for XF files when Time Column has Zero Rows of Data Build 2023-03-AA fixes an issue with processing and reading of boundary xf files, if the data in column 1, which is time for a level-time (HT) or flow (QT) has zero rows of data, but the column 2 has valid data. This will now generate an ERROR 0651 and halt the simulation. 6.11 2023-03-AB Minor Enhancements and Bug Fixes 6.11.1 Quadtree HQ Total Boundary - Should Not Be Here Build 2023-03-AB changes the ‘should not be here’ that could occur for quadtree models when using an HQ boundary ‘Total’ approach (this is the default method for HQ boundaries) to ERROR 2858. The error was being triggered by the cell selection algorithm failing to create a contiguous line of cells which is required to generate a rating curve. This is in turn can be caused by refinement areas being snapped to the boundary line and causing varied cell size along the boundary (where the line can also pass through inactive areas). The best solution to the error is to buffer refinement areas away from the boundary line. 6.11.2 Better Handling of Null Objects in 2d_sa Layer Build 2023-03-AB improves the handling of Null objects in the 2d_sa input layer. The objects have no geometry and could previously cause an ERROR 2041 to be issued. For build 2023-03-AB these are ignored. 6.12 2023-03-AC Minor Enhancements and Bug Fixes 6.12.1 Fixes Issue with NetCDF Rainfall with Times Greater Than 1,000 Hours Build 2023-03-AC fixes an issue with NetCDF rainfall inputs with time values greater than 1,000 hours and boundary increments smaller than 1hr, previously this could cause the rainfall boundary to be updated only every hour and not at the boundary frequency. 6.12.2 Fixes Issue with Rainfall Control File with Greater than 1,000 Output Times Build 2023-03-AC fixes an issue with creating gridded rainfalls in NetCDF file format if more than 1,000 hours hyetograph points was used. Previously this could cause a simulation to terminate during initialisation. 6.13 2023-03-AD Minor Enhancements and Bug Fixes 6.13.1 Bug Fix for 2D HQ Boundaries Selecting Only One Cell Build 2023-03-AD fixes a bug that could cause unexpected behaviour (e.g. unrelated errors may be thrown spuriously during initialisation) if a HQ boundary that only selected a single cell was used. This would only occur if the HQ boundary that selected a single cell was the last HQ boundary processed by TUFLOW. 6.13.2 Bug Fix for Quadtree Automatic SX Connections Where “Conn_No” is Set to -1 Build 2023-03-AD fixes a bug affecting Quadtree models only, where the functionality of setting the “Conn_No” to “-1” for 1d_nwk layers was not working. When setting the “Conn_No” to “-1”, TUFLOW should connect the pit or node to one 2D cell only, irrespective of the width. Previously, for Quadtree models, the number of 2D cells selected was still being controlled by the width of the pit or node. 6.13.3 Bug Fix for SA Check Files Build 2023-03-AD fixes an issue that could occur in Quadtree models if writing check files in mif/mid format in conjunction with using the Read GIS SA ALL command. If this combination resulted in more than 10,000 cells being selected by a single SX polygon, TUFLOW would crash. In In addition to fixing this, a change has been made to ensure the SAC check file consistently writes all selected cells when the “ALL” option is used. 6.13.4 Bug Fix for Very Large Models with SX Connections Build 2023-03-AD fixes an issue that could cause TUFLOW to crash when writing the first output, with no error message. This issue only occurred for very large models with a significant number of SX connections. 6.13.5 Bug Fix for Gridded Rainfall in HPC Build 2023-03-AD fixes an issue that could occur with gridded rainfall when the time of first rainfall was after the start of the simulation and there was no temporal map output at the time of first rainfall. This could cause the rainfall grids to be updated incorrectly, resulting in some grid times to be skipped. This issue could affect HPC (including quadtree), but did not affect Classic simulations. 6.13.6 Support for Global Wind Boundary in Quadtree Build 2023-03-AD includes support in Quadtree for global wind stress applied via a Global Wind BC == \\(\\langle\\)boundary name\\(\\rangle\\) in the .tesf. Refer to Section 7.6 of the 2018 TUFLOW Manual for documentation of this functionality. References Gao, S., Ryan, P., Syme, W., &amp; Collecutt, G. (2022). The End of the 1D Open Channel Cross-Section? Hydrology &amp; Water Resources Symposium. https://tuflow.com/media/7547/2022-the-end-of-the-1d-open-channel-cross-section-gao-et-al-hwrs.pdf Queensland Government. (2001). Queensland Climate Change and Community Vulnerability to Tropical Cyclones - Ocean Hazrds Assessment. https://www.systemsengineeringaustralia.com.au/download/Ocean_Hazards_Assess_Stage1A_revised.pdf "],["GISFormats-1.html", "Section 7 GIS Formats 7.1 GeoPackage Format 7.2 GeoTIFF Format 7.3 NetCDF Grid 7.4 2023-03-AB Minor Enhancements and Bug Fixes 7.5 2023-03-AC Minor Enhancements and Bug Fixes 7.6 2023-03-AD Minor Enhancements and Bug Fixes", " Section 7 GIS Formats The 2023-03 Release increases support for GIS formats with new vector and raster formats supported for both reading and writing of GIS data. The newly supported formats are GeoPackage (for both vector and raster data) and GeoTIFF (for raster data only). The 2023-03 Release also extends capabilities for the existing supported NetCDF raster format. The sections below describe the new and extended formats. 7.1 GeoPackage Format GeoPackage vector and raster support has been added for the 2023-03 Release for reading and writing of both vector and raster data. GeoPackage (https://www.geopackage.org/) is a widely supported, open format, built upon an SQLite database (this is stored as a single file with the extension .gpkg). The benefits of this format include: More than one layer can be stored in a single file. For example, all model inputs can be stored in a single GeoPackage database. It supports spatial indexing, making it much faster to work within GIS packages. Faster to write from TUFLOW than Shapefile format. Initially this was added to address some issues with the existing supported vector file formats, notably slow writing and viewing of Shapefiles for large datasets. The MapInfo (MIF/MID) file format is much faster to write from TUFLOW than the Shapefile format, however, loading, rendering, and interacting with the MIF file in GIS packages is much slower than either the Shapefile or GeoPackage. When loading either a MapInfo or Shapefile layer into GIS, typically all the data is loaded and processed when panning the map window, even the ones that are outside of the current view. GeoPackage supports spatial indexing, so that when the view is panned or changed a limited set of objects (within that view) need to be drawn, this makes rendering and interacting with the data much faster. Load the file into QGIS and view the grid for the entire model. Zoom to a small portion of the model and redraw. Table 7.1 shows approximate times taken for TUFLOW to: Write the grid check files. Note, the model has approximately 1.3 million 2D cells, all data was written to local SSD and loaded into QGIS (3.22.1) Load the file into QGIS and view the grid for the entire model. Zoom to a small portion of the model and redraw. Table 7.1: Time to Write and View Check Files in QGIS GIS Format Write grid check (seconds) Load into QGIS and draw all grid cells (seconds) Zoom into to small area (seconds) MIF 7 232 25 SHP 113 40 5 GPKG 47 18 &lt;1 7.1.1 GeoPackage Projection A projection can be defined (used to set the projection used by TUFLOW for GeoPackage files), with the following .tcf command: GPKG Projection == \\(\\langle\\)GPKG layer\\(\\rangle\\) This needs to reference an existing GeoPackage file which can contain either vector or raster data. To create a new GeoPackage file and set the projection in QGIS the following steps are required: From the menu select Layer &gt;&gt; Create Layer &gt;&gt; New GeoPackage Layer. In the New GeoPackage Layer dialogue: Set a database filename and location (e.g. projection.gpkg). Set a table name, typically this would be the same as the filename without the extension. Choose a geometry type (it shouldn’t matter which type is selected, but no coordinate system can be set without a type). Set the CRS for your model. Select “OK”, the GeoPackage file is now ready to be used in TUFLOW. 7.1.2 GeoPackage Vector 7.1.2.1 GeoPackage Vector Inputs The GIS outputs from TUFLOW can be set to GPKG by using the following command: GIS Format == GPKG Since a GeoPackage database can have more than one layer, when reading data into TUFLOW a GeoPackage file and table may need to be specified. The following options are possible: To specify a table in a .gpkg use “&gt;&gt;”: Read GIS Z Shape == gis\\2d_zsh.gpkg &gt;&gt; 2d_zsh_L Specify a .gpkg file path only. It will assume the table name is the same as the .gpkg database name. For example, the below commands are equivalent: Read GIS Z Shape == gis\\2d_zsh_L.gpkg Read GIS Z Shape == gis\\2d_zsh_L.gpkg &gt;&gt; 2d_zsh_L To specify more than one table in a database in the same command line by using “&amp;&amp;”. This is similar to “|” however there is no need to reference the database again: Read GIS Z Shape == gis\\2d_zsh.gpkg &gt;&gt; 2d_zsh_L &amp;&amp; 2d_zsh_P “&amp;&amp;” can be used in conjunction with “|”: Read GIS Z Shape == gis\\2d_zsh_R.gpkg | gis\\2d_zsh.gpkg &gt;&gt; 2d_zsh_L &amp;&amp; 2d_zsh_P Use the command “USE ALL” with “&gt;&gt;” to tell TUFLOW to use all tables in the database: Read GIS Z Shape == gis\\2d_zsh.gpkg &gt;&gt; USE ALL Specify a database to use for subsequent inputs, which can be changed as inputs are read in: Spatial Database == gis\\2d_zsh.gpkg Read GIS Z Shape == 2d_zsh_L | 2d_zsh_P Spatial Database == gis\\2d_mat.gpkg Read GIS Mat == 2d_mat_R This command can be used in the .tcf, .ecf, .tbc, .tgc, .qcf, .tef. Commands are localised to their relevant control file with the exception of the .tcf which acts as a global command - local spatial database will take precedence. The spatial database can be turned off or reverted to the .tcf database with the same command. Turning it off is a global command even when used in a control file other than the .tcf. Regardless of the default GIS extension, if there is an open database TUFLOW will not append “.mif” to the end of the table name. Spatial Database == OFF | TCF 7.1.2.2 GeoPackage Vector Outputs Outputs can be written into separate databases or grouped: Spatial Database Output == SEPARATE | {GROUPED} Grouped databases will group by output folder location. Separate databases will still group geometries together e.g., PLOT_P, PLOT_L, PLOT_R will be written to one database. 7.1.3 GeoPackage Conversion Check GPKG layers include a primary key attribute (as an integer value) which is sometimes included in the attribute table in GIS programs (this happens in QGIS). This is completely fine for GPKG layers as TUFLOW expects this attribute to be present within the format, however if the layer is converted to a different format (e.g. shapefile) the primary key is sometimes retained as an attribute in the converted file. This can cause issues in TUFLOW as this will not always throw an error since some TUFLOW layer types are expected to contain an integer value in the first column. For example, this will happen with quadtree nesting level (2d_qnl) layers and TUFLOW will interpret the primary key as a nesting level value (and the actual nesting level value will be ignored). Typically the name of the primary key is “fid” in GPKG layers (however this is not necessarily always the case). TUFLOW will produce ERROR 0248 if it finds the first field name is ‘fid’ for shapefiles and mif files as this is an indicator that the layer has been incorrectly converted from GPKG. This message can be changed to a warning by using the following command: GPKG Conversion Check == WARNING 7.1.4 GeoPackage Raster TUFLOW supports the GeoPackage raster format via the ‘Gridded Tiled Coverage’ extension to the standard GeoPackage specification. This extension is supported by QGIS and GDAL, however to the best of knowledge of the TUFLOW team at the time of the 2023-03 Release, it is not currently supported by either MapInfo or ArcGIS. The format uses a tiled structure to make rendering and loading faster by enabling the ability to only process the required tiles. The tiled structure also makes pyramids (sometimes referred to as ‘overviews’) inherently available for the format. Note, the 2023-03 Release does not support pyramid creation yet, however, this functionality may be added in a later Release. 7.1.4.1 GeoPackage Raster Inputs Using a GPKG raster is done in the same manner as a GPKG vector layer (Section 7.1.2) but using the ‘Read GRID’ command, for example either of the below commands: Read GRID Zpts == grid_SI_Unit_01.gpkg Read GRID Zpts == grid_SI_Unit_01.gpkg &gt;&gt; DEM_SI_Unit_01 The GPKG projection command stated in (Section 7.1.1) will also work for GPKG raster layers. 7.1.4.2 GeoPackage Raster Outputs The following existing output commands can be extended to use GPKG: Grid Format == GPKG ! sets the default grid format of the model Map Output Format == GPKG HRGPKG ! adds GPKG as a gridded output [GPKG | HRGPKG ] Map Output Interval == \\(\\langle\\)interval\\(\\rangle\\) ! sets the output interval for GPKG gridded output The GPKG raster outputs will also be grouped if the grouping spatial database command is used from Section 7.1.2 (e.g. the DEM_M and DEM_Z will be in the same GPKG database as the 2D check vector layers). 7.1.4.3 GeoPackage Raster Compression The GPKG raster format supports LZW compression of the data. The data is compressed by default, however, can be turned off with the following command: GPKG Compression == NONE | {LZW} By default, TUFLOW will also use a compression predictor to improve the compression ratio, this can be turned off using the following command: GPKG Compression Predictor == NONE | {Horizontal Differencing} Limitation: Currently TUFLOW only supports GPKG raster data containing 32-bit floating point data. This is limited to the ‘Gridded Tiled Coverage’ extension as the native raster support in GPKG currently only supports PNG and JPEG encoding. 7.2 GeoTIFF Format The GeoTIFF raster format is supported in the 2023-03 Release for both inputs and outputs. The following command will set GeoTIFF as the default grid format: Grid Format == TIF The GeoTIFF raster format can be added as a gridded map output: Map Output Format == TIF HRTIF A projection can be set for the output GeoTIFF rasters by using the following command in the TCF: TIF Projection == /path/to/geotiff Only the header information is read in from the file with this command, so it is safe to use large files without any negative impacts on start-up speed. A projection is not required to output to the GeoTIFF format, however it is required to include the spatial reference system in the output GeoTIFF. Currently there is no input projection checking of raster layers (like there is for GIS vector inputs) and the projection is only used for the GeoTIFF outputs. TUFLOW supports several compression methods for GeoTIFF: LZW (Read/Write) DEFLATE (Read/Write) PACKBITS (Read only) The data is compressed by default when writing to GeoTIFF format using the ‘deflate’ method, however, can be changed or turned off using the following command: TIF Compression == NONE | LZW | {DEFLATE} By default, TUFLOW will also use a compression predictor to improve the compression ratio, this can be turned off using the following command: TIF Compression Predictor == NONE | {Horizontal Differencing} Testing has shown that using deflate compression with horizontal differencing will typically achieve better compression than the typical method of using a ZIP file on the same uncompressed data. TUFLOW will default to using all available CPU cores when reading/writing GeoTIFF files which can speed up processing when using compression. This can be changed by specifying the number of threads using the command line argument “-nt[thread count]”. Limitations: Currently TUFLOW only supports GeoTIFFs containing 32-bit floating point data. Currently does not support ‘Cloud Optimised GeoTIFFs’ or the tiled GeoTIFF format. GeoTIFFs support multiple raster bands, however TUFLOW will currently assume the input dataset is within the first raster band. Currently TUFLOW only supports unrotated GeoTIFF rasters. 7.3 NetCDF Grid NetCDF grids are now supported as standard raster inputs for all “Read GRID ==” commands in the .tgc. Previously, NetCDF grids were supported for rainfall and external stress inputs only. The NetCDF raster inputs should follow the NetCDF CF Convention and are treated as a database within TUFLOW (similar to GPKG). The new database input command options are: Read GRID Zpts == grid_SI_Unit_01.nc &gt;&gt; DEM_SI_Unit_01 and Spatial Database == grid_SI_Unit_01.nc Read GRID Zpts == DEM_SI_Unit_01 Limitation: NetCDF rasters support multiple raster bands, however TUFLOW will currently assume the input dataset is within the first band. Note, rainfall and external stress NetCDF inputs remain unchanged and do not use the new syntax. 7.4 2023-03-AB Minor Enhancements and Bug Fixes 7.4.1 Spatial Database Command Now Works in Quadtree Control File Build 2023-03-AB fixes an issue when using the “Spatial Database” command in the Quadtree Control File (.qcf). Previously, when setting either the “Base Cell Size”, “Model Origin and Extent” or “Orientation Angle” to “TGC” the Spatial Database command referenced in the QCF could be overwritten by the spatial database reference in the TGC. 7.4.2 Read GRID Location Now Works for New Raster Formats Build 2023-03-AB now accepts GeoTIFF, GPKG raster, and NetCDF raster formats for the “Read Grid Location” command in the TGC. This was previously only working for Quadtree in the 2023-03-AA build 7.4.3 Compression Now Allows for Size Increase Build 2023-03-AB now allows compressed sizes to become bigger than the uncompressed size. This is applicable for both DEFLATE and LZW compression methods and for GeoTIFF and GPKG raster formats. These formats store data in blocks of tiles or strips and each block of data is compressed individually. Previously, if one of these compressed blocks became larger after compression, it would cause ERROR 0635. The 2023-03-AB release allows compression to get larger. Note this may only be for a single block of data and not necessarily reflect what is happening to the overall file size under compression. 7.4.4 Increase Primary Key Column Name Length Build 2023-03-AB increases the allowed column name length for the GPKG primary key column name from 5 to 50. This only affects reading GPKG layers created from certain applications. For example, the QGIS Kart plugin when converting from a SHP to GPKG will create a primary key column name exceeding 5 characters (it used ‘auto_pk’). 7.4.5 Retry Loop for Locked GPKG Databases Build 2023-03-AB will enter a retry loop while trying to open a GPKG for reading if the database is locked. The retry loop pauses for 1 second before trying again and to prevent an infinite retry loop, TUFLOW will error if it fails to open the database 10 times. Previously this could occur (very rarely) if more than one TUFLOW model was initialising at the same time and using the same input GPKG database(s). 7.4.6 GPKG XF File Naming Build 2023-03-AB changes the file naming convention for GPKG XF file names. Previously the convention was to use the database name followed by all layer names (then conventional XF naming suffixes), for example: 2d_ztin_EG07_010.gpkg_2d_ztin_EG07_010_L_2d_ztin_EG07_010_P.d1.5m_T00001.xf4 However, because these file names can become very long, build 2023-03-AB has changed the approach and hashes the layer names into an 8 character long hexadecimal number which allows TUFLOW to check for file name consistency and limits the filename length, for example: 2d_ztin_EG07_010.gpkg_FEBB7271.d1.5m_T0001.xf4 7.4.7 Bug Fix “Reached maximum concurrent SQLite statements” Build 2023-03-AB fixes a bug that could occur when another application had the same GPKG database open for editing while TUFLOW was trying to read it. This would only occur if the same database was opened and closed many times by TUFLOW. Previously ERROR 0636 and ERROR 0647 was triggered in these situations. 7.4.8 Bug Fix “ERROR 0636 – Issue stepping through SQLite query” Build 2023-03-AB fixes a bug that could occur reading a GPKG layer that contained mis-matched ‘rowid’ and ‘fid’ attributes (‘rowid’ is an internal attribute within SQLite tables and ‘fid’ is the common name for the primary key column in a GPKG layer). This could occur for any number of reasons and the user has very little control over this. Note, there is no requirement for the ‘rowid’ and ‘fid’ column to be in sync and the GPKG layers are not considered corrupt or invalid if this happened. If the ‘rowid’ and ‘fid’ columns became mis-matched, TUFLOW could sometimes produce “ERROR 0636 – Issue occurred stepping through SQLite Query”. This was caused by incorrect parameters passed to the SQLite API routines which has now fixed in TUFLOW 2023-03-AB. 7.4.9 GPKG Multi-Part Polygons In build 2023-03-AB the treatment of multi-part polygons in GPKG are now identical to SHP/MIF. Previously they were treated slightly differently, they were treated as a single polygon with multiple rings. This will not affect the inputs in most cases except where different polygon parts from the same feature overlapped, or for some inputs in TUFLOW that allowed for multi-part features but not for polygons containing multiple rings (e.g. polygons with holes). 7.4.10 ERROR 0305 Triggering When There is No GPKG Projection Build 2023-03-AB no longer triggers ERROR 0305 or WARNING 0305 when a GPKG Projection is not included in the TCF. Previously this message could trigger if a SHP Projection was included. 7.5 2023-03-AC Minor Enhancements and Bug Fixes 7.5.1 GPKG XF File Creation Causing “ERROR 0645” Build 2023-03-AC fixes a bug when reading multiple GPKG layers on a single line using the Shapefile convention (e.g. Read GIS Z Shape == 2d_zsh_L.gpkg | 2d_zsh_P.gpkg). Prior to 2023-03-AC, using this syntax could cause “ERROR 0645 - Could not determine layer name, please check syntax” when TUFLOW was creating an XF file name. This error did not cause TUFLOW to terminate and only affected XF file creation and did not stop the layer being processed correctly otherwise (i.e. the layer would be correctly processed when reading the spatial and attribute data). 7.5.2 Bug Fix For GPKG When “fid” Was Not the Same as “rowid” Build 2023-03-AC fixes a bug when reading a GPKG layer that contained entries where the GPKG “fid” column was not equal to the internal SQLite “rowid” column. This would cause an infinite loop of “ERROR 0636 - Issue occurred stepping through SQLite query” and a “Should not be here [stmntID=0]”. 7.5.3 Exit TUFLOW if an ERROR Occurs Reading GPKG Build 2023-03-AC will correctly error and exit if an unexpected error occurs reading a GPKG layer. Previously certain errors could cause an infinite loop to occur (e.g. the error reported in Section 7.5.2) 7.5.4 Bug Fix GPKG Reading 1d_pit Build 2023-03-AC fixes a bug that could cause TUFLOW to exit uncleanly when reading a GPKG 1d_pit layer. This error was caused when TUFLOW checked the 1d_pit column names which was introduced in build 2023-03-AB with the addition of the ability to add a time lag for virtual pits. 7.5.5 GeoTIFF Now Supports “SPARSE_OK=TRUE” GDAL Creation Option Build 2023-03-AC now supports reading GeoTIFFs created with the “SPARSE_OK=TRUE” creation option. This option is available when creating GeoTIFFs using GDAL and will not write strips where only nodata values exist. 7.6 2023-03-AD Minor Enhancements and Bug Fixes 7.6.1 Bug Fix - Crash While Reading GeoTIFF Inputs Build 2023-03-AD fixes a bug that could cause TUFLOW to crash while reading a GeoTIFF input. This crash was caused by a stack overflow and could occur when reading very wide raster inputs (&gt;15,000 columns). 7.6.2 Raster Cell Shape Check Build 2023-03-AD adds a check on the cell shape of an input raster. If the cell width is not equal to the cell height (i.e. not square), TUFLOW will produce “ERROR 0657 - Grid does not use square cells”. 7.6.3 GeoTIFF Coordinate Reference System Check Build 2023-03-AD adds a check when reading a GeoTIFF raster on the Coordinate Reference System (CRS). If the CRS is a geographic type (i.e. it uses spherical coordinates), TUFLOW will produce “ERROR 0635 - GeoTIFF is using a geographic coordinate reference system”. Similarly, if a GeoTIFF using a geographic CRS is input with the “TIF Projection ==” command, TUFLOW will produce “ERROR 0656 - GeoTIFF projection is geographic and cannot be used as a TIF Projection”. 7.6.4 GPKG Projection Accepts String Input Build 2023-03-AD enhances the GPKG projection command so that it can accept a string representation of the projection: “GPKG Projection == &lt;path/to/file&gt; | string” The string is a representation of the table entry that would be entered into the metadata table “gpkg_spatial_ref_sys” with columns delimited by “|”. There is expected to be 5 columns: srs name | srs id | organisation | organisation coordinate system id | definition An example below is presented using the projection used in the TUFLOW tutorial model: WGS 84 / UTM zone 60S|32760|EPSG|32760|&lt;OGC WKT Prj&gt;* *Note: the definition is typically written out in a Well Known Text Format (WKT) as published by the Open Geospatial Consortium (OGC) (this is typically the same as what is in the .prj file accompanying Shape Files) and hasn’t been written out fully in this example. The GPKG Projection has been updated in the TUFLOW Log File (TLF) to write out in the format above such that it can be copied into the TCF. 7.6.5 Bug Fix - Spatial Database == [path/to/gpkg] When Used in a Read File Within The TCF Build 2023-03-AD fixes a bug that would not correctly override the current TCF spatial database when using “Spatial Database == [path/to/gpkg]” inside a TUFLOW Read File (TRD) (that was read into the TCF). Prior to 2023-03-AD, the spatial database would be correctly used in the TRD but would then revert to the previously specified database after exiting the TRD (it should be retained, overriding any previously specified database). Note: for all other control files, any “Spatial Database == [path/to/gpkg]” command used in a TRD is localised to the TRD and should be reverted when finished reading the TRD. 7.6.6 Bug Fix - Spatial Database == OFF When Used in a Read File Build 2023-03-AD fixes a bug that could cause the spatial database to not be turned off correctly when using the command “Spatial Database == OFF” inside a TRD file (i.e. a file read in using “Read File == ”). 7.6.7 GPKG Fully Implemented in Package Model Functionality Build 2023-03-AD incorporates GPKG fully into the package model functionality. Prior to 2023-03-AD, GPKG files would be copied only if specified in “Spatial Database == ” command or if referenced in a command without using the “&gt;&gt;” syntax. Build 2023-03-AD also stops “CHECK 0712 - No file extension for GIS layer assuming .mif” from being erroneously written to the package model log file (pm.log) when copying GPKG inputs used in conjunction with “Spatial Database ==”. The package model functionality will not copy GPKG databases multiple times when used in conjunction with “Spatial Database ==”. The following scenarios describe when a GPKG will, and will not, be copied multiple times: “Spatial Database == database.gpkg” - database.gpkg will not be copied multiple times (as layers are read in subsequent commands) “database.gpkg &gt;&gt; layer1 &amp;&amp; layer2” - database.gpkg will not be copied multiple times “database.gpkg &gt;&gt; layer1 | database.gpkg &gt;&gt; layer2” - database.gpkg will be copied twice “database.gpkg &gt;&gt; layer1” - database.gpkg will be copied each time it is referenced in this way “database.gpkg” - database.gpkg will be copied each time it is referenced in this way Note: The package model functionality does not process the inputs and copies layers using a system copy. Therefore the entire database will be copied each time, including all layers contained within, which may contain unwanted or superseded inputs. 7.6.8 GPKG Reading - Change in Default Journal Mode Build 2023-03-AD changes the default SQLite journal mode when TUFLOW reads a GPKG input. The journal mode is now un-altered when reading inputs and the current journal mode of the database is unchanged. Prior to 2023-03-AD, TUFLOW would always set the SQlite journal mode to ‘WAL’ (Write Ahead Log). This change ensures that TUFLOW does not modify the input GPKG when it opens it for reading. Previously, if the GPKG was set to a journal mode other than ‘WAL’, the GPKG file would be modified when TUFLOW opened it and changed the journal mode. This could cause issues if any scripts, setup by the user, were running to check for file modification date changes (although no layer/input was modified). Users should be aware that QGIS typically opens GPKGs with the journal mode set to ‘DELETE’ when viewing layers and will change to ‘WAL’ for editing/writing. This would cause modification dates to change when alternating between running TUFLOW and viewing inputs in QGIS. TUFLOW still uses ‘WAL’ journal mode for output GPKG layers. 7.6.9 Support for User SQL When GPKG Databases are Opened Build 2023-03-AD adds support for custom user SQLite SQL that will be executed when a GPKG database is opened. This has been added with the intention to give users the ability to change general SQLite database settings (e.g. the SQLite journal mode) and negates the need to have custom TUFLOW commands for each available setting. The command is intended for use with SQLite ‘Pragma’ commands and not for adding, removing, or selecting from tables. A list and description of SQLite Pragma commands can be found on sqlite.org. CAUTION: please be careful using these as changing some settings can be dangerous and make your GPKG database incompatible with TUFLOW (e.g. changing the database encoding is a bad idea - if unsure, create backups!). SQLite On Open SQL [ {} | Read | Write ] == [SQL] Optional ‘Read’ and ‘Write’ context keywords can be used to restrict the SQL to only when TUFLOW is reading a GPKG or writing a GPKG. If no additional keyword is used (the default), the SQL is applied to both reading and writing contexts. An example of using this command to change the SQLite journal mode to ‘WAL’ (generally SQLite is not case sensitive): SQLite On Open SQL == PRAGMA journal_mode = WAL; User commands are applied after any default settings used by TUFLOW, and will take precedence. Multiple commands can be specified by separating the commands with a semicolon (‘;’) on a single line, otherwise using the TUFLOW command multiple times will overwrite previous settings. 7.6.10 GPKG Improved Error Messaging if Polygon/Polyline Vertex Count Exceeds TUFLOW Limit Build 2023-03-AD improves the error messaging reported by TUFLOW when it exceeds the TUFLOW vertex limit for GPKG layers. “ERROR 0310 - Exceeded number of allowable nodes in a single polyline or region. Requested (part no. 1, ring no. 6357) 500034 Limit 500000” is now reported, similar to the message reported by Shapefiles for the same restriction. In the error message, “part no.” refers to the current polygon part that is being processed (only applicable if reading in a multi-part geometry) and the “ring no.” refers to the polygon ring number that is currently being processed (multiple polygon rings often represent holes in the polygon). GPKG counts the number of vertices as it processes each ring, therefore the requested number may not be the final vertex count (it is the vertex count at the ring it is currently processing). 7.6.11 Bug Fix - GeoTIFF Grids Being Cutoff Build 2023-03-AD fixes a bug when outputting GeoTIFF grids where the output grid was not covering the entire model extent for really wide or long grids (more likely to happen with high-resolution outputs). This error occurred when the height or width of the grid was greater than 65,535 cells. 7.6.12 Bug Fix - GPKG XF Files Not Updating Build 2023-03-AD fixes a bug that could occur when using a GPKG input layer, if the GPKG input layer was modified after an XF files had previously been written. Previously, TUFLOW could incorrectly use the XF file, even if the GPKG layer is newer, due to a mis-match in timezones between the modification date stored in the GPKG (UTC) and the XF file (local). 7.6.13 Enhances Handling of Line Breaks in Attributes Build 2023-03-AD enhances how accidental line breaks are handled in GIS attributes. If a line break is encountered, build 2023-03-AD will replace the line break with a space and report CHECK 0659. Example: CHECK 0659 - Replacing new line character in attribute with space: “FC04.1_C\\n” The location of the line break in the attribute value will be denoted using “\\n”. "],["OutChecks-1.html", "Section 8 Outputs and Check Files 8.1 Additional Options for Record Gauge Data Outputs 8.2 Time of Max Water Level Switch 8.3 Time of Max Velocity Off by Default 8.4 File Access Timeout 8.5 Additional Check Grid Formats 8.6 High Resolution Map Output Includes Additional File Formats 8.7 New Map Output Data Types 8.8 Changes to Simulation Computational and Clock Times 8.9 Support Added for 2d_glo in HPC and Quadtree 8.10 Support For “H_” Po Lines Removed 8.11 Minor Enhancements and Bug Fixes 8.12 2023-03-AB Minor Enhancements and Bug Fixes 8.13 2023-03-AC Minor Enhancements and Bug Fixes 8.14 2023-03-AD Minor Enhancements and Bug Fixes", " Section 8 Outputs and Check Files 8.1 Additional Options for Record Gauge Data Outputs The 2023-03 Release now allows the user to choose whether to automatically include reporting location lines, reporting location points, and gauge locations (PO ‘G_’ type) when processing gauge receptor objects. The following command can be used to specify which location types to include: Record Gauge Data == RLP | RLL | Gauge Or alternatively the following command can be used to exclude types: Record Gauge Data EXCLUDE == RLP | RLL | Gauge The default is to include all reporting locations lines, points, and gauges. 8.2 Time of Max Water Level Switch The 2023-03 Release adds an output switch in the .tcf that gives the user the ability to turn off the “TMax_h” output. This command builds on an existing command: Maximums Track Time == OFF Completely 8.3 Time of Max Velocity Off by Default For the 2023-03 Release, the “TMax_V” output has been switched off by default for TUFLOW Classic outputs to be consistent with TUFLOW HPC. The “TMax_V” output can be turned back on using the following command (available for TUFLOW Classic only): Maximums Track Time == Velocity 8.4 File Access Timeout Improvements have been made to how TUFLOW handles an .xf or .xmdf file that is locked whilst being written to. For both file types, TUFLOW will now repeatedly attempt to access the file. XF File access When multiple instances of TUFLOW are running from the same .tcf file (e.g. different events/scenario combinations), it is possible for these separate TUFLOW simulations to try to access the same .xf file at the same time. This could cause a “race condition” where only one simulation is able to open the file. Previously, TUFLOW would issue a dialog with a message that the file is locked. The user could continue once the XF file was no longer in use by another TUFLOW simulation. The 2023-03 Release will automatically wait for the file to become free and continue without user intervention. XMDF File access When running TUFLOW, XMDF files may become locked due to external use of the file, such as during file backups. The 2023-03 Release will wait for the file to become freed up to the maximum number of retries. The .tcf commands below can be used to modify the number of retries and time to wait between retries. The maximum number of retries is capped to prevent and infinite loops if the file is permanently locked. The commands control behaviour for both .xf and .xmdf files. File Retry Max Count == 40 ! Maximum number of retries File Retry Timeout == 30 ! Time in seconds to wait between retries 8.4.1 Bug Fix for Final SGS Elevation XF File Access Build 2023-03-AD fixes an issue which could cause the XF file access check to not work correctly for the final SGS elevations (XF file described in Section 2.2.8). This could cause a second simulation trying to write to the same file to pause with a dialogue box. 8.5 Additional Check Grid Formats All raster output format types are now supported for the check DEMs (DEM_M and DEM_Z). The type can be set using: GRID Format == ASC | FLT | {TIF} | GPKG | NC | TGO | WRR 8.6 High Resolution Map Output Includes Additional File Formats All raster outputs now support a high resolution (HR) option, available when using SGS Method C. The below lists the available high resolution outputs which can be added as map outputs types in the .tcf: HRASC HRFLT HRTIF HRGPKG HRNC HRTGO HRWRR Customisation of the HR outputs is also possible for each type: HRTIF Map Output Data Types == d h HRTIF Map Output Interval == 0 Note, only depth and water level data types are supported with high resolution map outputs. 8.6.1 Viewing HRNC in TUFLOW Viewer The TUFLOW Viewer supports NetCDF raster viewing (NC and HRNC). This allows users to easily view and query high resolution temporal results using the same functionality available for XMDF. Please see the following wiki page for more information: https://wiki.tuflow.com/TUFLOW_Viewer_-_Load_Results_-_NetCDF_Grid 8.6.2 High Resolution Map Output Includes 1D WLL Elevations Previously, only 2D sub-grid elevations were used to generate the high resolution DEM_Z check file and depth output. 2023-03 Release now utilises the 1D channel bed elevation generated at 1D WLL (water level lines) as well. 8.7 New Map Output Data Types 8.7.1 HPC Control Numbers For HPC simulations the three timestep control numbers (Nu, Nc, and Nd) are now available as map output data types. These control number outputs are: Nu: Courant Number Nc: Shallow Wave Celerity Number Nd: Diffusion Number Note, these are only valid map output data types for HPC simulations, these are not available for Classic simulations. For TUFLOW Classic Courant Number “Cr” output is available. “Cr” map output is not valid for HPC simulations. 8.7.2 New Hazard Output – Auckland Council Hazard NZ Build 2023-03-AB introduces a new hazard category used by Auckland Council, New Zealand. This is specified with the “ZNZ2” map output data type. The categories are shown in Figure 8.1 and defined as: Category 1 (Low Safety Risk): D*V &lt; 0.4 V &lt; 3.0 m/s D &lt; 0.5 m Category 2 (Moderate Safety Risk) D*V &lt; 0.8 V &lt; 3.0 m/s D &lt; 1.2 m Category 3 (High Safety Risk) D*V ≥ 0.8 V ≥ 3.0 m/s and D ≥ 0.1m D ≥ 1.2 m Dry points are assigned Category 0. Figure 8.1: Auckland Council Hazard Output 8.8 Changes to Simulation Computational and Clock Times For build 2023-03 extra information is output to the simulations.log file and .tlf regarding simulation clock and processor time. Note that the processor time is summed across all threads and includes GPU hardware. If parallel processing is used in model initialisation or solver this number may be larger than clock time. Prior to the 2023 release the simulations.log file reported, shown in Figure 8.2: Total processor time at the end of the simulation – highlighted in red Hardware type and number of processor used (CPU or GPU) - highlighted in blue Clock time (wall clock or elapsed real time) at the end of the simulation – highlighted in green Figure 8.2: 2020-10-AF Simulation Log For the 2023 release this has been expanded to include the clock and processor time after initialisation (the start of the solution) as well as the clock and processor time at the end of the simulation, shown in Figure 8.3. From left to right these are: Clock time after initialisation - yellow Processor time after initialisation – light blue Clock time at end of simulation – green Processor time at end of simulation – red Hardware type and number of processor used - dark blue Figure 8.3: 2023-03-AA Simulation Log The clock and processor times are also reported at the end of the .tlf, shown in Figure 8.4. Figure 8.4: 2023-03-AA Simulation Log 8.8.1 Changes to Simulation Log Files for 2023-03-AB Computational processor time is being reported very differently for Windows 11 compared to prior versions of Windows. For earlier version of Windows, the processor time included time spent in GPU computer. For Windows 11, the processor time appears to exclude time spent in GPU calculations. From Build 2023-03-AB if running on GPU hardware the processor time is not reported to the simulations.log file. The processor time is still reported to the .tlf with a note that: “Processor times may be misleading/inaccurate when using GPU hardware.” Build 2023-03-AB also includes some minor changes to the formatting of the simulation log file, which includes: Extra width allowed for dongle serial numbers Better alignment of columns 8.9 Support Added for 2d_glo in HPC and Quadtree Build 2023-03-AD adds support for the gauge level map output (2d_glo) in TUFLOW HPC and Quadtree. The 2d_glo layer allows users to specify water level triggers at a given location to determine when map outputs are written rather than using a fixed time interval. The trigger levels can be specified by using a list of levels in a referenced CSV, or by using the GIS attributes with a start level, end level, and an increment value. For more information on the 2d_glo layer, refer to Section 9.4.4 of the TUFLOW Manual. Note, the current gauge level will not be reported to the console while TUFLOW is running in HPC or Quadtree. 8.10 Support For “H_” Po Lines Removed Build 2023-03-AD removes support for plot output (2d_po) water level lines. This has been done due to the perceived instability of a model when viewing the water level line results, as the cells at varying elevations along the line can cause the average water level to appear to bounce as they become wet and dry. This can be more exaggerated with SGS and soil infiltration. This change has been made to both “H_” types and “HU” and “HD” structure PO line types. 8.11 Minor Enhancements and Bug Fixes The 2023-03 Release includes a range of minor enhancements and bug fixes relating to output and check files. 8.11.1 Checks for Valid Geometries for Plot Outputs For the 2023-03-AA build, additional checks are performed for plot outputs depending on the GIS geometry. For example, plot output type “Q” (flow) is valid on a line but not a point. Incompatible plot output types will generate either a warning (which is the default) or an error. To set this the following .tcf command can be used: Plot Output Invalid Type == ERROR | { WARNING } Note: Build 2023-03-AB fixes an issue which prevented plot output types Qin, Qout and Vol from working with PO regions. 8.11.2 HPC dt.csv Interval Can Now Be Set The .hpc.dt.csv contains information on the timestep history for HPC (including Quadtree) simulations. Prior to the 2023-03 Release this was output at each timestep. For the 2023-03 Release the output interval can be set with the .tcf command: HPC dt Write Interval == \\(\\langle\\)number of timesteps\\(\\rangle\\) If not set, the default is to use the Screen/Log Display Interval, if set to zero or less the file is supressed and not written. 8.11.3 Bug Fix for Map Output Zones Using Different Map Output Intervals The 2023-03 Release fixes an issue with map output zones that use different map output intervals. Previously, when the output zones had different map output intervals (from other map output zones or the global settings), TUFLOW could fail to write all output times. This could also occasionally cause a ‘Should not be here’ to occur and the model to crash. 8.11.4 SGS Sample Distance Reporting in TLF The 2023-03 Release fixes an issue with the SGS sample distance reporting in the .tlf when the sample distance is less than 0.00001. Previously this would be reported as 0.000. 8.11.5 Limit Number of WARNING 2550 Messages The 2023-03 Release limits the number of WARNING 2550 messages (written at the end of an HPC simulation) to 100. The total number of cells with timestep corrections is still reported. This limit can be disabled by using the “Verbose == ON” command in the .tcf. 8.11.6 2D_WRF Empty File The 2023-03 Release will now write 2d_wrf empty files as part of the following command: Write Empty GIS Files == \\(\\langle\\)file_path\\(\\rangle\\) 8.11.7 High Resolution Grid Outputs Not Created with Map Output Zones The 2023-03 Release fixes a bug with high resolution grid outputs. Previously, they were not being written when the model contained map output zones. 8.11.8 Time Output Cutoff Logging Fix The 2023-03 Release fixes a bug that could incorrectly report the hazard being used in the “Time Output Cutoff ==” command in the .tlf. 8.11.9 Mass Error Reporting During Simulation Showing Asterisks The 2023-03 Release fixes the mass error reporting in the simulation window when the mass error equals negative 100%. Previously this would appear as asterisks (******%). 8.11.10 Snapping Settings Added to .qgs File The 2023-03 Release adds snapping settings to the .qgs file (QGIS project workspace) that is written to the log folder as part of a TUFLOW simulation. This fixes an issue that is present in QGIS version 3.26 or later when loading the .qgs file written by TUFLOW. Without snapping settings in the .qgs file, none of the layers written to the workspace would allow snapping. 8.11.11 Duplicate Messages in the messages_P GIS File The 2023-03 Release removes duplicate messages that were written to the messages_P file. For example, CHECK 1206 and CHECK 1625 could be duplicated. 8.11.12 Quadtree zsh_zpt_check Points in Non-Refined Areas The 2023-03 Release fixes an issue in Quadtree models where the points in the zsh_zpt_check_P check file were at spacing that did not match the level of mesh refinement. This issue was limited to Z-shape polygons and only occurred if the polygon was within the hidden domains used by the Quadtree pre-processing engine. This issue did not affect the mesh generation or the results. 8.11.13 Bug Fix for SGS Model Outputs When Cell Averaged Depth Option is Used The 2023-03 Release fixes an issue where a SGS model could output zero depth at the first simulation timestep when “SGS Depth Output == Cell Average” is used. The 2023-03 Release also fixes an issue where velocity vectors were not written at cells with small cell average depth. Neither of these bugs affects the hydraulic calculation. 8.11.14 Fixes an Issue with Viscosity Output Written as Zero The 2023-03 Release fixes an issue with the viscosity output (data type “T”) being written as zero unless the data type “T” was specified for the default map output data types (e.g. Map Output Data Types without format prefix). For example, the following would cause an output of zero viscosity: Map Output Format == XMDF FLT Map Output Data Types == h V Z0 ZAEM1 XMDF Map Output Data Types == h V Z0 T The following output settings would correctly output the viscosity. Map Output Format == XMDF FLT Map Output Data Types == h V Z0 ZAEM1 T XMDF Map Output Data Types == h V Z0 T For the 2023-03 Release, if viscosity output is requested for any file formats, this will be correctly pulled from the solver. 8.11.15 HPC Control Number Map Output The 2023-03 Release supports three new output data types in the HPC Solver (including Quadtree): Map Output Data Types == Nu Nc Nd Nu is the Courant Number, Nc is the Shallow Wave Celerity Number, and Nd is the Diffusion Number. Please refer to https://wiki.tuflow.com/HPC_Adaptive_Timestepping for how the control numbers are calculated. The 2023-03 Release will also produce WARNING 2386 if the Classic Courant Number (Cr) output is used in a HPC model. 8.11.16 _zsh_zpt Check File for SGS Models The 2023-03 Release fixes a check file inconsistency between SGS Approach Method B and C (see Section 2.2.2). Previously, SGS Method C writes _zsh_zpt check points only if a cell centre, a face mid-points or a corner point is located inside a 2d_zsh polygon. On the other hand, SGS Method B writes _zsh_zpt check points at all the updated SGS cells, faces and corners including the partially updated SGS points. The 2023-03 Release now writes _zsh_zpt check points for all the updated SGS points in both SGS method B and C. In addition, two extra attributes are added to the SGS _zsh_zpt check file. The new attributes include: dZ: the change in elevation at the exact location of cell centres, face mid-points or corner points. ZExact: the new elevation at the exact location of cell centres, face mid-points or corner points. dZmin: the change in minimum elevation inside cells, along faces or at corners. Zmin: the new minimum elevation inside cells, along faces or at corners. Source: the source file that edits the SGS points. 8.11.17 Extra Checks on File Format Specific Map Output Commands Build 2023-03-AA introduces checks on file format specific Map Output commands, to ensure that only one file format is specified. For example, the following command Will now produce ERROR 2590: ASC FLT Map Output Interval == 0 To apply the same settings to more than one format, the command needs to be repeated for each format, e.g.: ASC Map Output Interval == 0 FLT Map Output Interval == 0 8.11.18 Changes to Processing of Map Output Data Types Command When processing “Map Output Data Types == \\(\\langle\\)list of data types\\(\\rangle\\)”, it is recommended that these are separated with a space (and not a tab). To avoid incorrectly processing the data types, 2023-03-AA changes the order these are processed. This will only affect models that do not used a space separator between map output data types. E.g instead of: Map Output Data Types == hvdqcr The recommended syntax would be: Map Output Data Types == h v d q cr 8.11.19 Layered Flow Constriction Check File Now Includes Method The _lfcsh_uvpt check file now reports the energy loss method used for each cell. 8.11.20 HPC Error Codes Are Now Reported in .tlf and Message Layers In addition to being reported in the .hpc.tlf any HPC errors should now be reported in the .tlf and the messages GIS file. 8.12 2023-03-AB Minor Enhancements and Bug Fixes 8.12.1 Fix for Quadtree High Resolution Outputs and WLL Build 2023-03-AB fixes an issue with high resolution output in quadtree models with SGS and water level lines. Previously this could cause the simulation to crash without error. Build 2023-03-AD fixes a related issue that high resolution output is not generated inside WLL for both HPC and quadtree models. 8.12.2 Reduced Log File when Processing Quadtree Polygons Build 2023-03-AB reduces the amount of output which goes to the .tlf when processing Quadtree nesting level polygons. Previously, if a significant number of nesting polygons was used then a large amount of output to the log file was included. For 2023-03-AB this output is still displayed to the console, but not to the .tlf unless “Verbose == On” is set in the .tcf. 8.12.3 Bug Fix for Integer (Hazard) Grid Outputs Build 2023-03-AB now correctly outputs integer grids (e.g. certain hazard outputs) as integers rather than decimal numbers. In the 2023-03-AA build this was broken for the FLT format and did not work for the new raster formats (GeoTIFF, GPKG raster). The ASC format worked in the 2023-03-AA build. 8.12.4 Consistent Reporting Location Dry Output Build 2023-03-AB will now output consistent RL point values across engines for dry cells / nodes. These will now be output with a null value (default value -99999, however can be user set) whenever the output location is dry. Previously Classic and Quadtree would initially report the null value for the first timestep then a zero value for subsequent dry timesteps; HPC and ESTRY would report the bed level. 8.12.5 Bug Fix MIF PLOT output Build 2023-03-AB fixes a bug introduced in the 2023-03-AA build that would not correctly write the GIS PLOT output layer for the MIF format. This only affected the GIS PLOT output layer (the CSV outputs were correct) which meant that the results could not be viewed in TUFLOW Viewer. 8.12.6 Scientific Notation for PO Outputs Build 2023-03-AB uses scientific notation for CSV PO outputs when values are very small (i.e. close to zero, not negative values), e.g. groundwater flow outputs. 8.12.7 Scientific Notation for ASC Outputs Build 2023-03-AB uses scientific notation for ASC grid outputs when values are very small (i.e. close to zero, not negative values) e.g. groundwater unit flow output. 8.12.8 Bug Fix Geometry Type Groundwater Flow Output in TPC Build 2023-03-AB fixes a bug when writing groundwater PO flow line output to the TPC which was previously listing it as a ‘point output’ (e.g. 2D Point GW Flow == …). 8.12.9 Bug Fix Groundwater Vector Grid Outputs Build 2023-03-AB fixes a bug that could cause groundwater vector grid outputs to write out only null values. 8.12.10 Bug Fix Velocity GIS Map Output Build 2023-03-AB fixes the velocity output for the GIS map output which was creating an empty output. 8.12.11 Extra Precision in Quadtree uvpt Check File for Form Loss Build 2023-03-AB allows extra width for the form loss attribute, this has been increased to 4 decimal places in line with the Classic/HPC check file. The form loss values are stored as floating-point numbers, this change only affects the value written to the check files. 8.12.12 TMO Output Changes for HPC Model with SGS Build 2023-03-AB fixes an issue with the TMO format output for HPC models (without Quadtree) when using SGS. For these models the depth output was being reported relative to the cell minimum elevation (SGS Depth Output == Minimum) rather than the datum set with the “SGS Depth Output == ” command (which defaults to Cell Average). 8.12.13 Duplicated HR Output Message in Log File Build 2023-03-AB removes duplicated log file messages related to HR Output. 8.12.14 Updated Links to TUFLOW Wiki An update on the software used to host the TUFLOW wiki website has changed URL links. For example: https://wiki.tuflow.com/index.php?title=TUFLOW_Message_2570 has now become: https://wiki.tuflow.com/TUFLOW_Message_2570 A re-direct has been setup for existing links / pages, however, messages output for Build 2023-03-AB onwards will use the new wiki URL naming convention. The TUFLOW wiki update was competed to provide improvements including the ability to have animations within pages. 8.12.15 Warning 3551 now Check 3551 Build 2023-03-AB has changed “WARNING 3551 - SGS elevations have changes, reprocessing”, from a WARNING to a CHECK. The message remains unchanged. 8.12.16 Check 0008 now ERROR 0008 Build 2023-03-AB escalates message “CHECK 0008 - cannot be found or opened” to “ERROR 0008 - cannot be found or opened”. 8.12.17 Check 2099 now Reported to Log and Console For build 2023-03-AB “CHECK 2099 - Ignored repeat application of boundary to 2D cell” is now output to the .tlf and console, prior to this build only the GIS message layer was written. 8.12.18 Bug Fix for Warning 4020 Build 2023-03-AB fixes a bug that could cause “WARNING 4020 - Should not be here - TUFLOW HPC unused AD BC” to be issued spuriously. 8.12.19 Buffered File Write for .2dm Build 2023-03-AB uses a buffered file write for the .2dm (2D Mesh file associated with the .xmdf and .dat map output files). This aims to address an issue which could randomly show missing lines from the .2dm file causing it to be incompatible with the .xdmf / .dat file. This issue was quite rare. With a buffered file write, instead of each line being written to the filesystem as it is processed, these are accumulated in an internal buffer (with a user definable size). As well is increasing robustness, there may also be a small performance improvement with this change. This behaviour can be controlled with the .tcf command: Buffer Size 2DM == 16384 ! Buffer size in bytes If this is set to a value of 0 (or less), then buffered writing of the .2dm file is disabled. 8.13 2023-03-AC Minor Enhancements and Bug Fixes 8.13.1 Fix to TMax Output in Output Zone Build 2023-03-AC fixes an issue where the time of maximum output (Tmax) was not correctly reported for output zones. This issue happened prior to 2023-03-AC if the time of maximum output was requested for output zones only, but not for the entire domain. 8.13.2 Enhancement to Plot Output Memory Allocation Build 2023-03-AC increased the upper limit of the output data size requested by plot output, which is the number of cells selected by plot output objects (points/lines/regions) multiplied by the number of plot output timesteps. Prior to build 2023-03-AC, memory access violation occurred if the requested output data size exceeds 2,147,483,647, because a 4 byte integer was used for indexing. An 8 byte integer is now used for indexing, and users can selected upto 2,147,483,647 plot output cells and request upto 2,147,483,647 plot output timesteps. 8.13.3 Bug Fix to SGS High-Res Output below Sea Surface Level Build 2023-03-AC fixes an issue with SGS High-Res water level output below sea surface level. The output value for the cell corner water level has been initiliased as 0.0m, which caused error in water level output for model located below the elevation of 0.0m. 8.13.4 Quadtree PO Header Rows Swapped Build 2023-03-AC swaps the first two header rows in the _PO.csv for Quadtree. This change aligns the Quadtree output with Classic and HPC. 8.14 2023-03-AD Minor Enhancements and Bug Fixes 8.14.1 Bug Fix for PO Online and GPKG Build 2023-03-AD fixes a bug when using “Write PO Online == ON” and “GIS Format == GPKG” together. Previously using these commands in combination could result in “ERROR 2146 - Allocating memory for staging BLOB”. 8.14.2 Bug Fix and Enhancement for NetCDF Grid Projections Build 2023-03-AD fixes a bug that was introduced in build 2023-03-AA in which the NetCDF map output grid type (“Map Output Format == NC”) would no longer write the projection to the output. The projection has been re-added in the 2023-03-AD build to the output if a SHP or GPKG projection is provided (e.g. “SHP Projection == &lt;/path/to/prj&gt;”). The projection format has also been enhanced to ensure it strictly follows the CF Convention as previously it would not always be correctly loaded by some readers (e.g. ArcGIS Pro). 8.14.3 Bug Fix for Reporting Location RLL_Qmx.csv and RLR_Volmx.csv Outputs Build 2023-03-AD fixes a bug in the maximum output written for reporting location lines and regions. This bug was introduced in the 2023-03-AA build and could cause incorrect values to be written to the RLL_Qmx.csv and RLR_Volmx.csv files for HPC. Note, this only affected HPC simulations and did not affect reporting location points (RLP_Hmx.csv) or the time series output for reporting locations. 8.14.4 Removes -99999 From Reporting Location Flow Time Series Output Build 2023-03-AD removes -99999 values from the reporting location line/flow time series output (RLL_Q.csv). A value of -99999 would be output for the first timestep if the reporting location line did not intersect any 1D channels and represent a ‘no flow’ value. Subsequent ‘no flow’ values would use zero. The value of -99999 has been changed to zero for the first time step to apply a consistent approach for ‘no flow’ values within the output. 8.14.5 Error Produced for Duplicate PO Labels for Same Output Type Build 2023-03-AD will report “ERROR 2599 - Duplicate Plot Output Label / Type combination” when a duplicate PO label is found for the same output type. This error will be reported even if the input geometry is different (e.g. when ‘H_’ point and ‘H_’ line types have the same label) and includes reporting locations (e.g. when RL point and ‘H_’ PO type have the same label). 8.14.6 Plot Output Type ‘Vv’ No Longer Triggers ‘V_’ Output Build 2023-03-AD fixes a bug that would cause the plot output type ‘V_’ to be output as well if type ‘Vv’ was specified. This only occurred in TUFLOW Classic or HPC (not Quadtree) and will no longer happen in the 2023-03-AD build. 8.14.7 New Plot Output Types Supported in HPC and Quadtree Build 2023-03-AD adds support for the following plot output types in HPC: Vx (point type) Vy (point type) Build 2023-03-AD adds support for the following plot output types in Quadtree: Vx (point type) Vy (point type) QI (line type) Qx (line type) Qy (line type) Qin (region type) Qout (region type) 8.14.8 Plot Output WARNING 2476 No Longer Triggered Erroneously Build 2023-03-AD fixes a bug where “WARNING/ERROR 2476 PO region geometries do not support ‘H’ outputs” would be triggered incorrectly when using plot output region types ‘HMax’, ‘HAvg’ or ‘Vol’. 8.14.9 Bug Fix For Sink-Source (SS) Plot Output Type in Quadtree Build 2023-03-AD fixes a bug for the sink-source (SS) plot output type in Quadtree resulting in incorrect output values. The output values were not being correctly multipled by the cell areas selected by the polygon region. 8.14.10 Bug Fix for “GRID” Output Format Not Outputting for GeoTIFFs Build 2023-03-AD fixes a bug where no grids were output when using “GRID” map output format (Map Output Format == GRID). This bug was due to the change in default grid format from “FLT” to “TIF”. The “GRID” output was not working for either of the new grid formats (TIF, GPKG) if they were the default grid format. 8.14.11 Bug Fix for “WRR” Output Crashing With “Should not be here” Build 2023-03-AD fixes a bug where “WRR” map output (Map Output Format == WRR) could cause “Should not be here - gridReadHeader - GRID_FORMAT_UNKNOWN”. This was caused by the “WRR” output being used in conjunction with Maximums and Minimums Only for GRID == On. 8.14.12 Bug Fix for High Resolution Grid Outputs with Energy Type Build 2023-03-AD fixes a bug where specifying energy (“E”) output type for a high resolution grid output, but not for any standard resolution outputs, could cause “Should not be here [i_MxO&lt;=0]” when TUFLOW wrote the maximums grids. Note, energy is not a supported high resolution grid output type. 8.14.13 Loading Results in TUFLOW Viewer While TUFLOW is Running Since QGIS 3.30, the XMDF file is locked when opened natively in QGIS or via TUFLOW Viewer. This inhibits the ability to view results while the TUFLOW simulation is running as this can cause TUFLOW to enter a retry loop or even crash. A workaround to this has been implemented in TUFLOW Viewer with the option to copy the results to a temporary location prior to loading into QGIS. The Reload Data Tool has also been udpated to resync changes made to the original file (the file being updated by TUFLOW) with the copied file before reloading the contents in QGIS. For more information, please see the TUFLOW Wiki. 8.14.14 Spurious Column Removed from PO.csv in Quadtree Build 2023-03-AD removes a spurious column of data that was being written to the PO.csv output file when the ‘V_’ plot output line type (average velocity along a line) was specified in Quadtree models. The column was written to the end of the PO.csv (i.e. it was the last column) without any header information. The other time series results written to the PO.csv were unaffected. 8.14.15 Bug Fix for Initial Water Level Polygon Missing From QGIS Workspace Build 2023-03-AD fixes a bug where 2d_iwl input GIS layers would not be written to the QGIS .qgs workspace file (written to the log folder). This would only occur if the 2d_iwl was read into the Geometry Control File (TGC), reading the IWL via the TUFLOW Control File (TCF) did not cause this issue and the 2d_iwl would be correctly added to the .qgs file. Note, the 2d_iwl would still be processed correctly and this bug only affected the .qgs file. 8.14.16 Bug Fix for 2d_bc_tables_check.csv from Quadtree Containing Garbled Text Build 2023-03-AD fixes a bug in the 2d_bc_tables_check.csv output from Quadtree that could cause the check file to contain garbled text. This bug only affected Quadtree and only affected the 2d_bc_tables_check.csv and did not affect the calculations or results. 8.14.17 Re-label SA Boundary Time Column in the 2d_bc_tables_check.csv in Quadtree Build 2023-03-AD re-labels the time column for SA boundaries in the 2d_bc_tables_check.csv file in Quadtree from “Col 1” to “Time (h)”. This is consistent with the check file written by TUFLOW Classic and HPC. 8.14.18 ERROR 0710 Now has Wiki Link Build 2023-03-AD correctly adds the wiki link for the package model (-pm) function related message “ERROR 0710 - More the 100 input files specified”. 8.14.19 Plot Output Sink/Source Type in HPC Now Correctly Reports Net Flow Build 2023-03-AD fixes a bug in TUFLOW HPC and Quadtree where the sink/source plot output type (SS) was not correctly reporting the net flow (i.e. source flow minus sink flow). Prior to build 2023-03-AD, sink values were given positive values when summed in HPC and Quadtree results. 8.14.20 Bug Fix for Water Level Output with Thin Breakline Build 2023-03-AD fixes an issue that occurred in the water level output along thin breaklines when “SGS Depth Output == CELL AVERAGE” was used. Previously, the water level output along thin breaklines was lower than it should be. Note this issue does not affect the hydraulic calculation. 8.14.21 Bug Fix for Maximum High Resolution Output For the default “HR Interpolation Approach == Method C” the cell averaged depth is needed for the high resolution (HR) output interpolation regardless of the “SGS Depth Output” option used in the model. Prior to build 2023-03-AD, the cell averaged depth was not correctly applied in the interpolation of the maximum HR output if the “SGS Depth Output” option is not set as “CELL AVERAGE. This issue has been fixed in build 2023-03-AD. 8.14.22 Bug Fix for Reporting Location with Restart File Build 2023-03-AD fixes an issue for reporting water volume inside a reporting location (0d_rl). This issue happened to HPC models that used restart files. Previously, incorrect volumes were reported because un-initialised water depths were used to calculate the volume before the restart file was read. 8.14.23 Bug Fix PO Points With Invalid “Q” Output Crash Build 2023-03-AD fixes a bug where TUFLOW could crash if a “Q” type output was specified for a 2d_po point. As this is invalid, WARNING/ERROR 2476 (depending on the settings) will be given. 8.14.24 Bug Fix NetCDF Raster Time Issues Build 2023-03-AD fixes a couple of issues related to NetCDF times. Firstly, changing the NetCDF time unit was not correctly changing the output file. Secondly, the times were not written with sufficient precision to accurately reflect the time value within the TUFLOW viewer. 8.14.25 Bug Fix Grid Ouputs For Map Output Zones Build 2023-03-AD fixes a stack overflow error that could occur when writing grid outputs for map output zones. This error was introduced in 2023-03-AA. 8.14.26 Bug Fix for Mass Balance Output Interval When the “Mass Balance Output Interval” command is not defined, TUFLOW HPC uses the “Map Output Interval” and TUFLOW Classic uses the lesser of “Map Output Interval” and the “Time Series Output Interval” as the “Mass Balance Output Interval”. However, if a model didn’t specify a “Map Output Interval” (in HPC) nor the “Time Series Output Interval” (in Classic), the mass balance output wasn’t produced properly prior to build 2023-03-AD. This could cause the model to report zero volume at the end of the simulation and output empty mass balance csv files. Build 2023-03-AD caps the “Mass Balance Output Interval” at “End Time - Start Time” and gives WARNING 2904 to remind users to include at least one the output interval commands above. 8.14.27 Bug Fix for Bed Shear Stress Temporal Output Build 2023-03-AD fixes a bug introduced in 2023-03-AA build that the temporal output of the bed shear stress (BSS) in Quadtree models was not calculated at wet cells. Note, the maximum BSS output was still calculated correctly. 8.14.28 Second Option now Included in NetCDF Output Time Unit Command Build 2023-03-AD adds the option to output the NetCDF times (NC and HRNC Map outputs) with the time unit in seconds, using keyword “SECOND”. This option seems to be required for ArcGIS Pro to read these files correctly. 8.14.29 Enhancement to Ignore Time Series Output Interval if not Used Build 2023-03-AD adds an enhancement that ignores the Time Series Output Interval if it is unspecified when determining an unspecified mass balance interval. Previously, if the mass balance interval was not specified and the model is not using time-series output the default mass balance interval would be set to 1 second causing excessive screen and log output and slowing down the simulation. 8.14.30 Bug Fix for Quadtree Maximum Output Build 2023-03-AD applies a consistent wet/dry cutoff depth for quadtree and non-quadtree models when outputting maximum results. Prior to this, a quadtree model could produce a slightly smaller maximum extent than what was observed in the temporal output, if the maximum depth was only marginally larger than the cell wet/dry depth (the default value is 2mm). 8.14.31 Bug Fix For Misaligned Columns in the TUFLOW Simulation Log Build 2023-03-AD fixes some alignment issues that occurred in the TUFLOW simulation log file. 8.14.32 Bug Fix For TMO Outputs in Quadtree Build 2023-03-AD fixes a bug that was introduced in the 2023-03-AA build in the TMO output for Quadtree. Prior to the fix, the results could incorrectly show inactive/dry cells around the quadtree nesting transition cells. 8.14.33 Bug Fix For Maximum Energy Output in HPC Build 2023-03-AD fixes a bug with the maximum map output for energy (Map Output Data Type == E) for HPC (including Quadtree) models. This only occurred when SGS was enabled. The temporal output was not affected. "],["MinEnhancBugFix-1.html", "Section 9 Minor Enhancements and Bug Fixes 9.1 2023-03-AA Minor Enhancements and Bug Fixes 9.2 2023-03-AB Minor Enhancements and Bug Fixes 9.3 2023-03-AD Minor Enhancements and Bug Fixes", " Section 9 Minor Enhancements and Bug Fixes 9.1 2023-03-AA Minor Enhancements and Bug Fixes 9.1.1 Geo-Referenced Messages The following messages are now geo-referenced in the 2023-03 Release: CHECK 3520 CHECK 2470 ERROR 1521 ERROR 2443 (when applicable) 9.1.2 Error Message When No Start or End Time is Specified The 2023-03 Release will produce ERROR 2570 if the user has not specified a start or end time. Previously these would default to a start time of zero hours and an end time of one hour. 9.1.3 Warning When 1D_IWL is Used in TCF or TGC The 2023-03 Release will produce WARNING 2073 if a 1d_IWL point is read in through the .tcf or .tgc, indicating it needs to be read in as a 1D command. 9.1.4 Fixes Issue with Return Characters in GIS Attributes The 2023-03 Release fixes a bug that would cause a “Should not be here” when a carriage return was present in a GIS attribute value. This would cause TUFLOW to produce ERROR 2148, however also cause a “Should not be here” while writing the error to the message_P.shp layer. In the 2023-03 Release the ERROR 2148 is now written cleanly to the messages_P.shp file. 9.1.5 Package Model Functionality Copies Matrix Blockage Files The 2023-03 Release now copies matrix blockage .csv files, previously these were not copied. 9.1.6 TCF now Closed at End of Model Initialisation All TUFLOW control files (.tcf, .tgc, and .tbc) are opened by TUFLOW as read only, however, these may not have been closed till the end of the simulation which could interfere with some backup or version control software. For 2023-03-AA onwards these control files (.tcf, .tgc, .tbc) are closed at the end of model initialisation. 9.2 2023-03-AB Minor Enhancements and Bug Fixes 9.2.1 Ability to Set Hardware via Command Line Argument Build 2023-03-AB introduces the ability to set the hardware via a command line argument. The syntax is -hwgpu or -hwcpu and this will overwrite any “Hardware == ” command specified in the .tcf. This can be used in conjunction with the -nt (number of threads) or -pu (processing unit id) to provide full control over the hardware usage via the command line. The following command could be used to run a model with CPU hardware on 8 threads: TUFLOW_iSP_w64.exe -b -hwcpu -nt8 FS_Hardware_01.tcf The following command could be used to on GPU hardware using 2 devices (GPU 0 and GPU1): TUFLOW_iSP_w64.exe -b -hwgpu -pu0 -pu1 FS_Hardware_01.tcf 9.2.2 Bug Fix for External 1D Engines Build 2023-03-AB fixes an issue which could cause ERROR 2570 (missing start time or end time) from spuriously being output when linked with external 1D engines (12D, Flood Modeller, or XP-SWMM). 9.2.3 File Path Length Errors Build 2023-03-AB will trigger an appropriate TUFLOW error and meaningful message if a file path length error is encountered. Previously this could cause TUFLOW to hang indefinitely. 9.2.4 Enhancement to Processing of Tabs Build 2023-03-AB changes the processing of tab characters within control file commands. These are now replaced with a space character, previously these were deleted. For example: Map Output Data Types == h → d → t Was previously interpreted as: Map Output Data Types == hdt In this instance h (water level) and dt (variable timestep) would be output instead of h (water level), d (depth) and t (viscosity). 9.3 2023-03-AD Minor Enhancements and Bug Fixes 9.3.1 TUFLOW HPC Crashing While Writing Outputs Mid-Simulation with Reporting Locations Build 2023-03-AD fixes a bug where TUFLOW could crash due to a stack overflow error while writing outputs mid-simulation (i.e. at a map output interval) when using reporting locations. This could occur very rarely and only for HPC. This crash could also potentially happen when using evacuation routes, structure groups, gauge receptors, and operational structures. 9.3.2 Bug Fix Using Local Coordinate Reference System with Shape Files Build 2023-03-AD fixes a bug where TUFLOW could incorrectly throw “ERROR 0305 - Projection of .shp file is different to that specified by the SHP Projection == command” if a local coordinate system was used. This only occurred when using “SHP Projection Check Method == PARSED” (which is the default). 9.3.3 Bug Fix Writing ERROR 2551 Build 2023-03-AD fixes a bug where TUFLOW could crash while writing “ERROR 2551 - PO type SQ is invalid for a structure group, please use QS”. 9.3.4 Speed Up of Package Model Routine It is possible for models to include the same files from multiple places causing multiple references in the Package Model routine. Build 2023-03-AD speeds up the model packaging by eliminating duplicate references and copying the files once. Previous versions would recopy the file for each reference after the first one. "],["LicenceAndInstall-1.html", "Section 10 Licencing and Installing 10.1 Support for Flood Modeller Cloud Licences", " Section 10 Licencing and Installing For the 2023-03 Release builds 2023-03-AA through 2023-03-AC there were no changes regarding licencing. 10.1 Support for Flood Modeller Cloud Licences Build 2023-03-AD adds support for Flood Modeller (Jacobs) Wibu cloud licences. This is in addition to the existing 5 different licencing options using Wibu Systems CodeMeter licencing. The firm codes used below are unique identifiers used by Wibu are outlined in Table 10.1. Table 10.1: WIBU Firm Codes Vendor / Licence Description Wibu Firm Code BMT hardware licence 101139 BMT software licence 6000224 Aquaveo hardware licence 101394 Flood Modeller hardware licence 101987 Flood Modeller software licence 5000219 Flood Modeller cloud licence 6001358 Note that the above table is in the default search order, this search order can be changed with the “WIBU Firm Code Search Order ==” command in the licence setting file. Refer to the 2018 TUFLOW Manual for details on this command. "],["BackwardCompat-1.html", "Section 11 Backward Compatibility 11.1 Backward Compatibility to the 2020-10 Release", " Section 11 Backward Compatibility 11.1 Backward Compatibility to the 2020-10 Release The following changes have been made to the default settings from build 2020-10-AF. Some of these have specific commands to revert behaviour, for others these can be reverted by setting defaults to pre 2023. These changes are summarised in Table 11.1 below. Changes specific to models with Sub-Grid Sampling (SGS) are summarised in Table 11.2 and changes specific to models with SGS and High Resolution Outputs in Table 11.3. Table 11.1: Changes in Defaults Description of Change Section Backward Compatibility Command Change to quadtree handling of inertial parallel to boundary Section 5.4 Quadtree BC Parallel Inertia Approach == Method A Upper limiting Manning’s n in Wu turbulence calculation Section 4.7.1 Viscosity Coefficient == \\(\\langle\\)C3D, C2D, 99\\(\\rangle\\) Duplicate Materials IDs Section 2.7.2 No specific command - Defaults == Pre 2023 Duplicate Soil IDs Section 2.7.3 No specific command - Defaults == Pre 2023 Duplicate SA Boundaries Section 5.9.2 No specific command - Defaults == Pre 2023 HPC Weir Approach Section 4.2 HPC Weir Approach == Method A HPC SX Momentum Section 5.2 HPC SX Momentum Approach == Method A HPC Boundary Approach Section 5.6 HPC Boundary Approach == Method B Initial Moisture and Green-Ampt infiltration Section 2.3.9 No specific command - Defaults == Pre 2023 Drop Support for 2d_bc QT Point Boundaries (Classic/HPC) Section 5.7 No specific command - Defaults == Pre 2023 Drop Support for 2d_bc HQ Point Boundaries (Classic/HPC/Quadtree) Section 5.8 No specific command - Defaults == Pre 2023 Table 11.2: Changes in Defaults - SGS Models Description of Change Section Backward Compatibility Command SGS Approach Section 2.2.2 SGS Approach == Method B SGS Depth Output Section 2.2.1 SGS Depth Output == Exact Mapping of partially wet SGS cells Section 2.2.1 SGS Map Extent Full == h Table 11.3: Changes in Defaults - High Resolution Outputs Description of Change Section Backward Compatibility Command High Resolution raster output interpolation method Section 2.2.5 HR Interpolation Approach == Method A High resolution thin breaklines Section 2.2.6 HR Thin Z Line Output Adjustment == OFF As always, it is recommended when switching to a new Build with an established model that test runs be carried out and comparisons made between the old and new Builds (subtracting the two maximum water level (h) data sets and reviewing any differences is an easy way to do this). If you have any queries on the comparison outcomes, require clarification or more detail on any of the points below, please email support@tuflow.com. "],["SWMM-Input-Detailed-1.html", "Appendix A SWMM Input Files Descriptions", " Appendix A SWMM Input Files Descriptions This Appendix contains information on the available SWMM-TUFLOW input files. A summary is provided in Table 4.2. Table A.1: Inflows No.  Default GIS Attribute Name Description Type 1 Node Name of the node where external inflow enters. Char 2 Type FLOW or &lt;name of a pollutant&gt;. Char 3 Tseries Name of a time series in the TIMESERIES section describing how external flow or pollutant loading varies with time. Char 4 PollutType &lt;name of a pollutant&gt;: CONCEN: if pollutant inflow is described as a concentration (default). MASS: if it is described as a mass flow rate. FLOW: Not Used. Char 5 Mfactor The factor that converts the inflow’s mass flow rate units into the project’s mass units per second, where the project’s mass units are those specified for the pollutant in the POLLUTANTS section (default is 1.0). Float 6 SeriesType CONCEN if pollutant is described as a concentration, MASS if it is described as a mass flow rate (default is CONCEN) Char 7 Factor1 Generally 1 for FLOW; Mfactor for Pollutant - the factor that converts the inflow’s mass flow rate units into the project’s mass units per second, where the project’s mass units are those specified for the pollutant in the [POLLUTANTS] section (default is 1.0) Float 8 Sfactor A scaling factor that multiplies the recorded time series values (default is 1.0). Float 9 Base A constant baseline value added to the time series value (default is 0.0). Float 10 Pat Name of an optional time pattern in the PATTERNS section used to adjust the baseline value on a periodic basis. Char Table A.2: Curves No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the curve. Char 2 Type The type of curve being defined: STORAGE / SHAPE / DIVERSION / TIDAL / PUMP1 / PUMP2 / PUMP3 / PUMP4 / PUMP5 / RATING / CONTROL / WEIR. Char 3 xval An X (independent variable) value. Float 4 yval The Y (dependent variable) value corresponding to X. Float Table A.3: Timeseries No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the time series. Char 2 Frame The name of a file in which the time series data are stored Char 3 Date Date in Month/Day/Year format (e.g., June 15, 2001 would be 6/15/2001). Char 4 Time Hours since the start of the simulation, expressed as a decimal number or as hours:minutes (where hours can be greater than 24). Char 5 Value A value corresponding to the specified date and time. Float Table A.4: Aquifers No.  Default GIS Attribute Name Description Type 1 Name Name assigned to aquifer. Char 2 Por Soil porosity (pore space volume / total volume). Float 3 WP Soil wilting point (moisture content of a fully dried soil). Float 4 FC Soil field capacity (moisture content of a fully drained soil). Float 5 Ksat Saturated hydraulic conductivity (in/hr or mm/hr). Float 6 Kslope Slope of the logarithm of hydraulic conductivity versus moisture deficit (porosity minus moisture content) curve (dimensionless). Float 7 Tslope Slope of soil tension versus moisture content curve (inches or mm). Float 8 ETu Fraction of total evaporation available for evapotranspiration in the upper unsaturated zone. Float 9 ETs Maximum depth into the lower saturated zone over which evapotranspiration can occur (ft or m). Float 10 Seep Seepage rate from saturated zone to deep groundwater when water table is at ground surface (in/hr or mm/hr). Float 11 Ebot Elevation of the bottom of the aquifer (ft or m). Local values can be assigned to specific subcatchments in the GROUNDWATER section. Float 12 Egw Groundwater table elevation at start of simulation (ft or m). Local values can be assigned to specific subcatchments in the GROUNDWATER section. Float 13 Umc Unsaturated zone moisture content at start of simulation (volumetric fraction). Local values can be assigned to specific subcatchments in the GROUNDWATER section. Float 14 ETupat Name of optional monthly time pattern used to adjust the upper zone evaporation fraction for different months of the year. Float Table A.5: Groundwater No.  Default GIS Attribute Name Description Type 1 Subcatchment Subcatchment name. Char 2 Aquifer Name of groundwater aquifer underneath the subcatchment. Char 3 Node Name of a node in the conveyance system exchanging groundwater with the aquifer. Char 4 Esurf Surface elevation of the subcatchment (ft or m). Float 5 A1 Groundwater flow coefficient (see Equation (A.1) below). Float 6 B1 Groundwater flow exponent (see Equation (A.1) below). Float 7 A2 Surface water flow coefficient (see Equation (A.1) below). Float 8 B2 Surface water flow exponent (see Equation (A.1) below). Float 9 A3 Surface water – groundwater interaction coefficient (see Equation (A.1) below). Float 10 Dsw Fixed depth of surface water at the receiving node (ft or m) (set to zero if surface water depth will vary as computed by flow routing). Float 11 Egwt Threshold groundwater table elevation which must be reached before any flow occurs (ft or m). Leave blank (or enter *) to use the elevation of the receiving node’s invert. Float 12 Ebot Optional. Elevation of the bottom of the aquifer (ft or m). Can be used to override the values supplied for the subcatchment’s aquifer. Float 13 Wgr Optional. Groundwater table elevation at the start of the simulation (ft or m). Can be used to override the values supplied for the subcatchment’s aquifer. Float 14 Umc Optional. Unsaturated zone moisture content at start of simulation (volumetric fraction). Can be used to override the values supplied for the subcatchment’s aquifer. Float The flow coefficients are used in the following equation that determines the lateral groundwater flow rate based on groundwater and surface water elevations: \\[\\begin{equation} Q_{L} = A1 (H_{gw} – H_{cb})^{B1} – A2 (H_{sw} – H_{cb})^{B2} + A3 H_{gw} H_{sw} \\tag{A.1} \\end{equation}\\] Where: \\(Q_{L}\\) = lateral groundwater flow (cfs per acre or cms per hectare), \\(H_{gw}\\) = height of saturated zone above the bottom of the aquifer (ft or m), \\(H_{sw}\\) = height of surface water at the receiving node above the aquifer bottom (ft or m), \\(H_{cb}\\) = height of the channel bottom above the aquifer bottom (ft or m). Table A.6: GWF No.  Default GIS Attribute Name Description Type 1 Subcatchment Subcatchment name. Char 2 Type Lateral: to designate an expression for Lateral groundwater flow (to a node of the conveyance network) Deep: for vertical loss to Deep groundwater Char 3 Expr A math formula expressing the rate of groundwater flow (in cfs per acre or cms per hectare for lateral flow or in/hr or mm/hr for deep flow) as a function of the following variables: Hgw: for height of the groundwater table Hsw: for height of the surface water Hcb: for height of the channel bottom Hgs: for height of ground surface Where all heights are relative to the aquifer bottom and have units of either feet or meters: Ks: for saturated hydraulic conductivity in in/hr or mm/hr K: for unsaturated hydraulic conductivity in in/hr or mm/hr Theta: for moisture content of the unsaturated zone Phi: for aquifer soil porosity Fi: for infiltration rate from the ground surface in in/hr or mm/hr Fu: for percolation rate from the upper unsaturated zone in in/hr or mm/hr A: for subcatchment area in acres or hectares Char Table A.7: Adjustments No.  Default GIS Attribute Name Description Type 1 Format Temperature: t1..t12 Evaporation: e1..e12 Rainfall: r1..r12 Conductivity: c1..c12 Char 2 Month1 t1: adjustments to temperature in January, as plus or minus degrees F (degrees C). e1: adjustments to evaporation rate in January, as plus or minus in/day (mm/day). r1: multipliers applied to precipitation rate in January. c1: multipliers applied to soil hydraulic conductivity in January used in either Horton or Green-Ampt infiltration. Float 3 Month2 As above, for February. Float 4 Month3 As above, for March. Float 5 Month4 As above, for April. Float 6 Month5 As above, for May. Float 7 Month6 As above, for June. Float 8 Month7 As above, for July. Float 9 Month8 As above, for August. Float 10 Month9 As above, for September. Float 11 Month10 As above, for October. Float 12 Month11 As above, for November. Float 13 Month12 As above, for December. Float Table A.8: Evaporation No.  Default GIS Attribute Name Description Type 1 Format CONSTANT: applies a constant evaporation rate. MONTHLY: applies a constant evaporation rate per month. TIMESERIES: applies the specified timeseries. TEMPERATURE: indicates that evaporation rates will be computed from the daily air temperatures contained in an external climate file whose name is provided in the TEMPERATURE section. This method also uses the site’s latitude, which can also be specified in the TEMPERATURE section. FILE: indicates that evaporation data will be read directly from the same external climate file used for air temperatures as specified in the TEMPERATURE section. Supplying monthly pan coefficients for these data is optional. RECOVERY: identifies an optional monthly time pattern of multipliers used to modify infiltration recovery rates during dry periods. For example, if the normal infiltration recovery rate was 1% during a specific time period and a pattern factor of 0.8 applied to this period, then the actual recovery rate would be 0.8%. DRY_ONLY: determines if evaporation only occurs during periods with no precipitation. The default is NO. Note: The evaporation rates provided in this section are potential rates. The actual amount of water evaporated will depend on the amount available as a simulation progresses. Char 2 Evap CONSTANT: constant evaporation rate (in/day or mm/day). Float 3 e1 MONTHLY: evaporation rate in January (in/day or mm/day). Float 4 e2 MONTHLY: evaporation rate in February (in/day or mm/day). Float 5 e3 MONTHLY: evaporation rate in March (in/day or mm/day). Float 6 e4 MONTHLY: evaporation rate in April (in/day or mm/day). Float 7 e5 MONTHLY: evaporation rate in May (in/day or mm/day). Float 8 e6 MONTHLY: evaporation rate in June (in/day or mm/day). Float 9 e7 MONTHLY: evaporation rate in July (in/day or mm/day). Float 10 e8 MONTHLY: evaporation rate in August (in/day or mm/day). Float 11 e9 MONTHLY: evaporation rate in September (in/day or mm/day). Float 12 e10 MONTHLY: evaporation rate in October (in/day or mm/day). Float 13 e11 MONTHLY: evaporation rate in November (in/day or mm/day). Float 14 e12 MONTHLY: evaporation rate in December (in/day or mm/day). Float 15 Tseries TIMESERIES: name of a time series in the TIMESERIES section with evaporation data. Char 16 p1 FILE: pan coefficient for January. Float 17 p2 FILE: pan coefficient for February. Float 18 p3 FILE: pan coefficient for March. Float 19 p4 FILE: pan coefficient for April. Float 20 p5 FILE: pan coefficient for May. Float 21 p6 FILE: pan coefficient for June. Float 22 p7 FILE: pan coefficient for July. Float 23 p8 FILE: pan coefficient for August. Float 24 p9 FILE: pan coefficient for September. Float 25 p10 FILE: pan coefficient for October. Float 26 p11 FILE: pan coefficient for November. Float 27 p12 FILE: pan coefficient for December. Float 28 patternID RECOVERY: Name of a monthly time pattern. Char 29 Value DRY_ONLY: Yes or No. Determines if evaporation only occurs during periods with no precipitation. The Default is No.  Char Table A.9: Hydrographs No.  Default GIS Attribute Name Description Type 1 Name Name assigned to a unit hydrograph group. Char 2 RaingageOrMonth Name of the rain gage used by the unit hydrograph group or month of the year (e.g., JAN, FEB, etc. or ALL for all months). Char 3 Term Three separate unit hydrographs, that represent the short-term, medium-term, and long-term RDII responses, can be defined for each month (or all months taken together). Use either SHORT, MEDIUM, or LONG. Char 4 R Response ratio for the unit hydrograph. The response ratio (R) is the fraction of a unit of rainfall depth that becomes RDII. The sum of the ratios for a set of three hydrographs does not have to equal 1.0. Float 5 T Time to peak (hours) for the unit hydrograph. Float 6 K Recession limb ratio for the unit hydrograph. The recession limb ratio (K) is the ratio of the duration of the hydrograph’s recession limb to the time to peak (T) making the hydrograph time base equal to T*(1+K) hours. The area under each unit hydrograph is 1 inch (or mm). Float 7 Dmax Optional. Maximum initial abstraction depth available (in rain depth units). If not supplied then the default is no initial abstraction. Float 8 Drec Optional. Initial abstraction recovery rate (in rain depth units per day). If not supplied then the default is no initial abstraction. Float 9 D0 Optional. Initial abstraction depth already filled at the start of the simulation (in rain depth units). If not supplied then the default is no initial abstraction. Float Table A.10: Patterns No.  Default GIS Attribute Name Description Type 1 Name Name used to identify the pattern. Char 2 Interval MONTHLY: Used to set monthly pattern factors for dry weather flow constituents. DAILY: Used to set dry weather pattern factors for each day of the week, where Sunday is day 1. HOURLY: Used to set dry weather factors for each hour of the day starting from midnight. WEEKEND: If these factors are different for weekend days than for weekday days then the WEEKEND format can be used to specify hourly adjustment factors just for weekends. More than one line can be used to enter a pattern’s factors by repeating the pattern’s name (but not the pattern type) at the beginning of each additional line. The pattern factors are applied as multipliers to any baseline dry weather flows or quality concentrations supplied in the DWF section. Char 3 Factor1 MONTHLY: factor for January DAILY: factor for Sunday HOURLY: factor for 0:00AM. Float 4 Factor2 MONTHLY: factor for February DAILY: factor for Monday HOURLY: factor for 1:00AM. Float 5 Factor3 MONTHLY: factor for March DAILY: factor for Tuesday HOURLY: factor for 2:00AM. Float 6 Factor4 MONTHLY: factor for April DAILY: factor for Wednesday HOURLY: factor for 3:00AM. Float 7 Factor5 MONTHLY: factor for May DAILY: factor for Thursday HOURLY: factor for 4:00AM. Float 8 Factor6 MONTHLY: factor for June DAILY: factor for Friday HOURLY: factor for 5:00AM. Float 9 Factor7 MONTHLY: factor for July DAILY: factor for Saturday HOURLY: factor for 6:00AM. Float 10 Factor8 MONTHLY: factor for August DAILY: not used. HOURLY: factor for 7:00AM. Float 11 Factor9 MONTHLY: factor for September DAILY: not used. HOURLY: factor for 8:00AM. Float 12 Factor10 MONTHLY: factor for October DAILY: not used. HOURLY: factor for 9:00AM. Float 13 Factor11 MONTHLY: factor for November DAILY: not used. HOURLY: factor for 10:00AM. Float 14 Factor12 MONTHLY: factor for December DAILY: not used. HOURLY: factor for 11:00AM. Float 15 Factor13 MONTHLY and DAILY: not used. HOURLY: factor for 12:00PM. Float 16 Factor14 MONTHLY and DAILY: not used. HOURLY: factor for 13:00PM. Float 17 Factor15 MONTHLY and DAILY: not used. HOURLY: factor for 14:00PM. Float 18 Factor16 MONTHLY and DAILY: not used. HOURLY: factor for 15:00PM. Float 19 Factor17 MONTHLY and DAILY: not used. HOURLY: factor for 16:00PM. Float 20 Factor18 MONTHLY and DAILY: not used. HOURLY: factor for 17:00PM. Float 21 Factor19 MONTHLY and DAILY: not used. HOURLY: factor for 18:00PM. Float 22 Factor20 MONTHLY and DAILY: not used. HOURLY: factor for 19:00PM. Float 23 Factor21 MONTHLY and DAILY: not used. HOURLY: factor for 20:00PM. Float 24 Factor22 MONTHLY and DAILY: not used. HOURLY: factor for 21:00PM. Float 25 Factor23 MONTHLY and DAILY: not used. HOURLY: factor for 22:00PM. Float 26 Factor24 MONTHLY and DAILY: not used. HOURLY: factor for 23:00PM. Float Table A.11: Raingages No.  Default GIS Attribute Name Description Type 1 Name Name assigned to rain gage. Char 2 Form Form of recorded rainfall, either INTENSITY, VOLUME or CUMULATIVE. Char 3 Intvl Time interval between gage readings in decimal hours or hours:minutes format (e.g., 0:15 for 15-minute readings). Char 4 SnowCatchDeficiency Snow catch deficiency correction factor (use 1.0 for no adjustment). Float 5 Format Either TIMESERIES or FILE. Char 6 Tseries TIMESERIES: Name of a time series in the TIMESERIES section with rainfall data. Char 7 Fname FILE: Name of an external file with rainfall data. Enclose the external file name in double quotes if it contains spaces and include its full path if it resides in a different directory than the SWMM input file. Char 8 Sta FILE: Name of the recording station in a user-prepared formatted rain file. Only required when using a user-prepared formatted rainfall file. Char 9 Units FILE: Rain depth units for the data in a user-prepared formatted rain file, either IN (inches) or MM (millimeters). Only required when using a user-prepared formatted rainfall file. Char Table A.12: RDII No.  Default GIS Attribute Name Description Type 1 Node Name of a node receiving RDII flow. Char 2 UHgroup Name of an RDII unit hydrograph group appearing in the HYDROGRAPHS section. Char 3 SewerArea Area of the sewershed that contributes RDII to the node (acres or hectares). Float Table A.13: Snowpacks No.  Default GIS Attribute Name Description Type 1 Name Name assigned to snowpack parameter set . Char 2 Type PLOWABLE: contains parameters for the impervious area of a subcatchment that is subject to snow removal by plowing but not to areal depletion. This area is the fraction SNN0 of the total impervious area. IMPERVIOUS: contains parameter values for the remaining impervious area. PERVIOUS: contains parameter values for the entire pervious area. REMOVAL: describes how snow removed from the plowable area is transferred onto other areas. The various transfer fractions should sum to no more than 1.0. If the line is omitted then no snow removal takes place. Char 3 Cmin PLOWABLE, IMPERVIOUS and PERVIOUS: Minimum melt coefficient (in/hr-deg F or mm/hr-deg C). REMOVAL: Not Used. Float 4 Cmax PLOWABLE, IMPERVIOUS and PERVIOUS: Maximum melt coefficient (in/hr-deg F or mm/hr-deg C). REMOVAL: Not Used. Float 5 Tbase PLOWABLE, IMPERVIOUS and PERVIOUS: Snow melt base temperature (deg F or deg C). REMOVAL: Not Used. Float 6 FWF PLOWABLE, IMPERVIOUS and PERVIOUS: Ratio of free water holding capacity to snow depth (fraction). REMOVAL: Not Used. Float 7 SD0 PLOWABLE, IMPERVIOUS and PERVIOUS: Initial snow depth (in or mm water equivalent). REMOVAL: Not Used. Float 8 FW0 PLOWABLE, IMPERVIOUS and PERVIOUS: Initial free water in pack (in or mm). REMOVAL: Not Used. Float 9 SNN0 PLOWABLE: Fraction of impervious area that can be plowed. IMPERVIOUS, PERVIOUS and REMOVAL: Not Used. Float 10 SD100 IMPERVIOUS and PERVIOUS: Snow depth above which there is 100% cover (in or mm water equivalent). PLOWABLE and REMOVAL: Not Used. Float 11 Dplow REMOVAL: Depth of snow on plowable areas at which snow removal begins (in or mm). PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Char 12 Fout REMOVAL: Fraction of snow on plowable area transferred out of watershed. PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Float 13 Fimp REMOVAL: Fraction of snow on plowable area transferred to impervious area by plowing. PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Float 14 Fperv REMOVAL: Fraction of snow on plowable area transferred to pervious area by plowing. PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Float 15 Fimelt REMOVAL: Fraction of snow on plowable area converted into immediate melt. PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Float 16 Fsub REMOVAL: Fraction of snow on plowable area transferred to pervious area in another subcatchment. PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Float 17 Scatch REMOVAL: Name of subcatchment receiving the Fsub fraction of transferred snow. PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used. Char Table A.14: Temperature No.  Default GIS Attribute Name Description Type 1 Option Available options: FILE WINDSPEED MONTHLY SNOWMELT ADC IMPERVIOUS ADC PERVIOUS Char 2 Value Name of file or relevent value. Add additional value columns when required. Char Table A.15: Inlet Usage No.  Default GIS Attribute Name Description Type 1 Conduit Name of a street or open channel conduit containing the inlet. Char 2 Inlet Name of an inlet structure (from the INLETS section) to use. Char 3 Node Name of the sewer node receiving flow captured by the inlet. Char 4 Number Optional. Number of replicate inlets placed on each side of the street. Default is 1 (for each side of a two-sided street). Integer 5 PctClogged Optional. Degree to which inlet capacity is reduced due to clogging (%). Default is 0. Float 6 Qmax Optional. Maximum flow that the inlet can capture (flow units). A Qmax value of 0 indicates that the inlet has no flow restriction. Default is 0. Float 7 aLocal Optional. Height of local gutter depression (in or mm). Default is 0. The local gutter depression applies only over the length of the inlet unlike the continuous depression for a STREET cross section which exists over the full curb length. Float 8 wLocal Optional. Width of local gutter depression (ft or m). Default is 0. The local gutter depression applies only over the length of the inlet unlike the continuous depression for a STREET cross section which exists over the full curb length. Float 9 Placement Optional. AUTOMATIC, ON_GRADE, or ON_SAG. The default inlet placement is AUTOMATIC, meaning that the program uses the network topography to determine whether an inlet operates on-grade or on-sag. On-grade means the inlet is located on a continuous grade. On-sag means the inlet is located at a sag or sump point where all adjacent conduits slope towards the inlet leaving no place for water to flow except into the inlet. Char Table A.16: Inlets No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the inlet structure. Char 2 Type Set either GRATE, DROP_GRATE, CURB, DROP_CURB, SLOTTED or CUSTOM. Char 3 Grate_Length GRATE: length of the inlet parallel to the street curb (ft or m). Float 4 Grate_Width GRATE: width of a GRATE inlet (ft or m). Float 5 Grate_Type GRATE: type of GRATE used, options availabe: P_BAR-50: Parallel bar grate with bar spacing 1-7/8-in on center. P_BAR-50X100: Parallel bar grate with bar spacing 1-7/8-in on center and 3/8-in diameter lateral rods spaced at 4-in on center. P_BAR-30: Parallel bar grate with 1-1/8-in on center bar spacing. CURVED_VANE: Curved vane grate with 3-1/4-in longitudinal bar and 4-1/4-in transverse bar spacing on center. TILT_BAR-45: 45 degree tilt bar grate with 2-1/4-in longitudinal bar and 4-in transverse bar spacing on center. TILT_BAR-30: 30 degree tilt bar grate with 3-1/4-in and 4-in on center longitudinal and lateral bar spacing respectively. RETICULINE: “Honeycomb” pattern of lateral bars and longitudinal bearing bars. GENERIC: A generic grate design. Char 6 Grate_Aopen GRATE: if type is GENERIC, fraction of grate’s area that is open. Float 7 Grate_vsplash GRATE: if type is GENERIC, splash over velocity (ft/s or m/s). Float 8 Curb_Length CURB: length of the inlet parallel to the street curb (ft or m). Float 9 Curb_Height CURB: height of a opening inlet (ft or m). Float 10 Curb_Throat CURB: the throat angle of a CURB opening inlet (HORIZONTAL, INCLINED or VERTICAL). Char 11 Slotted_Length SLOTTED: length of a SLOTTED inlet (ft or m). Float 12 Slotted_Width SLOTTED: width of a SLOTTED inlet (ft or m). Float 13 Custom_Curve CUSTOM: name of a Rating-type curve (captured flow v. water depth). Char Table A.17: LID Controls No.  Default GIS Attribute Name Description Type 1 Name Name assigned to LID process. Char 2 Type BC for bio-retention cell RG for rain garden GR for green roof IT for infiltration trench PP for permeable pavement RB for rain barrel RD for rooftop disconnection VS for vegetative swale Char 3 surface_StorHt BC, RG, GR, IT, PP, RD, VS: When confining walls or berms are present this is the maximum depth to which water can pond above the surface of the unit before overflow occurs (in inches or mm). For LIDs that experience overland flow it is the height of any surface depression storage. For swales, it is the height of its trapezoidal cross-section. All other types: Not Used. Float 4 surface_VegFrac BC, RG, GR, IT, PP, RD, VS: Fraction of the surface storage volume that is filled with vegetation. All other types: Not Used. Float 5 surface_Rough BC, RG, GR, IT, PP, RD, VS: Manning’s coefficient (n) for overland flow over surface soil cover, pavement, roof surface or a vegetative swale. Use 0 for other types of LIDs. If value is 0 then any ponded water that exceeds the surface storage depth is assumed to completely overflow the LID control within a single time step. All other types: Not Used. Float 6 surface_Slope BC, RG, GR, IT, PP, RD, VS: slope of a roof surface, pavement surface or vegetative swale (percent). Use 0 for other types of LIDs. If value is 0 then any ponded water that exceeds the surface storage depth is assumed to completely overflow the LID control within a single time step. All other types: Not Used. Float 7 surface_Xslope BC, RG, GR, IT, PP, RD, VS: slope (run over rise) of the side walls of a vegetative swale’s cross-section. Use 0 for other types of LIDs. All other types: Not Used. Float 8 soil_Thick BC, RG, GR, PP: Thickness of the soil layer (inches or mm). Optional for PP. All other types: Not Used. Float 9 soil_Por BC, RG, GR, PP: Soil porosity (pore space volume / total volume). Optional for PP. All other types: Not Used. Float 10 soil_FC BC, RG, GR, PP: Soil field capacity (moisture content of a fully drained soil). Optional for PP. All other types: Not Used. Float 11 soil_WP BC, RG, GR, PP: Soil wilting point (moisture content of a fully dried soil). Optional for PP. All other types: Not Used. Float 12 soil_Ksat BC, RG, GR, PP: Soil’s saturated hydraulic conductivity (in/hr or mm/hr). Optional for PP. All other types: Not Used. Float 13 soil_Kcoeff BC, RG, GR, PP: Slope of the curve of log (conductivity) versus soil moisture deficit (porosity minus soil moisture) (dimensionless). Optional for PP. All other types: Not Used. Float 14 soil_Suct BC, RG, GR, PP: Soil capillary suction (in or mm). Optional for PP. All other types: Not Used. Float 15 pavement_Thick PP: Thickness of the pavement layer (inches or mm). All other types: Not Used. Float 16 pavement_Vratio PP: Void ratio (volume of void space relative to the volume of solids in the pavement for continuous systems or for the fill material used in modular systems). Note that porosity = void ratio / (1 + void ratio). All other types: Not Used. Float 17 pavement_FracImp PP: Ratio of impervious paver material to total area for modular systems; 0 for continuous porous pavement systems. All other types: Not Used. Float 18 pavement_Perm PP: Permeability of the concrete or asphalt used in continuous systems or hydraulic conductivity of the fill material (gravel or sand) used in modular systems (in/hr or mm/hr). All other types: Not Used. Float 19 pavement_Vclog PP: the number of pavement layer void volumes of runoff treated it takes to completely clog the pavement. Use a value of 0 to ignore clogging. All other types: Not Used. Float 20 pavement_Treg PP: The number of days that the pavement layer is allowed to clog before its permeability is restored, typically by vacuuming its surface. A value of 0 (the default) indicates that no permeability regeneration occurs. All other types: Not Used. Float 21 pavement_Freg PP: The fractional degree to which the pavement’s permeability is restored when a regeneration interval is reached. The default is 0 (no restoration) while a value of 1 indicates complete restoration to the original permeability value. Once regeneration occurs the pavement begins to clog once again at a rate determined by Vclog. All other types: Not Used. Float 22 storage_Height BC, IT, PP, RB: Thickness of the storage layer or height of a rain barrel (inches or mm). All other types: Not Used. Float 23 storage_Vratio BC, IT, PP, RB: void ratio (volume of void space relative to the volume of solids in the layer). Note that porosity = void ratio / (1 + void ratio). All other types: Not Used. Float 24 storage_Seepage BC, IT, PP, RB: The rate at which water seeps from the layer into the underlying native soil when first constructed (in/hr or mm/hr). If there is an impermeable floor or liner below the layer then use a value of 0. All other types: Not Used. Float 25 storage_Vclog BC, IT, PP, RB: Number of storage layer void volumes of runoff treated it takes to completely clog the layer. Use a value of 0 to ignore clogging. Float 26 storage_Covrd BC, IT, PP, RB: YES (the default) if a rain barrel is covered, NO if it is not. All other types: Not Used. Char 27 drain_Coeff RB, RD, BC, IT, PP: Coefficient C that determines the rate of flow through the drain as a function of height of stored water above the drain bottom. For Rooftop Disconnection it is the maximum flow rate (in inches/hour or mm/hour) that the roof’s gutters and downspouts can handle before overflowing. Optional for BC, IT, PP. All other types: Not Used. Float 28 drain_Expon RB, RD, BC, IT, PP: Exponent n that determines the rate of flow through the drain as a function of height of stored water above the drain outlet. Optional for BC, IT, PP. All other types: Not Used. Float 29 drain_Offset RB, RD, BC, IT, PP: Height of the drain line above the bottom of the storage layer or rain barrel (inches or mm). Optional for BC, IT, PP. All other types: Not Used. Float 30 drain_Delay RB, RD, BC, IT, PP: Number of dry weather hours that must elapse before the drain line in a rain barrel is opened (the line is assumed to be closed once rainfall begins). A value of 0 signifies that the barrel’s drain line is always open and drains continuously.  This parameter is ignored for other types of LIDs. All other types: Not Used. Float 31 drain_Hopen RB, RD, BC, IT, PP: The height of water  (in inches or mm) in the drain’s Storage Layer that causes the drain to automatically open. Use 0 to disable this feature. Optional for BC, IT, PP. All other types: Not Used. Float 32 drain_Hclose RB, RD, BC, IT, PP: The height of water (in inches or mm) in the drain’s Storage Layer that causes the drain to automatically close. Use 0 to disable this feature. Optional for BC, IT, PP. All other types: Not Used. Float 33 drain_Qcrv RB, RD, BC, IT, PP: The name of an optional Control Curve that adjusts the computed drain flow as a function of the head of water above the drain. Leave blank if not applicable. Optional for BC, IT, PP. All other types: Not Used. Char 34 drainmat_Thick GR: Thickness of the drainage mat (inches or mm). All other types: Not Used. Float 35 drainmat_Vratio GR: Ratio of void volume to total volume in the mat. All other types: Not Used. Char 36 drainmat_Rough GR: Manning’s coefficient (n) used to compute the horizontal flow rate of drained water through the mat. All other types: Not Used. Char Table A.18: LID Usage No.  Default GIS Attribute Name Description Type 1 Subcatchment Name of the subcatchment using the LID process. Char 2 LID Name of an LID process defined in the LID_CONTROLS section. Char 3 Number Number of replicate LID units deployed. Integer 4 Area Area of each replicate unit (ft2 or m2) Float 5 Width Width of the outflow face of each identical LID unit (in ft or m). This parameter applies to roofs, pavement, trenches, and swales that use overland flow to convey surface runoff off of the unit. It can be set to 0 for other LID processes, such as bio-retention cells, rain gardens, and rain barrels that simply spill any excess captured runoff over their berms. Float 6 InitSat The percent to which the LID’s soil, storage, and drain mat zones are initially filled with water. For soil zones 0 % saturation corresponds to the wilting point moisture content while 100 % saturation has the moisture content equal to the porosity. Float 7 FromImp The percent of the impervious portion of the subcatchment’s non-LID area whose runoff is treated by the LID practice. (E.g., if rain barrels are used to capture roof runoff and roofs represent 60% of the impervious area, then the impervious area treated is 60%). If the LID unit treats only direct rainfall, such as with a green roof, then this value should be 0. If the LID takes up the entire subcatchment then this field is ignored. Float 8 ToPerv A value of 1 indicates that the surface and drain flow from the LID unit should be routed back onto the pervious area of the subcatchment that contains it. This would be a common choice to make for rain barrels, rooftop disconnection, and possibly green roofs. The default value is 0. Float 9 RptFile Optional name of a file to which detailed time series results for the LID will be written. Enclose the name in double quotes if it contains spaces and include its full path if it resides in a different directory than the SWMM input file. Use ’*’ if not applicable and an entry for DrainTo or FromPerv follows Char 10 DrainTo Optional name of subcatchment or node that receives flow from the unit’s drain line, if different from the outlet of the subcatchment that the LID is placed in. Use ’*’ if not applicable and an entry for FromPerv follows. Char 11 FromPerv Optional percent of the pervious portion of the subcatchment’s non-LID area whose runoff is treated by the LID practice. The default value is 0. Float Table A.19: Conduits No.  Default GIS Attribute Name Description Type 1 Name Name assigned to conduit link. Char 2 From Node Name of the conduit’s upstream node. Char 3 To Node Name of the conduit’s downstream node. Char 4 Length Conduit length (ft or m). Float 5 Roughness Manning’s roughness coefficient (n). Float 6 InOffset Offset of the conduit’s upstream end above the invert of its upstream node (ft or m). Float 7 OutOffset Offset of the conduit’s downstream end above the invert of its downstream node (ft or m). Float 8 InitFlow Flow in the conduit at the start of the simulation (flow units) (default is 0). Float 9 MaxFlow Maximum flow allowed in the conduit (flow units) (default is no limit). Float 10 xsec_XsecType A cross-section shape, the available shapes include: Circular, Force_main, Filled_circular2, Rect_closed, Rect_open, Trapezoidal, Triangular, Horiz_ellipse, Vert_ellipse, Arch, Parabolic, Power, Rect_triangular, Rect_round, Modbaskethandle, Egg, Horseshoe, Gothic, Catenary, Semielliptical, Baskethandle, Semicircular, Custom. Char 11 xsec_Geom1 Circular, Force_main, Filled_circular2: Diameter (ft or m) All other shapes: Full height of the cross-section (ft or m) Float 12 xsec_Geom2 Modbaskethandle and Trapezoidal: Base Width Arch, Horiz_ellipse and Vert_ellipse: Max. Width Force_main: Roughness Filled_circular2: Sediment depth Custom: Shape curve Parabolic, Power, Rect_closed, Rect_open, Rect_round, Rect_triangular, Triangular: Top width All other shapes: Not used Float 13 xsec_Geom3 Rect_Round: Bottom Radius Power: Exponent Trapezoidal: Left Slope Vert_ellipse and Horiz_ellipse: Size Code Arch: Size Code ModBasketHandle: Top Radius Rect_Triangular: Triangle Height All other shapes: Not used Float 14 xsec_Geom4 Trapezoidal: Right slope All other shapes: Not used Float 15 xsec_Barrels Number of barrels (i.e., number of parallel pipes of equal size, slope, and roughness) associated with a conduit (default is 1). Integer 16 xsec_Culvert Code number from Table A.10 for the conduit’s inlet geometry if it is a culvert subject to possible inlet flow control (leave blank otherwise). Char 17 xsec_Curve Name of a Shape Curve in the CURVES section that defines how cross-section width varies with depth. Char 18 xsec_Tsect Name of an entry in the TRANSECTS section that describes the cross-section geometry of an irregular channel. Char 19 xsec_Street Name of an entry in the STREETS section that describes the cross-section geometry of a street. Char 20 losses_Kentry Minor head loss coefficient at the conduit’s entrance. Float 21 losses_Kexit Minor head loss coefficient at the conduit’s exit. Float 22 losses_Kavg Average minor head loss coefficient across the length of the conduit. Float 23 losses_Flap YES if the conduit has a flap valve that prevents back flow, NO otherwise. (Default is NO). Char 24 losses_Seepage Rate of seepage loss into the surrounding soil (in/hr or mm/hr). (Default is 0.) Float Table A.20: Controls No.  Default GIS Attribute Name Description Type 1 Text Determines how pumps and regulators will be adjusted based on simulation time or conditions at specific nodes and links. Char Table A.21: Orifices No.  Default GIS Attribute Name Description Type 1 Name Name assigned to orifice link. Char 2 From Node Name of the orifice’s inlet node. Char 3 To Node Name of the orifice’s outlet node. Char 4 Type The type of orifice - either SIDE if oriented in a vertical plane or BOTTOM if oriented in a horizontal plane. Char 5 Offset Amount that a Side Orifice’s bottom or the position of a Bottom Orifice is offset above the invert of inlet node (ft or m, expressed as either a depth or as an elevation, depending on the LINK_OFFSETS option setting). Float 6 Qcoeff Discharge coefficient (unitless). Float 7 Gated YES if a flap gate prevents reverse flow, NO if not (default is NO). Char 8 CloseTime Time in decimal hours to open a fully closed orifice (or close a fully open one). Use 0 if the orifice can open/close instantaneously. Float 9 xsec_XsecType The only allowable shapes are CIRCULAR and RECT_CLOSED (closed rectangular). Char 10 xsec_Geom1 Circular: Diameter (ft or m) Rect_Closed: Full height of the cross-section (ft or m) Float 11 xsec_Geom2 Circular: Not used Rect_closed: Top width Float 12 xsec_Geom3 Not used Float 13 xsec_Geom4 Not used Float 14 xsec_Barrels Number of barrels (i.e., number of parallel pipes of equal size, slope, and roughness) associated with a conduit (default is 1). Integer 15 xsec_Culvert Code number from Table A.10 for the conduit’s inlet geometry if it is a culvert subject to possible inlet flow control (leave blank otherwise). Char 16 xsec_Curve Name of a Shape Curve in the CURVES section that defines how cross-section width varies with depth. Char 17 xsec_Tsect Name of an entry in the TRANSECTS section that describes the cross-section geometry of an irregular channel. Char 18 xsec_Street Name of an entry in the STREETS section that describes the cross-section geometry of a street. Char Table A.22: Outlets No.  Default GIS Attribute Name Description Type 1 Name Name assigned to outlet link. Char 2 From Node Name of the outlet’s inlet node. Char 3 To Node Name of the outlet’s outlet node. Char 4 Offset Amount that the outlet is offset above the invert of its inlet node (ft or m, expressed as either a depth or as an elevation, depending on the LINK_OFFSETS option setting). Float 5 Type TABULAR/DEPTH, TABULAR/HEAD, FUNCTIONAL/DEPTH, FUNCTIONAL/HEAD Char 6 QCurve Name of the rating curve listed in the CURVES section that describes outflow rate (flow units) as a function of: - water depth above the offset elevation at the inlet node (ft or m) for a TABULAR/DEPTH outlet. - head difference (ft or m) between the inlet and outflow nodes for a TABULAR/HEAD outlet. Char 7 C1 Coefficient of a power function that relates outflow to: - water depth (ft or m) above the offset elevation at the inlet node for a FUNCTIONAL/DEPTH outlet. - head difference  (ft or m) between the inlet and outflow nodes for a FUNCTIONAL/HEAD outlet. Float 8 C2 Exponent of a power function that relates outflow to: - water depth (ft or m) above the offset elevation at the inlet node for a FUNCTIONAL/DEPTH outlet. - head difference  (ft or m) between the inlet and outflow nodes for a FUNCTIONAL/HEAD outlet. Float 9 Gated YES if a flap gate prevents reverse flow, NO if not (default is NO). Char Table A.23: Pumps No.  Default GIS Attribute Name Description Type 1 Name Name assigned to pump link. Char 2 From Node Name of the pump’s inlet node. Char 3 To Node Name of the pump’s outlet node. Char 4 Pcurve Name of a pump curve listed in the CURVES section of the input. A pump curve describes the relation between a pump’s flow rate and conditions at its inlet and outlet nodes. The following types of pump curves are supported: Type1: An off-line pump with a wet well where flow increases incrementally with available wet well volume. Type2: An in-line pump where flow increases incrementally with inlet node depth. Type3: An in-line pump where flow varies continuously with head difference between the inlet and outlet nodes. Type4: A variable speed in-line pump where flow varies continuously with inlet node depth. Type5: A variable speed version of the Type3 pump where the head v. flow curve shifts position as the speed setting changes. Ideal: A transfer pump that does not require a pump curve and is used mainly for preliminary design. Its flow rate equals the inflow rate to its inlet node no matter what the head difference is between its inlet and outlet nodes. Use an asterisk (*) as the value for Pcurve. Char 5 Status Pump’s status at the start of the simulation (either ON or OFF; default is ON). Char 6 Startup Depth at the inlet node when the pump turns on (ft or m) (default is 0). Float 7 Shutoff Depth at inlet node when the pump shuts off (ft or m) (default is 0). Float Table A.24: Streets No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the street cross-section. Char 2 Tcrown Distance from street’s curb to its crown (ft or m). Float 3 Hcurb Curb height (ft or m). Float 4 Sx Street cross slope (%). Float 5 nRoad Manning’s roughness coefficient (n) of the road surface Float 6 a Gutter depression height (in or mm) (default = 0). Float 7 W Depressed gutter width (ft or m) (default = 0). Float 8 Sides 1 for single sided street or 2 for two-sided street (default = 2). Integer 9 Tback Street backing width (ft or m) (default = 0). Float 10 Sback Street backing slope (%) (default = 0). Float 11 nBack Street backing Manning’s roughness coefficient (n) (default = 0). Float Table A.25: Transects No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the transect. Char 2 Xleft Station position which ends the left overbank portion of the channel (ft or m). Char 3 Xright Station position which begins the right overbank portion of the channel (ft or m). Char 4 Lfactor Meander modifier that represents the ratio of the length of a meandering main channel to the length of the overbank area that surrounds it (use 0 if not applicable). Char 5 Wfactor Factor by which distances between stations should be multiplied to increase (or decrease) the width of the channel (enter 0 if not applicable). Char 6 Eoffset Amount to be added (or subtracted) from the elevation of each station (ft or m). Char 7 Nleft Manning’s roughness coefficient (n) of right overbank portion of channel (use 0 if no change from previous NC line). Char 8 Nright Manning’s roughness coefficient (n) of right overbank portion of channel (use 0 if no change from previous NC line. Char 9 Nchan1 Manning’s roughness coefficient (n) of main channel portion of channel (use 0 if no change from previous NC line. Char Table A.26: Transects Coordinates No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the transect. Char 2 Elev Elevation of the channel bottom at a cross-section station relative to some fixed reference (ft or m). Float 3 Station Distance of a cross-section station from some fixed reference (ft or m). Float Table A.27: Weirs No.  Default GIS Attribute Name Description Type 1 Name Name assigned to weir link. Char 2 From Node Name of the weir’s inlet node. Char 3 To Node Name of the weir’s outlet node. Char 4 Type TRANSVERSE, SIDEFLOW, V-NOTCH, TRAPEZOIDAL or ROADWAY. Char 5 CrestHt Amount that the weir’s opening is offset above the invert of inlet node (ft or m, expressed as either a depth or as an elevation, depending on the LINK_OFFSETS option setting). Float 6 Cd Weir discharge coefficient (for CFS if using US flow units or CMS if using metric flow units). Float 7 Gated YES if a flap gate prevents reverse flow, NO if not (default is NO). Char 8 EC Number of end contractions for a TRANSVERSE or TRAPEZOIDAL weir (default is 0). Char 9 Cd2 Discharge coefficient for the triangular ends of a TRAPEZOIDAL weir (for CFS if using US flow units or CMS if using metric flow units) (default is the value of Cd). Float 10 Sur YES if the weir can surcharge (have an upstream water level higher than the height of the weir’s opening); NO if it cannot (default is YES). Char 11 Road_Width Applies only to ROADWAY weirs. Width of road lanes and shoulders for a ROADWAY weir (ft or m). Float 12 Road_Surf Applies only to ROADWAY weirs. Type of road surface for a ROADWAY weir: PAVED or GRAVEL. Char 13 xsec_XsecType A cross-section shape. The following shapes must be used with each type of weir: Transverse: RECT_OPEN Sideflow: RECT_OPEN V-Notch: TRIANGULAR Trapezoidal: TRAPEZOIDAL Roadway: RECT_OPEN The ROADWAY weir is a broad crested rectangular weir used model roadway crossings usually in conjunction with culvert-type conduits. It uses the FHWA HDS-5 method to determine a discharge coefficient as a function of flow depth and roadway width and surface. If no roadway data are provided then the weir behaves as a TRANSVERSE weir with Cd as its discharge coefficient. Note that if roadway data are provided, then values for the other optional weir parameters (NO for Gated, 0 for EC, 0 for Cd2, and NO for Sur) must be entered even though they do not apply to ROADWAY weirs. Char 14 xsec_Geom1 Full height of the cross-section (ft or m) Float 15 xsec_Geom2 Trapezoidal: Base Width Rect_open and Triangular: Top width Float 16 xsec_Geom3 Trapezoidal: Left Slope Rect_open and Triangular: Not used Float 17 xsec_Geom4 Trapezoidal: Right slope All other shapes: Not used Float 18 xsec_Barrels Number of barrels (i.e., number of parallel pipes of equal size, slope, and roughness) associated with a conduit (default is 1). Integer 19 xsec_Culvert Code number from Table A.10 for the conduit’s inlet geometry if it is a culvert subject to possible inlet flow control (leave blank otherwise). Char 20 xsec_Curve Name of a Shape Curve in the CURVES section that defines how cross-section width varies with depth. Char 21 xsec_Tsect Name of an entry in the TRANSECTS section that describes the cross-section geometry of an irregular channel. Char 22 xsec_Street Name of an entry in the STREETS section that describes the cross-section geometry of a street. Char Table A.28: Dividers No.  Default GIS Attribute Name Description Type 1 Name Name assigned to divider node. Char 2 Elev Node’s invert elevation (ft or m). Float 3 DivLink Name of the link to which flow is diverted. Char 4 Type OVERFLOW: CUTOFF: TABULAR: WEIR: Char 5 Qmin CUTOFF and WEIR: flow at which diversion begins (flow units). OVERFLOW and TABULAR: Not Used. Float 6 Dcurve TABULAR: name of a curve that relates diverted flow to total flow. OVERFLOW, CUTOFF and WEIR: Not Used. Float 7 Ht WEIR: height of a WEIR divider (ft or m). OVERFLOW, CUTOFF and TABULAR: Not Used. Float 8 Cd WEIR: discharge coefficient for a WEIR divider. OVERFLOW, CUTOFF and TABULAR: Not Used. Float 9 Ymax OVERFLOW, CUTOFF, TABULAR and WEIR: depth from the ground to the node’s invert elevation (ft or m) (default is 0). Float 10 Y0 OVERFLOW, CUTOFF, TABULAR and WEIR: water depth at the start of the simulation (ft or m) (default is 0). Float 11 Ysur OVERFLOW, CUTOFF, TABULAR and WEIR: maximum additional pressure head above the ground elevation that the node can sustain under surcharge conditions (ft or m) (default is 0). Float 12 Apond OVERFLOW, CUTOFF, TABULAR and WEIR: area subjected to surface ponding once water depth exceeds Ymax + Ysur  (ft2 or m2) (default is 0). Float Table A.29: DWF No.  Default GIS Attribute Name Description Type 1 Node Name of a node where dry weather flow enters. Char 2 Type Keyword FLOW for flow or a pollutant name for a quality constituent. Char 3 Base Average baseline value for corresponding constituent  (flow or concentration units). The actual dry weather input will equal the product of the baseline value and any adjustment factors supplied by the specified patterns. If not supplied, an adjustment factor defaults to 1.0. Float 4 Pat1 Name of first time pattern appearing in the PATTERNS section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the PATTERNS section for more details. Char 5 Pat2 Name of second time pattern appearing in the PATTERNS section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the PATTERNS section for more details. Char 6 Pat3 Name of third time pattern appearing in the PATTERNS section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the PATTERNS section for more details. Char 7 Pat4 Name of fourth time pattern appearing in the PATTERNS section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the PATTERNS section for more details. Char Table A.30: Junctions No.  Default GIS Attribute Name Description Type 1 Name Name assigned to junction node. Char 2 Elev Elevation of the junction’s invert (ft or m). Float 3 Ymax Depth from ground to invert elevation (ft or m). Default is 0. If Ymax is 0 then SWMM sets the junction’s maximum depth to the distance from its invert to the top of the highest connecting link. Float 4 Y0 Water depth at the start of the simulation (ft or m). Default is 0. Float 5 Ysur Maximum additional pressure head above the ground elevation that the junction can sustain under surcharge conditions (ft or m). Default is 0. If the junction is part of a force main section of the system then set Ysur to the maximum pressure that the system can sustain. Char 6 Apond Area subjected to surface ponding once water depth exceeds Ymax + Ysur (ft2 or m2). Default is 0. Surface ponding can only occur when Apond is non-zero and the ALLOW_PONDING analysis option is turned on. Float Table A.31: Outfalls No.  Default GIS Attribute Name Description Type 1 Name Name assigned to outfall node. Char 2 Elev Node’s invert elevation (ft or m). Float 3 Type Use either FREE, NORMAL, FIXED, TIDAL or TIMESERIES. Char 4 Stage FIXED: Elevation of a fixed stage outfall (ft or m). FREE, NORMAL, TIDAL and TIMESERIES: Not Used. Char 5 Tcurve TIDAL: Name of a curve in the CURVES section containing tidal height (i.e., outfall stage) v. hour of day over a complete tidal cycle. FREE, NORMAL, FIXED and TIMESERIES: Not Used. Char 6 Tseries TIMESERIES: Name of a time series in TIMESERIES section that describes how outfall stage varies with time. FREE, NORMAL, FIXED and TIDAL: Not Used. Char 7 Gated YES or NO depending on whether a flap gate is present that prevents reverse flow. The default is NO. Char 8 RouteTo Optional. Name of a subcatchment that receives the outfall’s discharge. The default is not to route the outfall’s discharge. Char Table A.32: Storage No.  Default GIS Attribute Name Description Type 1 Name Name assigned to storage node. Char 2 Elev Node’s invert elevation (ft or m). Float 3 Ymax Water depth when the storage node is full (ft or m). Float 4 Y0 Water depth at the start of the simulation (ft or m). Float 5 TYPE TABULAR: FUNCTIONAL: CYLINDRICAL: CONICAL: PARABOLOID: PYRAMIDAL: Char 6 Acurve Name of a curve in the CURVES section that relates surface area (ft2 or m2) to depth (ft or m) for TABULAR geometry. Char 7 A1 Coefficient of a FUNCTIONAL relation between surface area and depth. Where Area = A0 + A1*DepthA2. Float 8 A2 Exponent of a FUNCTIONAL relation between surface area and depth. Float 9 A0 Constant of a FUNCTIONAL relation between surface area and depth. Float 10 L CYLINDRICAL: major axis length CONICAL: major axis length of base PARABOLOID: major axis length at full height PYRAMIDAL: base length Float 11 W CYLINDRICAL: major axis width CONICAL: major axis width of base PARABOLOID: minor axis width at full height PYRAMIDAL: base width Float 12 Z CYLINDRICAL: Not Used. CONICAL: side slope (run/rise) PARABOLOID: full height PYRAMIDAL: side slope (run/rise) Float 13 Ysur Maximum additional pressure head above full depth that a closed storage unit can sustain under surcharge conditions (ft or m) (default is 0). Float 14 Fevap Fraction of potential evaporation from the storage unit’s water surface realized (default is 0). Float 15 Psi Optional seepage parameters for soil surrounding the storage unit. Suction head (inches or mm). Float 16 Ksat Optional seepage parameters for soil surrounding the storage unit. Saturated hydraulic conductivity  (in/hr or mm/hr). Float 17 IMD Optional seepage parameters for soil surrounding the storage unit. Initial moisture deficit (porosity minus moisture content) (fraction). Float Table A.33: Files No.  Default GIS Attribute Name Description Type 1 Operation Set if the interface file is to be used or saved by a run: USE SAVE Char 2 Filetype The different types of interface files that are currently available include: RAINFALL: rainfall interface file (USE / SAVE operation) RUNOFF: runoff interface file (USE / SAVE operation) HOTSTART: hot start file (USE / SAVE operation) RDII: RDII interface file (USE / SAVE operation) INFLOWS: routing interface files (USE operation only) OUTFLOWS: routing interface files (SAVE operation only) Rainfall, Runoff, and RDII files can either be used or saved in a run, but not both. A run can both use and save a Hot Start file (with different names). Char 3 Filename The name of an interface file. Enclose the external file name in double quotes if it contains spaces and include its full path if it resides in a different directory than the SWMM input file. Char Table A.34: Options No.  Default GIS Attribute Name Description Type 1 Option FLOW_UNITS makes a choice of flow units. Selecting a US flow unit means that all other quantities will be expressed in US customary units, while choosing a metric flow unit will force all quantities to be expressed in SI metric units. (Exceptions are pollutant concentration and Manning’s roughness coefficient (n) which are always in metric units). The default is CFS. INFILTRATION selects a model for computing infiltration of rainfall into the upper soil zone of subcatchments. The default model is HORTON. FLOW_ROUTING determines which method is used to route flows through the drainage system. STEADY refers to sequential steady state routing (i.e. hydrograph translation), KINWAVE to kinematic wave routing, DYNWAVE to dynamic wave routing. The default routing method is DYNWAVE. LINK_OFFSETS determines the convention used to specify the position of a link offset above the invert of its connecting node. DEPTH indicates that offsets are expressed as the distance between the node invert and the link while ELEVATION indicates that the absolute elevation of the offset is used. The default is DEPTH. FORCE_MAIN_EQUATION establishes whether the Hazen-Williams (H-W) or the Darcy-Weisbach (D-W) equation will be used to compute friction losses for pressurized flow in conduits that have been assigned a Circular Force Main cross-section shape. The default is H-W. IGNORE_RAINFALL is set to YES if all rainfall data and runoff calculations should be ignored. In this case SWMM only performs flow and pollutant routing based on user-supplied direct and dry weather inflows. The default is NO. IGNORE_SNOWMELT is set to YES if snowmelt calculations should be ignored when a project file contains snow pack objects. The default is NO. IGNORE_GROUNDWATER is set to YES if groundwater calculations should be ignored when a project file contains aquifer objects. The default is NO. IGNORE_RDII is set to YES if rainfall dependent inflow/infiltration should be ignored when RDII unit hydrographs and RDII inflows have been supplied to a project file. The default is NO. IGNORE_ROUTING is set to YES if only runoff should be computed even if the project contains drainage system links and nodes. The default is NO. IGNORE_QUALITY is set to YES if pollutant washoff, routing, and treatment should be ignored in a project that has pollutants defined. The default is NO. ALLOW_PONDING determines whether excess water is allowed to collect atop nodes and be re-introduced into the system as conditions permit. The default is NO ponding. In order for ponding to actually occur at a particular node, a non-zero value for its Ponded Area attribute must be used. SKIP_STEADY_STATE should be set to YES if flow routing computations should be skipped during steady state periods of a simulation during which the last set of computed flows will be used. A time step is considered to be in steady state if the percent difference between total system inflow and total system outflow is below the SYS_FLOW_TOL and the percent difference between current and previous lateral inflows are below the LAT_FLOW_TOL. The default for this option is NO. SYS_FLOW_TOL is the maximum percent difference between total system inflow and total system outflow which can occur in order for the SKIP_STEADY_STATE option to take effect. The default is 5 percent. LAT_FLOW_TOL is the maximum percent difference between the current and previous lateral inflow at all nodes in the conveyance system in order for the SKIP_STEADY_STATE option to take effect. The default is 5 percent. START_DATE is the date when the simulation begins. If not supplied, a date of 2004-01-01 is used. START_TIME is the time of day on the starting date when the simulation begins. The default is 12 midnight (0:00:00). END_DATE is the date when the simulation is to end. The default is the start date. END_TIME is the time of day on the ending date when the simulation will end. The default is 24:00:00. REPORT_START_DATE is the date when reporting of results is to begin. The default is the simulation start date. REPORT_START_TIME is the time of day on the report starting date when reporting is to begin. The default is the simulation start time of day. SWEEP_START is the day of the year (month/day) when street sweeping operations begin. The default is 1/1. SWEEP_END is the day of the year (month/day) when street sweeping operations end. The default is 12/31. DRY_DAYS is the number of days with no rainfall prior to the start of the simulation. The default is 0. REPORT_STEP is the time interval for reporting of computed results. The default is 0:15:00. WET_STEP is the time step length used to compute runoff from subcatchments during periods of rainfall or when ponded water still remains on the surface. The default is 0:05:00. DRY_STEP is the time step length used for runoff computations (consisting essentially of pollutant buildup) during periods when there is no rainfall and no ponded water. The default is 1:00:00. ROUTING_STEP is the time step length in seconds used for routing flows and water quality constituents through the conveyance system. The default is 20 sec. This can be increased if dynamic wave routing is not used. Fractional values (e.g., 2.5) are permissible as are values entered in hours:minutes:seconds format. LENGTHENING_STEP is a time step, in seconds, used to lengthen conduits under dynamic wave routing, so that they meet the Courant stability criterion under full-flow conditions (i.e., the travel time of a wave will not be smaller than the specified conduit lengthening time step). As this value is decreased, fewer conduits will require lengthening. A value of 0 (the default) means that no conduits will be lengthened. VARIABLE_STEP is a safety factor applied to a variable time step computed for each time period under dynamic wave flow routing. The variable time step is computed so as to satisfy the Courant stability criterion for each conduit and yet not exceed the ROUTING_STEP value. If the safety factor is 0 (the default), then no variable time step is used. MINIMUM_STEP is the smallest time step allowed when variable time steps are used for dynamic wave flow routing. The default value is 0.5 seconds. INERTIAL_DAMPING indicates how the inertial terms in the Saint Venant momentum equation will be handled under dynamic wave flow routing. Choosing NONE maintains these terms at their full value under all conditions. Selecting PARTIAL (the default) will reduce the terms as flow comes closer to being critical (and ignores them when flow is supercritical). Choosing FULL will drop the terms altogether. NORMAL_FLOW_LIMITED specifies which condition is checked to determine if flow in a conduit is supercritical and should thus be limited to the normal flow. Use SLOPE to check if the water surface slope is greater than the conduit slope, FROUDE to check if the Froude number is greater than 1.0, BOTH to check both conditions or NONE if no checks are made. The default is BOTH. SURCHARGE_METHOD selects which method will be used to handle surcharge conditions. The EXTRAN option uses a variation of the Surcharge Algorithm from previous versions of SWMM to update nodal heads when all connecting links become full. The SLOT option uses a Preissmann Slot to add a small amount of virtual top surface width to full flowing pipes so that SWMM’s normal procedure for updating nodal heads can continue to be used. The default is EXTRAN. MIN_SURFAREA is a minimum surface area used at nodes when computing changes in water depth under dynamic wave routing. If 0 is entered, then the default value of 12.566 ft2 (1.167 m2) (i.e., the area of a 4-ft diameter manhole) is used. MIN_SLOPE is the minimum value allowed for a conduit’s slope (%). If zero (the default) then no minimum is imposed (although SWMM uses a lower limit on elevation drop of 0.001 ft (0.00035 m) when computing a conduit slope). MAX_TRIALS is the maximum number of trials allowed during a time step to reach convergence when updating hydraulic heads at the conveyance system’s nodes. The default value is 8. HEAD_TOLERANCE is the difference in computed head at each node between successive trials below which the flow solution for the current time step is assumed to have converged. The default tolerance is 0.005 ft (0.0015 m). THREADS is the number of parallel computing threads to use for dynamic wave flow routing on machines equipped with multi-core processors. The default is 1. Char 2 Value FLOW_UNITS: CFS / GPM / MGD / CMS / LPS / MLD INFILTRATION: HORTON / MODIFIED_HORTON / GREEN_AMPT / MODIFIED_GREEN_AMPT / CURVE_NUMBER FLOW_ROUTING: STEADY / KINWAVE / DYNWAVE LINK_OFFSETS: DEPTH / ELEVATION FORCE_MAIN_EQUATION: H-W / D-W IGNORE_RAINFALL: YES / NO IGNORE_SNOWMELT: YES / NO IGNORE_GROUNDWATER: YES / NO IGNORE_RDII: YES / NO IGNORE_ROUTING: YES / NO IGNORE_QUALITY: YES / NO ALLOW_PONDING: YES / NO SKIP_STEADY_STATE: YES / NO SYS_FLOW_TOL: value LAT_FLOW_TOL: value START_DATE: yyyy-mm-dd (default) or month/day/year START_TIME: hours:minutes END_DATE: yyyy-mm-dd (default) or month/day/year END_TIME: hours:minutes REPORT_START_DATE: yyyy-mm-dd (default) or month/day/year REPORT_START_TIME: hours:minutes SWEEP_START: month/day SWEEP_END: month/day DRY_DAYS: days REPORT_STEP: hours:minutes:seconds WET_STEP: hours:minutes:seconds DRY_STEP: hours:minutes:seconds ROUTING_STEP: seconds LENGTHENING_STEP: seconds VARIABLE_STEP: value MINIMUM_STEP: seconds INERTIAL_DAMPING: NONE / PARTIAL / FULL NORMAL_FLOW_LIMITED: SLOPE / FROUDE / BOTH / NONE SURCHARGE_METHOD: EXTRAN / SLOT MIN_SURFAREA: value MIN_SLOPE: value MAX_TRIALS: value HEAD_TOLERANCE: value THREADS: value Char Table A.35: Report No.  Default GIS Attribute Name Description Type 1 Format INPUT specifies whether or not a summary of the input data should be provided in the output report. The default is NO. CONTINUITY specifies whether continuity checks should be reported or not. The default is YES. FLOWSTATS specifies whether summary flow statistics should be reported or not. The default is YES. CONTROLS specifies whether all control actions taken during a simulation should be listed or not. The default is NO. SUBCATCHMENTS gives a list of subcatchments whose results are to be reported. The default is NONE. NODES gives a list of nodes whose results are to be reported. The default is NONE. LINKS gives a list of links whose results are to be reported. The default is NONE. LID specifies that the LID control Name in subcatchment Subcatch should have a detailed performance report for it written to file Fname. The SUBCATCHMENTS, NODES, LINKS, and LID lines can be repeated multiple times. Char 2 Value INPUT: YES / NO CONTINUITY: YES / NO FLOWSTATS: YES / NO CONTROLS: YES / NO SUBCATCHMENTS: ALL / NONE / NODES: ALL / NONE / LINKS: ALL / NONE / LID: Name Subcatch Fname Char Table A.36: Title No.  Default GIS Attribute Name Description Type 1 Title Any number of lines may be entered. The first line will be used as a page header in the output report. Char Table A.37: Subcatchments No.  Default GIS Attribute Name Description Type 1 Name Name assigned to the subcatchment. Char 2 Rain Gage Name of a rain gage in the RAINGAGES section assigned to the subcatchment. Char 3 Outlet Name of the node or subcatchment that receives runoff from the subcatchment. Char 4 Area Area of the subcatchment (acres or hectares). Float 5 PctImperv Percentage of the subcatchment’s area that is impervious. Float 6 Width Characteristic width of the subcatchment (ft or meters). Float 7 PctSlope The subcatchment’s slope (percent). Float 8 CurbLen Total curb length (any length units) used to describe pollutant buildup. Use 0 if not applicable. Float 9 SnowPack Optional name of a snow pack object (from the SNOWPACKS section) that characterizes snow accumulation and melting over the subcatchment. Char 10 Subareas_Nimp Manning’s coefficient (n) for overland flow over the impervious sub-area. Float 11 Subareas_Nperv Manning’s coefficient (n) for overland flow over the pervious sub-area. Float 12 Subareas_Simp Depression storage for the impervious sub-area (inches or mm). Float 13 Subareas_Sperv Depression storage for the pervious sub-area (inches or mm). Float 14 Subareas_PctZero Percent of impervious area with no depression storage. Float 15 Subareas_RouteTo IMPERVIOUS if pervious area runoff runs onto impervious area, PERVIOUS if impervious runoff runs onto pervious area, or OUTLET if both areas drain to the subcatchment’s outlet (default = OUTLET). Char 16 Subareas_PctRouted Percent of runoff routed from one type of area to another (default = 100). Float 17 Infiltration_p1 HORTON and MODIFIED_HORTON: maximum infiltration rate on the Horton curve (in/hr or mm/hr). GREEN-AMPT and MODIFIED_GREEN_AMPT: soil capillary suction (in or mm). CURVE_NUMBER: SCS Curve Number. Float 18 Infiltration_p2 HORTON and MODIFIED_HORTON: minimum infiltration rate on the Horton curve (in/hr or mm/hr). GREEN-AMPT and MODIFIED_GREEN_AMPT: soil saturated hydraulic conductivity (in/hr or mm/hr). CURVE_NUMBER: no longer used. Float 19 Infiltration_p3 HORTON and MODIFIED_HORTON: decay rate constant of the Horton curve (1/hr). GREEN-AMPT and MODIFIED_GREEN_AMPT: initial soil moisture deficit (porosity minus moisture content) (fraction). CURVE_NUMBER: time it takes for a fully saturated soil to dry (days). Float 20 Infiltration_p4 HORTON and MODIFIED_HORTON: time it takes for a fully saturated soil to dry (days). GREEN-AMPT, MODIFIED_GREEN_AMPT and CURVE_NUMBER: Not Used. Float 21 Infiltration_p5 HORTON and MODIFIED_HORTON: maximum infiltration volume possible (0 if not applicable) (in or mm). GREEN-AMPT, MODIFIED_GREEN_AMPT and CURVE_NUMBER: Not Used. Float 22 Infiltration_Method Either HORTON, MODIFIED_HORTON, GREEN_AMPT, MODIFIED_GREEN_AMPT, or CURVE_NUMBER. If not specified then the infiltration method supplied in the OPTIONS section is used. Char Table A.38: Buildup No.  Default GIS Attribute Name Description Type 1 Landuse Land use name. Char 2 Pollutant Pollutant name. Char 3 FuncType Buildup function type. POW (Power): Min(C1, C2*tC3) EXP (Exponential): C1(1-exp(-C2t)) SAT (Saturation): (C1*t)/(C3+t) EXT (External): C1 is the maximum possible buildup (mass per area or curb length), C2 is a scaling factor, and C3 is the name of a Time Series that contains buildup rates (as mass per area or curb length per day) as a function of time. Char 4 C1 Buildup function parameters (see FuncType). Float 5 C2 Buildup function parameters (see FuncType). Float 6 C3 Buildup function parameters (see FuncType). Float 7 PerUnit AREA if buildup is per unit area, CURBLENGTH if per length of curb. Char Table A.39: Coverages No.  Default GIS Attribute Name Description Type 1 Subcatchment Subcatchment name. Char 2 Landuse Land use name. Char 3 Percent Percent of the subcatchment’s area covered by the land use Float Table A.40: Landuses No.  Default GIS Attribute Name Description Type 1 Name Land use name. Char 2 SweepIntervalDays Days between street sweeping. Float 3 AvailabilityFract Fraction of pollutant buildup available for removal by street sweeping. Float 4 LastSweepDays Days since last sweeping at the start of the simulation. Float Table A.41: Loadings No.  Default GIS Attribute Name Description Type 1 Subcatchment Name of a subcatchment. Char 2 Landuse Name of a pollutant. Char 3 Percent Initial buildup of the pollutant (lbs/acre or kg/hectare). If an initial buildup is not specified for a pollutant, then its initial buildup is computed by applying the DRY_DAYS option (specified in the OPTIONS section) to the pollutant’s buildup function for each land use in the subcatchment. Float Table A.42: Pollutants No.  Default GIS Attribute Name Description Type 1 Name Name assigned to a pollutant. Note, FLOW is a reserved word and cannot be used to name a pollutant. Char 2 Units Concentration units (MG/L for milligrams per liter, UG/L for micrograms per liter, or #/L for direct count per liter). Char 3 Crain Concentration of the pollutant in rainfall (concentration units). Float 4 Cgw Concentration of the pollutant in groundwater (concentration units). Float 5 cii Concentration of the pollutant in inflow/infiltration (concentration units). Float 6 Kdecay First-order decay coefficient (1/days). Float 7 Sflag YES if pollutant buildup occurs only when there is snow cover, NO otherwise (default is NO). Char 8 CoPoll Name of a co-pollutant (default is no co-pollutant designated by a *). Char 9 CoFract Fraction of the co-pollutant’s concentration (default is 0). When pollutant X has a co-pollutant Y, it means that fraction CoFract of pollutant Y’s runoff concentration is added to pollutant X’s runoff concentration when wash off from a subcatchment is computed. Float 10 Cdwf Pollutant concentration in dry weather flow (default is 0). If there is no co-pollutant but non-default values, then enter an asterisk (*) for the co-pollutant name. The dry weather flow concentration can be overridden for any specific node of the conveyance system by editing the node’s Inflows property (see the INFLOWS section). Float 11 Cinit Pollutant concentration throughout the conveyance system at the start of the simulation (default is 0). If there is no co-pollutant but non-default values, then enter an asterisk (*) for the co-pollutant name. Float Table A.43: Treatment No.  Default GIS Attribute Name Description Type 1 Node Name of the node where treatment occurs. Char 2 Pollut Name of pollutant receiving treatment. Char 3 Result Result computed by treatment function. Choices are: C  (function computes effluent concentration) R  (function computes fractional removal) Char 4 Func Mathematical function expressing treatment result in terms of pollutant concentrations, pollutant removals, and other standard variables. Treatment functions can be any well-formed mathematical expression involving: inlet pollutant concentrations (use the pollutant name to represent a concentration) removal of other pollutants (use R_ pre-pended to the pollutant name to represent removal) process variables which include: FLOW: for flow rate into node (user’s flow units) DEPTH: for water depth above node invert (ft or m) AREA: for node surface area (ft2 or m2) DT: for routing time step (seconds) HRT: for hydraulic residence time (hours) Char Table A.44: Washoff No.  Default GIS Attribute Name Description Type 1 Landuse Land use name. Char 2 Pollutant Pollutant name. Char 3 FuncType Washoff function type. Each washoff function expresses its results in different units. Available types: EXP (Exponential): C1(runoff)C2 (buildup) [Mass/hour]. Runoff variable is expressed in catchment depth per unit of time (in/hr or mm/hr). RC (Rating Curve): C1(runoff)C2 [Mass/sec]. Runoff variable is in whatever flow units were specified in the OPTIONS section of the input file (e.g. CFS, CMS, etc.). EMC (Event Mean Concentration) C1 [Mass/Liter]. Char 4 C1 Washoff function coefficients. See FuncType. EXP: units are (in/hr)-C2 per hour or (mm/hr)-C2 per hour. RC: units depend on the flow units employed. EMC: concentration units. Float 5 C2 Washoff function coefficients. See FuncType. Float 6 SweepRmv1 Street sweeping removal efficiency (percent). Float 7 BmpRmv1 BMP removal efficiency (percent). Float "],["references.html", "References", " References Collecutt, G., Baeumer, U., Gao, S., &amp; Syme, W. (2022). Bridge Deck Afflux Modelling – Benchmarking of CFD and SWE Codes to Real-World Data. Hydrology &amp; Water Resources Symposium. https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf EPA. (2023). SWMM 5 API Guide. https://epa.gov/system/files/other-files/2023-08/Swmm5.2.4-ApiGuide.zip Gao, S., Ryan, P., Syme, W., &amp; Collecutt, G. (2022). The End of the 1D Open Channel Cross-Section? Hydrology &amp; Water Resources Symposium. https://tuflow.com/media/7547/2022-the-end-of-the-1d-open-channel-cross-section-gao-et-al-hwrs.pdf HR Wallingford. (1988). Afflux at Arch Bridges. https://eprints.hrwallingford.com/219/1/SR182-Afflux-arch-bridges-HRWallingford.pdf McDonnell, B., Wu, J. X., Ratliff, K., Mullapudi, A., &amp; Tryby, M. (2021). Open Water Analytics Stormwater Management Model (Version 5.1.13). Zenodo. https://doi.org/10.5281/zenodo.5484299 Queensland Government. (2001). Queensland Climate Change and Community Vulnerability to Tropical Cyclones - Ocean Hazrds Assessment. https://www.systemsengineeringaustralia.com.au/download/Ocean_Hazards_Assess_Stage1A_revised.pdf TUFLOW. (2018). TUFLOW Classic/HPC User Manual Build 2018-03-AD. https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf TUFLOW. (2020). TUFLOW Classic and HPC 2020-01 and 2020-10 Release Notes. https://downloads.tuflow.com/TUFLOW/Releases/2020-10/TUFLOW%20Release%20Notes.2020- 10-AF.pdf "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
