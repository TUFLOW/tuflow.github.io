<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.3 TUFLOW HPC Specific | TUFLOW Classic/HPC User Manual Release Candidate 2025.2 </title>
  <meta name="description" content="TUFLOW Classic/HPC User Manual 2025" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="1.3 TUFLOW HPC Specific | TUFLOW Classic/HPC User Manual Release Candidate 2025.2 " />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="TUFLOW Classic/HPC User Manual 2025" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.3 TUFLOW HPC Specific | TUFLOW Classic/HPC User Manual Release Candidate 2025.2 " />
  
  <meta name="twitter:description" content="TUFLOW Classic/HPC User Manual 2025" />
  

<meta name="author" content="RELEASE CANDIDATE     This is an interim manual that accompanies the TUFLOW Classic/HPC 2025.2.0-rc.1 release candidate executable. The information contained within this interim version may vary from the subsequent final version." />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/TUFLOW.ico" type="image/x-icon" />
<link rel="prev" href="Common-2.html"/>
<link rel="next" href="CLASpecific-2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 1em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
<link rel="stylesheet" href="css\toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://docs.tuflow.com/classic-hpc/manual/2025.2/"><img src="images/TUFLOW_2025.2_release-candidate.png"></a></li>

<li class="divider"></li>
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#how-to-use-this-manual"><i class="fa fa-check"></i>How to use this Manual</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#navigation"><i class="fa fa-check"></i>Navigation</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#searching"><i class="fa fa-check"></i>Searching</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#commands"><i class="fa fa-check"></i>Commands</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#about-this-manual"><i class="fa fa-check"></i>About this Manual</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#glossary-and-notation"><i class="fa fa-check"></i>Glossary and Notation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="TwoD-Domains-1.html"><a href="TwoD-Domains-1.html"><i class="fa fa-check"></i><b>1</b> 2D Domains</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Solvers-2.html"><a href="Solvers-2.html"><i class="fa fa-check"></i><b>1.1</b> Solvers</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Solvers-2.html"><a href="Solvers-2.html#HPCTwoDSolver-3"><i class="fa fa-check"></i><b>1.1.1</b> TUFLOW HPC 2D Solver</a></li>
<li class="chapter" data-level="1.1.2" data-path="Solvers-2.html"><a href="Solvers-2.html#CLATwoDSolver-3"><i class="fa fa-check"></i><b>1.1.2</b> TUFLOW Classic 2D Solver</a></li>
<li class="chapter" data-level="1.1.3" data-path="Solvers-2.html"><a href="Solvers-2.html#Schematisation-3"><i class="fa fa-check"></i><b>1.1.3</b> Cell Schematisation</a>
<ul>
<li class="chapter" data-level="1.1.3.1" data-path="Solvers-2.html"><a href="Solvers-2.html#computational-points-4"><i class="fa fa-check"></i><b>1.1.3.1</b> Computational Points</a></li>
</ul></li>
<li class="chapter" data-level="1.1.4" data-path="Solvers-2.html"><a href="Solvers-2.html#turbulence-overview"><i class="fa fa-check"></i><b>1.1.4</b> Turbulence</a>
<ul>
<li class="chapter" data-level="1.1.4.1" data-path="Solvers-2.html"><a href="Solvers-2.html#Dry-Wall-4"><i class="fa fa-check"></i><b>1.1.4.1</b> Dry Wall Treatment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Common-2.html"><a href="Common-2.html"><i class="fa fa-check"></i><b>1.2</b> Common Functionality</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Common-2.html"><a href="Common-2.html#Domain-3"><i class="fa fa-check"></i><b>1.2.1</b> Defining the Domain</a></li>
<li class="chapter" data-level="1.2.2" data-path="Common-2.html"><a href="Common-2.html#CellCodes-3"><i class="fa fa-check"></i><b>1.2.2</b> Active / Inactive Cells</a></li>
<li class="chapter" data-level="1.2.3" data-path="Common-2.html"><a href="Common-2.html#layering-3"><i class="fa fa-check"></i><b>1.2.3</b> Data Layering</a></li>
<li class="chapter" data-level="1.2.4" data-path="Common-2.html"><a href="Common-2.html#SamplingData-3"><i class="fa fa-check"></i><b>1.2.4</b> Sampling of Data Sets</a>
<ul>
<li class="chapter" data-level="1.2.4.1" data-path="Common-2.html"><a href="Common-2.html#traditional-sampling-4"><i class="fa fa-check"></i><b>1.2.4.1</b> Traditional Sampling Approach</a></li>
</ul></li>
<li class="chapter" data-level="1.2.5" data-path="Common-2.html"><a href="Common-2.html#elevations-3"><i class="fa fa-check"></i><b>1.2.5</b> Elevations</a>
<ul>
<li class="chapter" data-level="1.2.5.1" data-path="Common-2.html"><a href="Common-2.html#DEMGrids-3"><i class="fa fa-check"></i><b>1.2.5.1</b> Direct Reading of DEM Grids</a></li>
<li class="chapter" data-level="1.2.5.2" data-path="Common-2.html"><a href="Common-2.html#zsh-4"><i class="fa fa-check"></i><b>1.2.5.2</b> Z Shape Layers (2d_zsh)</a></li>
<li class="chapter" data-level="1.2.5.3" data-path="Common-2.html"><a href="Common-2.html#vzsh-4"><i class="fa fa-check"></i><b>1.2.5.3</b> Variable Z Shape Layer (2d_vzsh)</a></li>
<li class="chapter" data-level="1.2.5.4" data-path="Common-2.html"><a href="Common-2.html#ztin-4"><i class="fa fa-check"></i><b>1.2.5.4</b> 3D TIN Layers (2d_ztin)</a></li>
<li class="chapter" data-level="1.2.5.5" data-path="Common-2.html"><a href="Common-2.html#zln-4"><i class="fa fa-check"></i><b>1.2.5.5</b> 3D Breakline Layers (2d_zln)</a></li>
<li class="chapter" data-level="1.2.5.6" data-path="Common-2.html"><a href="Common-2.html#zpt-4"><i class="fa fa-check"></i><b>1.2.5.6</b> Zpt Layers (2d_zpt)</a></li>
<li class="chapter" data-level="1.2.5.7" data-path="Common-2.html"><a href="Common-2.html#using-multiple-and-points-4"><i class="fa fa-check"></i><b>1.2.5.7</b> Using Multiple Layers and Points Layers</a></li>
</ul></li>
<li class="chapter" data-level="1.2.6" data-path="Common-2.html"><a href="Common-2.html#Materials-2"><i class="fa fa-check"></i><b>1.2.6</b> Land Use (Materials)</a>
<ul>
<li class="chapter" data-level="1.2.6.1" data-path="Common-2.html"><a href="Common-2.html#Bed-Resistance-4"><i class="fa fa-check"></i><b>1.2.6.1</b> Bed Resistance</a></li>
<li class="chapter" data-level="1.2.6.2" data-path="Common-2.html"><a href="Common-2.html#log-law-4"><i class="fa fa-check"></i><b>1.2.6.2</b> Log Law Depth Varying Bed Resistance</a></li>
<li class="chapter" data-level="1.2.6.3" data-path="Common-2.html"><a href="Common-2.html#Materials-File-4"><i class="fa fa-check"></i><b>1.2.6.3</b> Materials File</a></li>
<li class="chapter" data-level="1.2.6.4" data-path="Common-2.html"><a href="Common-2.html#Rainfall-Losses-4"><i class="fa fa-check"></i><b>1.2.6.4</b> Rainfall Losses</a></li>
</ul></li>
<li class="chapter" data-level="1.2.7" data-path="Common-2.html"><a href="Common-2.html#Infiltration-2"><i class="fa fa-check"></i><b>1.2.7</b> Infiltration</a>
<ul>
<li class="chapter" data-level="1.2.7.1" data-path="Common-2.html"><a href="Common-2.html#infiltration-layer-4"><i class="fa fa-check"></i><b>1.2.7.1</b> Infiltration Layer</a></li>
<li class="chapter" data-level="1.2.7.2" data-path="Common-2.html"><a href="Common-2.html#tsoilf-4"><i class="fa fa-check"></i><b>1.2.7.2</b> Soils File (.tsoilf)</a></li>
</ul></li>
<li class="chapter" data-level="1.2.8" data-path="Common-2.html"><a href="Common-2.html#HydraulicStructures-3"><i class="fa fa-check"></i><b>1.2.8</b> Hydraulic Structures</a>
<ul>
<li class="chapter" data-level="1.2.8.1" data-path="Common-2.html"><a href="Common-2.html#HydraulicStructuresIntro-4"><i class="fa fa-check"></i><b>1.2.8.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2.8.2" data-path="Common-2.html"><a href="Common-2.html#bg-layer-4"><i class="fa fa-check"></i><b>1.2.8.2</b> 2D Bridge Structures (2d_bg)</a></li>
<li class="chapter" data-level="1.2.8.3" data-path="Common-2.html"><a href="Common-2.html#lfcsh-4"><i class="fa fa-check"></i><b>1.2.8.3</b> Layered Flow Constrictions (2d_lfcsh Layers)</a></li>
</ul></li>
<li class="chapter" data-level="1.2.9" data-path="Common-2.html"><a href="Common-2.html#cell-mods-3"><i class="fa fa-check"></i><b>1.2.9</b> Cell Modification</a>
<ul>
<li class="chapter" data-level="1.2.9.1" data-path="Common-2.html"><a href="Common-2.html#srf-3"><i class="fa fa-check"></i><b>1.2.9.1</b> Storage Reduction (2d_srf)</a></li>
<li class="chapter" data-level="1.2.9.2" data-path="Common-2.html"><a href="Common-2.html#CWF-4"><i class="fa fa-check"></i><b>1.2.9.2</b> Cell Width Factor (2d_cwf)</a></li>
<li class="chapter" data-level="1.2.9.3" data-path="Common-2.html"><a href="Common-2.html#flc-4"><i class="fa fa-check"></i><b>1.2.9.3</b> Form Loss Coefficient (2d_flc)</a></li>
<li class="chapter" data-level="1.2.9.4" data-path="Common-2.html"><a href="Common-2.html#mod-conveyance-4"><i class="fa fa-check"></i><b>1.2.9.4</b> Modify Conveyance</a></li>
</ul></li>
<li class="chapter" data-level="1.2.10" data-path="Common-2.html"><a href="Common-2.html#urban-areas-3"><i class="fa fa-check"></i><b>1.2.10</b> Modelling Urban Areas</a>
<ul>
<li class="chapter" data-level="1.2.10.1" data-path="Common-2.html"><a href="Common-2.html#buildings-4"><i class="fa fa-check"></i><b>1.2.10.1</b> Buildings</a></li>
<li class="chapter" data-level="1.2.10.2" data-path="Common-2.html"><a href="Common-2.html#roads-4"><i class="fa fa-check"></i><b>1.2.10.2</b> Roads</a></li>
<li class="chapter" data-level="1.2.10.3" data-path="Common-2.html"><a href="Common-2.html#fences-4"><i class="fa fa-check"></i><b>1.2.10.3</b> Fences and Walls</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html"><i class="fa fa-check"></i><b>1.3</b> TUFLOW HPC Specific</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#Quadtree-3"><i class="fa fa-check"></i><b>1.3.1</b> Quadtree</a>
<ul>
<li class="chapter" data-level="1.3.1.1" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#qcf-commands-4"><i class="fa fa-check"></i><b>1.3.1.1</b> Quadtree .tcf Commands</a></li>
<li class="chapter" data-level="1.3.1.2" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#qcf-mandatory-4"><i class="fa fa-check"></i><b>1.3.1.2</b> Quadtree Control File (.qcf) – Mandatory Commands</a></li>
<li class="chapter" data-level="1.3.1.3" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#qcf-optional-4"><i class="fa fa-check"></i><b>1.3.1.3</b> Quadtree Control File (.qcf) – Optional Commands</a></li>
<li class="chapter" data-level="1.3.1.4" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#QDT-mesh-4"><i class="fa fa-check"></i><b>1.3.1.4</b> Defining Grid Refinement Polygons</a></li>
</ul></li>
<li class="chapter" data-level="1.3.2" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-Turbulence-3"><i class="fa fa-check"></i><b>1.3.2</b> HPC Turbulence</a>
<ul>
<li class="chapter" data-level="1.3.2.1" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-Turbulence-4"><i class="fa fa-check"></i><b>1.3.2.1</b> Overview</a></li>
<li class="chapter" data-level="1.3.2.2" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#Constant-4"><i class="fa fa-check"></i><b>1.3.2.2</b> Constant Eddy Viscosity</a></li>
<li class="chapter" data-level="1.3.2.3" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#Smagorinsky-4"><i class="fa fa-check"></i><b>1.3.2.3</b> Smagorinsky Approach</a></li>
<li class="chapter" data-level="1.3.2.4" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#Wu-4"><i class="fa fa-check"></i><b>1.3.2.4</b> Wu Approach</a></li>
</ul></li>
<li class="chapter" data-level="1.3.3" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#SGS-3"><i class="fa fa-check"></i><b>1.3.3</b> Sub-Grid Sampling (SGS)</a>
<ul>
<li class="chapter" data-level="1.3.3.1" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#SGS-commands-4"><i class="fa fa-check"></i><b>1.3.3.1</b> SGS Methodology and Commands</a></li>
<li class="chapter" data-level="1.3.3.2" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#SGS-output-4"><i class="fa fa-check"></i><b>1.3.3.2</b> SGS Output Options</a></li>
</ul></li>
<li class="chapter" data-level="1.3.4" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-US-Controlled-3"><i class="fa fa-check"></i><b>1.3.4</b> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)</a></li>
<li class="chapter" data-level="1.3.5" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-Infiltration-GW"><i class="fa fa-check"></i><b>1.3.5</b> Infiltration and Groundwater Flow</a>
<ul>
<li class="chapter" data-level="1.3.5.1" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-Infiltration-4"><i class="fa fa-check"></i><b>1.3.5.1</b> Infiltration</a></li>
<li class="chapter" data-level="1.3.5.2" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-Groundwater-3"><i class="fa fa-check"></i><b>1.3.5.2</b> Groundwater Flow</a></li>
<li class="chapter" data-level="1.3.5.3" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-tsoilf-5"><i class="fa fa-check"></i><b>1.3.5.3</b> HPC Soils File (.tsoilf)</a></li>
</ul></li>
<li class="chapter" data-level="1.3.6" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#NN-3"><i class="fa fa-check"></i><b>1.3.6</b> Non-Newtonian Flow</a>
<ul>
<li class="chapter" data-level="1.3.6.1" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#Implementation-4"><i class="fa fa-check"></i><b>1.3.6.1</b> Implementation</a></li>
<li class="chapter" data-level="1.3.6.2" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#NN-Mix-4"><i class="fa fa-check"></i><b>1.3.6.2</b> Non-Newtonian Mixing</a></li>
</ul></li>
<li class="chapter" data-level="1.3.7" data-path="HPC-specific-2.html"><a href="HPC-specific-2.html#HPC-Unsupported-3"><i class="fa fa-check"></i><b>1.3.7</b> Unsupported Features in TUFLOW HPC</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html"><i class="fa fa-check"></i><b>1.4</b> TUFLOW Classic Specific</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-Turbulence-3"><i class="fa fa-check"></i><b>1.4.1</b> Classic Turbulence</a>
<ul>
<li class="chapter" data-level="1.4.1.1" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-Constant-4"><i class="fa fa-check"></i><b>1.4.1.1</b> Constant</a></li>
<li class="chapter" data-level="1.4.1.2" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-Smagorinsky-4"><i class="fa fa-check"></i><b>1.4.1.2</b> Smagorinsky</a></li>
</ul></li>
<li class="chapter" data-level="1.4.2" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-US-Controlled-3"><i class="fa fa-check"></i><b>1.4.2</b> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)</a></li>
<li class="chapter" data-level="1.4.3" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-mat-3"><i class="fa fa-check"></i><b>1.4.3</b> Land Use (Materials)</a></li>
<li class="chapter" data-level="1.4.4" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-2D2D-3"><i class="fa fa-check"></i><b>1.4.4</b> Multiple 2D Domain</a></li>
<li class="chapter" data-level="1.4.5" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-Coriolis-3"><i class="fa fa-check"></i><b>1.4.5</b> Coriolis Term</a></li>
<li class="chapter" data-level="1.4.6" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#LegacyStructs-3"><i class="fa fa-check"></i><b>1.4.6</b> Legacy Structures</a>
<ul>
<li class="chapter" data-level="1.4.6.1" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-FC-4"><i class="fa fa-check"></i><b>1.4.6.1</b> 2D Flow Constrictions (2d_fcsh and 2d_fc)</a></li>
<li class="chapter" data-level="1.4.6.2" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#EnergyLoss-fc-fcsh-4"><i class="fa fa-check"></i><b>1.4.6.2</b> Applying Form (Energy) Loss in 2D FC and FCSH Layers</a></li>
</ul></li>
<li class="chapter" data-level="1.4.7" data-path="CLASpecific-2.html"><a href="CLASpecific-2.html#CLA-Unsupported-3"><i class="fa fa-check"></i><b>1.4.7</b> Unsupported Features in TUFLOW Classic</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://docs.tuflow.com/classic-hpc/manual/2025.2/"><img src="images/WQFooter.jpg" style="width:246px;height:10px;"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><h0 style="color:rgb(226,1,119);">TUFLOW Classic/HPC User Manual Release Candidate 2025.2 </h0></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<p class="wmark before"></p>
<div id="HPC-specific-2" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> TUFLOW HPC Specific<a href="HPC-specific-2.html#HPC-specific-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section describes 2D domain functionality that is unique to TUFLOW HPC.</p>
<div id="Quadtree-3" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Quadtree<a href="HPC-specific-2.html#Quadtree-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Quadtree grid refinement functionality enables the user to vary the 2D cell resolution within a TUFLOW HPC model. Quadtree refinement allows for recursive division of square TUFLOW cells into four smaller square cells. Up to 9 levels of cell size refinement are permitted. All cells for all levels of refinement share a common orientation. Bill Syme, one of the TUFLOW author’s, discusses the benefits and implementation of Quadtree within the <a href="https://youtu.be/eJJtsS91XNo?t=1495">Future of 2D Hydraulic Modelling AWS Video</a>. The <a href="https://www.youtube.com/watch?v=2zrNwWUNTXE">How to Implement Quadtree</a> video also useful. An example quadtree mesh is presented in Figure <a href="HPC-specific-2.html#fig:fig-QTMeshIntro">1.24</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-QTMeshIntro"></span>
<img src="images/1D2DHPCQTMesh.png" alt="TUFLOW HPC Quadtree Grid"  />
<p class="caption">
Figure 1.24: TUFLOW HPC Quadtree Grid
</p>
</div>
<p>The Quadtree solver uses a modified version of the HPC solver. It uses an explicit finite volume solution that is 2<sup>nd</sup> order in space and 4<sup>th</sup> order in time, however there are some subtle differences between the HPC single grid and Quadtree solvers that mean they produce near identical, though not identical results if both run are over the same single grid (same cell size) grid – see Section <a href="#FixedGridorQuadtreeGrid-3"><strong>??</strong></a> for further discussion.</p>
<p><a href="https://wiki.tuflow.com/Tutorial_M07">TUFLOW Tutorial Module 7</a> provides a demonstration of quadtree. The following sections outline how to use the feature.</p>
<div id="qcf-commands-4" class="section level4 hasAnchor" number="1.3.1.1">
<h4><span class="header-section-number">1.3.1.1</span> Quadtree .tcf Commands<a href="HPC-specific-2.html#qcf-commands-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To use a Quadtree grid, the solution scheme should be set to HPC and a Quadtree Control file (.qcf) specified using the command <a href="#tcfQuadtreeControlFile">Quadtree Control File</a>. GPU Hardware is also recommended. For example:</p>
<p><tcmd>If Scenario</tcmd><teq> == </teq><tblk>HPC </tblk> <br>
 <tcmd>Solution Scheme</tcmd><teq> == </teq><tblk>HPC </tblk> <br>
 <tcmd>Hardware</tcmd><teq> == </teq><tblk>GPU </tblk> <br>
<tcmd>Else If Scenario</tcmd><teq> == </teq><tblk>Quadtree </tblk> <br>
 <tcmd>Solution Scheme</tcmd><teq> == </teq><tblk>HPC </tblk> <br>
 <tcmd>Quadtree Control File</tcmd><teq> == </teq><tblk>..\model\quadtree_001.qcf </tblk><br>
 <tcmd>Hardware</tcmd><teq> == </teq><tblk>GPU </tblk><br>
<tcmd>End If</tcmd></p>
<p>Note, the keyword “Single Level” can be used instead of a control file (e.g. “<tcmd><a href="#tcfQuadtreeControlFile">Quadtree Control File</a></tcmd><teq> == </teq><tblk>Single Level</tblk>”), to run the Quadtree module as a single 2D domain fixed grid model (ie. a fixed cell size). A simulation run in this manner will likely run slower than HPC, though may require a smaller memory footprint. This is due to quadtree only storing a grid of active cells compared with single fixed grid models that use the bounding rectangle to allocate memory, which may include large areas of inactive (redundant) cells and consuming memory.</p>
<p>The Quadtree Control File (.qcf) is described in the next section.</p>
</div>
<div id="qcf-mandatory-4" class="section level4 hasAnchor" number="1.3.1.2">
<h4><span class="header-section-number">1.3.1.2</span> Quadtree Control File (.qcf) – Mandatory Commands<a href="HPC-specific-2.html#qcf-mandatory-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Quadtree Control File (.qcf) is used to define the grid refinement areas and optionally the model location and extent for a Quadtree grid. Appendix <a href="#QCFCommands-1"><strong>??</strong></a> lists and describes the available .qcf commands.</p>
<p>The following commands are mandatory in a .qcf file.</p>
<p><tcmd><a href="#qcfModelOriginandExtent">Model Origin and Extent</a></tcmd><teq> == </teq><tblk>AUTO | TGC</tblk></p>
<p>If set to “AUTO” the extents of the Level 1 GIS polygon are used to define the model origin and extents. If set to “TGC”, the model is located as per the commands in the .tgc file. Note, the angle of the model is defined in the .qcf file using the <a href="#qcfOrientationAngle">Orientation Angle</a> command below. Also, if set to “AUTO” the GIS nesting polygons must have a Level 1 polygon defined, otherwise an ERROR is generated.</p>
<p><tcmd><a href="#qcfReadGISNesting">Read GIS Nesting</a></tcmd><teq> == </teq><tblk> &lt;gis_file&gt; </tblk></p>
<p>The <a href="#qcfReadGISNesting">Read GIS Nesting</a> command can be used to define polygons of grid refinement (different levels) in the 2d_qnl format file, as described in Section <a href="HPC-specific-2.html#QDT-mesh-4">1.3.1.4</a>.</p>
</div>
<div id="qcf-optional-4" class="section level4 hasAnchor" number="1.3.1.3">
<h4><span class="header-section-number">1.3.1.3</span> Quadtree Control File (.qcf) – Optional Commands<a href="HPC-specific-2.html#qcf-optional-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following commands are optional in the Quadtree Control File:</p>
<p><tcmd><a href="#qcfBaseCellSize">Base Cell Size</a></tcmd><teq> == </teq><tblk>&lt;cell size in m/ft&gt; | {TGC}</tblk></p>
<p><strong>Note:</strong> Metric (SI) units are TUFLOW’s default. To set <tcmd><a href="#qcfBaseCellSize">Base Cell Size</a></tcmd> in ft, ensure <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk> has been specified in the .tcf.</p>
<p><a href="#qcfBaseCellSize">Base Cell Size</a> sets the Level 1 (parent) cell size. This will be the largest cell size in the Quadtree grid. If set to a numerical value this will override the cell size command in the .tgc file. If this command is not specified or is set to “TGC”, the cell size defined in the .tgc file is used.</p>
<p><tcmd><a href="#qcfOrientationAngle">Orientation Angle</a></tcmd><teq> == </teq><tblk>&lt;angle in degrees&gt; | OPTIMISE | {TGC}</tblk></p>
<p>If set to a numerical value this defines the grid orientation angle and overrides any angle / location .tgc commands. If set to “OPTIMISE” the parent Level 1 polygon is used to optimise the angle of the grid to minimise the area of the bounding rectangle, thereby minimising temporary memory requirements during the simulation startup (the memory footprint during the simulation is not affected). As such the GIS nesting polygon must have a Level 1 polygon defined. If the command is not specified or is set to “TGC”, the orientation angle in the .tgc is used.</p>
<p>When pre-processing the Quadtree grid, a hidden 2D domain is used for areas of refinement to allow fast processing of geometry on a regular grid. The default approach is that each nesting level is treated as a 2D rectangular domain, and for example, with three levels of nesting the geometry control file is processed three times. To reduce initialisation memory demands it is possible to treat each GIS polygon in the 2d_qnl layer as a separate domain for the processing of geometry inputs. This is set using the optional .qcf control file command:</p>
<p><tcmd><a href="#qcfQuadtreeMeshProcessingMethod">Quadtree Mesh Processing Method</a></tcmd><teq> == </teq><tblk>{FAST} | Memory Efficient</tblk></p>
<p>This allows changing to a more memory efficient approach to process each polygon in the 2d_qnl layer. However, whilst being more memory efficient during grid creation, the model startup may be slower. How the grid is processed has no effect on the speed of the hydraulic computations or the memory demand during the hydraulic calculations.</p>
</div>
<div id="QDT-mesh-4" class="section level4 hasAnchor" number="1.3.1.4">
<h4><span class="header-section-number">1.3.1.4</span> Defining Grid Refinement Polygons<a href="HPC-specific-2.html#QDT-mesh-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A 2d_qnl (Quadtree Nesting Level) GIS layer (see Table <a href="HPC-specific-2.html#tab:tab-QNLAttribute">1.25</a>) is used to define the location and levels of grid refinement. The 2d_qnl layers should only contain polygon / region objects, with all other GIS object types (lines, points, etc.) ignored.</p>
<p>The nesting level attribute must be in the range 1 to 9. A value of:</p>
<ul>
<li>1: indicates that the cell size to be used for that polygon is the Level 1 or base cell size (see <a href="#qcfBaseCellSize">Base Cell Size</a>).</li>
<li>2: indicates the cell size within the polygon would be at Level 2 (i.e. half the base cell size).</li>
<li>3: indicates the cell size within the polygon would be at Level 3 (i.e. 1/4<sup>th</sup> of the base cell size).</li>
<li>4: indicates the cell size within the polygon would be at Level 4 (i.e. 1/8<sup>th</sup> of the base cell size).</li>
<li>…</li>
<li>9: so on up to a maximum of Level 9 (1/256<sup>th</sup> of the base cell size).</li>
</ul>
<p>There should only be one Level 1 polygon defined in the 2d_qnl layer, but for all other levels there is no limit on the number of polygons. For numerical precision reasons when running single precision, the maximum nesting level of 9 or 1/256 of the base cell size has been adopted, but can be increased for double precision mode should there be a demand from users.</p>
<p><strong>Note, for Z shape (2d_zsh) polygons (Section <a href="Common-2.html#zsh-4">1.2.5.2</a>) with any merging of elevations at undefined vertices (merge polygons) which extend across multiple quadtree nested layers, it is recommended to carefully review the <a href="https://wiki.tuflow.com/Check_Files_2d_zsh_zpt">_zsh_zpt</a> check file to ensure appropriate representation. <a href="https://wiki.tuflow.com/TUFLOW_Message_2934">CHECK/WARNING 2934</a> will be written in this instance. </strong></p>
<table>
<caption>
<span id="tab:tab-QNLAttribute">Table 1.25: </span><strong>2D Quadtree (2d_qnl) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Nest_Level
</td>
<td style="text-align:left;">
<p>The value of the quadtree nested level used for grid refinement.</p>
<p>The nesting level attribute must be in the range 1 to 9. For example:</p>
<ul>
<li>1: indicates that the cell size to be used for that polygon is the Level 1 or base cell size (see <a href="#qcfBaseCellSize">Base Cell Size</a>.</li>
<li>2: indicates the cell size within the polygon would be at Level 2 (i.e. half the base cell size).</li>
<li>3: indicates the cell size within the polygon would be at Level 3 (i.e. 1/4th of the base cell size).</li>
<li>4: indicates the cell size within the polygon would be at Level 4 (i.e. 1/8th of the base cell size).</li>
<li>…</li>
<li>9: so on up to a maximum of Level 9 (1/256th of the base cell size).
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
</tbody>
</table></li>
</ul>
<p>When refining grid areas, if a refinement polygon sits within a polygon of the next higher level (e.g. a Level 3 polygon is defined within a Level 2), as per Figure <a href="HPC-specific-2.html#fig:fig-image62">1.25</a>, no automatic grid refining is required.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image62"></span>
<img src="images/image62.png" alt="Example of Quadtree Nesting Level Polygons"  />
<p class="caption">
Figure 1.25: Example of Quadtree Nesting Level Polygons
</p>
</div>
<p>However, if a nesting level polygon does not sit within a polygon of the next higher level (e.g. a Level 4 polygon is defined within a Level 1 or Level 2 polygon), intermediate areas of refinement are automatically generated by TUFLOW. For example, Figure <a href="HPC-specific-2.html#fig:fig-image64">1.26</a> show the grid generated when transitioning from a Level 1 to Level 3 and a Level 1 to Level 5.</p>
<p><img src="images/image63.jpg" width="50%" style="display: block; margin: auto;" /></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image64"></span>
<img src="images/image64.jpg" alt="Examples of Automatic Quadtree Refinement" width="50%" />
<p class="caption">
Figure 1.26: Examples of Automatic Quadtree Refinement
</p>
</div>
<p>No Level 1 polygon is required if the model origin and extent are defined in the .tgc file. In this situation the rectangle representing the .tgc computational domain is used as the Level 1 polygon. For example, if the .qcf file includes the following commands and the only 2d_qnl polygon is Level 3 (red polygon in Figure <a href="HPC-specific-2.html#fig:fig-image68">1.29</a>. The grid created is based on the rectangular computational domain in the .tgc file (as shown by the thick dashed black line) with inactive cells removed from the grid to reduce memory.</p>
<p><tcmd><a href="#qcfBaseCellSize">Base Cell Size</a></tcmd><teq> == </teq><tblk>TGC</tblk><br />
<tcmd><a href="#qcfModelOriginandExtent">Model Origin and Extent</a></tcmd><teq> == </teq><tblk>TGC</tblk><br />
<tcmd><a href="#qcfOrientationAngle">Orientation Angle</a></tcmd><teq> == </teq><tblk>TGC</tblk><br />
<tcmd><a href="#qcfReadGISNesting">Read GIS Nesting</a></tcmd><teq> == </teq><tblk>gis\2d_qnl_999_R.shp</tblk></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image65"></span>
<img src="images/image65.png" alt="Example Showing Removal of Inactive Cells" width="50%" />
<p class="caption">
Figure 1.27: Example Showing Removal of Inactive Cells
</p>
</div>
</div>
</div>
<div id="HPC-Turbulence-3" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> HPC Turbulence<a href="HPC-specific-2.html#HPC-Turbulence-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section contains information relating to sub-grid-scale turbulence options for TUFLOW HPC.</p>
<div id="HPC-Turbulence-4" class="section level4 hasAnchor" number="1.3.2.1">
<h4><span class="header-section-number">1.3.2.1</span> Overview<a href="HPC-specific-2.html#HPC-Turbulence-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For TUFLOW HPC, three options exist (Constant, Smagorinsky and Wu) for specifying eddy viscosity for the 2D domains to approximate the effect of sub-grid-scale turbulence. <span class="citation">Collecutt et al. (<a href="CLASpecific-2.html#ref-Collecutt2020">2020</a>)</span> discusses the turbulence models in respect to model cell size sensitivity, resulting in the Wu approach (Section <a href="HPC-specific-2.html#Wu-4">1.3.2.4</a>) becoming the default for TUFLOW HPC from the 2020-01 release and onwards. Discussion on the change in defaults is available in the <a href="https://wiki.tuflow.com/HPC_Turbulence_FAQ">TUFLOW Wiki HPC Turbulence FAQ</a> page.</p>
<p>The <a href="#tcfViscosityFormulation">Viscosity Formulation</a> and <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> commands are used to set the formulation and coefficients. Note that these commands may also be used to select the non-Newtonian module, which is discussed in Section <a href="HPC-specific-2.html#NN-3">1.3.6</a> since it is not a sub-grid turbulence model.</p>
</div>
<div id="Constant-4" class="section level4 hasAnchor" number="1.3.2.2">
<h4><span class="header-section-number">1.3.2.2</span> Constant Eddy Viscosity<a href="HPC-specific-2.html#Constant-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Constant approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a> </tcmd><teq>==</teq><tblk> CONSTANT</tblk>) applies a constant value throughout the model, irrespective of velocity gradients and variations. This is generally satisfactory when the bed resistance is dominant or when modelling large ocean basins (in which case the recommended coefficient for the constant formulation is 1m<sup>2</sup>/s), but is not recommended for riverine flow paths.</p>
</div>
<div id="Smagorinsky-4" class="section level4 hasAnchor" number="1.3.2.3">
<h4><span class="header-section-number">1.3.2.3</span> Smagorinsky Approach<a href="HPC-specific-2.html#Smagorinsky-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW’s Smagorinsky approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a> </tcmd><teq>==</teq><tblk> SMAGORINSKY</tblk>) applies a hybrid method that includes elements of both the Constant and Smagorinsky approaches, as given by the equation below. This formulation is better than the CONSTANT option, as the eddy viscosity is recalculated every timestep at every cell mid-side according to the change in velocity magnitude and direction. This results in higher coefficients being applied where there is greater turbulence.</p>
<p>However, this approach has two known limitations:</p>
<ol style="list-style-type: decimal">
<li>It assumes that all turbulent kinetic energy with length scales greater than the cell size is resolved within the velocity field. This assumption is reasonable when the 2D cell size is larger than the physical depth of the flow, but becomes incorrect when the 2D cell size is smaller than the depth of the flow – turbulence in the vertical direction contributes significantly to viscosity but is not resolved in the 2D velocity field. As a result, once the 2D cell size becomes smaller than the flow depth this approach can underpredict the viscosity, and can underpredict momentum coupling from river to flood plain.<br />
</li>
<li>It assumes that the physical length scales of the sub-grid turbulence scale with the 2D cell size. This is reasonable when the 2D cell size is similar to the depth of the flow, but becomes incorrect when the 2D cell size becomes significantly larger than the depth of the flow – the bed resistance and the finite depth of the flow prevent large scale turbulence. As a result, once the 2D cell size becomes much larger than the depth of the flow, the Smagorinsky turbulence model can overpredict the viscosity, and can overpredict the momentum coupling from river to flood plain.</li>
</ol>
<p>The result of these two limitations, is that model results display some sensitivity to the 2D cell size. The Wu formulation (Section <a href="HPC-specific-2.html#Wu-4">1.3.2.4</a>) has proven to be more capable in its ability to provide “out of the box” calibration and reduced sensitivity of model results to 2D cell size.</p>
<p>Note, if the formulation is changed, the user must also reset the coefficient using the command <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a>. <!--EFC to PAR: Just did a quick test and it looks like TUFLOW automatically updates the coefficients when changing formulation. Can this sentence be deleted. It's a bit confusing--></p>
<p>The Smagorinsky option remains the default when using TUFLOW Classic. The default viscosity coefficients are a Smagorinsky value of 0.5 plus a constant value of 0.05 m<sup>2</sup>/s. The 0.5 Smagorinsky coefficient is dimensionless. The viscosity coefficient can be output using the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command.</p>
<p>The hybrid Smagorinsky formulation used by TUFLOW is:</p>
<p><span class="math display" id="eq:equ-smag">\[\begin{equation}
𝜐 = C_{c} + C_{s}A_{c}\sqrt{\left( \frac{\partial u}{\partial x} \right)^{2} + \left( \frac{\partial v}{\partial y} \right)^{2} + {\frac{1}{2}\left( \frac{|\partial u|}{\partial y} + \frac{|\partial v|}{\partial x} \right)}^{2}}
\tag{1.26}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(u\ and\ v = \ \)</span>Depth averaged velocity components in the X and Y directions<br />
</li>
<li><span class="math inline">\(x\ and\ y = \ \)</span>Distance in the X and Y direction<br />
</li>
<li><span class="math inline">\(\nu = \ \)</span>Horizontal diffusion of momentum (viscosity) coefficient, m<sup>2</sup>/s or ft<sup>2</sup>/s (if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>)<br />
</li>
<li><span class="math inline">\(A_{c} = \ \)</span>Area of Cell<br />
</li>
<li><span class="math inline">\(C_{\ c} = \ \)</span>Constant Coefficient (default = 0.05 m<sup>2</sup>/s)<br />
</li>
<li><span class="math inline">\(C_{s} = \ \)</span>Smagorinsky Coefficient (dimensionless, default = 0.5)</li>
</ul>
</div>
<div id="Wu-4" class="section level4 hasAnchor" number="1.3.2.4">
<h4><span class="header-section-number">1.3.2.4</span> Wu Approach<a href="HPC-specific-2.html#Wu-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Wu approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a> </tcmd><teq>==</teq><tblk> WU</tblk>) is the default method for TUFLOW HPC from release 2020-01 and onwards. It is not available for TUFLOW Classic. This eddy viscosity (turbulence) model combines both 2D and 3D turbulence effects, and is a slightly adapted version of that described in <span class="citation">W. Wu et al. (<a href="CLASpecific-2.html#ref-Wu2005">2005</a>)</span>.</p>
<p>Like the Smagorinsky eddy viscosity model, it is a zero-equation model whereby the eddy viscosity coefficient can be diagnostically computed from the mean depth and velocity fields. However, unlike the Smagorinsky model, where the turbulent length scale is related to cell size, the length scales used in the Wu model are related to water depth, and hence the computed eddy viscosity is not related to or dependent on cell size. This has been shown to significantly improve the cell size convergence of the results compared to the Smagorinsky model (i.e. the results are nearly independent of the cell size provided there are enough cells across the waterways to adequately define the flows).</p>
<p>The computed eddy viscosity is the Pythagorean sum of 3D and 2D contributions:</p>
<p><span class="math display" id="eq:equ-wu">\[\begin{equation}
\nu_{T} = \sqrt{\nu_{3D}^{2} + \nu_{2D}^{2}} \\

\upsilon_{3D} = C_{3D}U^{*}L_{m} \\

U^{*} = |U|n\frac{\sqrt{g}}{d^{\frac{1}{6}}} \\

\upsilon_{2D} = C_{2D}L_{m}^{2}|\nabla U| \\

|\nabla U| = \sqrt{\left( \frac{\partial u}{\partial x} \right)^{2} + \left( \frac{\partial v}{\partial y} \right)^{2} + \frac{1}{2}\left( \frac{\partial u}{\partial y} + \frac{\partial v}{\partial x} \right)^{2}}
\tag{1.27}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\nu_{T}\ \)</span> is the final total 2D viscosity<br />
</li>
<li><span class="math inline">\(\nu_{3D}\ \)</span>is the vertical 3D viscosity contribution<br />
</li>
<li><span class="math inline">\(\nu_{2D}\ \)</span>is the horizontal 2D viscosity contribution<br />
</li>
<li><span class="math inline">\(C_{3D}\)</span> coefficient for 3D viscosity contribution<br />
</li>
<li><span class="math inline">\(C_{2D}\)</span> coefficient for 2D viscosity contribution<br />
</li>
<li><span class="math inline">\(U^{*}\)</span> is the friction velocity (is <span class="math inline">\(\sqrt{\frac{\tau_{bed}}{\rho}}\)</span>)<br />
</li>
<li><span class="math inline">\(L_{m}\)</span> is the turbulent length scale (is lesser of flow depth or distance to wet/dry boundary)<br />
</li>
<li><span class="math inline">\(n\)</span> is Manning’s bed friction (see note below on treatment of high Manning’s n materials)<br />
</li>
<li><span class="math inline">\(g\)</span> is gravity<br />
</li>
<li><span class="math inline">\(d\)</span> is water depth<br />
</li>
<li><span class="math inline">\(|\nabla U|\)</span> is the magnitude of the 2D velocity strain tensor</li>
</ul>
<p>The computed viscosity <span class="math inline">\(\nu_{T}\)</span> can be output using the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command. In our testing to date, we have found <span class="math inline">\(C_{3D} = 7\)</span>  and <span class="math inline">\(C_{2D} = 0\)</span> to yield results that agree well with benchmark tests and that are not significantly dissimilar from those of the previous Smagorinsky method with its default coefficients for situations where the depth is not significantly greater than the cell-size. The values of <span class="math inline">\(C_{3D} = 7\)</span> and <span class="math inline">\(C_{2D} = 0\)</span> are the default values but can be changed using the <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> command. This effectively ignores the 2D component in the Wu model. Alternatively, to use only the 2D component of the model (and ignore the 3D component), we have found <span class="math inline">\(C_{3D} = 0\)</span> and <span class="math inline">\(C_{2D} = 4\)</span> to be a suitable starting point. As always, calibration remains an essential step. If quality calibration data is available and all Manning’s values are within industry standard ranges, then we encourage the user to adjust the coefficients as necessary to achieve calibration. We anticipate that calibration should be possible with either <span class="math inline">\(C_{2D}\)</span> or <span class="math inline">\(C_{3D}\)</span> in the range 1 to 7. If values outside this range are required then this may indicate other errors (eg. boundary values or schematisation, poor input data, etc). As always, sensitivity testing of changes in parameters on the model results should also be performed.</p>
<p>It is a common practice to represent buildings in a model as roughness (i.e. cells with high Manning’s bed friction), see discussion on modelling buildings in Section <a href="Common-2.html#urban-areas-3">1.2.10</a>. As the friction velocity includes the Manning’s value, this results in a very high viscosity value at those cells. This is not unreasonable, but for TUFLOW HPC, which handles the viscosity explicitly, this can drive the timestep down to small values. We have found that limiting the Manning’s values used in the Wu 3D model to a sensible maximum (for example 0.1) makes very little difference to the model results but can vastly improve solution time. This upper limit is included as an optional third value to the <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> when using the Wu approach. Note that the original high Manning’s value, as defined in the materials database, is used in the momentum equation where its primary influence is effected.</p>
</div>
</div>
<div id="SGS-3" class="section level3 hasAnchor" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Sub-Grid Sampling (SGS)<a href="HPC-specific-2.html#SGS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!--
This section will be quite large and need to include:

- Intro to SGS
- SGS Methodology
- Infiltration considerations
- SGS commands
- SGS commands - Advanced
- Output options
-->
<!-- write as is for Method C, don't include superseded commands (but put in appendix) inc method a, method b. Ask SG if we include Method A-->
<p>Sub-grid sampling (SGS) stores elevation points sampled at a finer resolution than the 2D cell to more accurately represent the variations in terrain inside the cell, as shown in Figure <a href="HPC-specific-2.html#fig:fig-image68">1.29</a>. SGS functionality is introduced in Section <a href="#SubGridSamplingSGS-3"><strong>??</strong></a>. Benchmark testing has shown the benefits of using SGS to be substantial, as discussed in Section <a href="#SGS-benefits-4"><strong>??</strong></a>.</p>
<p>SGS translates the high resolution sampled elevation data into cell curve functions for its hydraulic calculations.</p>
<ul>
<li>The cell volume is stored as a non-linear function of elevation (i.e. a curve of cell volume versus elevation based on the wetted surface area versus depth measured from the lowest sampled elevation within the 2D cell).</li>
<li>Across each cell side the flow area and flow width are calculated based on sampled elevations to produce a non-linear function of conveyance versus elevation (i.e. a curve of conveyance versus elevation. For determining the depth and width averaged velocity across each cell face the flow area is also
retained as a curve of area versus elevation).</li>
</ul>
<p>The elevation dataset sample resolution can be defined by the user. For example, using a 8m cell size and a 2m <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> the DEM is sampled at 5 points across each face. Shown in Figure <a href="HPC-specific-2.html#fig:fig-image68">1.29</a> this translates to 25 elevation points being used to define the volume vs elevation relationship within the 2D cell, and 5 points along each cell side for defining the conveyance-elevation relationship of each face.</p>
<div style="display: flex; justify-content: center; align-items: center;">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image67"></span>
<img src="images/image67.jpeg" alt="Traditional (non-SGS) Approach" width="50%" />
<p class="caption">
Figure 1.28: Traditional (non-SGS) Approach
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image68"></span>
<img src="images/image68.jpeg" alt="SGS Approach" width="50%" />
<p class="caption">
Figure 1.29: SGS Approach
</p>
</div>
</div>
<p>The flow or conveyance of water through 2D cells is determined through a full 2D solution of the momentum equation (see Section <a href="Solvers-2.html#Solvers-2">1.1</a>). The bed resistance term (e.g. Manning’s equation) and the determination of the 2D velocities are controlled by the conveyance properties of each cell face. If there are considerable variations in bed topography across the cell faces, SGS will provide a significantly more accurate representation of these variations, compared to a traditional 2D cell with a single elevation value per cell face.</p>
<p>If the resolution of the DEM data layer is coarser or similar to the 2D cell size, the use of SGS will have little or no benefit. For example, if the DEM resolution is 2m and the cell size is 2m there is little benefit in using SGS, although a slight improvement would result as the slope of the terrain across the cell would be picked up if using SGS. In contrast, if the cell size is 20m there would be considerable benefit in using SGS as the variations in terrain across the 2D cell will be represented. TUFLOW requires an odd number of sample locations across a cell face to ensure the cell mid-face and cell corners are sampled. The number of sample locations across a cell face is referred to as the <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a>.</p>
<p>Note, if the elevation input data has a reasonable representation of the channels, <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tgcReadGISZLine">Read GIS Z Line</a> “MIN, GULLY or LOWER” lines are not required, or recommended, when using SGS. Including gully lines can overestimate conveyance in these channels.</p>
<p>The following section will focus on implementing SGS and options regarding SGS outputs.</p>
<div id="SGS-commands-4" class="section level4 hasAnchor" number="1.3.3.1">
<h4><span class="header-section-number">1.3.3.1</span> SGS Methodology and Commands<a href="HPC-specific-2.html#SGS-commands-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To implement SGS the only additional command required in the .tcf is “<tcmd><a href="#tcfSGS">SGS</a></tcmd><teq> == </teq><tblk>ON</tblk>”.</p>
<p>By default, using this command will set:</p>
<ul>
<li>the <a href="#tcfSGSApproach">SGS Approach</a> to Method C. Prior to 2023 release the default was Method B. The default Method C is the recommended approach and older versions are considered legacy though are still provided for backward compatibility.</li>
<li>the <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> to sample at the minimum grid elevation resolution that can be found from grids read in to the .tgc.</li>
</ul>
<div id="SGS-Distance-5" class="section level5 hasAnchor" number="1.3.3.1.1">
<h5><span class="header-section-number">1.3.3.1.1</span> SGS Sample Distance<a href="HPC-specific-2.html#SGS-Distance-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To manually set the SGS distance, the recommended approach is to use the .tcf <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> command. TUFLOW requires an odd number of sample locations across a cell face, the number of sample points is calculated from Equation <a href="HPC-specific-2.html#eq:equ-sgs-smp-freq">(1.28)</a></p>
<p><span class="math display" id="eq:equ-sgs-smp-freq">\[\begin{equation}
\text{Sample Frequency} = \frac{\text{TUFLOW Cell Size}}{\text{Target Distance}} + 1
\tag{1.28}
\end{equation}\]</span></p>
<p>For example, using a cell size of 10m and a sample target distance of 1m, TUFLOW will use 11 sample points along the cell face. If the target distance specified gives an even number, TUFLOW will round up to the next odd number. For example, using a cell size of 5m and a sample target distance of 1m, TUFLOW will use 7 sample points instead of 6 points along the cell face. The adopted sampling frequency is reported in the .tlf.</p>
<p>It is also possible to specify the <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> directly instead of the target distance. When using this command with a quadtree model (see Section <a href="HPC-specific-2.html#Quadtree-3">1.3.1</a>), frequencies can be set for each nested level. For example, a model with three quadtree nested levels could use <tcmd><a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a></tcmd><teq> == </teq><tblk>9, 5, 3</tblk> and TUFLOW will use a sample frequency of 9 for the first nested level, 5 for the second, and 3 for the third. It is important to note that changing the base cell size (with or without quadtree) of the model would require a changing to the sample frequency to maintain the same sample distance. When using a target sample distance the same value can be used across all cell sizes.</p>
<p>To obtain the maximum resolution, the sampling frequency can be calculated as the TUFLOW cell size divided by the DEM resolution. If this yields an even number, then it should be rounded up as per Equation <a href="HPC-specific-2.html#eq:equ-sgs-smp-freq">(1.28)</a>. Note, there is no benefit to specify an SGS target distance smaller than the DEM resolution.</p>
<p>If neither the <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> or <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> commands are specified, a scan of the Geometry Control File (.tgc) is performed to find the minimum raster grid resolution used in any <a href="#tgcReadGridZpts">Read Grid Zpt</a> commands, and this is used as the sampling target distance to compute the sampling frequency. If there are no gridded elevation datasets, a default sampling frequency of 11 is used. In summary, there are four ways for the SGS Sample Frequency to be defined; in decreasing order of priority they are:</p>
<ol style="list-style-type: decimal">
<li>“<tcmd><a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> </tcmd><teq>==</teq>” command.</li>
<li>“<tcmd><a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a></tcmd><teq> ==</teq>” command.</li>
<li>Target distance automatically based on the minimum grid elevation resolution in the .tgc.</li>
<li>Default Sampling Frequency of 11 per face / 121 per cell.</li>
</ol>
<p>Note: the sampling frequency per face is capped at 31 by default to avoid long pre-processing times and high memory usage. In general, a sampling frequency of between 11 and 31 is sufficient for most natural water ways or artificial structures, and users may not benefit from applying a super fine sample distance against the model cell size. However, if required, high sampling resolution is possible and the set upper limit can be increased by using the following tcf command:</p>
<p><tcmd><a href="#tcfSGSMaxSampleFrequency">SGS Max Sample Frequency</a> </tcmd><teq>==</teq> &lt;maximum_frequency&gt;</p>
<p>Note, a hard limit of 127 per face (16,129 samples per cell) still applies.</p>
</div>
<div id="SGS-TopoUpdates-5" class="section level5 hasAnchor" number="1.3.3.1.2">
<h5><span class="header-section-number">1.3.3.1.2</span> SGS Topographic Updates<a href="HPC-specific-2.html#SGS-TopoUpdates-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The approach by which topographic updates modify SGS elevations depends on the specific topographic feature. There are three types of SGS topographic update approaches:</p>
<ol style="list-style-type: decimal">
<li>The topographic update layer directly modifies the SGS elevations.</li>
<li>The topographic update layer modifies the cells ZC, ZU, ZV and ZH Zpts first. Then all SGS elevations within the cell are sampled from the sloping cell faces and sloping cell areas created by the modified control Zpts.</li>
<li>The entire cell/face is updated based on one flat elevation value.</li>
</ol>
<p>Not all topography update features are currently supported for SGS. Table <a href="HPC-specific-2.html#tab:tab-sgs-topo-updates">1.26</a> summarises the update approach adopted by available features and lists any unsupported features.</p>
<table>
<caption>
<span id="tab:tab-sgs-topo-updates">Table 1.26: </span><strong>SGS Topography Update Approaches</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Full SGS Sampling using Sample Distance
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Uses ZC/ZU/ZV/ZH values
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Sets Flat Cell/Face
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Unsupported Features
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="#tgcCreateTINZpts">Create TIN Zpts</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISZShape">Read GIS Z Shape</a> (Breaklines)
</td>
<td style="text-align:left;">
<a href="#tgcSetZpt">Set Zpt</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGridZpts">Read Grid Zpts</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a> (Breaklines)
</td>
<td style="text-align:left;">
<a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISFCShape">Read GIS FC Shape</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadTINZpts">Read TIN Zpts</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISZLine">Read GIS Z Line</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a>
</td>
<td style="text-align:left;">
<a href="#tgcReadGISZptsModifyConveyance">Read GIS Zpts Modify Conveyance</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISZShape">Read GIS Z Shape</a> (Regions)
</td>
<td style="text-align:left;">
<a href="#tgcReadGISZpts">Read GIS Zpts</a> (Regions)
</td>
<td style="text-align:left;">
1D Nodes with SXZ Flag
(<a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> <teq>==</teq><tblk> Method A</tblk>)
</td>
<td style="text-align:left;">
<a href="#tgcReadRowColZpts">Read RowCol Zpts</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a> (Regions)
</td>
<td style="text-align:left;">
1D Nodes with SXZ Flag
(<a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> <teq>==</teq><tblk> Method B</tblk>)
</td>
<td style="text-align:left;">
1D Pits with SXL Flag
(<a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> <teq>==</teq><tblk> Method A</tblk>)
</td>
<td style="text-align:left;">
<a href="#tgcInterpolateZC">Interpolate ZC</a> / <a href="#tgcInterpolateZHC">ZHC</a> / <a href="#tgcInterpolateZUV">ZUV</a> / <a href="#tgcInterpolateZUVC">ZUVC</a> / <a href="#tgcInterpolateZUVH">ZUVH</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1D Pits with SXL Flag
(<a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> <teq>==</teq><tblk> Method B</tblk>)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<a href="#tgcSetCodeandCleanZpt">Set Code with Clean Zpt</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<a href="#tgcZC">ZC</a> <teq>==</teq><tblk> MIN(ZU,ZV)</tblk>
</td>
</tr>
</tbody>
</table>
<p>The below provides a summary of SGS specific considerations for implementing 2d_zsh modifications (see Section <a href="Common-2.html#zsh-4">1.2.5.2</a>):</p>
<ol style="list-style-type: decimal">
<li>2d_zsh polygons and TINs directly modify all SGS resolution sample points within the polygon based on the TIN triangulation. However, 2d_zsh lines modify elevations based on the cell’s control Zpts, as described in Section <a href="HPC-specific-2.html#SGS-Advanced-5">1.3.3.1.3</a> – <a href="#tcfSGSZShapeLineApproach">SGS Z Shape Line Approach</a>. See Table <a href="HPC-specific-2.html#tab:tab-sgs-topo-updates">1.26</a>.</li>
<li>By default, a gradient is applied along the cell face (using the side and corner ZH, ZU and ZV Zpts) for all 2d_zsh line types. For thick and wide lines, a sloping cell area for the cell volumes (using ZC, ZU, ZV and ZH Zpts) is also applied. SGS points are sampled from these. See Section <a href="HPC-specific-2.html#SGS-Advanced-5">1.3.3.1.3</a> – <a href="#tcfSGSZShapeLineApproach">SGS Z Shape Line Approach</a> for details.
<ul>
<li>For partially selected cells at a 2d_zsh wide line buffer’s boundary, a sloping cell area is determined based on the cell’s modified Zpts within the buffer and the unmodified Zpts outside the buffer. All SGS sample points will be updated within the partially selected cell.<br>
<strong>Note:</strong> It is recommended to consider alternative TIN 2d_zsh modification methods via <a href="#tgcReadGISZShape">Read GIS Z Shape</a> 2d_zsh polygons or <a href="#tgcCreateTINZpts">Create TIN Zpts</a> to improve representation.</li>
</ul></li>
<li>Use of the MIN or GULLY option is not recommended, as it can overestimate conveyance – see Section <a href="HPC-specific-2.html#HPC-US-Controlled-3">1.3.4</a>.</li>
<li>It is strongly recommended to add MAX or RIDGE lines (see Table <a href="Common-2.html#tab:tab-ZShapeAttributeLine">1.6</a>) for every hydraulic control (e.g. levees (artificial or natural), road/rail embankments, etc.) to reduce “leakiness” caused by SGS sampling. See Section <a href="HPC-specific-2.html#SGS-Advanced-5">1.3.3.1.3</a> – <a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a>. This includes enforcing any crests of hydraulic controls created through a polygon or TIN 2d_zsh modification.</li>
</ol>
<!-- list break -->
</div>
<div id="SGS-Advanced-5" class="section level5 hasAnchor" number="1.3.3.1.3">
<h5><span class="header-section-number">1.3.3.1.3</span> Advanced SGS Commands<a href="HPC-specific-2.html#SGS-Advanced-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>As noted above, the only command required to implement SGS is “<tcmd><a href="#tcfSGS">SGS</a></tcmd><teq> == </teq><tblk>ON</tblk>”. One of the above commands to set the SGS sample distance or frequency is also recommended. The following section lists advanced commands related to SGS.</p>
<hr />
<p><tcmd><a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a></tcmd><teq> == </teq><tblk> [ &lt;maximum_delta_value&gt; ]</p>
<p>When the SGS elevations are being processed, every cell face will store a curve of elevation versus flow width / flow area. Likewise, each cell has a curve defining the relationship of elevation versus cell volume. To make this memory efficient TUFLOW does not store information defining the specific locations within the cell or along the cell face where the low or high points in the topography occur. As a result, without breaklines, SGS will be more likely to allow “leaks” through a levee or embankment compared with running the model without SGS (see <a href="https://wiki.tuflow.com/Quadtree_and_Sub-Grid_Sampling_FAQ#Why_shouldn.27t_I_use_Z_Shape_gully.2Fmin_lines_with_SGS_models.3F">TUFLOW Wiki Quadtree and SGS FAQ</a> for details). For example, if a 2D cell straddles a levee, SGS will sample the low elevations on either side of the levee and will flow at a lower level than if SGS was not applied and the 2D cell centre was located on top of the levee, causing the 2D cell to block flow until the levee is overtopped. Whilst the need to have breaklines is paramount, regardless of whether SGS is used, it is even more important for SGS models to accurately represent hydraulic controls such as levees (artificial or natural), road/rail embankments, fences, etc.</p>
<p><a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a> is designed to identify locations where ridge lines may be required. As noted in Section <a href="HPC-specific-2.html#SGS-3">1.3.3</a>, <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tgcReadGISZLine">Read GIS Z Line</a> “MIN, GULLY or LOWER” lines are not recommended for use. See the <a href="https://wiki.tuflow.com/Quadtree_and_Sub-Grid_Sampling_FAQ#Why_shouldn.27t_I_use_Z_Shape_gully.2Fmin_lines_with_SGS_models.3F">TUFLOW Wiki Quadtree and SGS FAQ page</a> for more details.</p>
<p>The SGS breakline detection check processes each 2D cell to identify the minimum water surface elevation needed for a continuous wet connection through the cell traversing between left to right and top to bottom. The maximum invert elevation of the left and right faces is subtracted from the left-right minimum water level and reports it as “uDelta”. Similarly, the top to bottom value is reported as “vDelta”. uDelta and vDelta represent the depth of water over the cell face inverts by which a natural ridge (break) line would block any flow. The maximum of uDelta and vDelta is output to the <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> file in the SGS_Delta_Z attribute. If either uDelta or vDelta exceeds the <maximum delta value> a spatial (GIS) <a href="https://wiki.tuflow.com/TUFLOW_Message_3543">CHECK 3543</a> message is issued at the cell location.</p>
<p>This command can add significant time to the initialisation process, it is recommended to perform this check during model set up only, and to turn it off once the creation of breaklines is complete.</p>
<p>Figure <a href="HPC-specific-2.html#fig:fig-SGS-Delta">1.30</a> shows an example of where <a href="https://wiki.tuflow.com/TUFLOW_Message_3543">CHECK 3543</a> indicates where the uDelta or vDelta has exceeded the <maximum delta value> (in this example, a value of 1m).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS-Delta"></span>
<img src="images/SGS-Delta.png" alt="SGS Breakline Detection Delta Output" width="50%" />
<p class="caption">
Figure 1.30: SGS Breakline Detection Delta Output
</p>
</div>
<hr />
<p><tcmd><a href="#tcfSGSZShapeLineApproach">SGS Z Shape Line Approach</a></tcmd><teq> == </teq><tblk>Method A | {Method B}</tblk></p>
<p>If set to Method A, cell faces modified by <a href="#tgcReadGISZShape">Read GIS Z Shape</a> line are assumed flat (i.e. SGS is not applied and a rectangular section / flat cell is used). The default, Method B, applies a gradient along the face based on the cell corners and cell side Zpt values and for thick and wide lines uses the ZC, ZU, ZV and ZH values to apply a sloping cell area for the cell volume.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS-Z-Line"></span>
<img src="images/SGS-Z-Line.png" alt="Diagram of SGS Z Shape Line Approach Options" width="50%" />
<p class="caption">
Figure 1.31: Diagram of SGS Z Shape Line Approach Options
</p>
</div>
<hr />
<p><tcmd><a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a></tcmd><teq> == </teq><tblk>Method A | {Method B}</tblk></p>
<p>If set to Method A, cells that are lowered by the “Z” flag on 2d_bc SX connections are assumed flat (i.e. as per the approach for no SGS). The default Method B retains the SGS information, but shifts it all to match the lowered elevation, as per Figure <a href="HPC-specific-2.html#fig:fig-sgs-SX-Flag">1.32</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-sgs-SX-Flag"></span>
<img src="images/sgs-SX-Flag.png" alt="Diagram of SGS SX Z Flag Approach Options" width="30%" />
<p class="caption">
Figure 1.32: Diagram of SGS SX Z Flag Approach Options
</p>
</div>
<!-- EFC to PAR: do I also need to link here from the direct rainfall section?-->
<!-- EFC to PAR: I've copied this from the 2020 release notes what is the SGS Negative Rainfall approach? Is it different to the Soil Negative Rainfall approach command?-->
<!-- SGS neg rainfall approach - is regarding surface water, no soils-->
<hr />
<p><tcmd><a href="#tcfSGSInfiltrationApproach">SGS Infiltration Approach</a></tcmd><teq> == </teq><tblk> {AUTO} | TOTAL AREA | WETTED AREA </tblk></p>
<p>It is possible to control the cell area used when infiltration is applied with SGS, using the <a href="#tcfSGSInfiltrationApproach">SGS Infiltration Approach</a> command. The three available options are:</p>
<ul>
<li>AUTO (the default): uses total area if there is a rainfall boundary and wetted area if no rainfall boundaries are present.</li>
<li>TOTAL AREA: uses the whole cell area, regardless of the portion of the cell that is wet.</li>
<li>WETTED AREA: uses only the wetted portion of the cell, for direct rainfall boundaries this may under predict the infiltration.</li>
</ul>
<hr />
<p><tcmd><a href="#tcfSGSNegativeRainfallApproach">SGS Negative Rainfall Approach</a> </tcmd><teq> == </teq><tblk> TOTAL AREA | {WETTED AREA} </tblk></p>
<p>It is also possible to control the cell area used when negative rainfall is applied in conjunction with SGS, using the <a href="#tcfSGSNegativeRainfallApproach">SGS Negative Rainfall Approach</a> command. The two options available are:</p>
<ul>
<li>TOTAL AREA: uses the whole cell area, regardless of the portion of the cell that is wet.</li>
<li>WETTED AREA (the default): uses only the wetted portion of the cell.</li>
</ul>
<p>With SGS enabled, for cells that are partially wet the treatment of infiltration and direct rainfall is:</p>
<ul>
<li>For positive rainfall (i.e. rainfall on to the 2D cell), the volume source for each cell is the total cell area times the rainfall irrespective of whether the cell is partially wet or not.</li>
<li>For negative rainfall (evaporation), the volume of evaporation is factored by the wet area fraction of the cell. That is, if the cell is only 10% wet, only one tenth of the cell’s total area contributes to the negative source term.</li>
<li>For models with soil infiltration the infiltration rate is proportional to the wet area fraction of the cell. However, initial infiltration losses are based on the total area of the cell (i.e. infiltration will proceed at the maximum possible rate until the cumulative infiltration – also based on total cell area - equals the initial loss value) even if the infiltration occurs with the cell partially wet. This approach is adopted to conform with that required for direct rainfall, which assumes the rainfall is applied over the entire cell irrespective of whether the cell is partially wet or not. Likewise, soil capacity is based on the total cell area (i.e. infiltration will cease once the cumulative infiltration equals soil capacity), and the cumulative wet time for the Horton model will also increment for cells that are partially wet.</li>
</ul>
<hr />
<p><tcmd><a href="#tcfSGSSheetFlowApproach">SGS Sheet Flow Approach</a> </tcmd><teq> == </teq><tblk> {Method A} | Method B </tblk></p>
<p>Method A (the default) assumes water is filling up from the bottom of the cell, and uses the <strong>depth above minimum cell elevation</strong> in the Manning’s bed friction calculation (see Equations <a href="Solvers-2.html#eq:equ-x-momentum">(1.2)</a> and <a href="Solvers-2.html#eq:equ-y-momentum">(1.3)</a>).</p>
<p>However, sheet flow conditions can occur in direct rainfall models on hill slopes, where water forms a thin layer and flows downstream. Using the <strong>depth above minimum cell elevation</strong> in such locations could underestimate bed friction. Method B checks whether SGS cells are subjected to sheet flow conditions or not, and uses <strong>cell averaged depth</strong> at the sheet flow cells to adjust the depth for the bed friction calculation.</p>
<p>Method B also fixes overestimation of water level gradient limiter for SGS models in cells experiencing sheet flow. Where flow in the 2D domain becomes upstream controlled, TUFLOW HPC triggers a weir flow approximation by applying a limiter to the water level gradient. This limiter can be wrongly triggered for SGS models in cells when water flows down a hill slope under sheet flow conditions. Method A (the default) calculates the gradient limiter using the same method as non-SGS models, while Method B applies an SGS specific calculation to address the issue above.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS-Sheet-Flow"></span>
<img src="images/SGS-Sheet-Flow.png" alt="Diagram of SGS Sheet Flow Approach Options" width="50%" />
<p class="caption">
Figure 1.33: Diagram of SGS Sheet Flow Approach Options
</p>
</div>
<hr />
</div>
</div>
<div id="SGS-output-4" class="section level4 hasAnchor" number="1.3.3.2">
<h4><span class="header-section-number">1.3.3.2</span> SGS Output Options<a href="HPC-specific-2.html#SGS-output-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="SGS-check-5" class="section level5 hasAnchor" number="1.3.3.2.1">
<h5><span class="header-section-number">1.3.3.2.1</span> Check Files<a href="HPC-specific-2.html#SGS-check-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>When running a model with SGS enabled there are additional attributes inserted into the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt check</a> layer and an additional raster check file, the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Zmin">_DEM_Zmin</a>.</p>
<p>If the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt check</a> layer is output, with SGS turned on, the following additional attribute information is provided:</p>
<ul>
<li>The “Zmin” attribute for ZC points, previously called “Elevation”, now represents the minimum elevation within the cell. The “Zmin” for ZU/ZV points is the minimum along the cell face. Note, these points are still located at the centre of the cell or cell face, but the minimum value is not necessarily at this location.</li>
<li>“ZExact” is the elevation at the exact location of cell centre, face mid-point, or cell corner.</li>
<li>“ZAvg” is the average (mean) elevation of the sampled values.</li>
<li>“ZMed” is the median elevation of the sampled values.</li>
<li>The “ZMax” attribute is the maximum elevation (i.e. the elevation at which the cell area or cell face flow width is fully wet).</li>
<li>“ZOut” is the elevation used for the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> (Section <a href="HPC-specific-2.html#sgs-output-5">1.3.3.2.2</a>).</li>
</ul>
<p>If the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z</a> layer is output, with SGS turned on, an additional raster output is produced, the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Zmin">_DEM_Z_min</a>. The _DEM_Zmin contains a raster based on the minimum SGS elevations. When using SGS, the _DEM_Z contains a raster based on the SGS elevations used for the depth output interpolation (based on the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> command.)</p>
</div>
<div id="sgs-output-5" class="section level5 hasAnchor" number="1.3.3.2.2">
<h5><span class="header-section-number">1.3.3.2.2</span> Map Outputs<a href="HPC-specific-2.html#sgs-output-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The following .tcf commands can be used to control the value of depth (d) map output when SGS is used.</p>
<p><tcmd><a href="#tcfSGSDepthOutput">SGS Depth Output</a></tcmd><teq> == </teq><tblk>EXACT | {CELL AVERAGE} | MEAN | MEDIAN | MINIMUM | PERCENTILE </tblk></p>
<ul>
<li>CELL AVERAGE (default): calculates the depth by dividing the cell volume by cell area.</li>
<li>EXACT: the output depth is the water level minus the exact ZC and ZH elevations (i.e. the elevations that would be sampled exactly at the cell centre (ZC) and cell corner (ZH) locations if SGS was not applied).</li>
<li>MEAN: the output depth is the water level minus the mean elevations of the cells and the cell corners from the SGS sampling. Note the MEAN depth output differs from the CELL AVERAGE depth for partially wet cells. For example, if the water level is smaller than the MEAN cell elevation, the MEAN depth output becomes negative (trimmed as zero), while the CELL AVERAGE depth (water volume / cell area) is still positive.</li>
<li>MEDIAN: the output depth is the water level minus the median (50th percentile) elevation for the cells and the cell corners from the SGS sampling.</li>
<li>MINIMUM: the output depth is the water level minus the minimum elevation for the cells and the cell corners from the SGS sampling (i.e. the map output shows the maximum depth within a cell / around a cell corner).</li>
<li>PERCENTILE: the output depth is water level minus an elevation based on the specified set percentile. This requires a second argument, separated by vertical bar “|”, which is the percentile to use. For example, “<tcmd><a href="#tcfSGSDepthOutput">SGS Depth Output</a></tcmd><teq> == </teq><tblk>Percentile | 25</tblk>” will use the 25th percentile of the SGS elevations sampled within the cell / around the cell corner.</li>
</ul>
<p>The elevations used for the SGS Depth Output are output in the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt_check</a> file as the “ZOut” attribute, see Section <a href="HPC-specific-2.html#SGS-check-5">1.3.3.2.1</a>.</p>
<p>Note that the water level (h) output is not affected by this command.</p>
<p>For the EXACT, MEAN, MEDIAN, MINIMUM, PERCENTILE approaches, the depth output is trimmed if the modelled water level is lower than the output elevations. Meanwhile, the water level output is not trimmed even if the output depth is below the output elevations, and this can produce different output extents for the water level and other outputs. For this reason, the CELL AVERAGE option is recommended for the consistency of the output extent. But if using the other options, the default trimming option can be changed using the <a href="#tcfSGSMapExtent">SGS Map Extent <Trim or Full></a> command.</p>
<p>For the MEAN, MEDIAN, MINIMUM, PERCENTILE approaches, the corner output elevations depend on the size of the SGS sampling area around the cell corners. By default, cell corner elevations are sampled within a square that has the same size as the 2D cell. The size be manually adjusted using the <a href="#tgcSGSZHSampleRatio">SGS ZH Sample Ratio</a> command.</p>
<p>By default the CELL AVERAGE depth is used to calculate the depth/velocity based map outputs, such as unit flow (q), bed shear stress (BSS), stream power (SP) and hazards, regardless of the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> setting. However, if desired, the depth used to calculate these map outputs can be changed using the following command:</p>
<p><tcmd><a href="#tcfSGSVelocityBasedOutputs">SGS Velocity Based Outputs</a></tcmd><teq> == </teq><tblk> {CELL AVERAGE DEPTH} | SGS DEPTH OUTPUT </tblk></p>
<p>If set to the “SGS DEPTH OUTPUT” option, the output depth specified by the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> command above is used. Note that the velocity (v) output is not affected by these commands.</p>
</div>
<div id="HighResOutputs-5" class="section level5 hasAnchor" number="1.3.3.2.3">
<h5><span class="header-section-number">1.3.3.2.3</span> High-Resolution Outputs<a href="HPC-specific-2.html#HighResOutputs-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>When using the default sub-grid sampling (SGS) approach the sampled elevations are retained, including topography modifiers such as breaklines, for result post processing. This allows a high-resolution grid to be written (for either depth (d) or water level (h)) and used for high resolution map outputs and also check grids such as the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z_HR">_DEM_Z_HR</a>. High-resolution outputs, made available when using SGS Method C, are discussed in Section <a href="#HRGrid-4"><strong>??</strong></a>.</p>
<p>The following commands can be used to alter the high resolution output and are discussed further in Appendix <a href="#TCFCommands-1"><strong>??</strong></a>.</p>
<ul>
<li><a href="#tcfHRInterpolationApproach">HR Interpolation Approach</a>: can be used to control how the cell centre / corner data is interpolated across the cell.</li>
<li><a href="#tcfHRThinZLineOutputAdjustment">HR Thin Z Line Output Adjustment</a>: for models with thin breaklines, the presence of breaklines can be used to alter the High Resolution output interpolation.</li>
</ul>
</div>
</div>
</div>
<div id="HPC-US-Controlled-3" class="section level3 hasAnchor" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)<a href="HPC-specific-2.html#HPC-US-Controlled-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The original weir flow approximation in TUFLOW HPC was to adjust the water level gradient where flow in the 2D domain becomes upstream controlled. The 2023-03 release (and onwards) defaults to applying the full weir equation in the 2D domain along thin and thick breaklines based on the advanced weir equation (Section <a href="#Adv-Weir-4"><strong>??</strong></a>). However, users can revert to the original approach using the command:</p>
<p><tcmd><a href="#tcfHPCWeirApproach">HPC Weir Approach</a></tcmd><teq> == </teq><tblk>Method A | Method B | {Method B Energy}</tblk></p>
<p>Where:</p>
<ul>
<li>“Method A” is the pre 2023-03 method that applies the water level gradient limiter only.<br />
</li>
<li>“Method B” applies the weir equation and uses the upstream water level above the weir invert as <em>H<sub>u</sub></em>, and downstream water level above the weir invert as <em>H<sub>d</sub></em>.<br />
</li>
<li>“Method B Energy” is the default approach. It applies the weir equation and uses the upstream energy level above the weir invert as <em>H<sub>u</sub></em>, and downstream water level above the weir invert as <em>H<sub>d</sub></em>.</li>
</ul>
<p>The default weir parameters (<em>C<sub>d</sub></em>, <em>Ex</em>, <em>a</em> and <em>b</em>) are based on the parameters used for a broad crest weir, see Table <a href="#tab:tab-WeirFlows"><strong>??</strong></a> (i.e. 0.577, 1.5, 8.55 and 0.556, respectively). The following .tcf commands can be used to change the coefficients globally.</p>
<p>For a thin breakline:</p>
<p><tcmd><a href="#tcfHPCWeirParameters">HPC Thin Weir Parameters</a></tcmd><teq> == </teq><tblk> &lt;Cd&gt;, &lt;Ex&gt;, &lt;a&gt;, &lt;b&gt;</tblk></p>
<p>For a thick breakline:</p>
<p><tcmd><a href="#tcfHPCWeirParameters">HPC Thick Weir Parameters</a></tcmd><teq> == </teq><tblk>&lt;Cd&gt;, &lt;Ex&gt;, &lt;a&gt;, &lt;b&gt;</tblk></p>
<p>A weir calibration factor can be specified globally using the <a href="#tgcSetWrF">Set WrF</a> command. It can also be adjusted locally with the <a href="#tgcReadGISWrF">Read GIS WrF</a> command, which uses a 2d_wrf GIS layer (see Table <a href="HPC-specific-2.html#tab:tab-WeirAdjustmentFactorAttributeDescriptions">1.27</a>). Note WrF is not equivalent to <em>C<sub>f</sub></em> in the advanced weir equation. To be consistent with TUFLOW Classic, the weir equation is divided by WrF. This means a WrF of 1.0 represents no adjustment, while a factor greater than one will decrease the flow efficiency. The default value of WrF is 1.0.</p>
<p>Models using the <a href="#tgcSetWrF">Set WrF</a> and <a href="#tgcReadGISWrF">Read GIS WrF</a> functionality are provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#2D_Structures">2D Structures Example Model Dataset</a> on the TUFLOW Wiki.</p>
<table>
<caption>
<span id="tab:tab-WeirAdjustmentFactorAttributeDescriptions">Table 1.27: </span>Weir Adjustment Factor (2d_wrf) Attribute Descriptions
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
WrF
</td>
<td style="text-align:left;">
The calibration factor used to adjust the weir equation.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
</div>
<div id="HPC-Infiltration-GW" class="section level3 hasAnchor" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> Infiltration and Groundwater Flow<a href="HPC-specific-2.html#HPC-Infiltration-GW" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section contains information relating to soil infiltration and groundwater flow options for TUFLOW HPC.</p>
<div id="HPC-Infiltration-4" class="section level4 hasAnchor" number="1.3.5.1">
<h4><span class="header-section-number">1.3.5.1</span> Infiltration<a href="HPC-specific-2.html#HPC-Infiltration-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="SCS-4" class="section level5 hasAnchor" number="1.3.5.1.1">
<h5><span class="header-section-number">1.3.5.1.1</span> SCS Curve Number (SCS)<a href="HPC-specific-2.html#SCS-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The SCS method, added in the 2025 release, uses a “curve number” <span class="citation">(<a href="CLASpecific-2.html#ref-USDA1986">USDA, 1986</a>)</span> (ranging from 100 for impervious rock down to approximately 30 for deep porous soils) to define the maximum infiltration that can soak into the ground. An initial loss for the soil can be defined, typically as a fraction (termed the “initial abstraction ratio”) of the maximum infiltration. The initial loss is not considered an extra loss - the remaining soil capacity after the initial loss is filled is equal to total soil capacity (as defined in Equation <a href="HPC-specific-2.html#eq:equ-SCS-1">(1.29)</a>) less the initial loss. The SCS method is only available in the HPC solver - it is not available in Classic. For the soil infiltration methods supported by both Classic and HPC, see Section <a href="Common-2.html#infiltration-layer-4">1.2.7.1</a>.</p>
<p>SCS infiltration differs from the alternative methods (e.g. Green-Ampt, Horton and ILCL - see Section <a href="Common-2.html#infiltration-layer-4">1.2.7.1</a>) in the following ways:</p>
<ol style="list-style-type: decimal">
<li>The maximum infiltration and the rate of infiltration are both defined by the curve number, and the initial loss by the abstraction ratio. As a result the soil capacity cannot be defined independently of the soil type, and similarly, initial water content of the soil cannot be defined independently of the soil type. Reading soil depth, porosity, and initial moisture as spatial layers are all disallowed with this method, and SCS soil types cannot be used in conjunction with any of the other soil types within the same model.</li>
<li>The infiltration is defined as a fraction of the applied rainfall, which is dependent only on the curve number and the cumulative rainfall at the location in question. Infiltration does not occur if there is no rain, and the amount that occurs is defined as a fraction of the rainfall, regardless of whether or not the soil has surface water over it. The SCS method is really a rainfall loss method defined according to soil type, rather rather than physics-based infiltration.</li>
<li>The SCS method is a rainfall loss method, and it can only be used with single layer soil files with groundwater depth unspecified, i.e. interflow (Section <a href="HPC-specific-2.html#CO-4">1.3.5.2.2</a>) is not allowed. The SCS method is not recommended for continuous simulations especially when sub surface flows may be of concern.</li>
</ol>
<p>The parameters used in the tsoilf by the SCS method are shown in Table <a href="HPC-specific-2.html#tab:tab-tsoilf-hpc">1.28</a>.</p>
<p>The maximum infiltration is defined (in inches) as</p>
<p><span class="math display" id="eq:equ-SCS-1">\[\begin{equation}
S = \frac{1000 - 10C_N}{C_N}
\tag{1.29}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(S\)</span> is the maximum infiltration in inches (which is converted for models in SI units)</li>
<li><span class="math inline">\(C_N\)</span> is the curve number</li>
</ul>
<p>The initial loss is defined as a fraction of the maximum infiltration:</p>
<p><span class="math display" id="eq:equ-SCS-2">\[\begin{equation}
IL = I_a S
\tag{1.30}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(IL\)</span> is the initial loss</li>
<li><span class="math inline">\(I_a\)</span> is the “initial abstraction ratio”</li>
</ul>
<p>For the duration where the cumulative rainfall is less than the initial loss, the cumulative infiltration must match the cumulative rainfall. After this time, the cumulative infiltration is defined as a fraction of the cumulative rainfall according to:</p>
<p><span class="math display" id="eq:equ-SCS-3">\[\begin{equation}
CI = RFC - \frac{\left(RFC - IL\right)^2}{RFC + S - IL}
\tag{1.31}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(CI\)</span> is the cumulative infiltration</li>
<li><span class="math inline">\(RFC\)</span> is the cumulative rainfall</li>
</ul>
<p>Once the cumulative infiltration matches the maximum, <span class="math inline">\(S\)</span>, no further infiltration occurs. This occurs at a cumulative rainfall of</p>
<p><span class="math display" id="eq:equ-SCS-4">\[\begin{equation}
RFC_s = S\left(\frac{1 - I_a + {I_a}^2}{I_a}\right)
\tag{1.32}
\end{equation}\]</span></p>
<p>This process is shown in Figure <a href="HPC-specific-2.html#fig:fig-SCS-example">1.34</a> for SCS curve number 50 with initial abstraction ratio 0.2. In this example the maximum infiltration, <span class="math inline">\(S\)</span>, is 10 inches, and is reached at 42 inches cumulation rainfall (marked as <span class="math inline">\(RFC_S\)</span>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SCS-example"></span>
<img src="images/SCS_example.png" alt=" SCS Infiltration for Curve Number 50, Ia = 0.2"  />
<p class="caption">
Figure 1.34:  SCS Infiltration for Curve Number 50, Ia = 0.2
</p>
</div>
<p>The instantaneous infiltration rate, during the period <span class="math inline">\(IL &lt; RFC &lt; RFC_s\)</span>, can then be found to be:</p>
<p><span class="math display" id="eq:equ-SCS-5">\[\begin{equation}
IR = \left(\frac{S}{S-IL+RFC}\right)^2 RF
\tag{1.33}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(IR\)</span> is the current infiltration rate</li>
<li><span class="math inline">\(RF\)</span> is the current rainfall rate</li>
</ul>
<p>For the SCS method, the infiltration rate is based on the rainfall as applied at ground level, i.e. after the material based initial loss and continuing losses have been applied. It is worth considering that the SCS method allows for an instantaneous absorption of rain up to the initial loss (initial abstraction ratio times maximum infiltration). In this case, any materials based initial loss and continuing loss should be thought of as interception losses only. With forested areas these may be large enough that they should be included, but in open grasslands they are probably insignificant. The infiltration losses are then also reduced according to the material fraction impervious, which effectively means that:</p>
<ol style="list-style-type: decimal">
<li>The soils based initial loss as defined by the initial abstraction ratio is reduced by the material fraction impervious, and</li>
<li>The total loss (i.e. equivalent to soil capacity) is also reduced by the material fraction impervious. When using sub-grid sampling, the wet area fraction method selected is not used as the losses apply to rainfall, not ponded water.</li>
</ol>
</div>
</div>
<div id="HPC-Groundwater-3" class="section level4 hasAnchor" number="1.3.5.2">
<h4><span class="header-section-number">1.3.5.2</span> Groundwater Flow<a href="HPC-specific-2.html#HPC-Groundwater-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!--Infiltration of the surface water into the ground/soil has been
supported in previous releases, however, as discussed in Section \@ref(Infiltration-2), this functionality was limited to vertical movement of water, and one vertical soil layer (the soil type could vary spatially across the model).-->
<p>From the 2023-03 release and onwards, horizontal flow (advection) of water (Section <a href="HPC-specific-2.html#hhc-5">1.3.5.2.1</a>) and multiple vertical groundwater layers (Section <a href="HPC-specific-2.html#CO-4">1.3.5.2.2</a>) when using TUFLOW HPC are supported. This groundwater flow feature is designed to model unconfined subsurface flow movement, including the saturated groundwater flow within unconfined aquifer and the variably saturated flow in vadose zone.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-grondwateroverview"></span>
<img src="images/groundwater_overview.png" alt=" Illustration of groundwater flow movement"  />
<p class="caption">
Figure 1.35:  Illustration of groundwater flow movement
</p>
</div>
<p>Up to 10 vertical layers are supported, each with horizontal advection within the layer possible, and vertical fluid movement between groundwater soil layers. Movement of water within the ground in the real world is complex. The functionality introduced in the 2023-03 release is not intended to replace detailed groundwater modelling, but provides a functional mechanism by which:</p>
<ul>
<li>Catchment response for 2D direct rainfall (“rain on grid”) models can be better calibrated to available river flow data.<br />
</li>
<li>Long-term catchment models can be constructed that offer some prediction of stream-flows long after rainfall events.<br />
</li>
<li>The accuracy of real-time flood forecasts can be improved by taking into account the drying and draining of catchments that has occurred since the last rainfall event.<br />
</li>
<li>Groundwater seepage can cause inundation, such as seepage under a levee bank through a porous layer (e.g., old gravel river course), resulting in flooding on the protected side of the levee.</li>
</ul>
<p>The basic groundwater modelling approach is conceptualised by dividing the ground into vertical layers, each with a defined thickness (alternatively a z elevation for the bottom of each layer), soil type, and cumulative infiltration of water within the layer. The cumulative infiltration, combined with the porosity defined by the soil type, allows a theoretical “groundwater elevation” (also known as a “water table”) to be computed within the layer. Figure <a href="HPC-specific-2.html#fig:fig-image108">1.36</a> illustrates the soil layers in adjoining cells with convective and advective fluxes.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image108"></span>
<img src="images/image108.png" alt=" Illustration of soil layers and flows in adjoining cells"  />
<p class="caption">
Figure 1.36:  Illustration of soil layers and flows in adjoining cells
</p>
</div>
<p>The horizontal movement of water, <span class="math inline">\(Q^{h}\)</span>, is governed by the horizontal hydraulic conductivity value set in the tsoilf file (see Table <a href="HPC-specific-2.html#tab:tab-tsoilf-hpc">1.28</a>). All groundwater layers allow for horizontal advection of the water within the layer. Horizontal advection is disabled if all horizontal hydraulic conductivities are set to zero (which is the default if they are not specified). An example of a model using horizontal hydraulic conductivity, is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Soil_Options">TUFLOW Example Model Dataset</a>.</p>
<p>The vertical flow of water, <span class="math inline">\(Q^{z}\)</span>, from the surface water layer into the first (or top) groundwater layer is governed by the soil infiltration model. The infiltration into the top soil can use any of the Green-Ampt (GA), Horton (HO) and Initial/Continuing Loss (IlCL) infiltration methods, as listed in Table <a href="HPC-specific-2.html#tab:tab-tsoilf-hpc">1.28</a>. For layers below the top vertical soil layer then the Convective (CO) type must be used, see Section <a href="HPC-specific-2.html#CO-4">1.3.5.2.2</a>. An example of a model using two vertical soil layers (i.e. the “CO” type), is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Soil_Options">TUFLOW Example Model Dataset</a>.</p>
<p>The cumulative infiltration data and the vertical movement of water are stored and computed at cell centres. As such, all soil data and groundwater layer geometry is sampled from the GIS / Grid layers at cell centres. Likewise the material “fraction impervious” data is sampled at cell centres (unlike the mannings values which are sampled at face centres). For the horizontal advection calculation, which is performed at cell faces, the horizontal hydraulic conductivity used is the average of the cell centre values for the adjoining cells.</p>
<div id="hhc-5" class="section level5 hasAnchor" number="1.3.5.2.1">
<h5><span class="header-section-number">1.3.5.2.1</span> Horizontal Advection<a href="HPC-specific-2.html#hhc-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For all layers, the horizontal advection of water from one cell to the next, <span class="math inline">\(Q^{h}\)</span>, is computed using the horizontal hydraulic conductivity of the soil and the horizontal gradient of a variable called the “groundwater pressure level”:</p>
<p><span class="math display" id="eq:equ-Qh">\[\begin{equation}
Q^{h} = - k_{h}hp\frac{de}{dx}dy
\tag{1.34}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(k_{h}\)</span> is the horizontal hydraulic conductivity of the soil (average of the adjoining cells used)<br />
</li>
<li><span class="math inline">\(h\)</span> is the groundwater elevation less the layer bottom elevation<br />
</li>
<li><span class="math inline">\(p\)</span> is the soil porosity<br />
</li>
<li><span class="math inline">\(\frac{de}{dx}\)</span> is the gradient of the “groundwater pressure level”<br />
</li>
<li><span class="math inline">\(dy\)</span> is the width of the face</li>
</ul>
<p>Note, the soil porosity is often NOT included in the standard Darcy’s law equation, while the groundwater horizontal flux in TUFLOW is factored by the soil porosity. The 2025.1 release introduced a new command to turn porosity off in the horizontal flux calculation:</p>
<p><tcmd><a href="#tcfGroundwaterHorizontalFluxIncludePorosity">Groundwater Horizontal Flux Include Porosity</a></tcmd><teq> == </teq><tblk> {ON} | OFF</tblk></p>
<p>Note, if advection of groundwater is not required, then the advection calculation may be disabled by setting <span class="math inline">\(k_{h}\)</span> to zero for all soils. This is the default behaviour if <span class="math inline">\(k_{h}\)</span> is not specified in the soil parameters.</p>
<p>For cells that are “unsaturated” the “groundwater pressure level” is exactly the groundwater elevation within that layer. For cells that are fully saturated, the groundwater pressure level is that of the cell in the next layer above (or the water surface elevation when considering the topmost groundwater layer). For cells that are “nearly saturated” the groundwater pressure level is transitioned between these two options. The threshold at which the transition begins is called the “groundwater blending threshold”, <span class="math inline">\(\phi\)</span>.</p>
<p><span class="math display" id="eq:equ-blend">\[\begin{equation}

\xi = \frac{\frac{h_{i}}{dz} - \phi}{(1 - \phi)} \\
e_{i} = (1 - \xi)\left( z_{i} + h_{i} \right) + \xi e_{i - 1} \\
e_{0} = {WSE}_{surface}

\tag{1.35}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(h_{i}\)</span> is the depth of groundwater in the cell<br />
</li>
<li><span class="math inline">\(dz\)</span> is the vertical thickness of the layer<br />
</li>
<li><span class="math inline">\(z_{i}\)</span> is the layer bottom elevation<br />
</li>
<li><span class="math inline">\(e_{i - 1}\)</span> is the groundwater pressure level for the layer above (or surface layer)</li>
<li><span class="math inline">\(e_{i}\)</span> is the resulting groundwater pressure level for this layer</li>
</ul>
<p>The layer ordering is such that the surface water is layer “0”, the highest groundwater layer is “1”, and any subsequent groundwater layers range from 2 to N (i.e. from top to bottom).</p>
<p>The groundwater blending threshold, <span class="math inline">\(\phi\)</span>, defaults to a value of 0.9 but can be overridden by the user in the .tcf using the command:</p>
<p><tcmd><a href="#tcfGroundwaterBlendThreshold">Groundwater Blend Threshold</a></tcmd><teq> == </teq><tblk>&lt;float&gt; | {0.9}</tblk></p>
<p>If the sum of flows into a layer cell causes it to exceed its soil capacity, the excess is pushed upwards to the next layer. If this happens for the top-most groundwater layer, the excess is pushed into the surface water as “return flow”. This is to be expected in the creek beds but may also happen at the bottom of steep hills where the slope transitions from steep to shallow.</p>
</div>
<div id="CO-4" class="section level5 hasAnchor" number="1.3.5.2.2">
<h5><span class="header-section-number">1.3.5.2.2</span> Convective Flow Layers (CO)<a href="HPC-specific-2.html#CO-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For layers below the top groundwater layer, the vertical flow of water, <span class="math inline">\(Q^{z}\)</span>, is computed using a “convective” hydraulic conductivity (effectively the same concept as continuing loss):</p>
<p><span class="math display" id="eq:equ-Qz">\[\begin{equation}
Q^{z} = \  - kdxdy
\tag{1.36}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q^{z}\)</span> is the convective vertical flux</li>
<li><span class="math inline">\(k\)</span> is the convective hydraulic conductivity<br />
</li>
<li><span class="math inline">\(dxdy\)</span> is the cell area</li>
</ul>
<p>Note that <span class="math inline">\(Q^{z}\)</span> is limited to the available cumulative infiltration stored in the groundwater layer above, and also limited to the remaining capacity of the groundwater layer below.</p>
</div>
<div id="AdjustKvh-5" class="section level5 hasAnchor" number="1.3.5.2.3">
<h5><span class="header-section-number">1.3.5.2.3</span> Unsaturated Groundwater Flow<a href="HPC-specific-2.html#AdjustKvh-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The 2025.1 release implemented new features to adjust groundwater flux based on the saturation of soil layers. This enhancement is designed to simulate variably saturated flow (VSF) through vadose zones.</p>
<p>A simple adjustment based on the power function of the relative saturation can be applied to both the vertical flux and the horizontal flux:</p>
<p><span class="math display" id="eq:equ-QhSePower">\[\begin{equation}
Q^{h} = - k_{h}h\frac{de}{dx}dyS_{e}^{Ex_{h}}
\tag{1.37}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-QzSePower">\[\begin{equation}
Q^{z} = \  - kdxdyS_{e}^{Ex_{v}}
\tag{1.38}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(S_{e}\)</span> is the relative saturation</li>
<li><span class="math inline">\(Ex_{h}\)</span> and <span class="math inline">\(Ex_{v}\)</span> are the exponents of the power functions applied to the vertical flux and the horizontal flux</li>
</ul>
<p>The relative saturation <span class="math inline">\(S_{e}\)</span> is calculated as:</p>
<p><span class="math display" id="eq:SoilSe">\[\begin{equation}
S_{e} = \frac{\theta(t)-\theta_{r}}{\theta_{s}-\theta_{r}}
\tag{1.39}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\theta(t)\)</span> is the simulated water content (fraction)</li>
<li><span class="math inline">\(\theta_{r}\)</span> is the residual water content (fraction)</li>
<li><span class="math inline">\(\theta_{s}\)</span> is the saturated water content (fraction)</li>
</ul>
<p>The residual and saturated water contents (<span class="math inline">\(\theta_{r}\)</span> and <span class="math inline">\(\theta_{s}\)</span>) must be specified for each soil type in .tsoilf file (Table <a href="HPC-specific-2.html#tab:tab-tsoilf-hpc">1.28</a>). The exponents can be specified globally by including a second argument in the following two commands:</p>
<p><tcmd><a href="#tcfGroundwaterHorizontalFluxModel">Groundwater Horizontal Flux Model</a></tcmd><teq> == </teq><tblk>Darcy’s Law | &lt;Exh&gt; </tblk></p>
<p><tcmd><a href="#tcfGroundwaterVerticalFluxModel">Groundwater Vertical Flux Model</a></tcmd><teq> == </teq><tblk>Darcy’s Law | &lt;Exv&gt; </tblk></p>
<p>The default values of <span class="math inline">\(Ex_{h}\)</span> and <span class="math inline">\(Ex_{v}\)</span> are both zero (0), i.e. the groundwater fluxes are not adjusted based on <span class="math inline">\(S_{e}\)</span>.</p>
<p>Note, when the vertical exponent is zero, TUFLOW ‘lumps’ soil water at the bottom of each soil layer. This means water infiltrated from the layer above can instantly move to the next layer in the next timestep, which may cause the soil water to reach the bottom layer before filling up the layers above. This simple power function was found to be effective to ‘delay’ the vertical infiltration. The optimal value for <span class="math inline">\(Ex_{v}\)</span> depends on the layer thickness. For models that specify one or two layer(s) for the root zone (0~1m deep), an <span class="math inline">\(Ex_{v}\)</span> value of 2 was found to produce the best results in benchmarking tests, however, calibration or sensitivity testing is recommended.</p>
<p>The 2025.1 release also implemented a soil moisture dependent function for the horizontal flux based on <span class="citation">(<a href="CLASpecific-2.html#ref-vanGenuchten1980">Van Genuchten, 1980</a>)</span>.</p>
<p><tcmd><a href="#tcfGroundwaterHorizontalFluxModel">Groundwater Horizontal Flux Model</a></tcmd><teq> == </teq><tblk>Soil Moisture Dependent </tblk></p>
<p>With this option, the horizontal hydraulic conductivity is adjusted based on the following equation:</p>
<p><span class="math display" id="eq:eq-KhSe">\[\begin{equation}
k_{h}(S_{e}) = k_{h}S_{e}^{L}\{1-[1-S_{e}^{n/(n-1)}]^{1-1/n}\}^{2}
\tag{1.40}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(S_{e}\)</span> is the relative saturation (see Equation <a href="HPC-specific-2.html#eq:SoilSe">(1.39)</a>)</li>
<li><span class="math inline">\(n\)</span> and <span class="math inline">\(L\)</span> are the model parameters</li>
</ul>
<p>Note, strictly speaking, groundwater pressure level <span class="math inline">\(e\)</span> used to calculate the pressure gradient (<span class="math inline">\(\frac{de}{dx}\)</span>) needs to be adjusted based on the water retention curve:</p>
<p><span class="math display" id="eq:eq-Sevsh">\[\begin{equation}
S_{e} = [1+(\alpha e)^{n}]^{1/n-1}
\tag{1.41}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is the model parameter (<span class="math inline">\(m^{-1}\)</span>)</li>
</ul>
<p>The model parameters <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(n\)</span> and <span class="math inline">\(L\)</span> can be specified for each soil type in .tsoilf file (Table <a href="HPC-specific-2.html#tab:tab-tsoilf-hpc">1.28</a>). The recommended model parameters for different soil classes can be found from <a href="https://cales.arizona.edu/research/rosetta/download/rosetta.pdf">Rosetta’s technical documentation</a> <span class="citation">(<a href="CLASpecific-2.html#ref-Schaap2002">Schaap, 2002</a>)</span>.</p>
<p>Note, when <tcmd><a href="#tcfGroundwaterHorizontalFluxModel">Groundwater Horizontal Flux Model</a></tcmd> is set to “<tblk>Soil Moisture Dependent</tblk>”, the adjustment based on Equation <a href="HPC-specific-2.html#eq:eq-KhSe">(1.40)</a> is applied to all soil types. If users want to disable this feature for selected soil types, i.e. use standard Darcy’s Law equation, set all three parameters (<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(n\)</span> and <span class="math inline">\(L\)</span>) to zero (0).
<!-- SG: make sure this work and removed this comment [TPP-64]--></p>
</div>
<div id="GWImplementation-5" class="section level5 hasAnchor" number="1.3.5.2.4">
<h5><span class="header-section-number">1.3.5.2.4</span> Implementation<a href="HPC-specific-2.html#GWImplementation-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Although the theory appears complex, the implementation of groundwater within th TUFLOW model files is straight forward. The essential steps are:</p>
<ul>
<li>Read a soils (.tsoilf) data file from within the .tcf (see Section <a href="HPC-specific-2.html#HPC-tsoilf-5">1.3.5.3</a>).</li>
<li>Define the soil types in the .tgc (see Section <a href="HPC-specific-2.html#HPC-soil-type-5">1.3.5.2.5</a>).<br />
</li>
<li>Define the soil layer thickness in the .tgc (see Section <a href="HPC-specific-2.html#HPC-soil-type-5">1.3.5.2.5</a>).</li>
<li>Specify locations of groundwater boundaries in the .tbc (see Section <a href="#GT-4"><strong>??</strong></a>).<br />
</li>
<li>Specify initial water levels within the soil layers (optional) (see Section <a href="#IGW-3"><strong>??</strong></a>).</li>
<li>Add any additional output data types in the .tcf. For example:
<ul>
<li><a href="#tcfMapOutputDataTypes">Map Output Data Types</a> (see Section <a href="#DataTypes-3"><strong>??</strong></a>): dGW, GWd, GWh, GWm, GWq, GWv in Table <a href="#tab:tab-ExcludingHazard"><strong>??</strong></a>, or</li>
<li>Time series plot output data types (see Section <a href="#TimeSeries-2"><strong>??</strong></a>): GWd, GWh, GWm, GWq, GWqa, GWqu, GWqv, GWVol in Table <a href="#tab:tab-PODataPLPL"><strong>??</strong></a>.</li>
</ul></li>
</ul>
</div>
<div id="HPC-soil-type-5" class="section level5 hasAnchor" number="1.3.5.2.5">
<h5><span class="header-section-number">1.3.5.2.5</span> Soil Type<a href="HPC-specific-2.html#HPC-soil-type-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Setting the soil type for the groundwater layers activates the given layer. The Green-Ampt, Horton and Initial/Continuing Loss infiltration methods can be used for Layer 1. Any layers beneath Layer 1 (e.g. Layer 2, Layer 3) must be the Convective Type. For example, setting the soil type for layers 1 and 2 will activate 2 vertical groundwater layers:</p>
<p><tcmd><a href="#tgcSetSoil">Set Soil Layer 1</a></tcmd> <teq>==</teq> <tblk>1</tblk> <tgrn>! soil ID of infiltration layer e.g. GA type</tgrn><br />
<tcmd><a href="#tgcSetSoil">Set Soil Layer 2</a></tcmd> <teq>==</teq> <tblk>5</tblk> <tgrn>! soil ID of a convective layer e.g. CO type</tgrn></p>
<p>Multiple layers can be set simultaneously (the below will activate 3 interflow layers):</p>
<p><tcmd><a href="#tgcSetSoil">Set Soil Layer 1</a></tcmd> <teq>==</teq> <tblk>1</tblk><br />
<tcmd><a href="#tgcSetSoil">Set Soil Layer 2,3</a></tcmd> <teq>==</teq> <tblk>5</tblk> <tgrn>! sets both layers 2 and 3 to Soil ID 5</tgrn></p>
<p>This method also works for read GIS and Grid commands:</p>
<p><tcmd><a href="#tgcReadGISSoil">Read GIS Soil Layer 1</a></tcmd> <teq>==</teq> <tblk>&lt;gis_layer&gt;</tblk><br />
<tcmd><a href="#tgcReadGridSoil">Read Grid Soil Layer 2</a></tcmd> <teq>==</teq> <tblk>&lt;gis_layer&gt;</tblk></p>
<p>A maximum of 10 vertical layers is permitted and a soil ID should be assigned for each active layer. For example, if groundwater layer 2 is active, then soil IDs for layer 1 should be assigned. Note, if the layer number is not specified in a .tgc command (e.g. Set Soil), it is assumed to be layer 1.</p>
</div>
<div id="SoilThickness-5" class="section level5 hasAnchor" number="1.3.5.2.6">
<h5><span class="header-section-number">1.3.5.2.6</span> Soil Thickness<a href="HPC-specific-2.html#SoilThickness-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The depth (thickness) of each vertical interflow layer can be set using the following commands:</p>
<p><tcmd>[<a href="#tgcSetSoilThickness">Set</a> | <a href="#tgcReadGISSoilThickness">Read GIS</a> | <a href="#tgcReadGridSoilThickness">Read Grid</a> ] Soil Thickness Layer N</tcmd> <teq>==</teq> <tblk>[ value | &lt;gis_layer&gt; ]</tblk><br />
<tcmd>[<a href="#tgcSetSoilBaseElevation">Set</a> | <a href="#tgcReadGISSoilBaseElevation">Read GIS</a> | <a href="#tgcReadGridSoilBaseElevation">Read Grid</a> ] Soil Base Elevation Layer N</tcmd> <teq>==</teq> <tblk>[ value | &lt;gis_layer&gt; ]</tblk></p>
<p>If the soil layer thickness or base elevation is not set for a given layer, it is assumed to be infinite. The soil thickness sets the layer depth from the layer above and soil base elevation sets the absolute elevation of the bottom of the layer. If both methods are specified for a given grid cell, the highest of the two will be adopted. The input units should be in metres or feet (if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>).</p>
</div>
<div id="top-gw-drying-4" class="section level5 hasAnchor" number="1.3.5.2.7">
<h5><span class="header-section-number">1.3.5.2.7</span> Drying of Top Groundwater Layer<a href="HPC-specific-2.html#top-gw-drying-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Evaporation is typically implemented with a global negative rainfall. Prior to the 2023-03 release this would only remove water in wet cells until they dry. It would not draw from the cumulative infiltration layer. The 2023-03 release and onwards allows for negative rainfall to draw from the topmost groundwater layer under surface layer cells that are dry, thus mimicking evapotranspiration. Currently onlyone approach is implemented, called “factor”, which applies the defined negative rainfall, though at a (globally) factored rate. To select this approach use the <a href="#tcfSoilNegativeRainfallApproach">Soil Negative Rainfall Approach</a> .tcf command.</p>
<p>The default approach is to not apply any negative rainfall to the topmost groundwater layer. If the “factor” method is selected, then the factor can be set using the <a href="#tcfSoilNegativeRainfallFactor">Soil Negative Rainfall Factor</a> .tcf command. The default factor is 1, meaning that the full value of the negative rainfall is applied. If the topmost groundwater layer is dry, then no negative rainfall is applied, and the approach does not look any further than the topmost layer. No water is drawn from subsequent ground water layers.</p>
</div>
</div>
<div id="HPC-tsoilf-5" class="section level4 hasAnchor" number="1.3.5.3">
<h4><span class="header-section-number">1.3.5.3</span> HPC Soils File (.tsoilf)<a href="HPC-specific-2.html#HPC-tsoilf-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The .tsoilf is the same file mentioned in Section <a href="Common-2.html#tsoilf-4">1.2.7.2</a>. However, when using TUFLOW HPC there are additional parameters available which can be used to enable horizontal advection, as well as two additional soil types: convective (CO) and SCS. These additional parameters are bold in Table <a href="HPC-specific-2.html#tab:tab-tsoilf-hpc">1.28</a>.</p>
<table>
<caption>
<span id="tab:tab-tsoilf-hpc">Table 1.28: </span><strong>HPC .tsoilf Parameters</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Column No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
No Intriltration
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Green-Ampt
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Green-Ampt
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Horton
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Initial/Continuing Loss
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
SCS Curve Number
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: rgba(26, 189, 201, 255) !important;">
Convective
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
<strong>Soil ID</strong>
</td>
<td style="text-align:left;">
<strong>Soil ID</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
NONE
</td>
<td style="text-align:left;">
GA
</td>
<td style="text-align:left;">
GA
</td>
<td style="text-align:left;">
HO
</td>
<td style="text-align:left;">
ILCL
</td>
<td style="text-align:left;">
<strong>SCS</strong>
</td>
<td style="text-align:left;">
<strong>CO</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
USDA Soil Type (see Table <a href="Common-2.html#tab:tab-GreenAmpt">1.14</a>) (mandatory)
</td>
<td style="text-align:left;">
Suction (mm or inches) (mandatory)
</td>
<td style="text-align:left;">
Initial Loss (mm or inches) (mandatory)
</td>
<td style="text-align:left;">
Initial Loss (mm or inches) (mandatory)
</td>
<td style="text-align:left;">
<strong>Curve Number (see <span class="citation">USDA (<a href="CLASpecific-2.html#ref-USDA1986">1986</a>)</span>) (mandatory)</strong>
</td>
<td style="text-align:left;">
<strong>Vertical Hydraulic Conductivity (mm/h or in/h) (mandatory)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Initial Moisture (Fraction) (optional)
</td>
<td style="text-align:left;">
Hydraulic Conductivity (mm/h or in/h) (mandatory)
</td>
<td style="text-align:left;">
Initial Loss Rate (<span class="math inline">\(f_0\)</span>) (mm/h or in/h) (mandatory)
</td>
<td style="text-align:left;">
Continuing Loss (mm/h or in/h) (mandatory)
</td>
<td style="text-align:left;">
<strong>Initial Abstraction Ratio (Fraction) (mandatory)</strong>
</td>
<td style="text-align:left;">
<strong>Porosity (Fraction) (mandatory)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Max Ponding Depth (m or ft) (optional)
</td>
<td style="text-align:left;">
Porosity (Fraction) (mandatory)
</td>
<td style="text-align:left;">
Final Loss Rate (<span class="math inline">\(f_c\)</span>) (mm/h or in/h) (mandatory)
</td>
<td style="text-align:left;">
Porosity (Fraction) (optional)
</td>
<td style="text-align:left;">
<strong><em>Residual Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong>Initial Moisture (Fraction) (optional)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h) (optional)</strong>
</td>
<td style="text-align:left;">
Initial Moisture (Fraction) (optional)
</td>
<td style="text-align:left;">
Exponential Decay Rate (k) (<span class="math inline">\(h^{-1}\)</span>) (mandatory)
</td>
<td style="text-align:left;">
Initial Moisture (Fraction) (optional)
</td>
<td style="text-align:left;">
<strong><em>Saturated Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h) (optional)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Residual Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
Max Ponding Depth (m or ft) (optional)
</td>
<td style="text-align:left;">
Porosity (Fraction) (optional)
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h) (optional)</strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter α (<span class="math inline">\(m^{-1}\)</span>) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Residual Water Content (-) (optional)</em></strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Saturated Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h) (optional)</strong>
</td>
<td style="text-align:left;">
Initial Moisture (Fraction) (optional)
</td>
<td style="text-align:left;">
<strong><em>Residual Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter n (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Saturated Water Content (-) (optional)</em></strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter α (<span class="math inline">\(m^{-1}\)</span>) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Residual Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h) (optional)</strong>
</td>
<td style="text-align:left;">
<strong><em>Saturated Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter L (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter α (<span class="math inline">\(m^{-1}\)</span>) (optional)</em></strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter n (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Saturated Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Residual Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter α (<span class="math inline">\(m^{-1}\)</span>) (optional)</em></strong>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter n (-) (optional)</em></strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter L (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter α (<span class="math inline">\(m^{-1}\)</span>) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Saturated Water Content (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter n (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter L (-) (optional)</em></strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter n (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter α (<span class="math inline">\(m^{-1}\)</span>) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter L (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter L (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
<strong><em>Parameter n (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong><em>Parameter L (-) (optional)</em></strong>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="NN-3" class="section level3 hasAnchor" number="1.3.6">
<h3><span class="header-section-number">1.3.6</span> Non-Newtonian Flow<a href="HPC-specific-2.html#NN-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC supports modelling of non-Newtonian fluids. The non-Newtonian flow theory, and an example of its use in TUFLOW is discussed in the <a href="https://www.youtube.com/watch?v=MeDQ35zTexU&amp;t=2159s">Tsunami and Dam Failure and non-Newtonian Modelling AWS Webinar</a>. This feature was introduced in the 2020-01 release. It is not supported in TUFLOW Classic. High-fidelity modelling of non-Newtonian fluids is complex and 3D in nature. However, with some assumptions, it is possible to model non-Newtonian fluids reasonably well in 2D. The assumptions are:</p>
<ol style="list-style-type: decimal">
<li>The 2D (horizontal) viscosity can be represented as a summation of laminar (derivative of non-Newtonian shear stress model) and turbulent (from Wu eddy viscosity model) contributions.<br />
</li>
<li>Acceleration effects are small and the laminar fluid shear stress is linear with depth.<br />
</li>
<li>The bed shear stress can be represented as a summation of laminar (from non-Newtonian shear stress model) and turbulent (from Manning’s equation) contributions.</li>
</ol>
<p>The laminar fluid shear stress (for flow that is shearing), is assumed to follow the Hershel-Bulkley power law model:</p>
<p><span class="math display" id="eq:equ-powerlaw">\[\begin{equation}
\tau = \tau_{0} + k{\dot{\gamma}}^{n}
\tag{1.42}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\tau_{0}\)</span> = Yield shear stress of the fluid.<br />
</li>
<li><span class="math inline">\(k\)</span> = Viscosity parameter (units Pa.s<sup>n</sup>)<br />
</li>
<li><span class="math inline">\(\dot{\gamma}\)</span> = Shear strain rate of the fluid<br />
</li>
<li><span class="math inline">\(n\)</span> = Power law exponent (1 = Newtonian, &lt;1 is shear thinning, &gt;1 is shear thickening)</li>
</ul>
<p>For flows where the bed shear stress exceeds the yield stress, a ‘plug flow’ velocity profile is computed, as shown in Figure <a href="HPC-specific-2.html#fig:fig-NN-plug-flow">1.37</a>. For flows where the bed shear stress does not exceed the yield stress, the fluid is considered locked to the bed and does not flow. Within TUFLOW HPC, at the start of each timestep, a bed stress is calculated for each cell such that the predicted velocity profile (for the given bed shear stress) has a depth averaged mean velocity that matches the current model velocity.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-NN-plug-flow"></span>
<img src="images/NN-plug-flow.png" alt="Non-Newtonian Shear Stress and Velocity Profile"  />
<p class="caption">
Figure 1.37: Non-Newtonian Shear Stress and Velocity Profile
</p>
</div>
<p>Note that for fluids with a low viscosity parameter, or for deep and/or faster flows, the bed friction that would arise through the use of Manning’s equation (which is based on turbulent water flow) can be equal to or greater than that from the Hershel-Bulkley equation. In this situation the mathematics is stating that the non-Newtonian flow is likely to be turbulent and behaving more like water, and the bed shear stress as computed by the Hershel-Bulkley powerlaw model is likely to be lower than what is occurring in reality. To account for this transition in a simple manner, the actual bed friction used is the sum of both non-Newtonian and Manning’s contributions (note the <em>n</em> in the final term on the righthand side of the following equation is Manning’s n, not the Hershel-Bulkley power law exponent):</p>
<p><span class="math display" id="eq:equ-NN-friction">\[\begin{equation}
\tau = \tau_{0} + k{\dot{\gamma}}^{n} + \frac{\rho gn^{2}|U|^{2}}{d^{\frac{1}{3}}}
\tag{1.43}
\end{equation}\]</span></p>
<p>This provides a very stable and smooth transition from non-Newtonian bed shear stress to turbulent water-like bed shear stress as and when needed. The total shear stress is then utilised in the momentum equation to evolve the flow velocity. The momentum equation also considers the possibility that the fluid yield stress is sufficient to hold the fluid against the net momentum flux, in which case the fluid velocity is zeroed.</p>
<p>For the computation of 2D shear stresses, the yield shear stress is not used and the fluid is allowed to continue shearing down to low shear strain rates and correspondingly low shear stresses. The effective Non-Newtonian 2D viscosity is computed using the derivative of the Hershel-Bulkley equation:</p>
<p><span class="math display" id="eq:equ-HB-visc">\[\begin{equation}
\mu_{2D} = kn\left| \dot{\gamma} \right|^{n - 1}\\

\left| \dot{\gamma} \right| =
\max\left( \frac{2|U|}{d},\sqrt{\left( \frac{du}{dx} \right)^{2} + \left( \frac{dv}{dy} \right)^{2} + \frac{1}{2}\left( \frac{du}{dy} + \frac{dv}{dx} \right)^{2}} \right)

\tag{1.44}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\left| \dot{\gamma} \right|\)</span> = Magnitude of shear strain rate</li>
</ul>
<p>Since the <span class="math inline">\(n - 1\)</span> exponent can cause the viscosity to diverge to infinity at low strain rates for shear thinning fluids, it necessary to bound the resulting viscosity to a user defined upper limit, <span class="math inline">\(\mu_{high}\)</span>. For completeness a user defined lower limit, <span class="math inline">\(\mu_{low}\)</span>, is also applied.</p>
<p>Finally, for deeper and high velocity flows it is possible that the effective 2D viscosity of turbulent water, as computed by the Wu turbulence model, is greater than the value computed from the Hershel-Bulkey powerlaw model. Again, in this situation the mathematics is stating the non-Newtonian flow is likely to be turbulent and behaving more like water. To account for this transition the actual 2D viscosity used is the sum of both non-Newtonian and Wu turbulence model contributions:</p>
<p><span class="math display" id="eq:equ-actual-visc">\[\begin{equation}
\nu_{T} = \frac{\mu_{2D}}{\rho} + 7U^{*}d
\tag{1.45}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(U^{*}\)</span> = Friction velocity = <span class="math inline">\(\frac{\sqrt{g}\ n|U|}{d^{\frac{1}{6}}}\)</span></li>
</ul>
<p>This provides a very stable and smooth transition from non-Newtonian 2D viscosity to turbulent water-2D viscosity as and when needed. The value of 7 is the default Wu viscosity parameter and is not user-definable for the non-Newtonian module.</p>
<div id="Implementation-4" class="section level4 hasAnchor" number="1.3.6.1">
<h4><span class="header-section-number">1.3.6.1</span> Implementation<a href="HPC-specific-2.html#Implementation-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The non-Newtonian flow model is invoked with the <a href="#tcfViscosityFormulation">Viscosity Formulation</a> command in the .tcf. If invoked there are no default values for the required coefficients (<span class="math inline">\(k\)</span>, <span class="math inline">\(n\)</span>, <span class="math inline">\(\mu_{low}\)</span>, <span class="math inline">\(\mu_{high}\)</span>, <span class="math inline">\(\tau_{0}\)</span>). These must be supplied wit the <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> command, where:</p>
<ul>
<li><span class="math inline">\(k\)</span>: viscosity coefficient (Pa.s^n)</li>
<li><span class="math inline">\(n\)</span>: shear thickening exponent, must be non zero and positive (shear thinning fluids exhibit <span class="math inline">\(n\)</span> &lt; 1, shear thickening <span class="math inline">\(n\)</span> &gt; 1, and Newtonian fluids <span class="math inline">\(n\)</span> = 1)</li>
<li><span class="math inline">\(\mu_{low}\)</span>: lower viscosity limit (Pa.s)</li>
<li><span class="math inline">\(\mu_{high}\)</span>: higher viscosity limit (Pa.s)</li>
<li><span class="math inline">\(\tau_{0}\)</span>: shear yield stress (Pa)</li>
</ul>
<p>A step-by-step example of how to set up a non-Newtonian model is provided in <a href="https://wiki.tuflow.com/Tutorial_M10#Part_5_-_Non-Newtonian">TUFLOW Tutorial Module 5</a> on the TUFLOW Wiki. Additionally, an example model is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Non-Newtonian">Non-Newtonian Example Model Dataset</a> on the TUFLOW Wiki.</p>
<p><strong>Note</strong>: In TUFLOW HPC the 2D momentum diffusion is handled explicitly and can drive the model timestep to small values when the viscosity becomes large. For shear thinning models, it is important to define an upper limit, <span class="math inline">\(\mu_{high}\)</span>, that is only as large as necessary. We suggest starting with 1,000 Pa.s and adjusting lower if the model is being strongly controlled by the diffusion control number (Nd). Sensitivity testing should be done to test whether the upper viscosity limit is influencing results in the region of interest. The lower viscosity limit, <span class="math inline">\(\mu_{low}\)</span>, may be set to zero if desired.</p>
</div>
<div id="NN-Mix-4" class="section level4 hasAnchor" number="1.3.6.2">
<h4><span class="header-section-number">1.3.6.2</span> Non-Newtonian Mixing<a href="HPC-specific-2.html#NN-Mix-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is possible to consider mixing of the non-Newtonian fluid with water, for example a tailings dam failure into a flowing river. To implement this, a passive AD tracer must be included in the model, note that this requires a licence for the <a href="#ADModule-4">Advection-Dispersion (AD) Module</a>. The AD setup is the same as detailed in Chapter <a href="#AD-1"><strong>??</strong></a>. More than one tracer field is permissible, but the non-Newtonian mixing calculation will assume that the first tracer represents the fraction of non-Newtonian fluid, in the range 0 to 1. Care must be taken to ensure that boundary data and initialisation commands strictly adhere to this range. Where the tracer value is 1, the properties of the fluid will be exactly the non-Newtonian properties, as specified with <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> command, where the tracer value is 0 the fluid will behave as water. For tracer values between 0 and 1, the non-Newtonian properties are blended with those of water using a power-law equation.</p>
<p><span class="math display" id="eq:equ-NN-mixing">\[\begin{equation}
\xi = a^{m} \\

\rho&#39; = (1 - a)\rho_{w} + a\rho_{NN} \\

K&#39; = (1 - a^{m})\nu_{w} + a^{m} K_{NN} \\

n&#39; = (1 - a^{o})1.0 + a^{o} n_{NN} \\

\tau_{0}&#39; = a^{p}\tau_{0,NN} \\

\tag{1.46}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(a\)</span> = the tracer value (0~1)</li>
<li><span class="math inline">\(m\)</span> = the non-Newtonian mixing exponent for the viscosity parameter</li>
<li><span class="math inline">\(o\)</span> = the non-Newtonian mixing exponent for the power law parameter</li>
<li><span class="math inline">\(p\)</span> = the non-Newtonian mixing exponent for the yield stress</li>
<li><span class="math inline">\(\rho\)</span> = density of fluid (kg/m<sup>3</sup>)</li>
<li><span class="math inline">\(\nu\)</span> = kinematic viscosity (m<sup>2</sup>/s)</li>
<li><span class="math inline">\(K\)</span> = the Hershel-Bulkley viscosity parameter (Pa s<em><sup>n</sup></em>)</li>
<li><span class="math inline">\(n\)</span> = the Hershel-Bulkley power law exponent</li>
<li><span class="math inline">\(\tau_{0}\)</span> = the material yield stress (Pa)</li>
<li>subscripts <span class="math inline">\(w\)</span> denotes water, <span class="math inline">\(NN\)</span> denotes undiluted non-Newtonian fluid<br />
</li>
<li>superscript <span class="math inline">\(‘\)</span> denotes blended value to use in the Hershel-Bulkley powerlaw model</li>
</ul>
<p>The bed friction and 2D viscosity are computed using the non-Newtonian method with the blended parameters. To turn on the mixing calculation, the mixing exponents, <span class="math inline">\(m\)</span>, <span class="math inline">\(o\)</span> and <span class="math inline">\(p\)</span> can be specified with the <a href="#tcfHPCNon-NewtonianMixingExponent">HPC Non-Newtonian Mixing Exponent</a> command. The values must be within the range 1 to 10. It is the user’s responsibility to source the non-Newtonian parameters that represent the undiluted mud, and also to source an appropriate values for the non-Newtonian mixing exponents.</p>
<p>To utilise non-Newtonian mixing in a model, the following is required:</p>
<ol style="list-style-type: decimal">
<li>Select the non-Newtonian viscosity formulation and specify the coefficients for pure non-Newtonian fluid:<br />
<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a></tcmd> <teq>==</teq> <tblk>Non-Newtonian</tblk><br />
<tcmd><a href="#tcfViscosityCoefficient">Viscosity Coefficient</a></tcmd> <teq>==</teq> <tblk>k, n, muLow, muHigh, tau0</tblk><br />
</li>
<li>Include a passive tracer as per standard AD setup (Chapter <a href="#AD-1"><strong>??</strong></a>), making sure boundary data and initialisation are scaled in range 0 to 1.<br />
</li>
<li>Specify the mixing exponents, <em>m</em>, <em>o</em>, and <em>p</em> to be used:<br />
<tcmd><a href="#tcfHPCNon-NewtonianMixingExponent">HPC Non-Newtonian Mixing Exponent</a>
</tcmd> <teq>==</teq> <tblk>&lt;float&gt; | {0} </tblk><tgrn>! used for all three of <em>m</em>, <em>o</em>, <em>p</em> exponents </tgrn> <br>
or <br>
<tcmd><a href="#tcfHPCNon-NewtonianMixingExponent">HPC Non-Newtonian Mixing Exponent</a>
</tcmd> <teq>==</teq> <tblk>&lt;float&gt;, &lt;float&gt;, &lt;float&gt; | {0, 0, 0} </tblk><tgrn>! <em>m</em>, <em>o</em>, <em>p</em> exponents</tgrn></li>
</ol>
<p>Note that if the non-Newtonian mixing exponent is not specified it defaults to zero which turns the mixing formulation off, and all fluid in the model will be treated as non-Newtonian regardless of tracer value.</p>
<p>An example non-Newtonian mixing model is provided in the non-Newtonian section of the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Solver_Options">Solver Options Example Model Dataset</a> on the TUFLOW Wiki.</p>
</div>
</div>
<div id="HPC-Unsupported-3" class="section level3 hasAnchor" number="1.3.7">
<h3><span class="header-section-number">1.3.7</span> Unsupported Features in TUFLOW HPC<a href="HPC-specific-2.html#HPC-Unsupported-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following features are not supported in TUFLOW HPC:</p>
<ul>
<li>Multiple 2D Domain (Section <a href="CLASpecific-2.html#CLA-2D2D-3">1.4.4</a>): This feature has been superseded by the TUFLOW HPC Quadtree functionality (Section <a href="HPC-specific-2.html#Quadtree-3">1.3.1</a>).</li>
<li>2D Flow Constrictions (2d_fcsh and 2d_fc) (Section <a href="CLASpecific-2.html#CLA-FC-4">1.4.6.1</a>): This feature has been superseded by the 2d Bridge (2d_bg) (Section <a href="Common-2.html#bg-layer-4">1.2.8.2</a>) and Layered Flow Constriction (2d_lfcsh) (Section <a href="Common-2.html#lfcsh-4">1.2.8.3</a>) features.</li>
<li>Coriolis Force (Section <a href="CLASpecific-2.html#CLA-Coriolis-3">1.4.5</a>): The inclusion of the Coriolis term in the shallow water equations is possible with TUFLOW Classic only.</li>
<li>Chézy and Fric options: TUFLOW HPC only supports Manning’s n bed resistance values (Section <a href="CLASpecific-2.html#CLA-mat-3">1.4.3</a>).</li>
</ul>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Common-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="CLASpecific-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": true,
    "twitter": true,
    "linkedin": true,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": false
  },
  "fontsettings": false,
  "edit": null,
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
