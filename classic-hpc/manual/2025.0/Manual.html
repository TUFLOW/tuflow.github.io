<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>TUFLOW Classic/HPC User Manual 2024</title>
  <meta name="description" content="TUFLOW Classic/HPC User Manual 2024" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="TUFLOW Classic/HPC User Manual 2024" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://docs.tuflow.com/classic-hpc/manual/2023-03/images/TUFLOW_Manual_SEO_007.PNG" />
  <meta property="og:description" content="TUFLOW Classic/HPC User Manual 2024" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="TUFLOW Classic/HPC User Manual 2024" />
  
  <meta name="twitter:description" content="TUFLOW Classic/HPC User Manual 2024" />
  <meta name="twitter:image" content="https://docs.tuflow.com/classic-hpc/manual/2023-03/images/TUFLOW_Manual_SEO_007.PNG" />

<meta name="author" content="" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/TUFLOW.ico" type="image/x-icon" />


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 1em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
<link rel="stylesheet" href="css\toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://docs.tuflow.com/classic-hpc/manual/2023-03/"><img src="images/TUFLOW-Manual-2023-03.png" style="width:270px" ></a></li>

<li class="divider"></li>
<li><a href="#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path=""><a href="#overview"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#how-to-use-this-manual"><i class="fa fa-check"></i>How to use this Manual</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#navigation"><i class="fa fa-check"></i>Navigation</a></li>
<li class="chapter" data-level="" data-path=""><a href="#searching"><i class="fa fa-check"></i>Searching</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#about-this-manual"><i class="fa fa-check"></i>About this Manual</a></li>
<li class="chapter" data-level="" data-path=""><a href="#glossary-and-notation"><i class="fa fa-check"></i>Glossary and Notation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#contents"><i class="fa fa-check"></i>Contents</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#list-of-figures"><i class="fa fa-check"></i>List of Figures</a></li>
<li class="chapter" data-level="" data-path=""><a href="#list-of-tables"><i class="fa fa-check"></i>List of Tables</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path=""><a href="#Introduction-1"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#TUFLOWProducts-2"><i class="fa fa-check"></i><b>1.1</b> TUFLOW Products</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#TUFLOW-CLA-3"><i class="fa fa-check"></i><b>1.1.1</b> TUFLOW Classic – 2D Semi-Implicit Solver</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#TUFLOW-HPC-3"><i class="fa fa-check"></i><b>1.1.2</b> TUFLOW HPC – 2D GPU Accelerated Solver</a></li>
<li class="chapter" data-level="1.1.3" data-path=""><a href="#TUFLOW1D-3"><i class="fa fa-check"></i><b>1.1.3</b> TUFLOW 1D (ESTRY) – 1D Solver</a></li>
<li class="chapter" data-level="1.1.4" data-path=""><a href="#SWMM1D-3"><i class="fa fa-check"></i><b>1.1.4</b> EPA SWMM – 1D Solver</a></li>
<li class="chapter" data-level="1.1.5" data-path=""><a href="#AddonModules-3"><i class="fa fa-check"></i><b>1.1.5</b> Add-on Modules</a>
<ul>
<li class="chapter" data-level="1.1.5.1" data-path=""><a href="#ADModule-4"><i class="fa fa-check"></i><b>1.1.5.1</b> Advection Dispersion (AD) Module</a></li>
<li class="chapter" data-level="1.1.5.2" data-path=""><a href="#TUFLOWCATCH-4"><i class="fa fa-check"></i><b>1.1.5.2</b> TUFLOW CATCH Module</a></li>
<li class="chapter" data-level="1.1.5.3" data-path=""><a href="#GPUHardware-4"><i class="fa fa-check"></i><b>1.1.5.3</b> GPU Hardware (GPU) Module</a></li>
<li class="chapter" data-level="1.1.5.4" data-path=""><a href="#QDTorM2DModule-4"><i class="fa fa-check"></i><b>1.1.5.4</b> Quadtree or Multiple 2D Domain (M2D) Module</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#TUFLOWWebinars-2"><i class="fa fa-check"></i><b>1.2</b> TUFLOW Webinars</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#ModellingEnvironment-2"><i class="fa fa-check"></i><b>1.3</b> Modelling Environment</a></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#LimitationsandRecommendations-2"><i class="fa fa-check"></i><b>1.4</b> Limitations and Recommendations</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#GettingStarted-1"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#HowtoBuildYourFirstModel-2"><i class="fa fa-check"></i><b>2.1</b> How to Build Your First Model</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path=""><a href="#TutorialModels-3"><i class="fa fa-check"></i><b>2.1.1</b> Tutorial Models</a></li>
<li class="chapter" data-level="2.1.2" data-path=""><a href="#ExampleModels-3"><i class="fa fa-check"></i><b>2.1.2</b> Example Models</a></li>
<li class="chapter" data-level="2.1.3" data-path=""><a href="#DemonstrationModels-3"><i class="fa fa-check"></i><b>2.1.3</b> Demonstration Models</a></li>
<li class="chapter" data-level="2.1.4" data-path=""><a href="#LicenceFreeDemoMode-3"><i class="fa fa-check"></i><b>2.1.4</b> Licence Free Demo Mode</a></li>
<li class="chapter" data-level="2.1.5" data-path=""><a href="#eLearningModules-3"><i class="fa fa-check"></i><b>2.1.5</b> eLearning Modules</a></li>
<li class="chapter" data-level="2.1.6" data-path=""><a href="#InstructorLedTUFLOWTrainingCourses-3"><i class="fa fa-check"></i><b>2.1.6</b> Instructor Led TUFLOW Training Courses</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#TheTUFLOWModellingConcept-2"><i class="fa fa-check"></i><b>2.2</b> The TUFLOW Modelling Concept</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path=""><a href="#Notepad-3"><i class="fa fa-check"></i><b>2.2.1</b> Notepad++</a></li>
<li class="chapter" data-level="2.2.2" data-path=""><a href="#QGISTUFLOWViewer-3"><i class="fa fa-check"></i><b>2.2.2</b> QGIS / TUFLOW Viewer</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#InstallingandRunningTUFLOW-2"><i class="fa fa-check"></i><b>2.3</b> Installing and Running TUFLOW</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path=""><a href="#TUFLOWDownloadsandInstallation-3"><i class="fa fa-check"></i><b>2.3.1</b> TUFLOW Downloads and Installation</a></li>
<li class="chapter" data-level="2.3.2" data-path=""><a href="#Licencing-3"><i class="fa fa-check"></i><b>2.3.2</b> Licencing</a></li>
<li class="chapter" data-level="2.3.3" data-path=""><a href="#PerformingSimulations-3"><i class="fa fa-check"></i><b>2.3.3</b> Performing Simulations</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path=""><a href="#FoldersFileTypesandFileNaming-2"><i class="fa fa-check"></i><b>2.4</b> Folders, File Types and File Naming</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path=""><a href="#FolderStructure-3"><i class="fa fa-check"></i><b>2.4.1</b> Folder Structure</a></li>
<li class="chapter" data-level="2.4.2" data-path=""><a href="#FileTypes-3"><i class="fa fa-check"></i><b>2.4.2</b> File Types</a></li>
<li class="chapter" data-level="2.4.3" data-path=""><a href="#NamingConventions-3"><i class="fa fa-check"></i><b>2.4.3</b> Naming Conventions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path=""><a href="#TipsandTricks-2"><i class="fa fa-check"></i><b>2.5</b> Tips and Tricks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#Fundamentals-1"><i class="fa fa-check"></i><b>3</b> Hydraulic Modelling Fundamentals</a>
<ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#Fundaments-Introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#Schematisation-2"><i class="fa fa-check"></i><b>3.2</b> Schematisation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path=""><a href="#GeneralGuidance-3"><i class="fa fa-check"></i><b>3.2.1</b> General Guidance</a></li>
<li class="chapter" data-level="3.2.2" data-path=""><a href="#id_1D2Dor3D-3"><i class="fa fa-check"></i><b>3.2.2</b> Model Dimensions: 1D, 2D or 3D?</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path=""><a href="#one-dimensional-1d"><i class="fa fa-check"></i><b>3.2.2.1</b> One Dimensional (1D)</a></li>
<li class="chapter" data-level="3.2.2.2" data-path=""><a href="#two-dimensional-2d"><i class="fa fa-check"></i><b>3.2.2.2</b> Two Dimensional (2D)</a></li>
<li class="chapter" data-level="3.2.2.3" data-path=""><a href="#three-dimensional-3d"><i class="fa fa-check"></i><b>3.2.2.3</b> Three Dimensional (3D)</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path=""><a href="#Coupled1D2D-3"><i class="fa fa-check"></i><b>3.2.3</b> Coupled 1D-2D</a></li>
<li class="chapter" data-level="3.2.4" data-path=""><a href="#FixedGridorQuadtreeGrid-3"><i class="fa fa-check"></i><b>3.2.4</b> Quadtree Grid</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#ModelResolutionDiscretisation-2"><i class="fa fa-check"></i><b>3.3</b> Model Resolution (Discretisation)</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path=""><a href="#id_1DNetworks-3"><i class="fa fa-check"></i><b>3.3.1</b> 1D Networks</a></li>
<li class="chapter" data-level="3.3.2" data-path=""><a href="#CellSizes-3"><i class="fa fa-check"></i><b>3.3.2</b> 2D Cell Sizes</a></li>
<li class="chapter" data-level="3.3.3" data-path=""><a href="#SubGridSamplingSGS-3"><i class="fa fa-check"></i><b>3.3.3</b> Sub-Grid Sampling (SGS)</a>
<ul>
<li class="chapter" data-level="3.3.3.1" data-path=""><a href="#SGS-benefits-4"><i class="fa fa-check"></i><b>3.3.3.1</b> Benefits of SGS</a></li>
</ul></li>
<li class="chapter" data-level="3.3.4" data-path=""><a href="#CellSizeResultsConvergence-3"><i class="fa fa-check"></i><b>3.3.4</b> Cell Size Results Convergence</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path=""><a href="#SolutionAccuracy-2"><i class="fa fa-check"></i><b>3.4</b> Solution Accuracy</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path=""><a href="#FluidFlowPhysicalTerms-3"><i class="fa fa-check"></i><b>3.4.1</b> Fluid Flow Physical Terms</a>
<ul>
<li class="chapter" data-level="3.4.1.1" data-path=""><a href="#d-continuity-equation"><i class="fa fa-check"></i><b>3.4.1.1</b> 1D Continuity Equation</a></li>
<li class="chapter" data-level="3.4.1.2" data-path=""><a href="#d-momentum-equation"><i class="fa fa-check"></i><b>3.4.1.2</b> 1D Momentum Equation</a></li>
<li class="chapter" data-level="3.4.1.3" data-path=""><a href="#d-continuity-equation-1"><i class="fa fa-check"></i><b>3.4.1.3</b> 2D Continuity Equation</a></li>
<li class="chapter" data-level="3.4.1.4" data-path=""><a href="#d-momentum-equation-1"><i class="fa fa-check"></i><b>3.4.1.4</b> 2D Momentum Equation</a></li>
</ul></li>
<li class="chapter" data-level="3.4.2" data-path=""><a href="#FormsoftheEquations-3"><i class="fa fa-check"></i><b>3.4.2</b> Forms of the Equations</a>
<ul>
<li class="chapter" data-level="3.4.2.1" data-path=""><a href="#diffusive-wave-equation"><i class="fa fa-check"></i><b>3.4.2.1</b> Diffusive Wave Equation</a></li>
<li class="chapter" data-level="3.4.2.2" data-path=""><a href="#kinematic-wave-equation"><i class="fa fa-check"></i><b>3.4.2.2</b> Kinematic Wave Equation</a></li>
</ul></li>
<li class="chapter" data-level="3.4.3" data-path=""><a href="#NumericalAccuracy-3"><i class="fa fa-check"></i><b>3.4.3</b> Numerical Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path=""><a href="#TimestepBackground-2"><i class="fa fa-check"></i><b>3.5</b> Timestep</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path=""><a href="#FixedVersusAdaptiveTimestepping-3"><i class="fa fa-check"></i><b>3.5.1</b> Fixed versus Adaptive Timestepping</a></li>
<li class="chapter" data-level="3.5.2" data-path=""><a href="#OneDDomainsTimestep-3"><i class="fa fa-check"></i><b>3.5.2</b> TUFLOW 1D (ESTRY) and EPA SWMM</a></li>
<li class="chapter" data-level="3.5.3" data-path=""><a href="#TUFLOWClassicTimestep-3"><i class="fa fa-check"></i><b>3.5.3</b> TUFLOW Classic 2D</a></li>
<li class="chapter" data-level="3.5.4" data-path=""><a href="#TUFLOWHPCTimestep-3"><i class="fa fa-check"></i><b>3.5.4</b> TUFLOW HPC 2D</a>
<ul>
<li class="chapter" data-level="3.5.4.1" data-path=""><a href="#TimesteppingEfficiencyOutput-4"><i class="fa fa-check"></i><b>3.5.4.1</b> Timestep Efficiency Output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path=""><a href="#SimulationTimes-2"><i class="fa fa-check"></i><b>3.6</b> Simulation Times</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#ControlFiles-and-Inputs-1"><i class="fa fa-check"></i><b>4</b> Control Files and Input Layers</a>
<ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#control-files"><i class="fa fa-check"></i><b>4.2</b> Control Files</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path=""><a href="#Notation-3"><i class="fa fa-check"></i><b>4.2.1</b> Rules and Notation</a></li>
<li class="chapter" data-level="4.2.2" data-path=""><a href="#FilePath-3"><i class="fa fa-check"></i><b>4.2.2</b> File Paths</a></li>
<li class="chapter" data-level="4.2.3" data-path=""><a href="#Units-3"><i class="fa fa-check"></i><b>4.2.3</b> Units</a></li>
<li class="chapter" data-level="4.2.4" data-path=""><a href="#TCF-3"><i class="fa fa-check"></i><b>4.2.4</b> TCF</a></li>
<li class="chapter" data-level="4.2.5" data-path=""><a href="#ECF-3"><i class="fa fa-check"></i><b>4.2.5</b> ECF</a></li>
<li class="chapter" data-level="4.2.6" data-path=""><a href="#TBC-3"><i class="fa fa-check"></i><b>4.2.6</b> TBC</a></li>
<li class="chapter" data-level="4.2.7" data-path=""><a href="#TGC-3"><i class="fa fa-check"></i><b>4.2.7</b> TGC</a></li>
<li class="chapter" data-level="4.2.8" data-path=""><a href="#QCF-3"><i class="fa fa-check"></i><b>4.2.8</b> QCF</a></li>
<li class="chapter" data-level="4.2.9" data-path=""><a href="#TEF-3"><i class="fa fa-check"></i><b>4.2.9</b> TEF</a></li>
<li class="chapter" data-level="4.2.10" data-path=""><a href="#TOC-3"><i class="fa fa-check"></i><b>4.2.10</b> TOC</a></li>
<li class="chapter" data-level="4.2.11" data-path=""><a href="#TRFC-3"><i class="fa fa-check"></i><b>4.2.11</b> TRFC</a></li>
<li class="chapter" data-level="4.2.12" data-path=""><a href="#TESF-3"><i class="fa fa-check"></i><b>4.2.12</b> TESF</a></li>
<li class="chapter" data-level="4.2.13" data-path=""><a href="#ADCF-3"><i class="fa fa-check"></i><b>4.2.13</b> ADCF</a></li>
<li class="chapter" data-level="4.2.14" data-path=""><a href="#TSCF-3"><i class="fa fa-check"></i><b>4.2.14</b> TSCF</a></li>
<li class="chapter" data-level="4.2.15" data-path=""><a href="#ReadFile-3"><i class="fa fa-check"></i><b>4.2.15</b> Read File</a></li>
<li class="chapter" data-level="4.2.16" data-path=""><a href="#Override-3"><i class="fa fa-check"></i><b>4.2.16</b> Override Files</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path=""><a href="#Databases-2"><i class="fa fa-check"></i><b>4.3</b> Databases</a></li>
<li class="chapter" data-level="4.4" data-path=""><a href="#GISLayers-2"><i class="fa fa-check"></i><b>4.4</b> Input Layers</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path=""><a href="#GISFormats-3"><i class="fa fa-check"></i><b>4.4.1</b> Input Formats</a></li>
<li class="chapter" data-level="4.4.2" data-path=""><a href="#GISCommands-3"><i class="fa fa-check"></i><b>4.4.2</b> GIS Commands</a>
<ul>
<li class="chapter" data-level="4.4.2.1" data-path=""><a href="#Attributes-4"><i class="fa fa-check"></i><b>4.4.2.1</b> GIS Attribute Interpretation</a></li>
<li class="chapter" data-level="4.4.2.2" data-path=""><a href="#Objects-4"><i class="fa fa-check"></i><b>4.4.2.2</b> GIS Object Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.4.3" data-path=""><a href="#GPKG-3"><i class="fa fa-check"></i><b>4.4.3</b> GeoPackage Commands</a>
<ul>
<li class="chapter" data-level="4.4.3.1" data-path=""><a href="#GPKG-input-4"><i class="fa fa-check"></i><b>4.4.3.1</b> GPKG Input Commands</a></li>
<li class="chapter" data-level="4.4.3.2" data-path=""><a href="#GPKG-output-4"><i class="fa fa-check"></i><b>4.4.3.2</b> GPKG Output Commands</a></li>
</ul></li>
<li class="chapter" data-level="4.4.4" data-path=""><a href="#GRID-3"><i class="fa fa-check"></i><b>4.4.4</b> Grid Commands</a></li>
<li class="chapter" data-level="4.4.5" data-path=""><a href="#TIN-3"><i class="fa fa-check"></i><b>4.4.5</b> TIN Commands</a></li>
<li class="chapter" data-level="4.4.6" data-path=""><a href="#RowCol-3"><i class="fa fa-check"></i><b>4.4.6</b> RowCol Commands (Legacy)</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path=""><a href="#LayeringData-2"><i class="fa fa-check"></i><b>4.5</b> Layering Data</a></li>
<li class="chapter" data-level="4.6" data-path=""><a href="#XF-Files-2"><i class="fa fa-check"></i><b>4.6</b> XF Files</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#OneD-Domains-1"><i class="fa fa-check"></i><b>5</b> 1D Network Domains - ESTRY</a>
<ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#OneD-Introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#Scheme-2"><i class="fa fa-check"></i><b>5.2</b> Schematisation</a></li>
<li class="chapter" data-level="5.3" data-path=""><a href="#SolutionScheme-2"><i class="fa fa-check"></i><b>5.3</b> Solution Scheme</a></li>
<li class="chapter" data-level="5.4" data-path=""><a href="#OneD-nwk-2"><i class="fa fa-check"></i><b>5.4</b> 1d_nwk Attributes</a></li>
<li class="chapter" data-level="5.5" data-path=""><a href="#Channel-Intro-2"><i class="fa fa-check"></i><b>5.5</b> Channels Overview</a></li>
<li class="chapter" data-level="5.6" data-path=""><a href="#Open-Channel-2"><i class="fa fa-check"></i><b>5.6</b> Open Channels</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path=""><a href="#I-channels-3"><i class="fa fa-check"></i><b>5.6.1</b> Inertial Channels</a></li>
<li class="chapter" data-level="5.6.2" data-path=""><a href="#NI-channels-3"><i class="fa fa-check"></i><b>5.6.2</b> Non-Inertial Channels</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path=""><a href="#XS-2"><i class="fa fa-check"></i><b>5.7</b> Cross-Sections</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path=""><a href="#XS-flags-3"><i class="fa fa-check"></i><b>5.7.1</b> Type “XZ” Optional Flags</a>
<ul>
<li class="chapter" data-level="5.7.1.1" data-path=""><a href="#RR-4"><i class="fa fa-check"></i><b>5.7.1.1</b> Relative Resistance</a></li>
</ul></li>
<li class="chapter" data-level="5.7.2" data-path=""><a href="#HW-flags-3"><i class="fa fa-check"></i><b>5.7.2</b> Type “HW” Optional Flags</a>
<ul>
<li class="chapter" data-level="5.7.2.1" data-path=""><a href="#HW-A-4"><i class="fa fa-check"></i><b>5.7.2.1</b> Flow Area (A)</a></li>
<li class="chapter" data-level="5.7.2.2" data-path=""><a href="#HW-P-4"><i class="fa fa-check"></i><b>5.7.2.2</b> Wetted Perimeter (P)</a></li>
<li class="chapter" data-level="5.7.2.3" data-path=""><a href="#HW-N-4"><i class="fa fa-check"></i><b>5.7.2.3</b> Manning’s n Values (N)</a></li>
<li class="chapter" data-level="5.7.2.4" data-path=""><a href="#HW-F-4"><i class="fa fa-check"></i><b>5.7.2.4</b> Manning’s n Values (F)</a></li>
</ul></li>
<li class="chapter" data-level="5.7.3" data-path=""><a href="#Parallel-Channel-3"><i class="fa fa-check"></i><b>5.7.3</b> Parallel Channel Analysis</a></li>
<li class="chapter" data-level="5.7.4" data-path=""><a href="#Eff-vs-Total-3"><i class="fa fa-check"></i><b>5.7.4</b> Effective Area versus Total Area</a></li>
<li class="chapter" data-level="5.7.5" data-path=""><a href="#XS-Mid-3"><i class="fa fa-check"></i><b>5.7.5</b> Mid Cross-Sections</a></li>
<li class="chapter" data-level="5.7.6" data-path=""><a href="#XS-End-3"><i class="fa fa-check"></i><b>5.7.6</b> End Cross-Sections</a></li>
<li class="chapter" data-level="5.7.7" data-path=""><a href="#Interpolate-XS-3"><i class="fa fa-check"></i><b>5.7.7</b> Interpolated Cross-Section Protocols</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path=""><a href="#Structures-2"><i class="fa fa-check"></i><b>5.8</b> Structures</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path=""><a href="#culverts-pipes-3"><i class="fa fa-check"></i><b>5.8.1</b> Culverts and Pipes</a>
<ul>
<li class="chapter" data-level="5.8.1.1" data-path=""><a href="#Blockage-4"><i class="fa fa-check"></i><b>5.8.1.1</b> Blockage Matrix</a></li>
<li class="chapter" data-level="5.8.1.2" data-path=""><a href="#id_-4"><i class="fa fa-check"></i><b>5.8.1.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="5.8.2" data-path=""><a href="#Bridges-3"><i class="fa fa-check"></i><b>5.8.2</b> Bridges</a>
<ul>
<li class="chapter" data-level="5.8.2.1" data-path=""><a href="#BridgeIntro-4"><i class="fa fa-check"></i><b>5.8.2.1</b> Bridges Overview</a></li>
<li class="chapter" data-level="5.8.2.2" data-path=""><a href="#XSLoss-4"><i class="fa fa-check"></i><b>5.8.2.2</b> Bridge Cross-Section and Loss Tables</a></li>
<li class="chapter" data-level="5.8.2.3" data-path=""><a href="#B-Bridge-4"><i class="fa fa-check"></i><b>5.8.2.3</b> B Bridge Losses Approach</a></li>
<li class="chapter" data-level="5.8.2.4" data-path=""><a href="#BB-Bridge-4"><i class="fa fa-check"></i><b>5.8.2.4</b> BB Bridge Losses Approach</a></li>
</ul></li>
<li class="chapter" data-level="5.8.3" data-path=""><a href="#BArch-3"><i class="fa fa-check"></i><b>5.8.3</b> Arch Bridge</a>
<ul>
<li class="chapter" data-level="5.8.3.1" data-path=""><a href="#BArch-Editor-4"><i class="fa fa-check"></i><b>5.8.3.1</b> Arch Bridge Editor</a></li>
<li class="chapter" data-level="5.8.3.2" data-path=""><a href="#BArch-Min-Blc-4"><i class="fa fa-check"></i><b>5.8.3.2</b> Arch Minimum Blockage</a></li>
</ul></li>
<li class="chapter" data-level="5.8.4" data-path=""><a href="#Weir-3"><i class="fa fa-check"></i><b>5.8.4</b> Weirs</a>
<ul>
<li class="chapter" data-level="5.8.4.1" data-path=""><a href="#Weir-Intro-4"><i class="fa fa-check"></i><b>5.8.4.1</b> Weirs Overview</a></li>
<li class="chapter" data-level="5.8.4.2" data-path=""><a href="#W-Weir-4"><i class="fa fa-check"></i><b>5.8.4.2</b> Original Weirs (W)</a></li>
<li class="chapter" data-level="5.8.4.3" data-path=""><a href="#Adv-Weir-4"><i class="fa fa-check"></i><b>5.8.4.3</b> Advanced Weirs (WB, WC, WD, WO, WR, WT, WV, WW)</a></li>
<li class="chapter" data-level="5.8.4.4" data-path=""><a href="#Submerge-4"><i class="fa fa-check"></i><b>5.8.4.4</b> Advanced Weir Submergence Curves</a></li>
<li class="chapter" data-level="5.8.4.5" data-path=""><a href="#Auto-Weir-4"><i class="fa fa-check"></i><b>5.8.4.5</b> Automatically Created Weirs</a></li>
<li class="chapter" data-level="5.8.4.6" data-path=""><a href="#VW-Channel-4"><i class="fa fa-check"></i><b>5.8.4.6</b> VW Channels (Variable Geometry Weir)</a></li>
</ul></li>
<li class="chapter" data-level="5.8.5" data-path=""><a href="#SP-3"><i class="fa fa-check"></i><b>5.8.5</b> Spillways (SP)</a></li>
<li class="chapter" data-level="5.8.6" data-path=""><a href="#SG-3"><i class="fa fa-check"></i><b>5.8.6</b> Sluice Gates (SG)</a></li>
<li class="chapter" data-level="5.8.7" data-path=""><a href="#LossAdjustment-3"><i class="fa fa-check"></i><b>5.8.7</b> Adjustment of Contraction and Expansion Losses</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path=""><a href="#Special-Channels-2"><i class="fa fa-check"></i><b>5.9</b> Special Channels</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path=""><a href="#M-Channel-3"><i class="fa fa-check"></i><b>5.9.1</b> M Channels (User Defined Flow Matrix)</a></li>
<li class="chapter" data-level="5.9.2" data-path=""><a href="#Q-Channels-3"><i class="fa fa-check"></i><b>5.9.2</b> Q Channels (Upstream Depth-Discharge Relationship)</a></li>
<li class="chapter" data-level="5.9.3" data-path=""><a href="#XConnect-3"><i class="fa fa-check"></i><b>5.9.3</b> X Connectors</a></li>
<li class="chapter" data-level="5.9.4" data-path=""><a href="#Legacy-Channel-3"><i class="fa fa-check"></i><b>5.9.4</b> Legacy Channels</a></li>
<li class="chapter" data-level="5.9.5" data-path=""><a href="#OneD-nwk-3"><i class="fa fa-check"></i><b>5.9.5</b> 1d_nwk Attributes (M, P, Q, SG, SP Channels)</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path=""><a href="#OperationalChannels-2"><i class="fa fa-check"></i><b>5.10</b> Operational Channels</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path=""><a href="#TOC-Logic-3"><i class="fa fa-check"></i><b>5.10.1</b> .toc File Commands and Logic</a>
<ul>
<li class="chapter" data-level="5.10.1.1" data-path=""><a href="#TOC-Define-4"><i class="fa fa-check"></i><b>5.10.1.1</b> Define Control Command</a></li>
<li class="chapter" data-level="5.10.1.2" data-path=""><a href="#UserDef-4"><i class="fa fa-check"></i><b>5.10.1.2</b> User Defined Variables</a></li>
<li class="chapter" data-level="5.10.1.3" data-path=""><a href="#Logic-4"><i class="fa fa-check"></i><b>5.10.1.3</b> Logic Rules</a></li>
<li class="chapter" data-level="5.10.1.4" data-path=""><a href="#Increment-Operate-4"><i class="fa fa-check"></i><b>5.10.1.4</b> Incremental Operators</a></li>
</ul></li>
<li class="chapter" data-level="5.10.2" data-path=""><a href="#Pumps-3"><i class="fa fa-check"></i><b>5.10.2</b> Pumps (P and PO)</a></li>
<li class="chapter" data-level="5.10.3" data-path=""><a href="#QO-3"><i class="fa fa-check"></i><b>5.10.3</b> QO Channels</a></li>
<li class="chapter" data-level="5.10.4" data-path=""><a href="#RO-3"><i class="fa fa-check"></i><b>5.10.4</b> Gated Drowned Rectangular Culverts (RO)</a></li>
<li class="chapter" data-level="5.10.5" data-path=""><a href="#SG-SGO-3"><i class="fa fa-check"></i><b>5.10.5</b> Sluice Gates (SG and SGO)</a></li>
<li class="chapter" data-level="5.10.6" data-path=""><a href="#SPO-3"><i class="fa fa-check"></i><b>5.10.6</b> Spillways with Gates (SPO)</a></li>
<li class="chapter" data-level="5.10.7" data-path=""><a href="#Weirs-Operational-3"><i class="fa fa-check"></i><b>5.10.7</b> Weirs (WBO, WCO, WDO, WOO, WRO, WTO)</a></li>
<li class="chapter" data-level="5.10.8" data-path=""><a href="#PFDF-3"><i class="fa fa-check"></i><b>5.10.8</b> Piping and Dam Failure</a>
<ul>
<li class="chapter" data-level="5.10.8.1" data-path=""><a href="#PF-4"><i class="fa fa-check"></i><b>5.10.8.1</b> Piping Failure (PF)</a></li>
<li class="chapter" data-level="5.10.8.2" data-path=""><a href="#DF-4"><i class="fa fa-check"></i><b>5.10.8.2</b> Dam Failure (DF)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path=""><a href="#Pipes-2"><i class="fa fa-check"></i><b>5.11</b> Pipe Networks</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path=""><a href="#Pipes-3"><i class="fa fa-check"></i><b>5.11.1</b> Pipes</a></li>
<li class="chapter" data-level="5.11.2" data-path=""><a href="#Pits-3"><i class="fa fa-check"></i><b>5.11.2</b> Pits</a>
<ul>
<li class="chapter" data-level="5.11.2.1" data-path=""><a href="#OneD-pit-nwk-4"><i class="fa fa-check"></i><b>5.11.2.1</b> 1d_nwk Pits</a></li>
<li class="chapter" data-level="5.11.2.2" data-path=""><a href="#OneD-pit-4"><i class="fa fa-check"></i><b>5.11.2.2</b> 1d_pit Pits</a></li>
<li class="chapter" data-level="5.11.2.3" data-path=""><a href="#Conn-Pits-Nds-4"><i class="fa fa-check"></i><b>5.11.2.3</b> Connecting Pits and Nodes to 2D Domains</a></li>
</ul></li>
<li class="chapter" data-level="5.11.3" data-path=""><a href="#DD-Database-3"><i class="fa fa-check"></i><b>5.11.3</b> Pit Inlet and Depth/Stage vs Discharge Databases</a>
<ul>
<li class="chapter" data-level="5.11.3.1" data-path=""><a href="#Xfall-4"><i class="fa fa-check"></i><b>5.11.3.1</b> Road Crossfall Options</a></li>
</ul></li>
<li class="chapter" data-level="5.11.4" data-path=""><a href="#Manholes-3"><i class="fa fa-check"></i><b>5.11.4</b> Manholes</a>
<ul>
<li class="chapter" data-level="5.11.4.1" data-path=""><a href="#Auto-MH-4"><i class="fa fa-check"></i><b>5.11.4.1</b> Automatically Assigned Manholes</a></li>
<li class="chapter" data-level="5.11.4.2" data-path=""><a href="#OneD-mh-4"><i class="fa fa-check"></i><b>5.11.4.2</b> Manually Assigned Manholes (1d_mh Layer)</a></li>
<li class="chapter" data-level="5.11.4.3" data-path=""><a href="#mh-direction-4"><i class="fa fa-check"></i><b>5.11.4.3</b> Digitising Culverts Connected to Manholes</a></li>
<li class="chapter" data-level="5.11.4.4" data-path=""><a href="#Engelund-4"><i class="fa fa-check"></i><b>5.11.4.4</b> Engelund Manhole Loss Approach</a></li>
<li class="chapter" data-level="5.11.4.5" data-path=""><a href="#FixedLoss-4"><i class="fa fa-check"></i><b>5.11.4.5</b> Fixed Manhole Loss Approach</a></li>
<li class="chapter" data-level="5.11.4.6" data-path=""><a href="#JunctionLoss-4"><i class="fa fa-check"></i><b>5.11.4.6</b> Discussion on Approaches to Modelling Pipe Junction Losses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path=""><a href="#Virtual-Pipes-2"><i class="fa fa-check"></i><b>5.12</b> Virtual Pipes</a></li>
<li class="chapter" data-level="5.13" data-path=""><a href="#Nodes-2"><i class="fa fa-check"></i><b>5.13</b> Nodes</a>
<ul>
<li class="chapter" data-level="5.13.1" data-path=""><a href="#Auto-Node-3"><i class="fa fa-check"></i><b>5.13.1</b> Automatically Defined Nodes</a>
<ul>
<li class="chapter" data-level="5.13.1.1" data-path=""><a href="#AutoStorageWidths-4"><i class="fa fa-check"></i><b>5.13.1.1</b> Storage Calculated Automatically from Channel Widths</a></li>
<li class="chapter" data-level="5.13.1.2" data-path=""><a href="#AutoStorageANA-4"><i class="fa fa-check"></i><b>5.13.1.2</b> Additional Storage Added from Len_or_ANA Attribute</a></li>
</ul></li>
<li class="chapter" data-level="5.13.2" data-path=""><a href="#Manual-Node-3"><i class="fa fa-check"></i><b>5.13.2</b> Manually Defined Nodes</a>
<ul>
<li class="chapter" data-level="5.13.2.1" data-path=""><a href="#NA-Table-4"><i class="fa fa-check"></i><b>5.13.2.1</b> Storage Nodes (User Defined NA Tables)</a></li>
<li class="chapter" data-level="5.13.2.2" data-path=""><a href="#channel-invert-4"><i class="fa fa-check"></i><b>5.13.2.2</b> Using Nodes to Define Channel Inverts</a></li>
<li class="chapter" data-level="5.13.2.3" data-path=""><a href="#Nd-Auto-Conn-4"><i class="fa fa-check"></i><b>5.13.2.3</b> Automatically Connecting Nodes to 2D domains</a></li>
</ul></li>
<li class="chapter" data-level="5.13.3" data-path=""><a href="#Obvert-3"><i class="fa fa-check"></i><b>5.13.3</b> Storage Above Top of Channels</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#OneD-SWMM-1"><i class="fa fa-check"></i><b>6</b> 1D Network Domains - EPA SWMM</a>
<ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#SWMM-Introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path=""><a href="#TUFLOW-SWMM-Capabilities-3"><i class="fa fa-check"></i><b>6.1.1</b> TUFLOW-SWMM Capabilities</a></li>
<li class="chapter" data-level="6.1.2" data-path=""><a href="#SWMM-UserResources-3"><i class="fa fa-check"></i><b>6.1.2</b> Additional SWMM User Resources</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path=""><a href="#ModelSetup-2"><i class="fa fa-check"></i><b>6.2</b> Model Setup</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path=""><a href="#SwmmModel-3"><i class="fa fa-check"></i><b>6.2.1</b> SWMM Model</a></li>
<li class="chapter" data-level="6.2.2" data-path=""><a href="#TUFLOW-SWMM_Simulations-4"><i class="fa fa-check"></i><b>6.2.2</b> TUFLOW-SWMM Model Simulation</a></li>
<li class="chapter" data-level="6.2.3" data-path=""><a href="#SWMM_ESTRY_Linking-3"><i class="fa fa-check"></i><b>6.2.3</b> Linking SWMM to TUFLOW 2D and ESTRY</a></li>
<li class="chapter" data-level="6.2.4" data-path=""><a href="#SWMMSettings-3"><i class="fa fa-check"></i><b>6.2.4</b> SWMM Simulation Option Settings</a></li>
<li class="chapter" data-level="6.2.5" data-path=""><a href="#SWMM-BCDB-3"><i class="fa fa-check"></i><b>6.2.5</b> Using the TUFLOW BC Database in SWMM</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path=""><a href="#SWMMGISTools-2"><i class="fa fa-check"></i><b>6.3</b> SWMM GIS Tools</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path=""><a href="#SWMMGPKGFormat-3"><i class="fa fa-check"></i><b>6.3.1</b> GeoPackage File Format</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path=""><a href="#SWMMOutputs-2"><i class="fa fa-check"></i><b>6.4</b> SWMM Outputs</a></li>
<li class="chapter" data-level="6.5" data-path=""><a href="#SWMMInclusionTUFLOW-2"><i class="fa fa-check"></i><b>6.5</b> SWMM Inclusion in TUFLOW</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path=""><a href="#SWMMLibraryVersion-3"><i class="fa fa-check"></i><b>6.5.1</b> SWMM Library Version</a></li>
<li class="chapter" data-level="6.5.2" data-path=""><a href="#SWMMCode-in-TUFLOW-3"><i class="fa fa-check"></i><b>6.5.2</b> Embedded SWMM Code in TUFLOW</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path=""><a href="#TwoD-Domains-1"><i class="fa fa-check"></i><b>7</b> 2D Domains</a>
<ul>
<li class="chapter" data-level="7.1" data-path=""><a href="#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path=""><a href="#Solvers-2"><i class="fa fa-check"></i><b>7.2</b> Solvers</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path=""><a href="#tuflow-hpc-2d-solver"><i class="fa fa-check"></i><b>7.2.1</b> TUFLOW HPC 2D Solver</a></li>
<li class="chapter" data-level="7.2.2" data-path=""><a href="#tuflow-classic-2d-solver"><i class="fa fa-check"></i><b>7.2.2</b> TUFLOW Classic 2D Solver</a></li>
<li class="chapter" data-level="7.2.3" data-path=""><a href="#Schematisation-3"><i class="fa fa-check"></i><b>7.2.3</b> Cell Schematisation</a>
<ul>
<li class="chapter" data-level="7.2.3.1" data-path=""><a href="#computational-points-4"><i class="fa fa-check"></i><b>7.2.3.1</b> Computational Points</a></li>
</ul></li>
<li class="chapter" data-level="7.2.4" data-path=""><a href="#turbulence-overview"><i class="fa fa-check"></i><b>7.2.4</b> Turbulence</a>
<ul>
<li class="chapter" data-level="7.2.4.1" data-path=""><a href="#Dry-Wall-4"><i class="fa fa-check"></i><b>7.2.4.1</b> Dry Wall Treatment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path=""><a href="#Common-2"><i class="fa fa-check"></i><b>7.3</b> Common Functionality</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path=""><a href="#Domain-3"><i class="fa fa-check"></i><b>7.3.1</b> Defining the Domain</a></li>
<li class="chapter" data-level="7.3.2" data-path=""><a href="#CellCodes-3"><i class="fa fa-check"></i><b>7.3.2</b> Active / Inactive Cells</a></li>
<li class="chapter" data-level="7.3.3" data-path=""><a href="#layering-3"><i class="fa fa-check"></i><b>7.3.3</b> Data Layering</a></li>
<li class="chapter" data-level="7.3.4" data-path=""><a href="#sampling-of-data-sets"><i class="fa fa-check"></i><b>7.3.4</b> Sampling of Data Sets</a>
<ul>
<li class="chapter" data-level="7.3.4.1" data-path=""><a href="#traditional-sampling-4"><i class="fa fa-check"></i><b>7.3.4.1</b> Traditional Sampling Approach</a></li>
</ul></li>
<li class="chapter" data-level="7.3.5" data-path=""><a href="#elevations-3"><i class="fa fa-check"></i><b>7.3.5</b> Elevations</a>
<ul>
<li class="chapter" data-level="7.3.5.1" data-path=""><a href="#DEMGrids-3"><i class="fa fa-check"></i><b>7.3.5.1</b> Direct Reading of DEM Grids</a></li>
<li class="chapter" data-level="7.3.5.2" data-path=""><a href="#zsh-4"><i class="fa fa-check"></i><b>7.3.5.2</b> Z Shape Layers (2d_zsh)</a></li>
<li class="chapter" data-level="7.3.5.3" data-path=""><a href="#vzsh-4"><i class="fa fa-check"></i><b>7.3.5.3</b> Variable Z Shape Layer (2d_vzsh)</a></li>
<li class="chapter" data-level="7.3.5.4" data-path=""><a href="#ztin-4"><i class="fa fa-check"></i><b>7.3.5.4</b> 3D TIN Layers (2d_ztin)</a></li>
<li class="chapter" data-level="7.3.5.5" data-path=""><a href="#zln-4"><i class="fa fa-check"></i><b>7.3.5.5</b> 3D Breakline Layers (2d_zln)</a></li>
<li class="chapter" data-level="7.3.5.6" data-path=""><a href="#zpt-4"><i class="fa fa-check"></i><b>7.3.5.6</b> Zpt Layers (2d_zpt)</a></li>
<li class="chapter" data-level="7.3.5.7" data-path=""><a href="#using-multiple-layers-and-points-layers"><i class="fa fa-check"></i><b>7.3.5.7</b> Using Multiple Layers and Points Layers</a></li>
</ul></li>
<li class="chapter" data-level="7.3.6" data-path=""><a href="#Materials-2"><i class="fa fa-check"></i><b>7.3.6</b> Land Use (Materials)</a>
<ul>
<li class="chapter" data-level="7.3.6.1" data-path=""><a href="#Bed-Resistance-4"><i class="fa fa-check"></i><b>7.3.6.1</b> Bed Resistance</a></li>
<li class="chapter" data-level="7.3.6.2" data-path=""><a href="#log-law-4"><i class="fa fa-check"></i><b>7.3.6.2</b> Log Law Depth Varying Bed Resistance</a></li>
<li class="chapter" data-level="7.3.6.3" data-path=""><a href="#Materials-File-4"><i class="fa fa-check"></i><b>7.3.6.3</b> Materials File</a></li>
<li class="chapter" data-level="7.3.6.4" data-path=""><a href="#Rainfall-Losses-4"><i class="fa fa-check"></i><b>7.3.6.4</b> Rainfall Losses</a></li>
</ul></li>
<li class="chapter" data-level="7.3.7" data-path=""><a href="#Infiltration-2"><i class="fa fa-check"></i><b>7.3.7</b> Infiltration</a>
<ul>
<li class="chapter" data-level="7.3.7.1" data-path=""><a href="#infiltration-layer-4"><i class="fa fa-check"></i><b>7.3.7.1</b> Infiltration Layer</a></li>
<li class="chapter" data-level="7.3.7.2" data-path=""><a href="#tsoilf-4"><i class="fa fa-check"></i><b>7.3.7.2</b> Soils File (.tsoilf)</a></li>
</ul></li>
<li class="chapter" data-level="7.3.8" data-path=""><a href="#HydraulicStructures-3"><i class="fa fa-check"></i><b>7.3.8</b> Hydraulic Structures</a>
<ul>
<li class="chapter" data-level="7.3.8.1" data-path=""><a href="#introduction-2"><i class="fa fa-check"></i><b>7.3.8.1</b> Introduction</a></li>
<li class="chapter" data-level="7.3.8.2" data-path=""><a href="#bg-layer-4"><i class="fa fa-check"></i><b>7.3.8.2</b> 2D Bridge Structures (2d_bg)</a></li>
<li class="chapter" data-level="7.3.8.3" data-path=""><a href="#lfcsh-4"><i class="fa fa-check"></i><b>7.3.8.3</b> Layered Flow Constrictions (2d_lfcsh Layers)</a></li>
</ul></li>
<li class="chapter" data-level="7.3.9" data-path=""><a href="#cell-mods-3"><i class="fa fa-check"></i><b>7.3.9</b> Cell Modification</a>
<ul>
<li class="chapter" data-level="7.3.9.1" data-path=""><a href="#srf-3"><i class="fa fa-check"></i><b>7.3.9.1</b> Storage Reduction (2d_srf)</a></li>
<li class="chapter" data-level="7.3.9.2" data-path=""><a href="#CWF-4"><i class="fa fa-check"></i><b>7.3.9.2</b> Cell Width Factor (CWF)</a></li>
<li class="chapter" data-level="7.3.9.3" data-path=""><a href="#flc-4"><i class="fa fa-check"></i><b>7.3.9.3</b> Form Loss Coefficient (FLC)</a></li>
<li class="chapter" data-level="7.3.9.4" data-path=""><a href="#mod-conveyance-4"><i class="fa fa-check"></i><b>7.3.9.4</b> Modify Conveyance</a></li>
</ul></li>
<li class="chapter" data-level="7.3.10" data-path=""><a href="#urban-areas-3"><i class="fa fa-check"></i><b>7.3.10</b> Modelling Urban Areas</a>
<ul>
<li class="chapter" data-level="7.3.10.1" data-path=""><a href="#buildings-4"><i class="fa fa-check"></i><b>7.3.10.1</b> Buildings</a></li>
<li class="chapter" data-level="7.3.10.2" data-path=""><a href="#roads-4"><i class="fa fa-check"></i><b>7.3.10.2</b> Roads</a></li>
<li class="chapter" data-level="7.3.10.3" data-path=""><a href="#fences-4"><i class="fa fa-check"></i><b>7.3.10.3</b> Fences and Walls</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path=""><a href="#HPC-specific-2"><i class="fa fa-check"></i><b>7.4</b> TUFLOW HPC Specific</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path=""><a href="#Quadtree-3"><i class="fa fa-check"></i><b>7.4.1</b> Quadtree</a>
<ul>
<li class="chapter" data-level="7.4.1.1" data-path=""><a href="#qcf-commands-4"><i class="fa fa-check"></i><b>7.4.1.1</b> Quadtree .tcf Commands</a></li>
<li class="chapter" data-level="7.4.1.2" data-path=""><a href="#qcf-mandatory-4"><i class="fa fa-check"></i><b>7.4.1.2</b> Quadtree Control File (.qcf) – Mandatory Commands</a></li>
<li class="chapter" data-level="7.4.1.3" data-path=""><a href="#qcf-optional-4"><i class="fa fa-check"></i><b>7.4.1.3</b> Quadtree Control File (.qcf) – Optional Commands</a></li>
<li class="chapter" data-level="7.4.1.4" data-path=""><a href="#QDT-mesh-4"><i class="fa fa-check"></i><b>7.4.1.4</b> Defining Grid Refinement Polygons</a></li>
</ul></li>
<li class="chapter" data-level="7.4.2" data-path=""><a href="#HPC-Turbulence-3"><i class="fa fa-check"></i><b>7.4.2</b> HPC Turbulence</a>
<ul>
<li class="chapter" data-level="7.4.2.1" data-path=""><a href="#HPC-Turbulence-4"><i class="fa fa-check"></i><b>7.4.2.1</b> Overview</a></li>
<li class="chapter" data-level="7.4.2.2" data-path=""><a href="#Constant-4"><i class="fa fa-check"></i><b>7.4.2.2</b> Constant Eddy Viscosity</a></li>
<li class="chapter" data-level="7.4.2.3" data-path=""><a href="#Smagorinsky-4"><i class="fa fa-check"></i><b>7.4.2.3</b> Smagorinsky Approach</a></li>
<li class="chapter" data-level="7.4.2.4" data-path=""><a href="#Wu-4"><i class="fa fa-check"></i><b>7.4.2.4</b> Wu Approach</a></li>
</ul></li>
<li class="chapter" data-level="7.4.3" data-path=""><a href="#SGS-3"><i class="fa fa-check"></i><b>7.4.3</b> Sub-Grid Sampling (SGS)</a>
<ul>
<li class="chapter" data-level="7.4.3.1" data-path=""><a href="#SGS-commands-4"><i class="fa fa-check"></i><b>7.4.3.1</b> SGS Methodology and Commands</a></li>
<li class="chapter" data-level="7.4.3.2" data-path=""><a href="#SGS-output-4"><i class="fa fa-check"></i><b>7.4.3.2</b> SGS Output Options</a></li>
</ul></li>
<li class="chapter" data-level="7.4.4" data-path=""><a href="#HPC-US-Controlled-3"><i class="fa fa-check"></i><b>7.4.4</b> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)</a></li>
<li class="chapter" data-level="7.4.5" data-path=""><a href="#HPC-Groundwater-3"><i class="fa fa-check"></i><b>7.4.5</b> Groundwater Flow</a>
<ul>
<li class="chapter" data-level="7.4.5.1" data-path=""><a href="#implementation"><i class="fa fa-check"></i><b>7.4.5.1</b> Implementation</a></li>
<li class="chapter" data-level="7.4.5.2" data-path=""><a href="#top-gw-drying-4"><i class="fa fa-check"></i><b>7.4.5.2</b> Drying of Top Groundwater Layer</a></li>
</ul></li>
<li class="chapter" data-level="7.4.6" data-path=""><a href="#NN-3"><i class="fa fa-check"></i><b>7.4.6</b> Non-Newtonian Flow</a>
<ul>
<li class="chapter" data-level="7.4.6.1" data-path=""><a href="#Implementation-4"><i class="fa fa-check"></i><b>7.4.6.1</b> Implementation</a></li>
<li class="chapter" data-level="7.4.6.2" data-path=""><a href="#NN-Mix-4"><i class="fa fa-check"></i><b>7.4.6.2</b> Non-Newtonian Mixing</a></li>
</ul></li>
<li class="chapter" data-level="7.4.7" data-path=""><a href="#HPC-Unsupported-3"><i class="fa fa-check"></i><b>7.4.7</b> Unsupported Features in TUFLOW HPC</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path=""><a href="#tuflow-classic-specific"><i class="fa fa-check"></i><b>7.5</b> TUFLOW Classic Specific</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path=""><a href="#CLA-Turbulence-3"><i class="fa fa-check"></i><b>7.5.1</b> Classic Turbulence</a>
<ul>
<li class="chapter" data-level="7.5.1.1" data-path=""><a href="#CLA-Constant-4"><i class="fa fa-check"></i><b>7.5.1.1</b> Constant</a></li>
<li class="chapter" data-level="7.5.1.2" data-path=""><a href="#CLA-Smagorinsky-4"><i class="fa fa-check"></i><b>7.5.1.2</b> Smagorinsky</a></li>
</ul></li>
<li class="chapter" data-level="7.5.2" data-path=""><a href="#CLA-US-Controlled-3"><i class="fa fa-check"></i><b>7.5.2</b> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)</a></li>
<li class="chapter" data-level="7.5.3" data-path=""><a href="#CLA-mat-3"><i class="fa fa-check"></i><b>7.5.3</b> Land Use (Materials)</a></li>
<li class="chapter" data-level="7.5.4" data-path=""><a href="#CLA-2D2D-3"><i class="fa fa-check"></i><b>7.5.4</b> Multiple 2D Domain</a></li>
<li class="chapter" data-level="7.5.5" data-path=""><a href="#CLA-Coriolis-3"><i class="fa fa-check"></i><b>7.5.5</b> Coriolis Term</a></li>
<li class="chapter" data-level="7.5.6" data-path=""><a href="#legacy-structures"><i class="fa fa-check"></i><b>7.5.6</b> Legacy Structures</a>
<ul>
<li class="chapter" data-level="7.5.6.1" data-path=""><a href="#CLA-FC-4"><i class="fa fa-check"></i><b>7.5.6.1</b> 2D Flow Constrictions (2d_fcsh and 2d_fc)</a></li>
<li class="chapter" data-level="7.5.6.2" data-path=""><a href="#applying-form-energy-loss-in-2d-fc-and-fcsh-layers"><i class="fa fa-check"></i><b>7.5.6.2</b> Applying Form (Energy) Loss in 2D FC and FCSH Layers</a></li>
</ul></li>
<li class="chapter" data-level="7.5.7" data-path=""><a href="#CLA-Unsupported-3"><i class="fa fa-check"></i><b>7.5.7</b> Unsupported Features in TUFLOW Classic</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path=""><a href="#Boundaries-InitialConditions-1"><i class="fa fa-check"></i><b>8</b> Boundaries and Initial Conditions</a>
<ul>
<li class="chapter" data-level="8.1" data-path=""><a href="#BC-Intro-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path=""><a href="#BCArrangements-2"><i class="fa fa-check"></i><b>8.2</b> Recommended BC Arrangements</a></li>
<li class="chapter" data-level="8.3" data-path=""><a href="#BC-Solver-2"><i class="fa fa-check"></i><b>8.3</b> Solver Specific Considerations</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path=""><a href="#ClassicBC-3"><i class="fa fa-check"></i><b>8.3.1</b> Classic Specific Boundaries / Options</a></li>
<li class="chapter" data-level="8.3.2" data-path=""><a href="#ClassicHPC-3"><i class="fa fa-check"></i><b>8.3.2</b> HPC Specific Boundaries / Options</a>
<ul>
<li class="chapter" data-level="8.3.2.1" data-path=""><a href="#HPCEnergyOptions-4"><i class="fa fa-check"></i><b>8.3.2.1</b> HPC Energy Options for 2D HT, HQ and QT Boundaries</a></li>
<li class="chapter" data-level="8.3.2.2" data-path=""><a href="#HpcHQApproach-4"><i class="fa fa-check"></i><b>8.3.2.2</b> HPC HQ Boundary Approach</a></li>
<li class="chapter" data-level="8.3.2.3" data-path=""><a href="#HpcHQFilter-4"><i class="fa fa-check"></i><b>8.3.2.3</b> HPC HQ Boundary Stability</a></li>
<li class="chapter" data-level="8.3.2.4" data-path=""><a href="#HpcBoundariesOther-4"><i class="fa fa-check"></i><b>8.3.2.4</b> HPC Additional Boundary Options</a></li>
<li class="chapter" data-level="8.3.2.5" data-path=""><a href="#HpcQuadtreeParallelInteria-4"><i class="fa fa-check"></i><b>8.3.2.5</b> Quadtree BC Parallel Inertia Approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path=""><a href="#OneDBoundaries-2"><i class="fa fa-check"></i><b>8.4</b> 1D Boundaries (1d_bc Layers)</a></li>
<li class="chapter" data-level="8.5" data-path=""><a href="#TwoDBoundaries-2"><i class="fa fa-check"></i><b>8.5</b> 2D Boundaries (2d_bc, 2d_sa and 2d_rf Layers)</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path=""><a href="#BC-Layers-3"><i class="fa fa-check"></i><b>8.5.1</b> Boundary Conditions (2d_bc)</a>
<ul>
<li class="chapter" data-level="8.5.1.1" data-path=""><a href="#id_2DBndSlopingLevel-3"><i class="fa fa-check"></i><b>8.5.1.1</b> Sloping Water Level Boundaries</a></li>
<li class="chapter" data-level="8.5.1.2" data-path=""><a href="#GT-4"><i class="fa fa-check"></i><b>8.5.1.2</b> Groundwater Boundaries</a></li>
</ul></li>
<li class="chapter" data-level="8.5.2" data-path=""><a href="#SA-Layers-3"><i class="fa fa-check"></i><b>8.5.2</b> Source Area Boundaries</a>
<ul>
<li class="chapter" data-level="8.5.2.1" data-path=""><a href="#SA-Option-4"><i class="fa fa-check"></i><b>8.5.2.1</b> Source Area Options (2d_sa)</a></li>
<li class="chapter" data-level="8.5.2.2" data-path=""><a href="#RFOption-4"><i class="fa fa-check"></i><b>8.5.2.2</b> Rainfall Option (2d_sa_rf)</a></li>
<li class="chapter" data-level="8.5.2.3" data-path=""><a href="#TriggerOption-4"><i class="fa fa-check"></i><b>8.5.2.3</b> Trigger Option (2d_sa_tr)</a></li>
<li class="chapter" data-level="8.5.2.4" data-path=""><a href="#FlowFeature-4"><i class="fa fa-check"></i><b>8.5.2.4</b> Flow Feature (2d_sa_po)</a></li>
<li class="chapter" data-level="8.5.2.5" data-path=""><a href="#OverlappingSA-4"><i class="fa fa-check"></i><b>8.5.2.5</b> Overlapping 2d_sa regions</a></li>
</ul></li>
<li class="chapter" data-level="8.5.3" data-path=""><a href="#Rainfall-3"><i class="fa fa-check"></i><b>8.5.3</b> Rainfall Boundaries</a>
<ul>
<li class="chapter" data-level="8.5.3.1" data-path=""><a href="#RainfallOverview-4"><i class="fa fa-check"></i><b>8.5.3.1</b> Rainfall Overview</a></li>
<li class="chapter" data-level="8.5.3.2" data-path=""><a href="#RainfallConsiderations-4"><i class="fa fa-check"></i><b>8.5.3.2</b> Considerations for Rainfall Modelling</a></li>
<li class="chapter" data-level="8.5.3.3" data-path=""><a href="#RF-Global-4"><i class="fa fa-check"></i><b>8.5.3.3</b> Global Rainfall</a></li>
<li class="chapter" data-level="8.5.3.4" data-path=""><a href="#RF-Layers-4"><i class="fa fa-check"></i><b>8.5.3.4</b> Rainfall Polygons (2d_rf)</a></li>
<li class="chapter" data-level="8.5.3.5" data-path=""><a href="#GriddedRainfall-4"><i class="fa fa-check"></i><b>8.5.3.5</b> Gridded Rainfall</a></li>
<li class="chapter" data-level="8.5.3.6" data-path=""><a href="#TRFC-File-4"><i class="fa fa-check"></i><b>8.5.3.6</b> Rainfall Control File (.trfc file)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path=""><a href="#bcdbase-2"><i class="fa fa-check"></i><b>8.6</b> Boundary Condition (BC) Database</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path=""><a href="#bcdbase-Example-3"><i class="fa fa-check"></i><b>8.6.1</b> BC Database Example</a></li>
<li class="chapter" data-level="8.6.2" data-path=""><a href="#BCEventName-3"><i class="fa fa-check"></i><b>8.6.2</b> BC Event Name Command</a></li>
<li class="chapter" data-level="8.6.3" data-path=""><a href="#BoundaryGenerators-3"><i class="fa fa-check"></i><b>8.6.3</b> TUFLOW Boundary Generators</a></li>
<li class="chapter" data-level="8.6.4" data-path=""><a href="#DelftFEWSBoundary-3"><i class="fa fa-check"></i><b>8.6.4</b> Delft FEWS Boundaries</a></li>
<li class="chapter" data-level="8.6.5" data-path=""><a href="#HECDSS-3"><i class="fa fa-check"></i><b>8.6.5</b> HEC-DSS Boundaries</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path=""><a href="#Cyclones-2"><i class="fa fa-check"></i><b>8.7</b> Cyclones / Hurricanes / Typhoons</a></li>
<li class="chapter" data-level="8.8" data-path=""><a href="#ExternalStress-2"><i class="fa fa-check"></i><b>8.8</b> External Stress Boundaries</a></li>
<li class="chapter" data-level="8.9" data-path=""><a href="#InitialConditions-2"><i class="fa fa-check"></i><b>8.9</b> Initial Conditions</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path=""><a href="#IWL-3"><i class="fa fa-check"></i><b>8.9.1</b> Initial Water Levels (IWL)</a>
<ul>
<li class="chapter" data-level="8.9.1.1" data-path=""><a href="#IWL-1D-4"><i class="fa fa-check"></i><b>8.9.1.1</b> 1D Domains</a></li>
<li class="chapter" data-level="8.9.1.2" data-path=""><a href="#IWL-2D-4"><i class="fa fa-check"></i><b>8.9.1.2</b> 2D Domains</a></li>
<li class="chapter" data-level="8.9.1.3" data-path=""><a href="#IWL-Auto-4"><i class="fa fa-check"></i><b>8.9.1.3</b> Automatic Initial Water Level</a></li>
</ul></li>
<li class="chapter" data-level="8.9.2" data-path=""><a href="#IGW-3"><i class="fa fa-check"></i><b>8.9.2</b> Initial Groundwater Levels</a></li>
<li class="chapter" data-level="8.9.3" data-path=""><a href="#RestartFiles-3"><i class="fa fa-check"></i><b>8.9.3</b> Restart Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path=""><a href="#AD-1"><i class="fa fa-check"></i><b>9</b> Advection Dispersion</a>
<ul>
<li class="chapter" data-level="9.1" data-path=""><a href="#AD-Overview-2"><i class="fa fa-check"></i><b>9.1</b> Overview</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path=""><a href="#AD-Solution-3"><i class="fa fa-check"></i><b>9.1.1</b> 2D Depth Averaged Equation of Motion</a></li>
<li class="chapter" data-level="9.1.2" data-path=""><a href="#AD-Solution-2"><i class="fa fa-check"></i><b>9.1.2</b> Solution Method (TUFLOW Classic)</a></li>
<li class="chapter" data-level="9.1.3" data-path=""><a href="#AD-Solution-HPC-3"><i class="fa fa-check"></i><b>9.1.3</b> Solution Method (TUFLOW HPC)</a></li>
<li class="chapter" data-level="9.1.4" data-path=""><a href="#local-constituent-transformation"><i class="fa fa-check"></i><b>9.1.4</b> Local Constituent Transformation</a></li>
<li class="chapter" data-level="9.1.5" data-path=""><a href="#groundwater"><i class="fa fa-check"></i><b>9.1.5</b> Groundwater</a></li>
<li class="chapter" data-level="9.1.6" data-path=""><a href="#limitations-and-recommendations"><i class="fa fa-check"></i><b>9.1.6</b> Limitations and Recommendations</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path=""><a href="#the-modelling-process"><i class="fa fa-check"></i><b>9.2</b> The Modelling Process</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path=""><a href="#data-input-requirements"><i class="fa fa-check"></i><b>9.2.1</b> Data Input Requirements</a></li>
<li class="chapter" data-level="9.2.2" data-path=""><a href="#calibration-and-sensitivity"><i class="fa fa-check"></i><b>9.2.2</b> Calibration and Sensitivity</a></li>
<li class="chapter" data-level="9.2.3" data-path=""><a href="#model-resolution"><i class="fa fa-check"></i><b>9.2.3</b> Model Resolution</a></li>
<li class="chapter" data-level="9.2.4" data-path=""><a href="#AD-Computational-Timestep-3"><i class="fa fa-check"></i><b>9.2.4</b> Computational Timestep</a></li>
<li class="chapter" data-level="9.2.5" data-path=""><a href="#example-ad-models"><i class="fa fa-check"></i><b>9.2.5</b> Example AD Models</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path=""><a href="#data-input"><i class="fa fa-check"></i><b>9.3</b> Data Input</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path=""><a href="#simulation-control-file"><i class="fa fa-check"></i><b>9.3.1</b> Simulation Control File</a>
<ul>
<li class="chapter" data-level="9.3.1.1" data-path=""><a href="#ADControlFile-4"><i class="fa fa-check"></i><b>9.3.1.1</b> TUFLOW AD Control File (.adcf File)</a></li>
<li class="chapter" data-level="9.3.1.2" data-path=""><a href="#AD-inputs-4"><i class="fa fa-check"></i><b>9.3.1.2</b> GIS Input File Types and Naming Conventions</a></li>
</ul></li>
<li class="chapter" data-level="9.3.2" data-path=""><a href="#d-geometries"><i class="fa fa-check"></i><b>9.3.2</b> 1D Geometries</a></li>
<li class="chapter" data-level="9.3.3" data-path=""><a href="#ADConstituentProp-3"><i class="fa fa-check"></i><b>9.3.3</b> Specification of Constituent Properties</a></li>
<li class="chapter" data-level="9.3.4" data-path=""><a href="#ADBoundaryConditions-3"><i class="fa fa-check"></i><b>9.3.4</b> Boundary Conditions</a>
<ul>
<li class="chapter" data-level="9.3.4.1" data-path=""><a href="#boundary-condition-bc-database"><i class="fa fa-check"></i><b>9.3.4.1</b> Boundary Condition (BC) Database</a></li>
<li class="chapter" data-level="9.3.4.2" data-path=""><a href="#bc-database-example"><i class="fa fa-check"></i><b>9.3.4.2</b> BC Database Example</a></li>
</ul></li>
<li class="chapter" data-level="9.3.5" data-path=""><a href="#initial-conditions"><i class="fa fa-check"></i><b>9.3.5</b> Initial Conditions</a></li>
<li class="chapter" data-level="9.3.6" data-path=""><a href="#GW-initial-conditions"><i class="fa fa-check"></i><b>9.3.6</b> Groundwater Initial Conditions</a></li>
<li class="chapter" data-level="9.3.7" data-path=""><a href="#minimum-dispersion-coefficient"><i class="fa fa-check"></i><b>9.3.7</b> Minimum Dispersion Coefficient</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path=""><a href="#data-output"><i class="fa fa-check"></i><b>9.4</b> Data Output</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path=""><a href="#tuflow-ad-log-files"><i class="fa fa-check"></i><b>9.4.1</b> TUFLOW AD Log Files</a>
<ul>
<li class="chapter" data-level="9.4.1.1" data-path=""><a href="#AD-log-4"><i class="fa fa-check"></i><b>9.4.1.1</b> Simulation Log File</a></li>
<li class="chapter" data-level="9.4.1.2" data-path=""><a href="#ADCFLLogFile-4"><i class="fa fa-check"></i><b>9.4.1.2</b> CFL Log File</a></li>
<li class="chapter" data-level="9.4.1.3" data-path=""><a href="#ADLogMass-4"><i class="fa fa-check"></i><b>9.4.1.3</b> Mass Log File</a></li>
</ul></li>
<li class="chapter" data-level="9.4.2" data-path=""><a href="#check-files"><i class="fa fa-check"></i><b>9.4.2</b> Check Files</a></li>
<li class="chapter" data-level="9.4.3" data-path=""><a href="#result-files"><i class="fa fa-check"></i><b>9.4.3</b> Result Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path=""><a href="#DomainLinking-1"><i class="fa fa-check"></i><b>10</b> Combining Domains and Solvers</a>
<ul>
<li class="chapter" data-level="10.1" data-path=""><a href="#Linked-1D2D-Models-Intro-2"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path=""><a href="#OneD2dLinking-2"><i class="fa fa-check"></i><b>10.2</b> 1D and 2D Domain Linking Theory</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path=""><a href="#HXBoundary-3"><i class="fa fa-check"></i><b>10.2.1</b> HX 2D Head Boundary</a></li>
<li class="chapter" data-level="10.2.2" data-path=""><a href="#SXBoundary-3"><i class="fa fa-check"></i><b>10.2.2</b> SX 2D Flow Boundary</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path=""><a href="#OneD2DLinking-Estry-2"><i class="fa fa-check"></i><b>10.3</b> TUFLOW 1D (ESTRY) to TUFLOW 2D Linking</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path=""><a href="#OneD2DESTRYChannel-3"><i class="fa fa-check"></i><b>10.3.1</b> 1D Open Channel and 2D Domain Linking</a></li>
<li class="chapter" data-level="10.3.2" data-path=""><a href="#OneD2DESTRYCulverts-3"><i class="fa fa-check"></i><b>10.3.2</b> 1D Structures Embedded within 2D Domains</a></li>
<li class="chapter" data-level="10.3.3" data-path=""><a href="#OneD2DESTRYPipeNetwork-3"><i class="fa fa-check"></i><b>10.3.3</b> 1D Pipe Network Pits linked to 2D Domains</a></li>
<li class="chapter" data-level="10.3.4" data-path=""><a href="#id_2DVirtualPits-3"><i class="fa fa-check"></i><b>10.3.4</b> Virtual Pits linked to 2D Domains</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path=""><a href="#OneD2DLinkingSWMM-2"><i class="fa fa-check"></i><b>10.4</b> SWMM to TUFLOW Linking</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path=""><a href="#OneD2DSWMMCulverts-5"><i class="fa fa-check"></i><b>10.4.1</b> 1D Culvert Connections to 2D Domains</a></li>
<li class="chapter" data-level="10.4.2" data-path=""><a href="#OneD2DSWMMPipeNetwork-3"><i class="fa fa-check"></i><b>10.4.2</b> 1D Pipe Network Connections to 2D Domains</a></li>
<li class="chapter" data-level="10.4.3" data-path=""><a href="#OneD2DLinkingSWMM1D-3"><i class="fa fa-check"></i><b>10.4.3</b> SWMM to TUFLOW 1D (ESTRY) Linking</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path=""><a href="#OneD2DLinkingFM-2"><i class="fa fa-check"></i><b>10.5</b> Flood Modeller to TUFLOW Linking</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path=""><a href="#oneD2DFMLinking2D-3"><i class="fa fa-check"></i><b>10.5.1</b> Flood Modeller 1D to TUFLOW 2D Linking</a></li>
<li class="chapter" data-level="10.5.2" data-path=""><a href="#oneD2DFMLinking1D-3"><i class="fa fa-check"></i><b>10.5.2</b> Flood Modeller 1D to TUFLOW 1D (ESTRY) Linking</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path=""><a href="#oneD2D12D-2"><i class="fa fa-check"></i><b>10.6</b> 12D-DDA to TUFLOW Linking</a></li>
<li class="chapter" data-level="10.7" data-path=""><a href="#TwoD2DLinking-2"><i class="fa fa-check"></i><b>10.7</b> Multiple 2D Domains</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path=""><a href="#TwoD2DLinkingQDT-3"><i class="fa fa-check"></i><b>10.7.1</b> Classic’s M2D Feature versus HPC Quadtree</a></li>
<li class="chapter" data-level="10.7.2" data-path=""><a href="#TwoD2DLinkingM2D-3"><i class="fa fa-check"></i><b>10.7.2</b> TUFLOW Classic’s Multiple 2D Domains</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path=""><a href="#Outputs-1"><i class="fa fa-check"></i><b>11</b> Outputs</a>
<ul>
<li class="chapter" data-level="11.1" data-path=""><a href="#Location-2"><i class="fa fa-check"></i><b>11.1</b> Output Location</a></li>
<li class="chapter" data-level="11.2" data-path=""><a href="#Map-2"><i class="fa fa-check"></i><b>11.2</b> Map Outputs</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path=""><a href="#TimeControl-3"><i class="fa fa-check"></i><b>11.2.1</b> Output Time Controls</a></li>
<li class="chapter" data-level="11.2.2" data-path=""><a href="#Format-3"><i class="fa fa-check"></i><b>11.2.2</b> Map Output Formats</a>
<ul>
<li class="chapter" data-level="11.2.2.1" data-path=""><a href="#MeshBased-4"><i class="fa fa-check"></i><b>11.2.2.1</b> Mesh Based Formats</a></li>
<li class="chapter" data-level="11.2.2.2" data-path=""><a href="#Grid-4"><i class="fa fa-check"></i><b>11.2.2.2</b> Grid Based Formats</a></li>
<li class="chapter" data-level="11.2.2.3" data-path=""><a href="#HRGrid-4"><i class="fa fa-check"></i><b>11.2.2.3</b> High-Resolution Grids</a></li>
<li class="chapter" data-level="11.2.2.4" data-path=""><a href="#Combined-4"><i class="fa fa-check"></i><b>11.2.2.4</b> Combined Format</a></li>
<li class="chapter" data-level="11.2.2.5" data-path=""><a href="#GISBased-4"><i class="fa fa-check"></i><b>11.2.2.5</b> GIS Based Format</a></li>
</ul></li>
<li class="chapter" data-level="11.2.3" data-path=""><a href="#DataTypes-3"><i class="fa fa-check"></i><b>11.2.3</b> Map Output Data Types</a>
<ul>
<li class="chapter" data-level="11.2.3.1" data-path=""><a href="#Hazards-4"><i class="fa fa-check"></i><b>11.2.3.1</b> Hazard Data Types</a></li>
</ul></li>
<li class="chapter" data-level="11.2.4" data-path=""><a href="#OneDMap-3"><i class="fa fa-check"></i><b>11.2.4</b> 1D Map Outputs</a>
<ul>
<li class="chapter" data-level="11.2.4.1" data-path=""><a href="#WLL-4"><i class="fa fa-check"></i><b>11.2.4.1</b> Water Level Lines</a></li>
<li class="chapter" data-level="11.2.4.2" data-path=""><a href="#WLLp-4"><i class="fa fa-check"></i><b>11.2.4.2</b> Water Level Line Points</a></li>
<li class="chapter" data-level="11.2.4.3" data-path=""><a href="#WLLtriangles-4"><i class="fa fa-check"></i><b>11.2.4.3</b> Adding Triangles into the 1d_WLL Layer</a></li>
</ul></li>
<li class="chapter" data-level="11.2.5" data-path=""><a href="#OutputZones-3"><i class="fa fa-check"></i><b>11.2.5</b> Output Zones</a></li>
<li class="chapter" data-level="11.2.6" data-path=""><a href="#GaugeLevel-3"><i class="fa fa-check"></i><b>11.2.6</b> Gauge Level Output</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path=""><a href="#TimeSeries-2"><i class="fa fa-check"></i><b>11.3</b> Time-Series Outputs</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path=""><a href="#OneDTS-3"><i class="fa fa-check"></i><b>11.3.1</b> 1D Time-Series Output</a></li>
<li class="chapter" data-level="11.3.2" data-path=""><a href="#TwoDTS-3"><i class="fa fa-check"></i><b>11.3.2</b> 2D Time-Series Output</a>
<ul>
<li class="chapter" data-level="11.3.2.1" data-path=""><a href="#PlotOutput-4"><i class="fa fa-check"></i><b>11.3.2.1</b> Plot Output</a></li>
<li class="chapter" data-level="11.3.2.2" data-path=""><a href="#LongProfile-4"><i class="fa fa-check"></i><b>11.3.2.2</b> Long Profile Output</a></li>
</ul></li>
<li class="chapter" data-level="11.3.3" data-path=""><a href="#ReportingLocation-3"><i class="fa fa-check"></i><b>11.3.3</b> Reporting Locations</a></li>
<li class="chapter" data-level="11.3.4" data-path=""><a href="#Structure-3"><i class="fa fa-check"></i><b>11.3.4</b> Structure Output</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path=""><a href="#Specialised-2"><i class="fa fa-check"></i><b>11.4</b> Specialised Outputs</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path=""><a href="#Receptors-3"><i class="fa fa-check"></i><b>11.4.1</b> Receptors</a></li>
<li class="chapter" data-level="11.4.2" data-path=""><a href="#EvaculationRoutes-3"><i class="fa fa-check"></i><b>11.4.2</b> Evacuation Routes</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path=""><a href="#ChecksLogs-2"><i class="fa fa-check"></i><b>11.5</b> Check and Log Files</a></li>
<li class="chapter" data-level="11.6" data-path=""><a href="#Commands-2"><i class="fa fa-check"></i><b>11.6</b> Output Control Commands</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path=""><a href="#Hardware-1"><i class="fa fa-check"></i><b>12</b> Hardware and Operating System</a>
<ul>
<li class="chapter" data-level="12.1" data-path=""><a href="#HardwareIntro-2"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path=""><a href="#OperatingSystems-2"><i class="fa fa-check"></i><b>12.2</b> Operating Systems</a></li>
<li class="chapter" data-level="12.3" data-path=""><a href="#TUFLOWClassic-2"><i class="fa fa-check"></i><b>12.3</b> TUFLOW Classic</a></li>
<li class="chapter" data-level="12.4" data-path=""><a href="#TUFLOWHPC-2"><i class="fa fa-check"></i><b>12.4</b> TUFLOW HPC (Including Quadtree)</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path=""><a href="#HPC-CPU-3"><i class="fa fa-check"></i><b>12.4.1</b> TUFLOW HPC Solver on CPU</a></li>
<li class="chapter" data-level="12.4.2" data-path=""><a href="#HPC-GPU-3"><i class="fa fa-check"></i><b>12.4.2</b> TUFLOW HPC Solver on GPU</a></li>
<li class="chapter" data-level="12.4.3" data-path=""><a href="#GPUTypes-3"><i class="fa fa-check"></i><b>12.4.3</b> Types of GPU</a></li>
<li class="chapter" data-level="12.4.4" data-path=""><a href="#MultipleGPUs-3"><i class="fa fa-check"></i><b>12.4.4</b> Utilising Multiple GPUs for One Model</a></li>
<li class="chapter" data-level="12.4.5" data-path=""><a href="#MultipleModelsoneGPU-3"><i class="fa fa-check"></i><b>12.4.5</b> Running Multiple Models on a Single GPU</a></li>
<li class="chapter" data-level="12.4.6" data-path=""><a href="#differences-in-results-between-cpu-and-gpu"><i class="fa fa-check"></i><b>12.4.6</b> Differences in results between CPU and GPU</a></li>
<li class="chapter" data-level="12.4.7" data-path=""><a href="#HPCRAM-3"><i class="fa fa-check"></i><b>12.4.7</b> RAM</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path=""><a href="#ProxiesforCPUandGPU-2"><i class="fa fa-check"></i><b>12.5</b> Proxies for CPU and GPU performance</a></li>
<li class="chapter" data-level="12.6" data-path=""><a href="#Virtualisation-2"><i class="fa fa-check"></i><b>12.6</b> Virtualisation</a></li>
<li class="chapter" data-level="12.7" data-path=""><a href="#CloudCompute-2"><i class="fa fa-check"></i><b>12.7</b> Cloud Compute</a></li>
<li class="chapter" data-level="12.8" data-path=""><a href="#HardwareCommands-2"><i class="fa fa-check"></i><b>12.8</b> Commands</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path=""><a href="#Running-Simulations-1"><i class="fa fa-check"></i><b>13</b> Managing and Starting Simulations</a>
<ul>
<li class="chapter" data-level="13.1" data-path=""><a href="#RunningSimulationsIntro-2"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path=""><a href="#FileNaming-2"><i class="fa fa-check"></i><b>13.2</b> File Naming</a></li>
<li class="chapter" data-level="13.3" data-path=""><a href="#SimulationManagement-2"><i class="fa fa-check"></i><b>13.3</b> Simulation Management</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path=""><a href="#Events-3"><i class="fa fa-check"></i><b>13.3.1</b> Events</a></li>
<li class="chapter" data-level="13.3.2" data-path=""><a href="#Scenarios-3"><i class="fa fa-check"></i><b>13.3.2</b> Scenarios</a></li>
<li class="chapter" data-level="13.3.3" data-path=""><a href="#Variables-3"><i class="fa fa-check"></i><b>13.3.3</b> Variables</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path=""><a href="#TUFLOWExecDownload-2"><i class="fa fa-check"></i><b>13.4</b> TUFLOW Executable Download</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path=""><a href="#InstallOverview-3"><i class="fa fa-check"></i><b>13.4.1</b> Overview and Where to Install</a></li>
<li class="chapter" data-level="13.4.2" data-path=""><a href="#iSPdSP-3"><i class="fa fa-check"></i><b>13.4.2</b> Single and Double Precision</a>
<ul>
<li class="chapter" data-level="13.4.2.1" data-path=""><a href="#iSPdSP-Classic"><i class="fa fa-check"></i><b>13.4.2.1</b> TUFLOW Classic</a></li>
<li class="chapter" data-level="13.4.2.2" data-path=""><a href="#iSPdSP-HPC"><i class="fa fa-check"></i><b>13.4.2.2</b> TUFLOW HPC</a></li>
</ul></li>
<li class="chapter" data-level="13.4.3" data-path=""><a href="#CustomingTUFLOW-3"><i class="fa fa-check"></i><b>13.4.3</b> Customising TUFLOW using TUFLOW_USER_DEFINED.dll</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path=""><a href="#RunningSims-2"><i class="fa fa-check"></i><b>13.5</b> Running Simulations</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path=""><a href="#DongleTypesandSetup-3"><i class="fa fa-check"></i><b>13.5.1</b> Dongle Types and Setup</a>
<ul>
<li class="chapter" data-level="13.5.1.1" data-path=""><a href="#DongleAccessProtocols-4"><i class="fa fa-check"></i><b>13.5.1.1</b> Protocols for Accessing Dongles</a></li>
<li class="chapter" data-level="13.5.1.2" data-path=""><a href="#DongleSettingsFile-4"><i class="fa fa-check"></i><b>13.5.1.2</b> TUFLOW_Licence_Settings.lcf File</a></li>
<li class="chapter" data-level="13.5.1.3" data-path=""><a href="#DongleFailure-4"><i class="fa fa-check"></i><b>13.5.1.3</b> Dongle Failure during a Simulation</a></li>
</ul></li>
<li class="chapter" data-level="13.5.2" data-path=""><a href="#StartingaSim-3"><i class="fa fa-check"></i><b>13.5.2</b> Starting a Simulation</a>
<ul>
<li class="chapter" data-level="13.5.2.1" data-path=""><a href="#BatchFileExamples-4"><i class="fa fa-check"></i><b>13.5.2.1</b> Batch File Example and Run Options (Switches)</a></li>
<li class="chapter" data-level="13.5.2.2" data-path=""><a href="#CopyModelBatchFiles-4"><i class="fa fa-check"></i><b>13.5.2.2</b> Copy/Package Model from Batch Files</a></li>
<li class="chapter" data-level="13.5.2.3" data-path=""><a href="#AdvancedBatchFiles-4"><i class="fa fa-check"></i><b>13.5.2.3</b> Advanced Batch Files</a></li>
</ul></li>
<li class="chapter" data-level="13.5.3" data-path=""><a href="#RunningHPC-3"><i class="fa fa-check"></i><b>13.5.3</b> Running TUFLOW HPC</a>
<ul>
<li class="chapter" data-level="13.5.3.1" data-path=""><a href="#HPCGPUCommands-4"><i class="fa fa-check"></i><b>13.5.3.1</b> TUFLOW HPC and GPU Module Commands</a></li>
<li class="chapter" data-level="13.5.3.2" data-path=""><a href="#GPUCompatibility-4"><i class="fa fa-check"></i><b>13.5.3.2</b> Compatible Graphics Cards</a></li>
<li class="chapter" data-level="13.5.3.3" data-path=""><a href="#UpdatingGPUDrivers-4"><i class="fa fa-check"></i><b>13.5.3.3</b> Updating NVIDIA Drivers</a></li>
<li class="chapter" data-level="13.5.3.4" data-path=""><a href="#GPUNVLink-4"><i class="fa fa-check"></i><b>13.5.3.4</b> NVLink – Multi-GPU Performance (HPC Only)</a></li>
<li class="chapter" data-level="13.5.3.5" data-path=""><a href="#GPUTroubleshooting-4"><i class="fa fa-check"></i><b>13.5.3.5</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="13.5.4" data-path=""><a href="#Running1D-3"><i class="fa fa-check"></i><b>13.5.4</b> Running TUFLOW 1D Only Simulations</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path=""><a href="#TUFLOWExternalSchemes-2"><i class="fa fa-check"></i><b>13.6</b> Using TUFLOW with Flood Modeller, SWMM, XP-SWMM, 12D or from SMS</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path=""><a href="#SWMMSimulations-3"><i class="fa fa-check"></i><b>13.6.1</b> Using TUFLOW with EPA SWMM</a></li>
<li class="chapter" data-level="13.6.2" data-path=""><a href="#FMSimulations-3"><i class="fa fa-check"></i><b>13.6.2</b> Using TUFLOW with Flood Modeller</a></li>
<li class="chapter" data-level="13.6.3" data-path=""><a href="#TwelveDSimulations-3"><i class="fa fa-check"></i><b>13.6.3</b> Using TUFLOW with 12D</a></li>
<li class="chapter" data-level="13.6.4" data-path=""><a href="#XPSWMMSimulations-3"><i class="fa fa-check"></i><b>13.6.4</b> Using TUFLOW with XP-SWMM</a></li>
<li class="chapter" data-level="13.6.5" data-path=""><a href="#SMSSimulations-3"><i class="fa fa-check"></i><b>13.6.5</b> Using TUFLOW with SMS</a></li>
<li class="chapter" data-level="13.6.6" data-path=""><a href="#OptimisingSims-3"><i class="fa fa-check"></i><b>13.6.6</b> Optimising Startup and Run Times</a>
<ul>
<li class="chapter" data-level="13.6.6.1" data-path=""><a href="#Improved1DInputs-4"><i class="fa fa-check"></i><b>13.6.6.1</b> Improved pre-processing of 1D Model Inputs</a></li>
<li class="chapter" data-level="13.6.6.2" data-path=""><a href="#SGSParallelProcessing-4"><i class="fa fa-check"></i><b>13.6.6.2</b> Parallel Processing for SGS initialisation</a></li>
<li class="chapter" data-level="13.6.6.3" data-path=""><a href="#OptimisingMultiGPUPerformance-4"><i class="fa fa-check"></i><b>13.6.6.3</b> Optimising Multi-GPU Performance (HPC Only)</a></li>
</ul></li>
<li class="chapter" data-level="13.6.7" data-path=""><a href="#AutoTerminateOptions-3"><i class="fa fa-check"></i><b>13.6.7</b> Auto Terminate (Simulation End) Options</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path=""><a href="#ResultsReplication-3"><i class="fa fa-check"></i><b>13.7</b> Reproducibility of Results</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path=""><a href="#ResultsReplicationClassic-3"><i class="fa fa-check"></i><b>13.7.1</b> TUFLOW Classic (CPU only)</a></li>
<li class="chapter" data-level="13.7.2" data-path=""><a href="#ResultsReplicationHPCCPU-3"><i class="fa fa-check"></i><b>13.7.2</b> TUFLOW HPC (incl. Quadtree) on CPU</a></li>
<li class="chapter" data-level="13.7.3" data-path=""><a href="#ResultsReplicationHPCGPU-3"><i class="fa fa-check"></i><b>13.7.3</b> TUFLOW HPC (incl. Quadtree) on GPU</a></li>
<li class="chapter" data-level="13.7.4" data-path=""><a href="#ResultsReplicationHPCMultiThread-3"><i class="fa fa-check"></i><b>13.7.4</b> TUFLOW HPC (incl. Quadtree) on multiple GPUs / CPU threads</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path=""><a href="#Checks-and-Logs-1"><i class="fa fa-check"></i><b>14</b> Checks and Log Files</a>
<ul>
<li class="chapter" data-level="14.1" data-path=""><a href="#Log-Introduction-1"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path=""><a href="#ConsoleDisplay-2"><i class="fa fa-check"></i><b>14.2</b> Console (DOS) Window Display</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path=""><a href="#Classic-3"><i class="fa fa-check"></i><b>14.2.1</b> TUFLOW Classic</a></li>
<li class="chapter" data-level="14.2.2" data-path=""><a href="#HPC-3"><i class="fa fa-check"></i><b>14.2.2</b> TUFLOW HPC</a></li>
<li class="chapter" data-level="14.2.3" data-path=""><a href="#ConsoleDisappear-3"><i class="fa fa-check"></i><b>14.2.3</b> The Console (DOS) Window Does Not Appear</a></li>
<li class="chapter" data-level="14.2.4" data-path=""><a href="#QuickEdit-3"><i class="fa fa-check"></i><b>14.2.4</b> Unexpected Simulation Pause (DOS Quick Edit Mode)</a></li>
<li class="chapter" data-level="14.2.5" data-path=""><a href="#ConsoleShortcut-3"><i class="fa fa-check"></i><b>14.2.5</b> Stopping the Console Window</a></li>
<li class="chapter" data-level="14.2.6" data-path=""><a href="#ConsoleCustomisation-3"><i class="fa fa-check"></i><b>14.2.6</b> Customisation of Console Window</a></li>
<li class="chapter" data-level="14.2.7" data-path=""><a href="#ErrorLevel-3"><i class="fa fa-check"></i><b>14.2.7</b> TUFLOW Windows ERROR LEVEL Reporting</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path=""><a href="#MessageBox-2"><i class="fa fa-check"></i><b>14.3</b> Message Boxes</a></li>
<li class="chapter" data-level="14.4" data-path=""><a href="#SimLog-2"><i class="fa fa-check"></i><b>14.4</b> Simulations .log</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path=""><a href="#LocalLog-3"><i class="fa fa-check"></i><b>14.4.1</b> Local .log File</a></li>
<li class="chapter" data-level="14.4.2" data-path=""><a href="#GlobalLog-3"><i class="fa fa-check"></i><b>14.4.2</b> Global .log File</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path=""><a href="#SimLogFiles-2"><i class="fa fa-check"></i><b>14.5</b> Simulation Log Files</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path=""><a href="#TLF-3"><i class="fa fa-check"></i><b>14.5.1</b> TLF</a>
<ul>
<li class="chapter" data-level="14.5.1.1" data-path=""><a href="#HPCTLF-4"><i class="fa fa-check"></i><b>14.5.1.1</b> HPC TLF and DT</a></li>
</ul></li>
<li class="chapter" data-level="14.5.2" data-path=""><a href="#TSF-3"><i class="fa fa-check"></i><b>14.5.2</b> TSF</a></li>
<li class="chapter" data-level="14.5.3" data-path=""><a href="#start-stats-3"><i class="fa fa-check"></i><b>14.5.3</b> Start Stats</a></li>
<li class="chapter" data-level="14.5.4" data-path=""><a href="#run-stats-3"><i class="fa fa-check"></i><b>14.5.4</b> Run Stats</a></li>
<li class="chapter" data-level="14.5.5" data-path=""><a href="#Messages-3"><i class="fa fa-check"></i><b>14.5.5</b> Messages</a></li>
<li class="chapter" data-level="14.5.6" data-path=""><a href="#Workspaces-2"><i class="fa fa-check"></i><b>14.5.6</b> GIS Workspaces</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path=""><a href="#EOF-2"><i class="fa fa-check"></i><b>14.6</b> 1D Output File</a></li>
<li class="chapter" data-level="14.7" data-path=""><a href="#CheckLayers-2"><i class="fa fa-check"></i><b>14.7</b> Check Files</a></li>
<li class="chapter" data-level="14.8" data-path=""><a href="#MB-2"><i class="fa fa-check"></i><b>14.8</b> Mass Balance Output</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path=""><a href="#OneD-MB-3"><i class="fa fa-check"></i><b>14.8.1</b> TUFLOW 1D Mass Balance</a></li>
<li class="chapter" data-level="14.8.2" data-path=""><a href="#MB-CLA-3"><i class="fa fa-check"></i><b>14.8.2</b> TUFLOW Classic Mass Balance</a></li>
<li class="chapter" data-level="14.8.3" data-path=""><a href="#MB-HPC-3"><i class="fa fa-check"></i><b>14.8.3</b> TUFLOW HPC Mass Balance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path=""><a href="#Viewing-Output-1"><i class="fa fa-check"></i><b>15</b> Viewing Outputs</a>
<ul>
<li class="chapter" data-level="15.1" data-path=""><a href="#Introduction-Viewing-2"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path=""><a href="#Output-Folder-2"><i class="fa fa-check"></i><b>15.2</b> Folder Structure</a></li>
<li class="chapter" data-level="15.3" data-path=""><a href="#view-1D-2"><i class="fa fa-check"></i><b>15.3</b> 1D Output</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path=""><a href="#view-tpc-3"><i class="fa fa-check"></i><b>15.3.1</b> TUFLOW Plot Control file (TPC)</a></li>
<li class="chapter" data-level="15.3.2" data-path=""><a href="#mm-4"><i class="fa fa-check"></i><b>15.3.2</b> Maximum and Minimum Output</a></li>
<li class="chapter" data-level="15.3.3" data-path=""><a href="#ccA-4"><i class="fa fa-check"></i><b>15.3.3</b> ccA GIS Layer</a></li>
<li class="chapter" data-level="15.3.4" data-path=""><a href="#TS-GIS-3"><i class="fa fa-check"></i><b>15.3.4</b> _TS GIS Layer</a></li>
<li class="chapter" data-level="15.3.5" data-path=""><a href="#Viewing-WLL-4"><i class="fa fa-check"></i><b>15.3.5</b> 1D Water Level Lines (WLL)</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path=""><a href="#view-2D-2"><i class="fa fa-check"></i><b>15.4</b> 2D Output</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path=""><a href="#view-mesh-3"><i class="fa fa-check"></i><b>15.4.1</b> Mesh Output</a></li>
<li class="chapter" data-level="15.4.2" data-path=""><a href="#view-raster-3"><i class="fa fa-check"></i><b>15.4.2</b> Raster Output</a></li>
<li class="chapter" data-level="15.4.3" data-path=""><a href="#View-PO-3"><i class="fa fa-check"></i><b>15.4.3</b> Plot Output</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path=""><a href="#Post-Process-2"><i class="fa fa-check"></i><b>15.5</b> Post Processing</a></li>
<li class="chapter" data-level="15.6" data-path=""><a href="#Impact-Map-2"><i class="fa fa-check"></i><b>15.6</b> Impact Mapping</a></li>
<li class="chapter" data-level="15.7" data-path=""><a href="#Animations-2"><i class="fa fa-check"></i><b>15.7</b> Animations</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path=""><a href="#QualityControl-and-Troubleshooting-1"><i class="fa fa-check"></i><b>16</b> Quality Control and Troubleshooting</a>
<ul>
<li class="chapter" data-level="16.1" data-path=""><a href="#QAIntroduction-2"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path=""><a href="#ModelHealth-2"><i class="fa fa-check"></i><b>16.2</b> Model Health</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path=""><a href="#TUFLOWClassicModelHealth-3"><i class="fa fa-check"></i><b>16.2.1</b> TUFLOW Classic</a>
<ul>
<li class="chapter" data-level="16.2.1.1" data-path=""><a href="#TUFLOWClassicTimestep-4"><i class="fa fa-check"></i><b>16.2.1.1</b> Timestep</a></li>
</ul></li>
<li class="chapter" data-level="16.2.2" data-path=""><a href="#TUFLOWHPCModelHealth-3"><i class="fa fa-check"></i><b>16.2.2</b> TUFLOW HPC</a>
<ul>
<li class="chapter" data-level="16.2.2.1" data-path=""><a href="#TUFLOWHPCTimestep-4"><i class="fa fa-check"></i><b>16.2.2.1</b> Timestep</a></li>
</ul></li>
<li class="chapter" data-level="16.2.3" data-path=""><a href="#TUFLOWQAIndicators-3"><i class="fa fa-check"></i><b>16.2.3</b> Healthy Model Indicators</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path=""><a href="#QATroubleshooting-2"><i class="fa fa-check"></i><b>16.3</b> Troubleshooting</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path=""><a href="#QAGeneralComments-3"><i class="fa fa-check"></i><b>16.3.1</b> General Comments</a></li>
<li class="chapter" data-level="16.3.2" data-path=""><a href="#tuflowinstability-3"><i class="fa fa-check"></i><b>16.3.2</b> Instability Identification</a>
<ul>
<li class="chapter" data-level="16.3.2.1" data-path=""><a href="#onedinstability-4"><i class="fa fa-check"></i><b>16.3.2.1</b> 1D (ESTRY) Domains</a></li>
<li class="chapter" data-level="16.3.2.2" data-path=""><a href="#ClassicInstability-4"><i class="fa fa-check"></i><b>16.3.2.2</b> TUFLOW Classic</a></li>
<li class="chapter" data-level="16.3.2.3" data-path=""><a href="#HPCInstability-4"><i class="fa fa-check"></i><b>16.3.2.3</b> TUFLOW HPC</a></li>
<li class="chapter" data-level="16.3.2.4" data-path=""><a href="#onedtwodinstability-4"><i class="fa fa-check"></i><b>16.3.2.4</b> 1D/2D Links</a></li>
<li class="chapter" data-level="16.3.2.5" data-path=""><a href="#othertroublshooting-4"><i class="fa fa-check"></i><b>16.3.2.5</b> Other General Troubleshooting Recommendations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path=""><a href="#QAchecklist-2"><i class="fa fa-check"></i><b>16.4</b> QA Check List and Simulation Logging</a></li>
<li class="chapter" data-level="16.5" data-path=""><a href="#ExceedingRAM-2"><i class="fa fa-check"></i><b>16.5</b> Models Exceeding Hardware RAM</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path=""><a href="#ComputerRAM-3"><i class="fa fa-check"></i><b>16.5.1</b> Computer RAM</a></li>
<li class="chapter" data-level="16.5.2" data-path=""><a href="#TUFLOWVersion-3"><i class="fa fa-check"></i><b>16.5.2</b> TUFLOW Version</a></li>
<li class="chapter" data-level="16.5.3" data-path=""><a href="#QAmodeldesign-3"><i class="fa fa-check"></i><b>16.5.3</b> Model Design</a></li>
<li class="chapter" data-level="16.5.4" data-path=""><a href="#memoryusage-3"><i class="fa fa-check"></i><b>16.5.4</b> Memory Usage Reporting</a></li>
<li class="chapter" data-level="16.5.5" data-path=""><a href="#tempmemoryusage-3"><i class="fa fa-check"></i><b>16.5.5</b> Temporary Memory Usage</a></li>
<li class="chapter" data-level="16.5.6" data-path=""><a href="#GPURAM-3"><i class="fa fa-check"></i><b>16.5.6</b> TUFLOW HPC GPU Module and RAM requirements</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path=""><a href="#backwardcompatibility-2"><i class="fa fa-check"></i><b>16.6</b> Past Release Version Backward Compatibility</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path=""><a href="#Utilities-1"><i class="fa fa-check"></i><b>17</b> Utilities</a>
<ul>
<li class="chapter" data-level="17.1" data-path=""><a href="#Util-Introduction-2"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path=""><a href="#GIS-Utilities-2"><i class="fa fa-check"></i><b>17.2</b> GIS Based Utilities</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path=""><a href="#QGIS-Plugin-3"><i class="fa fa-check"></i><b>17.2.1</b> QGIS TUFLOW Plugin</a></li>
<li class="chapter" data-level="17.2.2" data-path=""><a href="#ArcGIS-Toolbar-3"><i class="fa fa-check"></i><b>17.2.2</b> ArcGIS Pro Toolbar</a></li>
<li class="chapter" data-level="17.2.3" data-path=""><a href="#ArcMap-Toolbox-3"><i class="fa fa-check"></i><b>17.2.3</b> ArcMap Toolbox</a></li>
<li class="chapter" data-level="17.2.4" data-path=""><a href="#MiTools-3"><i class="fa fa-check"></i><b>17.2.4</b> MiTools</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path=""><a href="#Console-2"><i class="fa fa-check"></i><b>17.3</b> Console Utilities</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path=""><a href="#Processing-Utilites-3"><i class="fa fa-check"></i><b>17.3.1</b> Pre and Post Processing</a></li>
<li class="chapter" data-level="17.3.2" data-path=""><a href="#Convert-Utilties-3"><i class="fa fa-check"></i><b>17.3.2</b> Convert to TUFLOW</a></li>
<li class="chapter" data-level="17.3.3" data-path=""><a href="#Syntax-Highlighting-3"><i class="fa fa-check"></i><b>17.3.3</b> Textfile Syntax Highlighting</a></li>
<li class="chapter" data-level="17.3.4" data-path=""><a href="#PyTUFLOW-3"><i class="fa fa-check"></i><b>17.3.4</b> PyTUFLOW</a></li>
<li class="chapter" data-level="17.3.5" data-path=""><a href="#Excel-3"><i class="fa fa-check"></i><b>17.3.5</b> Excel Macros</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path=""><a href="#Features-and-Changes-1"><i class="fa fa-check"></i><b>18</b> Changelog</a>
<ul>
<li class="chapter" data-level="18.1" data-path=""><a href="#changelog-202411"><i class="fa fa-check"></i><b>18.1</b> 2024.1.1 Changelog</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path=""><a href="#NF"><i class="fa fa-check"></i><b>18.1.1</b> New Features</a></li>
<li class="chapter" data-level="18.1.2" data-path=""><a href="#Enhancement"><i class="fa fa-check"></i><b>18.1.2</b> Enhancements</a></li>
<li class="chapter" data-level="18.1.3" data-path=""><a href="#BF"><i class="fa fa-check"></i><b>18.1.3</b> Bug Fixes</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path=""><a href="#default-changes"><i class="fa fa-check"></i><b>18.2</b> Default Changes</a></li>
<li class="chapter" data-level="18.3" data-path=""><a href="#changes-pre-2023"><i class="fa fa-check"></i><b>18.3</b> Pre 2023-03 Release</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#appendix-appendix"><i class="fa fa-check"></i>(APPENDIX) Appendix</a></li>
<li class="chapter" data-level="19" data-path=""><a href="#TCFCommands-1"><i class="fa fa-check"></i><b>19</b> TCF Commands</a></li>
<li class="chapter" data-level="20" data-path=""><a href="#ECFCommands-1"><i class="fa fa-check"></i><b>20</b> ECF Commands</a></li>
<li class="chapter" data-level="21" data-path=""><a href="#TGCCommands-1"><i class="fa fa-check"></i><b>21</b> TGC Commands</a></li>
<li class="chapter" data-level="22" data-path=""><a href="#TBCCommands-1"><i class="fa fa-check"></i><b>22</b> TBC Commands</a></li>
<li class="chapter" data-level="23" data-path=""><a href="#TOCCommands-1"><i class="fa fa-check"></i><b>23</b> TOC Commands</a></li>
<li class="chapter" data-level="24" data-path=""><a href="#TRFCCommands-1"><i class="fa fa-check"></i><b>24</b> TRFC Commands</a></li>
<li class="chapter" data-level="25" data-path=""><a href="#TESFCommands-1"><i class="fa fa-check"></i><b>25</b> TESF Commands</a></li>
<li class="chapter" data-level="26" data-path=""><a href="#QCFCommands-1"><i class="fa fa-check"></i><b>26</b> QCF Commands</a></li>
<li class="chapter" data-level="27" data-path=""><a href="#TSCFCommands-1"><i class="fa fa-check"></i><b>27</b> TSCF Commands</a></li>
<li class="chapter" data-level="28" data-path=""><a href="#ADCFCommands-1"><i class="fa fa-check"></i><b>28</b> ADCF Commands</a></li>
<li class="chapter" data-level="29" data-path=""><a href="#TEFCommands-1"><i class="fa fa-check"></i><b>29</b> TEF Commands</a></li>
<li class="chapter" data-level="30" data-path=""><a href="#SWMMGeopackage-1"><i class="fa fa-check"></i><b>30</b> SWMM GeoPackage Format</a>
<ul>
<li class="chapter" data-level="30.1" data-path=""><a href="#swmm-geopackage-layer-list"><i class="fa fa-check"></i><b>30.1</b> SWMM GeoPackage Layer List</a></li>
<li class="chapter" data-level="30.2" data-path=""><a href="#swmm-geopackage-layer-descriptions"><i class="fa fa-check"></i><b>30.2</b> SWMM GeoPackage Layer Descriptions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#references"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://docs.tuflow.com/classic-hpc/manual/2023-03/"><img src="images/WQFooter.jpg" style="width:246px;height:10px;"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><h0 style="color:rgb(0,85,129);">TUFLOW Classic/HPC User Manual 2024</h0></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title"><h0 style="color:rgb(0,85,129);">TUFLOW Classic/HPC User Manual 2024</h0></h1>
<p class="author"><em></em></p>
<p class="date"><em>Updated on 16 Oct 2024</em></p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                      <span class="at">message =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                      <span class="at">echo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:kableExtra&#39;:
## 
##     group_rows</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ──────── tidyverse 2.0.0 ──
## ✔ forcats   1.0.0     ✔ stringr   1.5.0
## ✔ lubridate 1.9.2     ✔ tibble    3.2.1
## ✔ purrr     1.0.2     ✔ tidyr     1.3.0
## ✔ readr     2.1.4</code></pre>
<pre><code>## ── Conflicts ────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter()     masks plotly::filter(), stats::filter()
## ✖ dplyr::group_rows() masks kableExtra::group_rows()
## ✖ dplyr::lag()        masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;igraph&#39;
## 
## The following objects are masked from &#39;package:lubridate&#39;:
## 
##     %--%, union
## 
## The following objects are masked from &#39;package:purrr&#39;:
## 
##     compose, simplify
## 
## The following object is masked from &#39;package:tidyr&#39;:
## 
##     crossing
## 
## The following object is masked from &#39;package:tibble&#39;:
## 
##     as_data_frame
## 
## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     as_data_frame, groups, union
## 
## The following object is masked from &#39;package:plotly&#39;:
## 
##     groups
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     decompose, spectrum
## 
## The following object is masked from &#39;package:base&#39;:
## 
##     union</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">require</span>(visNetwork, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<h1 class="unnumbered" id="section"></h1>
<!-- Set video speed -->
<body onload="setPlaySpeed()">
<!-- lists all commands in table-->
<div style="columns: 3;">
<div>
<p><a href="https://tuflow.com">www.tuflow.com</a><br />
<a href="https://wiki.tuflow.com/Main_Page">TUFLOW Wiki</a><br />
<a href="https://wiki.tuflow.com/Tutorial_Introduction">TUFLOW Tutorial Models</a><br />
<a href="mailto:support@tuflow.com">support@tuflow.com</a></p>
</div>
<div>
<p><a href="#how-to-use-this-manual">How to Use This Manual</a><br />
<a href="#list-of-figures">List of Figures</a><br />
<a href="#list-of-tables">List of Tables</a><br />
<a href="#Features-and-Changes-1">Changelog</a></p>
</div>
<div>
<p><a href="#TCFCommands-1">.tcf Commands</a><br />
<a href="#ECFCommands-1">.ecf Commands</a><br />
<a href="#TGCCommands-1">.tgc Commands</a><br />
<a href="#TBCCommands-1">.tbc Commands</a></p>
</div>
</div>
<p><br></p>
<p><img src="images/TUFLOW_wide.png" width="95%" style="display: block; margin: auto auto auto 0;" /></p>
<p><br></p>
<center>
<video  style='border: 2px ridge #00B0F0;' width = "850" autoplay loop muted id="myVideo">
<source src="videos/Tuflow_manual_depth_urban_003_sml.mp4" type="video/mp4">
</video>
</center>
<script>
var vid = document.getElementById("myVideo");
function setPlaySpeed() { 
  vid.playbackRate = 2.0;
} 
</script>
<h1 class="unnumbered hasAnchor" id="overview">Overview<a href="#overview" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="unnumbered hasAnchor" id="how-to-use-this-manual">How to use this Manual<a href="#how-to-use-this-manual" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Instructions are provided below on how to use this manual, including aspects of navigation and searching. These instructions are not provided elsewhere.</p>
<h3 class="unnumbered hasAnchor" id="navigation">Navigation<a href="#navigation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This manual is designed for digital use within any web browser and has the following features:</p>
<ul>
<li>Section headers, to level three, are directly navigable via the left hand pane’s table of contents. This table of contents pane can be toggled on and off from view via the “s” key if more or less page width is required.</li>
<li>The angled arrows that float at the left and right hand side midpoints of every page can be used to navigate sequentially back and forth to the commencement of preceding or subsequent top level sections.</li>
<li>Control file commands and cross references for tables and figures are navigable through hyperlinks, where appropriate. Control file commands are listed at the end of the Manual from Appendix <a href="#TCFCommands-1"><strong>??</strong></a> to Appendix <a href="#TEFCommands-1"><strong>??</strong></a>.</li>
<li>The space bar can be used to scroll down within each page without skipping text. Shift + space bar will similarly scroll up.</li>
<li>Browser back and forward buttons (or their equivalent keyboard shortcuts alt + <span class="math inline">\(\langle\)</span>left arrow<span class="math inline">\(\rangle\)</span> and alt + <span class="math inline">\(\langle\)</span>right arrow<span class="math inline">\(\rangle\)</span>) can be used to navigate through browsing history. Some browsers may not return to the scroll location in a page last visited, but to the last clicked section header. Hyperlinks have been built into the body of the manual, and these can be used in lieu of browser buttons if required.</li>
</ul>
<p>It is recommended that this manual be viewed in a browser window that is maximised or operating in full screen mode, with the latter (although browser dependent) typically toggled via the F11 key.</p>
<p>When following hyperlinks, the target (i.e. location linked <em>to</em>) is displayed at the top of the landing page. The exception to this occurs when a target is located near the bottom of the landing page’s content. In this case, it is not possible for a web browser to display the target at the top of a page because this would generate underlying white space, and as such, the target will appear in the main body of the landing page.</p>
<h3 class="unnumbered hasAnchor" id="searching">Searching<a href="#searching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This entire manual content can be searched by using the search box at the top of the table of contents pane (i.e. screen top left near the TUFLOW logo). This search box can be toggled on and off by clicking the search icon (magnifying glass) at the top left of any page.</p>
<p>The table of contents is dynamically filtered in response to entering text in the search box, and clicking on any remaining table of contents entry will navigate directly to the searched text. Searched text will be highlighted within a page for easy identification, and multiple instances within one page can be navigated through by using the up and down arrow keys. Clearing the search box will restore the table of contents.</p>
<h2 class="unnumbered hasAnchor" id="about-this-manual">About this Manual<a href="#about-this-manual" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This document is the User Manual for the TUFLOW Classic and TUFLOW HPC hydrodynamic computational engines for the 2024.??? release. Of particular note for users of earlier manual versions is that there has been a significant reworking of some chapters to integrate the HPC solver, which is now preferred over the Classic solver, into the manual. For example, the content from <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf#page=434">Chapter 10</a> in the 2018-03 Manual, which documented the HPC solver, has been relocated and embedded in the main chapters.</p>
<p>For changes to different releases refer to the links in Chapter <a href="#Features-and-Changes-1"><strong>??</strong></a>.</p>
<p>If simulating models using prior TUFLOW builds, reference may need to be
made to the Release Notes and documentation relevant for that particular
build. These can be downloaded from the <a href="https://www.tuflow.com/downloads/tuflow-classichpc-archive/">TUFLOW Classic/HPC Downloads
page</a> or
requested via <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<h2 class="unnumbered hasAnchor" id="glossary-and-notation">Glossary and Notation<a href="#glossary-and-notation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<table>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Term
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
_messages
</td>
<td style="text-align:left;">
ERROR, WARNING, CHECK and other useful messages that are output to the Console Window and log file are also output to GIS file provided the message can be geographically located within the model domains. The messages and other information are written to a file called _messages which is located in the same folder as the .tcf file or in the “Log” folder.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
_run_stats.txt
</td>
<td style="text-align:left;">
This file contains a summary of the amount of time that TUFLOW spends in the 1D and 2D computations.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
_start_stats.txt
</td>
<td style="text-align:left;">
This file contains information summarising the total time and the time elapsed for each stage of model initialisation. This can be used to identify the stages causing slow simulation start-up. 
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ADI
</td>
<td style="text-align:left;">
Alternating Direction Implicit. The TUFLOW Classic solver is a 2D ADI 2nd order spatial finite difference CPU solver.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Advection-Dispersion
</td>
<td style="text-align:left;">
A process in fluid dynamics that describes the movement (advection) and spread (dispersion) of substances (such as pollutants, nutrients, or sediments) in a fluid (usually water or air).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ArcGIS Pro Toolbar
</td>
<td style="text-align:left;">
The ArcGIS Pro Toolbar, helps with streamlining the process of creating and editing a TUFLOW model in the GIS software ArcGIS Pro.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ArcMap Toolbox
</td>
<td style="text-align:left;">
The toolbox helps with streamlining the process of creating and editing a TUFLOW model in the GIS software ArcMap.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ArcMap/ArcGIS
</td>
<td style="text-align:left;">
ArcMap and ArcGIS Pro are distributed by ESRI (<a href="https://www.esri.com/" class="uri">https://www.esri.com/</a>). They are GIS software packages that can be used to develop the georeferenced input data for TUFLOW. TUFLOW writes result and check files which are compatible with ArcMap and ArcGIS Pro also.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
attribute
</td>
<td style="text-align:left;">
Data associated with/or attached to a GIS object. For example, an elevation is attached to a point using a column of data named “Height”. The “Height” of the point is an attribute of the point.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Build
</td>
<td style="text-align:left;">
The TUFLOW Build number is in the format of year-month-xx where xx is two letters starting at AA then AB, AC, etc. for each update for that release. The Build number is written to the first line in the .tlf log file so that it is clear what version of the software was used to simulate the model. A example build number is: 2001-03-AA.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
cell
</td>
<td style="text-align:left;">
Square shaped computational element in a 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
centroid
</td>
<td style="text-align:left;">
The centre of a region or polygon.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
channel
</td>
<td style="text-align:left;">
Flow/velocity computational point in a 1D model. Channels convey the water through 1D domains. They vary in characteristics from open channels to a wide range of structures and conduits.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
TUFLOW’s “Classic” solver is a 2D ADI (Alternating Direction Implicit) 2nd order spatial finite difference CPU (Central Processing Unit) solver. TUFLOW Classic was the original TUFLOW 2D solver, which started development in 1989.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
CnM
</td>
<td style="text-align:left;">
CnM is a Chezy C, Manning’s n or Manning’s M bed resistance value.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
code
</td>
<td style="text-align:left;">
Code refers to the value assigned to cells to indicate a cell’s active or inactive status.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
command
</td>
<td style="text-align:left;">
Instruction syntax in a TUFLOW control file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
control file
</td>
<td style="text-align:left;">
Text file containing a series of commands (instructions) that control how a TUFLOW simulation domain is built and how a simulation shall execute.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
CPU
</td>
<td style="text-align:left;">
Central Processing Unit. TUFLOW can run on either CPU or GPU hardware.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
DEM
</td>
<td style="text-align:left;">
Digital Elevation Model. Interchangeable with DTM.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Double Precision (DP)
</td>
<td style="text-align:left;">
Double precision numbers use 8 bytes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
DTM
</td>
<td style="text-align:left;">
Digital Terrain Model. Interchangeable with DEM.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
element
</td>
<td style="text-align:left;">
A discrete feature in a 1D domain model, for example, a node or channel. For TUFLOW Classic and HPC, “element” refers to a square shaped computational element in a 2D domain, and is interchangeable with “cell”.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ESTRY
</td>
<td style="text-align:left;">
ESTRY is original name given to the primary 1D solver built into TUFLOW. The terms ESTRY and TUFLOW 1D may be used interchangeably throughout this Manual.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
fixed field
</td>
<td style="text-align:left;">
Lines of text in a text file that are formatted to strict rules regarding which columns values are entered into. This format was used for old versions of ESTRY and TUFLOW, and is no longer supported. If using an older version of TUFLOW, which uses this format, please refer to previous manuals for the full documentation.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
flushing assessment
</td>
<td style="text-align:left;">
An evaluation process used to assess the effectiveness of water movement (flushing) in a water body (such as a river, lake, or reservoir). It determines how well the water body can remove or dilute pollutants, sediments, or nutrients.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
fluvial flooding
</td>
<td style="text-align:left;">
Fluvial flooding refers to riverine flooding (excessive rainfall causing a river to exceed its capacity).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Fric
</td>
<td style="text-align:left;">
The field used to store bed friction information. This may be the material type or ripple height.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
GIS
</td>
<td style="text-align:left;">
Geographic Information System. For use in TUFLOW modelling it will need to be able to import/export files in supported formats as documented in this manual. Common GIS Software used for TUFLOW modelling includes ArcMap, ArcGIS Pro, QGIS or MapInfo.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
GPU
</td>
<td style="text-align:left;">
Graphics Processor Unit. TUFLOW HPC has been specifically designed for compute using NVIDIA architecture Graphics Processor Unit (GPU) hardware. HPC is the premier and recommended 2D TUFLOW fixed grid solver.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Grid
</td>
<td style="text-align:left;">
The mesh of square cells that make up a TUFLOW Classic or HPC model.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
HPC
</td>
<td style="text-align:left;">
TUFLOW’s “HPC” (Heavily Parallelised Compute) solver is a 2D explicit, 1st or 2nd order spatial and 4th order temporal, parallelised finite volume solver. TUFLOW HPC has been specifically designed for compute using NVIDIA architecture Graphics Processor Unit (GPU) hardware. HPC is the premier and recommended 2D TUFLOW fixed grid solver.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
hydraulic jump
</td>
<td style="text-align:left;">
A phenomenon in fluid dynamics where there is a sudden transition from supercritical to subcritical flow. This abrupt change in flow conditions results in a significant rise in the water surface. It is commonly seen below weirs and sluice gates where a smooth stream of water suddenly rises at a foaming front.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Integrated Urban Drainage
</td>
<td style="text-align:left;">
An approach to planning or managing an urban drainage system. Integrated Urban Drainage (IUD) takes into account all aspects of an urban drainage system that contribute to water quality and flooding problems.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
invert
</td>
<td style="text-align:left;">
The elevation of the base (bottom) of a culvert, structure or channel.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
IWL
</td>
<td style="text-align:left;">
Initial Water Level.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
land cell
</td>
<td style="text-align:left;">
A land cell is one that will never wet (i.e. an inactive cell).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
layer
</td>
<td style="text-align:left;">
A GIS data layer containing the shapes of the geographically located objects and the attribute data associated with each object.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
LIDs
</td>
<td style="text-align:left;">
Low-impact developments (LIDs) features for modelling green infrastructure.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
line
</td>
<td style="text-align:left;">
A GIS object defining a straight line defined by two points. See also, polyline (Pline). Throughout this document, ‘lines’ refer to both lines (2 vertices) and polylines (more than 2 vertices).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
M2D
</td>
<td style="text-align:left;">
The Multiple 2D Domain (M2D) module is an add on module for the TUFLOW Classic Solver. It allows for a number of 2D domains of different cell sizes and orientations to exist within a single model.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Manning’s n
</td>
<td style="text-align:left;">
A coefficient which represents the roughness or friction applied to the flow by the channel. For example, a closed finished concrete conduit flowing partly full has a Manning’s n of 0.012.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
MapInfo
</td>
<td style="text-align:left;">
MapInfo is distributed by Precisely (<a href="https://www.precisely.com/product/precisely-mapinfo/mapinfo-pro" class="uri">https://www.precisely.com/product/precisely-mapinfo/mapinfo-pro</a>). MapInfo is a GIS software package that can be used to develop the georeferenced input data for TUFLOW. TUFLOW can also write result and check files, which are compatible with MapInfo.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Mat
</td>
<td style="text-align:left;">
An integer defining the Material (land-use) type in a look-up table.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
material
</td>
<td style="text-align:left;">
Term used to describe a bed resistance category or land-use. Examples of different materials are: river, river bank, mangroves, roads, grazing land, sugar cane, parks, etc.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
miTools
</td>
<td style="text-align:left;">
MapInfo and TUFLOW Productivity Utilities (miTools) were developed to improve the efficiency of setting up and reviewing TUFLOW models, as well as improving the day to day ease of using MapInfo Professional.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Morphology
</td>
<td style="text-align:left;">
A particular form, shape, or structure. For example, coastal morphology typically refers to the movable sand bedform shape of the coastal system.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Nc
</td>
<td style="text-align:left;">
Wave Celerity Number.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Nd
</td>
<td style="text-align:left;">
Diffusion Number.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
node
</td>
<td style="text-align:left;">
One of:<br />
<span class="math inline">\(\cdot\)</span> A junction/end of one or more channels where the water level (if an open channel is connected) or pressure head (e.g. closed pipe junction) is computed in a 1D domain.<br />
<span class="math inline">\(\cdot\)</span> Node in a model mesh used for viewing 2D results in SMS. The nodes are located at the cell corners.<br />
<span class="math inline">\(\cdot\)</span> Node is also used by MapInfo to refer to vertices along a line or a region (polygon).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Non-Newtonian Flow
</td>
<td style="text-align:left;">
Non-Newtonian Flow refers to the flow of fluids that do not follow Newton’s law of viscosity. An example of Non-Newtonian flow is flows originating from a failed slurry mine tailings dam.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Notepad++
</td>
<td style="text-align:left;">
Notepad++ is a free text editor available from <a href="https://notepad-plus-plus.org/downloads/" class="uri">https://notepad-plus-plus.org/downloads/</a>. The Notepad++ functionality listed below makes it well suited as an editor for creating and updating TUFLOW control files.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Nu
</td>
<td style="text-align:left;">
Courant Number.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
null cell
</td>
<td style="text-align:left;">
A null cell is an inactive 2D cell used for defining the inactive side of an external boundary.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
obvert
</td>
<td style="text-align:left;">
The elevation of the underside (soffit) of a culvert or other structure.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Override File
</td>
<td style="text-align:left;">
Override Files allow the user to apply .tcf commands after TUFLOW has finished processing the commands which are referenced within the .tcf file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Particle Tracking
</td>
<td style="text-align:left;">
The TUFLOW Particle Tracking Module (PTM) enables the 2D or 3D simulation of discrete Lagrangian particles as they are transported by a flow field and/or other forcing terms (e.g. wind drift).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
peer to peer access
</td>
<td style="text-align:left;">
Some models of NVidia GPUs allow for a direct communications link between them, either via a specific hardware connector or via the PCI bus controller. This is known as ‘peer to peer’ access.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
pit
</td>
<td style="text-align:left;">
A point object with attributes that are used to define a pit channel for modelling flow into urban stormwater inlets/gully traps/drains/pits, then into a manhole.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
pit channel
</td>
<td style="text-align:left;">
A small channel inserted at a pit, typically used to convey water from overland 2D domains to 1D pipe networks.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
pit inlet
</td>
<td style="text-align:left;">
The entrance to a pit channel (e.g. a gully trap).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
pluvial flooding
</td>
<td style="text-align:left;">
Pluvial flooding refers to surface water flooding that is driven by local rainfall excess and is unrelated to river rising.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
point
</td>
<td style="text-align:left;">
GIS object representing a point on the earth’s surface. A point has no length or area.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
polygon
</td>
<td style="text-align:left;">
See region.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
polyline (or Pline)
</td>
<td style="text-align:left;">
A GIS object representing one or more lines connected together. A polyline has a length but no area. Throughout this document, ‘lines’ refer to both lines (2 vertices) and polylines (more than 2 vertices).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
polyline segment
</td>
<td style="text-align:left;">
One of the straight line (2 vertices) segments that make up a polyline (more than 2 vertices).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
PyTUFLOW
</td>
<td style="text-align:left;">
PyTUFLOW is a package of Python tools for extracting TUFLOW time series results. It can be used to automate output tasks such as checking model health, goodness-of-fit for model calibration, viewing on-the-fly model output (used in conjunction with Write PO Online == ON), and high-volume output plotting from production runs.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
QGIS
</td>
<td style="text-align:left;">
QGIS is free open source software (<a href="https://qgis.org/en/site/" class="uri">https://qgis.org/en/site/</a>) that can be used to develop the georeferenced input data for TUFLOW models, and view results via the TUFLOW Viewer Plugin also available for free. TUFLOW writes result and check files that are compatible with QGIS.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
QGIS TUFLOW Plugin
</td>
<td style="text-align:left;">
The QGIS TUFLOW Plugin provides a range of pre- and post- processing tools, and dynamic viewing of 1D and 2D results in TUFLOW Viewer.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Quadtree
</td>
<td style="text-align:left;">
A feature of the TUFLOW HPC 2D solver that allows the use of a quadtree mesh (dividing one 2D cell into four cells).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
radial gate
</td>
<td style="text-align:left;">
A radial gate (also called tainter gate) is a type of floodgate used to control water flow.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
raster
</td>
<td style="text-align:left;">
Gridded GIS raster data layers: GeoTIFF (.tif), GeoPackage (.gpkg), Float (.flt) and ASCII (.asc) formats.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Read File
</td>
<td style="text-align:left;">
A file that is included inside another file using the Read File command in .tcf, .tgc and .ecf files. Minimises repetitive specification of commands common to a group of files.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
region
</td>
<td style="text-align:left;">
A GIS object representing an enclosed area (i.e. a polygon). A region has a centroid, perimeter and area. Regions or polygons can have internal holes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
SGS
</td>
<td style="text-align:left;">
Sub-Grid Sampling. A feature built into the HPC 2D solver that more accurately defines a 2D cell’s geometry using the (finer) resolution of the underlying terrain/bathymetric data. Using SGS can considerably improve the accuracy of the 2D modelling.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Single Precision (SP)
</td>
<td style="text-align:left;">
Single precision numbers use 4 bytes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
sluice gate
</td>
<td style="text-align:left;">
A moveable gate that can be raised to allow water to flow under it. When a sluice gate is lowered, it can act as a weir as water may spill over the top.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
snap
</td>
<td style="text-align:left;">
When geographic objects are connected exactly at a point or vertex of a line or region. ArcMap, ArcGIS Pro, QGIS and MapInfo all have a “snap” feature, which ensures the features have the same coordinates. The snap tolerance can be changed in TUFLOW using the Snap Tolerance command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
soffit
</td>
<td style="text-align:left;">
The elevation of the underside of a bridge deck or the inner top of a culvert. Same as obvert. Note this manual uses the term obvert.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
stage-discharge curve
</td>
<td style="text-align:left;">
A curve (graph) that shows the relationship between the water level (stage) in a body of water (e.g. river) and the corresponding flow rate (discharge) at that stage.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
subcritical flow
</td>
<td style="text-align:left;">
A flow condition or behaviour where the fluid velocity is slower then the wave velocity.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Sub-grid-scale turbulence
</td>
<td style="text-align:left;">
Horizontal turbulent diffusion of momentum or eddy viscosity.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
supercritical flow
</td>
<td style="text-align:left;">
A flow condition or behaviour where the fluid velocity is higher than the wave velocity.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
SWMM
</td>
<td style="text-align:left;">
EPA Storm Water Management Model (SWMM).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
TIN
</td>
<td style="text-align:left;">
Triangulated Irregular Network.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
TUFLOW 1D
</td>
<td style="text-align:left;">
See ESTRY.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
vertex
</td>
<td style="text-align:left;">
Digitised point on a line or region (polygon).
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
vertices
</td>
<td style="text-align:left;">
Plural of vertex.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
VS Code
</td>
<td style="text-align:left;">
Visual Studio Code (commonly referred to as VS Code) is a free source code editor developed by Microsoft. It supports a variety of file types and can be used to work with TUFLOW control files. Thousands of free plugins exist for VS Code and some of them are useful when working with TUFLOW models.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
XF
</td>
<td style="text-align:left;">
XF files are a binary echo of selected input files automatically created by TUFLOW to vastly speed up the model initialisation process next time a simulation is carried out.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ZC
</td>
<td style="text-align:left;">
The “ZC” point is located at cell centers. This is a computational point where the mass balance equation is calculated. located in the centre of a 2D cell. The model elevation is also sampled here.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ZH
</td>
<td style="text-align:left;">
The “ZH” point is located at cell corners. This point plays no role computationally but is used as an elevation point and for some output formats.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
Zpt or Zpts
</td>
<td style="text-align:left;">
Points where ground/bathymetry elevations are defined. These are located at the cell centres, mid-sides and corners.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ZU
</td>
<td style="text-align:left;">
The “ZU” point is located midway along the right hand face of the 2D cell. This is a computational point, where the velocity in the X-direction is calculated. The cell’s left hand face also has a u-point belonging to the neighbouring cell to the left. The model elevation is also sampled here.
</td>
</tr>
<tr>
<td style="text-align:left;width: 35%; vertical-align:top;">
ZV
</td>
<td style="text-align:left;">
The “ZV” point is located midway along the top face of the 2D cell. This is a computational point, where the velocity in the Y-direction is calculated. The cell’s bottom face also has a v-point belonging to the neighbouring cell to the bottom. The model elevation is also sampled here.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="unnumbered hasAnchor" id="contents">Contents<a href="#contents" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The Navigation Panel to the left of the page functions as a live interactive Table of Contents for the manual chapters and associated sections. A list of the figures and tables within the manual is provided below.</p>
<h2 class="unnumbered hasAnchor" id="list-of-figures">List of Figures<a href="#list-of-figures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Figure <a href="#fig:fig-QuadtreeStructure">1</a> TUFLOW Quadtree Structure</p>
<p>Figure <a href="#fig:fig-image7">2</a> TUFLOW Modelling Concept</p>
<p>Figure <a href="#fig:fig-image8">3</a> NotePad++ TUFLOW Syntax Highlighting</p>
<p>Figure <a href="#fig:fig-image9">4</a> QGIS with TUFLOW Viewer</p>
<p>Figure <a href="#fig:fig-1D2DLinkPipeNetworkExample">5</a> 1D Pipe Network and Embankment Culvert Linked to 2D</p>
<p>Figure <a href="#fig:fig-1D2DOpenChannelExample">6</a> 1D Open Channel Linked to 2D</p>
<p>Figure <a href="#fig:fig-QuadtreeExample">7</a> TUFLOW HPC Quadtree Grid (3 Level Refinement)</p>
<p>Figure <a href="#fig:fig-SGSExampleGridTop">8</a> 20m grid size shown against the 1m DTM</p>
<p>Figure <a href="#fig:fig-2DTraditionalvsSGSExample">9</a> 2D Topography Sampling Concept and DEM Interpretation (Traditional vs SGS)</p>
<p>Figure <a href="#fig:fig-SGS-Convergence">10</a> Model Convergence with and without SGS</p>
<p>Figure <a href="#fig:fig-SGS0-XS">11</a> Longitudinal Profile without SGS</p>
<p>Figure <a href="#fig:fig-SGS1-XS">12</a> Longitudinal Profile with SGS</p>
<p>Figure <a href="#fig:fig-2DCellSizeConvergenceTestExample">13</a> Cell Size Convergence Concept Example</p>
<p>Figure <a href="#fig:fig-InterpolationZerothOrder">14</a> Example of zeroth order interpolation</p>
<p>Figure <a href="#fig:fig-InterpolationFirstOrder">15</a> Example of first order interpolation</p>
<p>Figure <a href="#fig:fig-InterpolationSecondOrder">16</a> Example of second order interpolation</p>
<p>Figure <a href="#fig:fig-TUFLOWHPC1D2DTimestepSync">17</a> TUFLOW HPC 1D/2D Timestep Synchronisation</p>
<p>Figure <a href="#fig:fig-ExampleTCF">18</a> Example of a Simple TCF</p>
<p>Figure <a href="#fig:fig-ExampleECF">19</a> Example of a Simple ECF</p>
<p>Figure <a href="#fig:fig-ExampleTGC">20</a> Example of a Simple TGC</p>
<p>Figure <a href="#fig:fig-ExampleTEF">21</a> Reduction of Control Files using Event Management</p>
<p>Figure <a href="#fig:fig-Channels-Structures-Nodes">22</a> 1D Channels, Structures and Nodes</p>
<p>Figure <a href="#fig:fig-image49">23</a> All Parallel Conveyance Calculation Method</p>
<p>Figure <a href="#fig:fig-image50">24</a> Change in Resistance Conveyance Calculation Method</p>
<p>Figure <a href="#fig:fig-image19">25</a> 1D Inlet Control Culvert Flow Regimes</p>
<p>Figure <a href="#fig:fig-image20">26</a> 1D Outlet Control Culvert Flow Regimes</p>
<p>Figure <a href="#fig:fig-image21">27</a> Arch Bridge Editor Tool</p>
<p>Figure <a href="#fig:fig-image22">28</a> Bradley Weir Submergence Curve <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span></p>
<p>Figure <a href="#fig:fig-image24">29</a> Ogee Spillway Discharge Coefficient, based on Figure 9-23 <span class="citation">(<a href="#ref-USBR1987">USBR, 1987</a>)</span></p>
<p>Figure <a href="#fig:fig-SmallDams2">30</a> Adjustment of Discharge Coefficient based on <span class="math inline">\(H_{e}\)</span>/<span class="math inline">\(H_{0}\)</span>, Figure 9-24 <span class="citation">(<a href="#ref-USBR1987">USBR, 1987</a>)</span></p>
<p>Figure <a href="#fig:fig-image26">31</a> Weir Submergence Curves from the Literature</p>
<p>Figure <a href="#fig:fig-image27">32</a> Weir Submergence Curves using Villemonte Equation</p>
<p>Figure <a href="#fig:fig-image38">33</a> Schematisation of 1D Piping Failure</p>
<p>Figure <a href="#fig:fig-image40">34</a> Schematisation of 1D Dam Failure</p>
<p>Figure <a href="#fig:fig-image53">35</a> Example of Pit Inlet Database</p>
<p>Figure <a href="#fig:fig-image54">36</a> Road Crossfall Option</p>
<p>Figure <a href="#fig:fig-manhole-entry-exit-losses">37</a> Flow Expansion/Contraction at a Manhole</p>
<p>Figure <a href="#fig:fig-manhole-bend-losses">38</a> Change in Flow Direction at a Manhole</p>
<p>Figure <a href="#fig:fig-manhole-drop-losses">39</a> Change in Inlet/Outlet Height at a Manhole</p>
<p>Figure <a href="#fig:fig-manhole-HGL">40</a> Engelund Energy Loss Approach at Manholes</p>
<p>Figure <a href="#fig:fig-VirtualPipeLag">41</a> Virtual Pipe Lag Methods</p>
<p>Figure <a href="#fig:fig-Nodal-Storage">42</a> Nodal Storage in Open Channel &amp; Pipe Networks</p>
<p>Figure <a href="#fig:fig-image59">43</a> TUFLOW HPC 2D SWE Finite Volume Scheme Approach</p>
<p>Figure <a href="#fig:fig-image56">44</a> Location of Zpts and Computation Points</p>
<p>Figure <a href="#fig:fig-image61">45</a> Effect of Enhanced Dry Boundary Viscosity Term Treatment</p>
<p>Figure <a href="#fig:fig-redundant-perimeter">46</a> Redundant Perimeter Sections Reported in the TLF</p>
<p>Figure <a href="#fig:fig-data-layering">47</a> Visual Representation of Data Layering in TUFLOW</p>
<p>Figure <a href="#fig:fig-image66">48</a> 2D Cell Topography - Traditional Approach</p>
<p>Figure <a href="#fig:fig-image102">49</a> Example of Log Law Variation of Mannings n with Depth</p>
<p>Figure <a href="#fig:fig-image103">50</a> Example of Log Law versus Constant Mannings n with Depth</p>
<p>Figure <a href="#fig:fig-image104">51</a> Example of Materials .csv File Format</p>
<p>Figure <a href="#fig:fig-image105">52</a> Example of the Grass.csv file read into the Materials.csv</p>
<p>Figure <a href="#fig:fig-image106">53</a> Example of the Trees.csv file read into the Materials.csv</p>
<p>Figure <a href="#fig:fig-image109">54</a> Green-Ampt Model Concept<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Figure <a href="#fig:fig-image110">55</a> Example of Horton Infiltration Rate over Time</p>
<p>Figure <a href="#fig:fig-image111">56</a> Example Soils .tsoilf File Format</p>
<p>Figure <a href="#fig:fig-image112">57</a> Flow patterns using 2D FC cells (i.e. a fully 2D solution)</p>
<p>Figure <a href="#fig:fig-image113">58</a> Flow patterns using a 1D element connected to 2D SX links</p>
<p>Figure <a href="#fig:fig-image114">59</a> Flow patterns using a 1D element connected to 2D HX links</p>
<p>Figure <a href="#fig:fig-2DBGAttributes">60</a> 2D BG Shape Attributes and Vertical Distribution of Form Loss Coefficient</p>
<p>Figure <a href="#fig:fig-BGFLCApproach">61</a> Depth Averaged FLC Applied Using Four Adjustment Approaches</p>
<p>Figure <a href="#fig:fig-CFDBridgeFLC">62</a> CFD benchmarking study of FLC vs <span class="math inline">\(D_{Pier}\)</span>/<span class="math inline">\(T_{SuperS}\)</span> ratio (<span class="math inline">\(h_{B}\)</span>/<span class="math inline">\(T\)</span> in the original paper)</p>
<p>Figure <a href="#fig:fig-QTMeshIntro">63</a> TUFLOW HPC Quadtree Grid</p>
<p>Figure <a href="#fig:fig-image62">64</a> Example of Quadtree Nesting Level Polygons</p>
<p>Figure <a href="#fig:fig-image64">65</a> Examples of Automatic Quadtree Refinement</p>
<p>Figure <a href="#fig:fig-image65">66</a> Example Showing Removal of Inactive Cells</p>
<p>Figure <a href="#fig:fig-image67">67</a> Traditional (non-SGS) Approach</p>
<p>Figure <a href="#fig:fig-image68">68</a> SGS Approach</p>
<p>Figure <a href="#fig:fig-SGS-Delta">69</a> SGS Breakline Detection Delta Output</p>
<p>Figure <a href="#fig:fig-SGS-Z-Line">70</a> Diagram of SGS Z Shape Line Approach Options</p>
<p>Figure <a href="#fig:fig-sgs-SX-Flag">71</a> Diagram of SGS SX Z Flag Approach Options</p>
<p>Figure <a href="#fig:fig-image108">72</a> Illustration of soil layers and flows in adjoining cells</p>
<p>Figure <a href="#fig:fig-NN-plug-flow">73</a> Non-Newtonian Shear Stress and Velocity Profile</p>
<p>Figure <a href="#fig:fig-image118">74</a> Setting FC Parameters for a Bridge Structure</p>
<p>Figure <a href="#fig:fig-image119">75</a> Setting FCSH Parameters for a Bridge Structure</p>
<p>Figure <a href="#fig:fig-image120a">76</a> Cell Cross-hair Selection Approach</p>
<p>Figure <a href="#fig:fig-slopingWL">77</a> Sloping Water Level Boundaries</p>
<p>Figure <a href="#fig:fig-image124">78</a> Example Rainfall Database</p>
<p>Figure <a href="#fig:fig-imageIDW">79</a> Example Depth Total Grid</p>
<p>Figure <a href="#fig:fig-image126">80</a> Simple BC Database Example (bc_dbase.csv)</p>
<p>Figure <a href="#fig:fig-image127">81</a> Example BC Database Source Files (heads.csv)</p>
<p>Figure <a href="#fig:fig-image128">82</a> Example BC Database Source Files (flows.csv)</p>
<p>Figure <a href="#fig:fig-image129">83</a> Example BC Database Using Event Text</p>
<p>Figure <a href="#fig:fig-image130">84</a> Example BC Database Source Files Using Event Text</p>
<p>Figure <a href="#fig:fig-HEC-DSSfiles">85</a> Example DSS File</p>
<p>Figure <a href="#fig:fig-PartDWildCard">86</a> Time-series Curve Example</p>
<p>Figure <a href="#fig:fig-1D-2DLinkingConfigurations">87</a> 1D/2D Linking Configurations</p>
<p>Figure <a href="#fig:fig-HXSchematicPlanView">88</a> HX Connection: Nested 1D Open Channel Plan View</p>
<p>Figure <a href="#fig:fig-HXFlowPatterns">89</a> HX Connection: Example of Momentum Preservation across HX Lines</p>
<p>Figure <a href="#fig:fig-HXSchematicSectionView">90</a> HX Connection: Nested 1D Open Channel Section View</p>
<p>Figure <a href="#fig:fig-HXExternalBoundaryConnection">91</a> HX Connection: External 1D Network Boundary Connection</p>
<p>Figure <a href="#fig:fig-SXSchematicCrossDrainageStructure">92</a> SX Connection Options</p>
<p>Figure <a href="#fig:fig-SXSchematicPipeNetworkPlan">93</a> SX Connection: Pipe Network Plan View</p>
<p>Figure <a href="#fig:fig-SXSchematicPipeNetwork">94</a> SX Connection: Pipe Network -Section View</p>
<p>Figure <a href="#fig:fig-1D2DSWMMCulvert">95</a> SWMM 1D Connection: Culvert</p>
<p>Figure <a href="#fig:fig-1D2DSWMMPipeNetwork">96</a> SWMM 1D Connection: Pipe Network</p>
<p>Figure <a href="#fig:fig-1D1DSWMMTUFLOWConnection">97</a> SWMM 1D / TUFLOW 1D Connection</p>
<p>Figure <a href="#fig:fig-FMTUFLOWVersionCompatability">98</a> Compatibility of Recent Flood Modeller and TUFLOW versions</p>
<p>Figure <a href="#fig:fig-MultipleDomainModellinkedvia1DDomain">99</a> Schematic of a Multiple Domain Model linked via a 1D Domain</p>
<p>Figure <a href="#fig:fig-MultipleDomainModellinkedvia2DLink">100</a> Schematic of a Multiple 2D Domain Model using the 2d_bc 2D Link</p>
<p>Figure <a href="#fig:fig-Multiple2DDomainModelLinkCheckFiles">101</a> Multiple 2D Domain Model 2D Link Check Files</p>
<p>Figure <a href="#fig:fig-HR-Output">102</a> Regular Grid Depth Output (Left) and HR Grid Depth Output (Right)</p>
<p>Figure <a href="#fig:fig-ZUD1">103</a> Example Hazard File for User Defined Hazard</p>
<p>Figure <a href="#fig:fig-WLL-Triangles">104</a> Adding Triangles into 1d_WLL Layer to Infill Areas</p>
<p>Figure <a href="#fig:fig-PO-Objects">105</a> Interpretation of PO Objects and Map Output</p>
<p>Figure <a href="#fig:fig-RL-Example">106</a> Example of the QGIS TUFLOW Plugin for a Reporting Location</p>
<p>Figure <a href="#fig:fig-GaugeOutput">107</a> Example Use of Gauge Data Output Layer</p>
<p>Figure <a href="#fig:fig-TUFLOWEngineFiles">108</a> TUFLOW Engine Files</p>
<p>Figure <a href="#fig:fig-NvidiaSettings">109</a> Accessing NVIDIA Control Panel from the Desktop</p>
<p>Figure <a href="#fig:fig-NvidiaGPUModel">110</a> NVIDIA GPU Model</p>
<p>Figure <a href="#fig:fig-NvidiaWebsite">111</a> Check the Website for your NVIDIA Card</p>
<p>Figure <a href="#fig:fig-NVIDASystemInfo">112</a> NVIDIA System Information</p>
<p>Figure <a href="#fig:fig-GPUDriverInfo">113</a> Accessing Driver Updates from the NVIDIA Control Panel</p>
<p>Figure <a href="#fig:fig-FMSettings">114</a> Flood Modeller Settings</p>
<p>Figure <a href="#fig:fig-twelveD2DQuickSettings">115</a> 12D 2D Quick Setting</p>
<p>Figure <a href="#fig:fig-twelveDTUFLOWProjectEditor">116</a> 12D TUFLOW Project Editor</p>
<p>Figure <a href="#fig:fig-SMSSettings">117</a> SMS Settings</p>
<p>Figure <a href="#fig:fig-image179">118</a> Example TUFLOW Classic Console (DOS) Display Window</p>
<p>Figure <a href="#fig:fig-image180">119</a> Example TUFLOW HPC Console (DOS) Display Windows</p>
<p>Figure <a href="#fig:fig-FilterCode">120</a> Filter by Code Number</p>
<p>Figure <a href="#fig:fig-mm-output">121</a> Maximum and Minimum Water Level and Flow Output</p>
<p>Figure <a href="#fig:fig-ccA">122</a> Example of the ccA GIS Layer Highlighting Culvert Performance</p>
<p>Figure <a href="#fig:fig-TS-Flow">123</a> Example of the _TS Layer Flow Output</p>
<p>Figure <a href="#fig:fig-stability-style">124</a> Example of the _TS Layer Stability Styling</p>
<p>Figure <a href="#fig:fig-ImpactMap">125</a> Impact Mapping</p>
<p>Figure <a href="#fig:fig-DTOutput">126</a> TUFLOW HPC Minimum Timestep (dt) Map Output</p>
<p>Figure <a href="#fig:fig-HPCrepeatingtimestep">127</a> TUFLOW HPC.TLF Repeating Timesteps</p>
<p>Figure <a href="#fig:fig-HPCDTCSV">128</a> Timestep and Control Numbers plotted from the .hpc.dt.csv</p>
<p>Figure <a href="#fig:fig-Warning2551">129</a> TUFLOW Warning 2551 Messages in QGIS</p>
<p>Figure <a href="#fig:fig-RAMErrorDomainSizeRAM">130</a> TUFLOW RAM Error</p>
<p>Figure <a href="#fig:fig-DomainSizeRAM">131</a> Influence of 2D Domain Size on RAM Allocation</p>
<p>Figure <a href="#fig:fig-ArcGISToolbar">132</a> ArcGIS Pro TUFLOW Toolbar</p>
<h2 class="unnumbered hasAnchor" id="list-of-tables">List of Tables<a href="#list-of-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Table <a href="#tab:tab-ModellingEnvironment">1</a> TUFLOW Modelling Environment</p>
<p>Table <a href="#tab:tab-SupportingSoftware">2</a> Supporting Software Options</p>
<p>Table <a href="#tab:tab-SubfolderStructure">3</a> Recommended Sub-Folder Structure</p>
<p>Table <a href="#tab:tab-FileTypesCombinedControl">4</a> List of Most Commonly Used File Types - Control Files</p>
<p>Table <a href="#tab:tab-FileTypesCombined">5</a> List of Most Commonly Used File Types - Input, Output and Check File Types</p>
<p>Table <a href="#tab:tab-RecommendedPrefixes2DDomain">6</a> GIS Input Data Layers and Recommended Prefixes - 2D Domain</p>
<p>Table <a href="#tab:tab-RecommendedPrefixes1DDomain">7</a> GIS Input Data Layers and Recommended Prefixes - 1D Domain</p>
<p>Table <a href="#tab:tab-TipsAndTricks">8</a> TUFLOW Tips and Tricks</p>
<p>Table <a href="#tab:tab-twoDCellSize">9</a> Recommended 2D Cell Size</p>
<p>Table <a href="#tab:tab-HPCTimestep">10</a> HPC 2D Adaptive Timestep Controlling Numbers</p>
<p>Table <a href="#tab:tab-ControlFiles">11</a> List of Available Control Files</p>
<p>Table <a href="#tab:tab-CharactersTextFiles">12</a> Reserved Characters Text Files</p>
<p>Table <a href="#tab:tab-DocumentationTextFiles">13</a> Notation Used in Command Documentation Text Files</p>
<p>Table <a href="#tab:tab-ModelUnits">14</a> Model Units - Inputs</p>
<p>Table <a href="#tab:tab-Database">15</a> List of Available Databases</p>
<p>Table <a href="#tab:tab-GISObjectsUsed">16</a> TUFLOW Interpretation of Supported GIS Objects</p>
<p>Table <a href="#tab:tab-GISObjectsUnused">17</a> TUFLOW Interpretation of Unsupported GIS Objects</p>
<p>Table <a href="#tab:tab-LineTypes">18</a> 1D Channel (Line) Types</p>
<p>Table <a href="#tab:tab-LineTypesOptionalFlags">19</a> 1D Channel (Line) Types - Additional/Optional Channel Flags</p>
<p>Table <a href="#tab:tab-AttributeDescriptions">20</a> Open Channels: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-CrossAttributeDescriptions">21</a> 1D Cross-Section Table Link (1d_xs) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-CulvertsAttributeDescriptions">22</a> Culverts and Pipes: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-FlowRegimes">23</a> 1D Culvert Flow Regime Flags</p>
<p>Table <a href="#tab:tab-LossCoefficient">24</a> Computed Values of Modified Energy Loss Coefficient</p>
<p>Table <a href="#tab:tab-MatrixMethod">25</a> Commands for the Blockage Matrix Method</p>
<p>Table <a href="#tab:tab-Blockage">26</a> Example Blockage Matrix File</p>
<p>Table <a href="#tab:tab-BridgesAttributeDescriptions">27</a> Bridges: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-LinkAttributeDescriptions">28</a> 1D Bridge Geometry Table Link (1d_bg) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ArchBridgesAttributeDescriptions">29</a> Arch Bridges 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ArchBridgeProperties">30</a> Arch Bridge Properties .csv</p>
<p>Table <a href="#tab:tab-WeirTypes">31</a> Weir Types</p>
<p>Table <a href="#tab:tab-WeirFlows">32</a> Default Attribute Values for the Weir Equation for Different Weir Flows</p>
<p>Table <a href="#tab:tab-WeirsAttributeDescriptions">33</a> Weirs: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-OptionalAttributeDescriptions">34</a> 1D Model Network (1d_nwke) OPTIONAL Attribute Descriptions</p>
<p>Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a> Special Channels: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ValueTypes">36</a> Variable Value Types</p>
<p>Table <a href="#tab:tab-StatusVariable">37</a> Keywords Returned by Status Variable</p>
<p>Table <a href="#tab:tab-OperationalVariables">38</a> Values Returned by ‘Operational Variables’.</p>
<p>Table <a href="#tab:tab-FailureAttributeDescriptions">39</a> Piping &amp; Dam Failure Channels: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-WeirFlowTOCCommands">40</a> .toc Commands to Set Weir Flow Equation Parameters in DF Channel</p>
<p>Table <a href="#tab:tab-PitsModelNetwork">41</a> Pits: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-PitsAttributeDescriptions">42</a> Pits: 1D Model Network (1d_pit) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-DatabaseFormat">43</a> Pit Inlet Database Format</p>
<p>Table <a href="#tab:tab-PitFlowRegimes">44</a> Q Pit Flow Regime Flags</p>
<p>Table <a href="#tab:tab-Manhole">45</a> 1D Manhole (1d_mh) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-PointObjectTypes">46</a> 1d_nwk Point Object Types</p>
<p>Table <a href="#tab:tab-NodesAttributeDescriptions">47</a> Nodes: 1D Model Network (1d_nwk) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-DescriptionsNodes">48</a> 1D Model Network (1d_nd) Attribute Descriptions for Nodes</p>
<p>Table <a href="#tab:tab-AreaTableLink">49</a> 1D Nodal Area Table Link (1d_na) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-LocationAttribute">50</a> Location (2d_loc) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-CellCodes">51</a> Cell Codes</p>
<p>Table <a href="#tab:tab-CodeAttribute">52</a> 2D Code (2d_code) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ZptCommands">53</a> 2D Zpt Commands</p>
<p>Table <a href="#tab:tab-ZShapeAttribute">54</a> 2D Z-Shape (2d_zsh) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-twoDVariable">55</a> 2D Variable Z-Shape (2d_vzsh) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-TinAttribute">56</a> 2D Tin (2d_ztin) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-twoDZAttribute">57</a> 2D Z (2d_z_) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-twoDMaterials">58</a> 2D Materials (2d_mat) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-MaterialsFormat">59</a> Materials .csv File Format</p>
<p>Table <a href="#tab:tab-MaterialsFile">60</a> Materials .tmf File Format</p>
<p>Table <a href="#tab:tab-GreenAmpt">61</a> USDA Soil types for the Green-Ampt Infiltration Method</p>
<p>Table <a href="#tab:tab-tsoilf">62</a> Soil File (.tsoilf) Parameters</p>
<p>Table <a href="#tab:tab-SoilAttribute">63</a> 2D Soil (2d_soil) GIS Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ModellingApproaches">64</a> Hydraulic Structure Modelling Approaches</p>
<p>Table <a href="#tab:tab-BridgeShapeAttributeDescriptions">65</a> 2D Bridge Shape (2d_bg) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-BridgePointAttributeDescriptions">66</a> 2D Bridge Shape Points (2d_bg_pts) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-LayeredFlow">67</a> Layered Flow Constriction Shape (2d_lfcsh) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ShapePoint">68</a> Layered Flow Constriction Shape Point (2d_lfcsh_pts) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-QNLAttribute">69</a> 2D Quadtree (2d_qnl) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-tsoilf-hpc">70</a> HPC .tsoilf Parameters</p>
<p>Table <a href="#tab:tab-ConstrictionShape">71</a> Flow Constriction Shape (2d_fcsh) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-FlowConstriction">72</a> Flow Constriction (2d_fc) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-BCArrangements">73</a> Recommended BC Arrangements</p>
<p>Table <a href="#tab:tab-HPCBoundaryDescriptions">74</a> HPC Boundary Approach Descriptions</p>
<p>Table <a href="#tab:tab-LinkTypes">75</a> 1D Boundary Condition and Link Types</p>
<p>Table <a href="#tab:tab-BoundaryConditions">76</a> 1D Boundary Conditions (1d_bc) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-twoDBoundary">77</a> 2D Boundary Condition and Link Types</p>
<p>Table <a href="#tab:tab-ConditionsAttribute">78</a> 2D Boundary Conditions (2d_bc) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-SACombined">79</a> 2D Source over Area (2d_sa) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-STRM">80</a> Streamlines (2d_strm) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-SA-RF">81</a> 2D Source over Area Rainfall (2d_sa_rf) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-SA-TR">82</a> 2D Source over Area Trigger (2d_sa_tr) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-SA-PO">83</a> 2D Source over Area Flow Feature (2d_sa_po) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-DirectRainfall">84</a> 2D Direct Rainfall over Area (2d_rf) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-KeywordDescriptions">85</a> BC Database Keyword Descriptions</p>
<p>Table <a href="#tab:tab-CycloneAttributes">86</a> GIS Attribute Details for Cyclone (2d_cyc) layer</p>
<p>Table <a href="#tab:tab-WindStress">87</a> 2D External Wind Stress (2d_ws) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-WaterLevel">88</a> 1D Initial Water Level (1d_iwl) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-InitialWater">89</a> 2D Initial Water Level (2d_iwl) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-Groundwater">90</a> 2D Groundwater (2d_gw) GIS Attribute Descriptions</p>
<p>Table <a href="#tab:tab-AD-GIS-Inputs">91</a> GIS Input Data Layers and Recommended Prefixes</p>
<p>Table <a href="#tab:tab-AD-GlobalDatabase">92</a> Global Database Keyword Descriptions</p>
<p>Table <a href="#tab:tab-AD-Database-Keywords">93</a> AD BC Database Keyword Descriptions</p>
<p>Table <a href="#tab:tab-AD-GIS-Inputs2">94</a> 2D Initial Conditions (2d_ad_ic) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-AD-GIS-Inputs3">95</a> 2D Minimum Dispersion Coefficient (2d_ad_md) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-AD-Results1">96</a> _ADcfl.csv File Columns</p>
<p>Table <a href="#tab:tab-AD-Results2">97</a> _ADmass.csv File Columns</p>
<p>Table <a href="#tab:tab-SWMMinletusage">98</a> SWMM Inlet Usage (swmm_iu) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-FormatOptionsMesh">99</a> Map Output Format Options - Mesh Based Output Formats</p>
<p>Table <a href="#tab:tab-FormatOptionsDATXMDF">100</a> Map Output Format Options - Options for XMDF Format</p>
<p>Table <a href="#tab:tab-FormatOptionsGrid">101</a> Map Output Format Options - Grid Based Output Formats</p>
<p>Table <a href="#tab:tab-ExcludingHazard">102</a> Map Output Types (Excluding Hazard (Z) Types)</p>
<p>Table <a href="#tab:tab-MapOutputHazardZTypes">103</a> Map Output Hazard (Z) Types</p>
<p>Table <a href="#tab:tab-WaterLevelLine">104</a> 1D Water Level Line (1d_wll) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-LinePoint">105</a> 1D Water Level Line Point (1d_wllp) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-GaugeLevel">106</a> 2D Gauge Level Output (2d_glo) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-PODataPLPL">107</a> Time-Series (PO) Data Types - Point, Line or Region</p>
<p>Table <a href="#tab:tab-PlotOutput">108</a> 2D Plot Output (2d_po) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-LongitudinalProfiles">109</a> 2D Longitudinal Profiles (2d_lp) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-ReportingLocation">110</a> 0d_RL Reporting Location Attributes</p>
<p>Table <a href="#tab:tab-GaugeDataOutput">111</a> 2d_GDO_ Gauge Data Output Attributes</p>
<p>Table <a href="#tab:tab-ShapeRoute">112</a> 2D Z-Shape Route (2d_zshr) Attribute Descriptions</p>
<p>Table <a href="#tab:tab-RCPOutput">113</a> RCP Output (2d_zshr) Attribute Description</p>
<p>Table <a href="#tab:tab-TUFLOWOutput">114</a> Commands used to Control TUFLOW Outputs</p>
<p>Table <a href="#tab:tab-TUFLOWVersions">115</a> TUFLOW Versions (iSP, iDP, w64)</p>
<p>Table <a href="#tab:tab-TUFLOWOptions">116</a> TUFLOW.exe Options (Switches)</p>
<p>Table <a href="#tab:tab-TCFCommandsa">117</a> TCF commands (apart from Timestep) specific to the TUFLOW HPC solver</p>
<p>Table <a href="#tab:tab-tsf">118</a> TUFLOW Summary File Example</p>
<p>Table <a href="#tab:tab-RegimeFlags">119</a> Channel and Node Flow Regime Flags (.eof File)</p>
<p>Table <a href="#tab:tab-CheckFiles">120</a> Types of Check Files</p>
<p>Table <a href="#tab:tab-MBFile">121</a> MB.csv File Columns</p>
<p>Table <a href="#tab:tab-MB1DFile">122</a> MB1D.csv File Columns</p>
<p>Table <a href="#tab:tab-MB2DFile">123</a> MB2D.csv File Columns</p>
<p>Table <a href="#tab:tab-TSMB">124</a> TSMB GIS Layer Attributes</p>
<p>Table <a href="#tab:tab-TSMB1d2d">125</a> TSMB1d2d GIS Layer Attributes</p>
<p>Table <a href="#tab:tab-FileColumns">126</a> MB_HPC.csv File Columns</p>
<p>Table <a href="#tab:tab-plotFolderplot">127</a> Plot Folder File Descriptions</p>
<p>Table <a href="#tab:tab-TSGIS">128</a> _TS GIS Layer Descriptions</p>
<p>Table <a href="#tab:tab-ModelIndicators">129</a> Simulation Summary Healthy Model Indicators</p>
<p>Table <a href="#tab:tab-CheckList">130</a> Quality Control Check List</p>
<p>Table <a href="#tab:tab-QGISPlugin">131</a> QGIS TUFLOW Plugin - Tools</p>
<p>Table <a href="#tab:tab-BackwardCompat1">132</a> Default Changes from 2023-03-AF Release to 2024.1.1 Release</p>

<h1 class="hasAnchor" id="Introduction-1"><span class="header-section-number">1</span> Introduction<a href="#Introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="TUFLOWProducts-2"><span class="header-section-number">1.1</span> TUFLOW Products<a href="#TUFLOWProducts-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW Products includes a suite of hydraulic modelling software for the numerical simulation of urban
drainage, catchment runoff, flooding, pollutant export, as well as estuarine, lacustrine and coastal hydrodynamics
and associated environmental processes. Developed through close
collaboration with universities and our users, TUFLOW software is known
for its high scientific standard, accuracy, rigorous benchmarking, and
workflow efficiency.</p>
<p>The TUFLOW suite includes two primary pieces of software:</p>
<ol style="list-style-type: decimal">
<li><p><strong>TUFLOW Classic/HPC</strong> which uses a fixed grid of square two-dimensional (2D) cells with optional one-dimensional (1D) elements and networks as the computational structure. TUFLOW Classic/HPC presently includes two 2D computational solver options, coupled to several 1D solvers:</p>
<ul>
<li>TUFLOW’s “Classic” solver is a 2D ADI (Alternating Direction Implicit)
2<sup>nd</sup> order spatial finite difference CPU (Central Processing
Unit) solver. TUFLOW Classic was the original TUFLOW 2D solver, which
started development in 1989.</li>
<li>TUFLOW’s “HPC” (Heavily Parallelised Compute) solver is a 2D explicit,
1<sup>st</sup> or 2<sup>nd</sup> order spatial and 4<sup>th</sup>
order temporal, parallelised finite volume solver. TUFLOW HPC can use either
CPU and Graphics Processor Unit (GPU) hardware for its compute. GPU
hardware acceleration enables TUFLOW HPC to run simulations up to 100 times
faster than Classic. TUFLOW HPC was originally added to the TUFLOW suite in 2011
initially as a 1<sup>st</sup> order spatial solver known as TUFLOW
GPU, then in 2018 as a more accurate 2<sup>nd</sup> order spatial
solver. In addition to offering much faster run-times, TUFLOW HPC offers
industry leading accuracy that is the same or better than Classic,
shock-capturing and excellent stability with zero mass error.</li>
<li>TUFLOW 1D (ESTRY) is an explicit finite difference 1D solver. TUFLOW
1D is a powerful open channel and underground pipe network solver,
which started development in 1972 and has continued to be enhanced to
the present day. TUFLOW 1D is dynamically linked to both the Classic
and HPC 2D solvers.</li>
<li>EPA SWMM 1D (SWMM) is a widely used 1D program for simulating urban and non-urban watersheds’ hydrologic and hydraulic behaviour. Initially developed in the early 1970s by the US Environmental Protection Agency (EPA), the model has since undergone numerous updates and enhancements to become one of the most used 1D stormwater runoff tools in North America. SWMM is dynamically linked to the TUFLOW HPC 2D solver.</li>
<li>Several third-party 1D solvers are also linked to TUFLOW Classic/HPC/TUFLOW 1D – see <a href="https://www.tuflow.com/products/gui-options/">www.tuflow.com/products/gui-options/</a>.</li>
</ul>
<p>TUFLOW Classic/HPC is well suited to simulating integrated urban
drainage (surface inundation and sub-surface pipe flows),
distributed hydrology direct rainfall (rain-on-grid) catchment runoff,
flooding, tides, storm tides and tsunami inundation.</p>
<p>Additional functionality is available via several modules including
GPU acceleration, varying grid cell sizes, and advection-dispersion
(see Section <a href="#ADModule-4"><strong>??</strong></a>), with other modules also under consideration (e.g. particle
tracking, sediment transport/morphology, water quality).</p>
<p>This manual provides user guidance for applying the above solvers. All
references to “TUFLOW” in this manual refer to the combination of the
above solvers (TUFLOW Classic, HPC and 1D/ESTRY).</p></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li><p><strong>TUFLOW FV</strong> is a 1<sup>st</sup> or 2<sup>nd</sup> order spatial
flexible mesh finite volume solver, supporting both triangular and
quadrilateral cells in the computational domain. TUFLOW FV has
1D, 2D and 3D capabilities. It includes numerous advanced add-on
modules, such as Advection Dispersion (AD), Sediment Transport and
Morphology (ST), Particle Tracking (PT) and Water Quality (WQ).
TUFLOW FV is primarily suited to simulating tide, estuarine, storm
tide, tsunamis and coastal hydraulics and environmental processes.
It is also well suited to modelling complex 3D hydrodynamic flows in
rivers and around structures.</p>
<p>This manual <u>DOES NOT</u> provide user guidance for TUFLOW FV. The
TUFLOW FV manual is available for download from the <a href="https://www.tuflow.com/downloads/#tuflow_fv">TUFLOW
website</a>.</p></li>
</ol>
<p>Linkage between TUFLOW HPC and TUFLOW FV is available using the <a href="#TUFLOWCATCH-4">TUFLOW CATCH Module</a>.</p>
<h3 class="hasAnchor" id="TUFLOW-CLA-3"><span class="header-section-number">1.1.1</span> TUFLOW Classic – 2D Semi-Implicit Solver<a href="#TUFLOW-CLA-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW’s ADI 2D solver, branded TUFLOW Classic, is based on the scheme of <span class="citation">Stelling (<a href="#ref-Stelling1984">1984</a>)</span>,
and is documented in <span class="citation">Syme (<a href="#ref-Syme1991">1991</a>)</span>. It solves the full two-dimensional,
depth-averaged, momentum and continuity equations for free-surface flow
using a 2<sup>nd</sup> order semi-implicit matrix solver. The scheme
includes all the key physics including representation of inertia and sub-grid-scale
turbulence (horizontal diffusion of momentum or eddy viscosity).</p>
<p>The initial development of TUFLOW Classic was carried out as a joint
research and development project between WBM Oceanics Australia (now
BMT) and the University of Queensland in 1989. The project successfully
developed a 1D/2D dynamically linked modelling system <span class="citation">(<a href="#ref-Syme1991">Syme, 1991</a>)</span>.
Since the initial research project, TUFLOW Classic has seen continuous
year on year research and development. Notable improvements from then to
today include the ability to accommodate both sub and supercritical
flow regimes, inclusion of various 2D hydraulic structure options,
catchment flood and urban inundation modelling and risk assessment
features, advanced 1D/2D and 2D/2D linking, and workflow efficient GIS
data management.</p>
<p>For legacy reasons, TUFLOW Classic is the default 2D fixed grid solver,
however, since the 2020‑01 release, the TUFLOW HPC solver with GPU
acceleration is typically preferred by industry over TUFLOW Classic due to its
superior speed, unconditional stability, zero
mass error, and benchmarked accuracy at all physical scales
(flume models to major rivers).</p>
<h3 class="hasAnchor" id="TUFLOW-HPC-3"><span class="header-section-number">1.1.2</span> TUFLOW HPC – 2D GPU Accelerated Solver<a href="#TUFLOW-HPC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW’s explicit 2D solver, branded TUFLOW HPC (Heavily Parallelised Compute),
started its development in 2011, with a focus on harnessing the power of
heavily parallelised processing units found in Graphical Processing
Unit (GPU)) devices (also known as a video or graphics card). TUFLOW Classic’s 2D implicit solver is not as well suited to parallelisation as explicit solvers, such as TUFLOW HPC, due to dependencies within numerical loops. TUFLOW HPC
solves the full 2D free-surface equations including the inertia and
sub-grid turbulence (eddy viscosity) terms. The scheme is volume and
momentum conserving finite volume, 2<sup>nd</sup> order in space and
4<sup>th</sup> order in time. TUFLOW HPC has the same advanced 1D/2D
link functionality as TUFLOW Classic, and is equally well suited to
integrated urban drainage assessments, where overland flow is
represented in 2D and the sub-surface pipe network in 1D, or for
catchment studies using nested 1D open channels within a broader 2D
domain.</p>
<p>Prior to 2017, TUFLOW HPC was preceded by TUFLOW GPU, which was a
more simplistic 1<sup>st</sup> order spatial solution. TUFLOW GPU had
numerous constraints due its 1<sup>st</sup> order accuracy, cell-centred
configuration and no connectivity to TUFLOW’s 1D solver. Use of TUFLOW GPU is
not recommended where reasonable accuracy is required, hence
documentation specific to TUFLOW GPU has been largely removed from this
manual. For legacy reasons TUFLOW GPU is still supported; for
documentation on the superseded solver, please refer to the <a href="https://www.tuflow.com/downloads/tuflow-classichpc-archive/#2016_cla_hpc">2016‑03‑AE
TUFLOW User
Manual</a>.</p>
<p>TUFLOW HPC’s solution scheme has undergone extensive, advanced
development since 2017, arguably making TUFLOW HPC the fastest and most
accurate 2D solver in the industry. Key features of TUFLOW HPC include:</p>
<ul>
<li>A solution scheme design targeting GPU hardware technology to maximise
simulation speeds. TUFLOW HPC using GPU hardware can run simulations over 100
times faster than TUFLOW Classic using CPU hardware, noting that
Classic is one of the fastest single core CPU solvers <span class="citation">(<a href="#ref-EnvAgency2013">Neelz &amp; Pender, 2013</a>)</span>. This exceptional speed means very large models (&gt;100
2D million cells) with fine grids can now be run within a sensible
timeframe yielding a reliable and accurate solution.</li>
<li>TUFLOW HPC uses an advanced multi-criteria adaptive time-stepping
approach. It includes the ability to revert back in time should a
numerical inconsistency occur, thereby providing excellent numerical
stability.</li>
<li>The solution scheme includes all the key physics, including representation of inertia
and sub-grid turbulence. Comprehensive benchmarking against
theoretical solutions, flume scale measurements, and high quality
real-world calibration data, demonstrates superior accuracy across all
scales from small flumes to major rivers using default physical
coefficients and industry standard Manning’s n values. A summary of
TUFLOW HPC’s solution is:
<ul>
<li>Finite volume solution scheme that demonstrates 100% volume
conservation.</li>
<li>2<sup>nd</sup> order spatial scheme that avoids numerical diffusion
issues experienced by other mainstream software that typically use
1<sup>st</sup> order spatial approximations.</li>
<li>New grid size insensitive sub-grid turbulence (eddy viscosity)
solution. Default sub-grid turbulence parameters produce reliable
results at any model 2D grid scale (centimetres for flume
benchmarking to over 100 metres for large scale catchment
simulations). This advanced feature is not available in TUFLOW
Classic or other hydraulic modelling software.</li>
<li>Sub Grid Sampling (SGS) of ground elevations at sub-cell resolutions
for defining cell storage and cell face conveyance produces more
accurate cell volume estimates and flow exchange between
neighbouring cells at resolutions finer than the 2D grid resolution.
This advanced feature, which is not available in TUFLOW Classic,
offers substantial benefits including exceptional cell size results
convergence for large cells allowing models to be run with
equivalent accuracy in terms of runoff and water levels on much
larger cell sizes than is possible using the traditional approach of
one elevation per cell.</li>
</ul></li>
<li>The solver includes exceptional shock capturing capabilities for
highly transient flow conditions such as hydraulic jumps and dam breaks. It
accommodates both subcritical and supercritical flow regimes.</li>
<li>Supports quadtree fixed grid refinement. This allows the replacement
of one computational cell with four finer resolution cells,
subsequently allowing the modeller to represent features at a finer
resolution when a detailed velocity field is desired, especially in
areas of complex hydraulics. The quadtree feature is extremely easy to
implement, can utilise the SGS feature described above, and
demonstrates industry leading numerical stability. The add-on Quadtree
Module (Section <a href="#QDTorM2DModule-4"><strong>??</strong></a>) is required to access this feature.</li>
</ul>
<p>The CPU version of TUFLOW HPC is provided with the standard TUFLOW
Classic/HPC licence, noting that when run on a single CPU, TUFLOW HPC typically
demonstrates slower simulation speed performance than TUFLOW Classic due to
Classic’s implicit (large timestepping) solution. As such, TUFLOW HPC is rarely
used in CPU mode except for small models. To achieve the impressive
simulation speeds mentioned above, the add-on GPU Module
(Section <a href="#GPUHardware-4"><strong>??</strong></a>) is required for TUFLOW HPC simulations utilising NVIDIA GPU
hardware.</p>
<p>For legacy reasons, TUFLOW Classic is the default 2D fixed grid solver.
The TUFLOW HPC solver is activated by specifying the command, <tcmd><a href="#tcfSolutionScheme">Solution
Scheme</a></tcmd><teq> == </teq><tblk>HPC</tblk>. To instruct TUFLOW HPC to use GPU hardware use the
command, <tcmd><a href="#tcfHardware">Hardware</a></tcmd><teq> == </teq><tblk>GPU</tblk>.</p>
<h3 class="hasAnchor" id="TUFLOW1D-3"><span class="header-section-number">1.1.3</span> TUFLOW 1D (ESTRY) – 1D Solver<a href="#TUFLOW1D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW 1D (also known as ESTRY) solves the full one-dimensional (1D)
free-surface St Venant flow equations using a Runge-Kutta explicit
solver. TUFLOW 1D has seen continuous development and application use
since 1972 and is today one of the leading 1D solvers of open channels
and pipe networks.</p>
<p>The network schematisation technique used by TUFLOW 1D allows realistic
simulation of a wide variety of 1D and quasi-2D situations including
complex river geometries, associated floodplains and estuaries and
urban channel and pipe network systems. There is a considerable amount
of flexibility in the way network elements can be interconnected,
allowing the representation of a river and floodplain by many parallel
channels with different resistance characteristics and the simulation of
braided streams and rivers with complex branching, or pipe networks with
tens of thousands of conduits, manholes and inlet pits. This flexibility
allows for a variable resolution within the network so that areas of
particular interest can be modelled in fine detail, with a coarser
network representation being used elsewhere.</p>
<p>In addition to the traditional open channel flow cross-section channels,
a wide range of additional 1D channel types are available including:</p>
<ul>
<li>Circular, rectangular (box), and irregular (various shapes or
user-defined) shaped culverts</li>
<li>Pit inlets and manholes</li>
<li>Bridges</li>
<li>Weirs (including broad-crested, sharp edged, V-notch, ogee, crump and
user defined)</li>
<li>Spillways, radial gates, sluice gates</li>
<li>Pumps</li>
<li>User defined structures (stage-discharge curve; discharge matrix)</li>
<li>Operational controls on most structures (weirs, gates, pumps, etc)</li>
</ul>
<p>All channel types can be specified as uni-directional, which allows flow
in only one direction (using the digitised direction). Most can also be
operated via user defined logical controls. The solver can handle both
subcritical and supercritical flow regimes.</p>
<p>TUFLOW 1D is documented in Section <a href="#OneD-Domains-1"><strong>??</strong></a>. 1D/2D domain linking is discussed in Section <a href="#DomainLinking-1"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="SWMM1D-3"><span class="header-section-number">1.1.4</span> EPA SWMM – 1D Solver<a href="#SWMM1D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW has supported 1D/2D dynamic coupling since its initial 2D solver development in 1989. Traditionally, 1D linking and associated modeling has been applied using the TUFLOW 1D (ESTRY) solver (see Section <a href="#TUFLOW1D-3"><strong>??</strong></a>). New in the 2023-03-AF release, TUFLOW’s 1D linking and solver options have been expanded to support the US EPA Storm Water Management Model (referred to herein as SWMM). As such, 1D pipe networks can now be modelled using either the TUFLOW 1D, SWMM, or a combination of the two 1D solvers. In addition to this, extra functionality, such as SWMM hydrology and SWMM Low-impact developments (LIDs) features, can now be used in TUFLOW.</p>
<p>SWMM 1D is documented in Section <a href="#OneD-SWMM-1"><strong>??</strong></a>. 1D/2D domain linking is discussed in Section <a href="#DomainLinking-1"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="AddonModules-3"><span class="header-section-number">1.1.5</span> Add-on Modules<a href="#AddonModules-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The add-on modules require the relevant module licence in order to use the requested module functionality. Should you not currently have the required module licence, please contact <a href="mailto:sales@tuflow.com" class="email">sales@tuflow.com</a>.</p>
<p>The add-on modules are:</p>
<ul>
<li><a href="#ADModule-4">Advection Dispersion</a><br />
</li>
<li><a href="#TUFLOWCATCH-4">CATCH</a></li>
<li><a href="#GPUHardware-4">GPU Hardware</a></li>
<li><a href="#QDTorM2DModule-4">Quadtree or Mutiple 2D Domain</a></li>
</ul>
<h4 class="hasAnchor" id="ADModule-4"><span class="header-section-number">1.1.5.1</span> Advection Dispersion (AD) Module<a href="#ADModule-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW’s AD (Advection Dispersion) module is available for TUFLOW
Classic and HPC. It provides the capability to simulate constituent fate
and transport in receiving waters. It is applicable to:</p>
<ul>
<li>Mixing in inland waterways</li>
<li>Fate of dissolved constituent plumes</li>
<li>Flushing assessments</li>
<li>Advanced atmospheric heat exchange routines simulating thermal mixing
and plumes</li>
</ul>
<p>TUFLOW’s AD User Manual, previously a separate document, has been integrated into this manual, see Chapter <a href="#AD-1"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="TUFLOWCATCH-4"><span class="header-section-number">1.1.5.2</span> TUFLOW CATCH Module<a href="#TUFLOWCATCH-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The TUFLOW CATCH module facilitates seamless simulation of whole-of-catchment hydrologic, hydraulic, pollutant export and receiving waterway processes. It supports 1D, 2D and 3D simulation of these process from the very top of catchment to the receiving waterway outlet via accurate numerical simulation of the key physics that drive catchment / receiving water hydrodynamics.</p>
<p>A TUFLOW CATCH module licence enables both the pollutant generation features in TUFLOW HPC, and TUFLOW HPC to TUFLOW FV automated boundary condition information transfer functionally. It also provides an option for coordinated execution of linked TUFLOW HPC and TUFLOW FV models.</p>
<p>Documentation for the TUFLOW CATCH module is available in the <a href="https://docs.tuflow.com/catch/manual/2024.2/">TUFLOW CATCH User Manual</a>.</p>
<h4 class="hasAnchor" id="GPUHardware-4"><span class="header-section-number">1.1.5.3</span> GPU Hardware (GPU) Module<a href="#GPUHardware-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW’s GPU module provides TUFLOW HPC access to NVIDIA GPU hardware
(cards). Modern GPU cards have large numbers of processing cores (at the
time of writing a single card may have in excess of 10,000 cores). By
utilising multiple GPU cores, substantial reductions in run time can be
achieved, with the benefits most pronounced for large models
(&gt;1,000,000 2D cells).</p>
<p>TUFLOW HPC was linked with TUFLOW’s 1D solver in 2017. This update means
simulations including TUFLOW’s world-leading 1D/2D link functionality
can be run with the TUFLOW HPC 2D calculations utilising GPU hardware. Prior to the 2017 release
the GPU hardware module was limited to 2D only applications.</p>
<p>The runtime benefits of the GPU hardware module make it extremely
powerful for modelling situations with millions of cells. Models of this
size may have otherwise been too computationally intensive for a CPU
based solution. As such, TUFLOW HPC run using GPU hardware is
well-suited to accurate assessment of:</p>
<ul>
<li>Large-scale overland flow situations, using direct rainfall applied to
the hydraulic model or via external inflows sourced from a hydrologic
model;</li>
<li>Integrated urban drainage assessments, where high resolution detail is
required to depict the urban topography and it’s interaction with 1D
features representing the underground pipe network; and</li>
<li>Fine-scale (high resolution) modelling.</li>
</ul>
<h4 class="hasAnchor" id="QDTorM2DModule-4"><span class="header-section-number">1.1.5.4</span> Quadtree or Multiple 2D Domain (M2D) Module<a href="#QDTorM2DModule-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW’s Quadtree or M2D (Multiple 2D Domain) Module allows 2D cell
sizes to vary across the 2D model. The Quadtree feature is available
using TUFLOW HPC, whilst the M2D feature is available using TUFLOW
Classic. Access to a single licence of the Quadtree/M2D Module allows
the user to apply either feature, depending on whether the TUFLOW Classic or
TUFLOW HPC solver is specified.</p>
<p><strong>TUFLOW HPC Quadtree Module</strong></p>
<p>For TUFLOW HPC, the Quadtree Module allows variable 2D cell sizes using
a quadtree grid. A quadtree grid is constructed by dividing a single
cell into four cells, with these cells able to be divided into four, and
so on, enabling modellers to use larger cells in areas of uniform terrain
(eg. large flat floodplains, parks) and smaller cells where the terrain
is variable or along primary flow paths (eg. river channels, roads, open
channels). The benefits include:</p>
<ul>
<li>Much improved hydraulic computational delineation where most needed,
particularly where higher resolution velocity based calculations and
outputs are required.</li>
<li>Smaller memory footprint on the CPU or GPU as a flexible grid structure is used
rather than bounding rectangles, which include a large percentage of
inactive cells that consume memory.</li>
<li>Often a much reduced total cell count typically leading to faster
simulations by a factor of 2 to 5.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-QuadtreeStructure"></span>
<img src="images/QuadtreeStructure.png" alt="**TUFLOW Quadtree Structure**" width="40%" />
<p class="caption">
Figure 1: <strong>TUFLOW Quadtree Structure</strong>
</p>
</div>
</center>
<p><strong>TUFLOW Classic Multiple 2D Domain (M2D) Module</strong></p>
<p>For TUFLOW Classic, the M2D Module provides the capability to nest areas
of finer mesh resolution within a coarser resolution fixed grid domain.
A key feature of the TUFLOW M2D Module is the ability to have multiple
domains at different orientations to each other. TUFLOW also provides
full flexibility regarding the nesting extent. Multiple 2D domain
modelling is discussed in Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.</p>
<h2 class="hasAnchor" id="TUFLOWWebinars-2"><span class="header-section-number">1.2</span> TUFLOW Webinars<a href="#TUFLOWWebinars-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The TUFLOW team run regular educational webinars online that aim to
teach modellers, TUFLOW or otherwise, the fundamentals of hydraulic
modelling. The webinars are free to watch live and can be viewed
afterwards at no cost. Visit the <a href="https://www.tuflow.com/library/webinars/">TUFLOW Website Webinar
Page</a> to register for upcoming
events, or to watch recordings of past webinars. At the time of writing,
the following webinars have been recorded and are available for viewing.
New topics and recordings will continue to be added as they are
produced.</p>
<ul>
<li><p><a href="https://www.tuflow.com/library/webinars/#aug2024_swmm_modeling">August 2024: Improving SWMM Modeling with GIS Tools</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#jul2024_efficient_model_automation">July 2024: Efficient Model Running With Automation</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#apr2024_wq_model_validation">April 2024: Water Quality Model Validation / Mass Balance Analysis</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#mar2024_benchmark_hydraulic">March 2024: How to Benchmark your Hydraulic Solve</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#nov2023_flood_forecasting">November 2023: Real-time Flood Forecasting</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#oct2023_integrated_water_modelling">October 2023: Integrated Catchment &amp; Receiving Water
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#sep2023_sediment_transport">August 2023: Sediment Transport Modelling
Applications</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#aug2023_computer_hardware">June 2023: Computer Hardware Purchase Advice for Hydraulic
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#apr2023_water_quality_2">April 2023: Water Quality Modelling - Part
2</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#feb2023_flood_modelling">February 2023: Flood Modelling
101</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#nov2022_hydraulic_modelling_bridge">November 2022: 1D, 2D, 3D Hydraulic Modelling of
Bridges</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#oct2022_quality_control">October 2022: Flood Modelling Quality
Control</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#sep2022_hydrodynamic_modelling">September 2022: Applied Hydrodynamic Modelling - Part
2</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#jul2022_hydrodynamic_modelling">July 2022: Applied Hydrodynamic Modelling - Part
1</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#june2022_flood_rm">June 2022: Flood Risk
Management</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#may2022_coastal_wq">May 2022: Coastal Water Quality
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#202204_operation_control">April 2022: Operational Structure
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#mar2022_3d_coastal_hd">March, 2022: 3D Coastal
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#urban_pipes">February 2022: Urban Pipe Network
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#nov2021_wq_lakes">November 2021: Modelling Water Quality in
Lakes</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#structures">October 2021: Modelling Energy Losses at
Structures</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#tsunami">September 2021: Tsunami, Dam Failure and Non-Newtonian
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#nextgen">July 2021: Next Generation 2D Hydraulic
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#maximise_accuracy">June 2021: Maximising Hydraulic Model
Accuracy</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#may2021_coastal101">May 2021: Coastal Modelling
101</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#202104_cal">April 2021: Hydraulic Model Calibration to Historic
Events</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#202103_wq">March 2021: The Future of Water Quality
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#feb2021_direct_rainfall">February 2021: Is Direct Rainfall (Rain-on-Grid)
Accurate?</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#dec2020_sed_tran">December 2020: 2D and 3D Sediment Transport
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#nov2020_2d_cell_size">November 2020: 2D Cell Size Selection for Accurate Hydraulic
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/#oct2020_hardware">October 2020: Hardware Selection and Trends in Hydraulic
Modelling</a></p></li>
<li><p><a href="https://www.tuflow.com/library/webinars/">More…</a></p></li>
</ul>
<h2 class="hasAnchor" id="ModellingEnvironment-2"><span class="header-section-number">1.3</span> Modelling Environment<a href="#ModellingEnvironment-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW offers a very powerful and workflow efficient
approach to modelling. The approach combines simple and easy to produce control
files or scripts together with the power of GIS software.</p>
<p>The fundamental software for building TUFLOW models and viewing results
are a text editor, spreadsheet software and GIS software, as shown in Table <a href="#tab:tab-ModellingEnvironment">1</a>. The free‑to‑use TUFLOW Viewer QGIS Plugin greatly
enhances a modeller’s ability to quickly view time-series and map
outputs, animate results and compare different simulations. The TUFLOW
Viewer is documented on the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW
Wiki</a>.</p>
<p>TUFLOW’s implementation of this GIS based modelling environment approach
offers major benefits, including:</p>
<ul>
<li>TUFLOW scripts (control files) allow modellers to readily and easily
setup, modify and run numerous simulations, whether it be different
calibration events, a batch of design events or various what-if
scenarios investigating flood mitigation options.</li>
<li>The modelling framework avoids the duplication of input datasets
during the versioning of models. For example, the base DEM might be
used by hundreds or thousands of simulations during a study, but it
only needs to exist once; there is no need to copy the DEM for each
simulation as is the case for GUI-based software.</li>
<li>TUFLOW benefits from the unparalleled power of GIS as a “work
environment”. GIS software are industry leaders at efficiently
managing large, complex and numerous spatial datasets.</li>
<li>GIS includes a suite of excellent data management, manipulation and
presentation tools. The QGIS TUFLOW Viewer Plugin greatly enhances
modellers’ ability to setup and view models and results.</li>
<li>Working directly in GIS means model input data is geographically
referenced, not 2D grid referenced, this supports workflow efficient
model updates (such as changes to the model 2D cell size specification
or boundary condition locations).</li>
<li>Model results are written to non-proprietary open data formats
compatible with most GIS software. This facilitates the efficient
production of high-quality GIS based mapping for reports, brochures,
plans and displays.</li>
<li>TUFLOW is compatible with numerous different GIS packages (e.g.
ArcGIS, QGIS and MapInfo). Modellers can chose to use the GIS software
package of their choice.</li>
<li>Seamless handover of model inputs and results to clients requiring
data in GIS format. Clients are not required to purchase a TUFLOW
licence to view results.</li>
<li>Superior data and modelling quality control.</li>
</ul>
<p>Section <a href="#HowtoBuildYourFirstModel-2"><strong>??</strong></a> outlines a variety of software packages available for
constructing TUFLOW models and visualising simulation results. It lists
a range of GIS software and also third party Graphical User Interface
(GUI)’s options from TUFLOW’s partner organisations. This manual focuses
on TUFLOW’s modelling within the GIS environment. For documentation
relating to third-party TUFLOW GUIs, please refer to the third party’s
product manual.</p>
<table>
<caption>
<span id="tab:tab-ModellingEnvironment">Table 1: </span><strong>TUFLOW Modelling Environment</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Software
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 5cm; ">
A <b>Text Editor</b> is used to create and edit TUFLOW simulation control files. The control files list all the simulation commands and file path references to the above mentioned GIS and tabular datasets.
</td>
<td style="text-align:left;width: 12cm; ">
<img src="images/image4.png">
</td>
</tr>
<tr>
<td style="text-align:left;width: 5cm; ">
<b>Spreadsheet Software </b>is used to tabulate time-series and other non-geographically located data.
</td>
<td style="text-align:left;width: 12cm; ">
<img src="images/image5.png">
</td>
</tr>
<tr>
<td style="text-align:left;width: 5cm; ">
<p><b>GIS Software</b> is used to set up, modify, thematically map and manage all geographic inputs and to view simulation results.</p>
QGIS’s TUFLOW Viewer Plugin greatly enhances the modelling experience.
</td>
<td style="text-align:left;width: 12cm; ">
<img src="images/image6.png">
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="LimitationsandRecommendations-2"><span class="header-section-number">1.4</span> Limitations and Recommendations<a href="#LimitationsandRecommendations-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW is designed to model free-surface flow in coastal waters,
estuaries, rivers, creeks, floodplains and urban drainage systems using
the 1D St Venant Equations (all physical terms) and the 2D form of the
free surface Navier-Stokes equations (all physical terms) often referred
to as the Shallow Water Equations (SWE). Flow regimes through structures
are handled using standard structure equations covering all flow
regimes, and supercritical upstream controlled flow is supported in the
1D and 2D solvers. The 2<sup>nd</sup> order spatial solutions produce
negligible numerical diffusion. TUFLOW HPC also supports non-Newtonian
flow and mixed flow (Newtonian and non-Newtonian).</p>
<p>However, all solutions are approximations to reality. Whilst TUFLOW’s
solvers have industry leading accuracy and have been comprehensively
benchmarked to known solutions or measurements, they have their
limitations, with the key ones discussed below.</p>
<ul>
<li><p>All models, irrespective of the software, require a sufficiently fine
computational resolution to not limit the model’s accuracy.
Demonstrating results convergence, that is that the results do not
demonstrably change when the computational interval (timestep) or 2D
cell size is reduced, is an important quality control test. TUFLOW’s
solvers have been extensively benchmarked for results convergence and
new features such as TUFLOW HPC’s Sub-Grid Sampling (SGS) can greatly
assist with improving results convergence. However, no matter the
solution or software, results convergence testing during the model
design phase should be a standard test.</p></li>
<li><p>Where super-critical flow occurs the results should be treated with
caution, particularly if they are in key areas of interest. Hydraulic
jumps and surcharging against obstructions are complex 3D flow
phenomena. For example, for hydraulic jumps, 1D solutions simply show a
change from supercritical to subcritical flow from one computational
point to the next. Both TUFLOW Classic and TUFLOW HPC 2D solvers will handle the
transition and provide higher resolution output than 1D. However, TUFLOW HPC
will produce a more accurate solution due to its shock capturing
formulation. Where vertical acceleration is important, such as flow
down a dam spillway face, both the 1D and 2D equations are not suited
to modelling the flow in detail, however, the quantity of flow passing
through such a structure can be well represented by using a spillway
structure in 1D or for TUFLOW HPC varying the weir flow parameters
introduced for the 2023‑03 release.</p></li>
<li><p>The TUFLOW HPC Wu turbulence model, as of the 2020‑01 release, is
recommended over the Smagorinsky eddy viscosity formulation, which in
turn is preferred over the constant viscosity formulation to model
sub-cell turbulence <span class="citation">(<a href="#ref-Barton2001">Barton, 2001</a>; <a href="#ref-Collecutt2020">Collecutt et al., 2020</a>)</span>. As of
the 2020-01 release, the default approach for TUFLOW HPC is the Wu turbulence
model and for TUFLOW Classic the Smagorinsky approach (as the Wu model
has not yet been built into the Classic solver). It is always good
practice to carry out sensitivity tests to ascertain the importance of
the sub-cell turbulence coefficient(s) and formulation, which will be
most influential where the bed friction is low (e.g. in tidal reaches
and coastal waters) and where there are significant changes in
velocity direction and magnitude, causing sub-grid shear effects (e.g.
downstream of a constriction).</p>
<p>If using the Smagorinsky formulation, caution is needed when using 2D
cell sizes where the flow depth is larger than the cell width <span class="citation">(<a href="#ref-Barton2001">Barton, 2001</a>; <a href="#ref-Collecutt2020">Collecutt et al., 2020</a>)</span>. Modelling on a fine resolution where
water depths are greater than the cell size will likely not produce
converging results with decreasing cell size. For this reason, the
default in TUFLOW Classic since the 2000s is the combination of the
Smagorinsky formulation with a constant eddy
viscosity. This is because the Smagorinsky formulation tends to a no
turbulence state with reducing cell size, with the small addition of
constant eddy viscosity offsetting this trend.</p>
<p><span class="citation">Collecutt et al. (<a href="#ref-Collecutt2020">2020</a>)</span> demonstrates that the constant
coefficient is heavily dependent on the 2D cell size and needs to be
calibrated. The default Smagorinsky and constant coefficients in
TUFLOW Classic can be considered suitable for most real-world
applications where the cell size is similar or greater than the depths
in the main flowpaths.</p>
<p>The Wu turbulence model (default setting in TUFLOW HPC from the
2020‑01 release) resolves the above issues with benchmarking
demonstrating 2D models can confidently be constructed and utilised across a
wide range of cell sizes (flume scale to major rivers), even when much
less than the depth <span class="citation">(<a href="#ref-Collecutt2020">Collecutt et al., 2020</a>)</span>.</p></li>
<li><p>Modelling of hydraulic structures should always be cross-checked with
desktop calculations or other software, especially if calibration data
is unavailable and/or the structures are located in key areas. All 1D
and 2D schemes are only an approximation of the complex 3D flows that
can occur through a structure, and regardless of the software used,
the modeller should check model performance <span class="citation">(<a href="#ref-SymeNielsen1998">Syme et al., 1998</a>; <a href="#ref-Syme2001a">Syme, 2001a</a>)</span>.</p></li>
<li><p>There is no momentum transfer between 1D and 2D connections when using
the sink/source connection approach (SX link). The HX link does
preserve momentum in the sense that the velocity field is assumed to
be undisturbed across the link, but the velocity direction is not
influenced by the direction of the linked 1D channel. In most
situations these assumptions are not of significant concern, however,
they may influence results where a large structure (relative to the 2D
cell size) is modelled as a 1D element. Under such circumstances,
TUFLOW has a range of options for modelling large structures in the 2D
solution scheme. Modelling fully in 2D will preserve the momentum
transfer.</p></li>
</ul>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="GettingStarted-1"><span class="header-section-number">2</span> Getting Started<a href="#GettingStarted-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="HowtoBuildYourFirstModel-2"><span class="header-section-number">2.1</span> How to Build Your First Model<a href="#HowtoBuildYourFirstModel-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW includes a wide range of self-education resources to aid
new users. Available options include online
tutorials, example models, demonstration models and eLearning modules.
All models included or constructed when completing these self-education
options have been designed using a licence-free mode. As such, there is
no need to purchase a software licence to learn TUFLOW.</p>
<p>All TUFLOW self-education resources are fully supported via the <a href="https://www.tuflow.com/support/">TUFLOW
Support Services</a>, and <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> can be contacted for support.</p>
<p>As an alternative to self-education, paid online and in-person
training classes are also available for learning under
the guided instruction of a TUFLOW expert. Courses are advertised via the
<a href="https://www.tuflow.com/training/training-catalogue/">TUFLOW Website Training
Catalogue</a>. For
further information on paid training options please contact
<a href="mailto:training@tuflow.com" class="email">training@tuflow.com</a>.</p>
<h3 class="hasAnchor" id="TutorialModels-3"><span class="header-section-number">2.1.1</span> Tutorial Models<a href="#TutorialModels-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A number of free Tutorial Models are available for download and are documented in
the <a href="https://wiki.tuflow.com/Tutorial_Introduction">TUFLOW Wiki</a>.
Current tutorials include:</p>
<ul>
<li><a href="https://wiki.tuflow.com/Tutorial_M01">Module 1 - 2D Base
Model</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M02">Module 2 - Topography
Updates</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M03">Module 3 - 1D
Culverts</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M04">Module 4 - 2D Bridges</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M05">Module 5 - Integrated Urban
Drainage</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M06">Module 6 - Direct
Rainfall</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M07">Module 7 - Quadtree</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M08">Module 8 - Scenario
Management</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M09">Module 9 - Event
Management</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M10">Module 10 - Dam Break</a></li>
<li><a href="https://wiki.tuflow.com/Tutorial_M11">Module 11 - 1D Open
Channel</a></li>
</ul>
<p>The tutorials have been created using QGIS as the model development
environment. It is strongly recommended that new users
complete our free <a href="https://www.tuflow.com/training/training-catalogue/tt001e-introduction-to-qgis-for-tuflow-elearning/">Introduction to QGIS for TUFLOW
eLearning</a>
beforehand.</p>
<h3 class="hasAnchor" id="ExampleModels-3"><span class="header-section-number">2.1.2</span> Example Models<a href="#ExampleModels-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Free Example Models are documented and are available for download via
the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">TUFLOW Wiki</a>. The
example model dataset includes over 150 standalone models demonstrating
the most commonly used TUFLOW features. This education resource is
intended for experienced modellers wishing to further develop their
skills following completion of the
<a href="https://wiki.tuflow.com/Tutorial_Introduction">Tutorial Models</a>. Unlike
the tutorials, this dataset does not include step-by-step instructions.
Users of this dataset are expected to have a basic knowledge TUFLOW, and
have suitable skills to open the model files by referencing the TUFLOW
Control File (TCF) referenced in the example model catalogue list. The
catalogue list on the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">TUFLOW
Wiki</a> has been separated
into the following sub-sections:</p>
<ul>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Project_Initiation">Project initiation</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Model_Units">Model units</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Solver_Options">Solver options</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Output_Options">Output options</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Boundary_Condition_Options">Boundary condition options (inflows, outflows and
losses)</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Topography_Features">Topography features (static and dynamic topography changes, sub-grid
sampling options)</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Structures">Structures (bridges, weirs, culverts, operational
controls)</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Multiple_Domain_Model_Design">Multiple domain model design (1D/2D and
2D/2D)</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Bulk_Simulation_Management">Bulk simulation</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Advection_Dispersion">Advection dispersion.</a></li>
</ul>
<h3 class="hasAnchor" id="DemonstrationModels-3"><span class="header-section-number">2.1.3</span> Demonstration Models<a href="#DemonstrationModels-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A series of demonstration models were developed as part of three
“challenges” issued prior to the 2012 Flood Managers Association (FMA)
Conference in Sacramento, USA. The objective was to establish the
variation in flood extents using different 2D software and modellers.
Anyone could submit results, and the results were presented anonymously
at the 2D Modelling Symposium held on the first day of the conference.</p>
<p>The three Challenge Models were:</p>
<ul>
<li>Challenge 1: An urban environment with a concrete lined main channel
and numerous structures.</li>
<li>Challenge 2: A coastal floodplain with two river entrances to the
ocean during a flood.</li>
<li>Challenge 3: A levied river within an alluvial fan in an arid, irrigated area.</li>
</ul>
<p>The models developed using TUFLOW were created within a week and run for
various scenarios. Positive feedback was received on TUFLOW’s accuracy,
and on the impressively short turnaround time required to build the
models and run the simulations. The Free Demonstration Models are
documented and are available for download from the <a href="https://wiki.tuflow.com/FMA_Challenge_Models_Introduction">TUFLOW
Wiki</a>.</p>
<h3 class="hasAnchor" id="LicenceFreeDemoMode-3"><span class="header-section-number">2.1.4</span> Licence Free Demo Mode<a href="#LicenceFreeDemoMode-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As of the 2016-03 release, setting <tcmd><a href="#tcfDemoModel">Demo Model </a></tcmd><teq>==</teq><tblk> ON</tblk> within
the TCF allows users to set up and simulate small-scale test models using their own datasets, but without a licence. The
limits associated with the licence-free demo mode are:</p>
<ul>
<li>The total number of 2D cells may not exceed 100,000 – this is the
number of cells within the bounding rectangle.</li>
<li>The total number of active 2D cells may not exceed 30,000.</li>
<li>The total number of 1D channels may not exceed 100.</li>
<li>There is only one (1) 2D domain.</li>
<li>Simulation clock time cannot exceed 10 minutes.</li>
</ul>
<h3 class="hasAnchor" id="eLearningModules-3"><span class="header-section-number">2.1.5</span> eLearning Modules<a href="#eLearningModules-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW eLearning is a suite of online guided training modules available on-demand. The eLearning includes step-by-step lessons comprising a
combination of written notes, background content videos, demonstration
videos and hands-on exercises. The list of available eLearning modules
is growing year-on-year. The current available catalogue includes:</p>
<ul>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt001e-introduction-to-qgis-for-tuflow-elearning/">Introduction to QGIS for
TUFLOW</a></li>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt102e-introduction-to-2d-modelling-elearning/">Introduction to 2D Modelling
TUFLOW</a></li>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt004e-introduction-to-python-for-tuflow-elearning/">Introduction to Python for
TUFLOW</a></li>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt005e-introduction-to-gdal-for-tuflow-elearning/">Introduction to GDAL for
TUFLOW</a></li>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt103e-2d-topographic-layering-and-modification-options-elearning/">2D Topography and Modification
Options</a></li>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt104e-1d-culvert-and-2d-bridge-modelling-elearning/">1D Culvert and 2D Bridge
Modelling</a></li>
<li><a href="https://www.tuflow.com/training/training-catalogue/tt105e-bulk-simulation-management-scenarios-user-defined-variables-and-events-elearning/">Bulk Simulation
Management</a></li>
</ul>
<p>Access the eLearning via the <a href="https://www.tuflow.com/training/training-catalogue/#!d=e-learning">TUFLOW Website Training
Catalogue</a>.</p>
<h3 class="hasAnchor" id="InstructorLedTUFLOWTrainingCourses-3"><span class="header-section-number">2.1.6</span> Instructor Led TUFLOW Training Courses<a href="#InstructorLedTUFLOWTrainingCourses-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As an alternative to self-education, paid online and in-person
training classes are also available to learn under
the guided instruction of a TUFLOW expert. Scheduled courses are advertised via the
<a href="https://www.tuflow.com/training/training-catalogue/">TUFLOW Website Training
Catalogue</a>. For
further information on paid training options please contact
<a href="mailto:training@tuflow.com" class="email">training@tuflow.com</a>.</p>
<h2 class="hasAnchor" id="TheTUFLOWModellingConcept-2"><span class="header-section-number">2.2</span> The TUFLOW Modelling Concept<a href="#TheTUFLOWModellingConcept-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The fundamental software necessary for building a TUFLOW model and
viewing simulation results are:</p>
<ul>
<li><strong>Text editor</strong>. Used to create and edit TUFLOW simulation control
files. The control files list all the simulation commands and file
path references to the above mentioned GIS and tabular datasets.</li>
<li><strong>Spreadsheet software</strong>. Used for time-series and other
non-geographically located data.</li>
<li><strong>GIS software</strong>. Used to create, modify and manage all geographic
inputs and to view simulation results.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image7"></span>
<img src="images/image7.png" alt="TUFLOW Modelling Concept" width="80%" />
<p class="caption">
Figure 2: TUFLOW Modelling Concept
</p>
</div>
</center>
<p>User survey results consistently indicate that the
majority of TUFLOW modellers globally use the text editor / spreadsheet
/ GIS working environment approach. Within that framework, the most
popular supporting software combination is Notepad++, Excel and QGIS
(with the free QGIS TUFLOW Plugin). Due to the dominant usage of these
supporting software packages, detailed information for Notepad++ and QGIS is
provided in Sections <a href="#Notepad-3"><strong>??</strong></a> and <a href="#QGISTUFLOWViewer-3"><strong>??</strong></a>. Please note,
modellers are not required to use Notepad++, Excel and QGIS. Other
alternative supporting software may be used instead. A complete list of
commonly used options is outlined in Table <a href="#tab:tab-SupportingSoftware">2</a>.
<span class="math inline">\(\newcommand{\blockindent}{\hspace{0.5cm}}\)</span></p>
<table>
<caption>
<span id="tab:tab-SupportingSoftware">Table 2: </span>Supporting Software Options
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Software Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Suggested Software
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Text Editor
</td>
<td style="text-align:left;">
<p><a href="https://www.ultraedit.com/" target="_blank">UltraEdit</a> / <a href="https://wiki.tuflow.com/UltraEdit_Tips" target="_blank">TUFLOW Wiki UltraEdit Tips</a></p>
<p><a href="https://notepad-plus-plus.org/" target="_blank">Notepad++</a> / <a href="https://wiki.tuflow.com/NotepadPlusPlus_Tips" target="_blank">TUFLOW Wiki Notepad++ Tips</a></p>
<p><a href="https://www.textpad.com/home" target="_blank">Textpad</a> / <a href="https://wiki.tuflow.com/TextPad_Tips" target="_blank">TUFLOW Wiki Textpad Tips</a></p>
<p>Visual Studio Code</p>
Other: Any text editor can be used for creating TUFLOW control files, including the Microsoft Windows default, Notepad. However, the above listed editors are recommended. They allow for advanced options, such as <a href="https://tuflow.com/downloads/#utilities"> syntax highlighting</a> of TUFLOW control files and launching TUFLOW simulations from the text editor.
</td>
</tr>
<tr>
<td style="text-align:left;">
Spreadsheet Software
</td>
<td style="text-align:left;">
<p><a href="https://www.microsoft.com/en-au/microsoft-365/excel?legRedir=true&amp;CorrelationId=14d1c262-f832-48dc-8b59-c2c406b7000d" target="_blank">Microsoft Excel</a> / <a href="https://wiki.tuflow.com/Excel_Tips" target="_blank"> TUFLOW Wiki Excel Tips</a></p>
<a href="https://www.libreoffice.org/" target="_blank">Libre Office</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
GIS Platforms
</td>
<td style="text-align:left;">
<p><a href="https://www.qgis.org/" target="_blank">QGIS</a> (<a href="https://wiki.tuflow.com/QGIS_Tips" target="_blank">TUFLOW Wiki QGIS Tips</a>) with QGIS TUFLOW Plugin. The QGIS TUFLOW Plugin provides a range of pre- and post- processing tools, and dynamic viewing of 1D and 2D results in <a href="https://wiki.tuflow.com/TUFLOW_Viewer" target="_blank">TUFLOW Viewer</a>.</p>
<p><a href="https://www.esri.com/en-us/arcgis/products/arcgis-pro/overview" target="_blank">ArcGIS Pro</a> (<a href="https://wiki.tuflow.com/index.php?title=ArcGis_Tips" target="_blank">TUFLOW Wiki ArcGIS Tips</a>) with <a href="http://www.esri.com/software/arcgis/extensions/spatialanalyst" target="_blank">Spatial Analyst</a> for the creation of model inputs and viewing of static results. Dynamic viewing of 1D and 2D results is not available in ArcGIS.</p>
<p><a href="https://www.precisely.com/resource-center/productsheets/mapinfo-pro" target="_blank">MapInfo Professional</a> (<a href="https://wiki.tuflow.com/MapInfo_Tips" target="_blank">TUFLOW Wiki MapInfo Tips</a>) for the creation of model inputs and viewing of static results.</p>
Dynamic viewing of 1D and 2D results is not available in ArcGIS or MapInfo. <a href="https://www.qgis.org/" target="_blank">QGIS</a> (<a href="https://wiki.tuflow.com/QGIS_Tips" target="_blank">TUFLOW Wiki QGIS Tips</a>), <a href="https://www.aquaveo.com/software/sms-surface-water-modeling-system-introduction" target="_blank">SMS</a> (<a href="https://wiki.tuflow.com/SMS_Tips" target="_blank">TUFLOW Wiki SMS Tips</a>) or <a href="https://www.waterride.net/" target="_blank">WaterRIDE</a> are recommended to address these limitations.
</td>
</tr>
<tr>
<td style="text-align:left;">
Other Software
</td>
<td style="text-align:left;">
<p><a href="https://scalgo.com/">Scalgo</a> (<a href="https://wiki.tuflow.com/SCALGO_Live_Tips">TUFLOW Wiki Scalgo Tips</a>)</p>
<p><a href="https://www.aquaveo.com/software/sms-surface-water-modeling-system-introduction" target="_blank">SMS</a> (<a href="https://wiki.tuflow.com/SMS_Tips" target="_blank">TUFLOW Wiki SMS Tips</a>)</p>
<p><a href="https://www.waterride.net/" target="_blank">WaterRIDE</a></p>
<p><a href="https://nrc.canada.ca/en/research-development/products-services/software-applications/blue-kenuetm-software-tool-hydraulic-modellers/" target="_blank">Blue Kenue</a></p>
<a href="https://www.deltares.nl/en/software-and-data/products/delft-fews-platform" target="_blank">FEWS</a>
</td>
</tr>
</tbody>
</table>
<p>For modellers preferring to work predominantly within a Graphical User
Interface (GUI) environment instead of GIS, the following TUFLOW GUI
options are also available:</p>
<ul>
<li><a href="https://www.tuflow.com/Graphical%20User%20Interfaces%20.aspx?SMS">SMS TUFLOW
Interface</a></li>
<li><a href="https://www.12d.com/product/12d_model_tuflow.html">12D TUFLOW Model
Interface</a></li>
<li><a href="https://www.tuflow.com/products/gui-options/#floodmodeller">Flood Modeller Pro</a></li>
<li><a href="https://www.tuflow.com/products/gui-options/#xpswmm">XPSWMM</a></li>
</ul>
<h3 class="hasAnchor" id="Notepad-3"><span class="header-section-number">2.2.1</span> Notepad++<a href="#Notepad-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Notepad++ is a free text editor available from
<a href="https://notepad-plus-plus.org/downloads/" class="uri">https://notepad-plus-plus.org/downloads/</a>. The Notepad++ functionality
listed below makes it well suited as an editor for creating and updating TUFLOW
control files. Click on the respective links in each bullet point for
more information:</p>
<ul>
<li><a href="https://wiki.tuflow.com/NotepadPlusPlus_Highlighting">Syntax Highlighting</a>:
Colour coding of TUFLOW control files, shown in Figure <a href="#fig:fig-image8">3</a>.</li>
<li><a href="https://wiki.tuflow.com/NotepadPlusPlus_Run_TUFLOW">Simulation Execution</a>: The
ability to start a TUFLOW simulation directly from Notepad++.</li>
<li><a href="https://wiki.tuflow.com/NotepadPlusPlus_File_Navigation">File Navigation</a>:
The ability to open files based on the relative reference provided in
a TUFLOW control file. For example a geometry control file (.tgc) can
be opened directly from the TUFLOW control file (.tcf) without having
to locate it in Windows Explorer.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image8"></span>
<img src="images/image8.png" alt="NotePad++ TUFLOW Syntax Highlighting" width="80%" />
<p class="caption">
Figure 3: NotePad++ TUFLOW Syntax Highlighting
</p>
</div>
</center>
<h3 class="hasAnchor" id="QGISTUFLOWViewer-3"><span class="header-section-number">2.2.2</span> QGIS / TUFLOW Viewer<a href="#QGISTUFLOWViewer-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>QGIS is free, open source GIS software available from
<a href="https://www.qgis.org/" class="uri">https://www.qgis.org/</a>. It is an official project of the Open Source
Geospatial Foundation (OSGeo). It runs on Linux, Unix, Mac OSX, Windows
and Android and supports numerous vector, raster, and database formats
and related functionalities.</p>
<p>For users wishing to adopt QGIS as the model development or result viewing
environment, we strongly recommend completing our free <a href="https://www.tuflow.com/training/training-catalogue/tt001e-introduction-to-qgis-for-tuflow-elearning/">Introduction to
QGIS for TUFLOW
eLearning</a>.
It teaches how to configure QGIS for TUFLOW modelling and provides an
entry level overview on how to use the software.</p>
<p>We also recommend installing the free QGIS TUFLOW Plugin. The QGIS
TUFLOW Plugin includes a suite of tools built to increase TUFLOW workflow
efficiency. Installation and use instructions are provided in the QGIS
Tips and Tricks section of the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin#Installation_of_Plugin">TUFLOW
Wiki</a>.</p>
<p>TUFLOW Viewer is included in the QGIS TUFLOW Plugin. As the name
suggests, TUFLOW Viewer upgrades the QGIS Map Window to become a
complete dynamic interactive TUFLOW simulation result viewer. This
addition to QGIS makes the the programme’s functionality comparable to
commercial GUI software. Documentation of the TUFLOW Viewer is located
on the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW
Wiki</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image9"></span>
<img src="images/image9.png" alt=" QGIS with TUFLOW Viewer" width="80%" />
<p class="caption">
Figure 4:  QGIS with TUFLOW Viewer
</p>
</div>
</center>
<h2 class="hasAnchor" id="InstallingandRunningTUFLOW-2"><span class="header-section-number">2.3</span> Installing and Running TUFLOW<a href="#InstallingandRunningTUFLOW-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="TUFLOWDownloadsandInstallation-3"><span class="header-section-number">2.3.1</span> TUFLOW Downloads and Installation<a href="#TUFLOWDownloadsandInstallation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW does not require an installer, but instead simply requires the
user to copy or unzip the downloaded files into a folder. This approach
allows the modeller to have as many releases or versions of TUFLOW
available as required. This is beneficial, as there is often a need to
run or re-run legacy models using older TUFLOW versions. The current
TUFLOW release version, Manual and Release Notes are available via the
TUFLOW website <a href="https://www.tuflow.com/downloads/">Downloads page</a>. All
past TUFLOW versions are available from the <a href="https://www.tuflow.com/downloads/tuflow-classichpc-archive/">Downloads
Archive</a>.</p>
<p>Section <a href="#InstallOverview-3"><strong>??</strong></a> provides more information on downloading and
installing TUFLOW. Detailed step-by-step instructions for new users are
also provided on the <a href="https://wiki.tuflow.com/New_User_Installation_Guide">TUFLOW
Wiki</a>.</p>
<h3 class="hasAnchor" id="Licencing-3"><span class="header-section-number">2.3.2</span> Licencing<a href="#Licencing-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A TUFLOW licence is required to run TUFLOW, but is not required when
using third-party software such as a GIS, text editor or GUI (for
further information refer to Section <a href="#DongleTypesandSetup-3"><strong>??</strong></a> and/or to the
<a href="https://wiki.tuflow.com/TUFLOW_Licensing">installation instructions</a> on
the TUFLOW Wiki). Licences are hosted on hardware locks (e.g. USB lock)
or software locks (e.g. via a configuration file housed on a particular
computer, server or cloud virtual machine). Email <a href="mailto:sales@tuflow.com" class="email">sales@tuflow.com</a>
for a quote to purchase a TUFLOW licence.</p>
<p>TUFLOW can be used licence free for the TUFLOW Tutorials, Example models or when running
TUFLOW using Demo Mode (see Section <a href="#TheTUFLOWModellingConcept-2"><strong>??</strong></a>).</p>
<p>For third-party USB locks that have TUFLOW licences, please refer to the
vendor’s documentation for configuring the licence.</p>
<h3 class="hasAnchor" id="PerformingSimulations-3"><span class="header-section-number">2.3.3</span> Performing Simulations<a href="#PerformingSimulations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW simulations are started by running the TUFLOW executable and
passing the input TUFLOW control file (.tcf). There are a number of ways of
initiating simulations:</p>
<ul>
<li>Running a batch file. Batch files can be used to run single TUFLOW simulations but also
can be set up to loop through events
and scenarios to run a multitude of simulations or to push simulations
to different processors.</li>
<li>From the text editor – ideal for one off simulations, especially
whilst constructing a model.</li>
<li>Directly from GIS software.</li>
<li>Using Microsoft Explorer to right click and run.</li>
<li>Via a GUI, such as the SMS TUFLOW Interface or 12D.</li>
<li>From a Command (Console) Window.</li>
</ul>
<p>Detailed descriptions on running TUFLOW from the above methods are
provided on the <a href="https://wiki.tuflow.com/Running_TUFLOW">TUFLOW Wiki</a>.</p>
<h2 class="hasAnchor" id="FoldersFileTypesandFileNaming-2"><span class="header-section-number">2.4</span> Folders, File Types and File Naming<a href="#FoldersFileTypesandFileNaming-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="FolderStructure-3"><span class="header-section-number">2.4.1</span> Folder Structure<a href="#FolderStructure-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Table <a href="#tab:tab-SubfolderStructure">3</a> presents the recommended set of sub-folders to be set up for a TUFLOW model.
Any folder structure may be used; however, it is strongly recommended
that a system similar to that below be adopted. For large modelling jobs
with many scenarios and simulations, a more complex folder structure may
be warranted, though should be based on that shown below.</p>
<div style="display: flex; justify-content: center; align-items: center;">
<p><img src="images/folder_structure.png" width="150px" /></p>
<table>
<caption>
<span id="tab:tab-SubfolderStructure">Table 3: </span><strong>Recommended
Sub-Folder Structure</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Sub-Folder
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
bc_dbase
</td>
<td style="text-align:left;">
Contains boundary condition database(s) and time-series data for 1D and 2D domains.
</td>
</tr>
<tr>
<td style="text-align:left;">
check
</td>
<td style="text-align:left;">
Contains the GIS and other check files to carry out quality control checks (use <a href="#tcfWriteCheckFiles">Write Check Files</a> command).
</td>
</tr>
<tr>
<td style="text-align:left;">
model
</td>
<td style="text-align:left;">
Contains the .tgc, .tbc and other model data files, except for the GIS layers and grid inputs which are located in the model\gis folder and model\grid folder respectively (see below).
</td>
</tr>
<tr>
<td style="text-align:left;">
model\gis
</td>
<td style="text-align:left;">
Contains the GIS vector layers that are inputs to the 2D and 1D model domains.
</td>
</tr>
<tr>
<td style="text-align:left;">
model\grid
</td>
<td style="text-align:left;">
Contains the GIS raster layers that are inputs to the 2D model domains.
</td>
</tr>
<tr>
<td style="text-align:left;">
results
</td>
<td style="text-align:left;">
Contains the result files (use <a href="#tcfOutputFolder">Output Folder</a> command).
</td>
</tr>
<tr>
<td style="text-align:left;">
runs
</td>
<td style="text-align:left;">
Contains the .tcf and .ecf simulation control files.
</td>
</tr>
<tr>
<td style="text-align:left;">
runs\log
</td>
<td style="text-align:left;">
Contains the log files (e.g. .tlf) and _messages.shp files (use <a href="#tcfLogFolder">Log Folder</a> command)
</td>
</tr>
</tbody>
</table>
</div>
<p>Note:</p>
<ul>
<li><strong>Files can be located relative to the file they are referred from.</strong> For
example, the path and filename of a file referred to in a .tgc file is
sourced <strong>relative to the .tgc file (not the .tcf file).</strong> See also
Section <a href="#FilePath-3"><strong>??</strong></a> for a discussion on absolute and relative file paths.</li>
<li>Whilst TUFLOW readily accepts spaces and special characters (such as !
or #) in filenames and paths, other software may have issues with
these. It is therefore recommended that spaces and other special
characters not be used in the simulation path and filename without
prior testing.</li>
<li>Filenames and extensions are <strong><u>not</u></strong> case sensitive in any
TUFLOW control files.</li>
</ul>
<h3 class="hasAnchor" id="FileTypes-3"><span class="header-section-number">2.4.2</span> File Types<a href="#FileTypes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The most common file types and their extensions are listed in Table <a href="#tab:tab-FileTypesCombined">5</a>. These files are classified into the following use categories:</p>
<ul>
<li><strong>Control Files</strong>: used for directing inputs to the simulation and
setting parameters. The style of input is very simple, free form
commands, similar to writing down a series of instructions. This
offers the most flexible and efficient system for experienced
modellers. It is also easy for inexperienced users to learn.</li>
<li><strong>Data Input Files</strong>: primarily GIS layers defining the spatial inputs
and comma-delimited files generated using spreadsheet software for
tabular data, such as boundary condition time-series entries.</li>
<li><strong>Data Output Files</strong>: containing the 2D and 1D hydraulic simulation
result outputs.</li>
<li><strong>Check Files</strong>: are produced at the beginning of a TUFLOW simulation
so modellers and reviewers can readily check that the constructed model is as intended.
Advanced models draw upon a wide variety of data sources. The check
files represent the final model dataset which is used for the
simulation calculations. For more details, see the <a href="https://wiki.tuflow.com/TUFLOW_Check_Files">TUFLOW Check
Files</a> section of the
TUFLOW Wiki.</li>
</ul>
<table>
<caption>
<span id="tab:tab-FileTypesCombinedControl">Table 4: </span><strong>List of Most Commonly Used File Types - Control Files</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
File
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Extension
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Use Category
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Format
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TUFLOW Simulation Control File
</td>
<td style="text-align:left;">
.tcf
</td>
<td style="text-align:left;">
Controls the data input and output for 2D or 1D/2D simulations. The filename (without extension) is used for naming all 2D domain files.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Boundary Conditions Control File
</td>
<td style="text-align:left;">
.tbc
</td>
<td style="text-align:left;">
Controls the 2D boundary condition data input.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Event File
</td>
<td style="text-align:left;">
.tef
</td>
<td style="text-align:left;">
Database of .tcf and .ecf file commands for different events.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Geometry Control File
</td>
<td style="text-align:left;">
.tgc
</td>
<td style="text-align:left;">
Controls the 2D geometric or topographic data input.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Quadtree Control File
</td>
<td style="text-align:left;">
.qcf
</td>
<td style="text-align:left;">
Controls the construction of a Quadtree grid.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
ESTRY Simulation Control File
</td>
<td style="text-align:left;">
.ecf
</td>
<td style="text-align:left;">
Controls the data input and output for 1D domains. The filename (without extension) is used for naming all 1D output files.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Operating Controls File
</td>
<td style="text-align:left;">
.toc
</td>
<td style="text-align:left;">
Contains operating rules that can be applied to hydraulic structures, pumps and other controllable devices modelled as 1D elements. Each set of operating rules is contained within a Control definition. More than one structure/device can use the same control definition.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Rainfall Control File
</td>
<td style="text-align:left;">
.trfc
</td>
<td style="text-align:left;">
Contains the input data to temporally and spatially apply rainfall including the interpolation of rainfall gauge data over time.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW AD Control File
</td>
<td style="text-align:left;">
.adcf
</td>
<td style="text-align:left;">
Contains reference to the two mandatory files required for the advection-dispersion (AD) model execution.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW External Stress File
</td>
<td style="text-align:left;">
.tesf
</td>
<td style="text-align:left;">
Controls the input data for time-varying global or spatially-varying external forcing such as wind or wave radiation stresses.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
Read Files
</td>
<td style="text-align:left;">
.trd<br />
.erd<br />
.rdf
</td>
<td style="text-align:left;">
A file that is included inside another file using the <tcmd><a href="#tcfReadFile">Read File</a></tcmd> command in .tcf, .tgc and .ecf files. Minimises repetitive specification of commands common to a group of files. The file extension can be anything; .trd, .erd and .rdf are most commonly used.
</td>
<td style="text-align:left;">
Control File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-FileTypesCombined">Table 5: </span><strong>List of Most Commonly Used File Types - Input, Output and Check File Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
File
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Extension
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Use Category
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Format
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TUFLOW Materials File
</td>
<td style="text-align:left;">
.tmf<br />
.csv
</td>
<td style="text-align:left;">
Sets the Manning’s n values for different bed material categories in the 1D and 2D domains.
</td>
<td style="text-align:left;">
Input File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Soils File
</td>
<td style="text-align:left;">
.tsoilf
</td>
<td style="text-align:left;">
Sets the infiltration method and infiltration parameters for different soil types in the 2D domains.
</td>
<td style="text-align:left;">
Input File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
Fixed Field Files
</td>
<td style="text-align:left;">
variety of extensions
</td>
<td style="text-align:left;">
New models do not require or support any fixed field input. However, older models (prior to the 2010-10 release) could utilise these formats. As the commands are no longer supported the fixed field documentation has been removed from this manual – see manuals prior to 2007 downloadable from <a href="https://www.tuflow.com">TUFLOW Website</a>.
</td>
<td style="text-align:left;">
Input File<br />
Output File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Restart File
</td>
<td style="text-align:left;">
.trf
</td>
<td style="text-align:left;">
A snapshot of 2D domain computational results at an instant in time, used for hot-restart of simulations.
</td>
<td style="text-align:left;">
Input File<br />
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
ESTRY Restart File
</td>
<td style="text-align:left;">
.erf
</td>
<td style="text-align:left;">
A snapshot of 1D domain computational results at an instant in time, used for hot-restart of simulations.
</td>
<td style="text-align:left;">
Input File<br />
Output File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
Comma Delimited Files
</td>
<td style="text-align:left;">
.csv
</td>
<td style="text-align:left;">
These files are used for boundary condition databases, boundary condition tables, 1D cross-sections, 1D storage tables, etc. They are opened and saved using spreadsheet software such as Microsoft Excel.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
ArcGIS Shapefile Layers
</td>
<td style="text-align:left;">
.shp<br />
.dbf<br />
.shx<br />
.prj
</td>
<td style="text-align:left;">
ArcGIS’s industry standard for GIS layers. The .shp file contains information on the GIS objects coordinates. The .dbf file contains the attribute data information associated with the objects. Refer to the .tcf command <tcmd><a href="#tcfGISFormat">GIS Format</a></tcmd>.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
MapInfo MIF/MID Files
</td>
<td style="text-align:left;">
.mif<br />
.mid
</td>
<td style="text-align:left;">
MapInfo’s industry standard GIS data exchange format. The .mif file contains the attribute data definitions and the geographic data of the objects. The .mid file contains the attribute data. The .mid files are of similar format to .csv files, so they can be opened by Excel or other spreadsheet software. The files are text based and can be scripted by advanced users.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
Geopackage
</td>
<td style="text-align:left;">
.gpkg
</td>
<td style="text-align:left;">
GeoPackage is a spatial database file format, natively used in QGIS, that supports the efficient storage of GIS vector and raster data.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
ESRI Ascii raster grid
</td>
<td style="text-align:left;">
.asc
</td>
<td style="text-align:left;">
Gridded data in the widely used ESRI Ascii grid format. This can be read in the majority of GIS platforms including ArcMap, QGIS and MapInfo.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
Binary Float Grid
</td>
<td style="text-align:left;">
.flt
</td>
<td style="text-align:left;">
Gridded data in the binary versions of the .asc format (see above). This data is recognised by most GIS packages and is much faster to read/write than the .asc format.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
GeoTIFF
</td>
<td style="text-align:left;">
.tif
</td>
<td style="text-align:left;">
Compressed Raster Grid data. This data is recognised by most GIS packages and is faster to read/write than the .asc and .flt format files.
</td>
<td style="text-align:left;">
Input File<br />
Output File<br />
Check File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
NetCDF
</td>
<td style="text-align:left;">
.nc
</td>
<td style="text-align:left;">
NetCDF is a database file format for raster inputs. TUFLOW’s supported format uses NetCDF <a href="https://cfconventions.org/cf-conventions/cf-conventions.html">CF Convention</a>.
</td>
<td style="text-align:left;">
Input File<br />
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
SMS Super File
</td>
<td style="text-align:left;">
.sup
</td>
<td style="text-align:left;">
SMS super file containing the various files and other commands that make up the output from a single simulation. Opening this file in SMS opens the .2dm file and the primary .xmdf file.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
SMS Mesh File
</td>
<td style="text-align:left;">
.2dm
</td>
<td style="text-align:left;">
SMS 2D mesh file containing the 1D/2D model mesh and elevations. It also contains information on materials and 2D grid codes.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
SMS Data File
</td>
<td style="text-align:left;">
.dat
</td>
<td style="text-align:left;">
Legacy format, recommended to use XMDF instead. DAT is a SMS generic formatted simulation results file. TUFLOW output can be written using the .dat format.
See Section <a href="#DataTypes-3"><strong>??</strong></a> for the different .dat file outputs.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
SMS XMDF File
</td>
<td style="text-align:left;">
.xmdf
</td>
<td style="text-align:left;">
XMDF (.xmdf) files are much faster to access and can contain all TUFLOW map output within a single file (rather than one file per output type as for the .dat format). This is the recommended mesh output format.
See Section <a href="#DataTypes-3"><strong>??</strong></a> for the different .xmdf file data sets available.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
WaterRIDE
</td>
<td style="text-align:left;">
.wrb<br />
.wrc<br />
.wrr
</td>
<td style="text-align:left;">
WaterRIDE triangulated results file (.wrb) and/or grid based output (.wrr). The .wrc is a master file used when there are multiple file outputs.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
BlueKenue
</td>
<td style="text-align:left;">
.t3s<br />
.t3v
</td>
<td style="text-align:left;">
BlueKenue (National Research Council Canada) output format. The .t3s contains scalar data and the .t3v contains vector data.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
12D Civil Solutions
</td>
<td style="text-align:left;">
.tmo
.tgo
</td>
<td style="text-align:left;">
Format used by 12D for their TUFLOW interface.
</td>
<td style="text-align:left;">
Output File
</td>
<td style="text-align:left;">
Binary
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Log File
</td>
<td style="text-align:left;">
.tlf
</td>
<td style="text-align:left;">
A log file containing information about the 1D/2D data input process and a log of the 2D simulation.
</td>
<td style="text-align:left;">
Check File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW Summary File
</td>
<td style="text-align:left;">
.tsf
</td>
<td style="text-align:left;">
A log file containing a concise summary of the simulation which can be regularly updated during the simulation.
</td>
<td style="text-align:left;">
Check File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
<tr>
<td style="text-align:left;">
ESTRY Output File
</td>
<td style="text-align:left;">
.eof
</td>
<td style="text-align:left;">
Original ESTRY output file containing all 1D input data and results. This file is useful for checking 1D input data and reviewing flow regimes in 1D channels.
</td>
<td style="text-align:left;">
Check File
</td>
<td style="text-align:left;">
Text
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="NamingConventions-3"><span class="header-section-number">2.4.3</span> Naming Conventions<a href="#NamingConventions-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As the bulk of the data input is via GIS data layers, efficient
management of these datasets is essential. For detailed modelling
investigations, the number of TUFLOW GIS data layers has been known to
reach over a hundred for large complex models, although the majority of
models would utilise five to twenty layers. Good data management also
caters for the many other GIS layers being used (aerial photos,
cadastre, etc.).</p>
<p>Different TUFLOW input files require different GIS attributes, for
example an initial water level input file only requires a single
attribute (with the attribute – initial water level), whereas, a 1D
channel has a greater number of attributes (channel type, inverts etc.). Each of
these file types is described in Table <a href="#tab:tab-RecommendedPrefixes2DDomain">6</a>
to Table <a href="#tab:tab-RecommendedPrefixes1DDomain">7</a>.
<strong>It is strongly recommended</strong> that the prefixes described in Table <a href="#tab:tab-RecommendedPrefixes2DDomain">6</a>
to Table <a href="#tab:tab-RecommendedPrefixes1DDomain">7</a> be adhered
to for all 1D and 2D GIS layers. This greatly enhances the data
management efficiency and, importantly, makes it much easier for another
modeller or reviewer to quickly interpret the model. The .tcf command
<tcmd><a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a></tcmd> can be used to automate
the creation of template files which use the recommended GIS data naming
convention. A detailed description on this topic and an example is
provided on the <a href="https://wiki.tuflow.com/Naming_Convention">TUFLOW
Wiki</a>.</p>
<p>Data input is structured so that there is no limit on the number of data
sources. Commands can be repeated indefinitely in the text files to build a
model from a variety of sources. For example, a model’s topography may
be built from more than one source. A DTM may be used to define the
general topography, updated with locallised survey data, while several 3D elevation lines (breaklines) define the crests of levees or roads. The sequential approach to reading
datasets offers unlimited flexibility and increased efficiency. This
layered approach also offers good traceability and quality control.</p>
<p>Refer also to Section <a href="#FileNaming-2"><strong>??</strong></a> and <a href="#SimulationManagement-2"><strong>??</strong></a> which provide further
guidance on model naming conventions and methods in which the same
control files may be used to simulate multiple flood events and
scenarios, thereby reducing the potential number of files created.</p>
<table>
<caption>
<span id="tab:tab-RecommendedPrefixes2DDomain">Table 6: </span><strong>GIS Input Data Layers and Recommended Prefixes - 2D Domain</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Suggested File Prefix
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Data Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Refer to Section
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0d_rl
</td>
<td style="text-align:left;">
Combined 1D/2D Time-Series Reporting Location outputs
</td>
<td style="text-align:left;">
This file contains lines and points defining Reporting Location(s) (RL) for 1D and 2D result time series graphs in Excel.
</td>
<td style="text-align:left;">
<a href="#ReportingLocation-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_ac_ic<br />
2d_ad_md
</td>
<td style="text-align:left;">
Advection Dispersion
</td>
<td style="text-align:left;">
The 2d_ad_ic file type defines the advection dispersion initial concentration. The 2d_ad_md file type defines the advection dispersion minimum dispersion coefficient.
</td>
<td style="text-align:left;">
<a href="#AD-inputs-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_at
</td>
<td style="text-align:left;">
2D Auto Terminate Tracking Locations
</td>
<td style="text-align:left;">
This file contains points defining locations where auto terminate tracking is desired.
</td>
<td style="text-align:left;">
<a href="#AutoTerminateOptions-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_bc_<br />
(2d_hx_)<br />
(2d_sx_)
</td>
<td style="text-align:left;">
2D Boundaries and 1D/2D Links
</td>
<td style="text-align:left;">
Used to define the locations of 2D boundaries and 1D/2D dynamic links. For large models it may be wise to separate the boundary conditions from the 1D/2D links, in which case the 2d_bc prefix can be substituted with 2d_hx_ and 2d_sx_.
Cell code values may also be defined in this layer.
</td>
<td style="text-align:left;">
<a href="#TwoDBoundaries-2"><strong>??</strong></a><br />
<a href="#HXBoundary-3"><strong>??</strong></a><br />
<a href="#SXBoundary-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_bg
2d_bg_pts
</td>
<td style="text-align:left;">
2D Bridge
</td>
<td style="text-align:left;">
Used for 2D flow constrictions to represent additional losses associated with bridges or box culverts. This input includes accounts for flow above and below the bridge obvert (soffit).
</td>
<td style="text-align:left;">
<a href="#bg-layer-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_code_
</td>
<td style="text-align:left;">
2D Cell Codes
</td>
<td style="text-align:left;">
GIS layer(s) containing objects, typically polygons that define the cell codes.
</td>
<td style="text-align:left;">
<a href="#CellCodes-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_cwf_
</td>
<td style="text-align:left;">
2D Cell Width Factor
</td>
<td style="text-align:left;">
Used to define locations to reduce 2D cell flow width.
</td>
<td style="text-align:left;">
<a href="#CWF-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_fc_
</td>
<td style="text-align:left;">
2D Flow Constrictions
</td>
<td style="text-align:left;">
Layer(s) defining the adjustment of 2D cells to model structures such as bridges, box culverts, etc. Whilst this is still supported the newer and more flexible 2d_fcsh_ and 2d_lfcsh_ are preferred.
</td>
<td style="text-align:left;">
<a href="#CLA-FC-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_fcsh_
</td>
<td style="text-align:left;">
Flow Constriction 2D and 3D Shapes
</td>
<td style="text-align:left;">
Points, lines and polygons that modify the 2D cell sides flow width, place a lid (obvert or soffit) on a 2D cell, additional energy losses, and other modifications.
</td>
<td style="text-align:left;">
<a href="#CLA-FC-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_flc
</td>
<td style="text-align:left;">
Form Loss Coefficient
</td>
<td style="text-align:left;">
Used to apply an additional energy loss at the 2D cell side (in the same manner as for 2D flow constrictions). The form or energy loss can be applied as fixed values or on a form loss per unit length basis.
</td>
<td style="text-align:left;">
<a href="#flc-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_glo_
</td>
<td style="text-align:left;">
Gauge Level Output Location
</td>
<td style="text-align:left;">
Layer used to define the location of the gauge for output based on water level rather than time intervals. See <a href="#tcfReadGISGLO">Read GIS GLO</a>.
</td>
<td style="text-align:left;">
<a href="#GaugeLevel-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_gw_
</td>
<td style="text-align:left;">
2D Groundwater
</td>
<td style="text-align:left;">
Layer(s) used to define groundwater inputs.
</td>
<td style="text-align:left;">
<a href="#IGW-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_iwl_
</td>
<td style="text-align:left;">
2D Initial Water Levels
</td>
<td style="text-align:left;">
Layer(s) used to define the spatial variation in 2D domain initial water levels at the start of the model simulation.
</td>
<td style="text-align:left;">
<a href="#IWL-2D-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_lfcsh_
2d_lfcsh_pts
</td>
<td style="text-align:left;">
Layered Flow Constriction 2D and 3D Shapes
</td>
<td style="text-align:left;">
Points, lines and polygons that allow the user to modify the 2D cell sides, flow width, percentage blockage, and additional energy losses, for up to three vertical layers. Designed for modelling 2D flow under and over bridges, pipes and other obstructions across the waterway.
</td>
<td style="text-align:left;">
<a href="#lfcsh-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_loc_
</td>
<td style="text-align:left;">
2D Grid Location
</td>
<td style="text-align:left;">
GIS layer defining the origin and orientation of the 2D grid. This layer is optional, however, is the preferred method for defining the origin and orientation of 2D domains.
</td>
<td style="text-align:left;">
<a href="#Domain-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_lp_
</td>
<td style="text-align:left;">
2D Longitudinal Profile Output Locations
</td>
<td style="text-align:left;">
Layer(s) defining the locations longitudinal profile output from the 2D model domain
</td>
<td style="text-align:left;">
<a href="#LongProfile-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_mat_
</td>
<td style="text-align:left;">
2D Land-Use (Materials) Categories
</td>
<td style="text-align:left;">
Layers to define or change the land-use (material) types on a cell-by-cell basis.
</td>
<td style="text-align:left;">
<a href="#Materials-2"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_obj_
2d_rec_
</td>
<td style="text-align:left;">
2D Receptor Objects
</td>
<td style="text-align:left;">
Layer(s) defining receptors (eg. buildings). TUFLOW records the flood level and simulation time at one or more gauge(s) when receptors are first inundated above their trigger inundation levels.
</td>
<td style="text-align:left;">
<a href="#Receptors-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_oz_
</td>
<td style="text-align:left;">
2D Output Zones
</td>
<td style="text-align:left;">
Layer(s) containing one or more polygons defining the 2D regions to be output.
</td>
<td style="text-align:left;">
<a href="#OutputZones-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_po_
</td>
<td style="text-align:left;">
2D Plot (Time-Series) Output Locations
</td>
<td style="text-align:left;">
Layer(s) defining the locations and types of time-series output from the 2D domains.
</td>
<td style="text-align:left;">
<a href="#TwoDTS-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_qnl_
</td>
<td style="text-align:left;">
2D Quadtree Nest Levels
</td>
<td style="text-align:left;">
Layer defining polygons of grid refinement for quadtree implementation.
</td>
<td style="text-align:left;">
<a href="#Quadtree-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_rf_
</td>
<td style="text-align:left;">
Direct Rainfall
</td>
<td style="text-align:left;">
Layer(s) defining the polygons of sub-catchment areas for applying rainfall directly onto 2D domains or rainfall grids.
</td>
<td style="text-align:left;">
<a href="#Rainfall-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_sa_<br />
2d_sa_rf<br />
2d_sa_tr
2d_sa_po
</td>
<td style="text-align:left;">
2D Source over Area
</td>
<td style="text-align:left;">
Layer(s) defining the polygons of sub-catchment areas for applying a source (flow) (2d_sa) or rainfall directly onto 2D domains (2d_sa_rf).
2d_sa_tr includes additional attributes required for the SA trigger option. 2d_sa_po includes additional attributes required for the SA flow feature.
</td>
<td style="text-align:left;">
<a href="#SA-Layers-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_soil_
</td>
<td style="text-align:left;">
2D Soil Infiltration
</td>
<td style="text-align:left;">
Layer(s) that define the soil types on a cell-by-cell basis.
</td>
<td style="text-align:left;">
<a href="#Infiltration-2"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_strm
</td>
<td style="text-align:left;">
SA streamlines
</td>
<td style="text-align:left;">
Layer used to distribute flow to, read in with the <a href="#tbcReadGISStreams">Read GIS Streams</a> command.
</td>
<td style="text-align:left;">
<a href="#Streamlines-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_wrf
</td>
<td style="text-align:left;">
2D Weir Adjustment Factor
</td>
<td style="text-align:left;">
Layer used to adjust the weir factor locally, e.g. faces along a road embankment.
</td>
<td style="text-align:left;">
TUFLOW HPC <a href="#HPC-US-Controlled-3"><strong>??</strong></a><br />
TUFLOW Classic <a href="#CLA-US-Controlled-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_vzsh_
</td>
<td style="text-align:left;">
Variable (over time) 2D and 3D Elevations Shapes
</td>
<td style="text-align:left;">
Points, lines and polygons defining the final geometry of a breach or other variation in model topography over time. Also includes points defining trigger locations.
</td>
<td style="text-align:left;">
<a href="#vzsh-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_za_
</td>
<td style="text-align:left;">
2D Elevations over an area
</td>
<td style="text-align:left;">
Layer(s) that define areas (polygons) of elevations at a constant height. This file is typically created by renaming the 2d_z__empty file.
</td>
<td style="text-align:left;">
<a href="#zpt-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_zln_<br />
(2d_zlr_)<br />
(2d_zlg_)
</td>
<td style="text-align:left;">
2D Elevation Lines
</td>
<td style="text-align:left;">
<p>Optional 2D or 3D breaklines defining the crest of ridges (e.g. levees, embankments) or thalweg of gullies (e.g. drains, creeks). Ridges and gullies cannot occur in the same layer so 2d_zlr_ is often used for ridges and 2d_zlg_ for gullies.</p>
These files are typically created by renaming the 2d_z__empty file.
</td>
<td style="text-align:left;">
<a href="#zln-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_zpt_
</td>
<td style="text-align:left;">
2D Elevations as points
</td>
<td style="text-align:left;">
Layer(s) that define the elevations at the 2D cells mid-sides, corners and centres.
</td>
<td style="text-align:left;">
<a href="#zpt-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_zsh_<br />
2d_ztin_
</td>
<td style="text-align:left;">
2D and 3D Shapes for (Points, Lines, Polygons)
</td>
<td style="text-align:left;">
Points, lines and polygons defining 2D and 3D shapes for changing the elevations. Lines can be specified with a width (thickness), and polygons are used as the boundaries for creating TINs (triangulations).
</td>
<td style="text-align:left;">
<a href="#zsh-4"><strong>??</strong></a><br />
<a href="#ztin-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2d_zshr_
</td>
<td style="text-align:left;">
2D Evacuation Route
</td>
<td style="text-align:left;">
Layer(s) used to provide define output locations reporting the time and degree of inundation along evacuation routes.
</td>
<td style="text-align:left;">
<a href="#EvaculationRoutes-3"><strong>??</strong></a>
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-RecommendedPrefixes1DDomain">Table 7: </span><strong>GIS Input Data Layers and Recommended Prefixes - 1D Domain</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Suggested File Prefix
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Data Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Refer to Section
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1d_bc_
</td>
<td style="text-align:left;">
1D Boundaries
</td>
<td style="text-align:left;">
Layer(s) defining the locations of 1D domain boundaries.<br />
Note: Any links to the 2D domain are automatically determined via the 2d_bc layer(s).
</td>
<td style="text-align:left;">
<a href="#OneDBoundaries-2"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_bg_<br />
1d_lc_
</td>
<td style="text-align:left;">
1D Bridge Losses
</td>
<td style="text-align:left;">
<p>Optional layer(s) that provide links to tabular data of loss versus height coefficients at a structure. The BG stands for Bridge Geometry and the alternative LC for Loss Coefficients.</p>
For larger models, create a folder called ‘BG’ under the ‘Model’ folder and place the 1d_bg_ tables in this folder along with all the linked .csv files.<br />
These files are typically created by renaming the 1d_tab_empty file.
</td>
<td style="text-align:left;">
<a href="#Bridges-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_iwl_
</td>
<td style="text-align:left;">
1D Initial Water Levels
</td>
<td style="text-align:left;">
Optional layer(s) defining the spatial variation in initial water levels at 1D nodes at the start of the model simulation.
</td>
<td style="text-align:left;">
<a href="#IWL-1D-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_mh_
</td>
<td style="text-align:left;">
1D Manholes
</td>
<td style="text-align:left;">
Optional layer(s) defining the location and parameters of manholes.
</td>
<td style="text-align:left;">
<a href="#OneD-mh-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_na_
</td>
<td style="text-align:left;">
1D Nodal Storage
</td>
<td style="text-align:left;">
Optional layer(s) that provide links to tabular data of storage surface area versus height at nodes.<br />
For larger models, create a folder called ‘NA’ under the ‘Model’ folder and place the 1d_na_ tables in this folder along with all the linked .csv files.
</td>
<td style="text-align:left;">
<a href="#NA-Table-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_nd
</td>
<td style="text-align:left;">
1D Node
</td>
<td style="text-align:left;">
Optional layer(s) used to define 1D node locations and attributes.
</td>
<td style="text-align:left;">
<a href="#NA-Table-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_nwk_<br />
1d_nwke<br />
1d_nwkb
</td>
<td style="text-align:left;">
1D Domain Network
</td>
<td style="text-align:left;">
Layer(s) that define the 1D or quasi 2D domain network of flow paths (channels), storage areas (nodes) and pit inlets (pits).<br />
The 1d_nwkb file uses a character field for the “pBlockage” attribute instead of a numeric field.
</td>
<td style="text-align:left;">
<a href="#OneD-nwk-2"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_pit
</td>
<td style="text-align:left;">
1D Virtual Pit
</td>
<td style="text-align:left;">
Optional layer(s) used to define the location and attributes associated with virtual pipes and pits.
</td>
<td style="text-align:left;">
<a href="#OneD-pit-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_wll_
</td>
<td style="text-align:left;">
1D Water Level Lines for Mapping of 1D results into 2D formats
</td>
<td style="text-align:left;">
Lines of horizontal water level (as judged by the modeller). These lines are used to generate 3D surfaces or water level, velocity and other output of 1D domains. This allows the combined viewing and animation of 2D and 1D domains together.
</td>
<td style="text-align:left;">
<a href="#OneD-pit-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_wllp_
</td>
<td style="text-align:left;">
1D WLL Points
</td>
<td style="text-align:left;">
Points that define the elevations (usually from a DTM) and material values across the WLLs. This offers high quality viewing and mapping of the 1D domains.
</td>
<td style="text-align:left;">
<a href="#WLLp-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
1d_xs_<br />
1d_tab_
</td>
<td style="text-align:left;">
1D Tabular Input
</td>
<td style="text-align:left;">
Optional layer(s) that provide links to tabular data of cross-sectional XZ (chainage-elevation) values or
HW (height-width) values.<br />
For larger models, create a folder called ‘XS’ under the ‘Model’ folder and place the 1d_xs_ tables in this folder along with all the linked .csv files.
</td>
<td style="text-align:left;">
<a href="#XS-2"><strong>??</strong></a>
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="TipsandTricks-2"><span class="header-section-number">2.5</span> Tips and Tricks<a href="#TipsandTricks-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <a href="https://wiki.tuflow.com">TUFLOW Wiki</a> is the primary location where
the TUFLOW software team share useful modelling tips and
tricks. The Wiki covers an extremely wide range of subjects. A list of
the main subject matter topics are summarised in Table <a href="#tab:tab-TipsAndTricks">8</a>.</p>
<p>New content is added to the Wiki regularly. Please join the <a href="https://www.linkedin.com/groups/1908583">LinkedIn
TUFLOW User Group</a> to be
informed of updates when they are published.</p>
<table>
<caption>
<span id="tab:tab-TipsAndTricks">Table 8: </span><strong>TUFLOW Tips and Tricks</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Tips and Tricks (Link)
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/TUFLOW_Licensing">Licencing Tips</a>
</td>
<td style="text-align:left;">
A TUFLOW licence is required to run TUFLOW. This section of the Wiki outlines the user steps required to request and import licence updates.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Tutorial_Introduction">Self-teach Tutorial Modules</a>
</td>
<td style="text-align:left;">
All TUFLOW self-education resources function using a licence-free
mode. As such, there is no need to purchase a software licence to learn TUFLOW. User documentation for the Self-teach Tutorial Modules are hosted on the Wiki.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/TUFLOW_Message_How_To">TUFLOW Error Message Database</a>
</td>
<td style="text-align:left;">
Every TUFLOW model initialisation and simulation error is assigned a unique error number, reported in the TUFLOW Log File. Tips outlining the description of the error message, why it may be occurring and suggestions on how to resolve the error are outlined in the Wiki.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/">Supporting Software Tips</a>
</td>
<td style="text-align:left;">
User tips for the following support software: <a href="https://wiki.tuflow.com/Excel_Tips">Excel</a>, <a href="https://wiki.tuflow.com/NotepadPlusPlus_Tips">Notepad ++</a>, <a href="https://wiki.tuflow.com/TextPad_Tips">TextPad</a>, <a href="https://wiki.tuflow.com/UltraEdit_Tips">UltraEdit</a>, <a href="https://wiki.tuflow.com/12D_Model">12D</a>, <a href="https://wiki.tuflow.com/ArcGis_Tips">ArcGIS</a>, <a href="https://wiki.tuflow.com/Ensight_Tips">Ensight</a>, <a href="https://wiki.tuflow.com/Google_Earth_Tips">Google Earth</a>, <a href="https://wiki.tuflow.com/MapInfo_Tips">MapInfo</a>, <a href="https://wiki.tuflow.com/QGIS_Tips">QGIS</a>, <a href="https://wiki.tuflow.com/SCALGO_Live_Tips">SCALGO Live</a>, <a href="https://wiki.tuflow.com/SMS_Tips">SMS</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer User Manual</a>
</td>
<td style="text-align:left;">
TUFLOW Viewer is a free 1D and 2D dynamic result viewing interface included in the QGIS TUFLOW Plugin. It enables QGIS with added functionality, upgrading the GIS software with features akin to traditional Graphic User Interface software.
<center>
<p>
<img src="images/image11.png">
</p>
</center>
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com">Model Conversion Tools</a>
</td>
<td style="text-align:left;">
A range of tools have been developed to support the conversion of other hydraulic modelling software models to TUFLOW: EPA SWMM to TUFLOW, <a href="https://wiki.tuflow.com/FLO2D_to_TUFLOW">FLO2D to TUFLOW</a>, <a href="https://wiki.tuflow.com/HEC-RAS_to_TUFLOW">HEC-RAS to TUFLOW</a>, <a href="https://wiki.tuflow.com/InfoWorks_ICM_to_TUFLOW">InfoWorks ICM to TUFLOW</a>, <a href="https://wiki.tuflow.com/MIKE_Flood_to_TUFLOW">MIKE Flood to TUFLOW</a> and <a href="https://wiki.tuflow.com/Flood_Modeller_to_TUFLOW">Flood_Modeller to TUFLOW</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/TUFLOW_Utilities">TUFLOW Utilities</a>
</td>
<td style="text-align:left;">
The TUFLOW Utilities are a set of tools that have been developed to help users convert input data from one format to another for use in a TUFLOW model, or to post-process simulation results.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/TUFLOW_Modelling_Guidance">General Modelling Guidance</a>
</td>
<td style="text-align:left;">
<p>This is an expansive page of the Wiki covering a wide range of topics, including:</p>
<p><b>Project Management:</b><br />
Estimating Simulation Run Times, TUFLOW Naming Convention, Modelling Log, Quality Assurance Reviewer Spreadsheet Download.</p>
<p><b>Hydrology: </b><br />
Australian Rainfall and Runoff 2019, UK ReFH2 Processing, U.S. Soil Conservation Service (SCS) Method, Convert to TS1 Utility (RORB, URBS, WBNM, XP RAFTS).</p>
<p><b>TUFLOW Modelling: </b><br />
General Discussion, TUFLOW Check Files, TUFLOW Template GIS (empty) Files, 1D Channels and Hydraulic Structures, 2D Hydraulic Structures, 2D Cell Size Selection, TUFLOW Topography Guidance, Boundary Condition Advice, Direct Rainfall (Rain on Grid) Modelling, HPC Modelling, TUFLOW Stability Troubleshooting, TUFLOW Simulation Speed and RAM Optimisation, TUFLOW Modelling Webinars, TUFLOW Executable Version Change Log.</p>
<p><b>TUFLOW Results: </b><br />
General Simulation Output Discussion (Time Series, Grid and Binary Format), TUFLOW QGIS Plugin, TUFLOW Remapping Tool, Australian Rainfall and Runoff (ARR) 2019 Guideline Result Ensemble Processing.</p>
<b>Other: </b><br />
Hardware Selection Advice, Installation Guide for New Users, Industry Guidelines, Modelling Accuracy, Uncertainties and Flood Impact Mapping Tolerances.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Hardware_Selection_Advice">Hardware Selection Advide</a>
</td>
<td style="text-align:left;">
This Wiki page provides guidance for modellers who are purchasing computer hardware for TUFLOW modelling.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://www.tuflow.com/products/gis-plugins/">GIS Software TUFLOW Plugins (ArcGIS, ArcPro, MapInfo and QGIS)</a>
</td>
<td style="text-align:left;">
TUFLOW seamlessly integrates with GIS software. Any GIS or Computer Aided Design (CAD) package can be used provided load or import and save or export options are available for the GIS formats TUFLOW currently supports. The most commonly used GIS software are ArcGIS, ArcPro, MapInfo and QGIS. Due to their widespread use, customised toolkits and plugins have been specifically designed for these GIS packages to improve TUFLOW model build and result viewing workflow efficiency.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://gitlab.com/tuflow-user-group">GitLab TUFLOW User Group</a>
</td>
<td style="text-align:left;">
The open file formats used by TUFLOW for its input and output make it well suited to automation via scripting as a means to improve workflow efficiency. Many modellers develop their own tools to assist in their use of TUFLOW and to automate many tasks. These tools cover a wide range of use cases, such as data preparation, advanced simulation control, model quality assurance and result post-processing. A GitLab TUFLOW User Group has been established to support the sharing and collaborative development of these tools by the broader TUFLOW community.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/PyTuflow">PyTUFLOW</a>
</td>
<td style="text-align:left;">
PyTUFLOW is a package of Python tools for extracting TUFLOW Classic and HPC time-series results. It can be used to automate output tasks such as checking model health, goodness-of-fit for model calibration, viewing on-the-fly model output (used in conjunction with <tcmd><a href="#tcfWritePOOnline">Write PO Online</a></tcmd><teq> == </teq><tblk>ON</tblk>), and high-volume output plotting from production runs. Unlike the scripts available in the GitLab TUFLOW User Group, this package is maintained by the TUFLOW Development Team.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Fundamentals-1"><span class="header-section-number">3</span> Hydraulic Modelling Fundamentals<a href="#Fundamentals-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="Fundaments-Introduction-2"><span class="header-section-number">3.1</span> Introduction<a href="#Fundaments-Introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter of the Manual discusses key considerations that should be
addressed during the design phase of a hydraulic modelling study, prior
to the commencement of the model build. Consideration of how the model is to
be schematised and selection of key model parameters may have a
significant influence on the accuracy, stability and simulation time of
the model, and may avoid redundant work later in the study.</p>
<h2 class="hasAnchor" id="Schematisation-2"><span class="header-section-number">3.2</span> Schematisation<a href="#Schematisation-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="GeneralGuidance-3"><span class="header-section-number">3.2.1</span> General Guidance<a href="#GeneralGuidance-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>General guidance on model schematisation and best practice procedures is
freely available from numerous industry sources. These typically include discussion on data
requirements, model conceptualisation, calibrating / sensitivity testing, etc. Examples of such guidance documents are:</p>
<ul>
<li>Two Dimensional Modelling in Urban and Rural Floodplains Stage 1 &amp; 2
Report <span class="citation">(<a href="#ref-BabisterBarton2012">Babister &amp; Barton, 2012</a>)</span>;<br />
</li>
<li>Fluvial Design Guide <span class="citation">(<a href="#ref-EAGuide2010">Environment Agency, 2010</a>)</span>;<br />
</li>
<li>Integrated Urban Drainage Modelling <span class="citation">(<a href="#ref-UrbanGuide2009">CIWEM, 2009</a>)</span>.</li>
</ul>
<p>Specific TUFLOW guidance relating to model schematisation, model resolution, timestep and simulation time are discussed in the following sections.</p>
<h3 class="hasAnchor" id="id_1D2Dor3D-3"><span class="header-section-number">3.2.2</span> Model Dimensions: 1D, 2D or 3D?<a href="#id_1D2Dor3D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hydraulic calculations can be performed in one, two, or three spatial dimensions. A brief description of each of these approaches is provided in this section, along with a summary of strengths and limitations.</p>
<h4 class="hasAnchor" id="one-dimensional-1d"><span class="header-section-number">3.2.2.1</span> One Dimensional (1D)<a href="#one-dimensional-1d" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One dimensional (1D) models confine the water flow to a single dimension, specifically
forwards or backwards along a defined path. The path can be a river or drainage channel, an underground stormwater pipe or other similar settings. It is possible to have a network of 1D paths with junctions, representing a network of tributaries and rivers, or an underground stormwater system.</p>
<p>A 1D network is comprised of links (or channels/paths/conduits) and nodes. Water volumes are associated to nodes, and velocities/flows/conveyance are associated with the links. Velocities are cross-section average velocities, i.e. flux (or flow) divided by the effective flow area. Nodes have known storage geometries, from which water elevation can be calculated from the nodal water volume. Links have known cross-sections (bed elevation and bed friction data discretised across the section) or a shape (such as a circular pipe), from which flow area and conveyance can be calculated from water levels and longitudinal slopes.</p>
<p>TUFLOW 1D (ESTRY) and EPA SWMM are included within the TUFLOW Classic and HPC executable download as available 1D solution scheme options. Other third party 1D schemes are also dynamically linked with TUFLOW Classic and HPC.</p>
<p><strong>Strengths</strong></p>
<ul>
<li><p>The models generally have a very small number of computational elements (links and nodes), and require little computational effort to run. Results usually take a matter of seconds or minutes to generate. This allows for rapid iterative development, automated optimisation or calibration, and large numbers of scenarios to be modelled.</p></li>
<li><p>1D models are naturally suited to pipe networks. There is little to no benefit in attempting to model pipe networks in two or more dimensions.</p></li>
</ul>
<p><strong>Limitations</strong></p>
<ul>
<li><p>Significant effort is required to develop the input data required for 1d model domains. The nodal area tables and path cross-sections must be defined for each element, meaning a model of even 100 elements requires much effort to construct compared with 2D or 3D domains.</p></li>
<li><p>1D models are not well suited for situations where surface channels break out onto floodplains. While it is possible to define nodal area tables to allow for storage on floodplains, along with links defining interconnecting flow paths, the model is reliant on the user having correctly identified the topology of the flow network on the floodplain, a priori. The flow paths in a flood model are also assumed to remain fixed or constant in terms of flow direction during a flood event, which may not be the case.</p></li>
<li><p>1D models do not inherently compute energy loss mechanisms beyond bed friction. Energy losses caused by turbulent interaction within a cross-section (tight bends, confluences, spurs/dykes etc) must be manually accounted for with loss factors estimated by the user.</p></li>
<li><p>Energy loss caused by structures must be manually accounted for with loss factors or models specified by the user.</p></li>
<li><p>The model does not capture inertial effects such as super-elevation, which in some situations can change lateral flood levels by half a meter or more across a river bend.</p></li>
<li><p>Flow path velocities are cross-section averages. 1D schematisations are unable to represent variations in velocity across the width of a cross-section, nor any depth dependent properties.</p></li>
</ul>
<h4 class="hasAnchor" id="two-dimensional-2d"><span class="header-section-number">3.2.2.2</span> Two Dimensional (2D)<a href="#two-dimensional-2d" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Two dimensional (2D) models allow water to move in two lateral dimensions. A 2D model is discretised into cells that have a defined geographic area, and faces which connect one cell to the next. Cells are typically triangular (three sided) or quadrilateral (four sided) and are well suited to modelling surface water such as flows in rivers/creeks, floodplain inundation, urban surface water, and estuarine and coastal waters.</p>
<p>In the 2D modelling framework water volumes are associated with 2D cells, and velocities are calculated at cell faces. Velocities are depth averaged. Cells have known storage geometries, from which water elevation can be calculated from water volume. Faces have known cross-sections (bed elevation and bed friction data discretised across the face), from which flow area and conveyance can be calculated from water levels.</p>
<p>TUFLOW Classic and HPC are 2D solution schemes, and their models bare schematised using a grid of square cells. They are not compatible with a flexible mesh design that constructs a network of irregular shaped cells. Classic and HPC do allow different 2D cell sizes to be incorporated within a single model, however, the cells are always square. HPC’s Sub-Grid Sampling (SGS) feature significantly reduces the negative side effects of using a fixed grid of cells.</p>
<p><strong>Strengths</strong></p>
<ul>
<li><p>2D models are generally much easier to construct than 1D models. Usually high quality digital elevation data are available for the study area, and once the 2D grid extent is defined the process of deriving the cell storage data and face conveyance data is fully automated.</p></li>
<li><p>Because velocity is resolved in both transverse and longitudinal dimensions, energy loss mechanisms such as turbulent interaction within a cross-section (tight bends, confluences, spurs/dykes, etc) are automatically accounted for with a turbulence (eddy viscosity) model.</p></li>
</ul>
<p><strong>Limitations</strong></p>
<ul>
<li><p>Accurate computation of flow along a primary flow path requires resolution of cross-sections within the grid. For schemes that utilise a uniform grid, this requirement can cause the entire model to have a large cell count and an associated computational burden.</p></li>
<li><p>Sub-cell energy losses caused by obstructions (e.g. bridge piers), flow expansion (e.g. downstream of a vena-contracta), or in the third (vertical) dimension must be manually accounted for with loss factors or models specified by the user.</p></li>
<li><p>Face velocities are depth averaged. The model is unable to represent variations in velocity (or other properties) with depth.</p></li>
</ul>
<h4 class="hasAnchor" id="three-dimensional-3d"><span class="header-section-number">3.2.2.3</span> Three Dimensional (3D)<a href="#three-dimensional-3d" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Three dimensional (3D) models calculate the water motion in all three spatial dimensions. Computational Fluid Dynamics (CFD) is often used for 3D modelling of flow through complex geometries. CFD software can be extremely computationally intensive, typically solving the full unsteady non-hydrostatic Reynolds-averaged Navier-Stokes equations that describe the flow physics.</p>
<p>Alternatively, the accelerations in vertical dimension can be assumed to be negligible compared to the horizontal dimensions, also known as the hydrostatic assumption. Making this assumption enables a pancake style 3D mesh to be used (i.e. high aspect ratio cells) with a split-operator solution method. This 3D approach significantly improves solution speed compared to traditional CFD. TUFLOW FV is an example of such a 3D model.</p>
<p>Similar to 2D, 3D models also use a network of cells and faces. Volume and velocity data are also associated with cells, with complex numerical schemes available for interpolation between cell and face data. 3D models make the fewest assumptions about water flow, and are therefore suited to situations where there is significant variation of water velocity (or other properties such as temperature and salinity) in all three dimensions. This is particularly relevant for estuarine and ocean environments where density differences in the horizontal plane can affect the flow behaviour.</p>
<p>TUFLOW Classic and HPC are not available in a 3D form. TUFLOW FV supports 3D simulation.</p>
<p><strong>Strengths</strong></p>
<ul>
<li><p>Fewest assumptions or sub-models required from the user.</p></li>
<li><p>Depth dependent properties accounted for - particularly relevant for modelling flow around bridge piers, complex culverts, tight river bends, estuaries and the coastal ocean.</p></li>
</ul>
<p><strong>Limitations</strong></p>
<ul>
<li><p>Computational solve time can become long.</p></li>
<li><p>Not always practical for catchment wide studies.</p></li>
</ul>
<h3 class="hasAnchor" id="Coupled1D2D-3"><span class="header-section-number">3.2.3</span> Coupled 1D-2D<a href="#Coupled1D2D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW allows hydraulic modelling projects to adopt a schematisation that couples 1D and 2D within a single model, such that often:</p>
<ul>
<li>1D is used for cross-drainage structures (e.g. culverts under an embankment) and underground stormwater pipe networks. The 1D is coupled or dynamically linked to the 2D domain, which represents the surface flows. An example of this configuration is shown in Figure <a href="#fig:fig-1D2DLinkPipeNetworkExample">5</a>. TUFLOW Wiki Tutorial <a href="https://wiki.tuflow.com/Tutorial_M03">Module 3</a> and <a href="https://wiki.tuflow.com/Tutorial_M05">Module 5</a> provide working demonstrations of both configurations.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-1D2DLinkPipeNetworkExample"></span>
<img src="images/1D2DLinkPipeNetworkExample.png" alt="1D Pipe Network and Embankment Culvert Linked to 2D" width="70%" />
<p class="caption">
Figure 5: 1D Pipe Network and Embankment Culvert Linked to 2D
</p>
</div>
</center>
<ul>
<li>1D is used for open channel modelling where the 2D resolution is too coarse to represent the open channel shape. The 1D open channels are linked to a 2D domain covering the surface inundation of adjacent floodplain areas. An example of this configuration is shown in Figure <a href="#fig:fig-1D2DOpenChannelExample">6</a>. Refer to TUFLOW Wiki Tutorial <a href="https://wiki.tuflow.com/Tutorial_M11">Module 11</a> for a model demonstration.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-1D2DOpenChannelExample"></span>
<img src="images/1D2DOpenChannelExample.png" alt="1D Open Channel Linked to 2D" width="70%" />
<p class="caption">
Figure 6: 1D Open Channel Linked to 2D
</p>
</div>
</center>
<p>Despite the above, the advent of faster computers, GPU acceleration and Sub-Grid Sampling (SGS) has seen open channels increasingly represented in the 2D domain in TUFLOW models. The key drivers for this are:</p>
<ul>
<li>Computing power increases, combined with TUFLOW HPC’s GPU acceleration, have enabled models built today to be over 100 times larger than pre 2018 models (in terms of cell count). The increased computing power means modellers can model at a finer resolution and over larger areas with no simulation time penalties.<br />
</li>
<li>The development of HPC’s 2D Sub-Grid Sampling (see Section <a href="#SubGridSamplingSGS-3"><strong>??</strong></a>), which creates more accurate storage curves for cells and flux area curves for faces, has vastly improved the ability of a 2D model to reasonably predict the hydraulic conveyance of surface channels. SGS is built into all of the TUFLOW Tutorials.</li>
<li>The development of HPC’s 2D quadtree grid refinement permits use of finer resolution 2D cells in discrete regions (see Section <a href="#FixedGridorQuadtreeGrid-3"><strong>??</strong></a>), such as within the open channel areas.</li>
</ul>
<p>Section <a href="#DomainLinking-1"><strong>??</strong></a> provides a detailed description of how to implement 1D-2D linking and exploit the above within the TUFLOW suite of products.</p>
<h3 class="hasAnchor" id="FixedGridorQuadtreeGrid-3"><span class="header-section-number">3.2.4</span> Quadtree Grid<a href="#FixedGridorQuadtreeGrid-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>By default TUFLOW Classic and HPC use a single 2D cell resolution over an entire model domain. This type of configuration is referred to as a fixed grid configuration. To support 2D modelling at a range of spatial resolutions (which is often a project requirement), TUFLOW HPC models can use a quadtree grid or mesh. The quadtree grid refinement feature supports the recursive division of square TUFLOW cells into four smaller square cells. Up to nine levels of cell size refinement are permitted. All cells in all levels of refinement share a common orientation and the hydraulic computations are a full 2D solution across the entire quadtree grid.</p>
<p>An example quadtree grid is presented in Figure <a href="#fig:fig-QuadtreeExample">7</a> and detailed documentation is provided in Sections <a href="#Quadtree-3"><strong>??</strong></a> and <a href="#TwoD2DLinkingQDT-3"><strong>??</strong></a>. TUFLOW Wiki Tutorial <a href="https://wiki.tuflow.com/Tutorial_M07">Module 7</a> provides a demonstration of this model configuration feature.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-QuadtreeExample"></span>
<img src="images/QuadtreeExample.png" alt="**TUFLOW HPC Quadtree Grid (3 Level Refinement)**" width="80%" />
<p class="caption">
Figure 7: <strong>TUFLOW HPC Quadtree Grid (3 Level Refinement)</strong>
</p>
</div>
</center>
<h2 class="hasAnchor" id="ModelResolutionDiscretisation-2"><span class="header-section-number">3.3</span> Model Resolution (Discretisation)<a href="#ModelResolutionDiscretisation-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="id_1DNetworks-3"><span class="header-section-number">3.3.1</span> 1D Networks<a href="#id_1DNetworks-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The veracity of a 1D model domain is primarily dependent on the resolution with which on ground conditions are represented. The nature of this representation is typically a result of a balance between required resolution and the commensurate manual setup effort, the latter of which can be significant. Some approaches that can be used in establishing this balance include:</p>
<ul>
<li>Carefully determining where and to what extent 1D networks are required in order to address study goals, and</li>
<li>Combining multiple 1D channels or structures into single model elements where appropriate</li>
</ul>
<h3 class="hasAnchor" id="CellSizes-3"><span class="header-section-number">3.3.2</span> 2D Cell Sizes<a href="#CellSizes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2D cell size defines the resolution of the 2D hydraulic calculations. As for 1D simulation, this cell size needs to be sufficiently small so as to reproduce required hydraulic behaviours, but not so small that simulation times are impractical. In order to assist with this cell size selection, Table <a href="#tab:tab-twoDCellSize">9</a> lists general recommendations for minimum cell count (size) relative to primary flow path widths (e.g. creeks or streets), for different TUFLOW solvers.</p>
<table>
<caption>
<span id="tab:tab-twoDCellSize">Table 9: </span><strong>Recommended 2D Cell Size</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Minimum recommended number of cells across flow paths
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Sensitivity of results to flow path orientation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TUFLOW Classic
</td>
<td style="text-align:left;">
4-6
</td>
<td style="text-align:left;">
Low
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW HPC without SGS
</td>
<td style="text-align:left;">
6-8
</td>
<td style="text-align:left;">
Medium
</td>
</tr>
<tr>
<td style="text-align:left;">
TUFLOW HPC with SGS
</td>
<td style="text-align:left;">
3-4
</td>
<td style="text-align:left;">
Very Low
(assumes terrain data is a finer resolution by a factor of 2 or more)
</td>
</tr>
</tbody>
</table>
<p>Resolution may vary from these recommendations if:</p>
<ol style="list-style-type: decimal">
<li>1D is used for primary flow path definition and 2D only for floodplains: 2D cell size can increase.</li>
<li>Using HPC’s SGS feature (refer Sections <a href="#SubGridSamplingSGS-3"><strong>??</strong></a> and <a href="#SGS-3"><strong>??</strong></a>): 2D cell size can increase.</li>
<li>Using HPC’s Quadtree feature: 2D cell size can increase outside areas of interest.<br />
</li>
<li>Small cells are contained within deep water flow paths. These settings will slow down models considerably and should be avoided through use of SGS.</li>
</ol>
<p>More broadly, cell size result convergence sensitivity testing (see Section <a href="#CellSizeResultsConvergence-3"><strong>??</strong></a>) is the most robust way to verify 2D cell size selection. It should be completed early in the model development process.</p>
<h3 class="hasAnchor" id="SubGridSamplingSGS-3"><span class="header-section-number">3.3.3</span> Sub-Grid Sampling (SGS)<a href="#SubGridSamplingSGS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Without SGS, TUFLOW samples an underlying DTM only at cell centres and faces when assigning bathymetry to a computational grid. Cells and faces are then effectively flat-bottomed storage boxes and conveyance channels, respectively. This approach therefore discards any higher spatial resolution DTM data that may have been available. As an example, Figure <a href="#fig:fig-SGSExampleGridTop">8</a> presents a 20m hydraulic model grid, overlaying a 1m DTM. In this case only 2 to 3 grid cells span the river channel, and fewer in some of the floodplain channels and road embankments. As such, the sub-grid (sub-cell) scale topography available in the DTM is underutilised and a poor representation of bathymetry is likely. Traditional solutions to this problem would typically have involved specifying smaller cell sizes, at considerable computational penalty.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGSExampleGridTop"></span>
<img src="images/SGS_Example_Grid_Top.jpg" alt="**20m grid size shown against the 1m DTM**" width="90%" />
<p class="caption">
Figure 8: <strong>20m grid size shown against the 1m DTM</strong>
</p>
</div>
</center>
<p>Rather than using a single elevation value for the grid cell storage calculations, Sub-Grid Sampling (SGS) topography sampling extracts sub-grid data from an underlying DTM to develop a non-linear relationship between water surface elevation and cell volume (i.e. storage capacity). SGS also generates a non-linear relationship between water surface elevation and cell face area and width (i.e. wetted perimeter) to improve the representation of fluxes and conveyance across cell faces. As such, whilst the SGS approach still computes a single water level for each cell, higher resolution terrain data than the grid cell size is utilised within the 2D hydraulic modelling, which improves simulated results. The conceptual difference between traditional and SGS topography sampling approaches is presented in Figure <a href="#fig:fig-2DTraditionalvsSGSExample">9</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-2DTraditionalvsSGSExample"></span>
<img src="images/2DTraditionalvsSGSExample.png" alt="**2D Topography Sampling Concept and DEM Interpretation (Traditional vs SGS)**" width="100%" />
<p class="caption">
Figure 9: <strong>2D Topography Sampling Concept and DEM Interpretation (Traditional vs SGS)</strong>
</p>
</div>
</center>
<p>SGS is a feature of TUFLOW HPC - it is not available in TUFLOW Classic. If using TUFLOW HPC, SGS is recommended when the available DTM data is finer than the model resolution. SGS is discussed further in Section <a href="#SGS-3"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="SGS-benefits-4"><span class="header-section-number">3.3.3.1</span> Benefits of SGS<a href="#SGS-benefits-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- PAR to EFC: think we should move benefits to Ch 3 (inc links to benchmark docs), have some benchmarking comments then to ch3.
EFC to do this benchmarking section, ask CDH if it should be here or ch 3-->
<!-- EFC: chris agreed to move here and I have done so-->
<p>Benchmarking has shown the benefits to be substantial for at least the following situations:</p>
<ul>
<li>Catchment scale models flow much more effectively with water not being
“trapped” by a coarse cell resolution, and, importantly, excellent
cell size convergence (i.e. demonstrating that by reducing the cell
size(s) the model results do not demonstrably change) at much coarser
cell sizes. Figure <a href="#fig:fig-SGS-Convergence">10</a> shows the flow hydrographs for a Quadtree direct rainfall whole of catchment model using two base cell size
resolutions. The Hi-Res Quadtree grid has a base cell size half that
of the Lo-Res grid. The grey and yellow hydrographs show results from models without SGS enabled and their marked difference in peak flow, shape and timing demonstrate significantly different results between the two resolutions, and
therefore a cell size convergence test failure and the need for
further refinement of the cell sizes (and much longer run times). In
contrast, the blue and orange hydrographs are from the same model, however with SGS turned on and show
very similar results between the two resolutions, thereby
demonstrating excellent cell size convergence and the ability to use
the faster running Lo-Res model for day-to-day modelling.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS-Convergence"></span>
<img src="images/image69.png" alt="Model Convergence with and without SGS" width="80%" />
<p class="caption">
Figure 10: Model Convergence with and without SGS
</p>
</div>
<ul>
<li>The sensitivity of results to mesh size is greatly reduced and the sensitivity to mesh orientation is almost eliminated. With SGS a 2D regular mesh model can be rotated or have a change in cell size without impacting the accuracy of the results compared with much greater and sometimes unacceptable changes in results for the traditional elevation per cell approach <span class="citation">(<a href="#ref-Kitts2020">Kitts et al., 2020</a>)</span>.</li>
<li>Disturbed flow fields that can be apparent along a “saw-tooth” regular
grid wet-dry boundary completely disappear, with no spurious
additional head losses generated and the results consistent with a
well-designed flexible mesh. This has major benefits in that open
channels can now be accurately modelled using TUFLOW HPC using coarse
cell sizes at any orientation to the channel, removing the need to
utilise 1D open channels carved through the 2D domain. The images and
charts below show benchmarking to a U-Bend flume test for without SGS
and with SGS. SGS causes a much smoother flow field to occur and
importantly the head drop around the bend is correctly modelled with
SGS on. The red highlighted cells indicate those cells that are partially wet with
SGS on. The charts show the longitudinal profile on the outside
(orange), centre (blue) and inside (grey) of the bend with lines being
modelled and points measured – as shown, with SGS off the upstream
water level is over predicted as shown by the red circle.</li>
</ul>
<img src="images/image70.jpg" style="display: block; margin: auto;" />
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS0-XS"></span>
<img src="images/image71.jpg" alt="Longitudinal Profile without SGS"  />
<p class="caption">
Figure 11: Longitudinal Profile without SGS
</p>
</div>
<img src="images/image72.jpg" style="display: block; margin: auto;" />
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS1-XS"></span>
<img src="images/image73.jpg" alt="Longitudinal Profile with SGS"  />
<p class="caption">
Figure 12: Longitudinal Profile with SGS
</p>
</div>
<p>In summary, utilising SGS means:</p>
<ul>
<li>The storage and conveyance of the model is more accurately represented.</li>
<li>Cell Size Result Convergence, discussed in the following section, can typically be achieved using a larger cell size when using SGS, compared to when not using SGS.</li>
<li>Faster simulation times.</li>
</ul>
<h3 class="hasAnchor" id="CellSizeResultsConvergence-3"><span class="header-section-number">3.3.4</span> Cell Size Results Convergence<a href="#CellSizeResultsConvergence-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Solution convergence to cell size refers to the tendency for model simulation results to trend towards a common answer as cell size decreases. This behaviour occurs due to the discretisation of topographic features at a finer and finer resolution and should trend towards a closer and closer reproduction of reality. Conversely, by using too coarse a cell size, the results can become affected by the inaccuracies introduced by trying to emulate reality with a poor (i.e. coarse) representation of the topography.</p>
<p>The practical test required to complete cell size convergence involves progressively reducing a model’s cell resolution and comparing the results. The process aims to identify the largest cell size possible to achieve a consistent simulation result (i.e. a simulation result that does not introduce inaccuracies caused by using an excessively large cell size). Identifying this optimum cell size will avoid the situation where an unnecessarily small cell size is chosen, which subsequently translates to longer than necessary simulation times with no significant improvement in simulation result. Figure <a href="#fig:fig-2DCellSizeConvergenceTestExample">13</a> demonstrates this concept. The 40m cell resolution model produces a result at the reporting location that is consistent with the finer cell sizes, whereas for larger cell sizes (60m and higher) the results are not consistent demonstrating they are too coarse to accurately reproduce the hydraulics. As the 40m resolution simulation time is significantly less than smaller cell sizes, it represents the optimum cell size value to achieve reliable results in the shortest run time.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-2DCellSizeConvergenceTestExample"></span>
<img src="images/2DCellSizeConvergenceTestExample.png" alt="**Cell Size Convergence Concept Example **" width="100%" />
<p class="caption">
Figure 13: <strong>Cell Size Convergence Concept Example </strong>
</p>
</div>
</center>
<p>The decision as to whether or not the model results are “converged” is subjective and will depend on the purpose of the modelling and specifically what the “essential results”
are. For some studies they may be water surface elevation in a region of
interest (e.g. a town), and for another study the essential result may
be the peak flow at a particular location. The exact approach
taken to establish cell size convergence is up to the user, but we present
a selection of methods below that may be useful. Whether one of the
following methods are used, or another method, it is important to
document all testing and if necessary engage stakeholders in the
decision-making making process.</p>
<ul>
<li>Comparing flood extent. This simple approach may be performed by
overlaying 2D maps of flood extent from sets of results calculated at
different cell sizes. The user might start with a relatively large
cell size and then keep halving the cell size until the results become
acceptably similar. The 2<sup>nd</sup> to last (i.e. penultimate) cell
size is then the one that may be considered as sufficiently converged.</li>
<li>Comparing flow response. Another approach, well suited to highly
transient models, is to place flow lines across a primary path at
important locations, and plot the flow as a function of time for the
different sets of results. Again the user may start with a large cell
size and refine until the results become acceptably similar.<br />
</li>
<li>Creating a result vs cell size plot. This method is more useful when
there is a specific result of interest (e.g. the peak water level at a
particular location such as used in the example above). With this method the result of interest is
plotted as a function of cell size. This method allows the user to estimate
the error between the model result (at a given cell size) and their
estimate for the “perfectly converged” result. The largest cell size
for which the error is within some defined tolerance may then be
considered sufficiently converged. If the resulting plot is “noisy”,
then this can indicate a possible error with the modelling setup
(e.g. an embankment not being resolved at larger cell sizes, or possibly a model instability). <strong>Note, this approach may hide poor convergence elsewhere and is therefore rarely used unless multiple sites are compared and convergence sought for all of them.</strong></li>
<li>Histogram of variation. This approach involves comparing large lists
of results (e.g. water levels at say 100 or more locations) and
generating a histogram of differences between the results at the test
cell size and the results at the finest feasible cell size. The user
may then define, for example, a criterion such that 95% of the results
must be within +/- &lt;some tolerance&gt; of the results from the finest
feasible cell size. The user determines the largest cell size that
satisfies the criterion, and deems that as sufficiently converged.</li>
</ul>
<p>SGS (see Section <a href="#SubGridSamplingSGS-3"><strong>??</strong></a>)
has a significant beneficial impact on cell size convergence. In many
situations, a model using SGS may meet the required convergence criteria
with a cell size that is much larger than when SGS is not used <span class="citation">(<a href="#ref-Huxley2022">Huxley et al., 2022</a>)</span>.</p>
<p>Finally, the cell size convergence testing maybe affected by the viscosity formulation (Section <a href="#turbulence-overview"><strong>??</strong></a>). In particular, the Smagorinsky viscosity formulation can
cause results to be more sensitive to cell size, and can allow the model
results to diverge with decreasing cell size once the cell face width becomes less than the depth. The Wu viscosity formation (default for TUFLOW HPC) has proven to be superior to Smagorinsky in terms of reduced sensitivity to cell size and convergence of results.</p>
<h2 class="hasAnchor" id="SolutionAccuracy-2"><span class="header-section-number">3.4</span> Solution Accuracy<a href="#SolutionAccuracy-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Solving the shallow water equations in one or two dimensions is necessarily an approximation and therefore there are numerous solutions and different assumptions to be made. The following sections discuss various forms of the shallow water equations. Of these, TUFLOW adopts the full dynamic wave form in its 1D and 2D solutions. The full dynamic wave solution is the most accurate option compared to the other mentioned alternative solution schemes.</p>
<h3 class="hasAnchor" id="FluidFlowPhysicalTerms-3"><span class="header-section-number">3.4.1</span> Fluid Flow Physical Terms<a href="#FluidFlowPhysicalTerms-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The equations solved by TUFLOW are:</p>
<ul>
<li>Conservation of mass (also known as the continuity equation)</li>
<li>Conservation of momentum</li>
</ul>
<p>These equations are presented and discussed in 1D and 2D forms in the subsections below.</p>
<h4 class="hasAnchor" id="d-continuity-equation"><span class="header-section-number">3.4.1.1</span> 1D Continuity Equation<a href="#d-continuity-equation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For water flow within a 1D channel the continuity equation per unit length is:</p>
<p><span class="math display" id="eq:equ-1DContinuity">\[\begin{equation}
\begin{matrix}
w \frac{\partial h}{\partial t}
&amp; + &amp; \frac{\partial (A u)}{\partial x}
&amp; = &amp; S(x) \\
\text{rate}
&amp; + &amp; \text{divergence}
&amp; = &amp; \text{source}
\end{matrix}
\tag{1}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(w\)</span> is the channel width at the water surface</li>
<li><span class="math inline">\(h\)</span> is the water depth in the channel</li>
<li><span class="math inline">\(A\)</span> is the cross-sectional flow area (up to the water surface)</li>
<li><span class="math inline">\(u\)</span> is the cross-sectional flow area averaged water velocity</li>
<li><span class="math inline">\(S(x)\)</span> is the lineal water source term (volume per unit time per unit length), usually lateral inflow/outflow</li>
<li><span class="math inline">\(x\)</span> and <span class="math inline">\(t\)</span> are channel flow dimension and time respectively</li>
</ul>
<h4 class="hasAnchor" id="d-momentum-equation"><span class="header-section-number">3.4.1.2</span> 1D Momentum Equation<a href="#d-momentum-equation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For water flow within a 1D channel the momentum equation is as follows, noting the eddy viscosity (diffusion of momentum or turbulence) term can not be included in the 1D form.</p>
<p><span class="math display" id="eq:equ-1DMomentum">\[\begin{equation}
\begin{matrix}
\frac{\partial u}{\partial t}
&amp; + &amp; \frac{1}{A} \frac{\partial (Auu)}{\partial x}
&amp; + &amp; g \frac{\partial (z+h)}{\partial x}
&amp; + &amp; g \frac{n^2|u|}{R^\frac{4}{3}}u
&amp; = &amp; S_u(x) \\
\text{rate}
&amp; + &amp; \text{divergence}
&amp; + &amp; \text{slope}
&amp; + &amp; \text{friction}
&amp; = &amp; \text{source}
\end{matrix}
\tag{2}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(z\)</span> is the channel bed elevation</li>
<li><span class="math inline">\(n\)</span> is the Manning’s coefficient for bed friction (units time per cube-root(unit length))</li>
<li><span class="math inline">\(R\)</span> is the hydraulic radius</li>
<li><span class="math inline">\(g\)</span> is acceleration due to gravity</li>
<li><span class="math inline">\(S_u(x)\)</span> is the lineal momentum source term (force per unit volume per unit fluid density), typically used for local energy losses unable to be represented by the 1D form</li>
</ul>
<p>Note the hydraulic radius <span class="math inline">\(R\)</span> is normally considered to be cross-sectional flow area divided by wetted perimeter, or <span class="math inline">\(A/P\)</span>. However, in some software it may be specified as ‘resistance radius’, which is just the water depth over the channel invert.</p>
<h4 class="hasAnchor" id="d-continuity-equation-1"><span class="header-section-number">3.4.1.3</span> 2D Continuity Equation<a href="#d-continuity-equation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For water flow over a 2D surface the continuity equation is:</p>
<p><span class="math display" id="eq:equ-2DContinuity">\[\begin{equation}
\begin{matrix}
\frac{\partial h}{\partial t}
&amp; + &amp; \frac{\partial (h u)}{\partial x}
&amp; + &amp; \frac{\partial (h v)}{\partial y}
&amp; = &amp; S(x,y) \\
\text{rate}
&amp; + &amp; \text{divergence}
&amp; + &amp; \text{divergence}
&amp; = &amp; \text{source}
\end{matrix}
\tag{3}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(h\)</span> is the water depth in the 2D cell</li>
<li><span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> are the velocity components in the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> spatial dimensions, respectively</li>
<li><span class="math inline">\(S(x,y)\)</span> is the total area water source term (volume per unit time per unit area), usually rain and infiltration</li>
</ul>
<h4 class="hasAnchor" id="d-momentum-equation-1"><span class="header-section-number">3.4.1.4</span> 2D Momentum Equation<a href="#d-momentum-equation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For water flow over a 2D surface the momentum equations, including eddy viscosity (diffusion of momentum or turbulence) but omitting Coriolis acceleration <span class="math inline">\(\Omega\)</span>, are:</p>
<p><span class="math display" id="eq:equ-2DMomentum">\[\begin{equation}
\begin{matrix}
\frac{\partial (hu)}{\partial t}
&amp; + &amp; \frac{\partial (huu)}{\partial x} + \frac{\partial (hvu)}{\partial y}
&amp; - &amp; \frac{\partial (h \nu_t \frac{\partial u}{\partial x})}{\partial x} - \frac{\partial (h \nu_t \frac{\partial u}{\partial y})}{\partial y}
&amp; + &amp; gh \frac{\partial (z+h)}{\partial x}
&amp; + &amp; gh \frac{n^2\sqrt{u^2+v^2}}{h^\frac{4}{3}}u
&amp; = &amp; S_u(x,y) \\
\frac{\partial (hv)}{\partial t}
&amp; + &amp; \frac{\partial (huv)}{\partial x} + \frac{\partial (hvv)}{\partial y}
&amp; - &amp; \frac{\partial (h \nu_t \frac{\partial v}{\partial x})}{\partial x} - \frac{\partial (h \nu_t \frac{\partial v}{\partial y})}{\partial y}
&amp; + &amp; gh \frac{\partial (z+h)}{\partial y}
&amp; + &amp; gh \frac{n^2\sqrt{u^2+v^2}}{h^\frac{4}{3}}v
&amp; = &amp; S_v(x,y) \\
\text{rate}
&amp; + &amp; \text{divergence}
&amp; - &amp; \text{diffusion}
&amp; + &amp; \text{slope}
&amp; + &amp; \text{friction}
&amp; = &amp; \text{source}
\end{matrix}
\tag{4}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(\nu_t\)</span> is the (kinematic) turbulent eddy viscosity</li>
<li><span class="math inline">\(S_u(x,y)\)</span> and <span class="math inline">\(S_v(x,y)\)</span> are the areal momentum source terms (force per unit area per unit fluid density), used for local energy losses and atmospheric pressure gradient</li>
</ul>
<h3 class="hasAnchor" id="FormsoftheEquations-3"><span class="header-section-number">3.4.2</span> Forms of the Equations<a href="#FormsoftheEquations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Equations <a href="#eq:equ-1DContinuity">(1)</a> and <a href="#eq:equ-1DMomentum">(2)</a> are the 1D <strong>Dynamic</strong> Wave Equations,
or Saint-Venant Equations. They represent a system of equations that is effectively second order in both space and time,
and therefore admit travelling wave solutions (speed <span class="math inline">\(c=\sqrt{gh}\)</span>). Similarly Equations <a href="#eq:equ-2DContinuity">(3)</a> and <a href="#eq:equ-2DMomentum">(4)</a> are the
2D Dynamic Wave Equations also known as the Shallow Water Equations (SWE).</p>
<p>As described in the following subsections, the <strong>Dynamic</strong> form of the equations can be simplified to the <strong>Diffusive</strong> and <strong>Kinematic</strong> forms. However, given the available computing power today in personal computers, there is no need or defence for calculating diffusive wave or kinematic wave solutions except for very specific simplified situations. TUFLOW Classic and HPC are strictly dynamic wave solvers, in both 1D and 2D forms. Therefore, TUFLOW does not experience the inaccuracies and limitations associated with solving the diffusive wave or kinematic wave equations.</p>
<h4 class="hasAnchor" id="diffusive-wave-equation"><span class="header-section-number">3.4.2.1</span> Diffusive Wave Equation<a href="#diffusive-wave-equation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the case of 1D, the two prognostic variables, depth <span class="math inline">\(h\)</span> and velocity <span class="math inline">\(u\)</span> co-evolve with time. However, in days past when
computers were far less powerful, the <strong>Dynamic</strong> Wave Equation solution was computationally too much work to solve efficiently. At that time in history mathematicians looked to simplify the problem.
The first step was to assume that the velocity field is a “slowing evolving steady state solution” (i.e.
the time derivative <span class="math inline">\(\frac{\partial u}{\partial t}\)</span> is considered small and the velocity field is no longer independently
evolved); it becomes a diagnostic field that is able to be computed from the depth field. Further, by assuming that solution is “gentle” (i.e. the divergence term <span class="math inline">\(\frac{1}{A} \frac{\partial (Auu)}{\partial x}\)</span> is also small), the velocity field can be defined as:</p>
<p><span class="math display" id="eq:equ-1DSteadyStateU">\[\begin{equation}
|u|u = -\frac{R^\frac{4}{3}}{n^2} \frac{\partial (z + h)}{\partial x}
\tag{5}
\end{equation}\]</span></p>
<p>Equation <a href="#eq:equ-1DContinuity">(1)</a>, with the velocity field computed diagnostically from <a href="#eq:equ-1DSteadyStateU">(5)</a> is the
1D <strong>Diffusive</strong> Wave Equation. The equation is second order in space but only first order in time, therefore it does not admit
travelling wave solutions, but solutions that diffuse while they advect, hence the name.
It requires less memory, less computational effort per timestep, and a larger timestep can be used to progress forward in time compared to the dynamic wave solution.</p>
<p>In situations where the velocity field is gentle and slowly evolving, the <strong>Diffusive</strong> Wave solution is almost correct. However, as the modeller
cannot know in advance just how large the difference between the diffusive and dynamic wave solutions might be, sensitivity testing by comparing results using the two forms is recommended, or the <strong>Diffusive</strong> form is simply not used.</p>
<p>Diffusive wave solutions are also not shock capturing, and do not accurately predict the location of hydraulic jumps.
In 2D the diffusive wave solution is even more incorrect. As the divergence of momentum in both <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> is neglected, the
solution cannot estimate super-elevation.</p>
<p>For the reasons above, TUFLOW’s solvers do not offer a <strong>Diffusive</strong> Wave solution.</p>
<h4 class="hasAnchor" id="kinematic-wave-equation"><span class="header-section-number">3.4.2.2</span> Kinematic Wave Equation<a href="#kinematic-wave-equation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>From the diffusive wave equation solution, there are further simplifications that are possible and sometimes used by other software. For shallow flows over steeper ground it is possible to assume that <span class="math inline">\(\partial h / \partial x\)</span> &lt;&lt; <span class="math inline">\(\partial z / \partial x\)</span>, in which case the velocity field becomes a function of depth and channel bed slope, but not a function of <span class="math inline">\(\partial h / \partial x\)</span>. The equation then becomes first order in both space and time:</p>
<p><span class="math display" id="eq:equ-1DKinematic">\[\begin{equation}
w \frac{\partial h}{\partial t}
+ \frac{\partial (A B R^\frac{2}{3})}{\partial x}
=  S(x) \\
B = \frac{1}{n} {\left| \frac{\partial z}{\partial x} \right|}^\frac{1}{2} sgn \left( \frac{\partial z}{\partial x} \right)
\tag{6}
\end{equation}\]</span></p>
<p>Equation <a href="#eq:equ-1DKinematic">(6)</a> is the 1D <strong>Kinematic</strong> Wave Equation. It is a non-linear advection equation. It is suitable for computing steady state flows (and slowly evolving steady state flows) in steep channels or over steep terrain (i.e. water surface slope is
much the same as bed slope), but is not suitable for flows in low-lying channels/rivers.</p>
<p>For the reasons above, TUFLOW’s solvers also do not offer a <strong>Kinematic</strong> Wave solution.</p>
<h3 class="hasAnchor" id="NumericalAccuracy-3"><span class="header-section-number">3.4.3</span> Numerical Accuracy<a href="#NumericalAccuracy-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When computing the divergence and diffusion terms in a finite difference or finite volume scheme, it is necessary
to calculate the field values at spatial locations that are between the locations where the field data are defined. For
example, depth data is considered a node or cell property, and is therefore nominally defined at a node (1D) or cell centre (2D). When calculating
the flow through a cross-section (1D) or a face (2D), the depth of water must be estimated at the cross-section (or face), which is located
between the nodes (or cells). This process is not straight forward, the methods for doing so broadly fall into three categories:</p>
<ul>
<li><strong>Zeroth order</strong> interpolation: The field value used at the cross-section or a face is a constant fixed value. This means that the error
between the field value used and the “real” solution is constant regardless of cell size - it is a function of cell size to the
power of zero, hence the term “zeroth order”. This method is generally not used.
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-InterpolationZerothOrder"></span>
<img src="images/InterpolationZerothOrder.png" alt="**Example of zeroth order interpolation**" width="50%" />
<p class="caption">
Figure 14: <strong>Example of zeroth order interpolation</strong>
</p>
</div>
</center></li>
<li>First order interpolation: The field value used at the cross-section or a face is usually that of the upwind (upstream) node or cell, but in rare cases can
be that of the downwind (downstream) node/cell. This means that the error between the field value used and the real solution is proportional to the 1D element length or 2D cell size - it is a
function of element length or cell size to the power of one, hence the term “first order”. This method is computationally simple and is very stable, but has the
tendency to cause any sudden changes (high spatial gradients) in solution to diffuse (smooth out) over time - the same effect as if the model had
a high diffusion rate applied. Therefore, the method introduces an artefact diffusion that isn’t real. In the case of 2D and 3D modelling, any swirls or eddies in
the velocity field tend to decay (or simply do not form in the first place).</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-InterpolationFirstOrder"></span>
<img src="images/InterpolationFirstOrder.png" alt="**Example of first order interpolation**" width="50%" />
<p class="caption">
Figure 15: <strong>Example of first order interpolation</strong>
</p>
</div>
</center>
<ul>
<li>Second order interpolation: The field value used at the cross-section or a face is usually linearly interpolated between the upwind node/cell
and the downwind one. This means that the error between the field value used and the real solution is proportional to element length or cell size squared - it is a
function of cell size to the power of two, hence the term “second order”. Pure linear interpolation on its own is known to be unstable - the solution
tends to develop oscillations in locations with high gradients. To prevent these, it is common to blend between first and second order interpolation
depending on the spatial gradients relative to the grid/mesh size - this is known as rate limiting, or a Total Variation Diminishing (TVD) method.
When implemented correctly, the level of artefact numerical diffusion is very small, and swirls and eddies in the velocity field (2D and 3D) form easily
unless real diffusion (such as a turbulence model) is explicitly added.
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-InterpolationSecondOrder"></span>
<img src="images/InterpolationSecondOrder.png" alt="**Example of second order interpolation**" width="50%" />
<p class="caption">
Figure 16: <strong>Example of second order interpolation</strong>
</p>
</div>
</center></li>
</ul>
<p>TUFLOW Classic uses second order interpolation, and TUFLOW HPC defaults to second order interpolation, but does offer the user the choice to switch to
first order (see <a href="#tcfSolutionScheme">Solution Scheme</a>). However, for the reasons above using a first order interpolation solution is not recommend. Second order interpolation is
significantly more accurate than first order, and this shows in cell-size sensitivity testing. The TVD scheme implemented in TUFLOW HPC is very stable,
and the user should not need to change to first order interpolation in order to stabilise a model.</p>
<h2 class="hasAnchor" id="TimestepBackground-2"><span class="header-section-number">3.5</span> Timestep<a href="#TimestepBackground-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Appropriate computational timestep selection is critically important for the successful stable simulation of a model. In hydraulic modelling the timestep represents the interval at which the hydraulic calculations proceed forward in time. From a model design perspective it influences both the simulation stability and overall runtime considerations.</p>
<p>Depending on the numerical construct and solution scheme there are critical control number criterion that must not be exceeded to maintain solution stability. Additionally, the simulation run time is directly proportional to the number of timesteps required to calculate model behaviour for the simulation period. Selecting a timestep that is too large, exceeding the relevant control number criterion, may cause computations to become unstable. Conversely, selecting a timestep that is excessively small will unnecessarily slow a simulation down. The following sections provides timestep selection guidance.</p>
<h3 class="hasAnchor" id="FixedVersusAdaptiveTimestepping-3"><span class="header-section-number">3.5.1</span> Fixed versus Adaptive Timestepping<a href="#FixedVersusAdaptiveTimestepping-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are typically two approaches to how a model’s timestep is applied:</p>
<ul>
<li>Fixed Timestepping: The timestep is determined and input as a fixed value by the user. For TUFLOW modelling, this approach applies to TUFLOW Classic.<br />
</li>
<li>Adaptive Timestepping: The timestep is automatically determined
by the solution scheme and varies in value throughout the simulation depending on the hydraulic conditions at the time. TUFLOW HPC uses adaptive timestepping.</li>
</ul>
<p><em>Note: TUFLOW’s in-built 1D solutions, TUFLOW 1D (ESTRY) and EPA SWMM, use a variety of fixed and adaptive timestepping, depending on the 2D solution it is linked to (TUFLOW Classic or HPC).</em></p>
<h3 class="hasAnchor" id="OneDDomainsTimestep-3"><span class="header-section-number">3.5.2</span> TUFLOW 1D (ESTRY) and EPA SWMM<a href="#OneDDomainsTimestep-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW 1D (ESTRY) and EPA SWMM both use an explicit solution scheme. For the 1D channels using either of these solvers the stability criterion, expressed by the following wave celerity <a href="#eq:equ-1DCc">(7)</a> and courant number <a href="#eq:equ-1DCu">(8)</a> equations, should not exceed 1.</p>
<p><span class="math display" id="eq:equ-1DCc">\[\begin{equation}
C_c = \frac{\Delta t \sqrt{gh}}{\Delta x}
\tag{7}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-1DCu">\[\begin{equation}
C_u = \frac{\Delta t \cdot U }{\Delta x}
\tag{8}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Cc\)</span> = Wave celerity</li>
<li><span class="math inline">\(Cu\)</span> = Courant number</li>
<li><span class="math inline">\(\Delta t\)</span> = Timestep</li>
<li><span class="math inline">\(\Delta x\)</span> = Distance</li>
<li><span class="math inline">\(g\)</span> = Gravity</li>
<li><span class="math inline">\(h\)</span> = Water depth</li>
<li><span class="math inline">\(U\)</span> = Magnitude of velocity</li>
</ul>
<p>The ESTRY Control File <a href="#ecfTimestep">Timestep</a> command is used to set the fixed TUFLOW 1D (ESTRY) timestep, or when linked with HPC, the maximum 1D timestep.</p>
<p>The TUFLOW SWMM Control File <a href="#tscfSWMMIterations">SWMM Iterations</a> command sets the EPA SWMM timestep relative to the linked 2D solution timestep.</p>
<p>A fixed TUFLOW 1D (ESTRY) timestep is recommended for 1D/2D linked TUFLOW Classic models. The timestep selected should not be greater than the minimum value for
any channel (except non-inertial channels such as bridges, culverts,
etc.). Typical timestep values are 10 or 60 seconds for a model with a minimum
channel length of 100 to 500 metres, down to 1 second for 1D network with small
pipes. The occurrence of mass errors may indicate the use of too high a
timestep.</p>
<p><em>Tip: Where a few TUFLOW 1D (ESTRY) channels must be significantly shorter than the rest, it may be economical to specify them as non-inertial channels. The timestep can then be chosen on the requirements of the shortest remaining channel. Care should however be exercised when specifying non-inertial channels to ensure that errors are not introduced by the non-inertial representation, particularly if these channels are in a region of interest. Any approximations can usually be assessed by a few selected runs without the non-inertial approximation and with the necessary shorter timestep.</em></p>
<p>In 1D/2D linked TUFLOW Classic models a TUFLOW 1D (ESTRY) <a href="#ecfTimestep">Timestep</a> value that is smaller and also equally divisible into the 2D <a href="#tcfTimestep">Timestep</a> is recommended. If the 1D timestep is not equally divisible into the smallest 2D timestep, the 1D timestep is reduced automatically so that it meets this criteria. For example, if the specified 2D timestep is 10 seconds and the 1D timestep is 3 seconds, the 1D timestep will be reduced to 2.5 seconds (this is reported in the simulation log file).</p>
<p>A fixed timestep is also required as the model input for 1D/2D linked TUFLOW HPC models, though functionally during simulation, timestep adjustment is applied to enable synchronised communication between TUFLOW 1D (ESTRY) and TUFLOW HPC’s adaptive timestep. In this situation the TUFLOW 1D (ESTRY) <a href="#ecfTimestep">Timestep</a> represents a “Maximum 1D Timestep”. The timestep synchronisation is shown Figure <a href="#fig:fig-TUFLOWHPC1D2DTimestepSync">17</a>, and functions as follows:</p>
<ul>
<li>If the Target TUFLOW HPC 2D Timestep is less than the Maximum TUFLOW 1D (ESTRY) Timestep: The 2D timestep is reduced below the target value to be an integer division of the maximum TUFLOW 1D (ESTRY) timestep. For example, if the HPC target 2D timestep is 0.7 s, and the ESTRY/SWMM maximum 1D timestep is 1.0 s, then HPC will use 0.5 s for its timestep and run two steps within ESTRY’s single step.</li>
<li>If the Target TUFLOW HPC 2D Timestep is greater than the Maximum TUFLOW 1D (ESTRY) Timestep: the 1D timestep is reduced to an even integer division of the target 2D timestep. For example, if the HPC target 2D timestep is 2.1 s, and the ESTRY/SWMM 1D maximum timestep is 1.0 s, then ESTRY will use 0.7 s for its timestep and run three steps to HPC’s single step.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-TUFLOWHPC1D2DTimestepSync"></span>
<img src="images/TUFLOWHPC1D2DTimestepSync.png" alt="**TUFLOW HPC 1D/2D Timestep Synchronisation**" width="90%" />
<p class="caption">
Figure 17: <strong>TUFLOW HPC 1D/2D Timestep Synchronisation</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="TUFLOWClassicTimestep-3"><span class="header-section-number">3.5.3</span> TUFLOW Classic 2D<a href="#TUFLOWClassicTimestep-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW Classic is a 2D implicit scheme. It can generally maintain a stable solution for a Courant Number (equation <a href="#eq:equ-2DCourantNo">(9)</a>) less than 10. For real-world applications a value of 5 or less is however more common <span class="citation">(<a href="#ref-Syme1991">Syme, 1991</a>)</span>.</p>
<p><span class="math display" id="eq:equ-2DCourantNo">\[\begin{equation}
\text{C}_{\text{r}} = \frac{\Delta t\sqrt{2\text{gH}}}{\Delta x}
\tag{9}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\Delta t\)</span> = Timestep (s)<br />
</li>
<li><span class="math inline">\(\Delta x\)</span> = Length of model element (m)<br />
</li>
<li><span class="math inline">\(g\)</span> = Acceleration due to gravity (<span class="math inline">\({ms}^{- \frac{1}{2}}\)</span>)<br />
</li>
<li><span class="math inline">\(H\)</span> = Depth of water (m)</li>
</ul>
<p>As a general rule for 2D TUFLOW Classic models, the
<a href="#tcfTimestep">Timestep</a> (in seconds) is typically in the range of
<span class="math inline">\(\frac{1}{2}\)</span> to <span class="math inline">\(\frac{1}{5}\)</span> of the cell size (in metres). For example, for a 10m
model the timestep will typical be in the range 2 to 5 seconds. For steep gradient
models with high Froude numbers and supercritical flow, smaller timesteps may be required.</p>
<p>If a model is operating at high Courant numbers (&gt;10), sensitivity
testing with smaller timesteps to demonstrate no measurable change in
result is recommended. The occurrence of high 2D mass error can be an indicator that the
2D timestep is too high.</p>
<p><em>Tip: If during initial model development a model becomes unstable, it is strongly advised to not simply reduce the timestep. Instead establish why the model is unstable and if the cause relates to poor model design or one of the model input error (e.g topography, boundary conditions, initial water level, 1D/2D linking etc.). If it is, correct that first before considering lowering the timestep. Doing so will create a healthy model that can operate at a higher timestep, and subsequently run faster. Section <a href="#QAchecklist-2"><strong>??</strong></a> includes guidance focused on resolving model instabilities.</em></p>
<h3 class="hasAnchor" id="TUFLOWHPCTimestep-3"><span class="header-section-number">3.5.4</span> TUFLOW HPC 2D<a href="#TUFLOWHPCTimestep-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC is a 2D explicit scheme. It uses adaptive timestepping to progress through a simulation. The timestep is automatically dynamically adjusted during a simulation so the numerical solution complies with three mathematical stability criteria:</p>
<table>
<caption>
<span id="tab:tab-HPCTimestep">Table 10: </span><strong>HPC 2D Adaptive Timestep Controlling Numbers</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Control Number
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Expression and Control Limit Maximum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Courant Number (Nu)
</td>
<td style="text-align:left;">
This condition ensures that water entering one side of a 2D cell does not pass through the other side within one timestep. For this to be satisfied, the product of the water velocity (<span class="math inline">\(\upsilon\)</span>, <span class="math inline">\(\nu\)</span>) and model timestep (<span class="math inline">\(\Delta\)</span>t) must be less than the cell size (<span class="math inline">\(\Delta\)</span><span class="math inline">\(x\)</span>, <span class="math inline">\(\Delta\)</span><span class="math inline">\(y\)</span>) .
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{equation}
max(\frac{|\upsilon|\Delta t}{\Delta x} , \frac{|\nu|\Delta t}{\Delta y}) = 1.0
\end{equation}\]</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Shallow Wave Celerity Number (Nc)
</td>
<td style="text-align:left;">
This numerical condition relates to the shallow water wave celerity (wave speed) and is derived from the fluid flow equations to represent long waves (i.e. wave length is substantially longer than the water depth). The product of the model timestep (<span class="math inline">\(\Delta\)</span>t) and the long wave speed (square root of the gravity (<span class="math inline">\(g\)</span>) and water depth(<span class="math inline">\(h\)</span>)) must be less than the cell size (<span class="math inline">\(\Delta\)</span><span class="math inline">\(x\)</span>, <span class="math inline">\(\Delta\)</span><span class="math inline">\(y\)</span>), for the condition to be satisfied.
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{equation}
max(\frac{\sqrt{2\text{gh}}\Delta t}{\Delta x} , \frac{\sqrt{2\text{gh}}\Delta t}{\Delta y}) = 1.0
\end{equation}\]</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Diffusion Number (Nd)
</td>
<td style="text-align:left;">
This numerical condition relates to the sub-grid scale eddy viscosity term which causes diffusion of momentum. To maintain stability the product of the eddy viscosity coefficient (<span class="math inline">\(\text{v}_{\tau}\)</span>) and the timestep (<span class="math inline">\(\Delta\)</span>t) divided by the square of the grid spacing (<span class="math inline">\(\Delta\)</span><span class="math inline">\(x\)</span>, <span class="math inline">\(\Delta\)</span><span class="math inline">\(y\)</span>) must remain below 0.3.
</td>
<td style="text-align:left;">
<span class="math display">\[\begin{equation}
max(\frac{\text{v}_{\tau}\Delta t}{\Delta x^2} , \frac{\text{v}_{\tau}\Delta t}{\Delta y^2}) = 0.3
\end{equation}\]</span>
</td>
</tr>
</tbody>
</table>
<p>TUFLOW HPC will use the highest timestep possible without exceeding the limits associated with each of the above control numbers. The method TUFLOW HPC uses to calculate a timestep and achieve unconditional stability is as follows:</p>
<ul>
<li>A TUFLOW Control File (TCF) <a href="#tcfTimestep">Timestep</a> command is required. It is however only used for the first calculation timestep. The specified value should be consistent with what would be appropriate for a TUFLOW Classic model (i.e. <span class="math inline">\(\frac{1}{2}\)</span> to <span class="math inline">\(\frac{1}{5}\)</span> the 2D cell size in metric units). Internally, TUFLOW HPC divides this value by 10 to apply a value that is suitable for an explicit solution scheme. All subsequent calculations are completed using the adaptive timestep approach outlined in the following bullet points.</li>
<li>The HPC timestep is calculated using the hydraulic conditions from the end of the previous timestep.</li>
<li>If the hydraulic conditions have changed significantly it is possible for one or more of the <em>Nu, Nc, Nd</em> control number criteria to be violated at one or more locations within the model. For example, a sudden change in rainfall from one timestep to the next (which occurs with stepped rainfall boundaries) would potentially cause this. The HPC solver, by default, treats a 20% exceedance of a control number as a violation and will implement a repeat timestep feature in this situation in order to maintain unconditional stability. Should a control number anywhere within the model be exceeded by more than 20%, the solution reverts to the complete hydraulic solution from the previous (good) timestep, then the timestep is reduced and next calculation repeated.</li>
<li>Each timestep is also tested for the occurrence of NaNs. A NaN is “Not a Number” and occurs due to undefined mathematical calculations such as a divide by zero or square root of a negative number. The occurrence of a NaN is also indicative of a sudden instability. Should a NaN occur, the repeat timestep feature is implemented.</li>
<li>Should a timestep need to be repeated more than ten times consecutively, the solution stops.</li>
<li>The simulation will also stop if the default minimum permissible timestep of 0.1 seconds has been reached. This value can be manually adjusted using <a href="#tcfTimestepMinimum">Timestep Minimum</a>.
Repeated timesteps are displayed to the Console Window and the number of them for a time interval are provided in the nRS_NaNs and nRS_HCNs columns in the _HPC.csv file output in the results folder. They are also reported to the _messages layer.</li>
</ul>
<p>Repeated timesteps may be an indication the solution is numerically “on-the-edge”. Models that have a high number of repeated timesteps should be sensitivity tested by reducing the control number limits using <a href="#tcfControlNumberFactor">Control Number Factor</a>. For example, repeat the simulation using <tcmd><a href="#tcfControlNumberFactor">Control Number Factor</a></tcmd><teq> == </teq><tblk>0.8</tblk> and compare the results. If there are acceptably immeasurable changes in the results, then running at the default control number limits can be considered satisfactory.</p>
<p><em>Tip: Reviewing the TUFLOW HPC minimum timestep output is a useful way to assess HPC model health. Models that reduce to an excessively small 2D timestep in order to remain stable may be symptomatic of an unhealthy model. Identifying what the limiting control number is that is causing the timestep requirement can provide clues to the model feature to review for errors. For example:</em></p>
<ul>
<li><em>Celerity Control (Nc) number relates to water depth relative to cell size. Energy can pass through deeper water faster than shallow water, as such deep water will trigger this control. Review whether the water depth is realistic, or the result of an error in the model topography.</em></li>
<li><em>Courant number (Nu) relates to velocity relative to the cell size. High velocities will trigger this as the control. Investigate whether the feature causing the high velocity is realistic.</em></li>
<li><em>Diffusion control (Nd) relates diffusion of momentum relating to the sub grid viscosity. Small cells in deep water will trigger this one. Models controlled by the diffusion number tend to require a timestep significantly smaller than those controlled by the shallow wave celerity or courant numbers. If a model is predominantly diffusion controlled it may be that equivalent solution accuracy can be achieved by selecting a larger cell size. This is worth testing, as it will most likely increase the simulation speed with no loss of result fidelity.</em></li>
</ul>
<p><em>Section <a href="#QAchecklist-2"><strong>??</strong></a> includes guidance focused on reviewing model health and resolving issues.</em></p>
<h4 class="hasAnchor" id="TimesteppingEfficiencyOutput-4"><span class="header-section-number">3.5.4.1</span> Timestep Efficiency Output<a href="#TimesteppingEfficiencyOutput-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A timestep efficiency result is output for HPC simulations, reported to the console window, HPC log file (.hpc.tlf) and the timestep history file (.dt.csv). A value of 100%
indicates that the HPC timesteps are perfectly aligned with the minimum
stability timestep for complying with the three control numbers listed in
Table <a href="#tab:tab-HPCTimestep">10</a>. Factors that reduce the timestepping efficiency can be:</p>
<ul>
<li>Lower initial timestep than required. This will be evident by low
values at the start, then steadily increasing towards 100% as the
timestep approaches the optimum value – see example further below.</li>
<li>Synchronisation with a 1D scheme. The 1D/2D linking with TUFLOW’s 1D
solver (ESTRY) is designed to synchronise exactly using the larger of
the 1D or 2D timesteps. For external 1D schemes, the timestepping is
similarly synchronised, with some external 1D schemes also offering an
unsynchronised option. In all cases, the HPC 2D timestepping will be
below optimum by varying degrees, with the inefficiency shown in the
timestepping efficiency output.</li>
<li>Frequent map or time-series output. The HPC timestepping is configured to
align exactly with map and time-series output intervals, therefore,
timesteps nearly always need to be reduced as an output interval is
approached. These reduced timesteps can be found in the “dt” column of
the hpc.dt.csv file. The ideal timestep without the output interval
reductions is reported in the “dtStar” column.</li>
</ul>
<p>For example, in the output window below, the efficiency is initially
poor (~40%) due to the initial timestep in the model being too low,
however the efficiency rapidly increases as the HPC timestep increases.</p>
<center>
<img src="images/image18.png" width="100%" style="display: block; margin: auto;" />
</center>
<p><em>Note: Should a model exhibit low overall timestepping efficiency
(i.e. values less than around 70 to 90%), please let us know via
<a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>, and attach the .tlf, .hpc.tlf and dt.csv files.</em></p>
<h2 class="hasAnchor" id="SimulationTimes-2"><span class="header-section-number">3.6</span> Simulation Times<a href="#SimulationTimes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The simulation time of a model is dependent on several factors
including:</p>
<ul>
<li>The area to be modelled<br />
</li>
<li>The cell size of the model<br />
</li>
<li>The number of cells that are wet<br />
</li>
<li>The duration of the simulation</li>
<li>The solution scheme (TUFLOW Classic or TUFLOW HPC)<br />
</li>
<li>Computer Hardware (CPU or GPU)</li>
</ul>
<p>Each of the factors listed above should be considered during the
development of a model.</p>
<p>A simple spreadsheet has been created to estimate TUFLOW Classic
simulation times based on the cell size, catchment area and model run
time (i.e. event duration). The spreadsheet can be downloaded from the
<a href="https://wiki.tuflow.com/Estimating_Runtimes">TUFLOW Wiki</a>. This
spreadsheet is a basic guide, as it has several simplified assumptions, including the timestep, number of calculations per second the computer can run and fraction of wet cells (this will change throughout the simulation). Acknowledging these assumptions, it is still a useful guide. further consideration of the model design is recommended if the spreadsheet is estimating excessively long simulation times.</p>
<p>The speed at which TUFLOW simulations will run is dependent on the hardware used. Newer and higher CPU frequency computers will run faster than older lower CPU frequency computers. A hardware benchmark model is available from the <a href="https://wiki.tuflow.com/Hardware_Benchmarking_(2018-03-AA)">TUFLOW Wiki</a>. This page also contains the simulation times for the same model on a large range of computers and GPU devices.</p>
<ul>
<li><a href="https://wiki.tuflow.com/Hardware_Benchmarking_-_Results#CPU_Results">TUFLOW Hardware Benchmark CPU Results</a></li>
<li><a href="https://wiki.tuflow.com/Hardware_Benchmarking_-_Results#GPU_Results">TUFLOW Hardware Benchmark GPU Results</a></li>
</ul>
<p>There are several other secondary factors that can affect the speed performance of TUFLOW simulations, including:</p>
<ul>
<li>The latency to the location where results are being written. For fastest speed, write results directly to a local computer hard drive. Lower latency associated with writing to an external hard drive can slow a simulation down significantly.<br />
</li>
<li>How frequently output is written, with more frequent output slowing the simulation.</li>
<li>The output format(s) selected. XMDF and DAT formats are quicker to write than grid raster output types (TIF, FLT and ASC). Use XMDF format for temporal Map Output. Reserve grid raster output formats for maximum results.<br />
</li>
<li>Whether the single or double precision version of TUFLOW is used - the
single precision version will be faster. This is discussed in Section <a href="#iSPdSP-3"><strong>??</strong></a>.</li>
</ul>
<p>These factors are typically less significant than the primary factors listed at the start of this section (model size, cell count etc.).</p>
<p>As outlined in Section <a href="#Hardware-1"><strong>??</strong></a>, the GPU Module may be utilised to
increase simulation speed using TUFLOW HPC. The speed up ratio compared to CPU varies depending on model particulars and the hardware used. Nevertheless, the typical range in performance increase experienced using current technology (at the time of writing) is a 10x to 50x increase in simulation speed.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="ControlFiles-and-Inputs-1"><span class="header-section-number">4</span> Control Files and Input Layers<a href="#ControlFiles-and-Inputs-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!--

(new section)
Databases
I think we could have a section on databases. It wouldn't be too big, but it would briefly mention 
bc_dbase, material database (material file), pit_dbase, rainfall grid csv, soil database (soil file).
Most of them only support CSV (or similar txt based format), but bc_dbase also supports the hec dss database format, and maybe in future something like
sqlite could be added, so it allows us to expand our offering in future if that's something we want to do.

GIS Layers (remove 'Spatial' from heading)
- I might be wrong, but GIS is a lot more mainstream and people generally understand what it is nowadays, so i think we
can delete a lot of the text devoted to really obvious things like 'the spatial location of the GIS layer is really important!'
- see comments within section

Other input files:
maybe just not have this section and move XF Files to it's own section since they are pretty important nowadays. We can also delete the section on fixed field formats.
-->
<!--EFC: above is done, note EAS + EFC decided not to include rainfall in database table-->
<h2 class="hasAnchor" id="introduction"><span class="header-section-number">4.1</span> Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter discusses TUFLOW model inputs, which include the TUFLOW Control Files (text-based, easy to script, input files) and GIS layers (.shp, .gpkg or .mif formatted files). The different control files will be discussed along with how different objects within the GIS layers are treated by TUFLOW.</p>
<h2 class="hasAnchor" id="control-files"><span class="header-section-number">4.2</span> Control Files<a href="#control-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The TUFLOW Control files are text files containing a series of commands (instructions) that control how a model is constructed and how a simulation proceeds. They are easily scripted and interpreted, typically short in length, and very powerful for enabling efficient workflows.</p>
<p>This overview chapter discusses:</p>
<ul>
<li>Rules and notation in regards to control files (Section <a href="#Notation-3"><strong>??</strong></a>),</li>
<li>Absolute and relative file paths (Section <a href="#FilePath-3"><strong>??</strong></a>),</li>
<li>The available units (e.g. Metric or Imperial) (Section <a href="#Units-3"><strong>??</strong></a>), and</li>
<li>The control files (Section <a href="#TCF-3"><strong>??</strong></a> to Section <a href="#Override-3"><strong>??</strong></a>).</li>
</ul>
<p>Table <a href="#tab:tab-ControlFiles">11</a> lists the available control files, provides a brief description and a link to the respective section of this Chapter that discusses the individual control file.</p>
<table>
<caption>
<span id="tab:tab-ControlFiles">Table 11: </span><strong>List of Available Control Files</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Control File
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Section
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TCF
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>C</strong>ontrol <strong>F</strong>ile (.tcf) file sets simulation parameters and directs input from other data sources. It is the top of the tree, with all input files accessed via the .tcf file or files referred to from the .tcf file. Each TUFLOW simulation must have a .tcf file.
</td>
<td style="text-align:left;">
Section <a href="#TCF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
ECF
</td>
<td style="text-align:left;">
The <strong>E</strong>STRY <strong>C</strong>ontrol <strong>F</strong>ile (.ecf) includes all of the 1D files and commands. 1D commands can also be embedded into the .tcf file should the modeller prefer.
</td>
<td style="text-align:left;">
Section <a href="#ECF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TBC
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>B</strong>oundary<strong>C</strong>ontrol File (.tbc) includes commands related to internal and external boundaries and linking of 1D/2D.
</td>
<td style="text-align:left;">
Section <a href="#TBC-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TGC
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>G</strong>eometry<strong>C</strong>ontrol File (.tgc) includes commands and geometric / topographic data inputs to build the 2D domain.
</td>
<td style="text-align:left;">
Section <a href="#TGC-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
QCF
</td>
<td style="text-align:left;">
The <strong>Q</strong>uadtree <strong>C</strong>ontrol <strong>F</strong>ile (.qcf) includes the commands required to build a quadtree mesh.
</td>
<td style="text-align:left;">
Section <a href="#QCF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TEF
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>E</strong>vent <strong>F</strong>ile (.tef) includes a database of .tcf and/or .ecf commands related to specific events.
</td>
<td style="text-align:left;">
Section <a href="#TEF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TOC
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>O</strong>perational <strong>C</strong>ontrol File (.toc) includes operating rules that can be applied to hydraulic structures, pumps and other controllable devices modelled as 1D elements.
</td>
<td style="text-align:left;">
Section <a href="#TOC-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TRFC
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>R</strong>ain<strong>f</strong>all <strong>C</strong>ontrol File (.trfc) includes commands to generate rainfall grids based on point rainfall gauges.
</td>
<td style="text-align:left;">
Section <a href="#TRFC-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TESF
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>E</strong>xternal <strong>S</strong>tress <strong>F</strong>ile (.tesf) includes commands to define time varying global or spatially varying external forces such as wind or wave radiation stresses.
</td>
<td style="text-align:left;">
Section <a href="#TESF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
ADCF
</td>
<td style="text-align:left;">
The <strong>A</strong>dvection <strong>D</strong>ispersion <strong>C</strong>ontrol <strong>F</strong>ile (.adcf) includes the commands required for AD model execution.
</td>
<td style="text-align:left;">
Section <a href="#ADCF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
TSCF
</td>
<td style="text-align:left;">
The <strong>T</strong>UFLOW <strong>S</strong>WMM <strong>C</strong>ontrol <strong>F</strong>ile contains the relevant commands needed to manage the SWMM simulation.
</td>
<td style="text-align:left;">
Section <a href="#TSCF-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Read File
</td>
<td style="text-align:left;">
A TUFLOW Read File is a file included inside another file. Any file extension be used, with .trd traditionally used for 2D commands and .erd for 1D. Read files are useful for commands that are common to multiple simulations or for commands that are rarely or never changed and can be placed into another file to reduce the size of the parent file. Up to 9 levels of read files can be nested.
</td>
<td style="text-align:left;">
Section <a href="#ReadFile-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Override File
</td>
<td style="text-align:left;">
Override Files allow the user to apply .tcf commands after TUFLOW has finished processing the commands which are referenced within the .tcf file.
</td>
<td style="text-align:left;">
Section <a href="#Override-3"><strong>??</strong></a>
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="Notation-3"><span class="header-section-number">4.2.1</span> Rules and Notation<a href="#Notation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Control files, such as the TUFLOW Control File (TCF), TUFLOW Boundary Control (TBC) and TUFLOW Geometry Control (TGC), are command or keyword driven text or script files. The commands are entered free form, based on the rules described below. Comments may be entered at any line or after a command. The commands are listed in Appendix <a href="#TCFCommands-1"><strong>??</strong></a> to Appendix <a href="#TSCFCommands-1"><strong>??</strong></a>.</p>
<p><strong>Note: TUFLOW control files and commands are <u>NOT</u> case sensitive.</strong></p>
<p>An example of a command is:</p>
<p><tcmd>Start Time</tcmd><teq> ==</teq><tblk> 10</tblk> <tgrn>! Simulation starts at 10:00am on 2/9/1962</tgrn></p>
<p>This command sets the simulation start time to 10 hours. The text to the right of the “!” is treated as a comment and not used by TUFLOW when interpreting the line.</p>
<p>Automatic colour coding (as shown in the above example) of files for easy interpretation is available, with download links and installation instructions, for the following text editors: <a href="https://wiki.tuflow.com/NotepadPlusPlus_Highlighting">Notepad++</a>, <a href="https://wiki.tuflow.com/UltraEdit_Colour_Coding">UltraEdit</a> and <a href="https://wiki.tuflow.com/TextPad_Tips">TextPad</a>.</p>
<p>Commands can be repeated as often as needed. This offers significant
flexibility and effectiveness when modelling, particularly in building
1D and 2D model topography. Note that a repeat occurrence of a command
may override the effect of previous occurrence(s) of the same command.</p>
<p>The style of input is flexible bar a few rules. The rules are:</p>
<ul>
<li>A few characters are reserved for special purposes as described in Table <a href="#tab:tab-CharactersTextFiles">12</a>;<br />
</li>
<li>Command syntax is not case sensitive;<br />
</li>
<li>Only one command can occur on a single line; and</li>
<li>A few commands rely on another command being previously specified. These are documented where appropriate.</li>
</ul>
<p>Additional text can be placed before and/or after a command. For example, a line containing the command <a href="#tcfStartTime">Start Time</a> to set the start time of a simulation to 10 hours can be written as:</p>
<p><tcmd>Start Time </tcmd><teq>== </teq><tblk>10</tblk>, or<br />
<tcmd>Start Time (h)</tcmd><teq> ==</teq><tblk> 10</tblk></p>
<p>The (h) text is not a requirement but is useful to indicate that the units are hours. Alternatively, the following would also be acceptable, noting the use of the comment delimiter “!”:</p>
<p><tcmd>Start Time </tcmd><teq>== </teq><tblk>10 </tblk><tgrn>! hours </tgrn></p>
<p>Blank lines are ignored. Spaces or indentations can occur at the start of the line. This is recommended when using the logic control, as outlined in Section <a href="#SimulationManagement-2"><strong>??</strong></a>. The second line in the following example is not required to be indented, however, it is strongly recommended to facilitate easy interpretation:</p>
<p><tcmd>If Scenario </tcmd><teq>== </teq><tblk>GPU</tblk><br />
 <tcmd>GPU Solver </tcmd><teq>== </teq><tblk>ON</tblk><br />
<tcmd>End If</tcmd></p>
<p>The notation used to document commands and valid parameter values in Appendix <a href="#TCFCommands-1"><strong>??</strong></a> to Appendix <a href="#TSCFCommands-1"><strong>??</strong></a> are presented in Table <a href="#tab:tab-DocumentationTextFiles">13</a>.</p>
<table>
<caption>
<span id="tab:tab-CharactersTextFiles">Table 12: </span><strong>Reserved
Characters – Text Files</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Reserved Character(s)
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
“#” or “!”
</td>
<td style="text-align:left;">
A “#” or “!” causes the rest of the line from that point on to be ignored. Useful for “commenting-out” unwanted commands, and for all that modelling documentation.
</td>
</tr>
<tr>
<td style="text-align:left;">
==
</td>
<td style="text-align:left;">
<p>A “==” following a command indicates the start of the parameter(s) for the command. Where there is more than one parameter, the parameter values are read as free-field formatted, i.e. are space or comma delimited.</p>
<p>When processing command line syntax within the control files (.tcf, .tgc, .ecf etc.), if a “==” is not present in the command line syntax TUFLOW will produce an <a href="https://wiki.tuflow.com/TUFLOW_Message_0060">ERROR 0060</a>.</p>
For example “<tcmd>If Scenario</tcmd> = <tblk>Exg</tblk>” will produce an error as the correct syntax is “<tcmd>If Scenario</tcmd><teq> == </teq><tblk>Exg</tblk>”.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-DocumentationTextFiles">Table 13: </span><strong>Notation Used in
Command Documentation – Text Files</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Documentation Notation
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
&lt; … &gt;
</td>
<td style="text-align:left;">
Greater than and less than symbols are used to indicate a variable parameter. For example, the commonly used &lt;file&gt; example is described below. </file>
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;file&gt; </file>
</td>
<td style="text-align:left;">
A filename (can include an absolute or relative path, or a UNC path). See Section <a href="#FilePath-3"><strong>??</strong></a> for a more detailed description.
</td>
</tr>
<tr>
<td style="text-align:left;">
[ {Op1} | Op2 ]
</td>
<td style="text-align:left;">
<p>The square brackets “[” and “]” surround parameter options.</p>
<p>The “|” symbol separates the options.</p>
<p>The “{” and “}” brackets indicate the default option. This option is applied if the command is not used.</p>
<p>For example, the options for the <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a> command are:</p>
<p><tblk>[ ON | {ON MAXIMUMS ONLY} | OFF ] </tblk></p>
Where the default is <tblk>ON MAXIMUMS ONLY</tblk> (which stores the maximums, but not the minimums).
</td>
</tr>
<tr>
<td style="text-align:left;">
spaces
</td>
<td style="text-align:left;">
<p>Spaces can occur in commands and parameter options. If a space occurs in a command, it is only one (1) space, not two or more spaces in succession.</p>
Spaces can occur in file and path names; however, third party software may not allow this and as such is not recommended. If using spaces in filenames, batch files will require that the filename is enclosed in quotes.
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="FilePath-3"><span class="header-section-number">4.2.2</span> File Paths<a href="#FilePath-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW control files reference additional files, for example GIS files. The three methods that can be used are absolute file path, relative file path and UNC file path referencing. A model can use any or all these methods. However, relative file paths are typically preferred.</p>
<p><strong>Note: Depending on the operating system, file paths may be case sensitive.</strong></p>
<p>Take an example of reading a GIS layer containing initial water levels, the command is <tcmd>Read GIS IWL</tcmd><teq> ==</teq><tblk> &lt;filepath&gt;</tblk>. The following are all valid:</p>
<ul>
<li>Absolute file path: <tcmd>Read GIS IWL</tcmd><teq> ==</teq><tblk> L:\2d_IWL_001_R.shp</tblk><br />
</li>
<li>Relative file path: <tcmd>Read GIS IWL</tcmd><teq> ==</teq><tblk> ..\2d_IWL_001_R.shp</tblk><br />
</li>
<li>UNC file path: <tcmd>Read GIS IWL</tcmd><teq> ==</teq><tblk> \server1\2d_IWL_001_R.shp</tblk></li>
</ul>
<p>For the relative file path, the path is relative to the file that is referring to it. In the case above, if the command occurred in the .tcf file, which is in the TUFLOW\runs\ folder, the ..\ indicates to go up one level (from TUFLOW\runs\ to TUFLOW\ the model\ navigates into the TUFLOW\model\ folder, gis\ navigates from TUFLOW\model\ into TUFLOW\model\gis\). To go up more than one level simply use ..\ multiple times (e.g. ..\..\ would navigate up two folders). If the file sits under the same folder, then the filename can be specified. In the below example the Model_Events.tef would need to sit in the same location as the .tcf.</p>
<p><tcmd>Event File</tcmd><teq> ==</teq><tblk> Model_Events.tef</tblk></p>
<p>The paths are relative to the current control file, a command in the geometry control file (TUFLOW\model\) would be relative to the .tgc location, not the .tcf location.</p>
<p>Using relative file paths has the advantage that the model can be moved or provided to another user and the control files do not need to be updated, if the model uses an absolute or UNC file path, all references will need to be updated if the model is moved.</p>
<p>Some large files may still use an absolute or UNC file path particularly where large datasets are shared across models. This avoids the need to copy the dataset into multiple projects. An example is:</p>
<p><tcmd>Read GIS IWL</tcmd><teq> ==</teq><tblk> \\server1_Coast_5m.flt</tblk></p>
<p>If using LINUX at any point during the modelling tasks or pre/post processing, it is recommended to set <tcmd><a href="#tcfUseForwardSlash">Use Forward Slash</a></tcmd><teq> ==</teq><tblk> ON</tblk>.</p>
<h3 class="hasAnchor" id="Units-3"><span class="header-section-number">4.2.3</span> Units<a href="#Units-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The default unit settings for all inputs in a TUFLOW model are metric, however, it is possible to create models using US Customary units (also known as Imperial or English units) by specifying the .tcf command <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> ==</teq><tblk> US Customary</tblk>. “<tblk>Imperial</tblk>” or “<tblk>English</tblk>” are also accepted and are treated
identically.</p>
<p>This manual uses the metric term for documentation purposes. If your model uses US Customary Units any user
defined values must also be specified in US Customary units. The metric unit and the equivalent US Customary unit are listed in Table <a href="#tab:tab-ModelUnits">14</a>, unless otherwise stated within this Manual. Model units can be checked by searching for the relevant parameter in the .tlf file (refer to Section <a href="#SimLog-2"><strong>??</strong></a>).</p>
<p>Output units are listed in Table <a href="#tab:tab-ExcludingHazard">102</a>.</p>
<!-- WJS, after EFC and PAR discussed we decided to reduce this table (as a catch all) rather than increase and be specific due to the amount (355) in the code. All output units are listed for both metric and US in Ch 9 data types 
-->
<table>
<caption>
<span id="tab:tab-ModelUnits">Table 14: </span><strong>Model Units - Inputs</strong>
</caption>
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Metric
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
US Customary
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;width: 50%; ">
m
</td>
<td style="text-align:center;width: 50%; ">
ft
</td>
</tr>
<tr>
<td style="text-align:center;width: 50%; ">
mm
</td>
<td style="text-align:center;width: 50%; ">
inches
</td>
</tr>
<tr>
<td style="text-align:center;width: 50%; ">
km<sup>2</sup>
</td>
<td style="text-align:center;width: 50%; ">
miles<sup>2</sup>
</td>
</tr>
<tr>
<td style="text-align:center;width: 50%; ">
kg
</td>
<td style="text-align:center;width: 50%; ">
pound
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="TCF-3"><span class="header-section-number">4.2.4</span> TCF<a href="#TCF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>T</strong>UFLOW <strong>C</strong>ontrol <strong>F</strong>ile (.tcf) file sets simulation parameters and directs input from other data sources. It is the top of the tree, with all input files accessed via the .tcf file or files referred to from the .tcf file. Each TUFLOW simulation must have a .tcf file. An example of a simple .tcf file is shown in Figure <a href="#fig:fig-ExampleTCF">18</a>.</p>
<p>The .tcf file must reference the following items as a minimum requirement (TUFLOW won’t run without them):</p>
<!-- WJS I deleted ESTRY + quadtree + materials from here, it says min requirements then has ESTRY and quadtree as optional. If we have optional ones here where do we draw the line? The only commands/files TUFLOW won't run without are the following -->
<ul>
<li><a href="#tcfGeometryControlFile">Geometry Control File</a> (Section <a href="#TGC-3"><strong>??</strong></a>)</li>
<li><a href="#tcfBCControlFile">BC Control File</a> (Section <a href="#TBC-3"><strong>??</strong></a>)</li>
<li><a href="#tcfStartTime">Start Time</a></li>
<li><a href="#tcfEndTime">End Time</a></li>
<li><a href="#tcfMapOutputInterval">Map Output Interval</a></li>
</ul>
<p>Recommended or most commonly used .tcf commands are:</p>
<ul>
<li><a href="#tcfReadMaterialsFile">Read Materials File</a></li>
<li><a href="#tcfBCDatabase">BC Database</a></li>
<li><a href="#tcfSolutionScheme">Solution Scheme</a></li>
<li><a href="#tcfESTRYControlFile">ESTRY Control File</a> (Section <a href="#ECF-3"><strong>??</strong></a>)<br />
</li>
<li><a href="#tcfQuadtreeControlFile">Quadtree Control File</a> (Section <a href="#QCF-3"><strong>??</strong></a>)</li>
<li><a href="#tcfSHPProjection">SHP Projection</a>/<a href="#tcfGPKGProjection">GPKG Projection</a>/<a href="#tcfMIProjection">MI Projection</a></li>
<li><a href="#tcfTimestep">Timestep</a></li>
<li><a href="#tcfOutputFolder">Output Folder</a></li>
<li><a href="#tcfMapOutputDataTypes">Map Output Data Types</a></li>
<li><a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a></li>
<li><a href="#tcfWriteCheckFiles">Write Check Files</a> and</li>
<li><a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a>.</li>
</ul>
<p>Commonly used or useful .tcf commands are: <a href="#tcfBCEventName">BC Event Name</a>; <a href="#tcfBCEventText">BC Event Text</a>; <a href="#tcfEventFile">Event
File</a>, <a href="#tcfReadFile">Read File</a>, <a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a>; <a href="#tcfInstabilityWaterLevel">Instability Water Level</a>; <a href="#tcfReadGISFC">Read GIS FC</a>; <a href="#tcfReadGISIWL">Read GIS IWL</a>; <a href="#tcfReadGISPO">Read GIS PO</a>; <a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a>; <a href="#tcfSetIWL">Set IWL</a>; <a href="#tcfStartMapOutput">Start Map Output</a>;
<a href="#tcfStartTimeSeriesOutput">Start Time Series Output</a>.</p>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-ExampleTCF"></span>
<img src="images/ExampleTCF.png" alt="Example of a Simple TCF"  />
<p class="caption">
Figure 18: Example of a Simple TCF
</p>
</div>
</center>
<p>Appendix <a href="#TCFCommands-1"><strong>??</strong></a> lists and describes .tcf commands and their parameters.</p>
<p>Note that it is possible to incorporate 1D (.ecf) commands into the .tcf file. 1D (.ecf) commands can be included in the .tcf file between <a href="#tcfStart1DDomain">Start 1D Domain</a> and <a href="#tcfEnd1DDomain">End 1D Domain</a> block(s). For the .tef file, 1D (.ecf) commands must be prefixed by “1D”. Also note that <a href="#tcfESTRYControlFile">ESTRY Control File</a> command is recognised every time if specified more than once.</p>
<h3 class="hasAnchor" id="ECF-3"><span class="header-section-number">4.2.5</span> ECF<a href="#ECF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Commands specific to TUFLOW (ESTRY) 1D domains are detailed in Appendix <a href="#ECFCommands-1"><strong>??</strong></a>, and can be placed either in the .tcf file (or in a <a href="#tcfReadFile">Read File</a>), or in their own file traditionally called an .ecf file. 1D commands can be located:</p>
<ul>
<li>Within an .ecf file and referenced within the .tcf file using the command <a href="#tcfESTRYControlFile">ESTRY Control File</a>. The command <a href="#tcfESTRYControlFile">ESTRY Control File Auto</a> can be used to force the .ecf file to have the same name as the .tcf file.<br />
</li>
<li>Placed within a 1D domain block in the .tcf using <a href="#tcfStart1DDomain">Start 1D Domain</a> and <a href="#tcfEnd1DDomain">End 1D Domain</a>
commands.<br />
</li>
<li>Placed anywhere in the .tcf file and preceded by “1D”, for example, <a href="#ecfManholeDefaultType">1D Manhole Default Type</a>. “1D” must be the first two characters.<br />
</li>
<li>Any combination of the above, however, it is strongly recommended in the interests of manageability that a logical approach be adopted (that agrees with your colleagues!).</li>
</ul>
<p>The .ecf file method is typically used if the 1D domain is large and complex, whereas the 1D domain block or preceding “1D” may be used where the 1D/2D linked model requires only a few 1D commands or they are placed in another file and referenced using <a href="#tcfReadFile">Read File</a>.</p>
<p>The 1D commands set simulation parameters and directs input from other data sources for all 1D domains. An example of some 1D commands are shown in Figure <a href="#fig:fig-ExampleECF">19</a>.</p>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-ExampleECF"></span>
<img src="images/ExampleECF.png" alt="Example of a Simple ECF"  />
<p class="caption">
Figure 19: Example of a Simple ECF
</p>
</div>
</center>
<p>Appendix <a href="#ECFCommands-1"><strong>??</strong></a> lists and describes the 1D commands and their parameters. Commands that are only relevant for 1D only models are indicated with a “1D Only” underneath the command in Appendix <a href="#ECFCommands-1"><strong>??</strong></a>.</p>
<p><strong>Note: At present it is not an option to truly have a 1D only model. For 1D only models, a single 2D model, which can be made up of a single inactive 2D cell, is still required.</strong></p>
<h3 class="hasAnchor" id="TBC-3"><span class="header-section-number">4.2.6</span> TBC<a href="#TBC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The .tbc file or TUFLOW Boundary Conditions Control File (TBC) contains information regarding the location and type of boundaries within the model. These include (but are not limited to) upstream and downstream boundaries as well as 1D/2D or 2D/2D links. The GIS layers read into the .tbc file reference the Boundary Condition (BC) Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>). The BC Database associates the GIS layers with a boundary condition such as a hydrograph or a depth-discharge curve.</p>
<p>Only one .tbc file per 2D domain can be specified in the .tcf file using the <a href="#tcfBCControlFile">BC Control File</a> command. A .tbc file must be specified, if no external boundaries are to be applied a blank file may be specified. This is rarely done but can be used for models based only on initial water levels.</p>
<p>Appendix <a href="#TBCCommands-1"><strong>??</strong></a> lists and describes .tbc commands and their parameters.</p>
<h3 class="hasAnchor" id="TGC-3"><span class="header-section-number">4.2.7</span> TGC<a href="#TGC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>2D domains are defined through a series of commands contained in <strong>T</strong>UFLOW <strong>G</strong>eometry <strong>C</strong>ontrol (.tgc) files. The .tgc file
contains, or accesses from other files, information on the size and orientation of the grid, grid cell codes (whether cells are active or inactive), bed/ground elevations, bed material type or flow resistance value, and optional data such as soil type.</p>
<p>A 2D domain is automatically generated as a grid of square cells. Each cell is given characteristics relating to the topography such as ground/bathymetry elevation, bed resistance value and initial water level, etc.</p>
<p>A .tgc file is specified in the .tcf file using <a href="#tcfGeometryControlFile">Geometry Control File</a>. For a TUFLOW Classic Multiple 2D Domain model, a separate .tgc file is required for each of the 2D domains, see Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.</p>
<p>Rather than contain all the 2D grid information in one file, the .tgc file is a series of commands that <strong>builds</strong> the model. The commands are applied in sequential order; therefore, it is possible to override previous information with new data to modify the model in selected areas. This is extremely useful where a base dataset exists, over which areas need to be modified to represent other scenarios such as a proposed development. This eliminates or minimises data duplication.</p>
<p>The commands can occur in any order (as long as it is a logical one).</p>
<p>If an unrecognisable command occurs, TUFLOW stops and displays the unrecognisable text.</p>
<p>Notes &amp; Tips:</p>
<ol style="list-style-type: decimal">
<li>Commands can be repeated any number of times.<br />
</li>
<li>Commands are executed in the order they occur. If the data for a 2D cell or Zpt is supplied more than once, the last data that is read is used (i.e. the latter data for a cell overrides any previous data for that cell).<br />
</li>
<li>Each data layer does not have to cover the entire model – only the 2D cells influenced by the objects in the layer (e.g. a 3D breakline) are affected.<br />
</li>
<li>Use <a href="#tcfWriteCheckFiles">Write Check Files</a> commands to cross-check and carry out quality control checks on the final 2D grid, elevations, material or land-use categories, etc.</li>
</ol>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-ExampleTGC"></span>
<img src="images/ExampleTGC.png" alt="Example of a Simple TGC"  />
<p class="caption">
Figure 20: Example of a Simple TGC
</p>
</div>
</center>
<p>Appendix <a href="#TGCCommands-1"><strong>??</strong></a> lists and describes .tgc commands and their parameters. An example of a .tgc file is shown in Figure <a href="#fig:fig-ExampleTGC">20</a>.</p>
<h3 class="hasAnchor" id="QCF-3"><span class="header-section-number">4.2.8</span> QCF<a href="#QCF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For a quadtree grid, the <strong>Q</strong>uadtree <strong>C</strong>ontrol <strong>F</strong>ile (.qcf) is used to define the grid refinement areas and optionally the model location and extent, see Section<a href="#Quadtree-3"><strong>??</strong></a>. A .qcf file is specified in the .tcf file using the <a href="#tcfQuadtreeControlFile">Quadtree Control File</a> command.</p>
<p>For a quadtree grid, only one .tgc file can be specified that covers all the 2D cell resolutions. The .qcf file primarily controls the nesting levels of different 2D cell resolutions, but may also control the overall grid orientation and location instead of the .tgc file. An example of setting up a model to use a quadtree grid is provided in <a href="https://wiki.tuflow.com/Tutorial_M07">TUFLOW Tutorial Module 7</a>.</p>
<p>Appendix <a href="#QCFCommands-1"><strong>??</strong></a> lists and describes .qcf commands and their parameters.</p>
<h3 class="hasAnchor" id="TEF-3"><span class="header-section-number">4.2.9</span> TEF<a href="#TEF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>T</strong>UFLOW <strong>E</strong>vents <strong>F</strong>ile (.tef) contains a database of .tcf and .ecf file commands for different events. A .tef file is specified in the .tcf file using the <a href="#tcfEventFile">Event File</a> command. Events are set up using a define event block, for example:</p>
<p><tcmd>Define Event</tcmd><br />
 <tcmd>BC Event Source </tcmd><teq>==</teq><tblk> ~AEP~ | 05p</tblk><br />
<tcmd>End Define</tcmd></p>
<p>Event management is a powerful functionality that allows running multiple event combinations (e.g. magnitude, duration, temporal patterns, climate change) using a single set of control files rather than creating a new set of control files for every simulation. This makes the management of the model easier, ensures consistency between the simulations, and better quality control. An example of the number of .tcf and bc_database files required for a model with and without event management is shown in Figure <a href="#fig:fig-ExampleTEF">21</a>.</p>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-ExampleTEF"></span>
<img src="images/ExampleTEF.png" alt="Reduction of Control Files using Event Management"  />
<p class="caption">
Figure 21: Reduction of Control Files using Event Management
</p>
</div>
</center>
<p>Event management is detailed in Section <a href="#Events-3"><strong>??</strong></a>. An example of setting up a model to use event management is provided in <a href="https://wiki.tuflow.com/Tutorial_M09">TUFLOW Tutorial Module 9</a>.</p>
<h3 class="hasAnchor" id="TOC-3"><span class="header-section-number">4.2.10</span> TOC<a href="#TOC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>T</strong>UFLOW <strong>O</strong>perations <strong>C</strong>ontrol (.toc) contains operating rules for structures. A .toc file is specified in the .ecf file using the <a href="#ecfReadOperatingControlsFile">Read Operating Controls File</a> command, or in the .tcf file within a <a href="#tcfStart1DDomain">Start 1D Domain</a> block. Operational Channels are detailed in Section <a href="#OperationalChannels-2"><strong>??</strong></a>. An example of its use is provided in <a href="https://wiki.tuflow.com/Tutorial_M10#Part_3_-_1D_Piping_Failure_and_1D_Dam_Failure">TUFLOW Tutorial Module 10 Part 3</a>.</p>
<p>Appendix <a href="#TOCCommands-1"><strong>??</strong></a> lists and describes .toc commands and their parameters.</p>
<h3 class="hasAnchor" id="TRFC-3"><span class="header-section-number">4.2.11</span> TRFC<a href="#TRFC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>T</strong>UFLOW <strong>R</strong>ain<strong>f</strong>all <strong>C</strong>ontrol File (.trfc) contains commands used to generate rainfall grids based on point rainfall gauges. This approach generates a series of rainfall grids available to the user for display or checking. A .trfc file is specified in the .tcf using the <a href="#tcfRainfallControlFile">Rainfall Control File</a> command. An example of its use is provided in <a href="https://wiki.tuflow.com/Tutorial_M06#Part_3_-_Rainfall_Control_File">TUFLOW Tutorial Module 6 Part 3</a>.</p>
<p>Appendix <a href="#TRFCCommands-1"><strong>??</strong></a> lists and describes .trfc commands and their parameters.</p>
<h3 class="hasAnchor" id="TESF-3"><span class="header-section-number">4.2.12</span> TESF<a href="#TESF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>E</strong>xternal <strong>S</strong>tress <strong>F</strong>ile (.tesf) allows the definition of time varying global or spatially varying external forcing such as wind or wave radiation stresses. A .tesf file is specified in the .tcf using the <a href="#tcfExternalStressFile">External Stress File</a> command. External stress boundaries are discussed in Section <a href="#ExternalStress-2"><strong>??</strong></a>.</p>
<p>Appendix <a href="#TESFCommands-1"><strong>??</strong></a> lists and describes .tesf commands and their parameters.</p>
<h3 class="hasAnchor" id="ADCF-3"><span class="header-section-number">4.2.13</span> ADCF<a href="#ADCF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>T</strong>UFLOW <strong>A</strong>dvection <strong>D</strong>ispersion <strong>C</strong>ontrol <strong>F</strong>ile contains commands related to the TUFLOW Advection Dispersion (AD) Module for simulating depth-averaged, constituent fate and transport. The .adcf is specified in the .tcf using the <a href="#tcfADControlFile">AD Control File</a> command. The Advection Dispersion module is discussed in Chapter <a href="#AD-1"><strong>??</strong></a>.</p>
<p>Appendix <a href="#ADCFCommands-1"><strong>??</strong></a> lists and describes .adcf commands and their parameters.</p>
<h3 class="hasAnchor" id="TSCF-3"><span class="header-section-number">4.2.14</span> TSCF<a href="#TSCF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW 2D domains can be dynamically linked to SWMM’s 1D solution scheme. The <strong>T</strong>UFLOW <strong>S</strong>WMM <strong>C</strong>ontrol File (.tscf) contains the SWMM input commands. The .tscf file is specified in the .tcf using the <a href="#tcfSWMMControlFile">SWMM Control File</a> command. Section <a href="#OneD2DLinkingSWMM-2"><strong>??</strong></a> provides information on linking to the 1D scheme, and examples are given in the <a href="https://wiki.tuflow.com/TUFLOW_SWMM_Tutorial_Introduction">TUFLOW SWMM Tutorials</a>.</p>
<p>Appendix <a href="#TSCFCommands-1"><strong>??</strong></a> lists and describes .tscf commands and their parameters.</p>
<h3 class="hasAnchor" id="ReadFile-3"><span class="header-section-number">4.2.15</span> Read File<a href="#ReadFile-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="#tcfReadFile">Read File</a> command is extremely useful for placing commands that remain unchanged or are common for a group of simulations in another file (e.g. the <a href="#tcfSHPProjection">SHP Projection</a> command will be the same for all runs within the same study area). This reduces the size/clutter of .tcf files and allows easy global changes to a group of simulations to be made.</p>
<p>The file extensions most commonly used are .trd (2D commands), .erd (ESTRY 1D commands) and .rdf.</p>
<h3 class="hasAnchor" id="Override-3"><span class="header-section-number">4.2.16</span> Override Files<a href="#Override-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>These optional override files allow the user to apply .tcf commands after TUFLOW has finished processing the commands referenced within the .tcf file. This can be useful where you wish to change a parameter for all simulations that are started from a common folder. For example, you could turn off check files, or change the output drive.</p>
<p>Two override file types are possible, one which is computer specific and one which is processed by all computers. If either or both are present, they are processed after all the .tcf file commands have been processed so that the override commands prevail.</p>
<p>The first override file that TUFLOW checks for is named “_TUFLOW_Override.tcf”. If this file exists within the same folder as the .tcf file, .tcf commands that are listed within the “_TUFLOW_Override.tcf” file overwrite the commands in the .tcf file.</p>
<p>The second one TUFLOW looks for must be named “_TUFLOW_Override_&lt;computer_name&gt;.tcf”, where &lt;computer_name&gt; is
the name of the computer running the simulation. If this file exists TUFLOW will process any commands within it after any commands from the “_TUFLOW_Override.tcf” file (if it exists). If you are unsure of your computer name, this is displayed in the computer’s properties or in a TUFLOW Log File (.tlf) that has been processed on that computer, this is typically at the top of the .tlf (line 6). For example:</p>
<p><tblk>Computer Name: COMP1234</tblk></p>
<p>With the computer name above the computer specific override file would
be named “_TUFLOW_Override_COMP1234.tcf”.</p>
<p>An override file specific to a particular computer can be particularly
useful where, for example, different output drives or results folders,
are to be used for runs using different computers. This will allow you
to run TUFLOW simulations on different computers without having to
change the .tcf file.</p>
<p>For example, if a run is started on one machine that only has a C drive, output can be directed to the C drive just for that computer by using the command <tcmd><a href="#tcfOutputDrive">Output Drive</a></tcmd><teq> ==</teq><tblk> C</tblk>.</p>
<p>Another example is if using the GPU solver and one machine only has a single GPU, while another has four GPUs. The command <tcmd><a href="#tcfGPUDeviceIDs">GPU Device IDs</a></tcmd><teq> ==</teq><tblk> 0, 1, 2, 3</tblk> can be specified in the override file specific to the machine with four GPUs.</p>
<p>Nearly all .tcf commands can be placed within the override files except for “Read GIS” and some other similar commands that involve processing of data layers. It is recommended that the override files are only used for global changes to settings, similar to the examples above.</p>
<h2 class="hasAnchor" id="Databases-2"><span class="header-section-number">4.3</span> Databases<a href="#Databases-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Databases are organised collections of structured data in comma delimited (.csv) or text based formats that can be read into TUFLOW Control files. Table <a href="#tab:tab-ControlFiles">11</a> lists the available databases, provides a brief description and a link to the respective section that discusses the specific database.</p>
<table>
<caption>
<span id="tab:tab-Database">Table 15: </span><strong>List of Available Databases</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Database
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Section
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
bc_dbase
</td>
<td style="text-align:left;">
The boundary condition (BC) database can be in either .csv (comma delimited) format, or HEC-DSS (see Section <a href="#HECDSS-3"><strong>??</strong></a>). It must contain a row with the pre-defined keywords ‘Name’ and ‘Source’, as listed in Table <a href="#tab:tab-KeywordDescriptions">85</a>. Other keywords control how data is extracted from the source.
</td>
<td style="text-align:left;">
Section <a href="#bcdbase-2"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
materials
</td>
<td style="text-align:left;">
The materials database can be in either a text based format (.tmf) or comma delimited format (.csv). It contains the Manning’s n value and other information for different materials (e.g. land-uses). The format of the materials .tmf file is described in Table <a href="#tab:tab-MaterialsFile">60</a>. The format of the materials .csv file is described in Table <a href="#tab:tab-MaterialsFormat">59</a>.
</td>
<td style="text-align:left;">
Section <a href="#Materials-File-4"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
pit_dbase
</td>
<td style="text-align:left;">
For pit channels specified as a Q Type, the flow through the pit is controlled by a depth-discharge curve defined within the <a href="#ecfPitInletDatabase">Pit Inlet Database</a>. The database file sources depth-discharge curves in
other .csv files. The
format of the Pit Inlet Database is described in Table <a href="#tab:tab-DatabaseFormat">43</a>.
</td>
<td style="text-align:left;">
Section <a href="#DD-Database-3"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
soils
</td>
<td style="text-align:left;">
Soils infiltration is applied to the model by defining a soils (.tsoilf) file which is read into the .tcf using the command <a href="#tcfReadSoilFile">Read Soils File</a>. An integer ID to each soil, define the infiltration method followed by the soil parameters as the remaining values. Table <a href="#tab:tab-tsoilf">62</a> presents the parameters of the .tsoilf file available for TUFLOW Classic, the additional options available for TUFLOW HPC are presented in Table <a href="#tab:tab-tsoilf-hpc">70</a>.
</td>
<td style="text-align:left;">
Section <a href="#tsoilf-4"><strong>??</strong></a>
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="GISLayers-2"><span class="header-section-number">4.4</span> Input Layers<a href="#GISLayers-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="GISFormats-3"><span class="header-section-number">4.4.1</span> Input Formats<a href="#GISFormats-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The main types of GIS Inputs are vectors, rasters and TINs. The following formats are supported as inputs in TUFLOW:</p>
<ul>
<li>GIS vector data layers: GeoPackage (.gpkg) (recommended), Shapefile (.shp) and MapInfo (.mif) (default) formats.<br />
</li>
<li>GIS raster data layers: GeoTIFF (.tif) (recommended &amp; default), GeoPackage (.gpkg), Float (.flt) and ASCII (.asc) formats. NetCDF formats are supported for some inputs such as time-varying rainfall grids.<br />
</li>
<li>GIS TIN data layers: Land XML (.xml), 12d tin (.12da) formats (including super TINs) and SMS (.tin).</li>
</ul>
<p>Most mainstream CAD/GIS platforms recognise these formats.</p>
<p>The format of input layers is solely controlled by the file extension. For example, for the vector formats, “.gpkg” for the GPKG format database (noting that no extension is used for a layer within a database), “.shp” for the SHP format and “.mif” for the MIF format. Prior to the 2023-03 release, if no file extension was specified TUFLOW assumed the input layer was in .mif format. To support the new GeoPackage format (the recommended vector format), TUFLOW will produce <a href="https://wiki.tuflow.com/TUFLOW_Message_0631">ERROR 0631</a> for inputs with no extension.</p>
<p>TUFLOW requires that all GIS layers imported or exported by TUFLOW must be in the <strong>same geographic projection.</strong> The model projection is initialised using the <a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> and <a href="#tcfMIProjection">MI Projection</a> commands. Multiple input formats can be used (e.g. a mix of all format types within one model is allowed). If a model uses a mixture of format types as inputs, a projection command should be specified for each format.</p>
<p>The default output format for GIS check layers and GIS outputs depends on the Projection setting as mentioned above. If more than one Projection setting is specified, or to force the GIS output format, use the <a href="#tcfGISFormat">GIS Format</a> command. The GeoPackage format is that recommended due to superior file/data management storage, data compression, and far greater viewing and querying speeds.</p>
<p>The default raster format is the GeoTIFF (.tif) format. Although a check is not done on the projection of .tif inputs, a projection can be assigned to .tif output rasters using the <a href="#tcfTIFProjection">TIF Projection</a> command.</p>
<h3 class="hasAnchor" id="GISCommands-3"><span class="header-section-number">4.4.2</span> GIS Commands<a href="#GISCommands-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Commands containing “GIS” read and/or write a GIS vector layer. GIS commands read the geometry, attribute data, and projection data of the input layer. The available formats of input vector and raster layers are listed in Section <a href="#GISFormats-3"><strong>??</strong></a>. The geographic location of objects for GIS commands is important as the geographic position of the object controls the part of the TUFLOW model they affect.</p>
<p>When digitising objects, it is preferable that they do not snap to the 2D cell sides or corners as this may produce indeterminate effects.</p>
<h4 class="hasAnchor" id="Attributes-4"><span class="header-section-number">4.4.2.1</span> GIS Attribute Interpretation<a href="#Attributes-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW expects certain attributes, in a specific order for input layers. For example an initial water level layer (2d_iwl) layer only requires a single attribute (which is the initial water level value), whilst a 1d channel layer (1d_nwk) has a number of attributes including channel type, channel roughness, upstream and downstream elevation. The attributes required for each input layer are detailed in their respective sections throughout this manual. Any additional attributes appended to the layer will be ignored by TUFLOW (with the exception of the 1d_nwk layer as TUFLOW will treat it as a 1d_nwke layer).</p>
<p>The .tcf command <a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a> can be used to automate the creation of template files with attribute structures that TUFLOW expects and with the recommended GIS data naming convention. They also can be automatically created using the <a href="https://wiki.tuflow.com/QGIS_TUFLOW_Import_Empty">TUFLOW Plugin Import Empty Tool</a>.</p>
<p>A list of the TUFLOW template files is available on the <a href="https://wiki.tuflow.com/TUFLOW_Empty_Files">TUFLOW Wiki</a>.</p>
<p>The names of GIS attributes as documented or produced by <a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a> may change from
previous TUFLOW releases to reflect new features and changes. The name of the attribute is irrelevant as far as TUFLOW is concerned as TUFLOW only requires that attributes are in the correct order and of the correct type (i.e. Character, Float, Integer, etc.). In all TUFLOW layers, the attributes can be named as the modeller wishes, so older layers that do not have the same attribute names as documented in this manual will still work correctly.</p>
<h4 class="hasAnchor" id="Objects-4"><span class="header-section-number">4.4.2.2</span> GIS Object Interpretation<a href="#Objects-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- 
I like these tables, but it is far more complicated now as different formats have different options:
e.g. Shapefiles support multi-points, but do not support multi-polylines or multi-polygons (at least in the same way that GPKG supports them).
Not sure if we just ignore the complication of it all, or make a note in the 'Multiple Objects' section that also points to a wiki page that goes
into a lot more detail (or maybe that detail belongs in the Manual?)

I also think it's worth noting in here that these are sometimes referred to as 'Single-Part' and 'Multi-Part' geometry.

In this section talk about how tuflow treats snapping between objects and this includes how tuflow can read in multiple layers on a single line.
-->
<p>Table <a href="#tab:tab-GISObjectsUsed">16</a> and Table <a href="#tab:tab-GISObjectsUnused">17</a> outline the compatible GIS objects and how they are interpreted by TUFLOW.</p>
<p>Object snapping is often used to relate point data with line and region data, for example with the <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tbcReadGISBC">Read GIS BC</a> command. TUFLOW supports point, end and vertex snapping. It does not support edge snapping. Objects that are linked (for example a 2d_bc “SX” type region and 2d_bc “CN” type line layer), must be snapped and also read in to TUFLOW on the same command line separated by a vertical bar “|”. For example:</p>
<p><tcmd>Read GIS BC </tcmd><teq>==</teq><tblk> 2d_bc_culvert_R.shp | 2d_bc_culvert_L.shp </tblk></p>
<table>
<caption>
<span id="tab:tab-GISObjectsUsed">Table 16: </span><strong>TUFLOW Interpretation of Supported GIS Objects</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Object Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
TUFLOW Interpretation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Point
</td>
<td style="text-align:left;">
Refers to the 2D cell that the point falls within or a 1D object such as a node or boundary location. Points snapped to the sides or corners of a 2D cell may give uncertain outcomes as to which cell the point refers to.
</td>
</tr>
<tr>
<td style="text-align:left;">
Line (straight line)
</td>
<td style="text-align:left;">
Variety of uses including defining a continuous line of 2D cells, 1D channels, to connect objects, alignment of a 3D breakline, linking 1D and 2D elements.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pline<br />
(line with one or more segments)
</td>
<td style="text-align:left;">
As for Line above.
</td>
</tr>
<tr>
<td style="text-align:left;">
Region (polygon)
</td>
<td style="text-align:left;">
<p>For 2D cells either:</p>
<ul>
<li>Modifies any 2D cell or cell mid-side/corner (e.g. Zpt) that falls within the region. If the command is modifying a whole 2D cell, it uses the cell’s centre to determine whether the cell falls inside or outside of the region. If the cell’s centre, mid-side or corner lies exactly on the region perimeter, uncertain outcomes may occur. Holes within a region are accepted except for polygon objects in shape layers used for TIN boundaries.</li>
<li>Or, only uses the region’s centroid. Examples are the original flow constriction layers (2d_fc) and time-series output locations for some output data types.</li>
</ul>
For 1D:<br />
1D nodes within the region are selected. If the 1D node falls exactly on the region perimeter uncertain outcomes may occur.
</td>
</tr>
<tr>
<td style="text-align:left;">
Multiple (Combined) Objects
</td>
<td style="text-align:left;">
In later versions of TUFLOW, multiple point, line and region objects are generally accepted (ERROR or WARNING messages are given if not the case).
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-GISObjectsUnused">Table 17: </span><strong>TUFLOW Interpretation of Unsupported GIS Objects</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Object Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
TUFLOW Interpretation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Arc
</td>
<td style="text-align:left;">
Ignored (do not use).
</td>
</tr>
<tr>
<td style="text-align:left;">
Collections
</td>
<td style="text-align:left;">
Not supported. Collections are groups of objects of differing type.
</td>
</tr>
<tr>
<td style="text-align:left;">
Ellipse
</td>
<td style="text-align:left;">
Ignored (do not use).
</td>
</tr>
<tr>
<td style="text-align:left;">
none
</td>
<td style="text-align:left;">
These objects are ignored and most commonly occur when a line of attribute data is added that is not associated with an object. In MapInfo, this occurs when a line of data is added directly to a Browser Window (i.e. no object was digitised).
</td>
</tr>
<tr>
<td style="text-align:left;">
Roundrect (Rounded Rectangle)
</td>
<td style="text-align:left;">
Ignored (do not use).
</td>
</tr>
<tr>
<td style="text-align:left;">
Rect (Rectangle)
</td>
<td style="text-align:left;">
Ignored (do not use).
</td>
</tr>
<tr>
<td style="text-align:left;">
Text
</td>
<td style="text-align:left;">
Ignored.
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="GPKG-3"><span class="header-section-number">4.4.3</span> GeoPackage Commands<a href="#GPKG-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://www.geopackage.org/">GeoPackage</a> is a widely supported, open format, built upon an SQLite database (this is stored as a single file with the extension .gpkg). The benefits of GeoPackage compared to the MapInfo (MIF/MID) and ESRI/QGIS Shapefile formats include:</p>
<ul>
<li>More than one layer can be stored in a single file. For example, all model inputs can be stored in a single GeoPackage database.</li>
<li>It supports spatial indexing, making it much faster to work with in GIS packages.</li>
<li>Significantly faster write speed from TUFLOW compared to the Shapefile format.</li>
</ul>
<p>For tips on using GeoPackages, see the <a href="https://wiki.tuflow.com/GeoPackage_Tips">GeoPackage Tips TUFLOW Wiki</a> page. Additionally, the <a href="https://wiki.tuflow.com/Tutorial_Introduction#Module_Data">TUFLOW Tutorials</a> are set up using the GeoPackage format and can be used as an introduction to using GeoPackages.</p>
<!-- CDH: The below text is duplicating what is already covered in the above bullet points - . It doesn't add much extra information. Consider deleting it. If we want to add anything, bring in the table 7.1 from the 2023 release notes.

Initially, support for this format was added to address some issues with the existing supported vector file formats, notably slow writing and viewing of Shapefiles for large datasets.  The MapInfo (MIF/MID) file format is much faster to write from TUFLOW than the Shapefile format, however, loading, rendering, and interacting with the MIF file in GIS packages is much slower than either the Shapefile or GeoPackage.  When loading either a MapInfo or Shapefile layer into GIS, typically all the data is loaded and processed when panning the map window, even the ones that are outside of the current view.  GeoPackage supports spatial indexing, so that when the view is panned or changed a limited set of objects (within that view) need to be drawn, this makes rendering and interacting with the data much faster.
-->
<h4 class="hasAnchor" id="GPKG-input-4"><span class="header-section-number">4.4.3.1</span> GPKG Input Commands<a href="#GPKG-input-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Since a GeoPackage database can have more than one layer, when reading data into TUFLOW, a GeoPackage file and table may both need to be specified. There are a variety of different options available. The following are possible:</p>
<ol style="list-style-type: decimal">
<li><p>To specify a table in a .gpkg directly use “&gt;&gt;”:</p>
<p><tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>gis\2d_zsh.gpkg &gt;&gt; 2d_zsh_L</tblk></p></li>
<li><p>If a .gpkg file path is only specified, with no table reference, it will be assumed that the table name is the same as the .gpkg database name. For example, the following two commands are equivalent to one another:</p>
<p><tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>gis\2d_zsh_L.gpkg</tblk><br />
<tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>gis\2d_zsh_L.gpkg &gt;&gt; 2d_zsh_L</tblk></p></li>
<li><p>To specify more than one table in a database in the same command line use “&amp;&amp;”. This is similar to “|” however there is no need to reference the database multiple times:</p>
<p><tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>gis\2d_zsh.gpkg &gt;&gt; 2d_zsh_L &amp;&amp; 2d_zsh_P</tblk><br />
“&amp;&amp;” can be used in conjunction with “|”:<br />
<tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>gis\2d_zsh_R.gpkg | gis\2d_zsh.gpkg &gt;&gt; 2d_zsh_L &amp;&amp; 2d_zsh_P</tblk></p></li>
<li><p>Use the command “USE ALL” with “&gt;&gt;” to tell TUFLOW to use all tables in the database:</p>
<p><tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>gis\2d_zsh.gpkg &gt;&gt; USE ALL</tblk></p></li>
<li><p>Use the <a href="#tcfSpatialDatabase">Spatial Database</a> command to specify a database to use for subsequent table inputs. This command can be used multiple times in a control file to change the target .gpkg file. For example:</p>
<p><tcmd>Spatial Database</tcmd> <teq>==</teq> <tblk>gis\2d_EXG.gpkg</tblk><br />
<tcmd>Read GIS Z Shape</tcmd> <teq>==</teq> <tblk>2d_zsh_R | 2d_zsh_L | 2d_zsh_P </tblk><br />
<tcmd>Read GIS Mat</tcmd> <teq>==</teq> <tblk>2d_mat_R</tblk><br />
<tcmd>Spatial Database</tcmd> <teq>==</teq> <tblk>gis\2d_DEV.gpkg</tblk><br />
<tcmd>Read GIS Mat</tcmd> <teq>==</teq> <tblk>2d_mat_R</tblk></p>
<p><a href="#tcfSpatialDatabase">Spatial Database</a> can be used in the .tcf, .ecf, .tbc, .tgc, .qcf, .tef. Commands are localised to their relevant control file with the exception of the .tcf which acts as a global command. If local spatial database are specified, they will take precedence over the global .tcf spatial database. The spatial database can be turned off or reverted to the .tcf database with the same command. Turning the spatial database off is a global command even when used in a control file other than the .tcf.</p>
<p><tcmd>Spatial Database <teq>==</teq> <tblk>OFF | TCF</tblk></p>
<p>Prior to TUFLOW’s implementation of GeoPackage, if a file reference did not have an extension listed in the TUFLOW command syntax it was assumed the file was a MapInfo “mif” format. That rule no longer applies. If there is an open spatial database TUFLOW will not append “.mif” to the end of the table name.</p></li>
</ol>
<h4 class="hasAnchor" id="GPKG-output-4"><span class="header-section-number">4.4.3.2</span> GPKG Output Commands<a href="#GPKG-output-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The GIS outputs from TUFLOW can be set to GPKG by using the following command:</p>
<p><tcmd><a href="#tcfGISFormat">GIS Format</a></tcmd> <teq>==</teq> <tblk>GPKG</tblk></p>
<p>Outputs can be written into separate databases or grouped:</p>
<p><tcmd><a href="#tcfSpatialDatabaseOutput">Spatial Database Output</a></tcmd> <teq>==</teq> <tblk>SEPARATE | {GROUPED}</tblk></p>
<p>Grouped databases will group by output folder location. Separate databases will still group geometries together e.g., PLOT_P, PLOT_L, PLOT_R will be written to one database.</p>
<h3 class="hasAnchor" id="GRID-3"><span class="header-section-number">4.4.4</span> Grid Commands<a href="#GRID-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Commands containing “Grid” read and/or write a GIS raster layer. The format is controlled by the file extension (e.g. .tif, .gpkg, .flt or .asc). The available formats of input raster layers are listed in Section <a href="#GISFormats-3"><strong>??</strong></a>.</p>
<p>For real (float) inputs the value is interpolated from the grid. For integer inputs (such as Code), the value applied is the integer value of the grid cell that the TUFLOW point falls within.</p>
<p>The <a href="#tgcReadGridZpts">Read Grid Zpts</a> command permits a second argument to specify a GIS layer containing one or more polygons to clip the area of Zpts to be inspected. Elevations will only be assigned to Zpts lying inside polygons within the GIS layer. See Section <a href="#DEMGrids-3"><strong>??</strong></a> for more details.</p>
<h3 class="hasAnchor" id="TIN-3"><span class="header-section-number">4.4.5</span> TIN Commands<a href="#TIN-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Commands containing “TIN” (triangulation file) read and/or write a TIN file. The format is controlled by the file extension (e.g. .tin, .xml or .12da). From the 2020-10-AB release, TUFLOW also supports super TINs in the .12da format. The same syntax is used for “TIN” layers as “GRID”.</p>
<p>TUFLOW can also be used to create a TIN (see <a href="#tgcCreateTINZpts">Create TIN Zpts</a>).</p>
<p>The <a href="#tgcReadTINZpts">Read TIN Zpts</a> command permits a second argument, specifying a GIS layer containing one or more polygons to clip the area of Zpts to be inspected. Elevations will only be assigned to Zpts lying inside polygons within the GIS layer. See Section <a href="#DEMGrids-3"><strong>??</strong></a> for more details.</p>
<h3 class="hasAnchor" id="RowCol-3"><span class="header-section-number">4.4.6</span> RowCol Commands (Legacy)<a href="#RowCol-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Commands containing “RowCol” or “MID” (e.g. <a href="#tgcReadRowColGrid">Read RowCol Zpts</a>) only read the attribute data file (i.e. .mid
or .dbf file). This is a legacy feature and is not recommended for use. The row and column numbering in the TUFLOW model will change if the model cell size, orientation or origin change, this feature is therefore not supported when using quadtree grids or the GeoPackage format.</p>
<p>For details on this legacy feature see Section 4.9.2 of the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a>.</p>
<h2 class="hasAnchor" id="LayeringData-2"><span class="header-section-number">4.5</span> Layering Data<a href="#LayeringData-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of TUFLOW’s most powerful features is the ability to layer and prioritise data layers of the same data type. This means that TUFLOW constructs the model from the data layers with no need to copy or duplicate input data for the thousands of simulations that may ensue. Data layering has considerable benefits in terms of quality control and workflow efficiencies. Section <a href="#TGC-3"><strong>??</strong></a> further details data layering.</p>
<h2 class="hasAnchor" id="XF-Files-2"><span class="header-section-number">4.6</span> XF Files<a href="#XF-Files-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>XF Files are a binary echo of selected input files automatically created by TUFLOW to vastly speed up the model initialisation process next time a simulation is carried out. If the original input data has a save date later than its corresponding XF file, the original data is read and the XF file re-created. If the XF file is newer, it is used in preference to the original data.</p>
<p>XF files are always written to a folder named “xf” underneath where the original data resides. If the “xf” folder or a XF file is deleted, the XF files will be recreated next time a simulation is started. The name of the XF file generated is that of the source file plus additional info. Two extensions are used: .xf4 and .xf8. .xf4 refers to iSP (single precision) runs and .xf8 to iDP (double precision) runs. It is not possible to mix these (i.e. to read an .xf4 single precision file into a double precision model).</p>
<p>To globally switch XF files off use <tcmd><a href="#tcfXFFiles">XF Files</a></tcmd><teq> ==</teq><tblk> OFF</tblk>. They can also be switched off for individual inputs using “XF OFF” in the command (for example, see <a href="#tgcReadGISZShape">Read GIS Z Shape</a>).</p>
<p>For the various commands that generate XF files (e.g. <a href="#tgcReadGridZpts">Read Grid Zpts</a>, it is possible to refer directly to the .xf file instead of referring to the GIS layer, for example:</p>
<p><tcmd>Read Grid Zpts</tcmd><teq> ==</teq><tblk> ..\2d_zpt_DTM.dbf.xf4.</tblk></p>
<p>If different models utilise the same DEM(s), the DEM .xf file is reprocessed each time a different model is run. This can slow the model initialisation. To prevent this, the .tcf command <a href="#tcfXFFilesIncludeinFilename">XF Files Include in Filename</a> adds unique text to the end of the .xf filenames for each model.</p>
<p>For example, if two models use the same DEMs for setting Zpt values, use this command as per below.</p>
<p>In Model 1’s .tcf file:</p>
<p><tcmd>XF Files Include in Filename</tcmd><teq> ==</teq><tblk> M1</tblk></p>
<p>In Model 2’s .tcf file:</p>
<p><tcmd>XF Files Include in Filename</tcmd><teq> ==</teq><tblk> M2</tblk></p>
<p>If the same .tcf file is being used to run both models, use the scenario
name as follows.</p>
<p><tcmd>XF Files Include in Filename</tcmd><teq> ==</teq><tblk> &lt;&lt;~s1~&gt;&gt;</tblk></p>
<p>TUFLOW will add the ~s1~ value to the end of any .xf filenames (refer to Section <a href="#Scenarios-3"><strong>??</strong></a> on the automatic setting of scenarios and events as variables). Thus, when ~s1~ changes from one simulation to the next, the .xf filenames are unique to that scenario and will not need reprocessing.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="OneD-Domains-1"><span class="header-section-number">5</span> 1D Network Domains - ESTRY<a href="#OneD-Domains-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="OneD-Introduction-2"><span class="header-section-number">5.1</span> Introduction<a href="#OneD-Introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter of the Manual discusses features specifically related to the construction of 1D domains or networks. 2D domain features are discussed separately in Chapter <a href="#TwoD-Domains-1"><strong>??</strong></a> and 1D/2D linking is discussed in Chapter <a href="#DomainLinking-1"><strong>??</strong></a>. Customising output from 1D domains is discussed in Section <a href="#Outputs-1"><strong>??</strong></a> and viewing 1D output is discussed in Chapter <a href="#Viewing-Output-1"><strong>??</strong></a>.</p>
<h2 class="hasAnchor" id="Scheme-2"><span class="header-section-number">5.2</span> Schematisation<a href="#Scheme-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>1D domains are made up of a network of channels and nodes, shown in Figure <a href="#fig:fig-Channels-Structures-Nodes">22</a>, where:</p>
<ul>
<li>Channels represent the conveyance of the flow paths. The channels are flow and velocity computation points in the 1D model. Channels could refer to 1D open channels, where the flow and velocity are calculated based on the 1D unsteady St Venant fluid flow equations (see Section <a href="#Open-Channel-2"><strong>??</strong></a>); and 1D structures (such as pipes, culverts, bridges, weirs, gates, etc.), where the flow and velocity are computed based on empirical flow equations (see Section <a href="#Structures-2"><strong>??</strong></a>).<br />
</li>
<li>Nodes represent the junctions of channels and the storage capacity of the network (see Section <a href="#Nodes-2"><strong>??</strong></a>). These are water level computation points in the 1D solution.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-Channels-Structures-Nodes"></span>
<img src="images/1d_channels_structures_nodes.png" alt="**1D Channels, Structures and Nodes**" width="60%" />
<p class="caption">
Figure 22: <strong>1D Channels, Structures and Nodes</strong>
</p>
</div>
</center>
<p>Both channels and nodes are created using one or more GIS layers (primarily using the generic 1d_nwk layer, but other speciality layers can be used such as 1d_pit for inlets and 1d_mh for manholes).
There are no constraints on the complexity of the network with any
number of channels being able to connect to a single node. Each channel
is connected to two nodes; one at the channel’s upstream end the other
at its downstream end. <strong>The digitising of nodes is <u>optional</u>.</strong>
In most models these are automatically created.</p>
<p>Multiple GIS layers can be specified. Subsequent layers
are used to modify the network at individual objects. For example, if a
culvert is to be upgraded in size, rather than making a copy of the
whole 1d_nwk layer, select the culvert channel, save the culvert as another
1d_nwk layer and modify the channel to represent the upgraded culvert.
Use <a href="#ecfReadGISNetwork">Read GIS Network</a> twice to
first read in the base 1d_nwk layer, then the 1d_nwk layer with the
single channel representing the upgraded culvert. Provided the channel
has the same ID and is snapped to the same nodes, it will override the
original culvert channel. Using this approach minimises data duplication
and, if executed logically and in a well-documented manner, is a very
effective approach to modelling.</p>
<p>The attributes required in the 1d_nwk layer depend on the channel or
node type. Table <a href="#tab:tab-LineTypes">18</a> and Table <a href="#tab:tab-PointObjectTypes">46</a> present the available channel and node types respectively. Section <a href="#OneD-nwk-2"><strong>??</strong></a> presents links to all tables of attributes within the
1d_nwk layer for all channel and node types.</p>
<p>If using more than 100,000 channels see <a href="#tcfMaximum1DChannels">Maximum 1D
Channels</a>.</p>
<h2 class="hasAnchor" id="SolutionScheme-2"><span class="header-section-number">5.3</span> Solution Scheme<a href="#SolutionScheme-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The scheme for modelling 1D open channels is based on a numerical solution of the 1D unsteady St Venant
fluid flow equations (momentum and continuity) including the inertia
terms. The 1D solution uses an explicit finite difference, second-order,
Runge-Kutta solution technique <span class="citation">(<a href="#ref-MorrisonSmith1978">Morrison &amp; Smith, 1978</a>)</span> for the 1D SWE
of continuity and momentum as given by the equations below. The
equations contain the essential terms for modelling periodic long waves
in estuaries and rivers, that is: wave propagation; advection of
momentum (inertia terms) and bed friction (Manning’s equation).</p>
<p>1D Continuity:</p>
<p><span class="math display" id="eq:equ-1DContinuity-1">\[\begin{equation}
w \frac{\partial h}{\partial t} + \frac{\partial (A u)}{\partial x} = S
\tag{10}
\end{equation}\]</span></p>
<p>1D Momentum:</p>
<p><span class="math display" id="eq:equ-1DMomentum-1">\[\begin{equation}
\frac{\partial u}{\partial t}
+ \frac{1}{A} \frac{\partial (Auu)}{\partial x}
+ g \frac{\partial (z+h)}{\partial x}
+ g \frac{n^2|u|}{R^\frac{4}{3}}u
= S_u - \frac{1}{2}k|u|u
\tag{11}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(w\)</span> is the channel width at the water surface</li>
<li><span class="math inline">\(h\)</span> is the water depth in the channel</li>
<li><span class="math inline">\(x\)</span> and <span class="math inline">\(t\)</span> are channel flow dimension and time respectively</li>
<li><span class="math inline">\(z\)</span> is the channel bed elevation</li>
<li><span class="math inline">\(A\)</span> is the cross-sectional flow area (up to the water surface)</li>
<li><span class="math inline">\(u\)</span> is the cross-sectional flow area averaged water velocity</li>
<li><span class="math inline">\(n\)</span> is the Manning coefficient for bed friction (units time per cube-root(unit length))</li>
<li><span class="math inline">\(R\)</span> is the hydraulic radius</li>
<li><span class="math inline">\(S\)</span> is the lineal water source term (volume per unit time per unit length), usually lateral inflow/outflow</li>
<li><span class="math inline">\(S_u\)</span> is the lineal momentum source term (force per unit volume per unit fluid density)</li>
<li><span class="math inline">\(k\)</span> is an energy loss coefficient, used for local energy losses</li>
</ul>
<p>Note: For 1D structures, velocities are computed based on empirical equations instead of using the 1D momentum equation (see Section <a href="#Structures-2"><strong>??</strong></a> for more details). Also note that as bed-friction and energy losses are explicitly stated, the additional momemtum source <span class="math inline">\(S_u\)</span> is typically not used.</p>
<h2 class="hasAnchor" id="OneD-nwk-2"><span class="header-section-number">5.4</span> 1d_nwk Attributes<a href="#OneD-nwk-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The 1d_nwk tables have been provided as individual tables for each type of channel and node. Links
to these tables are provided below.</p>
<p><a href="#tab:tab-AttributeDescriptions">Open Channels (S, G, Blank) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-CulvertsAttributeDescriptions">Culverts and Pipes (C, I, R) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-BridgesAttributeDescriptions">Bridges (B, BB) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-ArchBridgesAttributeDescriptions">Arch Bridges (BArch) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-WeirsAttributeDescriptions">Weirs (W, W*) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-SpecialAttributeDescriptions">Special Channels (M, P, Q, SG, SP) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-FailureAttributeDescriptions">Dam Failure and Piping Channels (DF, PF) 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-NodesAttributeDescriptions">Nodes 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-PitsModelNetwork">Pits 1d_nwk Attributes</a></p>
<p><a href="#tab:tab-OptionalAttributeDescriptions">1d_nwke (Extended 1d_nwk) Attributes</a></p>
<p>The names of 1d_nwk attributes may have changed from previous
TUFLOW releases to reflect new features and changes. The name of the
attribute is irrelevant as far as TUFLOW is concerned, as TUFLOW only
requires that attributes (of any layer) are in the correct order and of
the correct type (i.e. Character, Float, Integer, etc.). In all TUFLOW
layers, the attributes can be named as the modeller wishes, so older
layers that do not have the same attribute names as documented in this
manual will still work correctly.</p>
<h2 class="hasAnchor" id="Channel-Intro-2"><span class="header-section-number">5.5</span> Channels Overview<a href="#Channel-Intro-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>1d_nwk channels can represent open channels, hydraulic structures such
as bridges, culverts/pipes, weirs, and operational structures (e.g.
pumps and gates), and other flow controls such as a user defined flow
matrix.</p>
<p>A channel is digitised as a line. To connect channels the
ends of the channels must be snapped. Channel flow direction is positive
in the direction the line is digitised. This is best visualised
in the GIS using a line style that has arrows or other symbolism
indicating the line direction.</p>
<p>A channel is defined by a length, a Manning’s n value, a table of
hydraulic properties (wetted perimeter, flow area, hydraulic radius)
versus elevation and other parameters depending on the type of channel. Table <a href="#tab:tab-LineTypes">18</a> below lists the available channel types and Table <a href="#tab:tab-LineTypesOptionalFlags">19</a> lists the additional options that may be appended to selected channel types.</p>
<p>The hydraulic properties table for channels can be defined at a cross
section positioned midway along the channel (for some structures and
open channels) or can be derived from cross-sections located at the
channel ends (for open channels only). The exceptions are:</p>
<ul>
<li>For culverts (C and R types) the attribute information supplied within
a 1d_nwk layer (i.e. diameter, width, etc.) is sufficient to define
the hydraulic properties (i.e. no cross-section properties table is
required).<br />
</li>
<li>For weirs (W), if no cross-section or hydraulic properties table is
specified, and a Diameter_or_Width attribute value greater than 0.01
is specified, the weir is defined as being a rectangular section 10
metres high based on the invert and width values.</li>
</ul>
<p>Tables of cross-section profiles, cross-section hydraulic properties and
bridge loss coefficients are accessed using links within 1d_xs and 1d_bg
GIS layers. Tables can also be used to define nodal surface areas (refer
to Section <a href="#NA-Table-4"><strong>??</strong></a>). This allows these data to be entered in a
comma delimited format using .csv files that can be managed and edited
in spreadsheet software such as Microsoft Excel.</p>
<p>Modellers often keep the different data sets separate as numerous .csv
files are often needed. Separate folders underneath the model folder
(same level as the gis folder) are often used to store all the .csv
files and the GIS layer. For example:</p>
<ul>
<li>1d_xs for XZ cross-section profiles in a model\xs folder<br />
</li>
<li>1d_bg for bridge loss coefficient tables in a model\bg folder</li>
</ul>
<p>The <a href="#ecfReadGISTableLinks">Read GIS Table Links</a> command is used for
linking tabular data to channels. The method for linking cross-sectional
and bridge losses is as follows:</p>
<ul>
<li>Lines are linked to channels. The method depends on
whether the object has two or more vertices. The logic is:
<ul>
<li>For lines with two points (the start and end – no intermediate
vertices) the line only needs to cross a channel – it does not have
to snap to a vertex on the channel line. If the two-point line
crosses more than one channel, the channel that is closest to the
mid-point of the line is selected.<br />
</li>
<li>Lines with three or more vertices must have one of the vertices snap
to a vertice on the channel line. If both types are specified, the
snapped sections are given preference over any two-point line that
crosses the channel line.<br />
</li>
</ul></li>
<li>Other objects (regions and points) are not used.</li>
</ul>
<p>The attributes and the method for determining the data to extract from the source file is outlined in Table <a href="#tab:tab-CrossAttributeDescriptions">21</a> for 1d_xs and Table <a href="#tab:tab-LinkAttributeDescriptions">28</a> for 1d_bg. Using the Column_1 attribute, several tables can be located in the one source file if desired.</p>
<table>
<caption>
<span id="tab:tab-LineTypes">Table 18: </span><strong>1D Channel (Line) Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Channel/Node
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Open Channels
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Open Channel
</td>
<td style="text-align:left;">
<b>S</b>
</td>
<td style="text-align:left;">
<p>Open channel that incorporates all flow regimes. Supercedes Normal (Blank) and Gradient (G) channels, as S channels switch into upstream controlled, friction only mode (i.e. no inertia terms) for higher Froude numbers (see Froude Check). This allows steep flow regimes such as super-critical flow to be represented. See also Froude Depth Adjustment.</p>
<p>This is the preferred open channel type as it incorporates all flow regimes, therefore, use this channel in preference to Normal (Blank) and G channels.</p>
Upstream and downstream bed invert attributes must be specified to define the slope of the channel, or the inverts can be taken from the channel’s cross-sections by specifying -99999 for the inverts.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Structures
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bridge<br />
Section <a href="#Bridges-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b> B</b>
</td>
<td style="text-align:left;">
Bridge structure – energy loss coefficients supplied by the user.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>BB</b>
</td>
<td style="text-align:left;">
Bridge structure (introduced for Build 2016-03-AA) – only pier loss and submerged deck loss coefficients required (all other losses automatically calculated). In the future BB bridges will also recognise bridge definition inputs in a similar manner to BArch bridges to automatically generate loss coefficients.
</td>
</tr>
<tr>
<td style="text-align:left;">
Arch Bridge<br />
Section <a href="#BArch-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b>BArch</b>
</td>
<td style="text-align:left;">
Arch Bridge structure (Build 2023-03-AA and onwards). Allows users to specify a .csv defining the properties of the arch bridge.
</td>
</tr>
<tr>
<td style="text-align:left;">
Culverts<br />
Section <a href="#culverts-pipes-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b> C</b>
</td>
<td style="text-align:left;">
Pipe or Circular culvert.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>I</b>
</td>
<td style="text-align:left;">
Irregular shaped culvert.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b> R</b>
</td>
<td style="text-align:left;">
Box or Rectangular culvert.
</td>
</tr>
<tr>
<td style="text-align:left;">
Gates<br />
Section <a href="#SG-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b> SG</b>
</td>
<td style="text-align:left;">
Sluice Gate.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pump<br />
Section <a href="#Pumps-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b> P</b>
</td>
<td style="text-align:left;">
Pump.
</td>
</tr>
<tr>
<td style="text-align:left;">
Spillways<br />
Section <a href="#SP-3"><strong>??</strong></a> and <a href="#SPO-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b> SP</b>
</td>
<td style="text-align:left;">
Gated or ungated spillways.
</td>
</tr>
<tr>
<td style="text-align:left;">
Weirs<br />
Section <a href="#Weir-3"><strong>??</strong></a>
</td>
<td style="text-align:left;">
<b> W</b>
</td>
<td style="text-align:left;">
Weir structure (original weir channel).
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b> WB</b>
</td>
<td style="text-align:left;">
Broad-crested weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WC</b>
</td>
<td style="text-align:left;">
Crump weir
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WD</b>
</td>
<td style="text-align:left;">
User-defined weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WO</b>
</td>
<td style="text-align:left;">
Ogee-crested weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WR</b>
</td>
<td style="text-align:left;">
Rectangular weir (sharp-crested).
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WT</b>
</td>
<td style="text-align:left;">
Trapezoidal / Cippoletti weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WV</b>
</td>
<td style="text-align:left;">
V-notch weir
</td>
</tr>
<tr>
<td style="text-align:left;">
<file> </file>
</td>
<td style="text-align:left;">
<b>WW</b>
</td>
<td style="text-align:left;">
Similar to the original W weir channel, but with more user options.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Special Channels
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Normal
</td>
<td style="text-align:left;">
(leave blank)
</td>
<td style="text-align:left;">
<p>Normal flow channel defined by its length, bed resistance and hydraulic properties. The channel can wet and dry, however, for overbank areas (e.g. tidal flats or floodplains) gradient (G) or S channels should be used. For steep channels that may experience supercritical flow, use S channels.</p>
<b>Note: For all open channels it is recommended to use the S Type.</b>
</td>
</tr>
<tr>
<td style="text-align:left;">
Gradient
</td>
<td style="text-align:left;">
<b>G</b>
</td>
<td style="text-align:left;">
<p>Similar to a Normal channel, except when the water level at one end of the channel falls below the channel bed, the channel invokes a free-overfall algorithm that keeps water flowing without using negative depths. The algorithm takes into account both the channel’s bed resistance and upstream controlled weir flow at the downstream end.</p>
<p>Gradient channels are designed for overbank areas such as tidal flats and floodplains. The upstream and downstream bed invert attributes must be specified to define the slope of the channel.</p>
<b>Note: For all open channels it is recommended to use the S Type.</b>
</td>
</tr>
<tr>
<td style="text-align:left;">
Matrix Flow Channel
</td>
<td style="text-align:left;">
<b>M</b>
</td>
<td style="text-align:left;">
User defined flow channel using a flow matrix. The flow through the structure is dependent on the water levels upstream and downstream.
</td>
</tr>
<tr>
<td style="text-align:left;">
Depth-Discharge Channel
</td>
<td style="text-align:left;">
<b>Q</b>
</td>
<td style="text-align:left;">
User-defined stage discharge channel. The flow through the structure is only dependent on the upstream conditions, such as user defined spillways. If downstream levels are influential then an M channel (see above) may be required.
</td>
</tr>
<tr>
<td style="text-align:left;">
Connector
</td>
<td style="text-align:left;">
<b>X</b>
</td>
<td style="text-align:left;">
<p>Connects the end of one channel to another. This is particularly useful for connecting a side tributary or pipe into the main flow path. It also allows a different end cross-section or WLL to be specified for the side channel, rather than using the end cross-section on the main channel. The direction of the connector line is important.</p>
<p><b>Note: The line must start at the side channel and end at the main channel.</b></p>
If two or more connectors are used at the same location (i.e. to connect two or more side channels to a main channel) their ends must all snap to the same main channel.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Operational Channels
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Piping Failure
</td>
<td style="text-align:left;">
<b>PF</b>
</td>
<td style="text-align:left;">
Operational channel to model the “pipe failure” process (when water seepages through an embankment forming a small flow path), see Section <a href="#PFDF-3"><strong>??</strong></a>. Introduced in the 2020-10-AA build.
</td>
</tr>
<tr>
<td style="text-align:left;">
Dam Failure
</td>
<td style="text-align:left;">
<b>DF</b>
</td>
<td style="text-align:left;">
Operational channel to model a “dam failure” process (when a dam/levee breaks), see Section <a href="#PFDF-3"><strong>??</strong></a>. Introduced in the 2020-10-AA build.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-LineTypesOptionalFlags">Table 19: </span><strong>1D Channel (Line) Types - Additional/Optional Channel Flags</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Options
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flag
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Applicable Channel Types
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Adjust Structure Losses
</td>
<td style="text-align:left;">
<b>A</b>
</td>
<td style="text-align:left;">
Forces the adjust losses approach using the equations and methodology in Section <a href="#LossAdjustment-3"><strong>??</strong></a> to adjust the inlet and outlet losses of a culvert or bridge channel according to the approach and departure velocities. This flag overrides Structure Losses if set to FIX. For example, to adjust the losses for a rectangular culvert specify a Type attribute of “RA”.
</td>
<td style="text-align:left;">
Culverts (R, C, I)
</td>
</tr>
<tr>
<td style="text-align:left;">
Fix Structure Losses
</td>
<td style="text-align:left;">
<b>F</b>
</td>
<td style="text-align:left;">
<p>Forces the fix losses approach so as not to adjust the inlet and outlet losses of a culvert or bridge channel according to the approach and departure velocities. This flag overrides the Structure Losses setting if set to ADJUST (the default). See Section <a href="#LossAdjustment-3"><strong>??</strong></a>.</p>
For example, to fix the losses for a circular culvert specify a Type attribute of “CF”.
</td>
<td style="text-align:left;">
Culverts (R, C, I)
</td>
</tr>
<tr>
<td style="text-align:left;">
Downstream Controlled
</td>
<td style="text-align:left;">
<b>D</b>
</td>
<td style="text-align:left;">
For culverts, limits the flow regimes to the downstream controlled ones (see Table <a href="#tab:tab-FlowRegimes">23</a>), unless it is a zero length channel (i.e. channel length less than 0.01m).
</td>
<td style="text-align:left;">
Culverts (R, C, I)
</td>
</tr>
<tr>
<td style="text-align:left;">
Weir over the Top
</td>
<td style="text-align:left;">
<b>W</b>
</td>
<td style="text-align:left;">
If a “W” is specified in conjunction with a B, C or R channel (e.g. BW, CW or RW), a weir channel is automatically inserted to represent the flow overtopping the structure. This saves having to digitise the weir separately. To use this option requires adding the 10 optional attributes to the 1d_nwk layer as detailed in Table <a href="#tab:tab-OptionalAttributeDescriptions">34</a>. Some of these attributes are used to specify the weir parameters.
</td>
<td style="text-align:left;">
Culverts (R, C) and Bridges (B)
</td>
</tr>
<tr>
<td style="text-align:left;">
Energy
</td>
<td style="text-align:left;">
<b>E</b>
</td>
<td style="text-align:left;">
For structures specifies the use of energy level for the flow calculations. The default is to use energy (E), unless the global .ecf command <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>WATER</tblk> is used, in which case the default is to use water level (H). See H below.
</td>
<td style="text-align:left;">
All Weirs except for ‘W’ type, Spillways (SP), Gates (SG) and Dam Failure Channels (DF).
</td>
</tr>
<tr>
<td style="text-align:left;">
Energy Upstream
</td>
<td style="text-align:left;">
<b>EH</b>
</td>
<td style="text-align:left;">
Introduced in the 2023-03-AC build, uses the energy level at the upstream node and water level at the downstream node of 1D structures for flux calculation. This option can also be applied globally using the .ecf command <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>ENERGY UPSTREAM</tblk>.
</td>
<td style="text-align:left;">
All Weirs except for ‘W’ type, Spillways (SP), Gates (SG) and Dam Failure Channels (DF).
</td>
</tr>
<tr>
<td style="text-align:left;">
Water Surface
</td>
<td style="text-align:left;">
<b>H</b>
</td>
<td style="text-align:left;">
<p>For structures specifies use of water level for the flow calculations. The default is to use energy level unless <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq>WATER has been specified.</p>
For example, if a broad-crested weir is to use water surface levels rather than energy levels, specify WBH (a space can be used so “WB H” may be preferred for clarity).
</td>
<td style="text-align:left;">
All Weirs except for ‘W’ type, Spillways (SP), Gates (SG) and Dam Failure Channels (DF).
</td>
</tr>
<tr>
<td style="text-align:left;">
Non-inertial channel
</td>
<td style="text-align:left;">
<b>N</b>
</td>
<td style="text-align:left;">
Open Channel (S), Normal (blank) Gradient (G) and channels can be specified as non-inertial by including an “N” in the Type attribute. A non-inertial channel has the inertia term suppressed from the momentum equation.
</td>
<td style="text-align:left;">
Open Channel (S, G ,blank)
</td>
</tr>
<tr>
<td style="text-align:left;">
Variable Geometry
</td>
<td style="text-align:left;">
<b>V</b>
</td>
<td style="text-align:left;">
<p>Normal and gradient channel cross-sections can vary over time by using a variable channel definition. Include a “V” in the Type attribute and see Section <a href="#VW-Channel-4"><strong>??</strong></a> for more details.</p>
Note that prior to the 2013-12 release, a variable weir channel was specified as a WV channel type. As of the 2013-12 release, WV channels are processed as a V-notch weir. Variable weir channels must be specified as type “VW”.
</td>
<td style="text-align:left;">
Open Channel (S, G ,blank) and W type Weir
</td>
</tr>
<tr>
<td style="text-align:left;">
Operational Control
</td>
<td style="text-align:left;">
<b>O</b>
</td>
<td style="text-align:left;">
“O” flag is required for structures that are to be operated using an operating control definition (see Section <a href="#Special-Channels-2"><strong>??</strong></a>). For example, an operated pump would have a Type attribute of “PO” (or “OP”)
</td>
<td style="text-align:left;">
see Section <a href="#Special-Channels-2"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
Uni-directional (all channels)
</td>
<td style="text-align:left;">
<b>U</b>
</td>
<td style="text-align:left;">
Any channel can be defined as uni-directional by including a “U” in the Type attribute. Water will only flow in the positive direction of the channel (from upstream to downstream). For example a “RU” channel could be used to represent a flap gated rectangular culvert.
</td>
<td style="text-align:left;">
All channel types
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="Open-Channel-2"><span class="header-section-number">5.6</span> Open Channels<a href="#Open-Channel-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="I-channels-3"><span class="header-section-number">5.6.1</span> Inertial Channels<a href="#I-channels-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An open channel that includes the inertia term is specified as a series
of lines in one or more 1d_nwk GIS layers with an attribute
type of ‘S’, S signifying a sloping channel that can handle steep,
super-critical flows. S channels are typically all natural channels and
artificial channels such as concrete lined open drains. They
automatically test for the occurrence of upstream controlled flow and
automatically switch between the two regimes, and is the preferred type
for all open channels. Other open channel types, Normal (type “blank”)
and Gradient (type “G”) are kept for backward compatibility and
discussed in Section <a href="#Legacy-Channel-3"><strong>??</strong></a>. Table <a href="#tab:tab-AttributeDescriptions">20</a> lists the 1d_nwk attributes that are
required for open channels.</p>
<p>The hydraulic properties table for open channels is typically provided
in the form of cross-sectional data referenced within a 1d_xs GIS layer
and using the command <a href="#ecfReadGISTableLinks">Read GIS Table Links</a> but
can also specified from external sources (see Section <a href="#XS-2"><strong>??</strong></a>).</p>
<p>Lines within the 1d_xs GIS layer may be digitised midway
along the channel or snapped to the channel ends. The treatment of the
cross-sectional data is different depending on the digitisation. It is
also possible to automatically create interpolated cross-sections. The
attributes of the 1d_xs GIS layer is described in Table <a href="#tab:tab-CrossAttributeDescriptions">21</a> and further
information on cross-sections is provided in Section <a href="#XS-2"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="NI-channels-3"><span class="header-section-number">5.6.2</span> Non-Inertial Channels<a href="#NI-channels-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To bypass the Courant stability condition, a special channel flag (N) is
included, known as non-inertial channel or a friction-controlled
channel. This is valid for the S (open channel) and the superseded blank
and G gradient channels. To apply this to an S type channel the channel
type is SN.</p>
<p>For a non-inertial channel, the inertia terms are ignored
(eliminating inertial effects) and the stability control procedure is
automatically applied. Although rarely required, the suppression of the
inertia terms can be useful for stabilising very short S channels with
high velocities.</p>
<table>
<caption>
<span id="tab:tab-AttributeDescriptions">Table 20: </span><strong>Open Channels: 1D
Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas, and cannot be blank. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>As described in Table <a href="#tab:tab-LineTypes">18</a>.</p>
<b>S:</b> Steep Channel<br />
<b>G:</b> Gradient Channel<br />
<b>Blank:</b> Normal Channel
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes).
</td>
<td style="text-align:left;">
If left blank or set to Yes (“Y” or “y”) or True (“T” or “t”), the storage based on the width of the channel over half the channel length is assigned to the upstream and downstream nodes connected to the channel. If set to No (“N” or “n”) or False (“F” or “f”), the channel width and length does not contribute to the node’s storage. See Section <a href="#AutoStorageWidths-4"><strong>??</strong></a> for further discussion.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
<p>If greater than zero, sets the length of the channel in metres. If the length is less than zero, except for the special values below, the length of the line is used.</p>
Note, not used to specify the length of a pit channel (which is assumed to have zero length).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
<p>The Manning’s n or Manning’s n multiplier for the channel.</p>
<p>If not using materials or Manning’s values in the cross-section the Manning’s n value is specified using this attribute.</p>
If using materials or Manning’s n to define the bed resistance from XZ tables (see Sections <a href="#RR-M-5"><strong>??</strong></a> and Section <a href="#RR-N-5"><strong>??</strong></a>), n_nF_Cd is a multiplier and is typically set to one (1) as it becomes a multiplication factor of the materials’ Manning’s n values. It may be adjusted as part of the calibration process.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
<p><b>G, S Channel Type: </b><br />
The upstream bed or invert elevation of the channel in metres. The bed of the channel cross-section is used if -99999 is specified for G and S channels.<br />
If a manually created node exists at the upstream end of the channel, and -99999 is specified, the upstream invert is set to the DS_Invert value of the node (or pit), provided this value is greater than -99999 – for example, see Table <a href="#tab:tab-NodesAttributeDescriptions">47</a>.</p>
<b>Blank Channel Type: </b><br />
Sets the upstream and downstream inverts. Note that the invert is taken as the maximum of the US_Invert and the DS_Invert attributes. Use -99999 to use the bed of the cross-section as the invert.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
Sets the downstream invert of the channel using the same rules as described for the US_Invert attribute above.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
<p>Additional form losses (factor of dynamic head) due to bends, bridge piers, etc.</p>
This method is preferred instead of increasing Manning’s n to account for losses. For S channels, this only applies when not in upstream controlled friction mode.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
Not used unless using the legacy feature that accesses MIKE 11 cross-section data - see the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a> for details.
</td>
<td style="text-align:left;">
Char
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Not used unless using the legacy features that access FloodModeller and MIKE 11 cross-section data - see the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a> for details.
</td>
<td style="text-align:left;">
Char
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Not used unless using the legacy feature that accesses MIKE 11 cross-section data - see the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a> for details.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
Can be used to apply a form loss coefficient per unit length of channel for an S type channel. For example, a value of 0.0001 v2/g / metre or (0.1 per km) for a 200m channel, the extra form loss would be 0.0001 x 200 or 0.02 v2/2g. This can be used to account for irregularities in the bed form not accounted for by Manning’s n value (eg. submerged rock ledges and obstructions, or large boulders). If using it is recommended that this is calibrated.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="XS-2"><span class="header-section-number">5.7</span> Cross-Sections<a href="#XS-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cross-section hydraulic properties tables may come from several sources:</p>
<ul>
<li>Calculated using a cross-section profile in a .csv or similar
formatted file.<br />
</li>
<li>A hydraulic properties table in a .csv or similar formatted file.<br />
</li>
<li>External sources such as MIKE 11 processed data .txt files or Flood
Modeller .pro files - see the 2018 manual for details for this legacy feature.</li>
</ul>
<p>Cross-section profile and hydraulic properties data are accessed using a
1d_xs GIS layer and the .ecf command, <a href="#ecfReadGISTableLinks">Read GIS Table
Links</a>. Type “XZ” is specified if accessing a
cross-section profile (distance versus elevation) and a type “CS” or
“HW” is used if accessing a hydraulic properties table (elevation versus
width). Table <a href="#tab:tab-CrossAttributeDescriptions">21</a> presents the attributes required for the 1d_xs
GIS layer. A number of optional flags are available for both “XZ” and
“CS” or “HW” and are explained in more detail in Sections <a href="#XS-flags-3"><strong>??</strong></a>
and <a href="#HW-flags-3"><strong>??</strong></a>.</p>
<p>It is possible to let the water level at a cross-section to extend above
the highest elevation in the hydraulic properties table. The default is
to allow the water level to exceed ten times the depth of the CS or NA
table before an instability is triggered. See <a href="#ecfDepthLimitFactor">Depth Limit
Factor</a> for further details.</p>
<p>When the water level exceeds the top of a cross-section, the conveyance properties are calculated based on glass walling the cross-section above the top. This is carried out by taking the effective flow area and using the effective flow width to calculate the conveyance properties assuming no side wall friction applies above the cross-section top.</p>
<table>
<caption>
<span id="tab:tab-CrossAttributeDescriptions">Table 21: </span><strong>1D Cross-Section Table Link (1d_xs) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Source
</td>
<td style="text-align:left;">
Filename (and path if needed) of the file containing the tabular data. Must be a comma or space delimited text file such as a .csv file.
</td>
<td style="text-align:left;">
Char(50)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>Two characters defining the type of table link.</p>
<p><b>“XZ”</b>: Cross-section XZ profile (can include horizontal variations in resistance). The first column is the distance column, and the second the elevation column. Other optional columns are described under the Flags attribute below.</p>
<b>“CS” or “HW”</b>: Cross-section hydraulic properties table. The first two columns must be elevation and width. Optional flags are described under the Flags attribute below
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Flags
</td>
<td style="text-align:left;">
<p>Optional flags are as follows:</p>
<p><b>XZ Tables:</b></p>
<p><b>“R”, “M” or “N”:</b> The relative resistance (Column 3) is used to vary the bed resistance value (Manning’s n) across the section. Specify an <b>“R”</b> flag for relative resistance factor, an <b>“M”</b> flag to use a material number or an <b>“N”</b> flag for a Manning’s n value.<br />
<b>“P”:</b> The position values (Column 4) are used to indicate whether an XZ point is left bank (1), mainstream (2) or right bank (3). P values must be entered as 1, 2 or 3. See Section <a href="#RR-P-5"><strong>??</strong></a>.<br />
<b>“A”:</b> The addition values (Column 5) are used to raise or lower the Z value – this is useful, for example, for modelling siltation or erosion of a cross-section, raising, or adding blocked rails to, a weir cross-section of an embankment, etc.<br />
<b>“E” or “T”:</b> Specify an “E” to use effective area or a “T” to use total area when calculating the flow area (see Section <a href="#HW-F-4"><strong>??</strong></a> and <a href="#ecfFlowArea">Flow Area</a>). If neither is specified, the global value set using <a href="#ecfFlowArea">Flow Area</a> is used.</p>
<b>CS or HW Tables: </b>
<b>“A”:</b> Flow area (Column 3)<br />
<b>“P”:</b> Wetted perimeter (Column 4)<br />
<b>“F” or “N”:</b> Vertical change in resistance (Column 5). Use “F” for a multiplication factor and “N” for a Manning’s n value.<br />
<b>“E”: </b> Effective flow width (Column 6)
</td>
<td style="text-align:left;">
Char(8)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Column_1
</td>
<td style="text-align:left;">
Optional. Identifies a label in the Source file that is the header for the first column of data. Values are read from the first number encountered below the label until a non-number value, blank line or end of the file is encountered.<br />
If this field is left blank, the first column of data in the Source file is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Column_2
</td>
<td style="text-align:left;">
<p>Optional. Identifies a label in the Source file that is in the header for the second column of data.</p>
If this field is left blank, the next column of data after Column_1 is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Column_3
</td>
<td style="text-align:left;">
Optional. Identifies a label in the Source file that is in the header for the third column of data.<br />
If this field is left blank, the second column of data after Column_1 is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Column_4
</td>
<td style="text-align:left;">
Optional. Defines the fourth column of data.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Column_5
</td>
<td style="text-align:left;">
Optional. Defines the fifth column of data.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Column_6
</td>
<td style="text-align:left;">
Optional. Defines the sixth column of data.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Z_Increment
</td>
<td style="text-align:left;">
Optional. Sets the height increment in metres to be used for calculating hydraulic properties from a XZ cross-section profile. If less than 0.01, the increment is determined automatically. Only used for XZ cross-section data.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Z_Maximum
</td>
<td style="text-align:left;">
Optional. Sets the maximum elevation in metres to be used for calculating hydraulic properties from a XZ cross-section profile. If less than the lowest point in the cross-section profile, Z_Maximum is taken as the highest elevation in the profile. Only used for XZ cross-section data.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Skew<br />
(in degrees)
</td>
<td style="text-align:left;">
Optional. Adjusts the cross-section properties for XZ and CS/HW data according to the skew angle. Useful where the cross-section line is surveyed oblique to the flow direction. The skew angle is zero degrees in the direction of flow and 90 degrees if surveyed at a right angle to the direction of flow. For example, a value of 45 adjusts the horizontal dimensions by dividing by the √2.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="XS-flags-3"><span class="header-section-number">5.7.1</span> Type “XZ” Optional Flags<a href="#XS-flags-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="RR-4"><span class="header-section-number">5.7.1.1</span> Relative Resistance<a href="#RR-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Varying the resistance across an XZ (offset-elevation) cross-section is
possible by using either a relative resistance factor (R flag),
different material ID values (M flag) or different Manning’s n values (N
flag). These are discussed further in the sections below.</p>
<p>The relative resistance value applies midway to either side of the
X-value (except the first and last X-values where it only applies to
midway to the single neighbouring X-value). The reason for this is that
material or n values can be correctly sampled from a GIS layer at the
survey points. This is slightly different from some other 1D hydraulic
modelling software that apply relative resistance values from the
previous X-value to the current X-value or from the current to the next.</p>
<p>Sections of a cross-section can be “removed” by entering ‑1 (negative
one) for a resistance value. This feature is particularly useful when
developing a linked 1D/2D model where the 1D cross-sections are
typically trimmed to the top of bank to avoid double counting of
floodplain conveyance and storage. For more information on how negative “M”, “N” and “R” differ, please refer to the <a href="https://wiki.tuflow.com/TUFLOW_1D_Channels_and_Hydraulic_Structures#How_do_negative_.22M.22.2C_.22N.22_and_.22R.22_values_deactivate_1D_cross-sections.3F">TUFLOW Wiki</a>.</p>
<h5 class="hasAnchor" id="RR-R-5"><span class="header-section-number">5.7.1.1.1</span> Relative Resistance Factor (R)<a href="#RR-R-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The relative resistance factor (R) is a multiplication factor applied to
the primary Manning’s n value of the channel. Wherever the R value
changes across the cross-section, a new parallel sub-channel is created.
The total conveyance for the whole cross-section is determined by
carrying out a parallel channel analysis of all the sub-channels. This
approach allows the variation in bed resistance across a cross-section
to be accounted for, and to force a parallel channel analyses so that
conveyance does not decrease with height when the wetted perimeter
suddenly increases (e.g. when overbank areas just become wet).</p>
<p>If using effective area (see Section <a href="#Eff-vs-Total-3"><strong>??</strong></a>), an R of 1.0 must
occur at some point in the profile to indicate the primary sub-channel.
If a value of 1.0 is not found an <a href="https://wiki.tuflow.com/TUFLOW_Message_1070">ERROR 1070</a> occurs, as grossly
incorrect channel velocities can occur when using effective area with an inappropriate primary sub-channel. The
Manning’s n value of the primary sub-channel is that specified in the
1d_nwk layer for the channel. The primary sub-channel does not have to
be the lowest part of the cross-section.</p>
<h5 class="hasAnchor" id="RR-M-5"><span class="header-section-number">5.7.1.1.2</span> Material Values (M)<a href="#RR-M-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If using material values (M), the Manning’s n value to be applied is
taken from a Materials Definition File (see <a href="#tcfReadMaterialsFile">Read Materials
File</a>). If the Position “P” flag is not used, the
material at the lowest Z value (cross-section bed) is used as the
primary material, which then corresponds to a relative resistance factor
of 1.0. If no material values are specified, a material value of one (1)
is applied over the whole cross-section. If the P flag and values are
used, the primary material is determined as that at the lowest Z value
in the mainstream channel (see Section <a href="#RR-N-5"><strong>??</strong></a>).</p>
<p><strong>When using materials, the n_nF_Cd value in the 1d_nwk layer becomes a
multiplier and should be set to one (1.0).</strong> If justified, it can be
adjusted for calibration or sensitivity testing. For example, if a slightly higher
resistance is desired along a channel, rather than setting different
material values, change the n_nF_Cd value in the 1d_nwk layer to, say,
1.1 to increase all Manning’s n values across the cross-section by 10%.</p>
<p>A negative material value in the M column of a XZM cross-section table
can now be specified to disable (i.e. block out or remove) sections of a
cross-section. The negative value must be the negative of a valid
Material ID in the Materials Definition File (see <a href="#tcfReadMaterialsFile">Read Materials
File</a> and Section <a href="#Materials-2"><strong>??</strong></a>). For more information on how negative “M”, “N” and “R” differ, please refer to the <a href="https://wiki.tuflow.com/TUFLOW_1D_Channels_and_Hydraulic_Structures#How_do_negative_.22M.22.2C_.22N.22_and_.22R.22_values_deactivate_1D_cross-sections.3F">TUFLOW Wiki</a>.</p>
<p><strong>Example</strong></p>
<p>In the following example, the TUFLOW Tutorial Model (discussed in Section <a href="#TutorialModels-3"><strong>??</strong></a>) will be modified to demonstrate how Manning’s n values may be assigned to cross-sections based on values within the Materials Definition File.</p>
<p>An “M” flag is added to the 1d_xs layer referencing the cross-sectional data of the open channel.</p>
<p><img src="images/image45.png" width="20%" style="display: block; margin: auto;" /></p>
<p>An additional third column is then added to the .csv source file, containing one or more Material ID values from within the Materials Definition File. In the figure below, a Material ID of 10 has been assigned to the whole cross-section.</p>
<p><img src="images/image46.png" width="20%" style="display: block; margin: auto;" /></p>
<p>This correlates to a Manning’s n value of 0.08 as shown in the Materials Definition File.</p>
<p><img src="images/image47.png" width="60%" style="display: block; margin: auto;" /></p>
<p>When using the “M” flag to define material values, the “n_nF_Cd”
attribute in the 1d_nwk becomes a multiplier (refer to Table <a href="#tab:tab-AttributeDescriptions">20</a>). In most cases,
this should be set to 1, as has been carried out for this example.</p>
<p>Once the model has been compiled, a check of the Manning’s n values
applied to each cross-section may be viewed in the <a href="https://wiki.tuflow.com/Check_Files_1d_ta_tables">_ta_tables_check.csv</a>.</p>
<p><img src="images/image48.png" width="60%" style="display: block; margin: auto;" /></p>
<h5 class="hasAnchor" id="RR-N-5"><span class="header-section-number">5.7.1.1.3</span> Manning’s n Values (N)<a href="#RR-N-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>If using Manning’s n values (N), the n value is specified directly,
noting that the n_or_n_Cd value in the 1d_nwk layer becomes a multiplier
and should be set to one (1.0). See discussion above for using material
values. A value of ‑1 ignores that section of the profile. For information on how negative “M”, “N” and “R” differ, please refer to the <a href="https://wiki.tuflow.com/TUFLOW_1D_Channels_and_Hydraulic_Structures#How_do_negative_.22M.22.2C_.22N.22_and_.22R.22_values_deactivate_1D_cross-sections.3F">TUFLOW Wiki</a>.</p>
<h5 class="hasAnchor" id="RR-P-5"><span class="header-section-number">5.7.1.1.4</span> Position Flag (P)<a href="#RR-P-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The position values are used to indicate whether an XZ point is left
bank (1), mainstream (2) or right bank (3). The P value is used to
indicate where the mainstream sub-channel is located. If the materials (M
flag) is used, the primary material is taken as that at the lowest Z
value in the mainstream sub-channel. If the P flag and values are not
specified, the primary material is that at the lowest Z value across the
whole section.</p>
<!-- 
It is intended that the P values be used for other processing and
post-processing of results in future releases.
-->
<h3 class="hasAnchor" id="HW-flags-3"><span class="header-section-number">5.7.2</span> Type “HW” Optional Flags<a href="#HW-flags-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="HW-A-4"><span class="header-section-number">5.7.2.1</span> Flow Area (A)<a href="#HW-A-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The effective flow area in m<sup>2</sup> or ft<sup>2</sup> (depending on
the model’s units). If omitted, the area is calculated based on the
elevations and widths starting at an area of zero at the lowest
elevation.</p>
<h4 class="hasAnchor" id="HW-P-4"><span class="header-section-number">5.7.2.2</span> Wetted Perimeter (P)<a href="#HW-P-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The wetted perimeter in metres or feet (depending on the model’s units).
If omitted, the area is calculated based on the elevations and widths
assuming a symmetrical channel.</p>
<h4 class="hasAnchor" id="HW-N-4"><span class="header-section-number">5.7.2.3</span> Manning’s n Values (N)<a href="#HW-N-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If using Manning’s n values (N), the n value is specified directly,
noting that the n_or_n_Cd value in the 1d_nwk layer becomes a multiplier
and should be set to one (1.0). See discussion above for using material
values. A value less than zero is set to 0.001.</p>
<h4 class="hasAnchor" id="HW-F-4"><span class="header-section-number">5.7.2.4</span> Manning’s n Values (F)<a href="#HW-F-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If using Manning’s n value mulipliers (F), the n value specified in the
“n_or_n_Cd” value in the 1d_nwk layer is multiplied by the
specified factor. A value less than zero is set to 0.001.</p>
<h3 class="hasAnchor" id="Parallel-Channel-3"><span class="header-section-number">5.7.3</span> Parallel Channel Analysis<a href="#Parallel-Channel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To calculate total conveyance, a cross-section needs to be sub-divided
into panels for which the velocity is uniformly distributed. Conveyance
for each panel is calculated using the Manning’s equation:</p>
<p><span class="math display" id="eq:equ-mannings">\[\begin{equation}
K = \ \frac{1.0}{n}\ AR^{\frac{2}{3}}
\tag{12}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(K\)</span> = conveyance of panel<br />
</li>
<li><span class="math inline">\(n\)</span> = Manning’s n roughness coefficient<br />
</li>
<li><span class="math inline">\(A\)</span> = Flow Area (m<sup>2</sup>)<br />
</li>
<li><span class="math inline">\(R\)</span> = Hydraulic Radius (m) – area / wetted perimeter</li>
</ul>
<p>The conveyance of a cross-section may reduce with height where there is
a sudden increase in the wetted perimeter compared with a relatively
small increase in flow area, causing the hydraulic radius to reduce
despite the water level increasing. A WARNING is issued if this occurs
and it is strongly recommended that the cross-section be reviewed and
corrected.</p>
<p>The most common cause for the reduction in conveyance with height occurs
when the extent of inundation across the cross-section increases
markedly during the transition from in-bank to out-of-bank flow. The
reducing conveyance with height problem is usually resolved by forcing a
parallel channel analysis by specifying a change in resistance using the
R, M or N flag discussed in the sections above.</p>
<p><tcmd><a href="#ecfConveyanceCalculation">Conveyance Calculation</a></tcmd><teq> ==</teq><tblk> ALL PARALLEL</tblk> is
the default setting. This forces a parallel channel analysis based on
splitting the cross-section into parallel channels at every distance
X-value. This approach generally ensures that conveyance does not reduce
with height. Using this approach to calculate the hydraulic properties
tends to produce a slightly more efficient cross-section (higher
conveyance), similar to the resistance radius formulation used by some
schemes. Therefore, a slightly higher Manning’s n value (by ~10%) may be
needed to achieve similar results.</p>
<p>Figure <a href="#fig:fig-image49">23</a> illustrates the ALL PARALLEL method of conveyance calculation.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image49"></span>
<img src="images/image49.png" alt="**‘All Parallel’ Conveyance Calculation Method**" width="80%" />
<p class="caption">
Figure 23: <strong>‘All Parallel’ Conveyance Calculation Method</strong>
</p>
</div>
</center>
<p><tcmd><a href="#ecfConveyanceCalculation">Conveyance Calculation</a> </tcmd><teq>==</teq><tblk> CHANGE IN
RESISTANCE</tblk> may be used as an alternative to the default <tblk>ALL PARALLEL</tblk>
approach. In this case, the parallel channel analysis splits the
cross-section into separate parallel channels based on wherever there is
a change in resistance (due to different relative resistance (R flag),
material type (M flag) or Manning’s n values (N flag)). This is
illustrated in Figure <a href="#fig:fig-image50">24</a>:</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image50"></span>
<img src="images/image50.png" alt="**‘Change in Resistance’ Conveyance Calculation Method**" width="80%" />
<p class="caption">
Figure 24: <strong>‘Change in Resistance’ Conveyance Calculation Method</strong>
</p>
</div>
</center>
<p>It should be noted that differences in results are expected between the
two methods of conveyance calculation. The total number of panels for
each calculation method will be different as demonstrated,
thereby influencing the total conveyance.</p>
<p>The ALL PARALLEL approach has been chosen as the current default
conveyance calculation method for ESTRY. This is not to imply that this
method produces the more accurate result, rather it has been chosen as
it generally does not cause conveyance reducing with height warnings.</p>
<h3 class="hasAnchor" id="Eff-vs-Total-3"><span class="header-section-number">5.7.4</span> Effective Area versus Total Area<a href="#Eff-vs-Total-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For XZ (offset elevation) Cross-Sections, the flow area is calculated as
an effective area (E flag) or a total area (T flag). Use of the flag
will override the global setting set by <a href="#ecfFlowArea">Flow Area</a> where
the default approach is to use the effective area.</p>
<p>If there is no variation in relative resistance across the cross-section
there is no difference between effective and total areas. This is
dependent on the relative resistance being 1.0 across the whole section.
<a href="https://wiki.tuflow.com/TUFLOW_Message_1070">ERROR 1070</a> is produced if the relative resistance is not 1.0
somewhere along the cross-section when using effective area.</p>
<p>For an open channel, the total conveyance of a cross-section is not
affected by whether effective or total area is used. In the case of
effective area the wetted perimeter is adjusted to compensate for the
change in flow area so as to produce the same conveyance as would occur
for total area. For special channels that use cross-sections such as
bridges, weirs and irregular culverts, the flow area used is the
effective or total area as specified. This can be useful if the effects
of blockage or congestion within the section needs to be modelled.</p>
<p>The primary differences between using effective and total area are:</p>
<ul>
<li>The channel velocity calculated is the depth and width average of the
primary (normally mainstream) parallel sub-channel if using effective
area, and the averaged depth and width of the whole cross-section if
using total area.<br />
</li>
<li>Where the effective and total areas are significantly different, the
channel velocities used in the 1D momentum equation will be
significantly different. If the channel velocity is sufficiently high
and different depending on whether effective or total area is used,
the inertia terms in the 1D momentum equation may affect the results.
Note the frictional (bed resistance) term in the momentum equation is
NOT affected as the hydraulic properties for the cross-section are
adjusted so that the total conveyance is the same irrespective of
whether effective or total area is used.</li>
<li>Effective area gives a more reliable calculation of the mainstream
velocity, and therefore, a more accurate estimate of approach and exit
velocities of structures, and more appropriate velocities for
advection-dispersion and sediment transport calculations. Where
velocities are not high or significantly changed when using effective or
total area, the water level and flow results are usually identical or
very similar.</li>
</ul>
<h3 class="hasAnchor" id="XS-Mid-3"><span class="header-section-number">5.7.5</span> Mid Cross-Sections<a href="#XS-Mid-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cross-sections may be specified using lines digitised within a 1d_xs
layer partway along the channel. The upstream and downstream invert
levels of the channel are both assigned the invert level of the
cross-section if a value of -99999 has been specified within the 1d_nwk
channel (refer to Table <a href="#tab:tab-AttributeDescriptions">20</a>). If either of these attributes is greater than
‑99999, the invert of the channel is set to the GIS attribute value
rather than that of the cross-section bed elevation.</p>
<p>The mid cross-section approach is the only approach available for
structures such as bridges, weirs and irregular shaped culverts. It can
also be used for open channels, however the digitisation of
cross-section lines within a 1d_xs layer that have been snapped to the
channel ends (as described in Section <a href="#XS-End-3"><strong>??</strong></a> below) has added
advantages and is recommended.</p>
<p>If using a mid cross-section 1d_xs line with more than two vertices, a intermediate vertex must be snapped to the 1d_nwk channel.</p>
<h3 class="hasAnchor" id="XS-End-3"><span class="header-section-number">5.7.6</span> End Cross-Sections<a href="#XS-End-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cross-sections for open channels (S channels and the superseded G
channels) can be specified using lines digitised within a 1d_xs layer at
the channel ends, rather than a single cross-section midway along the
channel as described above. This approach has the following benefits:</p>
<ul>
<li>The upstream and downstream inverts can be based on the beds of the
cross-sections, thereby saving some effort to enter this information
within the 1d_nwk file. To do this, set the US_Invert and DS_Invert
attributes in the 1d_nwk layer to ‑99999. If either of these
attributes is greater than ‑99999, the invert is set to the attribute
value rather than that of the cross-section bed.<br />
</li>
<li>Cross-section surveys from some other 1D models often have the
cross-sections at the channel ends, therefore, this makes it easier to
use these external data sources.</li>
</ul>
<p>There are a few rules on how end cross-sections are interpreted and
applied, as follows:</p>
<ul>
<li>The 1d_xs cross-section lines must have a vertex snapped to the
channel end.<br />
</li>
<li>If a 1d_xs cross-section line occurs elsewhere along an open channel
with end cross-sections, the midway cross-section prevails. This is
particularly useful where two channels’ ends are snapped to an end
cross-section, but the end cross-section is to be applied to only one
of the channels (e.g. one channel is a river channel using end
cross-sections, and the other is an overbank channel). For the
overbank channel, specify a cross-section line somewhere along the
channel, and preference will be given to this cross-section rather
than the end cross-section. Alternatively, an X connector can be used
if end cross-sections are required for both channels. See Section
<a href="#XConnect-3"><strong>??</strong></a>.<br />
</li>
<li>End cross-sections cannot be used to override previously defined
cross-section properties for a G or S channel. You can override the
end cross-sections using a midway cross-section.<br />
</li>
<li>For channels other than S and G channels, end cross-sections are
ignored.</li>
</ul>
<h3 class="hasAnchor" id="Interpolate-XS-3"><span class="header-section-number">5.7.7</span> Interpolated Cross-Section Protocols<a href="#Interpolate-XS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cross-sections may be interpolated for channels (excluding C and R
culvert channels) that have not been assigned a cross-section. A series
of channels may now be digitised between two cross-sections, and the
cross-section properties at each channel are linearly interpolated
between the two cross-sections. The protocols applied when interpolating
cross-sections and setting Manning’s n values are:</p>
<ul>
<li>If a channel has a cross-section at each end, the processed data of
these cross-sections is averaged.<br />
</li>
<li>If a channel has a cross-section midway, this cross-section takes
priority over any end cross-sections.<br />
</li>
<li>If a channel only has one end cross-section, TUFLOW traverses
upstream/downstream to find the next available cross-section, and uses
this to interpolate the cross-section properties for that channel. The
next available cross-section can be a midway or end cross-section.<br />
</li>
<li>If a channel has no cross-sections attached to it, TUFLOW traverses
upstream and downstream to find the nearest cross-sections and
interpolates the channel properties based on these cross-sections.<br />
</li>
<li>When traversing upstream/downstream to find a cross-section:
<ul>
<li>If a junction (three or more channels snapped together) is reached
(excluding pits and connectors), an ERROR is issued as it is not
possible to determine which branch to follow. Note, channels
connected to a junction using a connector (Type “X”) are not used
for traversing, therefore use connectors to connect side channels to
the main branch to avoid interpolating sections from side channels<br />
</li>
<li>The digitised direction of the channel is important and controls the
direction used to traverse upstream and downstream. Ensure the
channels are digitised in a consistent direction (usually from
upstream to downstream).<br />
</li>
</ul></li>
<li>If a channel has an end cross-section only at one end, and no
cross-section is found when traversing, this end cross-section is used
at both ends for that channel only.<br />
</li>
<li>The inverts are also interpolated using the cross-section beds (unless
the inverts have been manually entered into the 1d_nwk attributes).
Specify -99999 for the 1d_nwk channel inverts to be interpolated from the cross-sections.<br />
</li>
<li>Cross-sections that are interpolated can be of any format, including CS or HW
1d_xs formats (see Table <a href="#tab:tab-CrossAttributeDescriptions">21</a>).<br />
</li>
<li>The Manning’s n value assigned to the channel’s cross-section is as
follows:
<ul>
<li>If the cross-sections used for interpolation have no Manning’s n
values (i.e. for XZ cross-sections, M or N was not specified, or for
CS/HW cross-sections, N was not specified), the 1d_nwk Manning’s n
attribute of the channel is used.<br />
</li>
<li>If the cross-sections used for interpolation have Manning’s n
values, the value is interpolated from the cross-section n values
(at the bed) and multiplied by the 1d_nwk Manning’s n attribute of
the channel. In this case the 1d_nwk n_or_n_F attribute is a
multiplier that can be used to calibrate the model.<br />
</li>
<li>If one of the two cross-sections used for interpolation has a
Manning’s n value, and the other does not, the n value used is
interpolated using the channel’s 1d_nwk Manning’s n value and the
cross-section’s n value. Ideally, the model should be set up using
the same approach everywhere so that this situation does not arise
as it may cause undesirable results. A WARNING is issued if this
occurs.</li>
</ul></li>
</ul>
<p>The interpolation of cross-sections is the default. <a href="#ecfInterpolateCrossSections">Interpolate
Cross-Sections</a> can also be used to switch
this feature ON or OFF.</p>
<h2 class="hasAnchor" id="Structures-2"><span class="header-section-number">5.8</span> Structures<a href="#Structures-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Hydraulic structures in the 1D domain are modelled by replacing the
momentum equation with standard equations describing the flow through
the structure. The structures available are described in the following
sections. A discussion on the choice of a 1D or 2D representation of the
structure is presented in Section <a href="#srf-3"><strong>??</strong></a>.</p>
<p>A channel is flagged as a hydraulic structure using the Type attribute
as described in Table <a href="#tab:tab-LineTypes">18</a>. Except for culverts, a structure has zero length, i.e.
there is no bed resistance. If a non-zero length is applied to a “zero length” structure, this is only used in the calculation of the storage (nodal area).</p>
<h3 class="hasAnchor" id="culverts-pipes-3"><span class="header-section-number">5.8.1</span> Culverts and Pipes<a href="#culverts-pipes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Culvert or pipe channels can be either rectangular, circular (pipe) or
irregular in shape. A range of different flow regimes is simulated with
flow in either direction. Adverse slopes are accounted for and flow may
be subcritical or supercritical. Figure <a href="#fig:fig-image19">25</a>, Figure <a href="#fig:fig-image20">26</a> and Table <a href="#tab:tab-FlowRegimes">23</a> present the different flow regimes which can be modelled. The regimes that occur during a simulation are output to the .eof file next to the velocity and flow output values, and to the _TSF GIS layer (see Sections <a href="#EOF-2"><strong>??</strong></a> and <a href="#TS-GIS-3"><strong>??</strong></a>), and can be displayed on time-series plots in the QGIS TUFLOW Viewer plugin.</p>
<p>For all culvert types the length, upstream and downstream inverts,
Manning’s n, bend loss, entrance and exit losses, and number of barrels
are entered using the 1d_nwk attributes (see Table <a href="#tab:tab-CulvertsAttributeDescriptions">22</a>). For type
“C” circular or type “R” rectangular culverts, the dimensions are also
specified within the 1d_nwk attributes. For an “I” irregular shaped
culvert, the cross-sectional shape is specified in the same manner as
for open channels using a 1d_xs GIS layer (refer to Section <a href="#XS-2"><strong>??</strong></a>
and Table <a href="#tab:tab-CrossAttributeDescriptions">21</a>) and the command <a href="#ecfReadGISTableLinks">Read GIS Table
Links</a>. The line is digitised across
the 1d_nwk channel line.</p>
<p>The four culvert coefficients are as follows:</p>
<ul>
<li>The height contraction coefficient for box culverts. Usually 0.6 for
square edged entrances to 0.8 for rounded edges. This factor is not
used for circular culverts.<br />
</li>
<li>The width contraction coefficient for box culverts. Typically values
from 0.9 for sharp edges to 1.0 for rounded edges. This factor is
normally set to 1.0 for circular culverts.<br />
</li>
<li>The entry loss coefficient. The standard value for this coefficient is
0.5. Variations to this value may be applied based on manufacturer
specifications.<br />
</li>
<li>The exit loss coefficient, normally recommended as 1.0.</li>
</ul>
<p>The calculations of culvert flow and losses are carried out using
techniques from “Hydraulic Charts for the Selection of Highway Culverts”
and “Capacity Charts for the Hydraulic Design of Highway Culverts”,
together with additional information provided in <span class="citation">Henderson (<a href="#ref-Henderson1966">1966</a>)</span>. The
calculations have been compared and shown to be consistent with
manufacturer’s data provided by both “Rocla” and “Armco”.</p>
<p><strong>Note: By default, the entrance and exit losses above are adjusted every timestep according to
the approach and departure velocities based on the equations in Section <a href="#LossAdjustment-3"><strong>??</strong></a>.</strong></p>
<p>For benchmarking of culvert flow to the literature, see “<a href="https://www.tuflow.com/media/4989/2004-tuflow-testing-and-validation-huxley.pdf">TUFLOW
Validation and
Testing</a>”
<span class="citation">(<a href="#ref-Huxley2004">Huxley, 2004</a>)</span>.</p>
<table>
<caption>
<span id="tab:tab-CulvertsAttributeDescriptions">Table 22: </span><strong>Culverts and Pipes: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas, and cannot be blank. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.<br />
When automatically creating nodes (default) “.1” and “.2” are added to the channel names for the upstream and downstream node names respectively. IDs over 10 characters long are not recommended as the appending of .1 and .2 can cause duplicate node ID’s to be created.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>The culvert type:</p>
<ul>
<li>“C” for a circular culvert;<br />
</li>
<li>“R” for a rectangular culvert;<br />
</li>
<li>“I” for an irregular shaped culvert</li>
</ul>
Optional type flags may also be used to implement additional flow controls such as unidirectional flow (“U”) or operated flow conditions (“O”). Culvert type details are outlined in Table <a href="#tab:tab-LineTypes">18</a> and optional flags in Table <a href="#tab:tab-LineTypesOptionalFlags">19</a> .
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes)
</td>
<td style="text-align:left;">
If left blank or set to Yes (“Y” or “y”) or True (“T” or “t”), the storage based on the width of the channel over half the channel length is assigned to both of the two nodes connected to the channel. If set to No (“N” or “n”) or False (“F” or “f”), the channel width does not contribute to the node’s storage. See Section <a href="#Nodes-2"><strong>??</strong></a> for further discussion.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
The length of the culvert in metres. If the length is less than zero, except for the special values below, the length of the line is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
<p>The Manning’s n value of the culvert.</p>
If using materials to define the bed resistance from XZ tables (only for Irregular culvert, see Section <a href="#RR-M-5"><strong>??</strong></a>), n_nF_Cd should be set to one (1) as it becomes a multiplication factor of the materials’ Manning’s n values. It may be adjusted as part of the calibration process.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
<p>The upstream bed or invert elevation of the culvert in metres.</p>
If a culvert invert has a value of 99999 (after any application of node/pit DS_Invert values), the invert is interpolated by searching upstream and downstream for the nearest specified inverts, and the invert is linearly interpolated. <a href="#ecfInterpolateCulvertInverts">Interpolate Culvert Inverts</a> can also be used to switch this feature ON or OFF.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
Sets the downstream invert of the culvert using the same rules as for described for the US_Invert attribute above.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
Specifies an additional dynamic head loss coefficient that is applied when the culvert flow is not critical at the inlet. Note, this loss coefficient is not subject to adjustment when using <tcmd><a href="#ecfStructureLosses">Structure Losses</a> </tcmd><teq>==</teq><tblk> ADJUST</tblk>, and is ideally used to model additional energy losses such as bend losses.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
<p><b>C, R Channel Type: </b><br />
The percentage blockage (for 10%, enter 10) of the culvert. For R culverts, the culvert width is reduced by the % Blockage, while for C culverts the pipe diameter is reduced by the square root of the % Blockage. Note that when applying a % Blockage to C culverts, the invert level remains unchanged and only the soffit level is reduced by the calculated decrease in diameter.</p>
<b>I Channel Type: </b><br />
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
<p><b>C Channel Type: </b><br />
The pipe diameter in metres.</p>
<p><b>R Channel Type:</b><br />
The box culvert width in metres.</p>
<b>I Channel Type: </b><br />
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
<p><b>R Channel Type: </b><br />
The box culvert height in metres.</p>
<b>C, I, Channel Type: </b><br />
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
The number of culvert barrels. If set to zero, one barrel is assumed.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
<p><b>I, R Channel Type: </b><br />
The height contraction coefficient for orifice flow at the inlet. Usually 0.6 for square edged entrances to 0.8 for rounded edges. If value exceeds 1.0 or is less than or equal to zero, it is set to 1.0.<br />
Not used for unsubmerged inlet flow conditions or outlet controlled flow regimes.</p>
<b>C Channel Type: </b><br />
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
<p>The width contraction coefficient for inlet-controlled flow. Usually 0.9 for sharp edges to 1.0 for rounded edges for R culverts. Normally set to 1.0 for C culverts. If value exceeds 1.0 or is less than or equal to zero, it is set to 1.0 for C and 0.9 for R culverts.</p>
Not used for outlet controlled flow regimes.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
The entry loss coefficient for outlet controlled flow (recommended value of 0.5). If value exceeds 1.0, it is set to 1.0. If value is less than zero (0), it is set to zero (0). If <tcmd><a href="#ecfStructureLosses">Structure Losses</a> </tcmd><teq>==</teq><tblk> ADJUST</tblk> (the default) or the A flag is used (see Table <a href="#tab:tab-PointObjectTypes">46</a>), this value is adjusted according to the approach flow velocity (see Section <a href="#LossAdjustment-3"><strong>??</strong></a>). If the culvert is discharging out of a manhole, this attribute is ignored and the entry loss used is that determined by the manhole energy losses formulation (see Section <a href="#Manholes-3"><strong>??</strong></a>). The entry loss value used in the computation can be viewed over time using the _TSL output layer (see Section <a href="#TS-GIS-3"><strong>??</strong></a>) or the QGIS TUFLOW Viewer plugin.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
The exit loss coefficient for outlet controlled flow (recommended value of 1.0). If value exceeds 1.0, it is set to 1.0. If value is less than zero (0), it is set to zero (0). If <tcmd><a href="#ecfStructureLosses">Structure Losses</a> </tcmd><teq>==</teq><tblk> ADJUST</tblk> (the default) or the A flag is used (see Table <a href="#tab:tab-PointObjectTypes">46</a>), this value is adjusted according to the departure velocity (see Section <a href="#LossAdjustment-3"><strong>??</strong></a>). If the culvert is discharging out of a manhole, this attribute is ignored and the entry loss used is that determined by the manhole energy losses formulation (see Section <a href="#Manholes-3"><strong>??</strong></a>). The entry loss value used in the computation can be viewed over time using the _TSL output layer (see Section <a href="#TS-GIS-3"><strong>??</strong></a>) or the QGIS TUFLOW Viewer plugin.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-FlowRegimes">Table 23: </span><strong>1D Culvert Flow Regime Flags</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Regime
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Unsubmerged entrance and exit. Critical flow at entrance. Upstream controlled with the flow control at the inlet.
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
Submerged entrance and unsubmerged exit. Orifice flow at entrance. Upstream controlled with the flow control at the inlet. For circular culverts, not available for <tcmd><a href="#ecfCulvertFlow">Culvert Flow</a> </tcmd><teq>==</teq><tblk> Method A</tblk>.
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
Unsubmerged entrance and exit. Critical flow at exit. Upstream controlled with the flow control at the culvert outlet.
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
Unsubmerged entrance and exit. Sub-critical flow at exit. Downstream controlled.
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:left;">
Submerged entrance and unsubmerged exit. Full pipe flow. Upstream controlled with the flow control at the culvert outlet.
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
Submerged entrance and exit. Full pipe flow. Downstream controlled.
</td>
</tr>
<tr>
<td style="text-align:left;">
G
</td>
<td style="text-align:left;">
No flow. Dry or flap-gate active.
</td>
</tr>
<tr>
<td style="text-align:left;">
H
</td>
<td style="text-align:left;">
Submerged entrance and unsubmerged exit. Adverse slope. Downstream controlled.
</td>
</tr>
<tr>
<td style="text-align:left;">
J
</td>
<td style="text-align:left;">
Unsubmerged entrance and exit. Adverse slope. Downstream controlled.
</td>
</tr>
<tr>
<td style="text-align:left;">
K
</td>
<td style="text-align:left;">
Unsubmerged entrance and submerged exit. Critical flow at entrance. Upstream controlled with flow control at the inlet. Hydraulic jump along culvert. Not available for <tcmd><a href="#ecfCulvertFlow">Culvert Flow</a> </tcmd><teq>==</teq><tblk> Method A</tblk>.
</td>
</tr>
<tr>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
Submerged entrance and exit. Orifice flow at entrance. Upstream controlled with the flow control at the inlet. Hydraulic jump along culvert. Not available for <tcmd><a href="#ecfCulvertFlow">Culvert Flow</a> </tcmd><teq>==</teq><tblk> Method A</tblk>.
</td>
</tr>
</tbody>
</table>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image19"></span>
<img src="images/image19.png" alt="**1D Inlet Control Culvert Flow Regimes**" width="50%" />
<p class="caption">
Figure 25: <strong>1D Inlet Control Culvert Flow Regimes</strong>
</p>
</div>
</center>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image20"></span>
<img src="images/image20.png" alt="**1D Outlet Control Culvert Flow Regimes**" width="50%" />
<p class="caption">
Figure 26: <strong>1D Outlet Control Culvert Flow Regimes</strong>
</p>
</div>
</center>
<h4 class="hasAnchor" id="Blockage-4"><span class="header-section-number">5.8.1.1</span> Blockage Matrix<a href="#Blockage-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This feature allows for blockage of culverts to be varied based on the Average Recurrence Interval (ARI) of the flood simulation. This applies to C (circular) and R (rectangular) type culverts. For Australian users, this hydraulic structure blockage option is consistent with Project 11 of <a href="https://arr.ga.gov.au/arr-guideline/revision-projects/project-list">Australian Rainfall &amp;
Runoff</a> <span class="citation">(<a href="#ref-WeeksWitheridge2013">Weeks et al., 2013</a>)</span>.</p>
<p>Two different blockage methods are available:</p>
<ol style="list-style-type: decimal">
<li>The first method reduces the area in the culvert;<br />
</li>
<li>The second applies a modified energy loss value to account for the
blockage.</li>
</ol>
<p>Please refer to <span class="citation">Ollett &amp; Syme (<a href="#ref-OllettSyme2016">2016</a>)</span> for background information on the loss approaches.</p>
<p>Each culvert can be assigned a blockage category, which is defined in the 1d_nwk pBlockage attribute as a character field. A matrix of blockage category and percentage blockage for a range of ARIs is defined. Please see Section <a href="#BlockageImplement-5"><strong>??</strong></a> for guidance on implementation.</p>
<h5 class="hasAnchor" id="ReducedArea-5"><span class="header-section-number">5.8.1.1.1</span> Reduced Area Method<a href="#ReducedArea-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the reduced area method, the culvert area is reduced to match the
specified blockage in the same manner as varying the pBlockage attribute
on the 1d_nwk layer (refer to Table <a href="#tab:tab-CulvertsAttributeDescriptions">22</a>). For example, with a blockage value of
10 the culvert area is reduced by 10%.</p>
<h5 class="hasAnchor" id="EnergyLoss-5"><span class="header-section-number">5.8.1.1.2</span> Energy Loss Method<a href="#EnergyLoss-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For this method the area of the culvert is not modified, however, an
increased entrance energy loss is applied. The modified energy loss is
based on the specified culvert entry loss and the blockage ratio as per
equation <a href="#eq:equ-ELM">(13)</a> <span class="citation">(<a href="#ref-Witheridge2009">Witheridge, 2009</a>)</span>:</p>
<p><span class="math display" id="eq:equ-ELM">\[\begin{equation}
C_{ELC\_ modified} = \left( \frac{1 + \sqrt{C_{ELC}}}{BR} - 1 \right)^{2}
\tag{13}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(C_{ELC\_ modified}\)</span> = Modified culvert entry loss value<br />
</li>
<li><span class="math inline">\(C_{ELC}\)</span> = Specified culvert entry loss value</li>
<li><span class="math inline">\(BR\)</span> = Blockage ratio (area of blocked culvert / area unblocked culvert)</li>
</ul>
<p>When BR is 1 (unblocked), the modified entry loss
coefficient becomes the specified entry loss coefficient. The modified
coefficients for a range of blockages are provided in Table <a href="#tab:tab-LossCoefficient">24</a>.</p>
<table>
<caption>
<span id="tab:tab-LossCoefficient">Table 24: </span><strong>Computed Values of Modified Energy Loss Coefficient</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
C<sub>ELC</sub>
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
<b>0.3</b>
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
<b>0.5</b>
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
<b>0.7</b>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
<b>Specified % Blockage</b>
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
BR
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
<b>C<sub>ELC_modified</sub></b>
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;width: 10em; max-width: 10em; vertical-align:top;">
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
1
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.3
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.5
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.7
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
10
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.9
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.5
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.8
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
1.1 
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
25
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.75
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
1.1 
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
1.6
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
2.1
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
50
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.5
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
4.4 
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
5.8
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
7.1
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
75
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.25
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
27
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
34
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
40
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
90
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.1
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
210
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
260
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
300
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
95
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0.05
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
900
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
1100
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
1280
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
100
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
0
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
∞
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
∞
</td>
<td style="text-align:left;width: 10em; max-width: 10em; vertical-align:top;">
∞
</td>
</tr>
</tbody>
</table>
<p>Whilst loss values of greater than 1.0 may appear counter-intuitive, it
is appropriate in this situation. In conduit hydraulics there are two
types of loss coefficients that are used to represent constrictions,
one type being applied to the velocity at the constriction itself (these
are always &lt;=1), and the other type which are applied to the
full-barrel velocity downstream of the blockage where the loss
coefficient may approach infinity. The second type is convenient as the
velocity downstream of the blockage is readily available and requires no
manipulation of culvert geometry, and follows in principle the same
application of valve coefficients. The equation above simply gives the
conversion between these two types of loss coefficients.</p>
<p>Note: The minimum blockage ratio is set to 0.001 or 0.1%. This is required to avoid a divide by zero error in the calculations. <strong>This loss method only applies when the culvert is operating under outlet control.</strong> For an inlet control flow regime no energy loss is applied, the reduced area method is used instead.</p>
<h5 class="hasAnchor" id="BlockageCmds-5"><span class="header-section-number">5.8.1.1.3</span> Blockage Matrix Commands<a href="#BlockageCmds-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The commands available for the Blockage Matrix method are listed in Table <a href="#tab:tab-MatrixMethod">25</a>.</p>
<table>
<caption>
<span id="tab:tab-MatrixMethod">Table 25: </span><strong>Commands for the Blockage Matrix Method</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockageMatrix">Blockage Matrix</a>
</td>
<td style="text-align:left;">
Turns on or off the blockage matrix functionality outlined in this section. The default is for this feature to be off.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockageMatrixFile">Blockage Matrix File</a>
</td>
<td style="text-align:left;">
Specifies a blockage file containing the blockage values for the various blockage categories and ARI values.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockageMethod">Blockage Method</a>
</td>
<td style="text-align:left;">
Specifies whether to use RAM (Reduced Area Method) or ELM (Energy Loss Method). No default approach is applied. This command must be specified if using the blockage matrix functionality.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockageARI">Blockage ARI</a>
</td>
<td style="text-align:left;">
Specifies the ARI for the current simulation. This would typically be defined in an event file (.tef).
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockageOverride">Blockage Override</a>
</td>
<td style="text-align:left;">
Sets the blockage for <b>all</b> culverts with the specified blockage category. This option is useful for running simulations under an “all clear” case.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockageDefault">Blockage Default</a>
</td>
<td style="text-align:left;">
Sets the blockage category for culverts that do not have a blockage type specified (including those that have a numeric pBlockage defined)
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfBlockagePMFARI">Blockage PMF ARI</a>
</td>
<td style="text-align:left;">
If PMF has been specified in the ARI column of the blockage matrix, this command sets an ARI to be used for the PMF. This allows for interpolation of blockages for ARI values up to the PMF.
</td>
</tr>
</tbody>
</table>
<h5 class="hasAnchor" id="BlockageImplement-5"><span class="header-section-number">5.8.1.1.4</span> Implementation<a href="#BlockageImplement-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To make use of this feature the pBlockage attribute of the 1d_nwk GIS layer needs to be changed from a float (numeric) type to a character field, with maximum width of 50. This has not been made the default field type in the empty (template) files that TUFLOW produces, for two main reasons:</p>
<ul>
<li>A character field is bigger and less efficient to read, this could slow down simulation start-up for models not using the blockage categories; and<br />
</li>
<li>A numeric field (in almost all GIS packages) defaults to 0.0, i.e. no blockage. This is not the case for a character field.</li>
</ul>
<p>Instructions on how to change the GIS layer attribute type in QGIS, ArcMap and MapInfo are provided in the TUFLOW Wiki as per the links below:</p>
<ul>
<li><a href="https://wiki.tuflow.com/QGIS_Change_Attribute_Type">QGIS</a><br />
</li>
<li><a href="https://wiki.tuflow.com/Arc_Change_Attribute_Type">ArcMap</a><br />
</li>
<li><a href="https://wiki.tuflow.com/MI_Change_Attribute_Type">MapInfo</a></li>
</ul>
<p>For each culvert the pBlockage attribute can be set to either; a numeric value (in which case this is used as per the standard simulation), a blockage category name (as a character string e.g. “A”), or left blank (in which case the <a href="#tcfBlockageDefault">Blockage Default</a> would apply). In the example below, the pBlockage attribute has been set to a category named “B”.</p>
<center>
<img src="images/image55.png"
style="width:2.30412in;height:4.23958in" />
</center>
<p>Each blockage category must be defined in the Blockage Matrix File. The
first column should contain the Average Recurrence Interval (ARI) for a
range of events, any additional columns contain percentage blockages for
each of the ARIs. An example blockage matrix file is provided in Table <a href="#tab:tab-Blockage">26</a>
containing 5 different blockage categories (A, B, C, D, E). For blockage
category A the culvert is unblocked for all ARIs, for category E the
culvert is fully blocked for all ARIs. For the categories B, C, and D
the blockage varies by ARI.</p>
<p>If the specified ARI sits between the defined ARI values in the blockage
matrix file a linear interpolation is used. For example, in the table
below for a 50-year ARI, blockage category “C” will have a blockage of
13.75%.</p>
<table>
<caption>
<span id="tab:tab-Blockage">Table 26: </span><strong>Example Blockage Matrix File</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
ARI
</th>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
A
</th>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
B
</th>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
C
</th>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
D
</th>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
E
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
100
</td>
</tr>
<tr>
<td style="text-align:right;">
10000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>
</table>
<p>The ARI values for the blockage matrix file should be in ascending
order. “PMF” can be defined in the ARI column, if this is done, an ARI
must be assigned to the PMF using the command <a href="#tcfBlockagePMFARI">Blockage PMF
ARI</a>.</p>
<p><strong><u>Example TUFLOW commands</u></strong></p>
<p><strong><u>.tcf file commands</u></strong></p>
<p><tcmd>Blockage Matrix</tcmd><teq> ==</teq><tblk> On</tblk><br />
<tcmd>Blockage Matrix File</tcmd><teq> ==</teq><tblk> Matrix_Blockages.csv</tblk><br />
<tcmd>Blockage Method</tcmd><teq> ==</teq><tblk> RAM</tblk><br />
<tcmd>Blockage Default</tcmd><teq> ==</teq><tblk> C</tblk></p>
<p><strong><u>.tef file commands</u></strong></p>
<p><tcmd>Define Event</tcmd><teq> ==</teq><tblk> Q010</tblk><br />
 <tcmd>Blockage ARI</tcmd><teq> ==</teq><tblk> 10</tblk><br />
 <tcmd>BC Event Source</tcmd><teq> ==</teq><tblk> __ARI__ | Q010</tblk><br />
<tcmd>End Define</tblk><br />
<tcmd>Define Event</tcmd><teq> ==</teq><tblk> Q100</tblk><br />
 <tcmd>Blockage ARI</tcmd><teq> ==</teq><tblk> 100</tblk><br />
 <tcmd>BC Event Source</tcmd><teq> == </teq><tblk>__ARI__ | Q100</tblk><br />
<tcmd>End Define</tblk><br />
<tcmd>Define Event</tcmd><teq> == </teq><tblk>QPMF</tblk><br />
 <tcmd>Blockage ARI</tcmd><teq> == </teq><tblk>100000</tblk><br />
 <tcmd>BC Event Source</tcmd><teq> == </teq><tblk>__ARI__ | PMF</tblk><br />
<tcmd>End Define</tcmd></p>
<p>A working example of a blockage matrix model is provided in the example models on the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">TUFLOW Wiki</a>.</p>
<h4 class="hasAnchor" id="id_-4"><span class="header-section-number">5.8.1.2</span> Limitations<a href="#id_-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the energy loss method, the loss value only applies to the culverts when flowing in outlet control flow regimes. When the flow conditions are inlet controlled TUFLOW reverts to using the reduced area method. This is required, as there is no guidance how to adjust the contraction coefficients or otherwise as used by the inlet controlled culvert equations.</p>
<h3 class="hasAnchor" id="Bridges-3"><span class="header-section-number">5.8.2</span> Bridges<a href="#Bridges-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="BridgeIntro-4"><span class="header-section-number">5.8.2.1</span> Bridges Overview<a href="#BridgeIntro-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Bridge channels do not require data for length, Manning’s n, divergence
or bed slope (they are effectively zero-length channels, although the
length is used for automatically determining nodal storages – see
Section <a href="#AutoStorageWidths-4"><strong>??</strong></a>). The bridge opening cross-section is described in
the same manner to a normal channel.</p>
<p>Two types of bridge channels can be specified:</p>
<ul>
<li>“B” bridges require the user to specify an energy loss versus elevation table, usually derived from loss coefficients in the literature such as “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or “Guide to Bridge Technology Part 8, Hydraulic Design of Waterway Structures” <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span>. The energy loss table can be generated automatically via the 1d_nwk Form_Loss attribute if the energy loss coefficient is constant up to the underside of the bridge deck.<br />
</li>
<li>“BB” bridges automatically calculate the form (energy) losses associated with the approach and departure flows as the water constricts and expands. It also automatically applies bridge deck losses associated with pressure flow. The only user specified loss coefficients required for BB bridges are the pier losses and the deck losses once fully submerged. If the pier loss coefficient is constant through the vertical the coefficient can simply be specified via the 1d_nwk Form_Loss attribute as described further below.</li>
</ul>
<p>For B bridges, two bridge flow approaches are offered using <a href="#ecfBridgeFlow">Bridge
Flow</a>. Method B is an enhancement on Method A by
providing better stability at shallow depths or when wetting and drying.
There are also some subtle differences between the methods in how the
loss coefficients are applied at the bridge deck. This is discussed
further below. Method B is the approach recommended with Method A
provided for legacy models. For <tcmd><a href="#ecfBridgeFlow">Bridge Flow</a> </tcmd><teq>==</teq><tblk> Method A</tblk>, the underside of the
bridge deck (the obvert or soffit) is taken as the elevation when the
flow area stops increasing, or the highest elevation in the bridge’s
cross-section data, whichever occurs first. For <tcmd><a href="#ecfBridgeFlow">Bridge
Flow</a></tcmd><teq> == </teq><tblk>Method B</tblk>, the highest (last) elevation in the
cross-section table is always assumed to be the underside of the bridge
deck.</p>
<h4 class="hasAnchor" id="XSLoss-4"><span class="header-section-number">5.8.2.2</span> Bridge Cross-Section and Loss Tables<a href="#XSLoss-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The cross-sectional shape of the bridge is specified in the same manner
as for open channels using a 1d_xs GIS layer (refer to Section
<a href="#XS-2"><strong>??</strong></a> and Table <a href="#tab:tab-CrossAttributeDescriptions">21</a>) and the command <a href="#ecfReadGISTableLinks">Read GIS Table
Links</a>. The line is digitised midway
across the 1d_nwk channel line (do not specify as an end cross-section,
i.e. a cross-section line snapped to an end of the bridge channel). As
per the open channel, the cross-section data can be in offset-elevation
(XZ) or height-width (HW) format.</p>
<p>Bridge structures are modelled using a height varying form or energy
loss coefficient. A table (referred to as a Bridge Geometry “BG” or Loss
Coefficient “LC” Table) of backwater or form loss coefficient versus
height is required. The interpretation of loss coefficients provided by
the user differs depending on whether the bridge channel is of a B or BB
type as discussed in the following sections.</p>
<p>BG Tables can be entered using .csv files via a 1d_bg GIS layer (see
Table <a href="#tab:tab-LinkAttributeDescriptions">28</a>) using the command <a href="#ecfReadGISTableLinks">Read GIS Table
Links</a>. A line is digitised crossing
the 1d_nwk channel in the same manner as for the 1d_xs GIS layer used to
define the cross-sectional shape of the bridge. The line does not have
to be identical to the cross-section line.</p>
<p>Where the loss coefficient is constant through to the bridge deck (e.g.
no losses such as a clear spanning bridge, or pier losses only – see BB
bridges), the BG table can automatically be created by specifying a
positive non-zero value for the Form_Loss attribute in the 1d_nwk layer
(see Table <a href="#tab:tab-BridgesAttributeDescriptions">27</a>). How the Form_Loss attribute is interpreted differs between B and
BB bridge channels as discussed in the following sections.</p>
<p>Any wetted perimeter or Manning’s n inputs in the hydraulic properties
table are ignored. If the flow is expected to overtop the bridge, a
parallel weir channel should be included to represent the flow over the
bridge deck, or a BW or BBW channel can be specified (see
Section <a href="#Auto-Weir-4"><strong>??</strong></a>).</p>
<h4 class="hasAnchor" id="B-Bridge-4"><span class="header-section-number">5.8.2.3</span> B Bridge Losses Approach<a href="#B-Bridge-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The coefficients for B bridges are usually obtained from publications
such as “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or “Guide to
Bridge Technology Part 8, Hydraulic Design of Waterway Structures”
<span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span>, through the following procedure.</p>
<ul>
<li>The bridge opening ratio (stream constriction ratio), defined in
Equations 1 and 2 of “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span>, is estimated
for various water levels from the local geometry. Alternatively, the
bridge opening ratio is estimated with the help of a trial modelling
run in which the stream crossed by the bridge is represented by a
number of parallel channels, providing a more quantitative basis for
estimating the proportion of flow obstructed by the bridge abutments.<br />
</li>
<li>For each level this enables the value of K<sub>b</sub> to be obtained
from Figure 6 of “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span>. Additional factors,
for piers (K<sub>p</sub> from Figure 7), eccentricity (K<sub>e</sub>
from Figure 8) and for skew (K<sub>s</sub> from Figure 10) make up the
primary contributors to K<sub>b</sub>.<br />
</li>
<li>The backwater coefficient K<sub>b</sub> input into the LC table is the
sum of the relevant coefficients at each elevation. The velocity
through the bridge structure used for determining the head loss is
based on the flow area calculated using the water level at the
downstream node.</li>
</ul>
<p>Backwater coefficients derived in this manner have usually taken into
account the effects of approach and departure velocities (via
consideration of the upstream and downstream cross-section areas), in
which case the losses for the B channel should be fixed. This is the
default setting or can be manually specified using the “F” flag (i.e. a
“BF” channel) in the 1d_nwk Type attribute, or use <tcmd><a href="#ecfStructureLosses">Structure
Losses</a></tcmd><teq> == </teq><tblk>ADJUST EXCEPT BG TABLES</tblk> (the default).</p>
<p>For <tcmd><a href="#ecfBridgeFlow">Bridge Flow</a></tcmd><teq> ==</teq><tblk> Method A</tblk>, once the downstream water level is within 10% of the flow
depth under the bridge, a bridge deck submergence factor is phased in by
applying a correction for submerged decking using a minimum value of
1.5625 (if the specified loss coefficient is greater than 1.5625, this
value is applied). <tcmd><a href="#ecfBridgeFlow">Bridge Flow</a></tcmd><teq> == </teq><tblk>Method B</tblk> does not use the 10% of the flow depth
phasing in nor applies a minimum loss coefficient once the bridge deck
is submerged (i.e. it applies the value as per the specified loss
coefficients (BG) table). Method B relies on the user to provide
appropriate values at all flow heights.</p>
<p>The value of 1.5625 is derived from the following equation <a href="#eq:equ-AustRoads">(14)</a> presented in
Waterway Design - A Guide to the Hydraulic Design of Bridges, Culverts
and Floodways <span class="citation">(<a href="#ref-Austroads1994">Austroads, 1994</a>)</span>:</p>
<p><span class="math display" id="eq:equ-AustRoads">\[\begin{equation}
Q = {C_d}{b_N}Z\sqrt{2gdH}
\tag{14}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><em>Q =</em> Total discharge (<em>m<sup>3</sup>/s</em>)<br />
</li>
<li><em>C<sub>d</sub> =</em> Coefficient of discharge (0.8 for a surcharged bridge
deck)<br />
</li>
<li><em>b<sub>N</sub> =</em> Net width of waterway (<em>m</em>)<br />
</li>
<li><em>Z =</em> Vertical distance under bridge to mean river bed (<em>m</em>)<br />
</li>
<li><em>dH =</em> Upstream energy (or water surface) level minus downstream water
surface level (<em>m</em>)</li>
</ul>
<p>Assuming <span class="math inline">\({V} = \frac{Q}{b_{N}Z}\)</span> and
<span class="math inline">\(dh = K\frac{V^2}{2g}\)</span>,
the equation rearranges to give
<span class="math inline">\(K = \frac{1}{C_d^2}\)</span>, where a
<em>C<sub>d</sub></em> value of 0.8 equates to a K energy loss value of 1.5625.</p>
<h4 class="hasAnchor" id="BB-Bridge-4"><span class="header-section-number">5.8.2.4</span> BB Bridge Losses Approach<a href="#BB-Bridge-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>BB bridges break down the energy losses into the following categories:</p>
<ul>
<li>Bridge pier losses;</li>
<li>Losses due to flow contraction and expansion;</li>
<li>Bridge deck losses when the bridge is submerged but not under pressure flow condition; and</li>
<li>If under pressure flow, the pressure flow equation is applied as described further below.</li>
</ul>
<p>BB bridges differ from B bridges in that the losses due to flow contraction and expansion, and
the occurrence of pressure flow are handled automatically. The only loss coefficient required to be specified is that due to piers (via the Form_Loss attribute value or a LC table). Other loss parameters can be either set based on the default parameters, or can be specified by users. The parameters used by the BB bridge routine are:</p>
<ul>
<li>Cd = the Bridge Deck surcharge coefficient (Default = 0.8).<br />
</li>
<li>DLC = the Deck loss coefficient (Default = 0.5) and only applies when
no LC table exists and an automatically generated table using the
1d_nwk Form_Loss attribute is created.<br />
</li>
<li>ELC = the unadjusted entry loss coefficient (Default = 0.5).<br />
</li>
<li>XLC = the unadjusted exit loss coefficient (Default = 1.0).</li>
</ul>
<p>The .ecf command “<tcmd><a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a>
</tcmd><teq>==</teq><tblk> &lt;CD&gt;, &lt;DLC&gt;, &lt;ELC&gt;, &lt;XLC&gt;</tblk>” can be used to change the above
default values to the user’s own default values.</p>
<p>The above values can also be changed for an individual bridge using the following
1d_nwk attributes. If the attribute value is zero then the default value
or the value specified by <a href="#ecfBridgeZeroCoefficients">Bridge Zero
Coefficients</a> is used.</p>
<ul>
<li>CD = HConF_or_WC<br />
</li>
<li>DLC = WConF_or_WEx<br />
</li>
<li>ELC = EntryC_or_WSa<br />
</li>
<li>XLC = ExitC_or_WSb</li>
</ul>
<p>The entrance and exit losses are adjusted every timestep according to
the approach and departure velocities based on the equations below from Section <a href="#LossAdjustment-3"><strong>??</strong></a>. This approach yields similar
results to the approach for determining contraction and expansion losses
in publications such as “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span>
or “Guide to Bridge Technology Part 8, Hydraulic Design of Waterway
Structures” <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span>.</p>
<p><span class="math display" id="eq:equ-ELC">\[\begin{equation}
C_{ELC\text{_}adjusted} = C_{ELC}\left\lbrack 1 - \frac{V_{approach}}{V_{structure}} \right\rbrack
\tag{15}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-XLC">\[\begin{equation}
C_{XLC\text{_}adjusted} = C_{XLC}\left\lbrack 1 - \frac{V_{departure}}{V_{structure}} \right\rbrack^{2}
\tag{16}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><em>V =</em> Velocity (<em>m/s</em>)<br />
</li>
<li><em>C =</em> Energy Loss Coefficient</li>
</ul>
<p>Pressure flow is handled by transitioning from the equation described in
the previous section (to derive the K value of 1.5625 from a coefficient
of discharge value of 0.8) to a fully submerged situation where a deck
energy loss is applied. The flux is calculated based on both the fully submerged situation and the pressure flow situation, and the lesser of the two fluxes is applied. The 1d_nwk HConF_or_WC attribute can be used to
vary Cd (default value is 0.8) and the WConF_or_WEx attribute to set the
submerged deck loss coefficient. When pressure flow results the “P” flag
will appear in the .eof file and _TSF layer.</p>
<p>Optionally, LC tables can be specified for BB bridges. If a LC table exists, the Deck loss coefficient (DLC) will be ignored, while the other 3 parameters (CD, ELC and XLC) are not affected. The LC tables for BB bridges should therefore only be the losses due to piers and bridge decks. The LC table should not include any losses for contraction, expansion and pressure flow. Note the Form_Loss value is added to the LC table loss values.</p>
<p>If no LC table exists for the BB bridge, and the 1d_nwk Form_Loss
attribute is greater than 0.0001, a LC table is automatically generated
using Form_Loss for the pier losses and the WConF_or_WEx for the Deck
Loss coefficient (DLC).</p>
<p>Other notes are:</p>
<ul>
<li>BB bridges are only available if <tcmd><a href="#ecfStructureRoutines">Structure Routines</a> </tcmd><teq>==</teq><tblk> 2013</tblk> (the default).<br />
</li>
<li>The unadjusted entry and exist losses (ELS and XLC) cannot be below 0
or greater than 1, and will be automatically limited to these values.<br />
</li>
<li>_TSF and _TSL layers contain the following flags/values for BB
bridges:
<ul>
<li>For normal flow (“ ” or “D” if drowned out): fixed / adjusted
components<br />
</li>
<li>For Pressure (“P”) flow: Deck surcharge Coefficient / 0.0<br />
</li>
<li>Other flags:
<ul>
<li>“U” for upstream controlled flow – only occurs when downstream
water level is below the bridge bed level.<br />
</li>
<li>“Z” for zero or nearly zero flow.</li>
</ul></li>
</ul></li>
</ul>
<table>
<caption>
<span id="tab:tab-BridgesAttributeDescriptions">Table 27: </span><strong>Bridges: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas, and cannot be blank. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
“B” or “BB” as specified in Table <a href="#tab:tab-LineTypes">18</a>.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes).
</td>
<td style="text-align:left;">
If left blank or set to Yes (“Y” or “y”) or True (“T” or “t”), the storage based on the width of the channel over half the channel length is assigned to both of the two nodes connected to the channel. If set to No (“N” or “n”) or False (“F” or “f”), the channel width does not contribute to the node’s storage. See Section <a href="#Nodes-2"><strong>??</strong></a> for further discussion.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
Only used in determining nodal storages if the UCS attribute is set to “Y” or “T”. Not used in conveyance calculations.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
Sets the upstream and downstream inverts. Note that the invert is taken as the maximum of the US_Invert and the DS_Invert attributes. Use -99999 to use the bed of the cross-section as the invert.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
Sets the downstream invert of the channel using the same rules as for described for the US_Invert attribute above.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
<p>If a LC table exists, for BB bridges adds the value specified to the loss coefficients in the LC table. Not added to LC tables for B bridges.</p>
<p>If no LC table exists, and the value is greater than zero, TUFLOW automatically generates a LC table of constant loss coefficient up until the bridge deck (i.e. the top of the cross-section). The interpretation of the LC table generated from the Form_Loss value differs depending on whether a B or a BB bridge as follows:</p>
<p>For B bridges (with no LC table):</p>
<ul>
<li>The Form_Loss (LC value) is not subject to adjustment when using <tcmd>Structure Losses</tcmd><teq> == </teq><tblk>ADJUST</tblk>.</li>
<li>Above the underside of the bridge deck (the top of the cross-section) a value of 1.5625 is used, with the 1.5625 less the Form_Loss value is subject to adjustment when using <tcmd>Structure Losses</tcmd><teq> == </teq><tblk>ADJUST</tblk>.</li>
</ul>
<p>For BB bridges (with no LC table):</p>
<ul>
<li>The Form_Loss (LC value) is only used to apply pier losses. Contraction/expansion losses and bridge deck pressure flow losses are automatically calculated.</li>
<li>Once the bridge deck is fully submerged (and no longer under pressure flow) the WConF_or_WEx attribute is used to set the additional losses due to the bridge deck.</li>
</ul>
Note: Due to the potential for a divide by zero, a zero loss value cannot be specified with no LC table. A loss value of 0 will return <a href="https://wiki.tuflow.com/TUFLOW_Message_1422">ERROR 1422</a>. A minimum loss value of 0.01 for B bridges or 0.001 for BB bridges is required by TUFLOW to ensure a divide by zero does not occur. Specifying a loss value equal to or less than these minimums (but not 0) will apply these minimum losses, i.e. to apply these minimum losses specify a value of 0.001 for either B or BB bridges.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
Not used. Reserved for future builds to fully or partially block B channels. The 1d_xs Skew attribute can be used to partially block cross-sections of these channels – see Table <a href="#tab:tab-CrossAttributeDescriptions">21</a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
Leave blank unless using the legacy MIKE 11 1D cross-section data feature.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Leave blank unless using the legacy MIKE 11 1D cross-section data feature, or if accessing a Flood Modeller cross-section database (.pro file), enter the label in the .pro file.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Leave blank unless using the legacy MIKE 11 1D cross-section data feature.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
<p>B bridges: Not used.</p>
BB bridges: Bridge deck pressure flow contraction coefficient (C<sub>d</sub>). If set to zero the default of 0.8 or that specified by <a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
<p>B bridges: Not used.</p>
BB bridges: Bridge deck energy loss coefficient (DLC) for fully submerged flow. If set to zero the default of 0.5 or that specified by <a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
<p>B bridges: Not used.</p>
BB bridges: Unadjusted entrance energy loss coefficient (ELC). If set to zero the default of 0.5 or that specified by <a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
<p>B bridges: Not used.</p>
BB bridges: Unadjusted exit energy loss coefficient (XLC). If set to zero the default of 1.0 or that specified by <a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-LinkAttributeDescriptions">Table 28: </span><strong>1D Bridge Geometry Table Link (1d_bg) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Source
</td>
<td style="text-align:left;">
Filename (and path or relative path if needed) of the file containing the tabular data. Must be a comma or space delimited text file such as a .csv file.
</td>
<td style="text-align:left;">
Char(50)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<b>“BG” or “LC”: </b> Bridge energy loss coefficients (second column) versus elevation (first column) for bridge structures.
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Flags
</td>
<td style="text-align:left;">
No optional flags.
</td>
<td style="text-align:left;">
Char(8)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Column_1
</td>
<td style="text-align:left;">
<p>Optional. Identifies a label in the Source file that is the header for the first column of data (ie. elevation). Values are read from the first number encountered below the label until a non-number value, blank line or end of the file is encountered.</p>
If this field is left blank, the first column of data in the Source file is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Column_2
</td>
<td style="text-align:left;">
<p>Optional. Identifies a label in the Source file that is in the header for the second column of data (ie. loss coefficient).</p>
If this field is left blank, the next column of data after Column_1 is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Column_3
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Column_4
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Column_5
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Column_6
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Z_Increment
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Z_Maximum
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Skew<br />
(in degrees)
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="BArch-3"><span class="header-section-number">5.8.3</span> Arch Bridge<a href="#BArch-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2023-03 release introduced support for arch bridges as 1D channels. The approach is based on the ‘Afflux at Arch Bridges’ <span class="citation">(<a href="#ref-HRWallingford1988">HR Wallingford, 1988</a>)</span>. Arch bridges are defined in the 1d_nwk layer as a “BArch” type. The 1d_nwk attributes specific to an arch bridge are outlined below in Table <a href="#tab:tab-ArchBridgesAttributeDescriptions">29</a>.</p>
<table>
<caption>
<span id="tab:tab-ArchBridgesAttributeDescriptions">Table 29: </span><strong>Arch Bridges 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas, and cannot be blank. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
“BArch” as specified in Table <a href="#tab:tab-LineTypes">18</a>.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes).
</td>
<td style="text-align:left;">
If left blank or set to Yes (“Y” or “y”) or True (“T” or “t”), the storage based on the width of the channel over half the channel length is assigned to both of the two nodes connected to the channel. If set to No (“N” or “n”) or False (“F” or “f”), the channel width does not contribute to the node’s storage. See Section <a href="#Nodes-2"><strong>??</strong></a> for further discussion.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
Only used in determining nodal storages if the UCS attribute is set to “Y” or “T”. Not used in conveyance calculations.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
Sets the upstream and downstream inverts. Note that the invert is taken as the maximum of the US_Invert and the DS_Invert attributes. Use -99999 to use the bed of the cross-section as the invert.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
Sets the downstream invert of the channel using the same rules as for described for the US_Invert attribute above.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
The relative path to the arch properties file (must be a .csv file). See Section <a href="#M-Channel-3"><strong>??</strong></a>.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
Optional skew parameter.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
Optional calibration coefficient.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
Discharge coefficient for orifice flow - use negative value to switch on.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
Lower transition distance for orifice flow.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
Upper transition distance for orifice flow.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p>The .csv for the arch properties should contain the columns outlined in Table <a href="#tab:tab-ArchBridgeProperties">30</a>.</p>
<table>
<caption>
<span id="tab:tab-ArchBridgeProperties">Table 30: </span><strong>Arch Bridge Properties .csv</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Start chainage for arch opening.
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
End chainage for arch opening.
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Springing level.
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Start chainage for arch opening.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="BArch-Editor-4"><span class="header-section-number">5.8.3.1</span> Arch Bridge Editor<a href="#BArch-Editor-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>An arch bridge creator and editor tool has been developed for the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">QGIS TUFLOW Plugin</a>. This tool is available from the TUFLOW Plugin Version 3.7 or later. The documentation and examples for this tool can be found on the <a href="https://wiki.tuflow.com/QGIS_TUFLOW_Arch_Bridge_Editor">TUFLOW Wiki</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image21"></span>
<img src="images/image21.png" alt="**Arch Bridge Editor Tool**"  />
<p class="caption">
Figure 27: <strong>Arch Bridge Editor Tool</strong>
</p>
</div>
</center>
<h4 class="hasAnchor" id="BArch-Min-Blc-4"><span class="header-section-number">5.8.3.2</span> Arch Minimum Blockage<a href="#BArch-Min-Blc-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The flume experiments in the ‘Afflux at Arch Bridges’ <span class="citation">(<a href="#ref-HRWallingford1988">HR Wallingford, 1988</a>)</span> were done using medium to high bridge blockages (20%~70%), and this approach can generate extremely high velocity when the bridge blockage is close to zero percent. The 2023-03-AF release introduced a minimum blockage of 5% to stabilise the flow. This default value can be changed using the following command:</p>
<p><tcmd><a href="#ecfArchBridgeMinimumBlockage">Arch Bridge Minimum Blockage (%)</a></tcmd><teq> == </teq><tblk>&lt;min_pblockage&gt;</tblk></p>
<h3 class="hasAnchor" id="Weir-3"><span class="header-section-number">5.8.4</span> Weirs<a href="#Weir-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="Weir-Intro-4"><span class="header-section-number">5.8.4.1</span> Weirs Overview<a href="#Weir-Intro-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A range of weir types are available as listed in Table <a href="#tab:tab-WeirTypes">31</a>. Weir channels do not
require data for length, Manning’s n, divergence or bed slope (they are
effectively zero-length channels, although the length is used for
automatically determining nodal storages – see Section <a href="#AutoStorageWidths-4"><strong>??</strong></a>).</p>
<p>All weirs have three flow regimes of zero flow (dry), upstream
controlled flow (unsubmerged) and downstream controlled flow
(submerged).</p>
<table>
<caption>
<span id="tab:tab-WeirTypes">Table 31: </span><strong>Weir Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Weir Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
W
</td>
<td style="text-align:left;">
The original ESTRY weir based on the broad-crested weir formula with the Bradley submergence approach (see <tcmd><a href="#ecfWeirApproach">Weir Approach</a> </tcmd><teq>==</teq><tblk> METHOD A</tblk>). The weir shape is defined either as a rectangle using the 1d_nwk Width attribute or as a cross-section.
</td>
</tr>
<tr>
<td style="text-align:left;">
WB
</td>
<td style="text-align:left;">
Broad-crested weir. A rectangular section shape is assumed.
</td>
</tr>
<tr>
<td style="text-align:left;">
WC
</td>
<td style="text-align:left;">
Crump weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
WD
</td>
<td style="text-align:left;">
User-defined weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
WO
</td>
<td style="text-align:left;">
Ogee-crested weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
WR
</td>
<td style="text-align:left;">
Rectangular weir (sharp crested).
</td>
</tr>
<tr>
<td style="text-align:left;">
WT
</td>
<td style="text-align:left;">
Trapezoidal weir or Cippoletti weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
WV
</td>
<td style="text-align:left;">
V-notch weir.
</td>
</tr>
<tr>
<td style="text-align:left;">
WW
</td>
<td style="text-align:left;">
Similar to the original W weir channel, but has more options allowing the user to customise the weir sub-mergence curve and other parameters. Can be based on either a rectangular shape using the 1d_nwk Width attribute or on a cross-section.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="W-Weir-4"><span class="header-section-number">5.8.4.2</span> Original Weirs (W)<a href="#W-Weir-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For a “W” type weir, a standard weir flow formula is used as per the
equation below. The weir is assumed to be broad-crested. Weirs with
different characteristics should be modelled using one of the other weir
types listed in Table <a href="#tab:tab-WeirTypes">31</a> and discussed in Section <a href="#Adv-Weir-4"><strong>??</strong></a>.</p>
<p><span class="math display" id="eq:equ-Qweir">\[\begin{equation}
Q_{weir} = \ \frac{2}{3}CW\sqrt{\frac{2g}{C_{f}}}H^{\frac{3}{2}}
\tag{17}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-Vapproach">\[\begin{equation}
V_{approach} = \ \frac{2}{3}C\sqrt{\frac{2gH}{C_{f}}}
\tag{18}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q_{weir}\)</span> = Unsubmerged flow over the weir (m<sup>3</sup>/s)<br />
</li>
<li><span class="math inline">\(V_{approach}\)</span> = Velocity approaching the weir (m/s)<br />
</li>
<li><span class="math inline">\(C\)</span> = Broad-crested weir coefficient of 0.57<br />
</li>
<li><span class="math inline">\(W\)</span> = Flow width (m)<br />
</li>
<li><span class="math inline">\(C_{f}\)</span> = Weir calibration factor (default of 1.0 – refer to 1d_nwk “Height_or_WF” attribute)<br />
</li>
<li><span class="math inline">\(H\)</span> = Depth of water approaching the weir relative to the weir invert (m)</li>
</ul>
<p>The calibration factor C<sub>f</sub>, is available for modifying the
flow. For a given approach velocity the backwater (head increment) of
the weir channel is proportional to the inverse of the factor. It is
normally set to 1.0 by default and modified if required for calibration
or other adjustment. Note, this factor is not the weir coefficient,
rather a calibration factor to adjust the standard broad-crested weir
equation. The factor can be used to model other types of weirs through
adjustment of the broad-crested weir equation, although use of the other
weir types listed in Table <a href="#tab:tab-WeirTypes">31</a> is recommended.</p>
<p><span class="citation">Huxley (<a href="#ref-Huxley2004">2004</a>)</span> contains benchmarking of unsubmerged and submerged weir flow to the literature.</p>
<p>Note that the velocity output for a weir is the approach velocity,
V<sub>approach</sub>, in the above equations, not the velocity at
critical depth (when the flow is unsubmerged).</p>
<p>For submergence of W weir channels, it is recommended that <a href="#ecfWeirApproach">Weir Approach</a> is set to METHOD A or METHOD C. Both METHOD A and METHOD C utilises the Bradley submergence approach (METHOD C is a slight enhancement that only affects WW weir channels). The Bradley Submergence approach <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span>, Figure 24, is handled by fitting the equation below to Bradley’s submergence curve reproduced in Figure <a href="#fig:fig-image22">28</a> and applying the submergence factor to the weir equation above.</p>
<p>Once the percentage of submergence exceeds 70%, the submergence factor
applied is given by the equation below <a href="#eq:equ-submergence-factor">(19)</a>. The Bradley curve (as digitised)
and the resulting curve from the equation below are shown alongside the
submergence curves used for other weir types. The submergence
factor transitions the flow from weir flow to zero flow as the water
level difference (<em>dH</em>) approaches zero.</p>
<p><span class="math display" id="eq:equ-submergence-factor">\[\begin{equation}
C_{sf} = \ 1 - \left( 1 - \frac{dH}{H} \right)^{20}
\tag{19}
\end{equation}\]</span></p>
<p><tcmd><a href="#ecfWeirApproach">Weir Approach</a> </tcmd><teq>==</teq><tblk> METHOD B</tblk> was introduced to provide
additional stability for 1D flow over roadways connected to 2D domains,
however, it can cause excessive head drops under drowned flow conditions
and is therefore not recommended or to be used with caution. METHOD B
only applies to the W weir.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image22"></span>
<img src="images/image22.png" alt="**Bradley Weir Submergence Curve [@Bradley1978]**" width="80%" />
<p class="caption">
Figure 28: <strong>Bradley Weir Submergence Curve <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span></strong>
</p>
</div>
</center>
<h4 class="hasAnchor" id="Adv-Weir-4"><span class="header-section-number">5.8.4.3</span> Advanced Weirs (WB, WC, WD, WO, WR, WT, WV, WW)<a href="#Adv-Weir-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The advanced weirs, as listed in Table <a href="#tab:tab-WeirTypes">31</a>, offer greater variety, flexibility and can be customised by the user. Most of these weirs can also be operated, see Section <a href="#OperationalChannels-2"><strong>??</strong></a>.</p>
<p>The weir flow is determined by the following equation.</p>
<p><span class="math display" id="eq:equ-weir-flow">\[\begin{equation}
Q = {\frac{2}{3}\ {\ C}_{f\ }C}_{sf}{\ C}_{d\ }W\ \sqrt{2g}{\ H}^{Ex}
\tag{20}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q\)</span> = Flow over the weir (m<sup>3</sup>/s)<br />
</li>
<li><span class="math inline">\(C_{d}\)</span> = Weir coefficient<br />
</li>
<li><span class="math inline">\(C_{sf}\)</span> = Weir submergence factor<br />
</li>
<li><span class="math inline">\(C_{f}\)</span> = Weir calibration factor (default of 1.0 – refer to 1d_nwk “Height_or_WF” attribute)<br />
</li>
<li><span class="math inline">\(W\)</span> = Flow width (m)<br />
</li>
<li><span class="math inline">\(H\)</span> = Upstream water surface or energy depth relative to the weir invert (m) – see note 5 below<br />
</li>
<li><span class="math inline">\(Ex\)</span> = Weir flow equation exponent</li>
</ul>
<p>Notes</p>
<ol style="list-style-type: decimal">
<li>The default values for <em>C<sub>d</sub></em> are provided in Table <a href="#tab:tab-WeirFlows">32</a>, and
documented further below for weirs where <em>C<sub>d</sub></em> is
recalculated each timestep.<br />
</li>
<li>The approach taken for calculating the weir submergence factor
<span class="math inline">\(C_{sf}\)</span> each timestep is documented below.<br />
</li>
<li>The weir calibration factor, <em>C<sub>f</sub></em>, is by default 1.0 and
should only be changed should there be a good justification.<br />
</li>
<li>For weirs where the flow width (<em>W)</em> varies (e.g. a V-notch WV weir)
the formula for that weir takes into account the varying width.<br />
</li>
<li>Whether water surface depth or the energy level is used for <em>H</em>
depends on the <a href="#ecfStructureFlowLevels">Structure Flow Levels</a>
setting, which can be changed on a structure by structure case using
the E or H flag (see Table <a href="#tab:tab-LineTypesOptionalFlags">19</a>).<br />
</li>
<li>The default values for <em>Ex</em> are provided in Table <a href="#tab:tab-WeirFlows">32</a> .</li>
</ol>
<p>Table <a href="#tab:tab-WeirFlows">32</a> presents the weir coefficient <span class="math inline">\(C_{d}\)</span> and weir flow exponent <span class="math inline">\(Ex\)</span> used
for each weir. Some of these values are derived from dimensional forms
of the weir equations. Values other than the default values shown in Table <a href="#tab:tab-WeirFlows">32</a> may
be used by altering the attributes of the 1d_nwk layer. Refer to Table <a href="#tab:tab-WeirsAttributeDescriptions">33</a> for
further information.</p>
<p>Note that <em>C<sub>d</sub></em> for WO and WV weirs is recalculated every
timestep as described in the following sections. It is possible to
override this by specifying a non-zero positive value for the
“HConF_or_WC” attribute in the 1d_nwk layer. For WD weirs the user must
specify a non-zero positive value.</p>
<table>
<caption>
<span id="tab:tab-WeirFlows">Table 32: </span><strong>Default Attribute Values for the Weir Equation for Different Weir Flows</strong>
</caption>
<thead>
<tr>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Channel Type
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
<p>Cd</p>
(HConF_or_WC)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
<p>Ex</p>
(WConF_or_WEx)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
<p>a</p>
(EntryC_or_WSa)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
<p>b</p>
(ExitC_or_WSb)
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
<p>Default Submergence Curve</p>
(Figure <a href="#fig:fig-image26">31</a> and Figure <a href="#fig:fig-image26">31</a>)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
SP
</td>
<td style="text-align:center;">
0.75
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
6.992
</td>
<td style="text-align:center;">
0.648
</td>
<td style="text-align:left;">
Ogee / Nappe <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>; <a href="#ref-USBR1987">USBR, 1987</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WB
</td>
<td style="text-align:center;">
0.577 
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
8.550
</td>
<td style="text-align:center;">
0.556
</td>
<td style="text-align:left;">
Broad-crested from Abou Seida &amp; Quarashi, 1976 <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WC
</td>
<td style="text-align:center;">
0.508 
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
17.870
</td>
<td style="text-align:center;">
0.590
</td>
<td style="text-align:left;">
Crump H1/Hb=1.5 <span class="citation">(<a href="#ref-Bos1989">Bos, 1989</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WD
</td>
<td style="text-align:center;">
User Defined
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
3.000
</td>
<td style="text-align:center;">
0.500
</td>
<td style="text-align:left;">
User Defined default settings
</td>
</tr>
<tr>
<td style="text-align:center;">
WO
</td>
<td style="text-align:center;">
Recalculated every timestep
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
6.992
</td>
<td style="text-align:center;">
0.648
</td>
<td style="text-align:left;">
Ogee / Nappe <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>; <a href="#ref-USBR1987">USBR, 1987</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WR
</td>
<td style="text-align:center;">
0.62
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
2.205
</td>
<td style="text-align:center;">
0.483
</td>
<td style="text-align:left;">
Sharp Crest Thin Plate from Hagar, 1987a <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WT
</td>
<td style="text-align:center;">
0.63
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
2.205
</td>
<td style="text-align:center;">
0.483
</td>
<td style="text-align:left;">
Sharp Crest Thin Plate from Hagar, 1987a <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WV
</td>
<td style="text-align:center;">
Recalculated every timestep
</td>
<td style="text-align:center;">
2.5
</td>
<td style="text-align:center;">
2.205
</td>
<td style="text-align:center;">
0.483
</td>
<td style="text-align:left;">
Sharp Crest Thin Plate from Hagar, 1987a <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>)</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
WW
</td>
<td style="text-align:center;">
0.542 
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
21.150
</td>
<td style="text-align:center;">
0.627
</td>
<td style="text-align:left;">
Bradley 1978 Broad-crested <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span>
</td>
</tr>
</tbody>
</table>
<h5 class="hasAnchor" id="WO-Weir-5"><span class="header-section-number">5.8.4.3.1</span> Ogee Crest Weir (WO)<a href="#WO-Weir-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For WO (Ogee crest) weirs, the charts developed in <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span> are used by fitting the relationship presented and plotted on the USBR curve below (Figure <a href="#fig:fig-image24">29</a>). The relationship falls within ±0.5% of the curve. Note that the relationship below is for US Customary Units, which is converted to metric if running the simulation in metric units. The <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span> method consists of two steps:</p>
<ul>
<li>The ogee crest coefficient <span class="math inline">\(C_{0}\)</span> (i.e. the discharge coefficient when the actual upstream head <span class="math inline">\(H_{e}\)</span> = design head <span class="math inline">\(H_{0}\)</span>) is set based on <span class="math inline">\(H_{0}\)</span> and the height of the weir above its sill (<span class="math inline">\(P\)</span>) as per Figure 9-23 of <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>. Note that for setting the value of <span class="math inline">\(P\)</span> the absolute difference in height between the US_Invert and DS_Invert attributes is used.</li>
</ul>
<center>
<img src="images/image23.png"
style="width:3.82292in;height:2.77774in" />
</center>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image24"></span>
<img src="images/image24.png" alt="**Ogee Spillway Discharge Coefficient, based on Figure 9-23 [@USBR1987]**" width="60%" />
<p class="caption">
Figure 29: <strong>Ogee Spillway Discharge Coefficient, based on Figure 9-23 <span class="citation">(<a href="#ref-USBR1987">USBR, 1987</a>)</span></strong>
</p>
</div>
</center>
<ul>
<li>When the actual head (<span class="math inline">\(H_{e}\)</span>) is different from the design head (<span class="math inline">\(H_{0}\)</span>) during the simulation, the discharge coefficient differs from that shown on Figure <a href="#fig:fig-image24">29</a>. At each simulation timestep, the discharge coefficient is adjusted based on <span class="math inline">\(H_{e}\)</span>/<span class="math inline">\(H_{0}\)</span> as per the chart below. The final discharge coefficient applied is <span class="math inline">\(C_{0}\)</span> × <span class="math inline">\(C\)</span>/<span class="math inline">\(C_{0}\)</span> in this chart.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SmallDams2"></span>
<img src="images/SmallDams2.png" alt="**Adjustment of Discharge Coefficient based on $H_{e}$/$H_{0}$, Figure 9-24 [@USBR1987]**" width="60%" />
<p class="caption">
Figure 30: <strong>Adjustment of Discharge Coefficient based on <span class="math inline">\(H_{e}\)</span>/<span class="math inline">\(H_{0}\)</span>, Figure 9-24 <span class="citation">(<a href="#ref-USBR1987">USBR, 1987</a>)</span></strong>
</p>
</div>
<p>Three options to calculate the final discharge coefficient are offered based on the input value of the 1d_nwk HConF_or_WC attribute:</p>
<ul>
<li>If the discharge coefficient has already been obtained by hand calculation, a positive HConF_or_WC value can be used to apply a constant discharge coefficient, i.e. <span class="math inline">\(C\)</span> = <span class="math inline">\(C_{0}\)</span> = HConF_or_WC.</li>
<li>If the design head (<span class="math inline">\(H_0\)</span>) is known for an ogee crest weir, a negative HConF_or_WC value can be used to specify <span class="math inline">\(H_0\)</span>. The two-step <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span> method stated above will be applied to estimate the final discharge coefficient. Note this option is only available in the 2023-03-AB build or later.</li>
<li>If HConF_or_WC is zero (0) or left as blank (the default), the actual head <span class="math inline">\(H_e\)</span> at each simulation timestep will be used to estimate <span class="math inline">\(C\)</span> from Figure 9-23 of <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>, with no further adjustment based on Figure 9-24 of <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>. This approach should be used when the design head (<span class="math inline">\(H_0\)</span>) is unknown.</li>
</ul>
<h5 class="hasAnchor" id="WV-Weir-5"><span class="header-section-number">5.8.4.3.2</span> V-Notch Weir (WV)<a href="#WV-Weir-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For WV (V-notch) weirs, the approach taken is to use the formulae derived by <a href="https://www.lmnoeng.com/Weirs/vweir.php">LMNO Engineering</a> as shown below. For metric models the flow is calculated in
ft<sup>3</sup>/s and converted to m<sup>3</sup>/s. The top height of a V-notch weir cannot be specified, the angle continues with the increasing water level.</p>
<center>
<img src="images/image25.png"
style="width:6.29931in;height:3.73542in" />
</center>
<h4 class="hasAnchor" id="Submerge-4"><span class="header-section-number">5.8.4.4</span> Advanced Weir Submergence Curves<a href="#Submerge-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Weir submergence factors <span class="math inline">\(C_{sf}\)</span> were sought from two sources:
“Discharge Characteristics” <span class="citation">(<a href="#ref-IAHRManual1994">Miller, 1994</a>)</span> and “Discharge Measurement
Structures” <span class="citation">(<a href="#ref-Bos1989">Bos, 1989</a>)</span>. The submergence charts for each weir type,
relating the weir submergence factor to the ratio between downstream and
upstream water level were reproduced from the literature in Excel and
are shown in Figure <a href="#fig:fig-image27">32</a>.</p>
<p>Two methods were utilised to fit equations to these curves. These are:</p>
<p>The Rational Function expressed as:</p>
<p><span class="math display" id="eq:equ-rational">\[\begin{equation}
C_{sf} = \frac{a + b\left( \frac{H_{d}}{H_{u}} \right)}{1 + c\left( \frac{H_{d}}{H_{u}} \right)\  + \ d\left( \frac{H_{d}}{H_{u}} \right)^{2}}
\tag{21}
\end{equation}\]</span></p>
<p>The Villemonte equation, expressed as:</p>
<p><span class="math display" id="eq:equ-villemonte">\[\begin{equation}
C_{sf} = \left( 1 - \ \left( \frac{H_{d}}{H_{u}} \right)^{a} \right)^{b}
\tag{22}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(H_{u}\)</span> = Upstream energy or water level above the weir crest (m or ft)<br />
</li>
<li><span class="math inline">\(H_{d}\)</span> = Downstream energy or water level above the weir crest (m or ft)<br />
</li>
<li><span class="math inline">\(a, b\)</span> = Model coefficients</li>
</ul>
<p>“Discharge Measurement Structures” <span class="citation">(<a href="#ref-Bos1989">Bos, 1989</a>)</span> applies upstream energy and downstream water level to calculate <span class="math inline">\(C_{sf}\)</span>. This can be specified globally using the <tcmd><a href="#tcfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>ENERGY UPSTREAM</tblk> command (the default option is “ENERGY”, which uses energy level both upstream and downstream). It can also be changed for individual weirs using the “EH” flag in the 1d_nwk “Type” attribute, e.g. “WB EH”.</p>
<p>For each submergence curve, the above equations were solved to obtain
values for each of the variables that produced the best fit with the
curves provided in the literature. After a comparison of the results,
the equation from Villemonte was chosen for several reasons:</p>
<ul>
<li>The Rational Function was found to be sensitive to variables and
therefore required a greater number of decimal places. Villemonte was
found to provide accurate results with variables requiring only 2
decimal places.<br />
</li>
<li>The Villemonte equation contains only two variables, compared to four
used in the Rational Function, making it simpler and less susceptible
to error.<br />
</li>
<li>The Villemonte equation may be solved exactly at the extremities of
the curves (i.e. where <span class="math inline">\(\frac{H_{d}}{H_{u}} = \ 1\)</span> and <span class="math inline">\(C_{sf} = 0\)</span>,
and when <span class="math inline">\(\frac{H_{d}}{H_{u}}\)</span> = 0 and <span class="math inline">\(C_{sf} = 1\)</span>). The Rational
Function required further manipulation through inclusion of additional
points to achieve this outcome.</li>
</ul>
<p>The default variables <em>a</em> and <em>b</em> used to determine the submergence
factor <span class="math inline">\(C_{sf}\)</span> for each weir type are presented in Table <a href="#tab:tab-WeirFlows">32</a>. Figure <a href="#fig:fig-image27">32</a> shows the
submergence curves produced using the default values in Table <a href="#tab:tab-WeirFlows">32</a> to
calculate <span class="math inline">\({\ C}_{sf}\)</span>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image26"></span>
<img src="images/image26.jpeg" alt="**Weir Submergence Curves from the Literature**" width="80%" />
<p class="caption">
Figure 31: <strong>Weir Submergence Curves from the Literature</strong>
</p>
</div>
</center>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image27"></span>
<img src="images/image27.jpeg" alt="**Weir Submergence Curves using Villemonte Equation**" width="80%" />
<p class="caption">
Figure 32: <strong>Weir Submergence Curves using Villemonte Equation</strong>
</p>
</div>
</center>
<table>
<caption>
<span id="tab:tab-WeirsAttributeDescriptions">Table 33: </span><strong>Weirs: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas, and cannot be blank. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
The weir channel type as specified using the flags in Table <a href="#tab:tab-LineTypes">18</a> and <a href="#tab:tab-WeirTypes">31</a>. For example, a V-notch weir would be entered as “WV”.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes).
</td>
<td style="text-align:left;">
If left blank or set to Yes (“Y” or “y”) or True (“T” or “t”), the storage based on the width of the channel over half the channel length is assigned to both of the two nodes connected to the channel. If set to No (“N” or “n”) or False (“F” or “f”), the channel width does not contribute to the node’s storage. See Section <a href="#AutoStorageWidths-4"><strong>??</strong></a> for further discussion.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
Only used in determining nodal storages if the UCS attribute is set to “Y” or “T”. Not used in conveyance calculations.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
<p><b>All Weir (excluding WO) Channel Types: </b><br />
Sets the weir invert. Note that the invert is taken as the maximum of the US_Invert and the DS_Invert attributes. For W and WW weirs use -99999 to use the bed of the cross-section (if one exists) as the invert or weir crest.</p>
<b>WO Channel Type: </b><br />
The absolute difference in height between the US_Invert and DS_Invert is used to set the height of the weir above its sill (usually denoted as P), which is used for recalculating the weir’s discharge coefficient each timestep. If the US_Invert and DS_Invert are the same value the primary upstream channel bed will be used to set the value of P.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
See comments above for US_Invert.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
<p><b>W Channel Type: </b><br />
Not used. Reserved for future builds to fully or partially block W channels. The 1d_xs Skew attribute can be used to partially block cross-sections of these channels - see Table <a href="#tab:tab-CrossAttributeDescriptions">21</a>.</p>
<p><b>WB, WC, WD, WO, WR, and WS Channel Type: </b><br />
The weir width is adjusted proportionally by the % blockage.</p>
<p><b>WT Channel Type: </b><br />
The base width of the weir is adjusted proportionally by the % blockage.</p>
<b>WV Channel Type: </b><br />
The V-notch angle is adjusted proportionally by the % blockage.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
Leave blank unless using the legacy MIKE 11 1D cross-section data feature.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Leave blank unless using the legacy MIKE 11 1D cross-section data feature, or if accessing a Flood Modeller cross-section database (.pro file), enter the label in the .pro file.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Leave blank unless using the legacy MIKE 11 1D cross-section data feature.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
<p><b>All Weir (excluding WT and WV) Channel Types: </b><br />
The weir width in metres. The maximum of US_Invert and DS_Invert is used in conjunction with the Width_or_Dia attribute to define a rectangular section 5m (16.4ft) high. The automatic height given to the weir of 5m (16.4ft) so that the generation of node storage areas from channel widths are within a realistic range of elevations. Use <a href="#ecfDepthLimitFactor">Depth Limit Factor</a> to allow water levels to exceed the 5m (16.4ft) range if required.</p>
<p>Note: For W and WW weirs if a cross-section for the channel exists, the cross-section profile will prevail over the automatic rectangular shape.
Note: For operational weirs, the width of the weir when fully open.</p>
<p><b>WT Channel Type:</b><br />
The width at the base of the trapezoidal weir. WT weirs are Cippoletti weirs that have side slopes of 1 horizontal to 4 vertical.</p>
<b>WV Channel Type:</b><br />
Angle of the V-notch in degrees. Must be between 20º and 100º.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
<p><b>For non-operated weirs</b>, this value can be used as a weir coefficient adjustment factor to be primarily used for model calibration or sensitivity testing. The weir coefficient is multiplied by this value. The resulting weir coefficient can be viewed in the .eof file and over time in the _TSL GIS layer. If zero or negative an adjustment factor of 1.0 (i.e. no adjustment) is applied.</p>
<b>For operational weirs</b>, the height of the weir above the crest when fully up.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
<p><b>W Channel Type: </b><br />
Not used.</p>
<p><b>All Weir (excluding W) Channel Types:</b><br />
Weir coefficient, Cd, in its dimensionless form. If less than or equal to zero the default value for the weir type in Table <a href="#tab:tab-WeirFlows">32</a> is used.</p>
<p>Note that for WV weirs the default is to recalculate Cd every timestep. Entering a value greater than zero (0) will override this and apply a fixed Cd.</p>
<p>For WO weirs, the default is to recalculate Cd every timestep based on the actual head, while entering a value less than zero (0) will specify a design head for Cd calulation. Entering a value greater than zero (0) will apply a fixed Cd. Please see Section <a href="#WO-Weir-5"><strong>??</strong></a> for the detailed ogee crest weir approach.</p>
<p>For WD weirs the user must specify a non-zero positive value.</p>
Note that published weir coefficients may be based on other non-dimensional or dimensional forms of the weir equation, therefore care should be taken in ensuring the coefficient is compatible with the form of the weir flow equation presented in Section <a href="#Adv-Weir-4"><strong>??</strong></a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
<p><b>W Channel Type: </b><br />
Not used.</p>
<b>All Weir (excluding W) Channel Types:</b><br />
Weir flow equation exponent Ex in the weir flow equation presented in Section <a href="#Adv-Weir-4"><strong>??</strong></a>. If less than or equal to zero the default value for the weir type in Table <a href="#tab:tab-WeirFlows">32</a> is used. The default value is 1.5 for all weir types except for WV which is 2.5.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
<p><b>W Channel Type: </b><br />
Not used.</p>
<b>All Weir (excluding W) Channel Types: </b><br />
Sets the submergence factor “a” exponent in the Villemonte Equation for calculating the weir submergence factor Csf (refer to equations in Section <a href="#Adv-Weir-4"><strong>??</strong></a> and <a href="#Submerge-4"><strong>??</strong></a>). If less than or equal to zero the default value for the weir type in Table <a href="#tab:tab-WeirFlows">32</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
<p><b>W Channel Type: </b><br />
Not used.</p>
<b>All Weir (excluding W) Channel Types:</b><br />
Sets the submergence factor “b” exponent in the Villemonte Equation for calculating the weir submergence factor Csf (refer to equations in Section <a href="#Adv-Weir-4"><strong>??</strong></a> and <a href="#Submerge-4"><strong>??</strong></a>). If less than or equal to zero the default value for the weir type in Table <a href="#tab:tab-WeirFlows">32</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="Auto-Weir-4"><span class="header-section-number">5.8.4.5</span> Automatically Created Weirs<a href="#Auto-Weir-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Weirs representing overtopping of structures such as culverts and
bridges may be automatically created without the need to digitise a
separate line within a 1d_nwk layer. The structure must be
digitised within a 1d_nwke layer (as opposed to a 1d_nwk layer) and a
“W” specified alongside the original structure type. For example, to
model a bridge and a weir representing overtopping of the road deck,
specify type “BW”. The weir crest level and dimensions are specified
within the additional attributes contained within a 1d_nwke layer and
are explained in Table <a href="#tab:tab-OptionalAttributeDescriptions">34</a>. The original W weir approach is adopted for
calculating the flow (see Section <a href="#W-Weir-4"><strong>??</strong></a>).</p>
<p>The weir’s shape is assumed to be two rectangles on top of each other.
The lower rectangle is reduced in width according to the percent
blockage applied to the rail (i.e. the EN4 attribute in Table <a href="#tab:tab-OptionalAttributeDescriptions">34</a>), and its
height is the EN3 attribute. The upper rectangle is the full flow width
and extends indefinitely in the vertical.</p>
<p>Alternatively, the flow over a structure can be manually digitised as a
separate 1d_nwk weir channel parallel to the original bridge or culvert
structure (i.e. the weir is connected to the ends of the
bridge/culvert). Any of the available weir types can be used in this
instance.</p>
<table>
<caption>
<span id="tab:tab-OptionalAttributeDescriptions">Table 34: </span><strong>1D Model Network (1d_nwke) OPTIONAL Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:left;">
ES1
</td>
<td style="text-align:left;">
Not yet used (leave blank).
</td>
<td style="text-align:left;">
Char(50)
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:left;">
ES2
</td>
<td style="text-align:left;">
Not yet used (leave blank).
</td>
<td style="text-align:left;">
Char(50)
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
EN1
</td>
<td style="text-align:left;">
For BW, CW and RW channels, the flow width of weir (m) over the top of the B, C or R structure. If &lt; 0.001, uses width multiplied by the number of culverts attribute for C and R channels.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
EN2
</td>
<td style="text-align:left;">
For BW, CW and RW channels, the depth (m) of the bridge deck or culvert overlay.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
EN3
</td>
<td style="text-align:left;">
For BW, CW and RW channels, the depth of the hand rail (m). If &lt; 0.001 assumes solid or no rail, depending on the EN4 attribute entry.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
EN4
</td>
<td style="text-align:left;">
For BW, CW and RW channels, % blockage of the rail (e.g. 100 for solid rail, 50 for partially blocked, 0 for no rail).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
EN5
</td>
<td style="text-align:left;">
For BW, CW and RW channels, the weir calibration factor. Is set to 1.0 if &lt; 0.001 is specified.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
EN6
</td>
<td style="text-align:left;">
Not yet used (leave as zero).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
EN7
</td>
<td style="text-align:left;">
Not yet used (leave as zero).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
EN8
</td>
<td style="text-align:left;">
Not yet used (leave as zero).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="VW-Channel-4"><span class="header-section-number">5.8.4.6</span> VW Channels (Variable Geometry Weir)<a href="#VW-Channel-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The VW (variable weir) channel allows the modeller to vary the
cross-section geometry of a W weir over time using a trapezoidal shape.
To set up a VW channel follow the steps below.</p>
<p>In the 1d_nwk layer, the following attributes are required:</p>
<ul>
<li>ID = ID of the channel;<br />
</li>
<li>Type = “VW”;<br />
</li>
<li>Len_or_ANA = Nominal length in m (only used for calculating nodal
storage if UCS is on);<br />
</li>
<li>US_Invert = -99999 (the invert level is specified in the .csv file
discussed below);<br />
</li>
<li>DS_Invert = -99999 (the invert level is specified in the .csv file
discussed below);<br />
</li>
<li>Inlet_Type = relative path to a .csv file containing information on
how the weir geometry varies; and<br />
</li>
<li>Height_Cont = Trigger Value (the upstream water level to trigger the
start of the failure; upstream water level is determined as the higher
water level of the upstream and downstream nodes).</li>
</ul>
<p>The .csv file must be structured as follows (also see example below):</p>
<ol style="list-style-type: decimal">
<li>TUFLOW searches through the sheet until more than 4 numbers are
found at the beginning of a row (Row 2 in the example below).<br />
</li>
<li>Each row of values is read until the end of the file or a row with
no or less than four numbers is found. There is no limit on the
number of rows of data.<br />
</li>
<li>The four columns must be as follows and in this order. The labels
for the columns are optional.
<ol style="list-style-type: lower-roman">
<li>Time from start of breach in hours.<br />
</li>
<li>Weir bed level in metres.<br />
</li>
<li>Weir bed width in metres.<br />
</li>
<li>Side slope (enter as the vertical distance in metres for one
metre horizontal). For example, a value of 0.5 means a slope of
two horizontal to one vertical.</li>
</ol></li>
</ol>
<p>In the example below, the weir once triggered will erode from a bed level of 270m to 254m, widen from a bed width of 0 to 20m and the side slope will remain constant at 0.5. The period of time for the erosion is 0.5hours.</p>
<p>Although in most cases the weir is eroded, the weir can also be raised/accreted as well or a combination of the two. Simply enter the change over time using as many rows as needed.</p>
<p>The original W weir approach is adopted for calculating the flow (see Section <a href="#W-Weir-4"><strong>??</strong></a>).</p>
<center>
<img src="images/image28a.png" />
</center>
<h3 class="hasAnchor" id="SP-3"><span class="header-section-number">5.8.5</span> Spillways (SP)<a href="#SP-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Spillways (‘SP’) were introduced for the TUFLOW 2013-12 release and may
also be used in operational mode as a gated spillway (see
Section <a href="#OperationalChannels-2"><strong>??</strong></a>). Spillways may also be simulated and operated as Q
or QO channels where the user provides the stage discharge relationships
(see Section <a href="#Q-Channels-3"><strong>??</strong></a> and Section <a href="#QO-3"><strong>??</strong></a>). The 1d_nwk attributes are
presented in Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a>.</p>
<p>Spillways use the same equation as for advanced weirs
(Section <a href="#Adv-Weir-4"><strong>??</strong></a>). For ungated spillways (i.e. SP, non-operated
spillways) the same parameters as for Ogee Weirs are the default (see Table <a href="#tab:tab-WeirFlows">32</a>),
except for Cd, which is fixed with the default value of 0.75. For Ogee
Weirs, C<sub>d</sub> is recalculated every timestep (see
Section <a href="#WO-Weir-5"><strong>??</strong></a>). The 1d_nwk attributes in Table <a href="#tab:tab-WeirFlows">32</a> can be used to
modify the flow equation parameters for SP channels in a similar manner
for advanced weirs.</p>
<p>SPO channels also use the same equation when the gate is not affecting
the flow (for more information on SPO channels refer to Section <a href="#SPO-3"><strong>??</strong></a>).</p>
<p>SP and SPO channels can also drown out as per the submergence curves for
advanced weirs.</p>
<h3 class="hasAnchor" id="SG-3"><span class="header-section-number">5.8.6</span> Sluice Gates (SG)<a href="#SG-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For sluice gates refer to Section <a href="#SG-SGO-3"><strong>??</strong></a>. The same approach applies as for SGO
operated gates, except that the gate is assumed to be in a fixed
position based on the 1d_nwk Height_or_WF attribute value. The 1d_nwk
attributes are presented in Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a>.</p>
<h3 class="hasAnchor" id="LossAdjustment-3"><span class="header-section-number">5.8.7</span> Adjustment of Contraction and Expansion Losses<a href="#LossAdjustment-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The energy losses associated with the contraction and expansion of flow
lines into and out of a structure, can be automatically adjusted
according to the approach and departure velocities in the upstream and
downstream channels. This is particularly important where:</p>
<ul>
<li>There is no change in velocity magnitude and direction as water flows
through a structure. In this situation, there is effectively no
entrance (contraction) or exit (expansion) losses and the losses need
to be reduced to zero. Examples are:
<ul>
<li>A clear spanning bridge over a stormwater channel where there are no
losses due to any obstruction to flow until the bridge deck becomes
surcharged.<br />
</li>
<li>Flow from one pipe to another where the pipe size remains unchanged
and there is no significant bend or change in grade.<br />
</li>
</ul></li>
<li>There is a change in velocity, but the change does not warrant
application of the full entrance and exit loss. This is the most
common case where the application of the full entrance and exit loss
coefficients (typically 0.5 and 1.0) will overestimate the energy loss
through the structure. The full values are only representative of the
situation where the approach and departure velocities are close to
zero, for example, a culvert discharging from a lake into another lake
where the velocity transitions from still water to fast flowing and to
still water.</li>
</ul>
<p>The entrance and exit losses are adjusted according to the equations
below to take into account the change in velocity caused by the
structure. The first equation is empirical, while the second equation to
adjust exit losses can be derived from first principles.</p>
<p><span class="math display" id="eq:equ-Entrance-1">\[\begin{equation}
\text{C}_{\text{entrance_adjusted}} = \text{C}_{\text{entrance}}\left\lbrack 1 - \frac{\text{V}_{\text{approach}}}{\text{V}_{\text{structure}}} \right\rbrack
\tag{23}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-Exit-1">\[\begin{equation}
\text{C}_{\text{exit_adjusted}} = \text{C}_{\text{exit}}\left\lbrack 1 - \frac{\text{V}_{\text{departure}}}{\text{V}_{\text{structure}}} \right\rbrack^{2}
\tag{24}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><em>V =</em> Velocity (<em>m/s</em>)<br />
</li>
<li><em>C =</em> Energy Loss Coefficient</li>
</ul>
<p>As the structure velocity approaches the incoming and/or outgoing
velocities, the loss coefficient approaches zero. When the
incoming and/or outgoing velocity approaches zero (i.e. water is
leaving/entering a large body of water), the loss coefficients approach
their full value.</p>
<p><span class="citation">Tullis &amp; Robinson (<a href="#ref-TullisRobinson2008">2008</a>)</span> provide an excellent proof for the need to
adjust losses for different flow regimes using the exit loss equation
above. The paper benchmarks different exit loss equations used within
the industry methods against experimental flume test results.</p>
<p>The adjustment of losses feature is available to structures that require
entrance and exit loss coefficients, namely culverts and bridges. For
culverts, the adjusted entrance loss coefficient only applies where the
flow is not inlet controlled (i.e. Regimes C, D, E, F, H and J in Table <a href="#tab:tab-FlowRegimes">23</a>), and the adjusted exit loss is only influential where the flow is downstream
controlled (i.e. Regimes D, F, H and J (subcritical at exit) in Table <a href="#tab:tab-FlowRegimes">23</a>). For
bridges, the application varies as discussed below.</p>
<p>If <tcmd><a href="#ecfStructureLosses">Structure Losses</a></tcmd><teq> == </teq><tblk>ADJUST EXCEPT BG TABLES</tblk>
(default), the adjustment of the losses is only applied to culverts and
B bridges with automatically generated loss tables using the 1d_nwk
Form_Loss attribute (see Table <a href="#tab:tab-BridgesAttributeDescriptions">27</a>). There is no adjustment for B
bridges with a user specified BG or LC energy loss table, because bridge
energy losses are most often based on coefficients from publications
such as “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or “Guide to
Bridge Technology Part 8, Hydraulic Design of Waterway Structures”
<span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span> that have already taken into account the effects of
contraction and expansion.</p>
<p>For BB bridges, the LC table should only
represent the pier and submerged deck losses (see Section <a href="#Submerge-4"><strong>??</strong></a>),
as the adjustment of entrance and exit losses every timestep as per the
equations above is always applied irrespective of the <a href="#ecfStructureLosses">Structure
Losses</a> setting. The equations above conform with
the approach for determining contraction and expansion losses in
publications such as Hydraulics of Bridge Waterways.</p>
<p>For B bridges and culverts, if <a href="#ecfStructureLosses">Structure Losses</a>
is set to “ADJUST”, or “A” has been specified in the 1d_nwk Type
attribute (e.g. BA, CA, IA or RA), the entrance and exit losses are
adjusted according to the equations above. For B bridges, because the
entrance and exit losses are combined as one loss coefficient, the
entrance and exit loss components are proportioned one-third /
two-thirds respectively when applying the above equations. For the new
BB bridge, entrance and exit losses are always adjusted as per the
equations above and the <a href="#ecfStructureLosses">Structure Losses</a> setting
is not relevant (also see Section <a href="#Submerge-4"><strong>??</strong></a>).</p>
<p>The selection of the upstream and downstream channels on which to base
the approach and departure velocities is as follows:</p>
<ul>
<li>The upstream channel is determined as the channel which has a positive
flow direction into the structure whose invert is closest to that of
the upstream invert of the structure. If no channel exists, no
adjustment of losses is made (this includes structures connected to a
2D domain). Note that the upstream channel must be digitised so that
it has the same positive flow direction to that of the structure.<br />
</li>
<li>The downstream channel is selected on a similar basis to that for the
upstream channel.<br />
</li>
<li>The selected upstream and downstream channels are listed in the .eof
file for cross-checking (search for “Primary Channel”).<br />
</li>
<li>X channels can be used to connect additional channels and ensure that
these are not considered the primary channel.</li>
</ul>
<p>TUFLOW has no requirement of a minimum loss coefficient value for
stability, and therefore allows the adjusted coefficient to approach
zero allowing this feature to correctly model the structure losses when
the structure causes no disturbance to flow, or when one pipe discharges
into another of identical size, grade and alignment.</p>
<p>The adjustment of loss coefficients does not apply to:</p>
<ul>
<li>Any bend or additional loss for a culvert entered using the Form_Loss
attribute in the 1d_nwk layer. This coefficient can be used to apply
additional losses (e.g. pit or bend losses) that are not affected by
changes in the relativity of the approach/departure and structure
velocities.<br />
</li>
<li>Any additional loss coefficient component for BB bridges entered using
the Form_Loss attribute in the 1d_nwk layer. This coefficient can be
used to apply additional losses (e.g. pier losses) that are not
affected by changes in the relativity of the approach/departure and
structure velocities.<br />
</li>
<li>The ends of culverts and bridges that are connected to 2D SX or HX
cells as the approach or departure velocity needs to be derived in
some manner from the 2D velocity field. It is important not to be duplicating
energy losses by applying exit losses to a 1D structure and simulating
the same energy losses due to the flow expansion in the 2D domain –
for further information see the <a href="https://www.tuflow.com/library/webinars/#structures">Modelling Energy Losses at Structures AWS Webinar</a>.</li>
</ul>
<p>If <a href="#ecfStructureLosses">Structure Losses</a> is set to FIX, or “F” has
been specified in the 1d_nwk Type attribute (e.g. BF, CF, IF or RF), the
loss coefficients for B bridges and culverts are not adjusted. Fixing
the entrance and exit losses for BB bridges is not available – use a B
bridge instead.</p>
<p>The variation in time of the loss coefficients can be viewed using the
_TSL output layer (see Section <a href="#TS-GIS-3"><strong>??</strong></a>) or charted in the QGIS TUFLOW Viewer plugin.</p>
<p>If there is a manhole at the culvert end, a manhole energy loss approach
(see Section <a href="#Manholes-3"><strong>??</strong></a>) is used instead of the culvert’s
contraction/expansion loss, and the above description does not apply.</p>
<h2 class="hasAnchor" id="Special-Channels-2"><span class="header-section-number">5.9</span> Special Channels<a href="#Special-Channels-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="M-Channel-3"><span class="header-section-number">5.9.1</span> M Channels (User Defined Flow Matrix)<a href="#M-Channel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>M channels allow the modeller to define the flow through a channel
(usually a structure) based on a user specified flow matrix. To set up M
channels follow the steps below:</p>
<ol style="list-style-type: decimal">
<li>In the 1d_nwk layer, populate the required attributes as shown in Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a><br />
</li>
<li>Create the flow matrix as shown in the image below and save the
file as a .csv. The .csv file is referenced in
the 1d_nwk Inlet_Type attribute. Notes using the example in the
below image are:
<ol style="list-style-type: decimal">
<li>TUFLOW searches through the sheet until more than 3 numbers are
found at the beginning of a row (Row 3 in the example).<br />
</li>
<li>This first row contains a multiplication factor (in Cell A3)
followed by upstream depth values (in the direction that the
channel is digitised). The depth values are added to the channel
invert to set the water level.<br />
</li>
<li>The next rows have the downstream depth in Column A. Flows are
listed in the adjacent columns relating to the above upstream
depth value (Row 3).<br />
</li>
<li>Note: at present the matrix must be square and that the u/s and
d/s depths must be the same values. The flows along the diagonal
must be zero, and to the left of the diagonal negative (or zero)
and to the right positive (or zero).<br />
</li>
</ol></li>
<li>Optionally create a flow area matrix of the same dimensions and
depth values as for the flow matrix. Note:
<ol style="list-style-type: decimal">
<li>The path to the area.csv file is specified after the flow.csv
file in the Inlet_Type attribute (separate the two filenames
using a “|”; eg. “..\UD_Q.csv | ..\UD_A.csv”).<br />
</li>
<li>The factor value in the A3 cell is not used in the flow area
matrix (the value in the flow matrix is used to factor
the areas).<br />
</li>
<li>The area values are only used for outputting the channel
velocity (they are not used for the hydraulic computations other
than when the channel velocity is used for other channels, eg.
adjusting structure losses).<br />
</li>
<li>If an area matrix is not provided, TUFLOW will calculate the
area based on the channel width multiplied by the pBlockage and
the average of the upstream and downstream depths.</li>
</ol></li>
</ol>
<center>
<img src="images/image29a.png" />
</center>
<h3 class="hasAnchor" id="Q-Channels-3"><span class="header-section-number">5.9.2</span> Q Channels (Upstream Depth-Discharge Relationship)<a href="#Q-Channels-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Q channels are used to model flow through a channel using an .ecf <a href="#ecfDepthDischargeDatabase">Depth
Discharge Database</a>. The Depth Discharge
Database is the same as the <a href="#ecfPitInletDatabase">Pit Inlet Database</a>
used for Q pits, with the same database used for both Q channels and Q
pits. Refer to Section <a href="#DD-Database-3"><strong>??</strong></a>.</p>
<p>In the 1d_nwk layer, the following attributes can be used to set up a Q
channel (also see Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a>).</p>
<ul>
<li>ID = Unique Channel ID.<br />
</li>
<li>Type = “Q”.<br />
</li>
<li>US_Invert = Elevation corresponding to zero depth in the
depth-discharge curve.<br />
</li>
<li>Inlet_Type = The depth discharge curve in the <a href="#ecfDepthDischargeDatabase">Depth Discharge
Database</a> or <a href="#ecfPitInletDatabase">Pit Inlet
Database</a>. This is analogous to a Q pit (see
Section <a href="#DD-Database-3"><strong>??</strong></a>). Note that the flow is automatically adjusted for
being drowned out using the Bradley relationship for weirs (see
Section <a href="#W-Weir-4"><strong>??</strong></a> or Figure <a href="#fig:fig-image22">28</a>), and if the flow reverses the same
depth discharge curve is used.<br />
</li>
<li>Width_or_Dia = For Q channels can be used as a flow multiplier – this
is useful if the depth-discharge curve is a unit flow (i.e. flow per
unit width). Therefore, if the discharge is unit flow specify the
width of the flow, otherwise specify a value of 1.0 (noting that a
zero value is treated as 1.0).<br />
</li>
<li>Number_of = The number of parallel Q channels (a zero value is
interpreted as one channel).</li>
</ul>
<h3 class="hasAnchor" id="XConnect-3"><span class="header-section-number">5.9.3</span> X Connectors<a href="#XConnect-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>X connectors are used for connecting a side tributary or pipe into the
main flow path. They are digitised as a line within a 1d_nwk
GIS layer with type “X”. No other attributes are required.</p>
<p>Use of an X connector has the advantage of allowing different end
cross-sections (see Section <a href="#XS-End-3"><strong>??</strong></a>) or WLLs (see Section
<a href="#OneDMap-3"><strong>??</strong></a>) to be specified for the side channel, rather than using the
end cross-section on the main channel.</p>
<p>They can also be used in pipe
networks to ensure that the angle of the inlet and outlet culverts has
been digitised appropriately as this influences the manhole losses
calculated when using the Engelund loss approach (see
Section <a href="#Engelund-4"><strong>??</strong></a>). The angle of the pipe channel line is used for determining manhole losses, not that of the X connector.</p>
<p>The direction of the X Connector must be digitised starting from the
side channel and ending at the main channel. If two or more connectors
are used at the same location (i.e. to connect two or more side channels
to a main channel) their ends must all snap to the same main channel.</p>
<h3 class="hasAnchor" id="Legacy-Channel-3"><span class="header-section-number">5.9.4</span> Legacy Channels<a href="#Legacy-Channel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For backwards compatibility, gradient (type ‘G’) and normal (type
‘blank’) channels remain supported in the current release of TUFLOW.
Sloping (type ‘S’) open channels are the preferred method of modelling
open channels as it incorporates the flow regimes covered by normal and
G channels and include the additional ability of handling super-critical
flow. Refer to Section <a href="#Open-Channel-2"><strong>??</strong></a> for further information.</p>
<p>A normal flow channel is defined by its length, bed resistance and
hydraulic properties. The channel can wet and dry, however, for overbank
areas (e.g. tidal flats or floodplains) G or S channels should be used.
<strong>Note: For open channels it is recommended to use the S Type
for the reasons given above.</strong></p>
<p>Gradient channels were designed for overbank areas such as tidal
flats and floodplains. The upstream and downstream bed invert attributes
must be specified to define the slope of the channel. They are like
normal channels, except when the water level at one end of the channel
falls below the channel bed, the channel invokes a free-overfall
algorithm that keeps water flowing without using negative depths. The
algorithm takes into account both the channel’s bed resistance and
upstream controlled weir flow at the downstream end.
<strong>Note: For overbank areas it is recommended to use the S Type
for the reasons given above.</strong></p>
<h3 class="hasAnchor" id="OneD-nwk-3"><span class="header-section-number">5.9.5</span> 1d_nwk Attributes (M, P, Q, SG, SP Channels)<a href="#OneD-nwk-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The table below covers the 1d_nwk attributes for all channels not
covered in other 1d_nwk attribute tables.</p>
<table>
<caption>
<span id="tab:tab-SpecialAttributeDescriptions">Table 35: </span><strong>Special Channels: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas and cannot be blank. As a rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>The channel type as specified using the flags in Table <a href="#tab:tab-LineTypes">18</a>.</p>
For X (connectors), no other attributes are required.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes).
</td>
<td style="text-align:left;">
<p><b>M, P, Q Channel Type:</b><br />
Not used.</p>
<b>SG, SP Channel Type:</b><br />
If left blank or set to Yes (“Y” or “y”) or True (“T” or “t”), the storage based on the width of the channel over half the channel length is assigned to both of the two nodes connected to the channel. If set to No (“N” or “n”) or False (“F” or “f”), the channel width does not contribute to the node’s storage. See Section <a href="#AutoStorageWidths-4"><strong>??</strong></a> for further discussion.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
<p><b>M, P, Q Channel Type:</b><br />
Not used.</p>
<b>SG, SP Channel Type:</b><br />
Only used in determining nodal storages if the UCS attribute is set to “Y” or “T”. Not used in conveyance calculations.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_ nF_Cd
</td>
<td style="text-align:left;">
<p><b>M, P, Q Channel Type: </b><br />
Not used.</p>
<b>SG, SP Channel Type: </b><br />
Discharge coefficient for the structure if using a fixed coefficient. If the value is less than or equal to zero, the default Cd value of 0.6 for SG and 0.75 for SP is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
<p><b>M Channel Type:</b><br />
Invert level of channel.</p>
<p><b>P Channel Type:</b><br />
Intake elevation of the pump.</p>
<p><b>Q Channel Type: </b>
US_Invert sets the level from which the upstream depth is to be calculated for interpolation into the depth-discharge curve.</p>
<p><b>SG Channel Type: </b><br />
The higher of US_Invert and DS_Invert is used to set the structure crest or invert.</p>
<b>SP Channel Type:</b><br />
Sets the spillway crest
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
<p><b>M Channel Type: </b><br />
Invert level of channel is taken as the maximum of US_Invert and DS_Invert.</p>
<p><b>P Channel Type:</b><br />
Outlet elevation of the receptor.</p>
<p><b>Q Channel Type: </b><br />
Not used.</p>
<p><b>SG Channel Type: </b><br />
See comments above for US_Invert.</p>
<b>SP Channel Type: </b><br />
Sets the level of the gate seat (if SP is operated, i.e. a SPO channel).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
<p><b>M, P, Q, SP Channel Type: </b><br />
Not used.</p>
<b>SG Channel Type: </b><br />
If no weir is specified in the Type attribute, it is assumed that the gate seats on to the bottom of the channel. For this case the flow calculations where the gate is not surcharged uses the Form_Loss attribute to apply an energy loss to the structure to represent contraction/expansion losses.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
<p><b>Q Channel Type:</b><br />
Not used.</p>
<p><b>M Channel Type:</b><br />
Percentage blockage of channel (only used if no flow area matrix is provided). Refer to Inlet_Type attribute below.</p>
<b>P, SG, SP Channel Type: </b><br />
The channel’s dimensions and flow capacity are reduced as per the pBlockage value.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
<p><b>M Channel Type: </b><br />
The relative path to the flow matrix file (must be a .csv file), and optionally flow area matrix file. See Section <a href="#M-Channel-3"><strong>??</strong></a>.</p>
<p><b>P, SG, SP Channel Type: </b><br />
Only used for operational versions of these channels (i.e. type “PO”, “RGO”, SGO” or “SPO”) to specify the name of the <control_id>. The <control_id> is referenced within the .toc file and specifies the rules used to operate the channel. More than one channel can point to the same <control_id>. Refer to Section <a href="#M-Channel-3"><strong>??</strong></a>.</p>
<p><b>Q Channel Type (for QO see further below): </b><br />
For non-operated Q channels the name of the depth-discharge curve in a depth discharge database (identical approach to inlet Q pits). A Q channel is distinguished from a Q pit, in that a Q channel is a line in the 1d_nwk layer and a Q pit is a point object. A depth-discharge database is the same as a pit inlet database as used for Q pits, and the same database file can be used for both Q channels and Q pits. The .ecf command <a href="#ecfDepthDischargeDatabase">Depth Discharge Database</a> and the existing command <a href="#ecfPitInletDatabase">Pit Inlet Database</a> perform the same function.<br />
Note that the depth discharge curve is depth (not water elevation) and the depth is taken as the upstream water level less the Q channel’s invert.</p>
<b>QO Channel Type: </b><br />
For operated Q channels the filename of a .csv file containing a flow matrix table in the same format as used for M channels. See Section <a href="#M-Channel-3"><strong>??</strong></a>. </control_id></control_id></control_id>
</td>
<td style="text-align:left;">
Char<br />
(max 256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
<p><b>P Channel Type: </b><br />
The diameter of the pump offtake. Only used for outputting a velocity - it does not affect the hydraulic calculations.</p>
<p><b>M Channel Type: </b><br />
Width of channel (only used if no flow area matrix is provided). Refer to Inlet_Type attribute above.</p>
<p><b>Q Channel Type (for QO see further below):</b><br />
A multiplier applied to the flow interpolated from the depth-discharge curve. Particularly useful if the discharge values are per unit width (i.e. m<sup>2</sup>/s or ft<sup>2</sup>/s). If set to zero (0), the multiplier is set to one (1).</p>
<p><b>QO Channel Type:</b><br />
Used to determine the flow area at different stages by multiplying by the upstream depth. The area is used to determine the velocity that is output, otherwise, it does not play a role in the hydraulic calculations.</p>
<b>SG, SP Channel Type:</b><br />
The width of the gate/spillway. The flow area is assumed to be rectangular in shape.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
<p><b>M, Q Channel Type: </b><br />
Not used.</p>
<p><b>P Channel Type: </b><br />
Can be used to set the pump flow capacity for operated pumps (i.e. a PO channel). The pump capacity can also be set and changed during the simulation using the .toc file operating control commands. Useful where the operating control definition is generic (i.e. pump control is used for more than one pump of different flow capacities).</p>
<p><b>SG Channel Type: </b><br />
The vertical height of the gate in its fully open position. If an underlying weir is specified, the weir is assigned a coefficient adjustment factor of 1.0, which cannot be modified using this attribute.</p>
<b>SPO Channel Type: </b><br />
For an operated (gated) spillway (SPO), sets the vertical height of the gate in its fully open position. The fully open height can also be changed during the simulation using the .toc file operating control commands. This is useful where the operating control definition is generic (i.e. non-structure specific). Not used if channel is non-operational (i.e. a SP channel).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
<p><b>P, SG, SP Channel Type: </b><br />
The number of parallel (duplicate) channels. If set to zero, one channel is assumed.</p>
<b>M, Q Channel Type:</b><br />
Number of parallel channels (flow and area matrices are multiplied by this value). If zero is set to one.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
<p><b>M, Q Channel Type:</b><br />
Not used.</p>
<p><b>SP Channel Type:</b><br />
Weir flow coefficient, Cd, in its dimensionless form as in the equation below. If less than or equal to zero the default value for spillways in Table <a href="#tab:tab-WeirFlows">32</a> is used. Entering a value greater than zero (0) will override this and apply a fixed Cd.<br />
Note that published coefficients may be based on other non-dimensional or dimensional forms of the equation below, therefore care should be taken in ensuring the coefficient is converted to comply with the form below if this is the case.</p>
<p><span class="math display">\[Q = \frac{2}{3}\:C_{sf}\:C_{d}\:B\:\sqrt{2g}\:H^{Ex}\]</span></p>
<b>SG Channel Type:</b><br />
As for the weir channel in Table <a href="#tab:tab-WeirsAttributeDescriptions">33</a> if a weir has been specified (e.g. a “SG WB” channel).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
<p><b>M, Q Channel Type:</b><br />
Not used.</p>
<p><b>SP Channel Type:</b><br />
Weir flow equation exponent Ex in the equation for HConF_or_WC. If less than or equal to zero the default value for spillways in Table <a href="#tab:tab-WeirFlows">32</a> is used (i.e. 1.5).</p>
<b>SG Channel Type:</b><br />
As for the weir channel in Table <a href="#tab:tab-WeirsAttributeDescriptions">33</a> if a weir has been specified (e.g. a “SG WB” channel).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
<p><b>M, Q, SPO Channel Type:</b><br />
Not used.</p>
<p><b>SP Channel Type:</b><br />
Sets the submergence factor “a” exponent in the equation below for calculating the submergence factor Csf. If less than or equal to zero the default value for spillways in Table <a href="#tab:tab-WeirFlows">32</a> is used.</p>
<p><span class="math display">\[C_{sf} = \left(1 - \left(\frac{H_{d}}{H_{u}}\right)^a\right)^b\]</span></p>
<b>SG Channel Type:</b><br />
As for the weir channel in Table <a href="#tab:tab-WeirsAttributeDescriptions">33</a> if a weir has been specified (e.g. a “SG WB” channel).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
<p><b>M, Q, SPO Channel Type:</b><br />
Not used.</p>
<p><b>SP Channel Type:</b><br />
Sets the submergence factor “b” exponent in the weir flow equation above for calculating the weir submergence factor Csf. If less than or equal to zero the default value for spillways in Table <a href="#tab:tab-WeirFlows">32</a> is used.</p>
<b>SG Channel Type: </b><br />
As for the weir channel in Table <a href="#tab:tab-WeirsAttributeDescriptions">33</a> if a weir has been specified (e.g. a “SG WB” channel).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="OperationalChannels-2"><span class="header-section-number">5.10</span> Operational Channels<a href="#OperationalChannels-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Gated rectangular culverts, pumps, sluice gates, gated spillways, weirs
and Q channels can be operated using logical scripts. An “O” Type flag
is required within the 1d_nwk layer for structures that are to be
operated using an operating control definition. For example, an operated
pump would have a Type attribute of “PO” or “OP”.</p>
<p>Operating rules are contained within a .toc file (<strong><u>T</u></strong>UFLOW
<strong><u>O</u></strong>perations <strong><u>C</u></strong>ontrol) with each set of rules
contained within a control definition. More than one structure/device
can use the same control definition. The .toc file is referenced using
<a href="#ecfReadOperatingControlsFile">Read Operating Controls File</a> via the
.ecf file, or via the .tcf file within a <a href="#tcfStart1DDomain">Start 1D
Domain</a> block or by preceding the command with “1D”.</p>
<p>The operating rules for a control can only occur within a .toc file.
More than one .toc file can be set up and accessed should there be a
need to break the control definitions into several files (for example,
all pump controls could be placed in one file and sluice gate controls
in another).</p>
<p>Operational structure time-series data are output to the _1d_O.csv file.
The file reports the time varying status of the structure and the
resulting flow rate. Values of user defined variables and other
information are also output to this file. This is discussed in greater
detail within Section <a href="#TS-GIS-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="TOC-Logic-3"><span class="header-section-number">5.10.1</span> .toc File Commands and Logic<a href="#TOC-Logic-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="TOC-Define-4"><span class="header-section-number">5.10.1.1</span> Define Control Command<a href="#TOC-Define-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A .toc file can only contain <a href="#tocDefineControl">Define Control</a> and
<a href="#tocEndfDefine">End Define</a> blocks.</p>
<p>Each <a href="#tocDefineControl">Define Control</a> must include a keyword
indicating the type of structure/device as per below:</p>
<p><tcmd>Define [ Culvert | Pump | Q Channel | Sluice | Spillway | Weir ] Control </tcmd><teq>==</teq><tblk> &lt;control_id&gt;</tblk><br />
 …<br />
<tcmd>End Define</tcmd></p>
<p>Where <tblk>&lt;control_id&gt;</tblk> is a unique control definition name, noting that
more than one structure can refer to the same operational control
definition. For example, several pumps of different capacities may
utilise the same operational control logic. The 1d_nwk Inlet_Type
attribute is used to link a control definition with the structure.</p>
<p>Within the control definition, commands specific to the type of
structure/device can be used to adjust the structure/device’s operation.
The commands available for each type of control are described below.</p>
<p>Each <a href="#tocDefineControl">Define Control</a> block consists of three sections:</p>
<ol style="list-style-type: decimal">
<li>The default settings for the control’s commands. These are usually
placed at the top of the definition and prior to the logical rules.
These default settings are used at the start of the
simulation/operation and during the operation unless changed by the
logical rules.<br />
</li>
<li>User defined variables as described further below.<br />
</li>
<li>One or more logical rules as described further below.</li>
</ol>
<p>An example of a definition control with the three sections is provided
below.</p>
<center>
<img src="images/image30.png"
style="width:7.87in;height:4.65in" />
</center>
<h4 class="hasAnchor" id="UserDef-4"><span class="header-section-number">5.10.1.2</span> User Defined Variables<a href="#UserDef-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If a line in the control definition cannot be processed as one of the
commands described above, and it is not within an If…End If block, it is
treated as a variable definition using the syntax:</p>
<p><tcmd>&lt;variable&gt; </tcmd><teq>==</teq><tblk> &lt;variable_value&gt;</tblk></p>
<p>Where <tcmd>&lt;variable&gt;</tcmd> is the variable name, while <tblk>&lt;variable_value&gt;</tblk> must
conform to one of the options in Table <a href="#tab:tab-ValueTypes">36</a>. Any characters can
be used for the variable name, but it is recommended to use only
letters, numbers and underscores and to avoid spaces. Note that
variables can be redefined at any point within the control definition.
Also note that these variables only apply to the control. For global
variables, use the <a href="#tcfSetVariable">Set Variable</a> feature.</p>
<table>
<caption>
<span id="tab:tab-ValueTypes">Table 36: </span><strong>Variable Value Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Variable Value
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
constant
</td>
<td style="text-align:left;">
Sets the variable to the value of &lt;constant&gt;. Must be a number. </constant>
</td>
</tr>
<tr>
<td style="text-align:left;">
Time of Model
</td>
<td style="text-align:left;">
Sets the variable to the simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
Time in 24H
</td>
<td style="text-align:left;">
Sets the variable to the simulation time in hours on a 24-hour clock (i.e. will always be between 0 and 24 hours). A simulation time of zero is equivalent to midnight.
</td>
</tr>
<tr>
<td style="text-align:left;">
Time Stamp
</td>
<td style="text-align:left;">
Sets the variable to the current simulation time and keep the variable constant until the variable is changed by a repeat execution of “Time Stamp”.
</td>
</tr>
<tr>
<td style="text-align:left;">
Day of Week
</td>
<td style="text-align:left;">
Sets the variable to the day of the week where Sunday is 1 and Saturday is 7. The keywords “Sun”, “Mon”, “Tue”, “Wed”, “Thu”, “Fri” and “Sat” can also be used when using the variable in a logic rule.
</td>
</tr>
<tr>
<td style="text-align:left;">
Period No Change
</td>
<td style="text-align:left;">
Sets the variable to the time in hours since there was last a change in operation.
</td>
</tr>
<tr>
<td style="text-align:left;">
H1D &lt;node_id&gt; </node_id>
</td>
<td style="text-align:left;">
Sets the variable to the water level at the 1D node named &lt;node_id&gt;. </node_id>
</td>
</tr>
<tr>
<td style="text-align:left;">
Q1D &lt;channel_id&gt; </channel_id>
</td>
<td style="text-align:left;">
Sets the variable to the flow in the 1D channel named &lt;channel_id&gt;. </channel_id>
</td>
</tr>
<tr>
<td style="text-align:left;">
H2D &lt;x&gt;,&lt;y&gt; </y></x>
</td>
<td style="text-align:left;">
Sets the variable to the water level at the 2D cell located at the XY coordinates &lt;x&gt;,&lt;y&gt; </y></x>
</td>
</tr>
<tr>
<td style="text-align:left;">
H2D &lt;2d_po_ID&gt;
</td>
<td style="text-align:left;">
Sets the variable to the water level at the 2D plot output location given by the plot output ID.
</td>
</tr>
<tr>
<td style="text-align:left;">
HU
</td>
<td style="text-align:left;">
Sets the variable to the 1D water level at the upstream node of the channel, based on the digitised direction of the channel.
</td>
</tr>
<tr>
<td style="text-align:left;">
HD
</td>
<td style="text-align:left;">
Sets the variable to the 1D water level at the downstream node of the channel based on the digitised direction of the channel.
</td>
</tr>
<tr>
<td style="text-align:left;">
dHUD
</td>
<td style="text-align:left;">
Sets the variable to the difference in water level between the upstream and downstream nodes based on the digitised direction of the channel. Will be negative if flow is in opposite direction to digitised direction.
</td>
</tr>
<tr>
<td style="text-align:left;">
H1
</td>
<td style="text-align:left;">
Sets the variable to the upstream water level of the channel based on the flow direction.
</td>
</tr>
<tr>
<td style="text-align:left;">
H2
</td>
<td style="text-align:left;">
Sets the variable to the downstream water level of the channel based on the flow direction.
</td>
</tr>
<tr>
<td style="text-align:left;">
dH12
</td>
<td style="text-align:left;">
Sets the variable to the difference in water level between the upstream and downstream nodes based on the flow direction of the channel. Will always be positive.
</td>
</tr>
<tr>
<td style="text-align:left;">
YU
</td>
<td style="text-align:left;">
Sets the variable to the depth above the structure invert of the upstream node based on the digitised direction of the channel.
</td>
</tr>
<tr>
<td style="text-align:left;">
YD
</td>
<td style="text-align:left;">
Sets the variable to the depth above the structure invert of the downstream node based on the digitised direction of the channel.
</td>
</tr>
<tr>
<td style="text-align:left;">
Y1
</td>
<td style="text-align:left;">
Sets the variable to the upstream depth relative to the structure invert based on the flow direction.
</td>
</tr>
<tr>
<td style="text-align:left;">
Y2
</td>
<td style="text-align:left;">
Sets the variable to the downstream depth relative to the structure invert based on the flow direction.
</td>
</tr>
</tbody>
</table>
<p>The 2020-10 release introduced a feature to allow operational control
channels to refer to the status/variables from other operational control
channels. This makes coordinated operations possible between multiple
operational structures. The supported status/variables include:</p>
<ul>
<li>“Period No Change” returns the time in hours since there was a change
in operation in another operational channel.<br />
</li>
<li>“Status” returns the operational status keywords in text format for
different types of operational channels. The full list of keywords is
summarised in Table <a href="#tab:tab-StatusVariable">37</a>.<br />
</li>
<li>“Operational Variables” returns the numeric values of operational
variables from other operational channels, such as “Gate Height”,
“Weir Width”, etc. The full list of keywords is summarised in Table <a href="#tab:tab-OperationalVariables">38</a>.</li>
</ul>
<p>The operational control channel ID (1d_nwk attribute) must be added at
the end of user defined variable commands listed above to refer to the
“Period of No Change”, “Status” or “Operational Variable” from other
operational channels, e.g.:</p>
<p><tcmd>&lt;variable&gt; </tcmd><teq>==</teq><tblk> Weir Height &lt;channel_ID&gt;</tblk></p>
<table>
<caption>
<span id="tab:tab-StatusVariable">Table 37: </span><strong>Keywords Returned by “Status” Variable</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Operational Channels
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Status Strings
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Pumps (PO)
</td>
<td style="text-align:left;">
“Off”, “Dry”, “Below Soffit”, “Starting”, “Stopping”, “Constant”, “Pump Curve”
</td>
</tr>
<tr>
<td style="text-align:left;">
Gated Drowned Rectangular Culverts (RO)<br />
Sluice Gates (SGO)<br />
Spillways with Gates (SPO)<br />
Weirs (WBO, WCO, WDO, WOO, WRO, WTO)<br />
Dam failure (DF)<br />
Pipe failure (PF)
</td>
<td style="text-align:left;">
“Opening”, “Closing”, “Steady”, “Closed”, “Fully Open”
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-OperationalVariables">Table 38: </span><strong>Values Returned by ‘Operational Variables’.</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Operational Channels
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Operational Variables
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Pumps (PO)
</td>
<td style="text-align:left;">
Pump Flow
</td>
</tr>
<tr>
<td style="text-align:left;">
Q channel (QO)
</td>
<td style="text-align:left;">
Q Opening, Q Fully Open
</td>
</tr>
<tr>
<td style="text-align:left;">
Gated Drowned Rectangular Culverts (RO)
</td>
<td style="text-align:left;">
Gate Height, Gate Width
</td>
</tr>
<tr>
<td style="text-align:left;">
Sluice Gates (SGO)
</td>
<td style="text-align:left;">
Gate Opening
</td>
</tr>
<tr>
<td style="text-align:left;">
Spillways with Gates (SPO)
</td>
<td style="text-align:left;">
Gate Opening
</td>
</tr>
<tr>
<td style="text-align:left;">
Weirs (WBO, WCO, WDO, WOO, WRO, WTO)
</td>
<td style="text-align:left;">
Weir Height, Weir Width
</td>
</tr>
<tr>
<td style="text-align:left;">
Dam failure (DF)
</td>
<td style="text-align:left;">
Breach Depth, Top Width
</td>
</tr>
<tr>
<td style="text-align:left;">
Pipe failure (PF)
</td>
<td style="text-align:left;">
Orifice Height, Orifice Width
</td>
</tr>
</tbody>
</table>
<p>In the example below, the model has an operational sluice gate
(“SGate1”) and an operational pump (“Pump1”). Pump1 calls the “status”
of SGate1 and operates only if SGate1’s status is “Closed”.</p>
<center>
<img src="images/image31.png"
style="width:6.29931in;height:2.76806in" />
</center>
<h4 class="hasAnchor" id="Logic-4"><span class="header-section-number">5.10.1.3</span> Logic Rules<a href="#Logic-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The logic rules consist of using If…End If blocks using the construct
below.</p>
<p><tcmd>If &lt;condition_1&gt; [ [ and | or ] &lt;condition_2&gt; ] [ [ and | or ] &lt;condition_3&gt; ]…</tcmd><br />
 <tblk>…enter one or more commands or variable definition lines</tblk><br />
<tcmd>[ Else If &lt;condition_1&gt; [ [ and | or ] &lt;condition_2&gt; ] [ [and | or ] &lt;condition_3&gt; ]…</tcmd><br />
 <tblk>…enter one or more commands or variable definition lines</tblk><br />
<tcmd>[ Else If…repeat as needed]</tcmd><br />
 <tblk>…enter one or more commands or variable definition lines</tblk><br />
<tcmd>[ Else</tcmd><br />
 <tblk>…enter one or more commands or variable definition lines</tblk><br />
<tcmd>End If</tcmd></p>
<p><tcmd>&lt;condition_1&gt;</tcmd> must be a conditional operation that includes one of the
symbols “=”, “&gt;”, “&gt;=”, “&lt;” or “&lt;=”. The left and right sides of the
condition must be a single value or a variable name. Optionally the
variable may be operated on by the following:</p>
<ul>
<li>A “+”, “-“, “*” or “/” and a constant value. For example, a condition
could be “x + 2 &lt; 3”; or<br />
</li>
<li>Specifying “HIGHER” or “LOWER” to compare the current value of the
variable to its value at the start of the current period of no change
in operation. For example, “x == LOWER” will be true if the current
value of ‘x’ is less than its value at the last time there was a
change in operation.</li>
</ul>
<p>If more than one condition is to be applied, the conditions must be
separated by either an “and” or “or”. &lt;condition_2&gt;, &lt;condition_3&gt;,
etc. have the same format as for &lt;condition_1&gt; above.</p>
<p>If…End If blocks can be nested inside other If…End If blocks. Indenting
is strongly recommended to make the control file easier to read.</p>
<h4 class="hasAnchor" id="Increment-Operate-4"><span class="header-section-number">5.10.1.4</span> Incremental Operators<a href="#Increment-Operate-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the majority of the parameters / variables within a control block
these can be manipulated using simple arithmetic. For example, within a
control block, rather than opening a gate to a set opening height or
percentage it is possible to open by a set amount:</p>
<ul>
<li>Gate Opening % == 50 will open the gate to 50% open<br />
</li>
<li>Gate Opening % == ++ 10 will open the gate by 10% from its previous
position</li>
</ul>
<p>Four incremental / arithmetic operators are available, these are:</p>
<ul>
<li>++ increment up<br />
</li>
<li>-- increment down<br />
</li>
<li>** multiply<br />
</li>
<li>// divide</li>
</ul>
<p>These can be used with or without the percentage operator. Gate Opening
% == ++10 will open a gated structure by 10%, Gate Opening == ++ 1.0
will open a gated structure by a height of 1m.</p>
<p>The example below shows the control definition for a pump that operates
between 6am and 6pm Monday to Friday and 10am and 4pm on the weekends.</p>
<center>
<img src="images/image30.png"
style="width:6.29931in;height:3.7217in" />
</center>
<p>The example below shows the control definitions for a gravity released
discharge to a power station (modelled as a pump) and the gated
discharge through the reservoir (courtesy of Natural Resources
Department, Wales).</p>
<center>
<img src="images/image32.png"
style="width:6.29931in;height:6.19836in" />
</center>
<h3 class="hasAnchor" id="Pumps-3"><span class="header-section-number">5.10.2</span> Pumps (P and PO)<a href="#Pumps-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pumps can be modelled as a “P” or “PO” type channel. In non-operational
mode (P channel), the pump flow is interpolated from a head discharge
curve in the <a href="#ecfDepthDischargeDatabase">Depth Discharge Database</a>
defined via a head difference versus flow relationship – see Section
<a href="#DD-Database-3"><strong>??</strong></a>. In operational mode, PO, the pump flow can be varied using
functions such as: switching on and off over a start-up and shutdown
period; and changing the pump capacity and/or discharge curve according
to time, day of the week, hydraulic conditions and other variables.
Pumps do not contribute to any model storage.</p>
<p>In the 1d_nwk layer, the following attributes can be used to set up the
pump (also see Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a>).</p>
<ul>
<li>ID = Unique Channel ID.<br />
</li>
<li>Type = “P” or “PO”.<br />
</li>
<li>US_Invert = Intake elevation of the pump.<br />
</li>
<li>DS_Invert = Outlet elevation of the receptor.<br />
</li>
<li>Inlet_Type = For non-operated (P) pumps the pump discharge curve in
the <a href="#ecfDepthDischargeDatabase">Depth Discharge Database</a>. This curve
is a head difference versus discharge curve, therefore, for a pump
this curve would usually have greater flows for smaller head
differences. If the head difference is negative (i.e. the receptor
water level is below the intake water level) the discharge used is
that for a zero head difference. For operational (PO) pumps Inlet_Type
refers to the Pump operational control definition (see <a href="#tocDefineControl">Define
Control</a>).<br />
</li>
<li>Width_or_Dia = Diameter of the pump’s outlet pipe/hose. Used to
trigger dry conditions (see below) and for calculating the velocity.<br />
</li>
<li>Height_or_WF = For PO pumps the initial operating pump capacity for
fixed (constant) flow pumps (subject to not being overridden by an
operational control command).<br />
</li>
<li>Number_of = Number of (identical) pumps represented by the channel.</li>
</ul>
<p>P and PO pumps are simulated as dry (zero flow) if the upstream (intake)
node is dry or the upstream water level is below the intake elevation
plus the output pipe diameter (i.e. the upstream (intake) water level is
below the intake soffit, which equals the US_Invert + Width_or_Dia).</p>
<p>P pumps always produce a flow in the direction the P channel is
digitised based on that interpolated from the pump discharge curve; the
exception being when dry as described above.</p>
<p>PO pumps are typically operated on a time basis or based on hydraulic
conditions elsewhere in the model. Operational control commands specific
to the <a href="#tocDefineControl">Define Pump Control</a> command are provided
below. Subject to not being overridden by an operational control
command, PO pumps are assumed to be OFF at the start of the simulation.</p>
<ul>
<li><a href="#tocPumpOperation">Pump Operation</a> turns the pump on or off.<br />
</li>
<li><a href="#tocPeriodStartupShutdown">Period Startup/Shutdown</a> sets the time
taken to start the pump up or shut it down.<br />
</li>
<li><a href="#tocPumpCapacity">Pump Capacity</a> sets the flow capacity of the pump.
It is possible to set a constant flow rate or a head-discharge curve
referenced within the <a href="#ecfDepthDischargeDatabase">Depth Discharge Database</a>.<br />
</li>
<li><a href="#tocPumpNumber">Pump Number</a> sets the number of pumps in parallel.</li>
</ul>
<p>The operational status of each pump is reported over time in the _O.csv
output (see Section <a href="#TS-GIS-3"><strong>??</strong></a>). Possible status conditions include:</p>
<ul>
<li>“Off” is the pump is switched off.<br />
</li>
<li>“Dry” if the upstream (intake) node is dry.<br />
</li>
<li>“Below Soffit” if the upstream (intake) water level is below the
intake soffit.<br />
</li>
<li>“Starting” and “Stopping” indicate the pump is starting up or stopping
within <a href="#tocPeriodStartupShutdown">Period Startup/Shutdown</a>.<br />
</li>
<li>“Constant” indicates the pump has reached full flow capacity after
starting up and is operating at its constant (fixed) flow rate, or
“Pump Curve”, which indicates the pump is operating at a flow rate
based on interpolating into its head discharge curve.</li>
</ul>
<h3 class="hasAnchor" id="QO-3"><span class="header-section-number">5.10.3</span> QO Channels<a href="#QO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For QO channels, depth discharge curves for different structure openings
are used to vary and control the discharge. The relationships are
contained in a csv file in a similar format as used for M channels (see
Section <a href="#M-Channel-3"><strong>??</strong></a>). The vertical axis is the depth above the
channel’s invert and the horizontal axis is the percentage opening as
shown in the example below. In the example, Column A contains the depth
above invert values and Row 2 the % opening values. Note that the value
in cell A2 is a flow multiplier. If this value is empty, negative or set
to zero (0), a multiplier of one (1) is used. The flow through the
channel is interpolated from this table at each timestep based on the
structure’s opening and upstream depth above the invert.</p>
<center>
<img src="images/image33.png"
style="width:5.22332in;height:2.53018in" />
</center>
<p>In the 1d_nwk layer, the following attributes can be used to set up a QO
channel.</p>
<ul>
<li>ID = Unique Channel ID.<br />
</li>
<li>Type = “QO”.<br />
</li>
<li>US_Invert = Elevation corresponding to zero depth in the
depth-discharge curve.<br />
</li>
<li>Inlet_Type = Contains both the control_ID and the link to the csv file
containing the matrix of flows for different openings and upstream
water level as per discussion above. For example, “DS_Gate |
QChannel.csv”.
<ul>
<li>The default field width for the inlet_type attribute is 12
characters, this may need to be increased to allow longer names to
be used. Instructions on how to change the GIS layer attribute type
in ArcMap, QGIS and MapInfo are provided on the TUFLOW Wiki as per
the links below:
<ul>
<li><a href="https://wiki.tuflow.com/Arc_Change_Attribute_Type">ArcMap</a><br />
</li>
<li><a href="https://wiki.tuflow.com/MI_Change_Attribute_Type">MapInfo</a><br />
</li>
<li><a href="https://wiki.tuflow.com/QGIS_Change_Attribute_Type">QGIS</a><br />
</li>
</ul></li>
</ul></li>
<li>Width_or_Dia = Not used other than to estimate the velocity and
contribute to nodal storage.</li>
</ul>
<p>The following commands are specific to the <a href="#tocDefineControl">Define Q Channel
Control</a> command used for QO channels.</p>
<ul>
<li><a href="#tocGateSpeed">Gate Speed</a> sets the speed the gate moves.<br />
</li>
<li><a href="#tocPeriodOpeningClosing">Period Opening/Closing</a> sets the time taken
to transition from zero to 100% opening or vice versa.<br />
</li>
<li><a href="#tocGateOpening">Gate Opening</a> sets the position of the opening to be
operated towards. This can be specified incrementally or as an
absolute value.</li>
<li><a href="#tocDischargeCurveType">Discharge Curve Type</a> sets how the depth/head discharge curves are calculated.</li>
</ul>
<p>An example of the GIS attributes and .toc commands for a QO channel are
provided below.</p>
<center>
<img src="images/image34.png"
style="width:2.78102in;height:3.8414in" /><img src="images/image35.png"
style="width:2.83856in;height:2.7224in" />
</center>
<h3 class="hasAnchor" id="RO-3"><span class="header-section-number">5.10.4</span> Gated Drowned Rectangular Culverts (RO)<a href="#RO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rectangular culverts with a gate on the exit can be operated using the
.toc commands below for a <a href="#tocDefineControl">Define Culvert Control</a>
block. The command is applicable for operated rectangular (RO) culverts
only, and uses the equation below as implemented into TUFLOW for a
project based in Florida. The equation below is for US Customary Units,
but RO culverts can be used in metric or US Customary units. Note that
the equation is for submerged culverts only, therefore the user must
ensure that the culvert is drowned at all times.</p>
<center>
<img src="images/image36.png"
style="width:3.85246in;height:4.1771in" />
</center>
<ul>
<li><a href="#tocGateType">Gate Type</a> sets the type of gate arrangement.<br />
</li>
<li><a href="#tocGateSpeed">Gate Speed</a> sets the speed at which the gate moves.<br />
</li>
<li><a href="#tocPeriodOpeningClosing">Period Opening/Closing</a> sets the time taken
to fully open a closed gate or to fully close an open gate.<br />
</li>
<li><a href="#tocGateHeightFullyOpen">Gate Height Fully Open</a> sets the height (not
elevation) of the gate when fully open above the gate’s seat for
vertically moving gates. If not set, the 1d_nwk “Height” attribute is
used.<br />
</li>
<li><a href="#tocGateWidthFullyOpen">Gate Width Fully Open</a> sets the width of the
gate(s) when fully open for horizontally moving gates. If not set, the
1d_nwk “Width_or_Dia” attribute is used.<br />
</li>
<li><a href="#tocGateOpening">Gate Opening</a> sets the position the gate is to be
operated towards. This can be specified incrementally or as an absolute
value.<br />
</li>
<li><a href="#tocCd">Cd</a> sets the discharge coefficient <em>C<sub>d</sub></em> in the
equation above.</li>
</ul>
<h3 class="hasAnchor" id="SG-SGO-3"><span class="header-section-number">5.10.5</span> Sluice Gates (SG and SGO)<a href="#SG-SGO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sluice gates can be operated using the .toc commands further below for a
<a href="#tocDefineControl">Define Sluice Control</a> block. The approach to
calculating the flow through the gate is based on that documented in the
HEC-RAS 4.0 Reference Manual as described below. For non-operated sluice
gates (SG) the gate is assumed to be in a fixed position based on the
1d_nwk Height_or_WF attribute value.</p>
<p>For a free-flowing sluice gate (i.e. upstream controlled) <em>Q</em> is calculated using:
<span class="math display" id="eq:equ-US-controlled">\[\begin{equation}
Q = C_{d}WB\sqrt{2gH_{1}}
\tag{25}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q = \ \)</span>Discharge<br />
</li>
<li><span class="math inline">\(C_{d} = \ \)</span>Discharge coefficient upstream controlled flow (default = 0.6)<br />
</li>
<li><span class="math inline">\(W = \ \)</span>Width<br />
</li>
<li><span class="math inline">\(B = \ \)</span>Height of gate opening above crest level<br />
</li>
<li><span class="math inline">\(H_{1} = \ \)</span>Upstream energy level – Crest level</li>
</ul>
<p>For downstream controlled flow:</p>
<p><span class="math display" id="eq:equ-DS-controlled">\[\begin{equation}
Q = C_{s}WB\sqrt{2g\mathrm{\Delta}H}
\tag{26}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(C_{s} = \ \)</span>Submerged discharge coefficient (default = 0.8)<br />
</li>
<li><span class="math inline">\(\mathrm{\Delta}H = \ \)</span>Upstream energy level – Downstream level</li>
</ul>
<p>For the transition between upstream controlled and full submergence downstream
controlled flow:</p>
<p><span class="math display" id="eq:equ-transition">\[\begin{equation}
Q = C_{d}WB\sqrt{2g3\mathrm{\Delta}H}
\tag{27}
\end{equation}\]</span></p>
<p>The transition between downstream and upstream controlled flow equations
is based on the degree of submergence calculated as the tailwater depth
above the spill crest divided by the upstream energy depth. For a ratio
below 0.67 upstream controlled flow applies, above 0.8 downstream
controlled flow and in between the transition equation applies.</p>
<p>Note that by default the energy level is used for calculating
<em>H<sub>1</sub></em> and <span class="math inline">\(\mathrm{\Delta}H\)</span>, however, this can be changed
as follows:</p>
<ul>
<li>Setting the global default to water surface level using <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>WATER</tblk> or by using the “H” flag for the Type attribute (see Table <a href="#tab:tab-LineTypesOptionalFlags">19</a>).</li>
<li>Setting the global default to energy at the upstream node and water level at the downstream node using <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>ENERGY UPSTREAM</tblk> or by using the “EH” flag for the Type attribute (see Table <a href="#tab:tab-LineTypesOptionalFlags">19</a>). This option was introduced in the 2023-03-AC build.</li>
</ul>
<p>When the flow is not in contact with the gate one of the following
options apply:</p>
<ul>
<li>One of the advanced weir types (see Section <a href="#Adv-Weir-4"><strong>??</strong></a>) can be
specified for the sill by adding the weir type to the 1d_nwk Type
attribute (e.g. “SGWB” or “SG WB” are accepted). The weir equation for
the weir type is applied when the gate is not controlling the flow.
It is recommended that one of the rectangular weir shapes is used
(i.e. WB, WD, WO or WR).<br />
</li>
<li>If no weir is associated with the SG channel, the flow is calculated using a zero length rectangular culvert channel with adjusted entrance and exit losses as per a zero length culvert. Note the total of the entrance and exit losses is defined by the ‘Form_Loss’ attribute (see Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a>), where 1/3 and 2/3 of the ‘Form_Loss’ value are assigned as entrance and exit losses, respectively (typically 0.5 and 1.0).</li>
</ul>
<p>In the 1d_nwk layer, the following attributes can be used to set up the SG or SGO channel.</p>
<ul>
<li>ID = Unique Channel ID.<br />
</li>
<li>Type = “SG” or “SGO”.<br />
</li>
<li>US_Invert and DS_Invert: The higher value is used for the sill crest.<br />
</li>
<li>Width_or_Dia = Width of the gate.<br />
</li>
<li>Height_or_WF = The height above the sill crest of the gate when fully
opened (subject to not being overridden by an operational control
command).<br />
</li>
<li>Number_of = Number of (identical) parallel gates.</li>
</ul>
<p>The following commands can be used within the <a href="#tocDefineControl">Define Sluice
Control</a> block.</p>
<ul>
<li><a href="#tocGateSpeed">Gate Speed</a> sets the speed the gate moves.<br />
</li>
<li><a href="#tocPeriodOpeningClosing">Period Opening/Closing</a> sets the time taken
to fully open a closed gate or to fully close an open gate.<br />
</li>
<li><a href="#tocGateHeightFullyOpen">Gate Height Fully Open</a> sets the height (not
elevation) of the gate when fully open above the gate’s seat for
vertically moving gates. If not set, the 1d_nwk “Height” attribute is
used.<br />
</li>
<li><a href="#tocGateOpening">Gate Opening</a> sets the position the gate is to be
operated towards. This can be specified incrementally or as an
absolute value.<br />
</li>
<li><a href="#tocCdGate">Cd Gate</a> sets the discharge coefficient of the gate,
<em>C<sub>d</sub></em>.<br />
</li>
<li><a href="#tocCdGateSubmerged">Cd Gate Submerged</a> sets the submerged discharge
coefficient, <em>C<sub>s</sub></em>.</li>
</ul>
<h3 class="hasAnchor" id="SPO-3"><span class="header-section-number">5.10.6</span> Spillways with Gates (SPO)<a href="#SPO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Gated spillways can be operated using the approach documented in the USACE Hydraulic Design Criteria Sheet 312 <span class="citation">(<a href="#ref-USACE1977">USACE, 1977</a>)</span> for Vertical Lift Gates on Spillways.</p>
<p>For flow over the spillway unaffected by a gate the following equation
applies:</p>
<p><span class="math display" id="eq:equ-spillway">\[\begin{equation}
Q = {\frac{2}{3}C}_{d}WH\sqrt{2gH}
\tag{28}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q = \ \)</span>Discharge<br />
</li>
<li><span class="math inline">\(C_{d} = \ \)</span>Discharge coefficient (default = 0.75)<br />
</li>
<li><span class="math inline">\(W = \ \)</span>Width of the spillway (rectangular cross-section assumed)<br />
</li>
<li><span class="math inline">\(H = \ \)</span>Upstream energy level – Crest level</li>
</ul>
<p><strong>NOTE: <em>C<sub>d</sub></em> prior to the 2016-03 release was based on</strong>
<span class="math inline">\(\mathbf{Q =}\mathbf{C}_{\mathbf{d}}\mathbf{WH}\sqrt{\mathbf{2}\mathbf{gH}}\)</span>
<strong>(as per Sheet 312), with a default <em>C<sub>d</sub></em> value of 0.5. As of
the 2016-03 release, SPO channels now use the same formula as SP and
weir channels and use a default value of 0.75.</strong></p>
<p>The ratio of the gated discharge to the ungated discharge is derived as:</p>
<p><span class="math display" id="eq:equ-ungated-discharge">\[\begin{equation}
\frac{Q_{G}}{Q} = \frac{C_{G}}{C_{d}}\left( \frac{H_{2}^{\frac{3}{2}} - H_{1}^{\frac{3}{2}}}{H^{\frac{3}{2}}} \right)
\tag{29}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(C_{G}\)</span> = Discharge coefficient (default = <span class="math inline">\(C_{d}\)</span>)<br />
</li>
<li><span class="math inline">\(H_{1}\)</span> and <span class="math inline">\(H_{2}\)</span> = See diagram below from Sheet 312</li>
</ul>
<p>If <em>Q<sub>G</sub></em> is less than <em>Q</em>, <em>Q<sub>G</sub></em> is used for the flow through the
structure. The structure is also tested for submergence using the same
setting as for Ogee Weirs (see Section <a href="#Submerge-4"><strong>??</strong></a>).</p>
<center>
<img src="images/image37.png" style="width:6.29931in;height:3.10903in" />
</center>
<p>Note that by default the energy level is used for calculating
<em>H<sub>1</sub></em> and <span class="math inline">\(\mathrm{\Delta}H\)</span>, however, this can be changed
as follows:</p>
<ul>
<li>Setting the global default to water surface level, using <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>WATER</tblk>, or by using the “H” flag for the Type attribute (see Table <a href="#tab:tab-LineTypesOptionalFlags">19</a>).</li>
<li>Setting the global default to energy at the upstream node and water level at the downstream node, using <tcmd><a href="#ecfStructureFlowLevels">Structure Flow Levels</a></tcmd><teq> == </teq><tblk>ENERGY UPSTREAM</tblk>, or by using the “EH” flag for the Type attribute (see Table <a href="#tab:tab-LineTypesOptionalFlags">19</a>). This option was introduced in the 2023-03-AC build.</li>
</ul>
<p>In the 1d_nwk layer, the following attributes can be used to set up a
SPO channel. Note that the 1d_nwk values can be overridden by their
equivalent operational control command.</p>
<ul>
<li>ID = Unique Channel ID.<br />
</li>
<li>Type = “SPO”.<br />
</li>
<li>US_Invert = Spillway crest level.<br />
</li>
<li>DS_Invert = Gate seat level (see GATE SEAT EL in diagram from Sheet
312). If DS_Invert is higher than US_Invert <a href="https://wiki.tuflow.com/TUFLOW_Message_1050">ERROR 1050</a> results.<br />
</li>
<li>Width_or_Dia = Width of the gate.<br />
</li>
<li>Height_or_WF = The height of the gate above the gate seat when fully
opened.<br />
</li>
<li>Number_of = Number of (identical) parallel spillways.</li>
</ul>
<p>The following section lists commands specific to the <a href="#tocDefineControl">Define Spillway
Control</a> commands.</p>
<ul>
<li><a href="#tocGateSpeed">Gate Speed</a>: sets the speed the gate moves.</li>
<li><a href="#tocPeriodOpeningClosing">Period Opening/Closing</a>: sets the time taken
to fully open a closed gate or to fully close an open gate.</li>
<li><a href="#tocGateHeightFullyOpen">Gate Height Fully Open</a>: sets the height (not
elevation) of the gate when fully open above the gate’s seat for
vertically moving gates. If not set, the 1d_nwk “Height” attribute is
used.</li>
<li><a href="#tocGateSeatVerticalOffset">Gate Seat Vertical Offset</a>: sets the
difference in height between the spillway crest and the seat of the gate
(i.e. the CREST EL minus GATE SEAT EL in the diagram above from Sheet
312).</li>
<li><a href="#tocGateOpening">Gate Opening</a>: sets the position the gate is to be
operated towards. This can be specified incrementally or as an absolute
value. This value is G<sub>O</sub> in the diagram above from Sheet 312.</li>
<li><a href="#tocCdSpillway">Cd Spillway</a>: sets the discharge coefficient of the
spillway, <em>C<sub>d</sub></em>. Default value is 0.75.</li>
<li><a href="#tocCdGate">Cd Gate</a>: sets the discharge coefficient of the gate,
<em>C<sub>G</sub></em>. By default assumed to be the same as <a href="#tocCdSpillway">Cd Spillway</a> see Sheet 312.</li>
</ul>
<h3 class="hasAnchor" id="Weirs-Operational-3"><span class="header-section-number">5.10.7</span> Weirs (WBO, WCO, WDO, WOO, WRO, WTO)<a href="#Weirs-Operational-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Weirs can be operated to simulate structures such as fabri (inflatable)
dams for the WB, WC, WD, WO, WR and WT weir types.</p>
<p>In addition to the 1d_nwk attributes for non-operated weirs (see
Section <a href="#Adv-Weir-4"><strong>??</strong></a>) the following criteria is used to set the
limiting dimensions via the 1d_nwk attributes as follows:</p>
<ul>
<li>Width_or_Dia = The width of the weir when fully open, or if the width
remains unchanged throughout.<br />
</li>
<li>Height_or_WF = The maximum height the weir can be raised above the
weir invert during operation. The weir invert level is defined by the
maximum of the US_Invert and DS_Invert attributes and represents the
elevation of the weir when fully lowered. Note that for operational
weirs the Height_or_WF attribute cannot be used to set the Weir
Calibration Factor, for which a value of 1.0 is used. For example, if
we wish to operate a weir up to an elevation of 15m for a structure
with 1d_nwk attributes US_Invert = 9.9m and DS_Invert = 10m the
following would apply:
<ul>
<li>The weir invert would be at an elevation of 10m (which corresponds
to a weir height of zero (0) m).<br />
</li>
<li>The Height_of_WF attribute would be 5m (i.e. a height of 5m above
the weir invert).</li>
</ul></li>
</ul>
<p>The following are the commands specific to <a href="#tocDefineControl">Define Weir
Control</a> blocks for operating weirs.</p>
<ul>
<li><a href="#tocWeirHeight">Weir Height</a>: sets the height above the weir crest to
operate towards.<br />
</li>
<li><a href="#tocWeirWidth">Weir Width</a>: sets the width of the weir to operate
towards.<br />
</li>
<li><a href="#tocWeirHeightSpeed">Weir Height Speed</a>: sets the speed of the weir in
the vertical.<br />
</li>
<li><a href="#tocWeirWidthSpeed">Weir Width Speed</a>: sets the speed of the weir in
the horizontal.<br />
</li>
<li>The generic commands <a href="#tocOperation">Operation</a> and <a href="#tocPeriodOpeningClosing">Period Opening/Closing</a> also apply.<br />
</li>
<li>Cf sets the weir calibration factor (default = 1.0). Note the
“Height_or_WF” attribute is used to define the height of the
operational weir above the crest level. This .toc command was added in
the 2020-10 release to specify the weir calibration factor
(<em>C<sub>f</sub></em>) for an operational weir.</li>
</ul>
<p>Note the default values of <a href="#tocWeirHeight">Weir Height</a> and <a href="#tocWeirWidth">Weir
Width</a> are both zero (0). To set the initial position of
the weir, specify these commands before the if logic block in the .toc
file.</p>
<p>The 2023-03-AB build introduced three new commands, based on Section 9.11 of <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>, which includes an allowance for side or horizontal flow contraction caused by piers and abutments that contract the flow and reduces the flow width over the weir (<span class="math inline">\(W\)</span>) to an effective flow width (<span class="math inline">\(W&#39;\)</span>) using:</p>
<p><span class="math display" id="eq:equ-piers-on-weirs">\[\begin{equation}
W&#39; = W - 2(NK_{p} + K_{a})H_{e}
\tag{30}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(H_{e}\)</span> = Upstream energy or water level (see <a href="#ecfStructureFlowLevels">Structure Flow Levels</a> command).</li>
<li><span class="math inline">\(N\)</span> = Number of piers.</li>
<li><span class="math inline">\(K_{p}\)</span> = Pier contraction coefficient.</li>
<li><span class="math inline">\(K_{a}\)</span> = Abutment contraction coefficient.</li>
</ul>
<p>The new .toc file commands to specify the parameters are:</p>
<ul>
<li><a href="#tocNumberofPiers">Number of Piers</a>: Sets the number of piers over a weir (the default is zero, 2023-03-AB build and onwards).</li>
<li><a href="#tocKp">Kp</a>: Sets the pier contraction coefficient (the default is zero, 2023-03-AB build and onwards).</li>
<li><a href="#tocKa">Ka</a>: Sets the abutment contraction coefficient (the default is zero, 2023-03-AB build and onwards).</li>
</ul>
<p>Section 9.11 of <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span> recommends the following values for the pier contraction coefficient <span class="math inline">\(K_{p}\)</span>:</p>
<ul>
<li>Square-nosed piers with corners rounded on a radius equal to about 0.1 of the pier thickness: <span class="math inline">\(K_{p}\)</span> = 0.02</li>
<li>Round-nosed piers: <span class="math inline">\(K_{p}\)</span> = 0.01</li>
<li>Pointed-nose piers: <span class="math inline">\(K_{p}\)</span> = 0.0</li>
</ul>
<p>The recommended values for the abutment contraction coefficient <span class="math inline">\(K_{a}\)</span> depends on the shape of the abutment, the design head (<span class="math inline">\(H_{0}\)</span>) and the radius of abutment rounding:</p>
<ul>
<li>Square abutments with headwall at 90° to direction of flow: <span class="math inline">\(K_{a}\)</span> = 0.20</li>
<li>Rounded abutments with headwall at 90° to direction of flow, when 0.15<span class="math inline">\(H_{0}\)</span> ≤ <span class="math inline">\(r\)</span> ≤ 0.5<span class="math inline">\(H_{0}\)</span>: <span class="math inline">\(K_{a}\)</span> = 0.10<br />
</li>
<li>Rounded abutments where <span class="math inline">\(r\)</span> &gt; 0.5<span class="math inline">\(H_{0}\)</span>, and headwall is placed not more than 45° to direction of flow: <span class="math inline">\(K_{a}\)</span> = 0.0</li>
</ul>
<p>Note that in the relationship above, the effective flow width (<span class="math inline">\(W&#39;\)</span>) reduces linearly as the upstream head (<span class="math inline">\(H_{e}\)</span>) increases. The ratio of contraction calculated by this equation is usually small relative to the actual width of weir (<span class="math inline">\(W\)</span>). But to avoid unreasonable contraction ratios, a lower limit of 0.6<span class="math inline">\(W\)</span> is applied.</p>
<h3 class="hasAnchor" id="PFDF-3"><span class="header-section-number">5.10.8</span> Piping and Dam Failure<a href="#PFDF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2020-10-AB build introduced two new operational channels for piping and dam failure:</p>
<ol style="list-style-type: decimal">
<li>“PF” type: can be used to model the pipe failure process, as discussed in Section <a href="#PF-4"><strong>??</strong></a>; and</li>
<li>“DF” type: can be used to model a dam/levee break, as discussed in Section <a href="#DF-4"><strong>??</strong></a>.</li>
</ol>
<p>In the 1d_nwk layer, the attributes in Table <a href="#tab:tab-FailureAttributeDescriptions">39</a> can be used to set up the channel parameters.</p>
<table>
<caption>
<span id="tab:tab-FailureAttributeDescriptions">Table 39: </span><strong>Piping &amp; Dam Failure Channels: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas and cannot be blank. As a rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>“PF”: Piping Failure</p>
“DF”: Dam Failure
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
<p>“PF”: Inlet elevation of the piping.</p>
“DF”: Elevation of the dam crest level before failure.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
<p>“PF”: Outlet elevation of the piping.</p>
“DF”: Not Used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
<p>“PF”: Refers to the Piping Failure operational control definition in .toc file.</p>
“DF”: Refers to the Dam Failure operational control definition in .toc file.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
<p>“PF”: Width of the piping orifice when fully breached.</p>
“DF”: Top width of the dam failure channel.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
<p>“PF”: Height of the piping orifice when fully breached.</p>
“DF”: Weir coefficient C<sub>d</sub> of the intact part.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="PF-4"><span class="header-section-number">5.10.8.1</span> Piping Failure (PF)<a href="#PF-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Dam/levee breaks can be initiated by flow overtopping, or by internal erosion (often called “piping” or “piping failure”) when
water seeps through the embankment forming a tiny flow path. This “pipe failure” process can be modelled using a “PF” type 1D operational channel. In the 1d_nwk layer, the attributes in Table <a href="#tab:tab-FailureAttributeDescriptions">39</a> can be used to set up the channel parameters.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image38"></span>
<img src="images/image38.png" alt="**Schematisation of 1D Piping Failure**" width="60%" />
<p class="caption">
Figure 33: <strong>Schematisation of 1D Piping Failure</strong>
</p>
</div>
<p>Operational control commands (.toc file) specific to the Piping Failure
channel are provided below:</p>
<ul>
<li><a href="#tocPeriodFailure">Period Failure</a>: sets the time taken to reach the
full size of piping failure.<br />
</li>
<li><a href="#tocOrificeWidthFullyOpen">Orifice Width Fully Open</a>: sets the width
or the diameter of the piping orifice when fully breached. If omitted,
the value set by the 1d_nwk Width_or_Dia attribute is used.<br />
</li>
<li><a href="#tocOrificeHeightFullyOpen">Orifice Height Fully Open</a>: sets the
height of the piping orifice when fully breached. If omitted, the
value set by the 1d_nwk Height_or_WF attribute is used.<br />
</li>
<li><a href="#tocPeriodCollapse">Period Collapse</a>: sets the time taken to ‘shut
down’ the piping failure channel after it reaches the full extent due
to the channel collapsing.<br />
</li>
<li><a href="#tocOrificeOpening">Orifice Opening</a>: sets the piping failure status.<br />
</li>
<li><a href="#tocCd">Cd</a>: sets the discharge coefficient in the orifice flow
equation below.</li>
</ul>
<p>The flow rate through a piping failure channel is calculated using the orifice flow equation as provided below. Note that zero flow is
assumed should the upstream water level fall below the orifice obvert,
i.e. no partial flow of the orifice is assumed to occur.</p>
<p><span class="math display" id="eq:equ-orifice-flow">\[\begin{equation}
Q = C_{d}A\sqrt{2g\left( H_{up} - H_{down} \right)}
\tag{31}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(C_{d}\)</span> is the discharge coefficient set by <a href="#tocCd">Cd</a> command<br />
</li>
<li><span class="math inline">\(A\)</span> is the cross-sectional area of the orifice<br />
</li>
<li><span class="math inline">\(H_{up}\)</span> is the upstream water level<br />
</li>
<li><span class="math inline">\(H_{down}\)</span> is the higher of the downstream obvert or downstream water level</li>
</ul>
<p>It is assumed the orifice shape is rectangular, and the orifice size increases
linearly with time. The expansion of the orifice is assumed to be
centrally around the upstream and downstream inverts.</p>
<p>An example of a .toc file <a href="#tocDefineControl">Define Pipe Failure Control</a> block is provided below:</p>
<center>
<img src="images/image39.png"
style="width:6.29931in;height:2.73403in" />
</center>
<h4 class="hasAnchor" id="DF-4"><span class="header-section-number">5.10.8.2</span> Dam Failure (DF)<a href="#DF-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The dam failure “DF” type 1D operational channel can be used to model dam/levee breaks in 1D. This channel can commence independently,
or be triggered by a 1D pipe failure using “PF” type trigger. The flow
rate is calculated based on the advanced weir flow equation (Section
<a href="#Adv-Weir-4"><strong>??</strong></a>). Either a rectangular or trapezoidal cross-section can be
applied, and the opening size is assumed to increase linearly with time.
In the 1d_nwk layer, the attributes in Table <a href="#tab:tab-FailureAttributeDescriptions">39</a> can be used to set up the channel parameters.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image40"></span>
<img src="images/image40.png" alt="**Schematisation of 1D Dam Failure**" width="60%" />
<p class="caption">
Figure 34: <strong>Schematisation of 1D Dam Failure</strong>
</p>
</div>
<p>Operational control commands specific to the Dam Failure channel are
provided below:</p>
<ul>
<li><a href="#tocPeriodFailure">Period Failure</a>: sets the time taken to reach the
full size of the dam failure.<br />
</li>
<li><a href="#tocTopWidthFullyBreached">Top Width Fully Breached</a>: Same as the
“Height_or_WF” attribute.<br />
</li>
<li><a href="#tocDepthFullyBreached">Depth Fully Breached</a>: Same as the
“Width_or_Dia” attribute.<br />
</li>
<li><a href="#tocSideSlopeDegree">Side Slope (degree)</a>: Sets the angle of the side slopes.
This is used for calculating the bottom width and flow area.<br />
</li>
<li><a href="#tocPeriodCollapse">Period Collapse</a>: Defines the time taken to
form the dam breach opening at the start of the dam
break.<br />
</li>
<li><a href="#tocDepthCollapse">Depth Collapse</a>: defines the depth of the dam
crest collapse during <a href="#tocPeriodCollapse">Period Collapse</a> at the
beginning of the dam break.<br />
</li>
<li><a href="#tocBreachOpening">Breach Opening</a>: Sets the dam failure status.</li>
</ul>
<p>During any period of the dam failure, the Side Slope is set as constant.
If the bottom width calculated from the width, depth and the side slope
becomes negative, a V shaped cross-section is assumed based on the width
and the side slope. A DF channel can be subject to one of the following
three flow phases, depending on the upstream water level and state of
the breach:</p>
<ul>
<li><p>Flow overtopping above the crest level can occur before the dam break.
At this stage, all the water is flowing through the “Intact” section
of the dam crest.</p>
<center>
<p><img src="images/image41.png" style="width:3.93701in;height:1.91038in" /></p>
</center></li>
<li><p>After the dam break commences, the water can flow through both the
“Intact” section of the dam crest (provided the upstream water level
is greater than the invert of the intact section), and the “failed”
section. The total flow is reported in the .eof file and the _1d_Q.csv
output file, while the flow rate for each section is reported
separately in the _1d_O.csv output file.</p>
<center>
<p><img src="images/image42.png" style="width:3.94028in;height:2.22708in" /></p>
</center></li>
<li><p>Once the maximum breach width is reached or there is no flow over any
remaining intact sections, the flow is confined entirely within the
“Failed” section.</p>
<center>
<p><img src="images/image43.png" style="width:3.94028in;height:1.76042in" /></p>
</center></li>
</ul>
<p>The flow calculation through a 1D dam break channel is computed for both
the intact and failed sections, with the user able to set the weir flow
equation parameters separately for both sections as per the table below.</p>
<table>
<caption>
<span id="tab:tab-WeirFlowTOCCommands">Table 40: </span><strong>.toc Commands to Set Weir Flow Equation Parameters in DF Channel</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
“Intact” Section
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
“Failed” Section
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="#tocWeirTypeIntactFailed">Weir Type Intact</a>
</td>
<td style="text-align:left;">
<a href="#tocWeirTypeIntactFailed">Weir Type Failed</a>
</td>
<td style="text-align:left;">
Sets the weir channel type using the flags in Table <a href="#tab:tab-WeirTypes">31</a>. If this command is not specified, the defaults are “WB” for the Intact section and “WW” for the failed section. Note that the “Side Slope” is not considered in the cross-section calculation for non-WW type weirs.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tocCdIntactFailed">Cd Intact</a>
</td>
<td style="text-align:left;">
<a href="#tocCdIntactFailed">Cd Failed</a>
</td>
<td style="text-align:left;">
Sets the weir coefficient, <em>C<sub>d</sub></em>, in its dimensionless form.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tocCfIntactFailed">Cf Intact</a>
</td>
<td style="text-align:left;">
<a href="#tocCfIntactFailed">Cf Failed</a>
</td>
<td style="text-align:left;">
Sets the weir coefficient adjustment factor <em>C<sub>f</sub></em>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tocExIntactFailed">Ex Intact</a>
</td>
<td style="text-align:left;">
<a href="#tocExIntactFailed">Ex Failed</a>
</td>
<td style="text-align:left;">
Sets the weir flow equation exponent <em>E<sub>x</sub></em>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tocSaIntactFailed">Sa Intact</a>
</td>
<td style="text-align:left;">
<a href="#tocSaIntactFailed">Sa Failed</a>
</td>
<td style="text-align:left;">
Sets the submergence factor “a” exponent in the Villemonte Equation for calculating the weir submergence factor <em>C<sub>sf</sub></em>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tocSbIntactFailed">Sb Intact</a>
</td>
<td style="text-align:left;">
<a href="#tocSbIntactFailed">Sb Failed</a>
</td>
<td style="text-align:left;">
Sets the submergence factor “b” exponent in the Villemonte Equation for calculating the weir submergence factor <em>C<sub>sf</sub></em>.
</td>
</tr>
</tbody>
</table>
<p>An example of a <a href="#tocDefineControl">Define Dam Failure Control</a> block is
provided below:</p>
<center>
<img src="images/image44.png" style="width:6.29931in;height:4.04236in"
alt="Text Description automatically generated" />
</center>
<p>The <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span> approach to include an allowance for side or horizontal flow contraction caused by piers and abutments can be optionally applied for the “Intact” part of a DF channel (see Section <a href="#Weirs-Operational-3"><strong>??</strong></a>). The 2023-03-AB build introduced the following three new commands:</p>
<ul>
<li><a href="#tocNumberofPiers">Number of Piers</a>: Sets the number of piers over the weir (the default is zero, 2023-03-AB build and onwards).</li>
<li><a href="#tocKpIntact">Kp Intact</a>: Sets the pier contraction coefficient (the default is zero, 2023-03-AB build and onwards).</li>
<li><a href="#tocKaIntact">Ka Intact</a>: Sets the abutment contraction coefficient (the default is zero, 2023-03-AB build and onwards).</li>
</ul>
<h2 class="hasAnchor" id="Pipes-2"><span class="header-section-number">5.11</span> Pipe Networks<a href="#Pipes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Pipe networks can be modelled using two different approaches, or a combination of these approaches:</p>
<ol style="list-style-type: decimal">
<li>Detailed modelling by defining the physical
features of the pipe network using 1d_nwk channels to represent
pipes, 1d_pit or 1d_nwk nodes to represent pits, and 1d_mh nodes to
represent manholes, as discussed within this Section.<br />
</li>
<li>An approximate approach termed Virtual Pipes is also available if
the pipe details are unknown though inlet and outlet information is
available. A Virtual Pipe network can be modelled using 1d_pit or
1d_nwk nodes to represent inlets and outlets between which flow is
instantaneously transferred or exits the model (i.e. no physical routing is
calculated). Virtual pipes are discussed in Section <a href="#Virtual-Pipes-2"><strong>??</strong></a>.</li>
</ol>
<p>Complete 1D pipe networks and Virtual pipe pits can coexist in the same
model. From the 2020-10 release and onwards, in TUFLOW HPC, virtual pipe outputs can connect to, and discharge into, the upstream or downstream end of a channel.</p>
<p>TUFLOW 1D produces a true HGL, with all losses accounted for. Different methods are available to quantify the losses at junctions and manholes, with the default setting being the Englehund approach, which automatically adjusts losses every timestep according to the expansion/contraction of flow, and changes in pipe direction, slope, inverts, etc.</p>
<p>Note that care should be taken in interpreting the HGL profile as the water level output currently only supports one level, which is the level in the manhole chamber (ie. after expansion losses into the chamber have been accounted for, or after a free-overfalling pipe outlet discharges into the manhole). Therefore, especially where upstream controlled flow regimes occur (eg. free outflow), the profile may appear to intersect the pipe invert profile.</p>
<h3 class="hasAnchor" id="Pipes-3"><span class="header-section-number">5.11.1</span> Pipes<a href="#Pipes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Culverts within a pipe network are created by digitising lines within
one or more 1d_nwk GIS layers and assigning a type C, R or I (refer to
Section <a href="#culverts-pipes-3"><strong>??</strong></a>). The culverts are considered linked when the
channel ends are snapped to one another or they are connected by a connector (“X” channel). Connectivity between the
underground pipe with the surface above is defined using pits (see
Section <a href="#Pits-3"><strong>??</strong></a>). Pipe junctions are referred to as manholes in
TUFLOW terminology and can occur with or without pits (see Section
<a href="#Manholes-3"><strong>??</strong></a>). TUFLOW includes a range of energy dissipation options at
junctions. These are also discussed in Section <a href="#Manholes-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="Pits-3"><span class="header-section-number">5.11.2</span> Pits<a href="#Pits-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pits are used for two purposes.</p>
<ol style="list-style-type: decimal">
<li>In pipe network models (Section <a href="#Pipes-3"><strong>??</strong></a>), pits transfer water
between the 2D domain on the surface and a 1D pipe network
underground.<br />
</li>
<li>In virtual pipe networks (Section <a href="#Virtual-Pipes-2"><strong>??</strong></a>), pits define inlet
and outlet locations.</li>
</ol>
<p>Pits are defined by digitising points within one or more 1d_pit or
1d_nwk layers. Of these two alternatives the 1d_pit layer is the most
efficient option. It excludes superfluous attributes included in the
1d_nwk format that are required for other uses (such as 1D pipe or open
channel details). Both options are described in the following sections.</p>
<p>The following notes apply to pits:</p>
<ul>
<li>For pits connected to a channel start or end (usually a pipe), either
by snapping or via an “X” channel, or are within the <a href="#ecfPitSearchDistance">Pit Search
Distance</a>, the pit calculations are carried out
by ESTRY and it is assumed a pipe network is being modelled.
<ul>
<li>Under this scenario TUFLOW/ESTRY will automatically create a short
channel called a “pit channel” to connect the 2D domain (surface) to
the underground 1D pipe network. The pit channel is computationally
“zero length” and does not contribute to any storage in the system
(noting that the Len_or_ANA attribute is used to specify the surface
area or storage of the pit chamber).<br />
</li>
<li>The pit inlet capacities curves are specified in a <a href="#ecfPitInletDatabase">Pit
Inlet Database</a> (see Section <a href="#DD-Database-3"><strong>??</strong></a>) for
“Q” type pits in Table <a href="#tab:tab-PitsModelNetwork">41</a>.<br />
</li>
</ul></li>
<li>Unconnected pits, (i.e. pits not snapped/connected to a channel end or within the <a href="#ecfPitSearchDistance">Pit Search
Distance</a> of a channel end), or VPI and VPO pits,
are used for virtual pipe modelling and the following
logic applies:
<ul>
<li>The virtual pipe pit inlet capacity curves are specified in a <a href="#ecfPitInletDatabase">Pit
Inlet Database</a> (see Section <a href="#DD-Database-3"><strong>??</strong></a>) for
a “VPI” or “Q” type pit in Table <a href="#tab:tab-PitsAttributeDescriptions">42</a>.<br />
</li>
<li>VPI and VPO type pits are always treated as disconnected (i.e.
virtual pipe inlets or outlets), even if snapped or within a <a href="#ecfPitSearchDistance">Pit
Search Distance</a>.
<ul>
<li>For Classic, all unconnected pits and VPI pits are treated as being
connected to a virtual pipe. The pit’s discharge is extracted from
the model on the assumption there are no backwater or surcharging
effects at that pit. For example, free flow into the ocean. Note:
VPO pits are not supported in Classic and will show zero flow.<br />
</li>
<li>For HPC, all VPI and VPO discharges are calculated by the HPC solver
as per the virtual pipe feature. For all other unconnected pits,
their discharges are calculated by the TUFLOW 1D solver (ESTRY) in
the same manner as for Classic above.<br />
</li>
</ul></li>
</ul></li>
<li>A <a href="https://wiki.tuflow.com/TUFLOW_Message_1626">CHECK 1626</a> message is issued for unconnected pits (excluding VPI and VPO
pits), alerting the modeller to the possibility of a pit possibly
being inadvertently not snapped or within the <a href="#ecfPitSearchDistance">Pit Search
Distance</a>. If all the pits should be connected
(excluding VPI and VPO pits), the user can specify the .ecf command
<a href="#tcfPitNo1DConnection">Pit No 1D Connection</a> to force an <a href="https://wiki.tuflow.com/TUFLOW_Message_1626">ERROR 1626</a>
in the case of a pit not being connected by snapping or within the
<a href="#ecfPitSearchDistance">Pit Search Distance</a>.<br />
</li>
<li>If a pit cannot be connected to an overland 2D domain
(because, for example, it does not fall on an active cell), a WARNING
is issued and the pit channel will remain
unconnected.</li>
<li>In the various 1D output and the 1d_nwk check files, the pit channels
that are snapped to a channel end are displayed as a small channel
orientated in the north-south axis, not a node (point). The display
length of the channel is, by default, set to 10 m, however, this can
be changed using <a href="#ecfPitChannelOffset">Pit Channel Offset</a>. For pits
connected using <a href="#ecfPitSearchDistance">Pit Search Distance</a>, the pit
is displayed as extending from its connected node.<br />
</li>
<li>Flow through unconnected pits will appear in the mass balance
reporting as follows:
<ul>
<li>Within the _MB2D.csv or _HPC.csv “As SX V In” and “Es SX V Out” SX
in and out flow columns.<br />
</li>
<li>For unconnected pits calculated by ESTRY the discharge exiting the
model is included in the _MB1d.csv or _MB.csv “H Vol Out” column.<br />
</li>
<li>For HPC VPI and VPO pits the volumes exiting or entering the model
are included in the SX Volumes.<br />
</li>
</ul></li>
<li>The downstream node of an unconnected pit channel will have a boundary
type “V” in the .eof file as shown below.<br />

<center>
<img src="images/image51.jpeg" style="width:4.71875in;height:1.29167in"
alt="image003" />
</center></li>
<li>For an unconnected pit, which must have an ID, the upstream and
downstream nodes are assigned .1 and .2 extensions respectively.<br />
</li>
<li>If a connected pit’s node ID is left blank the pit channel ID is given
a “.P” extension based on the pit node’s automatically assigned ID
(see Section <a href="#Nodes-2"><strong>??</strong></a>). The upstream (ground) node ID of the pit
channel is given the pit channel’s ID with a “.0” extension.<br />
</li>
<li><a href="#ecfMinimumNAPit">Minimum NA Pit</a> sets the minimum NA (Nodal Area) of
the upstream (ground) nodes for all pit channels. This command was
introduced to differentiate upstream pit channel nodes from the
<a href="#ecfMinimumNA">Minimum NA</a> setting.</li>
</ul>
<h4 class="hasAnchor" id="OneD-pit-nwk-4"><span class="header-section-number">5.11.2.1</span> 1d_nwk Pits<a href="#OneD-pit-nwk-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pits are created by digitising points within one or more 1d_nwk GIS
layers and setting the “Type” attribute to C, Q, R or W (refer to Table <a href="#tab:tab-PointObjectTypes">46</a>). Table <a href="#tab:tab-PitsModelNetwork">41</a> describes the 1d_nwk attributes required for pits defined in the 1d_nwk
format.</p>
<table>
<caption>
<span id="tab:tab-PitsModelNetwork">Table 41: </span><strong>Pits: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
<p>Unique identifier up to 12 characters in length. For pits connected to a 1d_nwk channel, either by being snapped or connected using <a href="#ecfPitSearchDistance">Pit Search Distance</a>, if ID is blank the pit channel’s ID is automatically assigned based on one of the connecting channel IDs. For pits not connected to a channel, ID cannot be blank and must be unique.</p>
ID may contain any character except for quotes and commas. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
Used to specify a Pit Channel as one of C, Q, R or W as per Table <a href="#tab:tab-PointObjectTypes">46</a>.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS<br />
(Use Channel Storage at nodes).
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
<p>Adds the value specified as additional nodal area (surface area in m2). If no nodal area data exists for the node, either via the UCS attribute from the connected 1d_nwk channels, or via a NA table, TUFLOW automatically creates an NA table of constant surface area.</p>
If a negative value is specified, this value is used as a multiplier of the node storage. For example, a value of -1.5 increases the nodal storage table (NA table) by 50% (or to reduce storage use a value between -1 and 0). Increasing storage can be useful to stabilise problematic 1D nodes, provided that the added storage does not adversely distort the results. This multiplication is applied after any effect of <a href="#ecfMinimumChannelStorageLength">Minimum Channel Storage Length</a>. <a href="#ecfMinimumNA">Minimum NA</a> is applied after the multiplication.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
<p>Used to specify the ground elevation of the pit. This is used to set the upstream and downstream elevation of the pit channel. If set to -99999, the ground elevation is set to the ZC elevation of the 2D cell that the pit falls within, or the lowest elevation sampled if using SGS (provided there is a 2D SX connection – see Conn_1D_2D attribute below).</p>
If Conn_1D_2D is set to “SXL”, US_Invert is used as the amount by which to lower the 2D cell and the pit channel invert is set to this level.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
The bottom elevation of the pit. Can also be used to set the upstream and downstream inverts of connected channels – see discussion for US_Invert for channels above. If set to -99999, not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
The Form_Loss value is applied as an energy loss to all outgoing culverts (i.e. culverts that are digitised as leaving the pit/node), so the Form_Loss value should be based on the outgoing pipe velocity (e.g. the K values). Note, it may be necessary to zero or reduce the Entry_Loss and/or Exit_Loss attributes of culverts connected to the pit/node so that duplication of losses does not occur. This loss coefficient is not adjusted according to the approach and departure velocities as documented in Section <a href="#LossAdjustment-3"><strong>??</strong></a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
The percentage blockage (%) of the pits. Reduces the flow capacity through the pit by the specified amount.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
For Q pit channels, the name of a pit inlet type in the <a href="#ecfPitInletDatabase">Pit Inlet Database</a> (see Section <a href="#DD-Database-3"><strong>??</strong></a>). Otherwise not used.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
<p>Used to specify a “SX” flag that automatically creates a 2D SX cell and 1D/2D connection where the 1D pit occurs. This negates the need to create SX objects in a 2d_bc layer.</p>
<p>The following options/changes are available:</p>
<ul>
<li>“SX” can also be used to automatically connect 1D nodes as well as pits to the 2D domain.<br />
</li>
<li>“SXL” can be specified to connect the 1D pit to the 2D domain and lower the 2D cell by the amount of the US_Invert attribute. The invert of the pit channel is set to the lowered 2D cell level. This is useful to help trap the water into the pit as it flows overland in the 2D domain. This feature works well in combination with the <a href="#tbcReadGISSA">Read GIS SA PITS</a> option. If using the SGS functionality (Section <a href="#SGS-3"><strong>??</strong></a>), the “L” flag lowers the minumum cell elevation by the amount of the US_Invert attribute, but retains the original cell volume versus depth curve. The lowered cell can be made flat as per the traditional sampling (non-SGS) approach, using the <a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> command. However, if the underlying DEM has good representation of the pit inlet elevation, it is not recommended to use the “L” flag.</li>
<li>By default, if more than one 2D cell is automatically connected, pits are assumed to be connected using the Grade (G) approach and nodes the Sag (S) approach (see Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a>). To override these default approaches, specify either “SXG” or “SXS”.</li>
</ul>
<a href="#ecfPitDefault2DConnection">Pit Default 2D Connection</a> can be used to set a global default value for Conn_1D_2D, and up to four characters is now accepted. “NO” can also be used to not connect the node or pit to a 2D domain.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
<p>If “SX” is specified for Conn_1D_2D, can be used to control the number of 2D cells connected. See Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a> for a discussion on how the 2D cells are selected.</p>
<ul>
<li><p>A positive value increases the number of automatically selected 2D cells by the value of Conn_No.<br />
</p></li>
<li><p>If negative, this ignores the automatic approach and fixes the number of 2D cells connected to the absolute value of Conn_No. For example, a value of -1 would only connect the pit or node to one (1) 2D cell irrespective of the connection width.</p>
</td>
<td style="text-align:left;">
<p>Integer</p>
</td>
</tr>
<tr>
<td style="text-align:right;">
<p>14</p>
</td>
<td style="text-align:left;">
<p>Width_or_Dia</p>
</td>
<td style="text-align:left;">
<p><b>C, R, W Pit Type:</b><br />
For C pits, sets the diameter of the pit inlet cross-section in the vertical plane. For R and W pits, sets the width of the pit inlet section in the vertical plane.</p>
<p><b>Q Pit Type:</b><br />
Used as a multiplier of the flow derived from the depth-discharge curve. For example, if Width_or_Dia equals 2, the flow is doubled. If set to zero (0), a value of 1.0 is used (i.e. the discharge curve remains unchanged).</p>
</td>
<td style="text-align:left;">
<p>Float</p>
</td>
</tr>
<tr>
<td style="text-align:right;">
<p>15</p>
</td>
<td style="text-align:left;">
<p>Height_or_WF</p>
</td>
<td style="text-align:left;">
<p>Sets the height of an R pit inlet channel. Not used for other pit types.</p>
</td>
<td style="text-align:left;">
<p>Float</p>
</td>
</tr>
<tr>
<td style="text-align:right;">
<p>16</p>
</td>
<td style="text-align:left;">
<p>Number_of</p>
</td>
<td style="text-align:left;">
<p><b>C, R, W Pit Type:</b><br />
Sets the number of pits (of same dimension) within the one pit channel.</p></li>
</ul>
<b>Q Pit Type:</b><br />
Used as a multiplier of the flow derived from the depth-discharge curve. For example, if Number_of equals 3, this assumes there are three pits lumped together and the flow is tripled. If set to zero (0) a value of 1 is used (i.e. a single inlet pit is assumed). Multiplies the flow only, additional storage defined by the Len_or_ANA attribute is not multiplied. Where a pit is connected to a manhole, increasing the Number_of attribute will not increase the number of manholes, or its dimensions; the pits remain connected to only one manhole.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
<b>R Pit Type:</b> Sets the height contraction coefficient, otherwise not used for other pit types. Usually 0.6 for square edged entrances to 0.8 for rounded edges. If value exceeds 1.0 or is less than or equal to zero, it is set to 0.6.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
<b>C, R Pit Type:</b> Sets the width contraction coefficient, otherwise not used for other pit types. Usually 0.9 for sharp edges to 1.0 for rounded edges for R culverts. Normally set to 1.0 for C pits. If value exceeds 1.0 or is less than or equal to zero, it is set to 1.0 for C and 0.9 for R pits.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
<b>C, R Pit Type:</b> Sets the entry loss coefficient, otherwise not used for other pit types.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
<b>C, R Pit Type:</b> Sets the exit loss coefficient, otherwise not used for other pit types.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="OneD-pit-4"><span class="header-section-number">5.11.2.2</span> 1d_pit Pits<a href="#OneD-pit-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The 1d_pit layer can be used for all types of pits in Classic and HPC, whether connected to a 1d_nwk or a virtual pipe system. Table <a href="#tab:tab-PitsAttributeDescriptions">42</a> presents the attributes associated with 1d_pit GIS layer. The 1d_pits attribute table excludes superfluous attibutes included in the 1d_nwk format that are required for other uses (e.g. pipes and open channels).</p>
<table>
<caption>
<span id="tab:tab-PitsAttributeDescriptions">Table 42: </span><strong>Pits: 1D Model Network (1d_pit) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
<p>Unique identifier up to 12 characters in length. For pits that connect to a 1d_nwk channel, either by being snapped or connected using <a href="#ecfPitSearchDistance">Pit Search Distance</a>, if ID is blank the pit channel’s ID is automatically assigned based on one of the connecting channel IDs.</p>
<p>Note VPI and VPO pits are never connected to a 1d_nwk channel, therefore, they always require unique IDs. For any pit not connected to a channel, ID cannot be blank and must be a unique (channel) ID.</p>
ID may contain any character except for quotes and commas. Generally, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a pit (which is converted to a channel) and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char (12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>“VPI” or “I” (Virtual Pipe Inlet):<br />
VPI pits are Q pits treated as being disconnected from all 1d_nwk channels (even if they are snapped to a channel). For the HPC solver VPIs can optionally be associated with a VPO (Virtual Pipe Outlet) to discharge flow back into the 2D domain. For the Classic 2D solver as of Build 2018-03-AA, all VPI pit discharges are irretrievably extracted from the 2D domain. Prior to Build 2018-03-AA a VPI pit could only be denoted as “I” and would not extract or surcharge virtual pipe flow unless there was an outlet (“O”) pit with the same VP_Network_ID. As of Build 2018-03-AA if there is no VPO pit with the same VP_Network_ID the VPI pit discharge is extracted from the 2D domain. “VPI” is the preferred notation.</p>
<p>“VPO” or “O” (Virtual Pipe Outlet):<br />
HPC 2D solver only (not used by the Classic 2D solver). VPOs are treated as being disconnected from all 1d_nwk channels (even if they are snapped to a channel). They act as a discharge of the total or proportion of VPI inflows on the same VP_Network_ID back into the 2D domain. Prior to Build 2018-03-AA a VPO pit could only be denoted as “O”, however, “VPO” is now the preferred notation. More than one VPO pit can exist for the same VP_Network_ID.</p>
“C”, “Q”, “R” and “W”:<br />
As of Build 2018-03-AA, the standard C, Q, R and W pits can be specified via a 1d_pit layer, and can be connected, or disconnected, to a 1d_nwk. If a C, Q, R or W pit is not connected to a 1d_nwk channel, either by snapping or using <a href="#ecfPitSearchDistance">Pit Search Distance</a>, the discharge through the pit is permanently extracted from the 2D domain. Alternatively, unconnected C, Q, R or W pits can be treated as an ERROR. For C, R and W pits, the default width, contraction and weir coefficients are used – to vary from these use a 1d_nwk layer for the pits.
</td>
<td style="text-align:left;">
Char (4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
VP_Network_ID
</td>
<td style="text-align:left;">
VP_Network ID (as an integer) used to determine which outlet(s) the flow into the inlet pits discharges from (if any). Separate or independent networks should have a different network ID. VP_Network_ID should be a positive integer as some negative integer numbers are reserved for special purposes.
</td>
<td style="text-align:left;">
(Positive)<br />
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
For a VPI or Q pit, the name of a pit inlet type in the <a href="#ecfPitInletDatabase">Pit Inlet Database</a> (see Section <a href="#Pits-3"><strong>??</strong></a>). Not used for other pits.
</td>
<td style="text-align:left;">
Char (32)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
VP_Sur_Index
</td>
<td style="text-align:left;">
<p>Only used for VPI pits if using the HPC solver (not used by the Classic solver). If the total flow into the VPIs on the same VP_Network_ID exceeds the maximum outflow capacity of the VPOs of that VP_Network_ID (see Qmax below), one or more of the VPI flow rates must be modified. The surcharge index is used to determine how VPI flows are adjusted. The VPIs with the lowest surcharge index are given priority.</p>
<p>When the total inflow of all VPIs exceeds the total capacity of all VPOs for a VP_Network_ID, the VPI inflow with the lowest surcharge index is reduced. If this VPI’s inflow is reduced to zero, this VPI is permitted to become an outlet (i.e. surcharge) with the flow rate up to but not exceeding its maximum outflow (see QMax below). If the total inflow of all remaining VPIs exceeds the maximum outflow plus the maximum outflow of this VPI, then the VPI with the next highest surcharge index is adjusted using the same methodology. To prevent a VPI from surcharging, set QMax to zero.</p>
<p>For example, the ground level at the VPI could be used for the surcharge index, in which case the lowest VPIs surcharge first. However, if you have reliable data for the order in which they tend to surcharge this could be used. The virtual pipe network is flow conserving, but not necessarily energy conserving. The highest VPI could be incorrectly specified with the lowest surcharge index in which case water would be flowing uphill!</p>
<p>VPI for the Classic solver: Not used.</p>
VPO, C, Q and W: Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
VP_QMax
</td>
<td style="text-align:left;">
<p>VPI and VPO if using the HPC solver:<br />
For VPOs the maximum flow that can discharge back into the 2D domain. For VPIs the maximum surcharge capacity or flow back on to the 2D domain. To prevent a VPI from surcharging enter a QMax of 0.0 (zero).</p>
<p>If the total flow capacity (sum of QMax values for VPOs on the same VP_Network_ID) of the VPOs is reached, the inflow to VPIs is restricted and/or surcharged at the VPIs using VP_Sur_Index value above.</p>
<p>R pits: Sets the height of the pit section in the vertical plane.</p>
<p>VPI and VPO for the Classic solver: Not used.</p>
C, Q and W: Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Width
</td>
<td style="text-align:left;">
<p>For C pits the diameter of the pit inlet cross-section in the vertical plane. For R and W pits, the width of the pit inlet section in the vertical plane.</p>
<p>For Q and VPI pits the multiplier of width in Pit Inlet Database.</p>
For all pits the width is also used to determine the number of 2D cells to connect.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Conn_2D
</td>
<td style="text-align:left;">
<p>Used to control the connection type. For pits this field must be blank or set to “SX”. If set to blank, is treated as a SX connection.</p>
Other options may be provided in the future.
</td>
<td style="text-align:left;">
Char (8)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
<p>Overwrite the automatically determined number of connected 2D cells (see Width attribute above).</p>
<ul>
<li>A positive value increases the number of automatically selected 2D cells by the value of Conn_No.<br />
</li>
<li>If negative, this ignores the automatic approach and fixes the number of 2D cells connected to the absolute value of Conn_No. For example, a value of -1 would only connect the pit or node to one (1) 2D cell irrespective of the width.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
The percentage blockage (%) of the pits. Reduces the flow capacity through the pit by the specified amount. For VPI and VPO pits this feature was introduced for Build 2016-03-AB, and for C, Q, R and W pits it was introduced for Build 2018-03-AA. Prior to these builds the pBlockage attribute was reserved and not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Number of (same type of) pits represented by the pit channel. This optional attribute was introduced for Build 2018-03-AA.</li>
</ul>
This value will also affect the width value used to determine how many 2D cells to connect to. For example, a value of 2 will double the connection width.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Lag_Approach
</td>
<td style="text-align:left;">
<p>Sets the lag approach, as described in Section <a href="#Virtual-Pipes-2"><strong>??</strong></a>:</p>
<ul>
<li>“None” or Blank - no lag is applied.</li>
<li>“Shift” - Shift method applied.</li>
<li>“Decay” - Decay method applied.</li>
</ul>
This optional attribute was introduced for Build 2023-03-AB.
</td>
<td style="text-align:left;">
Char (8)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Lag_Value
</td>
<td style="text-align:left;">
Lag value in hours. This optional attribute was introduced for Build 2023-03-AB.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="Conn-Pits-Nds-4"><span class="header-section-number">5.11.2.3</span> Connecting Pits and Nodes to 2D Domains<a href="#Conn-Pits-Nds-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Both pits and nodes can be automatically connected to 2D domains using
the 1d_nwk Conn_1D_2D attribute (see Table <a href="#tab:tab-PitsAttributeDescriptions">42</a> and Table <a href="#tab:tab-PitsModelNetwork">41</a>). If Conn_1D_2D is set to
“SX”, TUFLOW automatically connects the upstream end of the pit channel
or node to the 2D domain. The 2D cell must be active (Code = 1). If no
active 2D cells are found a <a href="https://wiki.tuflow.com/TUFLOW_Message_2122">WARNING 2122</a> or <a href="https://wiki.tuflow.com/TUFLOW_Message_2123">2123</a> is
issued. For Classic M2D models <a href="https://wiki.tuflow.com/TUFLOW_Message_2037">WARNING 2037</a> is given if there is overlapping 2D domains and
more than one 2D cell is active.</p>
<p>The command <a href="#ecfPitDefault2DConnection">Pit Default 2D Connection</a> can
be used to set the global default value for the 1d_nwk Conn_1D_2D
attribute.</p>
<p>By default TUFLOW will connect the 1D pit channel or node to one or more 2D cells at
pit connections. The number of 2D cells selected is a function of the
flow (connection) width of the pit inlet (including the effects of the Number_of and
Width_or_Dia 1d_nwk attributes), or the total flow width of the channels
connected to the node. The total width of the 2D cells selected is
always more than the pit inlet width or width of channels. For example,
a width of 3.6m on a 2m grid selects two cells. The advantage of
selecting more than one 2D cell is to provide enhanced stability at the
1D/2D connection when the 1D flow width exceeds the 2D cell size. The
number of 2D connection cells is limited to 10 per pit inlet.</p>
<p>The 1d_nwk Conn_No attribute can be used to change the number of 2D
cells connected as follows.</p>
<ul>
<li>A positive value adds that number of 2D cells to the automatic number.
In the example above, if Conn_No is set to 1, three (2 + 1) 2D cells
are connected. The upper limit is 10 connected cells.<br />
</li>
<li>If Conn_No is negative, this ignores the automatic approach and fixes
the number of 2D cells connected to the absolute value of Conn_No. For
example, a value of -1 would only connect the pit or node to one (1)
2D cell irrespective of the connection width.</li>
</ul>
<p>If more than one 2D cell is being connected, there are two approaches
available for how the 2D cells are selected.</p>
<ul>
<li>For pits, the default is the G (on Grade) option that selects the 2nd,
3rd, etc… cells by traversing to the next highest 2D cell that
neighbours the 2D cell(s) already selected (this includes diagonal
cells, i.e. all 8 cells around a cell are considered). These cells are
also automatically lowered to the same height as the first cell so
that their ZC value is at or below the pit inlet.</li>
<li>For nodes, the default is the S (Sag) option that selects the 2nd,
3rd, etc… cells by traversing to the next lowest 2D cell. The ZC
values of these cells are not changed as they are already at or below
the node invert.<br />
</li>
<li>The above approaches can be changed using the G (Grade) and S (Sag)
flags for the 1d_nwk Conn_1D_2D attribute. The G approach is that
adopted by default for pits and S for nodes. To override the default
approach, specify G or S as appropriate. For example, if the S
approach is preferred for a pit that is draining a depression, specify
an S flag for the Conn_1D_2D attribute (i.e. “SXS”). Note SX must come
first before an optional flag is specified.<br />
</li>
<li>Note: If <a href="#tcfDefaults">Defaults</a> == PRE 2008-08 is specified, the
original approach of only selecting one 2D cell is used, irrespective
of the Conn_1D_2D and Conn_No values.</li>
<li>If using SGS, the on Grade and Sag approaches are applied based on the minimum SGS elevations of the cells.</li>
</ul>
<p>Note that the conventional approach of using 2d_bc SX points or lines
can still be used to connect 1D channel ends. This gives the user
complete control over which 2D cells are selected and is often
preferred in situations where large 1D structures are being connected to
2D cells.</p>
<h3 class="hasAnchor" id="DD-Database-3"><span class="header-section-number">5.11.3</span> Pit Inlet and Depth/Stage vs Discharge Databases<a href="#DD-Database-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pit channels can be specified as a Q Type, where flow through the pit is
controlled by a depth-discharge curve defined within the <a href="#ecfPitInletDatabase">Pit Inlet
Database</a>. The database is similar to the <a href="#tcfBCDatabase">BC
Database</a> and is described below. The alternative naming
convention <a href="#ecfDepthDischargeDatabase">Depth Discharge Database</a>
performs the exact same function and can be used instead of <a href="#ecfPitInletDatabase">Pit Inlet
Database</a>. Only a single Depth Discharge or Pit
Inlet Database should be used.</p>
<p>The database is a .csv file usually set up and managed in a Microsoft
Excel spreadsheet. The database file sources depth-discharge curves in
other .csv files that are also usually set up and managed within the
same Excel spreadsheet. The TUFLOW Microsoft Excel macro can be used to
export these csv files from the parent spreadsheet. It is available to
download at no cost from
<a href="https://www.tuflow.com/downloads/#utilities">www.tuflow.com</a>. The
format of the Pit Inlet Database is described in Table <a href="#tab:tab-DatabaseFormat">43</a>.</p>
<table>
<caption>
<span id="tab:tab-DatabaseFormat">Table 43: </span><strong>Pit Inlet Database Format</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Contains the pit inlet type as referenced by the 1d_nwk Inlet_Type attribute (see Table <a href="#tab:tab-PitsModelNetwork">41</a>).
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Contains the name of the source .csv file that contains the depth-discharge curve.
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
The heading label of the column containing depth within the source .csv file.
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
The heading label of the column containing flow within the source .csv file.
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
The pit inlet’s nominated full flow area in m<sup>2</sup> . Note that the flow area is only used to output a velocity for the pit channel (i.e. it does not have any influence over the hydraulic calculations).
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
<p>The pit inlet’s nominated flow width in m. The width is used for the automatic selection of 2D cells when connecting to a 2D domain (see Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a>) and for extending the depth discharge curve.</p>
Note: When width is set in 1d_nwk or 1d_pit layer for Q and VPI pits the width will multiply width in the Pit Inlet Database.
</td>
</tr>
</tbody>
</table>
<p>Figure <a href="#fig:fig-image53">35</a> shows an example of a <a href="#ecfPitInletDatabase">Pit Inlet
Database</a> .csv file. For the example, if the
1d_nwk Inlet_Type attribute is set to “M”, TUFLOW searches the first
column (Name) until it finds “M” as highlighted in green in the image
below. The source .csv file, pit_inlet_curves.csv is opened and the
occurrence of the labels “Depth” (shaded yellow) and “Type M” (orange)
on the same line in pit_inlet_curves.csv are searched for. The numeric
values for these two columns, as shown in the second image below in
yellow and orange, are read and applied as the depth-discharge
relationship for the Q pit channel.</p>
<center>
<img src="images/image52.png" width="80%" style="display: block; margin: auto;" />
</center>
<!-- EFC to update figure if someone gives spreadsheet-->
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image53"></span>
<img src="images/image53.png" alt="**Example of Pit Inlet Database**" width="80%" />
<p class="caption">
Figure 35: <strong>Example of Pit Inlet Database</strong>
</p>
</div>
</center>
<p>The depth-discharge curve is applied and extrapolated as follows:</p>
<ul>
<li>The first coordinate on the curve must be 0, 0 (i.e. zero flow at zero
depth).</li>
<li>The depth and flow must be in metres and m<sup>3</sup>/s or feet and
ft<sup>3</sup>/s if the model is running in US Customary Units (see
<a href="#tcfUnits">Units</a>).</li>
<li>The depth and flow data entries should be specified as positive values.</li>
<li>The depth value used to derive the discharge through the pit channel
is taken as the water level in the 2D domain less the pit invert
(usually the ground/2D level). If the downstream water level of the
pit channel rises above the pit invert, the depth value used for
deriving the pit channel flow is the difference in water level. This
provides a smooth transition from upstream controlled flow to drowned
flow. If the pit channel starts to be surcharged (i.e. flow is
reversed), the flow is extracted from the depth-discharge curve using
the downstream water level less the upstream water level (pit invert
if dry) as the depth value, and is applied as a negative discharge so
that flow surcharges from the pipe network onto the 2D domain.</li>
<li>If required the curve is extrapolated. An “effective” flow width of
the pit inlet is calculated that gives the same flow at the top of the
curve as would orifice flow. The orifice flow equation is then used to
extend the curve indefinitely, using the equation:</li>
</ul>
<p><span class="math display" id="eq:equ-orifice-flow">\[\begin{equation}
Q = 0.6\frac{2}{3}y_{top}w_{effective}\ \sqrt{2g(y - 0.6\ \frac{2}{3}\ y_{top)}}
\tag{31}
\end{equation}\]</span></p>
<p>Table <a href="#tab:tab-PitFlowRegimes">44</a> presents the different Q pit flow regimes. These are
output to the .eof file next to the velocity and flow values, and to the
_TSF and _TSL output layers (see Sections <a href="#EOF-2"><strong>??</strong></a> and
<a href="#TS-GIS-3"><strong>??</strong></a>).</p>
<table>
<caption>
<span id="tab:tab-PitFlowRegimes">Table 44: </span><strong>Q Pit Flow Regime Flags</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Regime
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
The depth-discharge point is within the bounds of the Q pit curve provided.
</td>
</tr>
<tr>
<td style="text-align:left;">
O
</td>
<td style="text-align:left;">
The depth is over (exceeds) the highest depth in the Q pit curve and the extrapolated orifice flow equation is being used.
</td>
</tr>
<tr>
<td style="text-align:left;">
R
</td>
<td style="text-align:left;">
Reverse (negative) flow is occurring.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="Xfall-4"><span class="header-section-number">5.11.3.1</span> Road Crossfall Options<a href="#Xfall-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The command <a href="#ecfPitDefaultRoadCrossfall">Pit Default Road Crossfall</a>
increases the depth at Q pits based on the crossfall slope of the road
cross-section. This approach aims to account for changes in ground
elevation that occur at a finer scale than the 2D cell resolution.
TUFLOW calculates the water depth that is used by the <a href="#ecfPitInletDatabase">Pit Inlet
Database</a> using an adjacent side triangle depth
approach, instead of the actual cell flow depth. This is shown in Figure <a href="#fig:fig-image54">36</a>. The resulting triangle has the same area as the vertical flow area
in the 2D cell the pit is connected to (i.e. the triangle’s area is the
depth in the 2D cell times the width of the cell).</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image54"></span>
<img src="images/image54a.png" alt="**Road Crossfall Option**" width="80%" />
<p class="caption">
Figure 36: <strong>Road Crossfall Option</strong>
</p>
</div>
</center>
<p>Use of this command can improve the ability to capture water from 2D
cells into pits feeding the pipe network. Especially for larger cell
sizes, the shallow depth that can occur in the cell can be
unrepresentative of the depth at the entrance to the pit, therefore
restricting the amount of flow entering the pit. The larger depth using
an equivalent triangle will push more water into the pit providing a
more realistic representation of the pit’s capture.</p>
<p><strong>Note: If using the Sub-Grid Sampling (SGS), and the underlying DEM has good representation
of the road cross-profile, this feature is not needed and should not be used.</strong></p>
<h3 class="hasAnchor" id="Manholes-3"><span class="header-section-number">5.11.4</span> Manholes<a href="#Manholes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Manholes are used at pipe junctions for maintenance access and where
there is a change in pipe configuration and/or inlet pit flow entry.
Flow energy is dissipated due to:</p>
<ul>
<li>Expansion/contraction of flow within the manhole chamber and outlet
culverts, see Figure <a href="#fig:fig-manhole-entry-exit-losses">37</a>.<br />
</li>
<li>Change in direction of the culverts (e.g. at a bend), see Figure <a href="#fig:fig-manhole-bend-losses">38</a>.<br />
</li>
<li>Change in height and/or invert level of the adjoining culverts, see Figure <a href="#fig:fig-manhole-drop-losses">39</a>.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-manhole-entry-exit-losses"></span>
<img src="images/manhole_entry_exit_losses.png" alt="**Flow Expansion/Contraction at a Manhole**" width="30%" />
<p class="caption">
Figure 37: <strong>Flow Expansion/Contraction at a Manhole</strong>
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-manhole-bend-losses"></span>
<img src="images/manhole_bent_losses.png" alt="**Change in Flow Direction at a Manhole**" width="30%" />
<p class="caption">
Figure 38: <strong>Change in Flow Direction at a Manhole</strong>
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-manhole-drop-losses"></span>
<img src="images/manhole_drop_losses.png" alt="**Change in Inlet/Outlet Height at a Manhole**" width="30%" />
<p class="caption">
Figure 39: <strong>Change in Inlet/Outlet Height at a Manhole</strong>
</p>
</div>
<p>The presence of a manhole will override the exit loss of any culvert
discharging into the manhole and the entrance loss of any culvert taking
flow out of the manhole. Therefore, the corresponding Entry_Loss and
Exit_Loss attributes of the culverts in the 1d_nwk layer are not used
(see Section <a href="#Engelund-4"><strong>??</strong></a> and the notes on these attributes in Table <a href="#tab:tab-CulvertsAttributeDescriptions">22</a> for more information).</p>
<p>There are three different types of manholes:</p>
<ul>
<li>“C” for circular chambers.<br />
</li>
<li>“R” for rectangular chambers.<br />
</li>
<li>“J” for culvert junctions without a chamber.</li>
</ul>
<p>And three different energy loss approaches:</p>
<ul>
<li>“NO” no special manhole losses (the standard entry/exit losses of the
connected culverts apply).<br />
</li>
<li>“EN” for the Engelund loss approach (this is the default approach).<br />
</li>
<li>“FX” for the Fixed loss approach.</li>
</ul>
<p>The manhole loss approach can be selected globally using the command, <a href="#ecfManholeDefaultLossApproach">Manhole Default Loss Approach</a>.</p>
<p>The manhole types, loss methods and dimensions are output in the <a href="https://wiki.tuflow.com/Check_Files_1d_mhc">_mhc_check</a> file.</p>
<h4 class="hasAnchor" id="Auto-MH-4"><span class="header-section-number">5.11.4.1</span> Automatically Assigned Manholes<a href="#Auto-MH-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>By default, manholes are automatically created at all culvert junctions
(nodes) where the following conditions are met.</p>
<ul>
<li>There is at least one incoming and one outgoing culvert – a culvert is
a C, I or R channel.<br />
</li>
<li>There are no open channels connected (i.e. no bridges, weirs or any
other channel that is not a culvert/pipe).<br />
</li>
<li>Pit channels can be connected, but are not included in any of the
calculations for determining manhole energy losses. Note, however, that
the connection of a pit to a manhole (or multiple pits via the
Number_of 1d_nwk pits attribute) may influence the default Engelund
losses indirectly via the introduction of additional flow to the pipe
network.</li>
</ul>
<p>Three different approaches to the sizing of automatic manholes and the
application of losses are available through the .ecf command <a href="#ecfManholeApproach">Manhole
Approach</a>. The current default is Method C. This is
the preferred approach unless backward compatibility is required for
legacy reasons. Further details on Methods A and B may be found by
referring to the 2018 Manual, Release Notes of previous TUFLOW builds, or by
contacting <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<p>The type of manhole assigned is set using <a href="#ecfManholeDefaultType">Manhole Default
Type</a>. If <a href="#ecfManholeDefaultType">Manhole Default
Type</a> is not specified the default is to assign
a C, R or J types based on the size and configuration of culverts
connected to the manhole (see <a href="#ecfManholeDefaultType">Manhole Default
Type</a> for more information).</p>
<p>The minimum diameter/width of a manhole chamber is controlled by
<a href="#ecfManholeMinimumDimension">Manhole Minimum Dimension</a>, and the
default side clearance and clearance between culverts is set using
<a href="#ecfManholeDefaultSideClearance">Manhole Default Side Clearance</a>.</p>
<p>The default energy loss approach is controlled by <a href="#ecfManholeDefaultLossApproach">Manhole Default Loss
Approach</a>.</p>
<h4 class="hasAnchor" id="OneD-mh-4"><span class="header-section-number">5.11.4.2</span> Manually Assigned Manholes (1d_mh Layer)<a href="#OneD-mh-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Manholes are manually assigned at channel ends (nodes) using a 1d_mh layer and <a href="#ecfReadGISManhole">Read
GIS Manhole</a>. Any number of 1d_mh layers can be
specified. The attributes of a 1d_mh layer are described below in Table <a href="#tab:tab-Manhole">45</a>.</p>
<p><strong>A manhole in a 1d_mh layer will override any automatically created
manhole. If a manually specified manhole occurs at the same location
more than once, the last occurrence will prevail (i.e. the last manhole
at a node will override any previously specified manholes at the same
node).</strong></p>
<p>To remove an automatically created manhole, digitise a point at the node
in a 1d_mh layer and set the Loss_Approach to “NO” (i.e. no manhole
energy losses). Note that culvert inlet/outlet losses will apply instead
in accordance with Section <a href="#culverts-pipes-3"><strong>??</strong></a>.</p>
<table>
<caption>
<span id="tab:tab-Manhole">Table 45: </span><strong>1D Manhole (1d_mh) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 12 characters in length (see ID for 1d_nwk layers). The ID is used to label the node that is created at the location of the manhole. If left blank, then the ID will be automatically assigned according to the rules for an automatically created node as discussed in Section <a href="#Nodes-2"><strong>??</strong></a>.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>“C” for circular shaped chamber.</p>
<p>“J” for a junction, but no manhole chamber.</p>
<p>“R” for rectangular shaped.</p>
If left blank, the global default type set by <a href="#ecfManholeDefaultType">Manhole Default Type</a> is used.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Loss_Approach
</td>
<td style="text-align:left;">
<p>“NO” for no manhole loss approach (the standard entry/exit losses of the connected culverts apply).</p>
<p>“EN” for the Engelund loss approach.</p>
<p>“FX” for the Fixed loss approach.</p>
If left blank, the global default type set by <a href="#ecfManholeDefaultLossApproach">Manhole Default Loss Approach</a> is used.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If set to true (i.e. “T”), the manhole is ignored and makes no contribution to the final network. Otherwise set to “F”.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Invert_Level
</td>
<td style="text-align:left;">
The bottom or bed elevation of the manhole. This attribute is also used to set the upstream and downstream inverts of connected culverts if the culverts have not been assigned an invert. If set to -99999, not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Flow_Width
</td>
<td style="text-align:left;">
The flow width in metres of the manhole (i.e. the width of the manhole perpendicular to the dominant direction of flow). For a C manhole this would be the diameter. Used to calculate the manhole flow area and velocity through the manhole.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Flow_Length
</td>
<td style="text-align:left;">
The flow length in metres of the manhole (i.e. the length of the manhole in the dominant direction of flow). For a C manhole this attribute is not used and the diameter (Flow_Width attribute) is used. Only used to calculate the storage of the node at the manhole.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
ANA
</td>
<td style="text-align:left;">
Additional storage surface area in m<sup>2</sup> for the node at the manhole.<br />
Usually set to zero.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
K_fixed
</td>
<td style="text-align:left;">
Fixed component of the calculated manhole loss coefficient. If using the Fixed approach, this is the only coefficient applied.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Km
</td>
<td style="text-align:left;">
<p>Manhole exit coefficient used by the Engelund approach.</p>
If set to zero (0), for C manholes the <a href="#ecfManholeDefaultCExitCoefficient">Manhole Default C Exit Coefficient</a> is applied, and for R manholes <a href="#ecfManholeDefaultRExitCoefficient">Manhole Default R Exit Coefficient</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
K_Bend_Max
</td>
<td style="text-align:left;">
<p>The upper limit of the combination of K<sub>Ɵ</sub> and K<sub>drop</sub> in the Engelund approach.</p>
If set to zero (0), <a href="#ecfManholeKMaximumBendDrop">Manhole K Maximum Bend/Drop</a> is applied.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
C_reserved
</td>
<td style="text-align:left;">
Reserved for future use – leave blank.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
N1_reserved
</td>
<td style="text-align:left;">
Reserved for future use – leave as zero (0).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
N2_reserved
</td>
<td style="text-align:left;">
Reserved for future use – leave as zero (0).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
N3_reserved
</td>
<td style="text-align:left;">
Reserved for future use – leave as zero (0).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="mh-direction-4"><span class="header-section-number">5.11.4.3</span> Digitising Culverts Connected to Manholes<a href="#mh-direction-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>During the simulation, a culvert is determined to be an inlet or outlet
culvert based on the <strong>flow direction</strong>, not the digitised direction of
the 1d_nwk object. Therefore, if reverse flow occurs this is taken into
account in determining the appropriate loss coefficients. However, the
pre-processing of the model assumes that the culverts have been
digitised in the predominant direction of flow. A variety of checks are
made such as whether both an inlet and an outlet culvert are connected
to a manhole, and ERRORs or WARNINGs and CHECKs are issued if there is
an incompatibility. Therefore, it is strongly recommended that the
culverts are digitised consistently in the downstream direction (i.e.
from upstream to downstream).</p>
<h4 class="hasAnchor" id="Engelund-4"><span class="header-section-number">5.11.4.4</span> Engelund Manhole Loss Approach<a href="#Engelund-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Engelund energy loss approach at manholes is based on the work of F.A. Engelund, and used by the MOUSE software <span class="citation">(<a href="#ref-DHI2009">DHI, 2009</a>)</span>. The adopted approach has been further enhanced through advice from, and discussions with, staff from Technical Services Branch of the Gold Coast City Council, Queensland, Australia. This is the default manhole loss approach.</p>
<p>The Engelund approach provides an automatic method for determining the energy loss coefficients presented below. Of note is that the coefficients are recalculated every timestep, and therefore vary depending on the flow distribution between inlet and outlet culverts and the depth of water within the manhole. The calculated values are output to the _TSL layer so they can be reviewed/checked over time.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-manhole-HGL"></span>
<img src="images/manhole_HGL.png" alt="**Engelund Energy Loss Approach at Manholes**" width="60%" />
<p class="caption">
Figure 40: <strong>Engelund Energy Loss Approach at Manholes</strong>
</p>
</div>
</center>
<ul>
<li>K<sub>entry</sub> covers the expansion of flow within the manhole at
the outlet of an inlet culvert. The coefficient overrides the exit
loss of the inlet culvert. Its time varying value is shown as the
third value for inlet culvert in the _TSL output layer.<br />
</li>
<li>K<sub>Ɵ</sub> represents the losses due to a change in direction (i.e.
a bend) between inlet and outlet culverts. K<sub>Ɵ</sub> is based on
the angle of the digitised lines of the culverts. For the inlet
culvert the last two vertices of the line are used and for the outlet
culvert the first two vertices. If the culvert line is digitised so
that it has an unrepresentative first/last segment angle (this may
occur where two parallel culverts have been digitised apart to make it
easier to visualise), a 1d_nwk connector (X Type) can be used to
connect the start/end of the culvert to the node, so that the
first/last segment is a correct representation of the culvert angle
relative to the other culverts. Refer to Section <a href="#XConnect-3"><strong>??</strong></a> for
further information.<br />
</li>
<li>K<sub>drop</sub> is the loss coefficient due to a change in invert
level and culvert height between inlet and outlet culverts.<br />
</li>
<li>K<sub>Ɵ</sub> and K<sub>drop</sub> are added and applied as an energy
loss for each outlet culvert. The calculated value is reported as the
middle value for outlet culverts in the _TSL output layer. Any
Form_Loss value assigned to the outlet culvert via the 1d_nwk layer is
also applied and will also be included in the _TSL middle value.<br />
</li>
<li>K<sub>exit</sub> covers the contraction from the manhole and
re-expansion of flow within the entrance of an outlet culvert. It overrides
the entrance loss of the outlet culvert and is the first
value for outlet culverts in the _TSL output layer.<br />
</li>
<li>K<sub>m</sub> is the manhole exit coefficient used to calculate K<sub>exit</sub>. The default value for
K<sub>m</sub> is dependent on whether the manhole is of a C or R type,
and is set using <a href="#ecfManholeDefaultCExitCoefficient">Manhole Default C Exit
Coefficient</a> or <a href="#ecfManholeDefaultRExitCoefficient">Manhole Default R
Exit Coefficient</a>.</li>
</ul>
<p>The equations used for the Engelund loss approach are provided below.</p>
<p><span class="math inline">\(Q_{p}\)</span> = Flow in culvert<br />
<span class="math inline">\(Q_{im}\)</span> = Total flow in to manhole<br />
<span class="math inline">\(Q_{om}\)</span> = Total flow out of manhole<br />
<span class="math inline">\(y_{i}\)</span> = Height of inlet culvert<br />
<span class="math inline">\(y_{o}\)</span> = Height of outlet culvert<br />
<span class="math inline">\(h_{i}\)</span> = Inlet culvert invert<br />
<span class="math inline">\(h_{o}\)</span> = Outlet culvert invert<br />
<span class="math inline">\(\theta\)</span> = Angle in degrees of inlet culvert relative to outlet
culvert<br />
(<span class="math inline">\(\theta = 0{^\circ}\)</span> when the culverts are in line,
<span class="math inline">\(\theta = 90{^\circ}\)</span> when the outlet culvert is at right angles)<br />
<span class="math inline">\(Q_{p}\)</span> = Flow in outlet culvert<br />
<span class="math inline">\(W_{m}\)</span> = Flow width in manhole = 1d_mh width attribute<br />
<span class="math inline">\(y_{m}\)</span> = Depth of water in manhole<br />
<span class="math inline">\(A_{m}\)</span> = Flow area in manhole<br />
<span class="math inline">\(A_{m}^{&#39;}\)</span> = Effective flow area in manhole<br />
<span class="math inline">\(A_{p}\)</span> = Flow area of culvert<br />
<span class="math inline">\(K_{m}\)</span> = Km 1d_mh attribute<br />
<span class="math inline">\(K_{b}\)</span> = Bend loss coefficient (1d_nwk Form_Loss attribute)<br />
<span class="math inline">\(K_{f}\)</span> = Fixed loss (1d_mh K_Fixed attribute)<br />
<span class="math inline">\(K_{Bend\_ Max}\)</span> = Upper limit to sum of <span class="math inline">\(K_{\theta}\)</span> and <span class="math inline">\(K_{drop}\)</span>
(1d_mh K_Bend_Max attribute)</p>
<p><span class="math inline">\({V_{m} = \frac{Q_{om}}{A_{m}}}\)</span><br />
<span class="math inline">\({Q_{f} = min\left( \frac{Q_{p}}{Q_{om}},1.0 \right)}\)</span><br />
<span class="math inline">\({{A^{&#39;}}_{m} = \frac{W_{m}y_{m}Q_{om}}{Q_{im}}}\)</span><br />
<span class="math inline">\({K_{entry} = \left\lbrack 1 - min\left( \frac{V_{m}}{V_{p}},1 \right) \right\rbrack^{2}}\)</span><br />
(applied as an exit loss on the inlet culvert)<br />
<span class="math inline">\({K_{\theta} = \sum_{inletpipes}^{}\left\lbrack Q_{f}\min\left( \frac{\theta^{2}}{90^{2}},\ 4\right)\right\rbrack}\)</span><br />
<span class="math inline">\({K_{drop} = \sum_{inletpipes}^{}\left\lbrack \min\left( \max\left( \frac{Q_{f}(h_{o} - h_{i})(h_{o} + y_{o} - h_{i} - y_{i})}{y_{o}y_{i}},0 \right),2 \right) \right\rbrack}\)</span><br />
<span class="math inline">\({K_{exit} = K_{m}\left( 1 - min\left( \frac{A_{p}}{{A^{&#39;}}_{m}},1 \right) \right)}\)</span><br />
(applied as inlet loss on the outlet culvert)<br />
<span class="math inline">\({K_{outlet\ pipe} = \min\left( K_{\theta} + K_{drop},K_{Bend_{Max}} \right) + K_{b} + K_{f}}\)</span><br />
(applied as loss using outlet culvert velocity)</p>
<h4 class="hasAnchor" id="FixedLoss-4"><span class="header-section-number">5.11.4.5</span> Fixed Manhole Loss Approach<a href="#FixedLoss-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Fixed loss approach applies the 1d_mh K_fixed coefficient as an
energy loss on the outlet culvert(s). This is in accordance with
publications that quote K values for different manholes based on the
velocity in the outlet culvert.</p>
<p>The energy loss is applied as an inlet loss to the outlet culvert if
K_fixed is 0.5 or less. If K_fixed exceeds 0.5, 0.5 is applied as an
inlet loss, and the remainder is applied as a form or bend loss. The
inlet loss component is shown as the first value in the _TSL output
layer, and any remainder as the second (middle) value. Any Form_Loss
value assigned to the outlet culvert via the 1d_nwk layer is also
applied and will be included in the _TSL middle value.</p>
<p>By default, K_fixed is set to zero. Therefore, to assign a K_fixed value
to any manhole using the Fixed loss approach will require using a 1d_mh
layer.</p>
<p>Note that K_fixed is also used by the Engelund loss approach as an
additional (calibration) energy loss if required.</p>
<h4 class="hasAnchor" id="JunctionLoss-4"><span class="header-section-number">5.11.4.6</span> Discussion on Approaches to Modelling Pipe Junction Losses<a href="#JunctionLoss-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The approach taken to modelling junctions and manhole losses affects the
pipe network’s energy losses and overland flood levels, especially if a
large proportion of the flow is within the pipe network. As a general
guide, the following approaches available in TUFLOW will produce the
following outcomes:</p>
<ol style="list-style-type: decimal">
<li><strong>Ideal Scenario:</strong> If you are fortunate to have the details and
budget to include manholes using 1d_mh layers, this will produce the
most reliable results. Either the Engelund approach or application
of fixed losses based on guidance within the literature, or a
combination of these, is recommended. However, in the absence of
manhole details, one of the following approaches, or a combination,
needs to be adopted.<br />
</li>
<li><strong>Least Conservative</strong> (flatter hydraulic grade lines along pipes
with lower flood levels overall): No manholes (<a href="#ecfManholesatAllCulvertJunctions">Manholes at All
Culvert Junctions</a> is set to “OFF”
and no 1d_mh layers are specified) and adjustment of structure losses
(the default) applies. In this case there will be minor losses at pipe
junctions, because the <a href="#ecfStructureLosses">Structure Losses</a> by
default will adjust the entrance and exit losses at pipe connections
down according to the approach/departure velocities (see equations
in Section <a href="#LossAdjustment-3"><strong>??</strong></a>). As the velocities are usually similar from one
pipe to the next the entrance and exit losses are reduced downwards,
often close to zero (as would be expected for a junction of two
pipes with no manhole, no change in direction and no change in
invert level).<br />
</li>
<li><strong>Middle Ground:</strong> Automatically create and size manholes and apply
the Engelund approach (the default setting). The automatic creation
of manholes may be slightly conservative as a manhole (including
junctions) is created at every closed node (a closed node occurs
where only culverts/pipes and pits are connected). If there are many short
pipes in the network an excess of manholes may result in
causing greater energy losses. However, if single very long culvert
channels are used to represent lengths of same sized pipes, any
manholes along the long pipes will not be modelled and losses will
be underestimated. In this case it is generally good practice to
split the long culvert channels into several channels (this will
also produce an improved hydraulic grade line along the pipe).<br />
</li>
<li><strong>Most Conservative</strong> (steeper hydraulic grade lines along pipes
with higher flood levels overall): No manholes (<a href="#ecfManholesatAllCulvertJunctions">Manholes at All
Culvert Junctions</a> set to “OFF”
and no 1d_mh layers specified); fixed structure losses on all
culverts (<a href="#ecfStructureLosses">Structure Losses</a> set to “FIX” is
specified or 1d_nwk “F” flag is used); and the entrance and exit
loss coefficients are not adjusted. For example if 0.5 and 1.0 are
used, this will apply the full (e.g. 0.5 and 1.0) entrance and
exit loss coefficients at the pipe junctions. It typically produces
the greatest energy losses along pipe networks, and therefore,
produces higher flood levels in upper areas.</li>
</ol>
<h2 class="hasAnchor" id="Virtual-Pipes-2"><span class="header-section-number">5.12</span> Virtual Pipes<a href="#Virtual-Pipes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Virtual pipes can be used to simulate flows in drainage networks without
full linking to a 1D model network. A depth flow relationship is applied
at inlet locations and the flow is instantaneously transferred to the
outlet location or out of the model (eg. to the ocean). No pipe details are entered, all
model inputs are defined using points defining the pit
locations (refer to Section <a href="#Pits-3"><strong>??</strong></a> below) and references to depth
flow curves:</p>
<ul>
<li>The inlet depth discharge capacity curves are specified in a <a href="#ecfPitInletDatabase">Pit Inlet
Database</a> (see Section <a href="#DD-Database-3"><strong>??</strong></a>) as per a
“VPI” or “Q” type pit in Table <a href="#tab:tab-PitsAttributeDescriptions">42</a>.<br />
</li>
<li>Using virtual pipes, the flows at the inlet and outlet can be limited.
If the outlet becomes limited, the inlet capacity is reduced and pits
can surcharge. The order in which pits are limited / surcharge is
discussed in Section <a href="#OneD-pit-4"><strong>??</strong></a>).<br />
</li>
<li>The flows and water levels for each inlet and outlet are output to
.csv files and _TS GIS layers. Note that the downstream pit level is
not known nor is needed for the calculations as the pit is always
assumed to have no downstream influence, therefore, the downstream
levels are output as 10m below the upstream level.</li>
</ul>
<p>Virtual Pipes were introduced to TUFLOW Classic and HPC in the
2018-03-AA release. Prior to build 2018-03-AA virtual pipes were only
available in TUFLOW HPC / GPU.</p>
<p>From build 2023-03-AB or later it is possible to lag virtual pipe flows from the inlet to the outlet. Two additional attributes are required, and these are output in empty files written with the 2023-03-AB or later build of TUFLOW. These additional 1d_pit attributes are described in Table <a href="#tab:tab-PitsAttributeDescriptions">42</a> below. These data are input on the inlets (VPI).</p>
<p>Two approaches are available for lagging flows, these are “Shift” and “Decay”. For the shift method, the outflow is lagged (shifted) by the lag value time, but is otherwise unchanged.</p>
<p>The decay method is based on exponential filtering of the inflow. A “current internal volume” is tracked:</p>
<p><span class="math display" id="eq:equ-VPILagDecay-1">\[\begin{equation}
Q(T) = \int_{0}^{T} [\dot{Q}_{in}\,(t)-\dot{Q}_{out}\,(t)]dt
\tag{32}
\end{equation}\]</span></p>
<p>The outflow rate is computed from the internal volume and the time constant (the Lag_Value attribute):</p>
<p><span class="math display" id="eq:equ-VPILagDecay-2">\[\begin{equation}
\dot{Q}_{out}\,(t) = \frac{Q(t)}{Lag\_Value}
\tag{33}
\end{equation}\]</span></p>
<p>Figure <a href="#fig:fig-VirtualPipeLag">41</a> below shows the lag approaches applied with a lag value of 60 seconds which is input as 0.0167 hours. All pits with the same VP Network ID (i.e. form a local network) must use the same approach and Lag_Value.</p>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-VirtualPipeLag"></span>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4d414f6a526fbe1dc43e" style="width:75%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-4d414f6a526fbe1dc43e">{"x":{"visdat":{"f69470dc1120":["function () ","plotlyVisDat"]},"cur_data":"f69470dc1120","attrs":{"f69470dc1120":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"Inflow","y":[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"hovertemplate":"%{y:.1f}<extra><\/extra>","line":{"color":"rgb(26,189,201)"},"type":"scatter","mode":"lines","inherit":true},"f69470dc1120.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"Outflow: Shift Method","y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"hovertemplate":"%{y:.1f}<extra><\/extra>","line":{"color":"rgb(212,208,15)"},"type":"scatter","mode":"line","inherit":true},"f69470dc1120.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"Outflow: Decay Method","y":[0,0,0,0,0,0,0,0,0,0,0,0,0.016666666666666666,0.049722222222222223,0.098893518518518519,0.16391195987654322,0.24451342721193417,0.32377153675840192,0.40170867781242858,0.47834686651555475,0.55370775207362888,0.62781262287240169,0.70068241249119501,0.77233770561634174,0.84279874385606923,0.9120854314584681,0.98021734093416035,1.0472137185852577,1.1130934899421701,1.1778752651098006,1.2415773440246372,1.3042177216242266,1.3658140929304894,1.4263838580483146,1.4859441270808427,1.5445117249628286,1.6021031962134482,1.6587348096098906,1.7144225627830592,1.7691821867366748,1.8230291502910636,1.8759786644528793,1.9113790200453313,1.9295227030445758,1.9306973246604997,1.9151857025828247,1.8832659408731112,1.8518781751918925,1.8210135389386941,1.7906633132897158,1.7608189247348873,1.7314719426559724,1.7026140769450395,1.6742371756626222,1.6463332227349119,1.6188943356893299,1.5919127634278412,1.5653808840373771,1.539291202636754,1.5136363492594749,1.488409076771817,1.4636022588256201,1.4392088878451932,1.4152220730477731,1.3916350384969769,1.3684411211886942,1.3456337691688824,1.3232065396827344,1.301153097354689,1.2794672123987776,1.2581427588587981,1.2371737128778182,1.2165541509965212,1.1962782484799126,1.1763402776719141,1.156734606377382,1.1374556962710924,1.1184981013332409,1.0998564663110202,1.0815255252058364,1.0635000997857391,1.0457750981226435,1.0283455131539327,1.0112064212680338,0.99435298091356661,0.9777804312316738,0.96148409071114593,0.94545935586596019,0.92970169993486096,0.91420667160261326,0.89896989374256964,0.88398706218019352,0.86925394447719029,0.85476637873590378,0.84052027242363869,0.82651160121657807,0.8127364078629683,0.7991908010652522,0.78587095438083132,0.77277310514115072,0.75989355338879827,0.74722866083231831,0.73477484981844632,0.7225286023214722,0.71048645894944762,0.69864501796695688,0.6870009343341742,0.67555091876193807,0.66429173678257247,0.65322020783619617,0.6423332043722596,0.63162765096605533,0.62110052344995437,0.61074884805912188,0.60056970059146975,0.59056020558161193,0.58071753548858507,0.57103890989710859,0.56152159473215668,0.55216290148662084,0.54296018646184385,0.53391085002081318,0.52501233585379958,0.51626213025623635,0.50765776141863239,0.49919679872832184,0.49087685208284981,0.48269557121480233,0.47465064502788901,0.46673980094409084,0.45896080426168934,0.45131145752399449,0.44378959989859457,0.43639310656695135,0.42911988812416885,0.421967889988766,0.41493509182228655,0.4080195069585818,0.40121918184260541,0.394532195478562,0.38795665888725261,0.38149071457246514,0.37513253599625734,0.3688803270629864,0.36273232161193664,0.35668678291840439,0.35074200320309762,0.34489630314971265,0.33914803143055072,0.33349556424004156,0.32793730483604089,0.3224716830887735,0.31709715503729391,0.31181220245333902,0.30661533241245004,0.30150507687224254,0.29647999225770516,0.29153865905341009,0.28667968140251993,0.28190168671247789,0.27720332526726998,0.27258326984614883,0.26804021534871303,0.2635728784262345,0.25917999711913059,0.2548603305004784,0.25061265832547047,0.2464357806867126,0.24232851767526736,0.23828970904734625,0.23431821389655713,0.23041291033161451,0.22657269515942097,0.2227964835734306,0.21908320884720675,0.21543182203308664,0.21184129166586854,0.2083106034714374,0.20483876008024679,0.20142478074557602,0.19806770106648308],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"hovertemplate":"%{y:.1f}<extra><\/extra>","line":{"color":"rgb(226,1,119)"},"type":"scatter","mode":"line","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"yaxis":{"domain":[0,1],"automargin":true,"title":"Flow (m<sup>3<\/sup>/s)","range":[0,6]},"xaxis":{"domain":[0,1],"automargin":true,"title":"Time (s)","tickvals":[0,30,60,90,120,150,180]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":true,"displaylogo":false},"data":[{"name":"Inflow","y":[0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"hovertemplate":["%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>"],"line":{"color":"rgb(26,189,201)"},"type":"scatter","mode":"lines","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"name":"Outflow: Shift Method","y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"hovertemplate":["%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>"],"line":{"color":"rgb(212,208,15)"},"type":"scatter","mode":"line+lines","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"name":"Outflow: Decay Method","y":[0,0,0,0,0,0,0,0,0,0,0,0,0.016666666666666666,0.049722222222222223,0.098893518518518519,0.16391195987654322,0.24451342721193417,0.32377153675840192,0.40170867781242858,0.47834686651555475,0.55370775207362888,0.62781262287240169,0.70068241249119501,0.77233770561634174,0.84279874385606923,0.9120854314584681,0.98021734093416035,1.0472137185852577,1.1130934899421701,1.1778752651098006,1.2415773440246372,1.3042177216242266,1.3658140929304894,1.4263838580483146,1.4859441270808427,1.5445117249628286,1.6021031962134482,1.6587348096098906,1.7144225627830592,1.7691821867366748,1.8230291502910636,1.8759786644528793,1.9113790200453313,1.9295227030445758,1.9306973246604997,1.9151857025828247,1.8832659408731112,1.8518781751918925,1.8210135389386941,1.7906633132897158,1.7608189247348873,1.7314719426559724,1.7026140769450395,1.6742371756626222,1.6463332227349119,1.6188943356893299,1.5919127634278412,1.5653808840373771,1.539291202636754,1.5136363492594749,1.488409076771817,1.4636022588256201,1.4392088878451932,1.4152220730477731,1.3916350384969769,1.3684411211886942,1.3456337691688824,1.3232065396827344,1.301153097354689,1.2794672123987776,1.2581427588587981,1.2371737128778182,1.2165541509965212,1.1962782484799126,1.1763402776719141,1.156734606377382,1.1374556962710924,1.1184981013332409,1.0998564663110202,1.0815255252058364,1.0635000997857391,1.0457750981226435,1.0283455131539327,1.0112064212680338,0.99435298091356661,0.9777804312316738,0.96148409071114593,0.94545935586596019,0.92970169993486096,0.91420667160261326,0.89896989374256964,0.88398706218019352,0.86925394447719029,0.85476637873590378,0.84052027242363869,0.82651160121657807,0.8127364078629683,0.7991908010652522,0.78587095438083132,0.77277310514115072,0.75989355338879827,0.74722866083231831,0.73477484981844632,0.7225286023214722,0.71048645894944762,0.69864501796695688,0.6870009343341742,0.67555091876193807,0.66429173678257247,0.65322020783619617,0.6423332043722596,0.63162765096605533,0.62110052344995437,0.61074884805912188,0.60056970059146975,0.59056020558161193,0.58071753548858507,0.57103890989710859,0.56152159473215668,0.55216290148662084,0.54296018646184385,0.53391085002081318,0.52501233585379958,0.51626213025623635,0.50765776141863239,0.49919679872832184,0.49087685208284981,0.48269557121480233,0.47465064502788901,0.46673980094409084,0.45896080426168934,0.45131145752399449,0.44378959989859457,0.43639310656695135,0.42911988812416885,0.421967889988766,0.41493509182228655,0.4080195069585818,0.40121918184260541,0.394532195478562,0.38795665888725261,0.38149071457246514,0.37513253599625734,0.3688803270629864,0.36273232161193664,0.35668678291840439,0.35074200320309762,0.34489630314971265,0.33914803143055072,0.33349556424004156,0.32793730483604089,0.3224716830887735,0.31709715503729391,0.31181220245333902,0.30661533241245004,0.30150507687224254,0.29647999225770516,0.29153865905341009,0.28667968140251993,0.28190168671247789,0.27720332526726998,0.27258326984614883,0.26804021534871303,0.2635728784262345,0.25917999711913059,0.2548603305004784,0.25061265832547047,0.2464357806867126,0.24232851767526736,0.23828970904734625,0.23431821389655713,0.23041291033161451,0.22657269515942097,0.2227964835734306,0.21908320884720675,0.21543182203308664,0.21184129166586854,0.2083106034714374,0.20483876008024679,0.20142478074557602,0.19806770106648308],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"hovertemplate":["%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>","%{y:.1f}<extra><\/extra>"],"line":{"color":"rgb(226,1,119)"},"type":"scatter","mode":"line+lines","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 41: <strong>Virtual Pipe Lag Methods</strong>
</p>
</div>
</center>
<h2 class="hasAnchor" id="Nodes-2"><span class="header-section-number">5.13</span> Nodes<a href="#Nodes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nodes must be defined (either automatically or manually) at the ends of channel elements. They provide storage information, and the 1D water level (the mass balance equation) is calculated at the nodes. Nodes are created in several ways:</p>
<ul>
<li>Automatically, at channel ends (Section <a href="#Auto-Node-3"><strong>??</strong></a>).<br />
</li>
<li>Manually, as digitised points in a 1d_nd or 1d_nwk layer (Section <a href="#Manual-Node-3"><strong>??</strong></a>).<br />
</li>
<li>From a pit in a 1d_pit or 1d_nwk layer (Section <a href="#Pits-3"><strong>??</strong></a>).<br />
</li>
<li>From a manhole in a 1d_mh layer (Section <a href="#Manholes-3"><strong>??</strong></a>).</li>
</ul>
<p><strong>Note: The use of the term “node” in this manual refers to <u>both</u> manually digitised nodes and nodes that are automatically created at the ends of channels where no digitised nodes exist.</strong></p>
<p>Table <a href="#tab:tab-PointObjectTypes">46</a> below lists the available node types.</p>
<table>
<caption>
<span id="tab:tab-PointObjectTypes">Table 46: </span><strong>1d_nwk Point Object Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Channel/Node
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Node
</td>
<td style="text-align:left;">
<b>Node</b><br />
(or leave blank)
</td>
<td style="text-align:left;">
Used for manually assigning nodal storage or invert levels.
</td>
</tr>
<tr>
<td style="text-align:left;">
Circular Culvert
</td>
<td style="text-align:left;">
<b>C</b>
</td>
<td style="text-align:left;">
Circular (in the vertical) pit channel inlet (see Section <a href="#OneD-pit-4"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
Depth-Discharge<br />
Pit or Channel
</td>
<td style="text-align:left;">
<b>Q</b>
</td>
<td style="text-align:left;">
A pit channel whose flow is defined by a depth-discharge curve from a database of curves (see Section <a href="#tab:tab-DatabaseFormat">43</a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
Rectangular Culvert
</td>
<td style="text-align:left;">
<b>R</b>
</td>
<td style="text-align:left;">
A rectangular (in the vertical) pit channel inlet (see Section <a href="#OneD-pit-4"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
Weir
</td>
<td style="text-align:left;">
<b>W</b>
</td>
<td style="text-align:left;">
A weir (in the vertical) pit channel inlet (see Section <a href="#OneD-pit-4"><strong>??</strong></a>).
</td>
</tr>
</tbody>
</table>
<p>Storage at a node is defined either:</p>
<ul>
<li>automatically via:
<ul>
<li>the widths and lengths of the connected channels (see Section <a href="#Auto-Node-3"><strong>??</strong></a>);<br />
</li>
</ul></li>
<li>manually via:
<ul>
<li>a user defined storage table of elevation versus surface area (NA
tables – see Section <a href="#NA-Table-4"><strong>??</strong></a>); or<br />
</li>
<li>a manually defined Node type 1d_nd or 1d_nwk point objects (see Section
<a href="#Manual-Node-3"><strong>??</strong></a>).</li>
</ul></li>
<li>a combination of the above using the Len_or_ANA attribute to add additional storage to the automatic storage.</li>
</ul>
<p>All nodes must have their storage defined by one of these approaches.</p>
<p>Note that checks are also made for the following.</p>
<ul>
<li>The lowest elevation of a node must be below the lowest channel
connected to the node.<br />
</li>
<li>The highest elevation of a node is used to detect instabilities.
Therefore, the highest elevation should be above the highest expected
water level, unless <a href="#ecfDepthLimitFactor">Depth Limit Factor</a> is used
to extend storage properties above the highest elevation.<br />
</li>
<li>The storage (surface area) of a node must not be zero at any level.</li>
</ul>
<p>It is important to note the logic in assigning node storage:</p>
<ol style="list-style-type: decimal">
<li>User defined NA tables take precedence (see Section <a href="#NA-Table-4"><strong>??</strong></a>).
The overwrite principle applies, so that if a NA table has been
previously defined, the latter NA table prevails.<br />
</li>
<li>Nodes without any NA tables assigned as for Step 1 above, and which
have one or more connected channels that have the UCS attribute left
blank or set to “Y” or “T”, have their NA table automatically
calculated from the channel widths (see Section <a href="#AutoStorageWidths-4"><strong>??</strong></a>).<br />
</li>
<li>The Len_or_ANA attribute of a node (or pit) in a 1d_nwk layer can be
used to add additional surface area to the NA table. If no NA table
exists after the above steps, and the Len_or_ANA attribute is
greater than zero, a NA table of constant surface area is created.<br />
</li>
<li>If there are any nodes remaining without a NA table, an ERROR
occurs.</li>
</ol>
<h3 class="hasAnchor" id="Auto-Node-3"><span class="header-section-number">5.13.1</span> Automatically Defined Nodes<a href="#Auto-Node-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If a node has not been digitised at the end of a channel a new node is automatically created. The ID of the
automatic node is the first ten characters of the Channel ID with a “.1” or “.2” extension. “.1” is used if
the node is at the start of the channel and “.2” if at the end in the direction digitised. If more than one channel is connected to the
created node, the Channel ID that occurs first alphanumerically is used. The automatic creation of nodes
can be switched off using <a href="#ecfCreateNodes">Create Nodes</a>. If automatic creation of Nodes is turned off, a manually defined
node must be specified at the ends of each channel in the model.</p>
<p>The automatic node approach is used in <a href="https://wiki.tuflow.com/Tutorial_M05">Tutorial Module 5</a>.</p>
<p>The nodal storage for the automatically created nodes consists of 3 parts:</p>
<ul>
<li>Storage calculated from channel/pipe widths;</li>
<li>Storage added from the len_or_ANA attribute of the connected pits/nodes/manholes; and</li>
<li>Storage above the top of channels (Section <a href="#Obvert-3"><strong>??</strong></a>).</li>
</ul>
<h4 class="hasAnchor" id="AutoStorageWidths-4"><span class="header-section-number">5.13.1.1</span> Storage Calculated Automatically from Channel Widths<a href="#AutoStorageWidths-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The channel storage is, by default, automatically assigned to the nodes at the channel’s ends. The channel storage approach is invoked using the 1d_nwk UCS attribute, see Table <a href="#tab:tab-SpecialAttributeDescriptions">35</a>. If the attribute is left blank or set to “Y” (yes) or “T” (true), the channel storage is assigned to the two nodes at the channel’s ends, with the storage split equally between the nodes.
For each node the surface area at different elevations is calculated as the product of the channel width by half the channel length. The channel slope is taken into account when distributing the storage. This approach applies for both 1D open channel networks and 1D pipe networks.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-Nodal-Storage"></span>
<img src="images/Nodal_Storage.png" alt="**Nodal Storage in Open Channel &amp; Pipe Networks**" width="80%" />
<p class="caption">
Figure 42: <strong>Nodal Storage in Open Channel &amp; Pipe Networks</strong>
</p>
</div>
</center>
<p>This approach does not require any specification of a NA table and is therefore the easiest to implement. It is suited to open channel or pipe network nodes where the storage is accurately defined using the channel widths. For example, nodes connecting channels that model the in-bank flow paths of a river. It may not be suited to, for example, floodplain areas where the storage may differ significantly from that calculated using the widths of the floodplain channels.</p>
<p>Care should be taken using this option for G or S channels that have very steep slopes – check that the resulting calculated NA table in the .eof file is satisfactory.</p>
<p>Some structures such as pits, weirs, gates and etc., are treated as ‘zero-length’ channel. These channels do <u>not</u> add storage to the connected nodes, unless a non-zero ‘Len_or_ANA’ value is specified (See Section <a href="#AutoStorageANA-4"><strong>??</strong></a>).</p>
<p>Nodal storage is <u>not</u> automatically calculated based on the channel width and length if the 1d_nwk UCS attribute is set to “N” (no) or “F” (false). This would require manual specification of an NA table (see Section <a href="#NA-Table-4"><strong>??</strong></a>).</p>
<h4 class="hasAnchor" id="AutoStorageANA-4"><span class="header-section-number">5.13.1.2</span> Additional Storage Added from Len_or_ANA Attribute<a href="#AutoStorageANA-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Len_or_ANA attribute can be used to add extra storage to the connected nodes. For example, the Len_or_ANA attribute of a 1D_nwk pit layer can be used to specify the additional nodal storage of a manhole chamber. Similarly, the Len_or_ANA attribute of a 1D_nwk weir layer can be used to set the additional nodal storages of a broad crest weir. This extra storage may also be useful for stabilising a 1D node provided relatively negligible additional amounts of storage are added. Below is the summary of 1D layers that support the Len_or_ANA attribute:</p>
<ul>
<li>1D_nwk pit or node layer;<br />
</li>
<li>1d_nd and 1d_mh layer;<br />
</li>
<li>1d_nwk weir, gate, spillway and etc.; and<br />
</li>
<li>1d_bg layer.</li>
</ul>
<p>Please see the attribute table of each layer for more details.</p>
<p>Note that a minimum storage area of 1 m<sup>2</sup> applies to all nodes (except for the upstream (ground) nodes of pit channels) for simulation stability. If any ‘Len_or_ANA’ value is less than 1 m<sup>2</sup> it might not be reflected in the NA table. This minimum value can be adjusted using the <a href="#ecfMinimumNA">Minimum NA</a> and the <a href="#ecfMinimumNAPit">Minimum NA Pit</a> commands.</p>
<h3 class="hasAnchor" id="Manual-Node-3"><span class="header-section-number">5.13.2</span> Manually Defined Nodes<a href="#Manual-Node-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Table <a href="#tab:tab-NodesAttributeDescriptions">47</a> lists the attributes required for manually created nodes in the 1d_nwk layer format, used with the <a href="#ecfReadGISNetwork">Read GIS Network</a> command. Table <a href="#tab:tab-DescriptionsNodes">48</a> lists the attributes required for manually created nodes in the 1d_nd format with the <a href="#ecfReadGISNode">Read GIS Node</a> command – essentially an updated, cutdown version of the 1d_nwk format that removes unnecessary input fields. Both formats remain supported.</p>
<p>These attribute descriptions are for basic “Node” type 1d_nwk point objects. These may be used for assigning storage and invert levels to channels. They can also be used to automatically link 1D nodes to the 2D domains (without the need to digitise objects within a 2d_bc layer). The 1D/2D link functionality is discussed in detail within Section <a href="#OneD2DESTRYPipeNetwork-3"><strong>??</strong></a>.</p>
<p>If an ID is specified it must be unique amongst all nodes, and up to 12 characters in length. It may contain any character except for quotes and commas. As a rule, spaces and special characters (e.g. “\”), should be avoided although they are accepted. A node ID can be used for a channel (i.e. a channel and node can have the same ID), but not for another node. The Ignore attribute can be used to ignore a node. It is recommended for the 1d_nwk Type attribute that “Node” is entered to
easily distinguish nodes from channels when querying objects in the GIS, or alternatively place the nodes and pits in separate 1d_nwk layers.</p>
<p>This section does not provide information on pit type nodes (C, Q, R or W) that also use the 1d_nwk file format. Refer to Section <a href="#Pits-3"><strong>??</strong></a> for information about pit type nodes.</p>
<table>
<caption>
<span id="tab:tab-NodesAttributeDescriptions">Table 47: </span><strong>Nodes: 1D Model Network (1d_nwk) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
<p>Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas and cannot be blank. As a rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.</p>
Digitised nodes can have their ID left blank and TUFLOW will assign an ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
Leaving this attribute blank or specifying “Node” will define the point feature as a Node type. “Node” is recommended for easy identification.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
UCS
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(1)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Len_or_ANA
</td>
<td style="text-align:left;">
<p>Adds the value specified as additional nodal area (surface area in m<sup>2</sup>). If no nodal area data exists for the node, either via the UCS attribute from the connected 1d_nwk channels, or via NA table, TUFLOW automatically creates an NA table of constant surface area set to this value with an elevation range based on the US_Invert and DS_Invert values.</p>
If a negative value is specified, the absolute of this value is used as a multiplier of the node storage. For example, a value of -1.5 increases the nodal storage table (NA table) by 50% (or to reduce storage use a value between -1 and 0). Increasing storage can be useful to stabilise problematic 1D nodes, provided that the added storage does not adversely distort the results. This multiplication is applied after any effect of <a href="#ecfMinimumChannelStorageLength">Minimum Channel Storage Length</a>. <a href="#ecfMinimumNA">Minimum NA</a> is applied after the multiplication.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n_nF_Cd
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
US_Invert
</td>
<td style="text-align:left;">
If no NA table exists and Len_or_ANA is greater than zero, used to set the upper elevation of the NA table. Note that in this case if US_Invert is less than DS_Invert, US_Invert is set to the DS_Invert plus 5 metres.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
DS_Invert
</td>
<td style="text-align:left;">
<p>If no NA table exists and Len_or_ANA is greater than zero, used to set the bottom elevation of the NA table.</p>
<p>Also used to set the upstream and downstream inverts of connected open channels, culverts/pipes and other channel types – as an example see discussion for US_Invert in Table <a href="#tab:tab-AttributeDescriptions">20</a>. Also see Section <a href="#channel-invert-4"><strong>??</strong></a>.</p>
If set to -99999, not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Form_Loss
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Inlet_Type
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(256)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
<p>Used to specify a “SX” or “SXZ” flag that automatically creates a 2D SX cell and connection at the 2D cell within which the 1D node occurs. This negates the need to create SX objects in a 2d_bc layer (see Flags attribute in Table <a href="#tab:tab-ConditionsAttribute">78</a>). Notes:</p>
<ul>
<li>“SXZ” flag lowers the 2D cell centre elevation to match the invert of the 1D node (i.e. channel or pipe end). If using the SGS functionality (Section <a href="#SGS-3"><strong>??</strong></a>), the lowered 2D cell retains the original cell volume versus depth curve, but the minumum cell elevation is lowered to match the invert of the 1D node. The lowered cell can be made flat as per the traditional sampling (non-SGS) approach, using the <a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> command. However, if the underlying DEM has good representation the ground elevation of the structure inlet/outlet, it is not recommended to use the “Z” flag.</li>
<li>By default, if more than one 2D cell is automatically connected, nodes are assumed to be connected using the Sag (S) approach (see Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a>). To override the default approach, specify “SXG” for an on-grade connection.<br />
</li>
<li>From 2017 onwards, the SXL option is no longer supported for Nodes (Type = Node or blank). SXL is only available for Pit objects (Type = C, Q, R, W).
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Conn_No
</td>
<td style="text-align:left;">
If “SX” is specified for Conn_1D_2D, can be used to control the number of 2D cells connected. See Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a> for a discussion on how the 2D cells are selected.</li>
</ul>
<p>The number of 2D cells connected can be controlled by using:</p>
<ul>
<li>A positive value increases the number of automatically selected 2D cells by the value of Conn_No.<br />
</li>
<li>A negative value, this ignores the automatic approach and fixes the number of 2D cells connected to the absolute value of Conn_No. For example, a value of -1 would only connect the pit or node to one (1) 2D cell irrespective of the width.</li>
</ul>
Note that if a culvert with more than one barrel is connected to the node, the number of barrels is used to set the width, which controls the number of automatically selected SX cells.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Width_or_Dia
</td>
<td style="text-align:left;">
If “SX” is specified for Conn_1D_2D, can be used to control the number of 2D cells connected. For example, if a width of 3.6m is entered on a 2m grid, two boundary cells are automatically created and connected.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:left;">
Height_or_WF
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
Number_of
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
HConF_or_WC
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
WConF_or_WEx
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
EntryC_or_WSa
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
ExitC_or_WSb
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-DescriptionsNodes">Table 48: </span><strong>1D Model Network (1d_nd) Attribute Descriptions for Nodes</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
<p>Unique identifier up to 12 characters in length. It may contain any character except for quotes and commas and cannot be blank. As a rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.</p>
Digitised nodes can have their ID left blank and TUFLOW will assign an ID.
</td>
<td style="text-align:left;">
Char(12)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
Not used for Nodes although it can be recommended to type in “Node” for easy identification.
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
If a “T”, “t”, “Y” or “y” is specified, the object will be ignored (T for True and Y for Yes). Any other entry, including a blank field, will treat the object as active.
</td>
<td style="text-align:left;">
Logical
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Bed_Level
</td>
<td style="text-align:left;">
<p>If no NA table exists and Len_or_ANA is greater than zero, used to set the bottom elevation of the NA table.</p>
<p>Also used to set the upstream and downstream inverts of connected open channels, culverts/pipes and other channel types – as an example see discussion for US_Invert in Table <a href="#tab:tab-AttributeDescriptions">20</a>. Also see Section <a href="#channel-invert-4"><strong>??</strong></a>.</p>
If set to -99999, not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
ANA
</td>
<td style="text-align:left;">
<p>Adds the value specified as additional nodal area (surface area in m<sup>2</sup>). If no nodal area data exists for the node TUFLOW automatically creates an NA table of constant surface area using this value.</p>
If a negative value is specified, the absolute of this value is used as a multiplier of the node storage. For example, a value of 1.5 increases the nodal storage table (NA table) by 50% (or to reduce storage use a value between -1 and 0). Increasing storage can be useful to stabilise problematic 1D nodes, provided that the added storage does not adversely distort the results. This multiplication is applied after any effect of <a href="#ecfMinimumChannelStorageLength">Minimum Channel Storage Length</a>. <a href="#ecfMinimumNA">Minimum NA</a> is applied after the multiplication.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Conn_1D_2D
</td>
<td style="text-align:left;">
<p>Used to specify a “SX” or “SXZ” flag that automatically creates a 2D SX cell and connection at the 2D cell within which the 1D node occurs. This negates the need to create SX objects in a 2d_bc layer (see Flags attribute in Table <a href="#tab:tab-ConditionsAttribute">78</a>).</p>
<p>Notes:</p>
<ul>
<li>“SXZ” flag lowers the 2D cell centre elevation to match the invert of the 1D node (i.e. channel or pipe end). If using the SGS functionality (Section <a href="#SGS-3"><strong>??</strong></a>), the lowered 2D cell retains the original cell volume versus depth curve, but the minumum cell elevation is lowered to match the invert of the 1D node. The lowered cell can be made flat as per the traditional sampling (non-SGS) approach, using the <a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a> command. However, if the underlying DEM has good representation the ground elevation of the structure inlet/outlet, it is not recommended to use the “Z” flag.</li>
<li>By default, if more than one 2D cell is automatically connected, nodes are assumed to be connected using the Sag (S) approach (see Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a>). To override the default approach, specify “SXG” for an on-grade connection.<br />
</li>
<li>From 2017 onwards, the SXL option is no longer supported for Nodes (Type = Node or blank). SXL is only available for Pit objects (Type = C, Q, R, W).
</td>
<td style="text-align:left;">
Char(4)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Conn_Width
</td>
<td style="text-align:left;">
If “SX” is specified for Conn_1D_2D, can be used to control the number of 2D cells connected as follows. See Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a> for a discussion on how the 2D cells are selected.</li>
</ul>
<p>The number of 2D cells connected can be controlled by using:</p>
<ul>
<li>A positive value increases the number of automatically selected 2D cells by the value of Conn_No.<br />
</li>
<li>If negative, this ignores the automatic approach and fixes the number of 2D cells connected to the absolute value of Conn_No. For example, a value of -1 would only connect the pit or node to one (1) 2D cell irrespective of the width.</li>
</ul>
Note that if a culvert with more than one barrel is connected to the node, the number of barrels is used to set the width, which controls the number of automatically selected SX cells.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
R1
</td>
<td style="text-align:left;">
Reserved for future use
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
R2
</td>
<td style="text-align:left;">
Reserved for future use
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
R3
</td>
<td style="text-align:left;">
Reserved for future use
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="NA-Table-4"><span class="header-section-number">5.13.2.1</span> Storage Nodes (User Defined NA Tables)<a href="#NA-Table-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Storage at an existing node can be manually defined using an elevation versus surface area table (NA table – NA stands for <strong><u>N</u></strong>odal surface <strong><u>A</u></strong>rea). This provides the opportunity to accurately define the storage of the floodplain including any backwater areas that do not act as flow paths.</p>
<p>The NA table must be in a comma delimited file (.csv). By default, unique NA table csv files should be defined for each individual location where desired. Within the NA table csv file the first column lists the elevation (m or ft) information and the second column lists the corresponding surface area (m<sup>2</sup> or ft<sup>2</sup>). TUFLOW uses these inputs to define storage volume variation with height.</p>
<p>The NA table is associated with a spatial location with the model via a 1d_na layer using the ECF command <a href="#ecfReadGISTableLinks">Read GIS Table Links</a>. Similar to the other table link GIS layers (1d_xs and 1d_bg), 1d_na GIS layers and .csv files are often stored in a separate folder underneath the <em>model</em> folder (i.e. same level as the gis folder):</p>
<ul>
<li>1d_na for nodal surface area tables in TUFLOW\model\<strong>na</strong><br />
</li>
<li>1d_xs for cross-section tables in TUFLOW\model\<strong>xs</strong><br />
</li>
<li>1d_bg for bridge loss tables in TUFLOW\model\<strong>bg</strong></li>
</ul>
<p>Unlike the other table link GIS layers (1d_xs and 1d_bg) the 1d_na layer must be digitised as a point, not a line. Table <a href="#tab:tab-AreaTableLink">49</a> presents the attributes of a 1d_na GIS layer.</p>
<p>1d_na point objects do not create a 1d_nwk node, but they do assign additional storage where nodes already exist. As such, 1d_na point objects must be snapped to a 1d_nwk node point object, or the end of a channel (where automatic nodes are created).</p>
<p><a href="#ecfMinimumNA">Minimum NA</a> is useful for stabilising 1D nodes that have small surface areas, particularly at shallow depths or when wetting and drying. The <a href="#ecfMinimumNA">Minimum NA</a> value is not applied to automatically created NA tables for any node with a 1d_nwk Length_or_ANA value that is greater than 0.001m<sup>2</sup>, provided there is no NA table that has been manually specified or created from channel storages. See also <a href="#ecfMinimumNAPit">Minimum NA Pit</a>.</p>
<p><a href="#ecfMinimumChannelStorageLength">Minimum Channel Storage Length</a> can be useful to add additional storage for stability reasons to nodes at the ends of very short channels.</p>
<table>
<caption>
<span id="tab:tab-AreaTableLink">Table 49: </span><strong>1D Nodal Area Table Link (1d_na) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Source
</td>
<td style="text-align:left;">
Filename (and path if needed) of the file containing the tabular data. Must be a comma or space delimited text file such as a .csv file.
</td>
<td style="text-align:left;">
Char(50)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<b>“NA”</b>: Nodal surface area versus height table. The first column is elevation and the second surface area in m<sup>2</sup>.
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Flags
</td>
<td style="text-align:left;">
No optional flags available
</td>
<td style="text-align:left;">
Char(8)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Column_1
</td>
<td style="text-align:left;">
<p>Optional. Identifies a label in the Source file that is the header for the first column of data. Values are read from the first number encountered below the label until a non-number value, blank line or end of the file is encountered.</p>
If this field is left blank, the first column of data in the Source file is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Column_2
</td>
<td style="text-align:left;">
<p>Optional. Identifies a label in the Source file that is in the header for the second column of data.</p>
If this field is left blank, the next column of data after Column_1 is used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Column_3
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Column_4
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Column_5
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Column_6
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Z_Increment
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Z_Maximum
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Skew<br />
(in degrees)
</td>
<td style="text-align:left;">
Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="channel-invert-4"><span class="header-section-number">5.13.2.2</span> Using Nodes to Define Channel Inverts<a href="#channel-invert-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>1D nodes can be used to set the inverts of connected channels. Channel inverts are sourced from either, end cross-sections (see Section <a href="#XS-End-3"><strong>??</strong></a>) or nodes if an upstream or downstream channel invert of -99999 is specified within the 1d_nwk file.</p>
<p>For this option, the basic “Node” type point objects (see Table <a href="#tab:tab-NodesAttributeDescriptions">47</a> and Table <a href="#tab:tab-DescriptionsNodes">48</a>) can be used to set the upstream and downstream inverts of any connected channels via the “DS_Invert” attribute in the 1d_nwk format, or “Bed_Level” attribute in the 1d_nd format. If both nodes and cross-sections are specified the cross-section is given higher priority (refer to Section <a href="#XS-Mid-3"><strong>??</strong></a>). This feature is useful during pipe network modelling, where cross-sections are not required (the shape is
defined by the culvert type). The downstream inverts (of incoming channels) and upstream invert (of outgoing channels) will be set to the node elevation. In order to model different incoming and outgoing inverts (for manhole drop losses) these need to be specified on the channels.</p>
<h4 class="hasAnchor" id="Nd-Auto-Conn-4"><span class="header-section-number">5.13.2.3</span> Automatically Connecting Nodes to 2D domains<a href="#Nd-Auto-Conn-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>1D nodes may be automatically connected to 2D domains using the Conn_1D_2D attribute in either the 1d_nwk (see Table <a href="#tab:tab-NodesAttributeDescriptions">47</a>) or 1d_nd (see Table <a href="#tab:tab-DescriptionsNodes">48</a>) layers. The approach is similar to the connection of 1D pits to a 2D domain and further discussion may be found in Section <a href="#Conn-Pits-Nds-4"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="Obvert-3"><span class="header-section-number">5.13.3</span> Storage Above Top of Channels<a href="#Obvert-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For 1D open channels, the storage area above the highest elevation in the CS or NA table is extended by 10 times the depth the CS or NA table. If the water level exceeds that limit, TUFLOW will exit with an ‘UNSTABLE’ 1D water level error. This limit can be adjusted using the <a href="#ecfDepthLimitFactor">Depth Limit Factor</a> command (the default value is 10).</p>
<p>For 1D pipes/culverts, the storage above the structure obvert is extended by 5m. By default, it applies 5% of the maximum surface area of the node. This small nodal area is needed to simulate the pressurised flow through pipes/culverts, noting it does not affect the conveyance of the pipe/culvert. For models where the storage contributed by culverts and bridges is significant (e.g. an urban pipe model), use <a href="#ecfStorageAboveStructureObvert">Storage above Structure Obvert</a> to minimise the storage contributed by these channels above their obvert (note that some storage is necessary to prevent a divide by zero in the equations). Note that this additional storage rarely has any demonstrable affect on the hydraulics as pipe systems tend to be conveyance dominated and the conveyance is not affected by this feature. This is easily checked by running a sensitivity test that, for example, halves (or doubles) the additional storage by changing the <a href="#ecfStorageAboveStructureObvert">Storage above Structure Obvert</a> value.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="OneD-SWMM-1"><span class="header-section-number">6</span> 1D Network Domains - EPA SWMM<a href="#OneD-SWMM-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="SWMM-Introduction-2"><span class="header-section-number">6.1</span> Introduction<a href="#SWMM-Introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter of the manual is written in USA English for the predominantly USA centered SWMM user base.</p>
<p>TUFLOW has supported 1D/2D dynamic coupling since its initial 2D solver development in 1989. Traditionally, 1D (1 Dimensional) linking and associated modeling has been applied using the ESTRY 1D solver (see Section <a href="#OneD-Introduction-2"><strong>??</strong></a>). New in the 2023-03-AF release, TUFLOW’s 1D linking and solver options have been expanded to support the EPA Storm Water Management Model (referred to herein as SWMM). As such, 1D pipe networks can now be modeled using either the ESTRY, SWMM, or a combination of the two 1D solvers. In addition to this, extra functionality, such as SWMM hydrology and SWMM Low-impact developments (LIDs) features, can now be used in TUFLOW.</p>
<p>SWMM is a widely used software program for simulating urban and non-urban watersheds’ hydrologic and hydraulic behavior. Developed in the early 1970s by the Environmental Protection Agency (EPA), the model has since undergone numerous updates and enhancements to become one of the most used 1D stormwater runoff and water quality analysis tools globally, particularly in North America.</p>
<p>The primary uses of SWMM include designing and evaluating stormwater management practices, planning, and assessing low-impact development techniques, and developing models for floodplain mapping and emergency response planning. The software allows users to simulate a wide range of storm events and analyze the impact of a range of factors, such as land use changes, climate variability, and water quality control measures, on the performance of stormwater management systems. More information about SWMM can be found on the <a href="https://www.epa.gov/water-research/storm-water-management-model-swmm">EPA website</a>.</p>
<h3 class="hasAnchor" id="TUFLOW-SWMM-Capabilities-3"><span class="header-section-number">6.1.1</span> TUFLOW-SWMM Capabilities<a href="#TUFLOW-SWMM-Capabilities-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Combined TUFLOW (2D) and SWMM (1D) models have a variety of applications and capabilities. Features built into TUFLOW-SWMM include:</p>
<ul>
<li>1D/2D SWMM/TUFLOW linkage through direct connections (TUFLOW HX and SX).</li>
<li>All inbuilt SWMM stormwater inlet types are supported, including a wide variety of shapes. Both on-sag and on-grade stormwater inlet connections are also supported.</li>
<li>SWMM Inlets can surcharge into the TUFLOW 2D domain if the 1D pressure head exceeds the 2D water level.</li>
<li>SWMM 1D inflows can be sourced from: external boundary conditions specified in SWMM, rainfall routed through SWMM subcatchments, or via 2D linkages from TUFLOW to SWMM.</li>
<li>SWMM hydrology subcatchment routing, including allowance for infiltration, groundwater levels, evaporation, and snow melt.</li>
<li>Low-impact developments (LIDs) features for modeling green infrastructure.</li>
<li>Scenario support through the ability to combine multiple SWMM project files (inp) in a single TUFLOW model. This feature is a powerful way to explore multiple setup options without duplicating information.</li>
</ul>
<p>The <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">TUFLOW QGIS Plugin</a> has been expanded to assist with building SWMM models, linking TUFLOW-SWMM models, and viewing SWMM outputs in a GIS environment. The SWMM GIS tools are discussed in Section <a href="#SWMMGISTools-2"><strong>??</strong></a>.</p>
<p>Currently, TUFLOW does not connect the AD (advection-diffusion) module or the TUFLOW groundwater (interflow) capability to the SWMM network.</p>
<h3 class="hasAnchor" id="SWMM-UserResources-3"><span class="header-section-number">6.1.2</span> Additional SWMM User Resources<a href="#SWMM-UserResources-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This manual documentation does not duplicate SWMM information available elsewhere. Useful additional SWMM resources are listed below:</p>
<ul>
<li><a href="https://wiki.tuflow.com/TUFLOW_SWMM_Tutorial_Introduction">TUFLOW-SWMM Tutorials</a>: Topics covered by the free tutorials include:
<ul>
<li>TUFLOW-SWMM Module 1 - 1D SWMM Culverts.</li>
<li>TUFLOW-SWMM Module 2 - 1D SWMM Pipe Network / 2D TUFLOW Direct Rainfall Hydrology.</li>
<li>TUFLOW-SWMM Module 3 - 1D SWMM Pipe Network / 1D SWMM Urban Hydrology.</li>
<li>TUFLOW-SWMM Module 4 - 1D SWMM Pipe Network / 1D SWMM Urban Hydrology: Executing multiple different event simulations from a single model control file.</li>
<li>XPSWMM to TUFLOW-SWMM - How to convert an XPSWMM model to TUFLOW SWMM.</li>
</ul></li>
<li>SWMM Manuals: The following documents may be useful:
<ul>
<li><a href="https://downloads.tuflow.com/SWMM/SWMM5_Reference_Manual_Volume1_Hydrology_P100NYRA.pdf">SWMM5 Reference Manual - Volume 1 (Hydrology)</a></li>
<li><a href="https://downloads.tuflow.com/SWMM/SWMM5_Reference_Manual_Volume2_Hydaulics_P100S9AS.pdf">SWMM5 Reference Manual - Volume 2 (Hydraulics)</a></li>
<li><a href="https://downloads.tuflow.com/SWMM/SWMM5_Reference_Manual_Volume2_Hydraulics_Addendum-20220210mas2wr.pdf">SWMM5 Reference Manual - Volume 2 (Hydraulics Addendum)</a></li>
<li><a href="https://downloads.tuflow.com/SWMM/SWMM5_Reference_Manual_Volume3_Water_Quality_P100P2NY.pdf">SWMM5 Reference Manual - Volume 3 (Water Quality)</a></li>
<li><a href="https://downloads.tuflow.com/SWMM/SWMM5_User%27s_Manual.pdf">SWMM5 User’s Manual</a></li>
</ul></li>
</ul>
<h2 class="hasAnchor" id="ModelSetup-2"><span class="header-section-number">6.2</span> Model Setup<a href="#ModelSetup-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="SwmmModel-3"><span class="header-section-number">6.2.1</span> SWMM Model<a href="#SwmmModel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The SWMM portion of a TUFLOW-SWMM model is read from one or more SWMM project files (inp). These files can be created within the EPA SWMM GUI, the TUFLOW GIS tools described in Section <a href="#SWMMGISTools-2"><strong>??</strong></a>, or other tools (for example, exported from other software that have adopted SWMM 5 as their 1D solver).</p>
<p>The <a href="https://www.epa.gov/water-research/storm-water-management-model-swmm">EPA Website</a> provides documentation on SWMM model theory and setup. This manual does not contain a description of how to build SWMM models or the SWMM file formats since this information is readily available from the resources provided in Section <a href="#SWMM-UserResources-3"><strong>??</strong></a>. The <a href="https://wiki.tuflow.com/TUFLOW_SWMM_Tutorial_Introduction">TUFLOW-SWMM Tutorials</a> demonstrate how to build TUFLOW-SWMM models using the TUFLOW GIS tools.</p>
<h3 class="hasAnchor" id="TUFLOW-SWMM_Simulations-4"><span class="header-section-number">6.2.2</span> TUFLOW-SWMM Model Simulation<a href="#TUFLOW-SWMM_Simulations-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When running a TUFLOW-SWMM model, TUFLOW controls the execution of the simulation. SWMM input commands are specified within a SWMM Control File (*.tscf), documented in Appendix <a href="#TSCFCommands-1"><strong>??</strong></a>. The SWMM Control File is referenced in the TUFLOW Control File (*.tcf) using the “<a href="#tcfSWMMControlFile">SWMM Control File</a> ==” command, documented in Appendix <a href="#TCFCommands-1"><strong>??</strong></a>.</p>
<p>The SWMM Control File can reference one or more SWMM input inp files using the “<a href="#tscfReadSWMM">Read SWMM</a> ==” command. If multiple input inp files are used, TUFLOW merges the files into a single input inp before simulation. During the merger, if there are SWMM objects that are duplicate in terms of location and “Name” the item that was defined lower in the SWMM Control File (*.tscf) takes precedence. This merger approach has been adopted to allow modellers to override existing objects easily for options assessments (such as, to assess the upgrade of a section of pipe network). After the input files are merged, the final SWMM model in inp format is placed in the TUFLOW output folder. The SWMM model runs from the output folder. The SWMM report and output files are also written to the TUFLOW output folder.</p>
<h3 class="hasAnchor" id="SWMM_ESTRY_Linking-3"><span class="header-section-number">6.2.3</span> Linking SWMM to TUFLOW 2D and ESTRY<a href="#SWMM_ESTRY_Linking-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For information relating to the linking of SWMM 1D with TUFLOW 2D, and the linking of SWMM 1D to TUFLOW 1D (ESTRY), see Section <a href="#OneD2DLinkingSWMM-2"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="SWMMSettings-3"><span class="header-section-number">6.2.4</span> SWMM Simulation Option Settings<a href="#SWMMSettings-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The SWMM model settings are primarily dependent on the settings defined in the Project–Options section of the SWMM inp file. However, some settings are controlled by TUFLOW when running a TUFLOW-SWMM model, including:</p>
<ul>
<li><strong>END_DATE/END_TIME:</strong> Set based upon the SWMM START_DATE/START_TIME and the TUFLOW simulation duration.</li>
<li><strong>FLOW_UNITS:</strong> the flow units are set to match the TUFLOW simulation, either to CFS for US Customary units or CMS for metric units.</li>
<li><strong>FLOW_ROUTING:</strong> Flow routing is set to DYNWAVE.</li>
<li><strong>ALLOW_PONDING:</strong> Allow ponding is set to YES. Ponding can be prevented by setting a high Junction attribute value for “YSur” (higher than the maximum water elevation) or setting a Junction “Apond” value to 0.0. Note, it is recommended that only Junctions with TUFLOw 1D/2D HX or SX boundaries should have the Apond attribute set to 0.0, which will create flooding in the 2D domain when the Junction is surcharged.</li>
<li><strong>END_DATE/END_TIME:</strong> These are set based on the TUFLOW end time and the SWMM start time (simulation duration + start date/time = specified end date/time).</li>
<li><strong>VARIABLE_STEP:</strong> This is turned off (0). TUFLOW will control the timestep based on the HPC (Heavily Parallelised Compute) timestep and the SWMM Iterations command.</li>
</ul>
<h3 class="hasAnchor" id="SWMM-BCDB-3"><span class="header-section-number">6.2.5</span> Using the TUFLOW BC Database in SWMM<a href="#SWMM-BCDB-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The fixed structure of SWMM restricts it to the simulation of a single event per SWMM inp file. Manual definition of SWMM boundary condition inputs would become an onerous task during the execution of a project requiring simulation of multiple events. TUFLOW-SWMM has overcome this SWMM limitation by enabling the communication of boundary condition timeseries data from the TUFLOW Boundary Condition Database to SWMM. This feature upgrades SWMM to use TUFLOW’s powerful and flexible event management options. Any number of event simulations can now be executed from a single SWMM inp input file. TUFLOW automatically assigns the chosen boundary condition inputs.</p>
<p>The connection between the TUFLOW Boundary Condition Database and the SWMM model is established by using the SWMM Control File (*.tscf) command, “<a href="#tscfREADBC">Read BC &lt;curve_type&gt;</a> ==”. The “SourceType” in the SWMM inp file also needs to be set to TIMESERIES for time varying data, such as rainfall depth vs time or discharge vs time to be passed seamlessly to SWMM from TUFLOW. The SWMM Timeseries name must also be specified (matching the TUFLOW Boundary Condition Database Name). TUFLOW writes the event specific information to the SWMM inp file it creates, prior to its simulation.<a href="https://wiki.tuflow.com/TUFLOW_SWMM_Tutorial_M04">TUFLOW-SWMM Tutorial 4</a> is a demonstration of this TUFLOW-SWMM boundary condition model configuration.</p>
<h2 class="hasAnchor" id="SWMMGISTools-2"><span class="header-section-number">6.3</span> SWMM GIS Tools<a href="#SWMMGISTools-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>SWMM tools have been added to the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">TUFLOW QGIS Plugin</a> to provide users with the ability to build TUFLOW-SWMM models in a GIS environment. The tools assist with building SWMM models, linking TUFLOW-SWMM models, and viewing SWMM outputs.Three major items within the TUFLOW QGIS Plugin that are specifically relevant to SWMM include the TUFLOW QGIS plugin SWMM Processing Tools, 1D Pipe Integrity Tools, and TUFLOW Viewer.</p>
<ul>
<li><p>The <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin#Processing_Toolbox">TUFLOW QGIS Plugin SWMM Processing Tools</a> have been created to support workflow efficient model building. Tools available within the SWMM Processing Toolbox can be used for the following:</p>
<ul>
<li>Conversion of SWMM input files (inp) to and from SWMM GeoPackage file format. These converters are central to all the SWMM processing tools. They enable the conversion of SWMM inp text files into a visual GIS GeoPackage format for spatial and tabular editing. Also, the GeoPackage files can be exported to SWMM inp text file format, for use as inputs into the TUFLOW-SWMM model. The Geopackage format representation of the SWMM inp file is discussed in Section <a href="#SWMMGPKGFormat-3"><strong>??</strong></a></li>
<li>Creation of SWMM Template GeoPackage GIS files. These files include all the data required by a SWMM model, if building a model from scratch.</li>
<li>Setting of unique SWMM Junction parameters based on Junction usage and location.</li>
<li>Setting unique SWMM conduit losses, dependent on location of the object in the network and whether the conduit is connected directly to the 2D, another pipe or a stormwater inlet.</li>
<li>Semi-automatic creation of TUFLOW-SWMM 1D/2D linkages.</li>
<li>Tools to assist in the conversion of XPSWMM models to TUFLOW-SWMM.</li>
<li>Conversion of ESTRY layers to SWMM.</li>
</ul></li>
<li><p>The TUFLOW QGIS plugin <a href="https://wiki.tuflow.com/1D_Integrity_Tool">1D Pipe Integrity Tools</a> are a suite of tools that help modelers find and fix potential errors in 1D networks prior to running TUFLOW. The 1D integrity tool can be used for ESTRY or SWMM pipe networks.</p></li>
<li><p>The <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> enables GIS viewing of SWMM time-series results. The following are supported.</p>
<ul>
<li>Time-series plotting of 1D SWMM results.</li>
<li>Long-profile plotting of 1D SWMM network results.</li>
<li>Dynamic plan view symbology. This feature enables the object symbology to change based on the result magnitude at the current simulation output time.</li>
<li>The above result display options can be used within animations created by <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a>.</li>
</ul></li>
</ul>
<h3 class="hasAnchor" id="SWMMGPKGFormat-3"><span class="header-section-number">6.3.1</span> GeoPackage File Format<a href="#SWMMGPKGFormat-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The SWMM GeoPackage representation is mostly a simple conversion of the table oriented SWMM input file (inp). Some GeoPackage tables are modified versions of the SWMM input file, often combining multiple inp sections into a single GeoPackage table to streamline editing features. Some of the GeoPackage tables have spatial components (points, lines, and polygons) and others are tables of data with no geometry attributes.</p>
<p>Generally, modified tables are a “wide” form of the tables to represent distinct categories of options without using the same column for multiple input parameters. For example, the “[XSECTIONS]” table has a variety of inputs depending upon whether the shape is from a list of shapes, a custom shape (a closed shape with a Height vs Width table), irregular shape (cross-section-based open channel), or a street cross-section. In the SWMM input file, attributes from multiple types use the same columns while the GeoPackage representation creates a column for each input field. There are separate columns for specified shapes and irregular culvert curves. Depending upon the option selected, many of the fields will not be used.</p>
<p>To make things simpler, the subcatchment and subarea SWMM table columns are combined into the subcatchment table. The subarea columns use the prefix “subarea_” and are written to a separate table when exported to the SWMM inp file.</p>
<p>SWMM inp files can be converted to a GeoPackage format using the processing tool SWMM &gt;&gt; GeoPackage - Create from SWMM inp. GeoPackage format files can be exported to SWMM inp files using the processing tool SWMM &gt;&gt; GeoPackage - Write to SWMM inp. When a GeoPackage file is read into QGIS, by default a folder will be created for all of the loaded layers. Right-clicking on this folder will bring-up a menu item to export the GeoPackage file as a SWMM inp file.</p>
<p>A full description of the layers that can be included in SWMM GeoPackage files can be found in Appendix <a href="#SWMMGeopackage-1"><strong>??</strong></a>.</p>
<h2 class="hasAnchor" id="SWMMOutputs-2"><span class="header-section-number">6.4</span> SWMM Outputs<a href="#SWMMOutputs-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Model outputs are written by both SWMM and TUFLOW, which can be used to visualize model results. SWMM writes a report file (rpt) and an output file (out) in the TUFLOW results folder with the simulation prefix followed by “_swmm.” The report file can be viewed with a text editor. The output file can be viewed in EPA SWMM or 3<sup>rd</sup> party tools that support this format, such as <a href="https://www.pyswmm.org/">PySWMM</a>.</p>
<p>TUFLOW-SWMM models also output a GeoPackage time-series output file. The file is written with the other result files in the results folder, and ends with “_ts.gpkg.” This file can be read into the QGIS TUFLOW Viewer using the <a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Load_Results_-_Time_Series">Load Results - Time series</a> option from the File menu of the QGIS TUFLOW Viewer. When this file is loaded, point and line layers will be loaded, representing the node and channel results. The layer symbology can be modified to dynamically represent the model result magnitude for the current QGIS time. Profiles can be also be generated for the 1D network. Animations can be created from these results (in combination with 2D results if desired). These layers can also be used to select channels or nodes to display time series results in the TUFLOW Viewer plot windows, and can be combined with ESTRY or PO outputs. Documentation for the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">QGIS TUFLOW Plugin</a> and <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> are available in the <a href="https://wiki.tuflow.com/">TUFLOW Wiki</a>.</p>
<p>The GeoPackage time-series file contains all of the SWMM output for nodes and links (polylines). For nodes this includes, “Depth”, “Water Level”, and more. For Conduits this includes, “Flow”, “Channel Depth”, “Velocity”, “Channel Capacity” and more. Descriptions of these datasets are in the SWMM documentation. In addition, TUFLOW writes two datasets for nodes that describe flow between the 1D and 2D domains. “Flow from 2D” represents the inflow from the 2D model to the node where negative values represent flows from the 1D domain to the 2D. “Cumulative Volume from 2D” represents the total volume that goes into (positive) or out of the 1D domain from the 2D.</p>
<h2 class="hasAnchor" id="SWMMInclusionTUFLOW-2"><span class="header-section-number">6.5</span> SWMM Inclusion in TUFLOW<a href="#SWMMInclusionTUFLOW-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="SWMMLibraryVersion-3"><span class="header-section-number">6.5.1</span> SWMM Library Version<a href="#SWMMLibraryVersion-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW runs SWMM as a library, passing data between SWMM 1D and the TUFLOW 2D domains. The SWMM version used for the hydraulic calculations was created by Open Water Analytics <span class="citation">(<a href="#ref-mcdonnell_bryant_2021_5484299">McDonnell et al., 2021</a>)</span>, which is a modified version of the SWMM code.</p>
<h3 class="hasAnchor" id="SWMMCode-in-TUFLOW-3"><span class="header-section-number">6.5.2</span> Embedded SWMM Code in TUFLOW<a href="#SWMMCode-in-TUFLOW-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW has modified SWMM code (not from Open Water Analytics) primarily to enable calculation of pit (inlet) discharges and to include additional TUFLOW functionality for linking SWMM 1D to TUFLOW 2D. Details are provided below.</p>
<ul>
<li>Changes were made to how inlets are handled to better correspond to how “rating curve” based pits are treated in ESTRY and provide better handling when the water level is above the inlet invert. Pit rating curves use a depth vs discharge relationship to determine the volume of flow that passes from the 2D domain into the 1D domain. If the pipe water level is above the inlet invert, but the 2D water level is higher the discharge will be based on the 2D water level minus the 1D water level in the pipe. If the 1D pipe water level is higher, a surcharging discharge is computed using the same curve based on the 1D pipe water level minus the 2D water level. This matches the ESTRY implementation and ensures a smooth transition between inflow and surcharging.</li>
<li>The discharge for On-Grade inlets was modified to use a velocity passed from the 2D domain rather than calculating a velocity based on the SWMM 1D street cross-section and slope at the inlet.</li>
<li>The methodology for assigning On-Grade or On-Sag handling of pits (inlets) was modified in the embedded code. In SWMM, a pit (inlet) placement defined as “AUTOMATIC” determines whether a pit should be On-Sag or On-Grade based upon the topography of the SWMM 1D street layout. In a combined TUFLOW-SWMM model 1D streets may not be fully described because only the cross-section information at inlets is required because 2D flows are modeled in TUFLOW. When running SWMM inside of TUFLOW, whether to treat an automatic placement as On-Sag or On-Grade is determined dynamically based on the inflows to the connected 2D cells. The 2D model provides the approach discharge (along the street) and total discharge for the connected cells. If the approach discharge is over 85% of the total discharge, the pit is modeled as an On-Grade inlet. Otherwise, it is modeled as On-Sag. <em>Note: This approach is currently being tested and is subject to change. For production models it is recommended that users assign inlets as On-Grade or On-Sag.</em></li>
</ul>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TwoD-Domains-1"><span class="header-section-number">7</span> 2D Domains<a href="#TwoD-Domains-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="introduction-1"><span class="header-section-number">7.1</span> Introduction<a href="#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter of the Manual discusses features specifically related to 2D model domains. 1D domain features are discussed separately in Chapter <a href="#OneD-Domains-1"><strong>??</strong></a> and 1D/2D linking is discussed in Chapter <a href="#DomainLinking-1"><strong>??</strong></a>.</p>
<h2 class="hasAnchor" id="Solvers-2"><span class="header-section-number">7.2</span> Solvers<a href="#Solvers-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW solves the depth averaged 2D Shallow Water Equations (SWE). The
SWE are the equations of fluid motion used for modelling long waves such
as floods, urban stormwater inundation, dam failure hydraulics, ocean tides and storm surges. They are derived using the assumption of vertically uniform horizontal velocity and negligible vertical acceleration (i.e. a hydrostatic pressure distribution). These assumptions are valid where the wave length is much greater than the depth of water. In the case of the ocean tide, the wavelength is long, and even at the deepest parts of the ocean the SWE are applicable.</p>
<p>The 2D SWE in the horizontal plane are described by the following
partial differential equations of mass continuity and momentum
conservation in the X and Y directions for an in-plan Cartesian
coordinate frame of reference. The equations are:</p>
<p>2D Continuity:</p>
<p><span class="math display" id="eq:equ-2DContinuity-1">\[\begin{equation}
\frac{\partial h}{\partial t} + \frac{\partial(hu)}{\partial x} + \frac{\partial(hv)}{\partial y} = S
\tag{34}
\end{equation}\]</span></p>
<p>X Momentum:</p>
<p><span class="math display" id="eq:equ-x-momentum">\[\begin{equation}
\frac{\partial (hu)}{\partial t}
+ \frac{\partial (huu)}{\partial x} + \frac{\partial (hvu)}{\partial y}
- \frac{\partial \left( h \nu_t \frac{\partial u}{\partial x} \right)}{\partial x} - \frac{\partial \left( h \nu_t \frac{\partial u}{\partial y} \right)}{\partial y}
+ gh\frac{\partial (z + h)}{\partial x}
+ gh\frac{n^2\sqrt{u^2+v^2}}{h^\frac{4}{3}}u
= S_u
- \frac{h}{\rho}\frac{\partial P_a}{\partial x}
- c_f h v
+ \frac{\tau_{x,wind}}{\rho}
\tag{35}
\end{equation}\]</span></p>
<p>Y Momentum:</p>
<p><span class="math display" id="eq:equ-y-momentum">\[\begin{equation}
\frac{\partial (hv)}{\partial t}
+ \frac{\partial (huv)}{\partial x} + \frac{\partial (hvv)}{\partial y}
- \frac{\partial \left( h \nu_t \frac{\partial v}{\partial x} \right)}{\partial x} - \frac{\partial \left( h \nu_t \frac{\partial v}{\partial y} \right)}{\partial y}
+ gh\frac{\partial (z + h)}{\partial y}
+ gh\frac{n^2\sqrt{u^2+v^2}}{h^\frac{4}{3}}v
= S_v
- \frac{h}{\rho}\frac{\partial P_a}{\partial y}
+ c_f h u
+ \frac{\tau_{y,wind}}{\rho}
\tag{36}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(h\)</span> = Depth of water</li>
<li><span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> = Depth averaged velocity components in X and Y directions</li>
<li><span class="math inline">\(t\)</span> = Time</li>
<li><span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> = Distance in X and Y directions</li>
<li><span class="math inline">\(z\)</span> = Bed elevation</li>
<li><span class="math inline">\(n\)</span> = Manning’s bed friction coefficient</li>
<li><span class="math inline">\(c_f\)</span> = Coriolis force coefficient (available for TUFLOW Classic only)</li>
<li><span class="math inline">\(\nu_t\)</span> = Turbulent kinematic viscosity</li>
<li><span class="math inline">\(P_a\)</span> = Atmospheric pressure</li>
<li><span class="math inline">\(\rho\)</span> = Density of water</li>
<li><span class="math inline">\(S\)</span> = Areal volume source (volume per unit time per unit area), used for rain and infiltration</li>
<li><span class="math inline">\(S_u\)</span> and <span class="math inline">\(S_v\)</span> = Areal momentum source terms (force per unit area per unit fluid density), used for local energy losses</li>
</ul>
<p>The terms of the SWE can be attributed to different physical phenomena.
These are:</p>
<ul>
<li>Propagation of the wave due to gravitational forces.<br />
</li>
<li>Transport of momentum by advection.<br />
</li>
<li>Horizontal diffusion of momentum or sub-grid scale turbulence (see
Section <a href="#turbulence-overview"><strong>??</strong></a>).<br />
</li>
<li>External forces such as bed friction, rotation of the earth, wind,
wave radiation stresses, and barometric pressure.</li>
</ul>
<p>For further discussion relating to the SWE, please see Section <a href="#FluidFlowPhysicalTerms-3"><strong>??</strong></a>.</p>
<p>TUFLOW Classic and TUFLOW HPC use different solution schemes to solve
the SWE. Both approaches are discussed in the following Sections.</p>
<h3 class="hasAnchor" id="tuflow-hpc-2d-solver"><span class="header-section-number">7.2.1</span> TUFLOW HPC 2D Solver<a href="#tuflow-hpc-2d-solver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC is an explicit solver using a finite volume method. It computes the volume flow across cell boundaries. Volume cannot leave one cell without being placed in its neighbour. As a result, 2D volume is conserved and 2D mass error is
0%. The transfer of momentum across cell boundaries is computed in the
same way and once external forces are considered (bed slope, bottom
friction, and wet perimeters of non-uniform depth) momentum is conserved.</p>
<p>The explicit finite volume scheme applies the conservation of mass over
the cell for calculating the rate of change of cell depth. In Figure <a href="#fig:fig-image59">43</a>, the cell centre (for the cell in question) is given the notation cc, while the surrounding neighbours are given the notation n1..n4. The u velocity at the left and right faces are notated u1 and u2, and the v velocities at the bottom and top faces are notated v3 and v4. The cell width and
height are Δx and Δy respectively.</p>
<p>TUFLOW HPC uses an automatic adaptive timestep to achieve unconditional stability, as mentioned in Section <a href="#TUFLOWHPCTimestep-3"><strong>??</strong></a>. It solves the 2D SWE on a uniform Cartesian grid. Water depth/level is calculated at the cell centres, and velocity components at the cell mid-sides or faces in the same manner as TUFLOW Classic.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image59"></span>
<img src="images/image59.png" alt="TUFLOW HPC 2D SWE Finite Volume Scheme Approach"  />
<p class="caption">
Figure 43: TUFLOW HPC 2D SWE Finite Volume Scheme Approach
</p>
</div>
<p>The time rate of change for the cell averaged depth is shown in Equation <a href="#eq:equ-cell-avg-depth">(37)</a>.</p>
<p><span class="math display" id="eq:equ-cell-avg-depth">\[\begin{equation}
\frac{A\partial h}{\partial t} = \Phi_{1} - \Phi_{2} + \Phi_{3} - \Phi_{4} + S_{Q}
\tag{37}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(A\)</span> = cell area</li>
<li><span class="math inline">\(h\)</span> = depth</li>
<li><span class="math inline">\(t\)</span> = time</li>
<li><span class="math inline">\(\Phi_{1}\)</span> to <span class="math inline">\(\Phi_{4}\)</span> = the four face fluxes</li>
<li><span class="math inline">\(S_Q\)</span> = sources (rain and infiltration)</li>
</ul>
<p>The volume fluxes across the four cell sides and the net volume from
source boundaries determine the rate of volume change and the change in
depth. Source boundaries include SA, ST and RF boundaries, soil
infiltration, evaporation, and any flow linkages to 1D elements via SX
links. By computing the face fluxes for all model faces, and referencing
these when computing the depth derivative for each cell, volume
conservation is guaranteed to numerical precision. At “Head” boundaries, the above equation does not apply. Rather, the defined head (level) is directly used to calculate the water volume and associated depth in the cell.</p>
<p>The calculation of the cell side volume fluxes is available in either
1st or 2nd order spatially. For the 1st order scheme, this uses depth
of the upstream cell (often referred to as upwinding), bounded to be
greater than or equal to 0, and less than or equal to the surface
elevation of the upstream cell less the bed elevation at the cell side
mid-point. For the 2nd order scheme the depth at the face is computed as
the average of the two cell averaged depths, however, this method in its
simplest form is not total variation diminishing (TVD) and is known to
be unstable. A hybrid method is implemented in which the depth at the
cell face transitions from interpolated depth to the upstream depth (1st order upwinding)
when the solution shows short scale reversal or upstream controlled
supercritical flow.</p>
<p>The solution of the cell side fluxes includes the inertia and sub-grid
scale turbulence (eddy or kinematic turbulent viscosity) term. Turbulence is detailed further in Section <a href="#turbulence-overview"><strong>??</strong></a>. The cell side fluxes may also be factored down by flow constriction factors where sub-grid-scale obstructions exist.
<!-- PAR to EFC have removed the below and included a link to the turbulence section.

removed text:
The same options for the eddy viscosity coefficient calculation in Classic
(constant, Smagorinsky or a combination of constant and Smagorinsky) are
available, and the default values for both schemes are presently set the
same. BMT are doing further research in this area, as there is some
dependency on cell size for this term (refer to @CollecuttSyme2017).  
--></p>
<p>Due to the explicit scheme, the calculation of flux
for one cell face may be performed independently of the other faces, and
likewise the summation of flux for each cell volume may be performed
independently of the other cell volumes. Applying the same algorithm to
millions of data elements is well suited to modern multi-core CPUs,
and particularly suited to GPU hardware acceleration.</p>
<p>The 1st order approach can experience numerical diffusion, like all 1st
order schemes, and does not resolve strongly two-dimensional hydraulics
(e.g. flow expansion downstream of a constriction) as well as a 2nd
order solution. The 2nd order solution demonstrates no discernible
numerical diffusion, and resolves complex 2D hydraulics, including
hydraulic jumps as demonstrated using the UK EA Benchmark Flume Test 6A <span class="citation">Collecutt &amp; Syme (<a href="#ref-CollecuttSyme2017">2017</a>)</span>.<!-- PAR to EWC can we include the reference here--><!--done-->
<!-- PAR added next sentence--> When running HPC solver the 2nd order spatial scheme is the default and recommended approach.</p>
<p>For further details on the scheme, refer to <span class="citation">Collecutt &amp; Syme (<a href="#ref-CollecuttSyme2017">2017</a>)</span>.
Note that at the time this paper was written, the scheme utilised cell
centre definitions for velocity, which was prone to a zero-energy
‘checker-board’ mode in the solution. Subsequent to the paper, cell mid-side points were adopted for the definition of u and v velocities which has
eliminated the checker-board mode with only very minor changes to the
results.</p>
<h3 class="hasAnchor" id="tuflow-classic-2d-solver"><span class="header-section-number">7.2.2</span> TUFLOW Classic 2D Solver<a href="#tuflow-classic-2d-solver" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The scheme is unlike the TUFLOW HPC solution in that it solves the same shallow water
equations implicitly using matrices, allowing much larger timesteps (hence why it is important
to monitor mass error in implicit schemes such as TUFLOW Classic to
check that the solution is converging).</p>
<p>An Alternating Direction Semi-Implicit (ADI) finite difference method is used
for TUFLOW Classic’s computational procedure. It was originally based on
the work of <span class="citation">Stelling (<a href="#ref-Stelling1984">1984</a>)</span>. The method involves two stages per
timestep, each having two steps, giving four steps overall. Two of the steps
sweeps through the model domain solving tri-diagonal matrices, hence the “semi-implicit”. Due to the implicit solution, TUFLOW Classic is not suited to being parallelised for multi-core CPUs or for GPU acceleration.</p>
<p>Step 1 solves the momentum equation in the Y-direction for the
Y-velocities. The equation is solved using a predictor/corrector method,
which involves two sweeps. For the first sweep, the calculation proceeds
column by column in the Y-direction. If the signs of all velocities in
the X-direction are the same the second sweep is not necessary,
otherwise the calculation is repeated sweeping in the opposite
direction.</p>
<p>The second step of Stage 1 solves for the water levels and X-direction
velocities by solving the equations of mass continuity and of momentum
in the X-direction. Tri-diagonal equations are generated and solved across the 2D domain by substituting
the momentum equation into the mass equation and eliminating the
X-velocity. The water levels are calculated and back substituted into
the momentum equation to calculate the X-velocities. This process is
repeated for a recommended two iterations. Testing on a number of models
showed there to be little benefit in using more than two iterations
unless there are rapid changes in the hydraulic conditions per timestep
as may occur with modelling inundation from a dam break.</p>
<p>Stage 2 proceeds in a similar manner to Stage 1 with the first step
using the X-direction momentum equation and the second step using the
mass equation and the Y-direction momentum equation.</p>
<p>The solution as formulated by Stelling has been enhanced and improved to
provide much more robust wetting and drying of elements, upstream
controlled flow regimes (e.g. supercritical flow and upstream controlled
weir flow), modifications to cells to model structure obverts (e.g.
bridge decks) and additional energy losses due to fine-scale features
such as bridge piers.</p>
<p>TUFLOW Classic solves the 2D SWE on the same uniform Cartesian grid as used by TUFLOW HPC. Water depth/level is calculated at the cell centres, and velocity components at the cell mid-sides or faces.</p>
<h3 class="hasAnchor" id="Schematisation-3"><span class="header-section-number">7.2.3</span> Cell Schematisation<a href="#Schematisation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW 2D models discretise the real world as a grid of connected square cells. A fixed grid 2D domain is defined by a bounding rectangle in the same manner a computer screen or digital photo is made up of a grid of pixels.</p>
<p>The physical properties (i.e. ground elevations, surface roughness, etc) of a 2D cell are defined as a minimum at the cell’s centre, mid-sides and corners as described in Section <a href="#Domain-3"><strong>??</strong></a>. High resolution topographic detail for the cell’s storage and conveyance across the cell sides (faces) can be incorporated by using the Sub-Grid Sampling (SGS) feature available in TUFLOW HPC, as documented in Section <a href="#SGS-3"><strong>??</strong></a>. SGS has substantial accuracy benefits. It enables the use of much larger cell sizes without loss of hydraulic conveyance accuracy. It also results in less output sensitivity to the grid orientation.</p>
<!-- EFC to PAR: I don't think the below belongs here 
PAR to EFC: agree

TUFLOW Classic allows multiple 2D fixed grid domains or differing orientation and cell size within the one model. The bounding rectangle of a 2D domain can be at any orientation to optimise the computer memory (RAM) footprint, however, with RAM rarely being a constraint many models are typically orientated north-south.

A quadtree grid is a grid of 2D square cells all at the same orientation with the base cell size being the parent or largest cell size. Cells can be decreased in size by dividing the base cell size into four equal square cells, with these smaller cells able to be further reduced in size to four smaller cells and so on. As cell referencing can no longer be on a simple row-column arrangement of a fixed grid 2D domain, a quadtree grid has a data structure more akin to a fully-flexible mesh. Whilst, more information needs to be stored per cell for a quadtree grid compared to fixed grid, memory is not defined by the size of the bounding rectangle, but by the number of active 2D cells. Therefore, if there is a significant area of inactive 2D cells within the bounding rectangle of the quadtree grid the memory footprint can be considerably smaller than a fixed grid model.
-->
<h4 class="hasAnchor" id="computational-points-4"><span class="header-section-number">7.2.3.1</span> Computational Points<a href="#computational-points-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To fully understand how TUFLOW functions, understanding of the computational role of the 2D cell and its four sides (also referred to as faces) is important. In the following sections, these model components are referred to as the ZC, ZU, ZV and ZH points, as shown in Figure <a href="#fig:fig-image56">44</a>. The description of these points are:</p>
<!-- EFC, the row column reference info is probably no longer that relevant, whilst read row col <data> is still supported for Classic and HPC fixed grid, this doesn't support SGS or quadtree.  Maybe the information on row column referencing can be moved to the appendix / commands section where this Read RowCol functionality is described-->
<!-- EFC: removed row/col-->
<!-- PAR to EFC, the lowest elevation is an SGS thing,should we keep this to non SGS as we haven't introduced yet?-->
<!-- EFC to PAR: have commented out the SGS comments-->
<ul>
<li>ZC – the cell centre with ZC being the elevation used computationally within the cell. <!--For non SGS models this is assumed to be a flat square represented by the ZC elevation.--></li>
<li>ZU – middle of the cell side of the Y-axis face with ZU being the elevation used computationally along the cell side. <!--For non SGS models this is assumed to be a rectangular channel defined the the ZU elevation.--></li>
<li>ZV – middle of the cell side of the X-axis face with ZV being the elevation used computationally along the cell side. <!--For non SGS models this is assumed to be a rectangular channel defined the the ZV elevation.--></li>
<li>ZH – corner of the cell. The ZH point plays no role in the computational hydraulics but is used for some output formats that require output at the cell corners.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image56"></span>
<img src="images/image56.png" alt="Location of Zpts and Computation Points"  />
<p class="caption">
Figure 44: Location of Zpts and Computation Points
</p>
</div>
<!--EFC to PAR: does your comment about SGS from above remain here? SGS is mentioned in C point but not U/V-->
<h5 class="hasAnchor" id="zc-point"><span class="header-section-number">7.2.3.1.1</span> ZC Point<a href="#zc-point" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The cell centre or ZC point:</p>
<ul>
<li>Defines the location where water levels are computed based on mass
balance equation. Simply put, the net volume of water entering (or
leaving) the cell across the four cell sides (or faces) must equal the
change in volume of the cell over a timestep.<br />
</li>
<li>The volume of a cell can either be simply based on the depth of water
multiplied by the cell area or, if Sub-Grid Sampling (SGS) (Section <a href="#SGS-3"><strong>??</strong></a>) has been
applied, a curve of volume versus depth.<br />
</li>
<li>The ZC value is typically the elevation at the cell centre or, if
using SGS, elevations are sampled across the cell, as outlined in Section <a href="#SGS-3"><strong>??</strong></a>. The ZC value
plus the <a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a> is the water
surface elevation that controls when a cell becomes wet or dry (note
that cell sides can also wet and dry).<br />
</li>
<li>The ZC value also determines the bed slope when testing for the
upstream controlled flow regime in TUFLOW Classic (see Section <a href="#CLA-US-Controlled-3"><strong>??</strong></a>) and TUFLOW HPC (Section <a href="#HPC-US-Controlled-3"><strong>??</strong></a>).</li>
</ul>
<h5 class="hasAnchor" id="zu-and-zv-points"><span class="header-section-number">7.2.3.1.2</span> ZU and ZV Points<a href="#zu-and-zv-points" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The cell sides or faces:</p>
<ul>
<li>Control how water is conveyed from one cell to another using the
momentum equation, or when upstream controlled flow occurs, the
relevant flow equation (eg. weir equation).</li>
<li>Are deactivated if the whole of the cell has dried based on the ZC
elevation as described above.<br />
</li>
<li>Can wet and dry when the whole cell is wet (see <a href="#tcfCellWetDryDepth">Cell Wet/Dry
Depth</a>). This allows for the modelling of “thin”
obstructions such as fences and thin embankments relative to the cell
size (e.g. a concrete levee).</li>
<li>Surface roughness information (e.g. Manning’s n) is inspected at the ZU and ZV points. See <a href="#tcfBedResistanceCellSides">Bed Resistance Cell Sides</a></li>
</ul>
<h5 class="hasAnchor" id="zh-point"><span class="header-section-number">7.2.3.1.3</span> ZH Point<a href="#zh-point" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The cell corners:</p>
<ul>
<li>Play no role in the computational hydraulic calculations.<br />
</li>
<li>Are used by the more common map output formats to map results due to
mesh based outputs requiring elevations and results at the element
(cell) vertices.</li>
</ul>
<h3 class="hasAnchor" id="turbulence-overview"><span class="header-section-number">7.2.4</span> Turbulence<a href="#turbulence-overview" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Turbulence within rivers plays a significant role in determining the mean flow velocity field and is integral to the overall energy loss mechanism. During a significant flood event, the majority of the flow is carried within, or near to, the river or open channel system (the primary flow path), and the water levels on the
surrounding floodplains are principally determined by the energy losses along this flow
path. Manning’s equation is accurate for straight or slowly varying channels but does
not calculate energy losses due to sudden changes in flow direction or velocity, and it
does not capture super-elevation at bends. To automatically and accurately capture these additional energy
losses, a scheme must be physics based with a turbulence closure model. The turbulence closure model must be thoroughly bench-marked against appropriate test cases at a range of resolution scales. It is important that the turbulence closure model is cell size and timestep independent (i.e. the turbulence closure model parameters do not need to be adjusted if cell size or timestep changes). <span class="citation">Collecutt et al. (<a href="#ref-Collecutt2020">2020</a>)</span> provides benchmarking of the TUFLOW turbulence schemes.</p>
<p>There are three approaches available to model losses associated with turbulence when using TUFLOW HPC, these are discussed in Section <a href="#HPC-Turbulence-3"><strong>??</strong></a>. The default scheme for TUFLOW HPC is the Wu approach (Section <a href="#Wu-4"><strong>??</strong></a>). There are two approaches available to model turbulence when using TUFLOW Classic, these are discussed in Section <a href="#CLA-Turbulence-3"><strong>??</strong></a>. The default scheme for TUFLOW Classic is a hybrid approach that includes elements of both the Constant and Smagorinsky approaches (Section <a href="#CLA-Smagorinsky-4"><strong>??</strong></a>).</p>
<!-- EFC to PAR: does this belong here? should it go under solvers? Does the dry wall section in the HPC turbulence section belong here instead?-->
<!-- PAR to EFC: move cell schemetisation and turbulence overview to solver section
HPC and CLA use the same dry wall. move that section into here
-->
<!-- EFC has done-->
<h4 class="hasAnchor" id="Dry-Wall-4"><span class="header-section-number">7.2.4.1</span> Dry Wall Treatment<a href="#Dry-Wall-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>All of TUFLOW’s viscosity approaches feature an enhanced treatment of the
viscosity term at dry boundaries. The enhanced boundary treatment corrects for unrealistic flow separation that would otherwise occur at the wet/dry interface. Figure <a href="#fig:fig-image61">45</a> presents a example of a benchmark model test with and without the enhanced boundary treatment. The top image is the result without the enhanced boundary treatment. Non-physical flow separation is observed along the oblique wet/dry boundary.The enhanced approach is shown in the bottom image. It
does not suffer from the flow separation, and the velocity increases
gradually from left to right as the water depth gradually shallows (the
model has a horizontal bed). The correct water surface slope is produced
when compared with theory.</p>
<p>All of the viscosity approaches are cell-centred. This guarantees symmetry is achieved in hydraulic results when using a symmetrical
model.</p>
<p>The top image in Figure <a href="#fig:fig-image61">45</a> shows flow separation along a dry oblique boundary without enhanced treatment
of viscosity term. The bottom image shows a correct velocity distribution using enhanced treatment of viscosity term
at dry boundaries.</p>
<img src="images/image60.png" style="display: block; margin: auto;" />
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image61"></span>
<img src="images/image61.png" alt=" Effect of Enhanced Dry Boundary Viscosity Term Treatment"  />
<p class="caption">
Figure 45:  Effect of Enhanced Dry Boundary Viscosity Term Treatment
</p>
</div>
<h2 class="hasAnchor" id="Common-2"><span class="header-section-number">7.3</span> Common Functionality<a href="#Common-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following sections are the same (or mostly so) between TUFLOW HPC and TUFLOW Classic.</p>
<h3 class="hasAnchor" id="Domain-3"><span class="header-section-number">7.3.1</span> Defining the Domain<a href="#Domain-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Each fixed grid 2D domain is treated as a rectangle at any orientation. The orientation and dimensions of each 2D domain are defined using .tgc
file commands. For the orientation it is recommended that the X-axis
falls between 90° and –90° of East due to some post-processing software
only operating within this range.</p>
<p>Several options are available for setting the 2D domains grid location and
orientation. The options are:</p>
<ul>
<li>Using a four-sided polygon in a GIS layer to define the 2D grid
orientation and dimensions (see <a href="#tgcReadGISLocation">Read GIS
Location</a>).<br />
</li>
<li>Using a line (two vertices only) in a 2d_loc GIS layer (attributes shown in Table <a href="#tab:tab-LocationAttribute">50</a>) to define the origin (first point of line) and orientation (based on the second point of the line) of the X-axis (see <a href="#tgcReadGISLocation">Read GIS Location</a>), and <a href="#tgcGridSizeNM">Grid Size (N,M)</a> or <a href="#tgcGridSizeXY">Grid Size (X,Y)</a> to set the 2D grid X and Y
dimensions.<br />
</li>
<li>Using <a href="#tgcOrigin">Origin</a>, <a href="#tgcOrientation">Orientation</a> or
<a href="#tgcOrientationAngle">Orientation Angle</a>, and <a href="#tgcGridSizeNM">Grid Size
(N,M)</a> or <a href="#tgcGridSizeXY">Grid Size (X,Y)</a>. No GIS
layers are required for this option. This option is used in Tutorial 1 of the <a href="https://wiki.tuflow.com/Tutorial_M01#2D_Domain">TUFLOW Wiki Tutorials</a>.</li>
<li>Using a DEM to set the size and location of a 2D domain (see <a href="#tgcReadGridLocation">Read
Grid Location</a>). This option is useful where the
model extent is the same as the DEM.</li>
</ul>
<p>It is recommended during the initial model build process, to view the <a href="https://wiki.tuflow.com/Check_Files_2d_dom">_dom_check</a> file to ensure that the model domain is set up as intended.</p>
<p>Note, if using the TUFLOW HPC Quadtree functionality, the 2D domain is set up in the Quadtree Control File (.qcf), see Section <a href="#qcf-mandatory-4"><strong>??</strong></a>.</p>
<table>
<caption>
<span id="tab:tab-LocationAttribute">Table 50: </span><strong>Location (2d_loc) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Comment
</td>
<td style="text-align:left;">
Optional field for entering comments. Not used.
</td>
<td style="text-align:left;">
Char(250)
</td>
</tr>
</tbody>
</table>
<p>After establishing the domain’s origin, orientation and extent, the .tgc
command <a href="#tgcCellSize">Cell Size</a> is used to define the domain’s fixed
grid resolution. For example, the below command in the .tgc sets the cell size to 10m (or 10ft is using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>:</p>
<p><tcmd><a href="#tgcCellSize">Cell Size</a></tcmd><teq> == </teq><tblk>10</tblk></p>
<p>Note, it is not necessary to specify domain dimensions that are an exact multiple of the domain’s <a href="#tgcCellSize">Cell Size</a> (e.g. when using the <a href="#tgcGridSizeXY">Grid Size (X,Y)</a> command).</p>
<p>Within this computational domain, 2D cells can be set to be active or
inactive, as described in Section <a href="#CellCodes-3"><strong>??</strong></a>. The redundant (inactive) areas around the edges of the domain’s bounding rectangle are automatically
removed from the computation. However, when allocating memory for processing of the arrays this is still accounted for. To determine the redundant area, search the TUFLOW log file (.tlf) for “redundant”, as shown in Figure <a href="#fig:fig-redundant-perimeter">46</a>. If the redundant value is large, revising the model domain dimensions will reduce the memory usage during startup.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-redundant-perimeter"></span>
<img src="images/redundant_perimeter.png" alt="Redundant Perimeter Sections Reported in the TLF"  />
<p class="caption">
Figure 46: Redundant Perimeter Sections Reported in the TLF
</p>
</div>
<h3 class="hasAnchor" id="CellCodes-3"><span class="header-section-number">7.3.2</span> Active / Inactive Cells<a href="#CellCodes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Each 2D cell is assigned a code to indicate its role. The available code types are listed in Table <a href="#tab:tab-CellCodes">51</a>. The default value is one (1) for active (i.e. the cell can be wet or dry during a simulation).</p>
<p>Commands used to modify the cell codes are:</p>
<ul>
<li><a href="#tgcSetCode">Set Code</a> in the .tgc file. This option sets the cell codes for the entire domain.</li>
<li><a href="#tgcReadGISCode">Read GIS Code</a> in the .tgc file. This option sets the cell codes based on the value in 2d_code input polygons, see Table <a href="#tab:tab-CodeAttribute">52</a>.</li>
<li><a href="#tgcReadGridCode">Read Grid Code</a> in the .tgc file. This option sets the cell codes based on the values of an input raster grid.</li>
<li><a href="#tgcReadGISCode">Read GIS Code BC</a> in the .tgc file. This option sets the cell codes from the 2d_bc input polygon. The Type attribute must be set to “CD” and the code value is taken from the 2d_bc f attribute, see Table <a href="#tab:tab-ConditionsAttribute">78</a>.</li>
</ul>
<p><strong>Note when using the <a href="#tgcReadGISCode">Read GIS Code</a> command, code values are extracted from objects in a 2d_code layer (see Table <a href="#tab:tab-CodeAttribute">52</a>). When using the <a href="#tgcReadGISCode">Read GIS Code BC</a>, code values are extracted from objects in a 2d_bc layer (see Table <a href="#tab:tab-ConditionsAttribute">78</a>). Confusing the two GIS layer types and commands will result in <a href="http://wiki.tuflow.com/TUFLOW_Message_2320">WARNING 2320</a> message being issued.</strong></p>
<p>A typical approach is to set all the cells to be inactive using <tcmd><a href="#tgcSet">Set Code</a></tcmd><teq> == </teq><tblk>0</tblk> and then read a GIS layer defining the active cells with <tcmd><a href="#tgcReadGISCode">Read GIS Code</a></tcmd><teq> == </teq><tblk>&lt;layer&gt;</tblk>. The GIS layer regions would have the attribute set to 1 for active. For example:</p>
<p><tcmd>Set Code</tcmd><teq> == </teq><tblk>0</tblk><tgrn> ! Set all cells to inactive (i.e. Code 0)<tgrn><br />
<tcmd>Read GIS Code</tcmd><teq> == </teq><tblk>..\model\gis\2d_code_M01_002.shp</tblk> ! Reads in a polygon that sets cells to active (i.e. Code 1)<tgrn></p>
<p>Boundary Cells are automatically set to 2 along external boundaries and links (e.g. HX, HS, HT, QT boundaries). This code value of 2 (see Table <a href="#tab:tab-CellCodes">51</a>), is output in the TUFLOW grid check file and a value of 2 should not be used in input commands. The <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> file can be used to view the active cells (and their code values e.g. 1, 2 or -1) within the domain.</p>
<p>For TUFLOW Classic models containing multiple 2D domains (see Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>), a useful option for setting the cell codes is the INVERT flag (see <a href="#tgcReadGISCode">Read GIS Code Invert</a> or <a href="#tgcReadGISCode">Read GIS Code BC Invert</a>), which allows the same code layer/polygons to be used for activate and deactivate regions in multiple 2D domains using a single GIS input.</p>
<!--EFC to PAR: I think we can delete this paragraph? I've added Read GRID Code in the above bullet points. The second command can't be used with SGS or Quadtree, and I've never actually seen anyone use it?-->
<!--PAR: yes remove.-->
<!--Other useful commands include [Read GRID Code](#tgcReadGrid), which
allows for the assigning of cell codes from a raster grid and [Set Code
and Clean Zpt](#tgcSetCodeandCleanZpt), which assigns cells as active or
inactive based on whether an elevation has been assigned to the cell. Set Code
and Clean Zpt is not available for either SGS models or Quadtree models.-->
<p>TUFLOW automatically strips any redundant rows and columns around the
active area of the model to reduce simulation times. This is described
in Section <a href="#Domain-3"><strong>??</strong></a>.</p>
<!-- EFC to PAR: is the note in the null cells row still relevant?-->
<!--PAR: no remove-->
<!--EFC:removed-->
<table>
<caption>
<span id="tab:tab-CellCodes">Table 51: </span><strong>Cell Codes</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Code
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Inactive Cells
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
<p>Inactive cells are cells that are totally removed from the computation. Maximising the area of inactive cells reduces computation time and output file sizes.</p>
<p>For a fixed grid 2D domain, inactive cells still consume memory during a simulation, as these domains are stored on a row column rectangular grid.</p>
For a quadtree grid, inactive cells will consume temporary memory (CPU RAM) during model startup, but do not consume memory (CPU or GPU) during the simulation.
</td>
</tr>
<tr>
<td style="text-align:left;">
Active Cells
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Active cells are cells that can wet and dry during a simulation.
</td>
</tr>
<tr>
<td style="text-align:left;">
Boundary Cells
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<p>Boundary cells indicate cells that are an external boundary (including some types of 1D/2D dynamic links). There should be an active cell on one side and an inactive or null cell on the other at an external boundary. If an external boundary is digitised inside an active area (i.e. not along the active area boundary), water can flow in both directions either side of the boundary line (only in rare situations would the modeller require this).</p>
<b>Note:</b> It is not necessary to manually specify boundary cells. Boundary lines are digitised in GIS layer(s) and TUFLOW automatically assigns the boundary code to the cells (see Section <a href="#BC-Layers-3"><strong>??</strong></a> and <a href="#tbcReadGISBC">Read GIS BC</a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
Null Cells
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:left;">
<p>Inactive cells used to deactivate cells within the active domain. Null cells may be preferred to inactive cells as they are not excluded from the output mesh structure (eg. not excluded from the XMDF mesh). For two simulations to be compared in some post-processers (eg. SMS), they must have exactly the same mesh. For example, if an area in a model is removed (e.g. filling part of a floodplain), use null cells or raise the ground elevations in preference to using inactive cells so that the two simulations can be compared.</p>
Setting null cells is not supported when using the TUFLOW HPC Quadtree (see Section <a href="#Quadtree-3"><strong>??</strong></a>) functionality.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-CodeAttribute">Table 52: </span><strong>2D Code (2d_code) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Code
</td>
<td style="text-align:left;">
The code value (see Table <a href="#tab:tab-CellCodes">51</a>) to be assigned to cells falling on or within the object.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="layering-3"><span class="header-section-number">7.3.3</span> Data Layering<a href="#layering-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!--EFC: Bill wanted this section, not sure what the best way to explain this is. I think putting in a picture that shows data layering? -->
<!--EFC to PAR: what would this section contain that the 'layering of elevation data' section doesn't already?-->
<!-- PAR to EFC: keep super high level here, mention elevations / land use / soils-->
<!--done-->
<p>TUFLOW models are set up using data layering. This is an important, and very useful concept.</p>
<p>Commands are applied in sequential order; therefore, it is possible to override previous information with new data to modify the model in selected areas. For topography modifications, this is extremely useful where a base dataset exists, over which areas need to be modified to represent other scenarios such as a proposed development. This eliminates or minimises data duplication. This concept of layering datasets may also be applied to other GIS , including (but not limited to) 2d_mat, 2d_code and 2d_soil layers. For example, setting all cell codes inactive, then reading in a GIS polygon covering the active cells (as discussed in Section <a href="#CellCodes-3"><strong>??</strong></a>).</p>
<p>Figure <a href="#fig:fig-data-layering">47</a> shows a visual representation of how TUFLOW interprets the following set of .tgc commands:</p>
<p><tcmd>Read Grid Zpts</tcmd><teq> == </teq><tblk>grid\DEM_5m.tif</tblk><br />
<tcmd>Read Grid Zpts</tcmd><teq> == </teq><tblk>grid\Bathy_1m.tif</tblk><br />
<tcmd>Read GIS Z Shape</tcmd><teq> == </teq><tblk>gis\2d_zsh_building.shp</tblk><br />
The command lower in the TGC will take precedence over a command above where data overlaps and the command has the same functional purpose (eg. topography definition).
The DEM_5m layer is read in first. The elevations are then replaced by the overlapping Bathy_1m layer. A 2D Z Shape (2d_zsh_buildings) is then read in which raises all elevations inside the polygon by 5m. The result is shown in the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">DEM_Z</a>. The <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">DEM_Z</a> is a check file representing the elevation data that TUFLOW has used for the hydraulic calculations. For more information on check files see Section <a href="#CheckLayers-2"><strong>??</strong></a>.</p>
<!--PAR: make colours more obvious in DEM_Z + less jarring in bathy-->
<!--done-->
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-data-layering"></span>
<img src="images/data-layering.png" alt="Visual Representation of Data Layering in TUFLOW"  />
<p class="caption">
Figure 47: Visual Representation of Data Layering in TUFLOW
</p>
</div>
<p>Data layering is discussed in further detail for elevation updates in Section <a href="#elevations-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="sampling-of-data-sets"><span class="header-section-number">7.3.4</span> Sampling of Data Sets<a href="#sampling-of-data-sets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- EFC to PAR: we spoke about sampling of datasets all as one in the old section, not sure how to split it up now that SGS is this was in the old section. What are your thoughts on this set up?-->
<p>To setup the boundary of the 2D grid and assign data values to the cells
from DEMs, TINs, land-use polygons, soil polygons and so forth, these
data layers need to sampled, interrogated or interpolated. There are two approaches to sampling datasets in TUFLOW:</p>
<ul>
<li>Traditional approach (Section <a href="#traditional-sampling-4"><strong>??</strong></a>)</li>
<li>Sub-Grid Sampling (SGS) approach - recommended (Section <a href="#SGS-3"><strong>??</strong></a>)</li>
</ul>
<p>The traditional approach by 2D solvers is to sample a
single value at the 2D cell centre (ZC). TUFLOW also supports sampling
values, for some data types, at the centre of each cell side (ZV and ZU) and the corner of the cell (ZH). The cell side sampling for example, enables a cell side to be set to the height of a levee that is narrower in width than the 2D cell. Subsequently controlling when water can move from adjacent cells depending on the water level relative to the levee crest elevation. The traditional sampling approach is explained in Section <a href="#traditional-sampling-4"><strong>??</strong></a>.</p>
<p>As of the 2020-01 TUFLOW release, TUFLOW HPC supports the sampling of
elevations at sub-grid locations, referred to as Sub-Grid Sampling
(SGS). The TUFLOW Classic solver does not support SGS due to the nature
of the implicit solution and preferred use of a fixed timestep. The many benefits of using SGS are detailed in Section <a href="#SubGridSamplingSGS-3"><strong>??</strong></a>, implementing the SGS approach is described in Section <a href="#SGS-3"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="traditional-sampling-4"><span class="header-section-number">7.3.4.1</span> Traditional Sampling Approach<a href="#traditional-sampling-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Topographically, the cell is treated as having a flat horizontal bed at a
height set to the cell centre (ZC) elevation, and the cell faces as
having flat, rectangular shaped sides at a height set to the cell
mid-side (ZU and ZV) sampled elevations as illustrated in Figure <a href="#fig:fig-image66">48</a>.
Using the traditional sampling approach, the topography of a cell is
treated as follows:</p>
<ul>
<li>The cell volume is represented as a square bucket with a flat
horizontal bed, and simply calculated as the cell centre depth times
the cell area.<br />
</li>
<li>The flow area across a cell face used for the momentum and mass
balance equations is simply represented as a rectangular section (i.e.
cell side centre depth times the cell width).<br />
</li>
<li>The bed resistance term in the momentum equation (e.g. Manning’s
equation) uses the Resistance Radius approach (i.e. the cell face
radius value as used in Manning’s equation is set to the depth and the
cell width or cell size is used for the wetted perimeter).</li>
</ul>
<!-- CDH I disagree, this isn't true. land-use is sampled at cell sizes. I assume soils are sampled at the cell centre only. I've commented the sentence out.  

The sampling of materials (land-use), soil and other data types is
performed in a similar manner. -->
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image66"></span>
<img src="images/image66a.png" alt="2D Cell Topography - Traditional Approach"  />
<p class="caption">
Figure 48: 2D Cell Topography - Traditional Approach
</p>
</div>
<h3 class="hasAnchor" id="elevations-3"><span class="header-section-number">7.3.5</span> Elevations<a href="#elevations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>2D domain elevations are defined in the .tgc file. As mentioned in Section <a href="#layering-3"><strong>??</strong></a>, a powerful feature of TUFLOW is its capacity to build the 2D elevations from any number of GIS layers and/or TINs. The typical approach adopted is as follows:</p>
<ol style="list-style-type: decimal">
<li>All elevations in the model start with an un-initialised value
of 99999. TUFLOW will output an error if any elevations of 99999 (or
higher) occur after the processing of the elevations. This is to
indicate that elevations in active cells have not been initialised
or set.</li>
<li>A default elevation is specified first in the .tgc file using <a href="#tgcSetZpt">Set
Zpt</a>. An inundation free elevation is usually specified.
If your elevation data sets are intended to cover your entire active
area this step can be omitted so as to trigger the error described
above in case elevation data are unintentionally missing (e.g.
unintended null areas in a DEM or accidental omission of a layer).</li>
<li>The elevations read directly from a DEM using <a href="#tgcReadGridZpts">Read Grid
Zpts</a>, or read from TIN in the SMS, 12D or
LandXML TIN formats (see <a href="#tgcReadTINZpts">Read TIN Zpts</a>).</li>
<li>If there are areas where data is either missing or erroneous, these
can easily be corrected via interpolation using <a href="#tgcReadGISZShape">Read GIS Z
Shape</a> regions or polygons. This is achieved by
digitising a polygon around the missing or erroneous data. TUFLOW
interpolates elevations across the region based on the existing Zpts
around the perimeter of the polygon. An example is shown in
Section <a href="#zsh-4"><strong>??</strong></a>. Missing or erroneous data often occurs with
aerial surveys where the sampling is in areas of thick vegetation,
water or where post processing has poorly filtered the removal of
elevated objects (e.g. buildings).</li>
<li>Sometimes there is a need to remove cut and fill works from the
topography. For example, model calibration often requires the
removal of infrastructure, such as levees, road embankments and developments that may not have existed at the time of the historic event to back date the
topography within the model. This is easily done using <a href="#tgcReadGISZShape">Read GIS Z
Shape</a> by simply digitising polygons around the
various features.</li>
<li>The base elevations set up in the previous step(s) can be modified
to represent hydraulic controls, proposed works, failure of a flood
defence wall, etc. Some examples are:
<ul>
<li>The crests of road/rail embankments, levees, fences and other solid obstructions are easily inserted using <a href="#tgcReadGISZLine">Read GIS Z
Line</a>, <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a>.
<a href="#tgcReadGISZShape">Read GIS Z Shape</a> is particularly powerful as 3D
lines can be given a thickness making it very easy to quickly raise,
or lower, elevations along a road alignment or a diversion channel
where the width of the embankment/channel is wider than the 2D cell
size.<br />
</li>
<li>The proposed cut and fill for a development or other works can be
incorporated using <a href="#tgcReadGISZpt">Read GIS Zpts</a>, <a href="#tgcReadGISZShape">Read GIS Z
Shape</a>, <a href="#tgcReadTINZpts">Read TIN Zpts</a> or <a href="#tgcCreateTINZpts">Create
TIN Zpts</a>. These powerful commands can set
elevations based on regions. Within regions TINs can be generated from
points and lines, and the perimeter of the TIN can be automatically
merged with the existing Zpts. A TIN of the cut and fill produced by
SMS or 12D can be read directly into TUFLOW using <a href="#tgcReadGISZpt">Read GIS
Zpts</a>.<br />
</li>
</ul></li>
<li>If there is a need to simulate the failure of a flood defence wall
or road/rail embankment, or the collapse of fences, <a href="#tgcReadGISVariableZShape">Read GIS
Variable Z Shape</a> can be used to control
the collapse of the embankment or fences over time. The collapse can
be triggered to occur at a specified time, when a water level
reached somewhere within the model, or based on the water level
difference between two locations.</li>
</ol>
<p>A 2D domain’s Zpts are built up using one or more of the commands shown
in Table <a href="#tab:tab-ZptCommands">53</a> and discussed in the following sections.</p>
<!-- PAR to EFC: can we re-order this so the common ones are at the top and and make it clear which ones such as read rowcol are legacy, not sure how to mark this have done Read RowCol in the spreadsheet by starting the description with "Legacy Command:" -->
<!-- EFC to PAR: yes, can we also move this to the end of the elvatins section? feels weird having it up here?-->
<!--EFC: moved-->
<!--PAR to EFC: move read tin up to under read grid-->
<!-- done-->
<table>
<caption>
<span id="tab:tab-ZptCommands">Table 53: </span><strong>2D Zpt Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="#tgcSetZpt">Set Zpt</a>
</td>
<td style="text-align:left;">
Sets all Zpts over the whole 2D domain to the same value. Useful for providing an initial elevation prior to other commands as some Zpts in inactive (land) parts of the model may not receive a value. The default value for all Zpts is 99999. Every Zpt must be assigned a value, essentially making this command mandatory.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGridZpts">Read Grid Zpts</a>
</td>
<td style="text-align:left;">
Directly interrogates a raster grid (e.g. tif, .flt or .asc) to define Zpt elevations. This command is similar to <a href="#tgcReadTINZpts">Read TIN Zpts</a> but works on a grid rather than a TIN.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadTINZpts">Read TIN Zpts</a>
</td>
<td style="text-align:left;">
Reading of a TIN to set the Zpt values within the TIN.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISZShape">Read GIS Z Shape</a>
</td>
<td style="text-align:left;">
<p>Powerful command to modify Zpt values using points, lines and polygons. Lines can vary in width from just the cell sides (thin), whole cells (thick) or be assigned a width (thickness). TINs are created within the polygons and incorporate elevations from points and lines that fall within the polygon. The perimeter of the polygon can be merged with the current Zpt values in part, or in its entirety.</p>
<a href="#tgcReadGISZShape">Read GIS Z Shape</a> and <a href="#tgcCreateTINZpts">Create TIN Zpts</a> are excellent for removing bad data areas and for filling in null areas where the aerial survey has provided poor or no data. Another example is to remove buildings from a DEM.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a>
</td>
<td style="text-align:left;">
Allows the user to define the eroded 3D shape of a section of the 2D domain, specify the period for collapse, and how the collapse is triggered (i.e. at a specified time or when a water level is reached or when a water level difference is exceeded). Raising of the Zpts over time is also permitted (e.g. to model the influence of flood defences during an event or a landslide filling a river).
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcCreateTINZpts">Create TIN Zpts</a>
</td>
<td style="text-align:left;">
Useful for having TUFLOW create a TIN using polygons for TIN boundaries and points and lines within the polygons to create the TIN. If no points are snapped to the perimeter vertices of a polygon, the elevations around the polygon’s perimeter are merged with the current Zpt values. The resulting TIN can optionally be exported to SMS and 12D TIN formats.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISZLine">Read GIS Z Line</a>
</td>
<td style="text-align:left;">
This is a legacy feature and it is recommended to use the Z Shape functionality (Section <a href="#zsh-4"><strong>??</strong></a>) instead.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a>
</td>
<td style="text-align:left;">
Similar to <a href="#tgcReadGISZLine">Read GIS Z Line</a>, but uses HX lines and ZP points in a 2d_bc layer (see Table <a href="#tab:tab-ConditionsAttribute">78</a>) to adjust the 2D cell elevations along HX lines.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcReadGISZpt">Read GIS Zpts</a>
</td>
<td style="text-align:left;">
<p>Typically used for simple modifications of sections of the topography. Examples are filling an area (defined by a region or polygon object) to the same elevation or dredging (lowering) a section of river using <a href="#tgcReadGISZpt">Read GIS Zpts ADD</a>.</p>
<a href="#tgcReadGISZShape">Read GIS Z Shape</a> offers greater functionality and may be preferable to using <a href="#tgcReadGISZpt">Read GIS Zpts</a> to modify Zpts.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfMaximumPoints">Maximum Points</a><br />
<a href="#tcfMaximumVertices">Maximum Vertices</a>
</td>
<td style="text-align:left;">
Use these commands to increase the maximum number of elevation points or maximum number of vertices in a single line or polygon.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcDefaultLandZ">Default Land Z</a>
</td>
<td style="text-align:left;">
Now rarely used in lieu of <a href="#tgcSetZpt">Set Zpt</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcInterpolateZC">Interpolate ZC</a><br />
<a href="#tgcInterpolateZHC">Interpolate ZHC</a><br />
<a href="#tgcInterpolateZUV">Interpolate ZUV</a><br />
<a href="#tgcInterpolateZUVC">Interpolate ZUVC</a><br />
<a href="#tgcInterpolateZUVH">Interpolate ZUVH</a>
</td>
<td style="text-align:left;">
<p>Allows the interpolation of Zpts from other types of Zpts. Now rarely used as nearly all models assign values directly to all the Zpts. The original TUFLOW code only required input of ZH points, and Interpolate ZUVC provided a tool for interpolating the other Zpts.</p>
<p>Models with “bumpy” terrain, such as that from airborne laser surveys, might benefit from using Interpolate ZHC or Interpolate ZUV.</p>
Models through urban areas where the DTM includes the buildings may benefit from using Interpolate ZC ALL LOWER, which reduces the amount of cells that become blocked out due to high ZC elevations from buildings.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tgcZC">ZC</a> <teq>==</teq> MIN(ZU,ZV)
</td>
<td style="text-align:left;">
Rarely used. Sets the ZC (cell centre elevation) to the lower of the ZU and ZV (cell sides).
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="DEMGrids-3"><span class="header-section-number">7.3.5.1</span> Direct Reading of DEM Grids<a href="#DEMGrids-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The use of the .tgc command <a href="#tgcReadGridZpts">Read Grid Zpts</a> allows
TUFLOW to directly interrogate (point inspect) a DEM to set the Zpt
elevations. This command is similar to <a href="#tgcReadTINZpts">Read TIN Zpts</a>
but works on a grid rather than a TIN.</p>
<p>Grid formats currently supported are:</p>
<ul>
<li>GeoTIFF (.tif)</li>
<li>Geopackage raster (.gpkg)</li>
<li>Binary grid format (.flt/.hdr)</li>
<li>ESRI ASCII Grid format (.asc)</li>
</ul>
<p>Nearly all GIS software will support one of the above grid formats.</p>
<p>The GeoTIFF format is the default output format and preferred input format. It is faster to read and write compared to the .flt and .asc formats, and also supports compression. The format of grids can be converted (e.g. from .flt to .tif), the <a href="https://wiki.tuflow.com/Raster_Format_Conversion_Using_gdal_translate">Raster Format Conversion TUFLOW Wiki page</a> details how to do this.</p>
<p>Like other .tgc commands, the command <a href="#tgcReadGridZpts">Read Grid Zpts</a>
can be specified multiple times. An option to specify ADD, MIN or MAX in
the same way as for other similar commands is also available.</p>
<p>Clip regions can be specified as a second argument in the command <a href="#tgcReadGridZpts">Read
Grid Zpts</a> (and also <a href="#tgcReadTINZpts">Read TIN Zpts</a>)
by reading in a GIS layer containing one or more polygons to clip the
area of Zpts to be inspected. For example, the command below will only
assign elevations to Zpts that lie inside polygons within the
2d_clip_DEM layer:</p>
<p><tcmd><a href="#tgcReadGridZpts">Read Grid Zpts</a> </tcmd><teq>==</teq><tblk> grid\DEM_M01.tif | DEM\2d_clip_DEM.shp</tblk></p>
<p>The attributes of the clip layer are not used, and only polygons are
processed. As such, any of the TUFLOW empty files can be used as the
template for this layer. Polygons can have holes in them if required.</p>
<p>This is particularly useful for clipping out a TIN or DEM due to
unwanted or irregular triangulation around the periphery, especially for
secondary TINs/DEMs of proposed developments lying within the primary
TIN/DEM.</p>
<p><strong>Note: For your base Zpts from the primary DEM or TIN, do not clip this
with your active 2d_code layer as this will cause problems with Zpts
along any external 2d_bc boundaries. If no clip layer is specified, the
<a href="#tgcReadGridZpts">Read Grid Zpts</a> or <a href="#tgcReadTINZpts">Read TIN Zpts</a>
commands assign all Zpts falling within the Grid / TIN an elevation
irrespective of whether a cell is active or inactive.</strong></p>
<p>When reading grids into TUFLOW, the same interpolation approach occurs for all formats. The procedure TUFLOW follows is:</p>
<ul>
<li>The DEM elevation is assumed to be in the centre of the DEM grid cell (pixel), as shown by the four red circles in the picture below.</li>
<li>A midpoint vertex (green circle) is defined in the middle of the four DEM elevations.</li>
<li>The elevation of the midpoint vertex (green circle) is equal to the average of the four DEM elevations (red circles).</li>
<li>The DEM grid cell centre points (red circles) and midpoint vertex (green circle) are used to create a TIN.</li>
<li>Elevations within the TIN are interpolated from the associated TIN points. For example, a Zpt is included in the image below as a yellow point. The elevation assigned to that Zpt is the planar (linear) interpolation of the surrounding three elevation points associated with the top TIN triangle in the image.</li>
</ul>
<center>
<img src="images/InterpolationExample.png"  style="width:2.6in;height:2.4in"/>
</center>
<h4 class="hasAnchor" id="zsh-4"><span class="header-section-number">7.3.5.2</span> Z Shape Layers (2d_zsh)<a href="#zsh-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="#tgcReadGISZShape">Read GIS Z Shape</a> offers a wide range of options for
manipulating and modifying the Zpt values. These include 3D breaklines
and TINs. Table <a href="#tab:tab-ZShapeAttribute">54</a> provides a description of the different 2d_zsh GIS layer attributes.</p>
<p>When a mixture of different shapes and shape options occur within the
same layer the following protocols are used to control how Zpt values
are modified.</p>
<ol style="list-style-type: decimal">
<li>The order in which objects are processed is:
<ol style="list-style-type: decimal">
<li><strong>Polygons:</strong> All polygons are triangulated according to the
process described for <a href="#tgcCreateTINZpts">Create TIN Zpts</a> in
Section <a href="#ztin-4"><strong>??</strong></a>. The only difference to note is that if a
line is to be used for the TIN generation, the Shape_Options
attribute for the line must include the keyword “TIN”.<br />
</li>
<li><strong>Wide Lines:</strong> Wide lines are lines that have a
Shape_Width_or_dMax attribute value greater than 1.5 times the
2D <a href="#tgcCellSize">Cell Size</a>. A buffer polygon is created along
the line, and all Zpts falling within the buffer polygon are
assigned elevations based on a perpendicular intersection with
the line. Note that wide lines are processed in the order that
they occur in the GIS layer, so if the buffer polygons of two
wide lines overlap each other, the latter one prevails. In this
situation it would be wise to separate the two lines into two
different layers. Buffer polygons can be viewed in the
<a href="https://wiki.tuflow.com/Check_Files_2d_sh_obj">_sh_obj_check</a> layer.<br />
</li>
<li><strong>Thin and Thick Lines:</strong> Thin lines have a Shape_Width_or_dMax
value of zero and Thick lines a value less than or equal to 1.5
times the 2D <a href="#tgcCellSize">Cell Size</a>. For a more detailed
description of Thin and Thick lines see <a href="#tgcReadGISZLine">Read GIS Z
Line</a>. Thin and Thick lines are applied
depending on the Shape_Options attribute setting as follows:
<ol style="list-style-type: decimal">
<li>All ADD lines are applied first.<br />
</li>
<li>Followed by lines without any option (these will modify all
Zpts affected by the line).<br />
</li>
<li>Followed by GULLY, LOWER or MIN lines.<br />
</li>
<li>And finally, any RIDGE, RAISE or MAX lines.<br />
</li>
</ol></li>
</ol></li>
<li>The priority can of course be further controlled by using different
layers and controlling the order which layers are listed and
subsequently processed in the .tgc file.</li>
</ol>
<p>Some examples of using <a href="#tgcReadGISZShape">Read GIS Z Shape</a> are given
below. Models set up using these topography update features are provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Topography_Features">Topography Features Example Model Dataset</a></p>
<p><strong>Example 1: Triangulating Elevations over a Null Area</strong></p>
<p>The image below shows an example of a DEM that is missing data over a
small area within the 2D domain. Gaps in DEM coverage can sometimes occur over
water bodies and occasionally between the tiles of ALS or LiDAR data
received from a third-party provider. An example of using the MERGE topography update feature is provided in the <a href="https://wiki.tuflow.com/Tutorial_M02">TUFLOW Tutorial Module 2</a></p>
<table>
<colgroup>
<col style="width: 39%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="odd">
<td>
<img src="images/image83.png"
style="width:2.51in;height:2.27in" />
</td>
<td>
<p>
The .tgc command <a href="#tgcSetZpt">Set Zpt</a> may be used to
quickly and easily assign elevations to Zpts falling within these areas,
however the limitations of the command mean the same elevation will be
assigned to all null Zpts across the entire 2D domain. This may not be
suitable in situations where there are multiple gaps in coverage or
where the gap is located on steep terrain.
</p>
<p>
<a href="#tgcReadGISZShape">Read GIS Z Shape</a> with 2d_zsh polygons may instead be used to triangulate Zpt values based on the Zpt elevations of the polygon perimeter.
</p>
</td>
</tr>
<tr class="odd">
<td>
<img src="images/image84.png"
style="width:2.57in;height:2.31in" />
</td>
<td>
<p>
Import in an empty 2d_zsh GIS layer, and digitise a polygon around
the gap in coverage as shown. Ensure there is a reasonable buffer around
the null area. The attributes of the polygon may be left blank.
Alternatively, a value may be entered in the “Shape_Width_or_dMax”
attribute to control the maximum distance between intermediate points
inserted around the polygon’s perimeter to interpolate elevations. When
left blank, this distance is half the 2D cell’s size.
</p>
</td>
</tr>
<tr class="odd">
<td>
<img src="images/image85.png"
style="width:2.42994in;height:2.3in" />
</td>
<td>
<p>
This image shows the resulting _DEM_Z.flt check file. The
<a href="https://wiki.tuflow.com/Check_Files_2d_zsh_zpt">_zsh_zpt_check</a> layer can be used to view the final Zpt elevation
assigned
</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Example 2: Use of the NO MERGE and ADD Shape Options</strong></p>
<p>The 2d_zsh NO MERGE option can be used to assign a single elevation to all Zpts
falling within the 2d_zsh polygon (read by the <a href="#tgcReadGISZShape">Read GIS Z Shape</a> command). An example of using the NO MERGE topography update feature is provided in <a href="https://wiki.tuflow.com/Tutorial_M02">TUFLOW Tutorial Module 2</a>. This may be useful to set the
elevation of a polygon to a known finished floor level of a proposed
development. Digitise a polygon within an empty 2d_zsh GIS layer, and
populate the “Z” attribute of each object with the desired elevation.
Set the “Shape_Options” attribute to NO MERGE. The example below will
assign an elevation of 42.1mAHD to all Zpts located within the 2d_zsh
polygon.</p>
<center>
<img src="images/image86.png" />
</center>
<p>Note that if the NO MERGE option is omitted and no points are snapped to the perimeter of the polygon, the Z attribute will be ignored and the Zpt elevations will be triangulated based on the Zpt elevations of the polygon perimeter.</p>
<p>Alternatively, to raise the polygon by a fixed value (i.e. to represent
the slab height of a building) enter this value in the Z attribute and
set the “Shape_Options” to ADD. An example of using the ADD topography update feature is also provided in <a href="https://wiki.tuflow.com/Tutorial_M02">TUFLOW Tutorial Module 2</a>.</p>
<center>
<img src="images/image87.png"  />
</center>
<p>TUFLOW will add the value entered in the Z attribute to the existing Zpt elevations within the polygon. The entry within the figure to the left will raise Zpt elevations by 0.15m. The use of a negative value will lower the Zpt elevations by the value of the “Z” attribute. The <a href="http://wiki.tuflow.com/Check_Files_2d_zsh_zpt">_zsh_zpt_check</a> layer can be used to view the elevation points (Zpts) that have been modified.</p>
<p><strong>Example 3: Raising an Embankment</strong></p>
<p>The ADD option may also be used when the 2d_zsh object has been
digitised as a line. An example of using the ADD topography update feature is provided in <a href="https://wiki.tuflow.com/Tutorial_M02">TUFLOW Tutorial Module 2</a>. Populate the Z attribute with the amount the
embankment is to be raised by. Populate the “Shape_Options” attribute
with ADD as shown in the second figure of Example 2 above. This will
raise the existing Zpt elevations by the value of the Z attribute. By
default, TUFLOW will assume a thin line, and only alter the ZH, ZU and
ZV Zpt elevations of a cell. The “Shape_Width_or_dMax” attribute may be
optionally specified to represent a THICK or a WIDE line (refer to
Section <a href="#zsh-4"><strong>??</strong></a>).</p>
<p>Alternatively, if a 3D breakline has been digitised, the dZ attribute on
the snapped points may be used to raise or lower the embankment. The dZ
attribute increases or decreases the elevation of the point’s Z
attribute by the amount of dZ. In the example below, a 3D breakline has
been created by snapping points to either end of the line. The
elevations along the line are determined by a linear interpolation of
the Z attribute of the points. Entering a positive dZ value at each
point will raise the elevations at the points by the amount of dZ at
each point (0.2m for one of the points in the figure below). The
elevations along the line are then interpolated based on these revised
values. The <a href="https://wiki.tuflow.com/Check_Files_2d_zsh_zpt">_zsh_zpt_check</a> layer can be used to view the final Zpt
elevation assigned.</p>
<center>
<img src="images/image88.png" /><img src="images/image89.png" />
</center>
<p><strong>Example 4: Removing ridges from a poorly triangulated DEM.</strong></p>
<table>
<colgroup>
<col style="width: 39%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="odd">
<td>
<img src="images/image90.png"
style="width:2.93in;height:2.65in" />
</td>
<td>
<p>
The image shows two false ridges indicated by the H letters.
These were caused by a poor triangulation by the TIN software used to
create the DEM. These ridges caused unrealistic flow patterns, as shown
by the velocity vectors.
</p>
<p>
Note, The blue cells at the bottom are the downstream boundary
cells.
</p>
</td>
</tr>
<tr class="even">
<td>
<img src="images/image91.png"
style="width:2.93in;height:2.65in" />
</td>
<td>
This image is of the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">DEM_Z</a> and <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt_check</a> check file layers
from the TUFLOW simulation. This is how TUFLOW interprets the DEM data. The false ridges are clearly shown.
</td>
</tr>
<tr class="odd">
<td>
<img src="images/image92.png"
style="width:2.95in;height:2.66in" />
</td>
<td>
<p>
To remove the ridges, import an empty 2d_zsh layer, and digitise
a polygon around the ridges as shown. By default (i.e. using the default
attribute values), the elevations assigned around the perimeter of the
polygon are interpolated from the current Zpt values.
</p>
<p>
One problem with this approach is that the elevations along the
right-hand side (i.e. along the edge of the floodplain between Locations
A and B) are interpolated from the high Zpts along this
boundary.
</p>
</td>
</tr>
<tr class="even">
<td>
<img src="images/image93.png"
style="width:2.92in;height:2.64in" />
</td>
<td>
To solve this problem, digitise points either into the 2d_zsh layer
or into a 2d_zsh…_pts layer that snap to the vertices of the polygon
where the high elevations occur. Assign a Z attribute of -99999 to each
point, as shown in the image. The -99999 indicates to not interpolate an
elevation from the existing Zpts. Instead, the elevations at Locations A
and B are used to interpolate elevations at vertices where -99999 has
been assigned.
</td>
</tr>
<tr class="odd">
<td>
<img src="images/image94.png"
style="width:2.93in;height:2.64in" />
</td>
<td>
Use <a href="#tgcReadGISZShape">Read GIS Z Shape</a> to process the
polygon and points and generate the TIN as shown in the image. The TIN
can be viewed by importing the <a href="https://wiki.tuflow.com/Check_Files_2d_sh_obj">_sh_obj_check</a> GIS layer.
</td>
</tr>
<tr class="even">
<td>
<img src="images/image95.png"
style="width:2.97in;height:2.68in" />
</td>
<td>
This image shows the new <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">DEM_Z</a> check file after the above 2d_zsh layer has been applied. As can be seen, the ridges have been removed and the flow patterns are now realistic.
</td>
</tr>
</tbody>
</table>
<p><strong>Example 5: Highway Embankment Removal Example</strong></p>
<p>The figures below present another example where a new highway, which
exists in the DEM, needed to be removed because the calibration flood
events occurred before the highway was built. Removal of the highway
only required the digitising of a 2d_zsh polygon around the highway. All
attributes were left as their defaults, and there was no need to specify
any elevation points. This example then used an additional Z shape line and point feature to reflect the existing highways topography (using the method discussed in Example 3). Either <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tgcCreateTINZpts">Create TIN Zpts</a> can be used for this purpose.</p>
<center>
<img src="images/zshape-highway-removal.png"/>
</center>
<table>
<caption>
<span id="tab:tab-ZShapeAttribute">Table 54: </span><strong>2D Z-Shape (2d_zsh) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
<p><b>Point:</b><br />
Elevation of the point. Points are only used to assign elevations along lines and polygon perimeters, or for the creation of TINs within polygons. They do not modify Zpts directly.</p>
<p>An elevation of -99999 has a special meaning when the point is snapped to a vertex of a polygon. The -99999 indicates to ignore the elevation at that vertex and of any automatically inserted vertices between that vertex and the two neighbouring vertices. Instead the elevations are based on the elevations of the neighbouring vertices. If a neighbouring vertex also has a -99999 point snapped to it, the next vertex is used, and so on. This feature is very useful, as illustrated in the example above.</p>
<p><b>Line:</b><br />
Elevation of the line if no points are snapped to the line.</p>
<p>If the ADD option is specified, the value entered is used to increase (positive ‘Z’ values) or decrease (negative ‘Z’ values) the elevation of the Zpt values by the amount specified (i.e. a value of 0.5 will raise existing Zpt values by 0.5m).</p>
<p>Otherwise ignored.</p>
<p><b>Polygon:</b><br />
If the NO MERGE option is specified, used to set the elevation of the polygon perimeter if there are no points snapped to the perimeter.</p>
<p>If the ADD option is specified, the value entered is used to increase (positive ‘Z’ values) or decrease (negative ‘Z’ values) the elevation of the Zpt values by the amount specified.</p>
Otherwise ignored.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
dZ
</td>
<td style="text-align:left;">
<p><b>Point:</b><br />
Change in elevation of the ‘Z’ attribute of the z-shape object at the point. To leave ‘Z’ unchanged, set to zero. Useful for easily adjusting the height of the shape object without having to change the original ‘Z’ value. For example, if the Z attribute has been set to 5mAHD, a dZ value of 0.1m will raise the point’s Z elevation to 5.1mAHD.</p>
<p><b>Line:</b><br />
Not used. Recommend setting to zero.</p>
<b>Polygon:</b><br />
Not used. Recommend setting to zero.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Shape_Width_or_dMax
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line (no TIN):</b><br />
Provided “TIN” is not specified for the Shape_Options attribute, this attribute specifies the width (thickness) of the breakline in metres. If equal to zero, only the elevations along the cell sides and corners are adjusted (i.e. a thin breakline). If less than or equal to 1.5 times the 2D <a href="#tgcCellSize">Cell Size</a>, a line of whole cells is adjusted (i.e. a thick line). Otherwise all Zpts within a distance of half Shape_Width_or_dMax are adjusted.</p>
<p><b>Line (TIN):</b><br />
If “TIN” is specified for the Shape_Options attribute, this attribute controls the maximum distance between automatically added intermediate vertices. If set to zero, half the 2D domain’s <a href="#tgcCellSize">Cell Size</a> is used. If less than zero no intermediate vertices are inserted.</p>
<p><b>Polygon:</b><br />
The maximum distance between intermediate points inserted around the polygon’s perimeter to interpolate elevations from the current Zpts. If set to zero, half the 2D <a href="#tgcCellSize">Cell Size</a> is used. If less than zero no intermediate vertices are inserted.</p>
Not used if the NO MERGE or ADD options are specified.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Shape_Options
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line or Polygon:</b><br />
ADD: Add the shape’s ‘Z’ attribute value to the current Zpts. If ADD is specified, any automatic merging around the region perimeter is ignored (to merge the perimeter with existing Zpts when using the ADD option, specify a value of zero for the Z and dZ attributes for the region).</p>
<p>MAX, RIDGE or RAISE: Only changes a Zpt elevation if the Z Shape elevation at the Zpt is higher.</p>
<p>MIN, GULLY or LOWER: Only changes a Zpt elevation if the Z Shape elevation at the Zpt is lower.</p>
<p><b>Line Only:</b><br />
TIN: Indicates the line is only to be used for of generation of TINS from polygons (therefore, only sections of TIN lines that fall within the polygon(s) are used).</p>
<p><b>Polygon Only:</b><br />
If none of the options below are specified, the elevations at perimeter vertices that do not have an elevation point snapped to them are merged with the current Zpt values.</p>
<p>MERGE ALL: Ignores elevations from any points snapped to the perimeter and merges all perimeter vertices with the current Zpt values.</p>
NO MERGE: Does not merge the perimeter elevations with the current Zpt values.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="vzsh-4"><span class="header-section-number">7.3.5.3</span> Variable Z Shape Layer (2d_vzsh)<a href="#vzsh-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW 2D model topography can be varied over time to simulate breaching
of embankments, raising of flood defences during an event, or the filling of a river due to a landslide, by
using <a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a>. The 2d_vzsh
layer is used to define the final topographic shape at the end of the topography change period. As summary of the GIS layer attributes is provided in Table <a href="#tab:tab-twoDVariable">55</a>. The first four attributes of 2d_vzsh are the same as the 2d_zsh layer. They are used to define the finished state of the variable geometry. Additional attributes have been added to allow the user to define
how/when the breach commences and for how long. The breach/fill can be
triggered using a number of methods:</p>
<ul>
<li>At a specified time (example provided in <a href="https://wiki.tuflow.com/Tutorial_M10#Part_1_-_2D_Variable_Geometry_Time_Trigger">TUFLOW Tutorial Module 10 - Part 1</a>);<br />
</li>
<li>When the water level reaches a specified height at a specified
(trigger) location (example provided in <a href="https://wiki.tuflow.com/Tutorial_M10#Part_2_-_2D_Variable_Geometry_Water_Level_Trigger">TUFLOW Tutorial Module 10 - Part 2</a>); or<br />
</li>
<li>When the water level difference between two triggers exceeds a
specified amount.</li>
</ul>
<p>Variable Z Shapes can be restored once or repeatedly. Examples would be
a breach of a flood defence wall or levee that is reinstated 6 hours
later, or a sand bar of a creek entrance that repeatedly opens and
closes. To use the restore feature, two additional attributes
Restore_Interval and Restore_Period are required as described below in
Table <a href="#tab:tab-twoDVariable">55</a>. For a single restoration event, only these two additional attributes are required. To restore repeatedly, “REPEAT” must be
specified in the Shape Options in column 4. Repeated restoration is only
possible for the water level and water level difference trigger methods,
as a time trigger will not be able to be reached on a second occasion.</p>
<p>Note, this variable geometry feature should be used instead of the 2d_bc VG option (unless the rate of change of the erosion/fill is non-linear) as 2d_vzsh layers are easier to define and manage.</p>
<table>
<caption>
<span id="tab:tab-twoDVariable">Table 55: </span><strong>2D Variable Z-Shape (2d_vzsh) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
Same as for Table <a href="#tab:tab-ZShapeAttribute">54</a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
dZ
</td>
<td style="text-align:left;">
<p>Same as for Table <a href="#tab:tab-ZShapeAttribute">54</a>.<br />
The exception is for a thin line, for which the final elevations along the line can be set to dZ metres above the current Zpt values.</p>
For example, if a thin line represents a fence that is being collapsed, and the finished height of the collapsed fence is to be 0.2m above existing ground levels, specify a dZ value of 0.2. Note this only applies if the NO MERGE Shape_Options has not been specified.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Shape_Width_or_dMax
</td>
<td style="text-align:left;">
Same as for Table <a href="#tab:tab-ZShapeAttribute">54</a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Shape_Options
</td>
<td style="text-align:left;">
<p><b>Point:</b></p>
<p>TRIGGER or TRIGGER 1D: Indicates the point is not an elevation point, but a trigger location. The trigger must be given a name using the Trigger_1 attribute. TRIGGER 1D is required if a 1D node water level is used to trigger a 2D variable Z-Shape. The trigger point must be snapped to the 1D node or channel end in the 2d_vzsh layer to achieve this.</p>
<p><b>Line or Polygon:</b> Same as for Table <a href="#tab:tab-ZShapeAttribute">54</a>. Except the ADD option is not supported.</p>
<p>REPEAT: Specify this option for the variable Z shape to repeatedly function indefinitely based on the below trigger and restore attributes.</p>
<p><b>Thin Line:</b></p>
<p>NO MERGE: For thin lines (Shape_Width_or_dMax = 0), the final elevations along the line are as specified. If NO MERGE is not specified for a thin line, the final elevations are set to be the same as the current Zpt values plus the dZ value.</p>
REPEAT: Specify this option for the variable Z shape to repeatedly function indefinitely based on the below trigger and restore attributes.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Trigger_1
</td>
<td style="text-align:left;">
<p><b>Point:</b> If Shape_Options is set to TRIGGER or TRIGGER 1D, enter the name of the trigger location. The name can contain any characters and can include spaces. Otherwise not used.</p>
<p><b>Line or Polygon:</b> To commence the failure at a specified time leave blank.</p>
<p>To commence failure based on reaching a water level elsewhere in the model, enter the name of the trigger location.</p>
<b>Thin Line:</b> For thin lines there are two special options as follows. Specify DEPTH to have the failure commence once the depth of water adjacent to the cell side exceeds the amount specified for Trigger_Value. Specify DEPTH DIFF to have the failure commence once the difference in water level across the cell side exceeds the amount specified for Trigger_Value.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Trigger_2
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<b>Line or Polygon:</b> The name of a second trigger location (only needed if the breach is to be initiated on a water level difference between two trigger locations).
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Trigger_Value
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line or Polygon:</b> If Trigger_1 is blank, the simulation time in hours that the breach is to commence.</p>
<p>If Trigger_1 is specified and Trigger_2 is left blank, the water level at Trigger_1 that needs to be reached to trigger the failure.</p>
<p>If both Trigger_1 and Trigger_2 are specified, the water level difference between Trigger_1 and Trigger_2 that needs to be exceeded to trigger the failure. The water level difference is taken as the absolute of the difference between Trigger_1 and Trigger_2, so there is no need to specify a negative value.</p>
<p><b>Thin Line:</b></p>
<p>If “DEPTH” is specified for Trigger_1, the depth in metres adjacent to the cell side that needs to be exceeded to trigger the failure at the cell side.</p>
<p>If “DEPTH DIFF” is specified for Trigger_1, the water level difference in metres across the cell side that needs to be exceeded to trigger the failure.</p>
For all of the above options the length units are metres if modelling in SI units, or feet, if using <tcmd><a href="#tcfUnits">Units</a> </tcmd><teq>==</teq><tblk> US Customary</tblk>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Period
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<b>Line or Polygon:</b> Time in hours over which the variation in Zpt elevations occurs.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Restore_Interval
</td>
<td style="text-align:left;">
<p>The time in hours between when the variable Z shape has finished altering the geometry and when to start restoring the Zpts back to their original values.</p>
<b>Note:</b> “REPEAT” must be specified in Column 4 to allow repeated triggering and restoration of the Variable Z Shape (for the water level and water level difference options), otherwise restoration will only occur once.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Restore_Period
</td>
<td style="text-align:left;">
Time in hours over which the variation in Zpt elevations occurs to restore the Zpts back to their original values.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p><strong>Example 1: Variable Z Shape Example: Breaching of an Embankment</strong></p>
<p>The image below shows an example of a 2d_vzsh layer. The solid magenta
line is the polygon, the magenta dashed lines are lines used to
enforce TIN breaklines, and the four magenta points all have an
elevation of 41.0m. The Shape_Options attribute for the polygon was set
to MIN (this means that the Zpt elevation can only be lowered (i.e.
eroded), and the dashed lines have Shape_Options of TIN (to indicate
that they are to be used for TIN generation, and not for Z lines). The
vertices of the polygon that do not have a point snapped to them will be automatically assigned an elevation based on the existing Zpt values. The polygon
vertices with the points snapped to them are assigned the elevation of
the point (in this case, all at 41.0m). The elevation of the dashed
lines will be constant at 41m as they are snapped to the 41m points.</p>
<p>The only other object in the layer is the yellow pin point labelled A.
This is a trigger point. Its only attribute values are: TRIGGER for
the Shape_Options attribute; and A for the Trigger_1 attribute. This sets
the point as a trigger point and the “A” is the name of the trigger
point. The magenta polygon also has attribute values of: A for Trigger_1
(this indicates that the erosion trigger is based on the water level at
Trigger Location A); a Trigger_Value of 42.0 (i.e. when the water level
at location A reaches 42m, start the erosion); and a Period value of 1.0
indicating that the erosion takes one hour to complete.</p>
<center>
<img src="images/image96.png"
style="width:5.33627in;height:3.23684in" />
</center>
<p>The final eroded Zpt values are based on the TIN created by TUFLOW (the
grey triangles in the image below). The central section will be
horizontal at 41m, sloping up either end to elevations based on the road
level. The <a href="https://wiki.tuflow.com/Check_Files_2d_vzsh">_vzsh_zpt_check</a> layer is useful to view the Zpts
affected by the variable Z shape. This layer is also shown in the image
below. The green triangles indicate that the Zpt level is to be eroded,
and the crosses indicate no change (this is because of the MIN
Shape_Options). The final eroded Zpt values are labelled in the image
below. Other useful attributes are also available in this layer.</p>
<center>
<img src="images/image97.jpeg" style="width:5.43972in;height:3.04408in"
alt="ZSH Example 2" />
</center>
<p>The images below show the modelled breach which occurs using the example
above. Each image is in half hour intervals. The colour shading is of
the elevations (specify ZH as a <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a> to view the changes in ground level over
time).</p>
<center>
<img src="images/image98.png" style="width:2.96in;height:2.07in" />
<img src="images/image99.png" style="width:2.96in;height:2.07in" />
</center>
<center>
<img src="images/image100.png"
style="width:2.98237in;height:2.09378in" />
<img src="images/image101.png" style="width:2.96in;height:2.08in" />
</center>
<h4 class="hasAnchor" id="ztin-4"><span class="header-section-number">7.3.5.4</span> 3D TIN Layers (2d_ztin)<a href="#ztin-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- PAR to EFC: remove first example, replace with text and link to example models.  Second example move to 2d zsh section. Update so 3 panels rather than 4 panels-->
<!--done-->
<p>TINs (triangulations) of elevation points and 3D lines within a polygon
can be carried out using <a href="#tgcCreateTINZpts">Create TIN Zpts</a>. This is
particularly useful for modifying the Zpt elevations where there have
been, or are proposed, changes to the base DEM Zpt values.</p>
<p>Note, for large datasets it is likely to be much more efficient to use GIS or 3D surface modelling software to triangulate the data, and read triangulated data in a supported format (see <a href="#tgcReadTINZpts">Read TIN Zpts</a>) or to convert to raster (see <a href="#tgcReadGridZpts">Read Grid Zpts</a>).</p>
<p>The protocols applied to the <a href="#tgcCreateTINZpts">Create TIN Zpts</a>
command are:</p>
<ol style="list-style-type: decimal">
<li>A TIN is created for each polygon in the 2d_ztin layer.<br />
</li>
<li>Any points found within a polygon are used when generating the TIN.<br />
</li>
<li>Any lines are converted to points, and those points falling within
the polygon are used for the TIN creation. Lines are converted to
points as follows:
<ol style="list-style-type: decimal">
<li>All vertices (nodes) of the line are converted to points.<br />
</li>
<li>The dMax attribute is used to insert additional vertices between
the line’s vertices. For example, if dMax is set to 10, then
additional intermediate vertices are inserted at least every 10
metres (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>) between the existing vertices where the distance between
the existing vertices exceeds this value. If the dMax attribute does
not exist or is zero, half the 2D domain’s <a href="#tgcCellSize">Cell
Size</a> is used as the dMax value.<br />
</li>
<li>If there are any points snapped to the line’s vertices, the
elevations of these points are used to set the elevations at all
the vertices generated along the line. In this way, a 3D
breakline effect can be produced within the TIN. If there are no
points snapped to the line, the line’s Z attribute elevation is
used giving the effect of a horizontal line.<br />
</li>
</ol></li>
<li>The perimeter of the polygon/TIN can either be merged with the
current Zpt values or have its own values as follows:
<ol style="list-style-type: decimal">
<li>If there are no points snapped to the perimeter of the polygon,
the elevations of the polygon’s perimeter vertices, and of any
automatically inserted vertices, are based on the current Zpt
values (i.e. the Zpt values assigned by any prior commands).<br />
</li>
<li>If there are one or more points snapped to the polygon’s
perimeter vertices, the perimeter is not merged with the Zpt
values, and the elevations of the snapped points are used to
assign elevations to the perimeter vertices and any
automatically inserted vertices.<br />
</li>
<li>The frequency of any automatically inserted points around the
perimeter is controlled by the dMax attribute. If the dMax
attribute does not exist or is zero, half the 2D domain’s <a href="#tgcCellSize">Cell
Size</a> is used.</li>
</ol></li>
</ol>
<p>Models using the <a href="#tgcCreateTINZpts">Create TIN Zpts</a> functionality are provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Topography_Features">Static Topography Updates Example Model Dataset</a> on the TUFLOW Wiki.</p>
<p>A useful quality control option of <a href="#tgcCreateTINZpts">Create TIN Zpts</a>
is the WRITE TIN option. If this option is specified, a SMS .tin file is
written for each TIN generated, and the triangles are written to the
<a href="https://wiki.tuflow.com/Check_Files_2d_sh_obj">_sh_obj_check</a> layer. This means that the TIN can be cross-checked
in SMS, viewed in 3D, and edited and modified if desired. <a href="#tgcReadTINZpts">Read TIN
Zpts</a> can be used to assign Zpt elevations from the
modified SMS TIN.</p>
<p>A second argument to specify a GIS layer containing one or more polygons
to clip the area of Zpts to be inspected can be used with the <a href="#tgcReadTINZpts">Read TIN
Zpts</a> command. Refer to Section <a href="#DEMGrids-3"><strong>??</strong></a> for more information.</p>
<table>
<caption>
<span id="tab:tab-TinAttribute">Table 56: </span><strong>2D Tin (2d_ztin) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
<p><b>Point:</b> Elevation of the point.</p>
<p><b>Line:</b> Elevation of the line. Ignored if there are any points snapped to the line’s vertices.</p>
<b>Polygon:</b> Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
dMax
(optional)
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line:</b> Maximum distance between automatically created intermediate vertices. If set to zero or this attribute does not exist, half the 2D domain’s <a href="#tgcCellSize">Cell Size</a> is used. If less than zero no intermediate vertices are inserted.</p>
<b>Polygon:</b> Same as for Line above.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<!--EFC to PAR: how much to we need to update below? Still refers to mif. Would it be equivalent if I change to shp?-->
<!--PAR to EFC: remove entire example-->
<!-- CAD package export out a TIN and use read tin rather than this example. Change to -->
<!--
**Example 1: Haul Road Example of Using Create TIN Zpts**

The images and text below illustrate an example of using [Create TIN
Zpts](#tgcCreateTINZpts) to easily incorporate a proposed haul road into
a TUFLOW model. [Read GIS Z Shape](#tgcReadGISZShape) can also be used in
a similar manner. The data for this example was provided courtesy of
[Hatch](https://www.hatch.com/).

The image below shows the base DEM and a layer of points provided from a
civil design CAD package in XYZ format. The points represent a proposed
haul road to be built across the floodplain.

<center><img src="images/image74.png" style="width:6in;height:3.63542in" /></center>

The points were copied into a MapInfo layer named
2d_ztin_haul_road_pts.tab, with the only attribute being the Elevation
attribute that contains the Z values. A new layer was created and named
2d_ztin_haul_road.tab, and the polygon shown as the black solid line in
the image below was digitised. Note the polygon does not need to snap to
any of the points and can be digitised roughly. Alternatively, the
points and polygon can be placed in the same layer if desired.

<center><img src="images/image75.png" style="width:6in;height:3.63542in" /></center>

[Create TIN Zpts](#tgcCreateTINZpts) == 2d_ztin_haul_road.shp was used
to have TUFLOW create a TIN within the polygon as shown in the image
below and override the DEM Zpt values.

<center><img src="images/image76.png" style="width:6in;height:3.63542in" /></center>

The image below is of a DEM created from the TUFLOW Zpts with the
polygon shown in grey. As can be seen the haul road TIN has merged
seamlessly with the existing Zpts from the base DEM.

<center><img src="images/image77.png" style="width:6in;height:3.63542in" /></center>

The WRITE TIN option (see [Create TIN Zpts](#tgcCreateTINZpts)) can be
used to write the TUFLOW TIN as a SMS .tin file. This file can be opened
in SMS for viewing and editing the TIN. The image below shows the haul
road TIN in 3D. If the TIN is modified, [Read TIN Zpts](#tgcReadTINZpts)
can be used to read the TIN back into TUFLOW.

<center><img src="images/image78.png"
style="width:6.29167in;height:3.96875in" /></center>
-->
<h4 class="hasAnchor" id="zln-4"><span class="header-section-number">7.3.5.5</span> 3D Breakline Layers (2d_zln)<a href="#zln-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is a legacy feature and it is recommended to use the Z Shape functionality (Section <a href="#zsh-4"><strong>??</strong></a>) instead. For details on this feature see <a href="#tgcReadGISZLine">Read GIS Z Line</a> in Appendix <a href="#TGCCommands-1"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="zpt-4"><span class="header-section-number">7.3.5.6</span> Zpt Layers (2d_zpt)<a href="#zpt-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This is a legacy feature, to define base elevations it is recommended to use the <a href="#tgcReadGridZpts">Read Grid Zpts</a> functionality (Section <a href="#DEMGrids-3"><strong>??</strong></a>) instead. For details on this legacy feature see <a href="#tgcReadRowColGrid">Read RowCol Zpts</a> in Appendix <a href="#TGCCommands-1"><strong>??</strong></a>.</p>
<p>Similarly, <a href="tgcReadGISZpt">Read GIS Zpts</a> is also a legacy command. It is recommended to use the Z Shape functionality (Section <a href="#zsh-4"><strong>??</strong></a>) instead of it.</p>
<h4 class="hasAnchor" id="using-multiple-layers-and-points-layers"><span class="header-section-number">7.3.5.7</span> Using Multiple Layers and Points Layers<a href="#using-multiple-layers-and-points-layers" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>GIS layers used for <a href="#tgcReadGISZShape">Read GIS Z Shape</a>, <a href="#tgcReadGISVariableZShape">Read GIS Variable Z
Shape</a>, <a href="#tgcCreateTINZpts">Create TIN Zpts</a>, <a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a>, <a href="#tgcReadGISZLine">Read GIS Z Line</a> (legacy), <a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a> (legacy) and <a href="#tgcReadGISFCShape">Read GIS FC Shape</a> (legacy) can be split into more than one layer to better manage the variety of data these commands sometimes require.</p>
<p>For example, one layer may contain the elevation points, another the TIN
lines and polygons and another the 3D Z lines. This is useful in terms
of managing the data, and especially when interrogating and/or viewing
the data in GIS. It is a requirement of the shapefile format that the
different geometries (points, lines and regions) are in separate
shapefiles. The TUFLOW empty template files include the following
filename suffixes to differentiate which files are suitable for point,
line or region features.</p>
<ul>
<li>_P for point features (e.g. 2d_zsh_M03_002_P.shp)<br />
</li>
<li>_L for line features (e.g. 2d_zsh_M03_002_L.shp)<br />
</li>
<li>_R for region or polygon features (e.g. 2d_zsh_M03_002_R.shp)</li>
</ul>
<p>This is optional for MapInfo users; the different geometries can occur
in the same MapInfo file or can be separated if preferred.</p>
<p>A maximum of nine (9) layers per command line is allowed, and each layer
is separated by a vertical bar (“|”). For example, to read a Z Shape
layer which has both line and points, the command may be:</p>
<p><tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> == </teq><tblk>gis\2d_zsh_M03_002_L.shp | gis\2d_zsh_M03_002_P.shp</tblk></p>
<p>If using the GeoPackage format &amp;&amp; is also used to specify more than one layer from a common database in the same command line. An example is provided below. See Section <a href="#GPKG-3"><strong>??</strong></a> for further details.</p>
<p><tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> ==</teq> <tblk>gis\2d_zsh_R.gpkg | gis\2d_zsh_002.gpkg &gt;&gt; 2d_zsh_L &amp;&amp; 2d_zsh_P</tblk></p>
<h5 class="hasAnchor" id="point-only-5"><span class="header-section-number">7.3.5.7.1</span> Point Only Layers<a href="#point-only-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To minimise the number of attributes, some/all points may optionally be
placed into a separate layer with less attributes as discussed below.
This simplifies the datasets making them easier to manage and
interrogate.</p>
<p>A layer is treated as a separate points layer if:</p>
<ol style="list-style-type: decimal">
<li>It has less attributes than the minimum required for the command.
For most commands there is only one attribute for the points layer
(i.e. Elevation or Z) as described in Table <a href="#tab:tab-twoDZAttribute">57</a>. The
exception is <a href="#tgcReadGISFCShape">Read GIS FC Shape</a>, which
requires the first two attributes. This option requires that the
points layer be defined within the command line syntax. For example:<br />
<tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> == </teq><tblk>gis\2d_zsh_M03_002_L.shp | gis\2d_zsh_M03_002_P.shp</tblk><br />
</li>
<li>The points file uses the same filename as the associated line or
region file with the addition of “_pts” as a suffix to its filename
(for example 2d_zsh_M03_002_pts.shp will be automatically associated
with the line file 2d_zsh_M03_002.shp). This option is supported for
backward compatibility; however, it’s recommended that this option
not be used (it is preferable to enter the filename of the second
layer so that it is clear as to which layers are being used).<br />
<tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> == </teq><tblk>gis\2d_zsh_M03_002.shp</tblk></li>
</ol>
<p>The data processing logic for points layers is outlined below:</p>
<ol style="list-style-type: decimal">
<li>The specified layer, 2d_zsh_M03_002.shp, is opened. This layer may
or may not contain elevation points. If any elevation points exist
they are used.<br />
</li>
<li>A separate points layer can optionally be used to specify additional
points or all of the points. The layer can be specified in one of
two ways:
<ol style="list-style-type: decimal">
<li>Entering the pathname of the points layer after the main layer.
A “|” must be used to separate the two layers. The points layer
must be the second layer specified. For example:<br />
<tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> == </teq><tblk>gis\2d_zsh_M03_002_L.shp | gis\2d_zsh_M03_002_P.shp </tblk></li>
<li>Alternatively, name the points layer the same as the main layer, but
with a “_pts” extension. If a layer exists with the “_pts”
extension, TUFLOW automatically assumes this layer is associated
with the main layer and includes all points within this layer when
applying the above commands. For this example, the layer would be
named 2d_zsh_M03_002_L_pts.shp.<br />
</li>
</ol></li>
<li>The first approach (i) above prevails over the second (ii) if both
apply.<br />
</li>
<li>If neither (i) or (ii) apply, TUFLOW assumes there is no separate
points layer.</li>
</ol>
<p>Multiple points layers can be specified. The points layer can be
referenced in any location except for the first layer within the command
line entry. For example, the below syntax will produce an error due to
the points file being the first entry.</p>
<p><strong>Incorrect:<br />
</strong><tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> == </teq><tblk>
gis\2d_zsh_M03_002<mark>_P</mark>.shp |
gis\2d_zsh_M03_002<mark>_L</mark>.shp</tblk></p>
<p><strong>Correct:<br />
</strong><tcmd><a href="#tgcReadGISZShape">Read GIS Z Shape</a></tcmd><teq> == </teq><tblk>
gis\2d_zsh_M03_002<mark>_L</mark>.shp |
gis\2d_zsh_M03_002<mark>_P</mark>.shp</tblk></p>
<table>
<caption>
<span id="tab:tab-twoDZAttribute">Table 57: </span><strong>2D Z (2d_z_) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
Elevation (or change in elevation for ADD option) of the point.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="Materials-2"><span class="header-section-number">7.3.6</span> Land Use (Materials)<a href="#Materials-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="Bed-Resistance-4"><span class="header-section-number">7.3.6.1</span> Bed Resistance<a href="#Bed-Resistance-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The bed resistance values for 2D domains are created by using GIS layer polygons or rasters of different bed resistance zones. The default and recommended bed resistance formulation is Manning’s n. Manning’s n values can be varied with depth (as user specified curve or using the Log Law formula (see Section <a href="#mat-csv-5"><strong>??</strong></a>)) or varied with velocity-depth product (VxD).</p>
<p>For TUFLOW Classic, bed resistance can also be set to use either Manning’s M values (1/n) or Chezy coefficients using the <a href="#tcfBedResistanceValues">Bed Resistance Values</a> command in the .tcf file. As this is a TUFLOW Classic feature only, it is further discussed in Section <a href="#CLA-mat-3"><strong>??</strong></a>.</p>
<p>The recommended approach is to use materials to define how the bed roughness varies over the model. Each material is defined by a positive integer ID which represents a different roughness category. GIS layers of land-use or vegetation often make excellent material layers. Examples of different material categories are river in-bank, bank vegetation, pasture, maintained grass, roads, buildings, forest, mangroves, etc. Each material is assigned a constant Manning’s n value, depth or VxD varying Manning’s n. The material layer can also be used to set rainfall losses (if using direct rainfall - see Section <a href="#Rainfall-3"><strong>??</strong></a>), fraction impervious, storage area and land-use hazard categories (see Section <a href="#mat-csv-5"><strong>??</strong></a>).</p>
<p>Material/roughness values are used by TUFLOW during conveyance calculations at the cell mid-sides (refer to Section <a href="#Solvers-2"><strong>??</strong></a> and <a href="#Schematisation-3"><strong>??</strong></a>). However, rainfall losses and fraction impervious are applied to the cell and not cell sides, therefore, materials ID values are sampled at both cell mid-sides and cell centres.</p>
<p>The most common approach is to digitise one or more 2d_mat materials
layers (see Table <a href="#tab:tab-twoDMaterials">58</a>) and assign Manning’s n values to the materials using <a href="#tcfReadMaterialsFile">Read Materials File</a>. This approach allows the easy adjustment of Manning’s n values, for example during model
calibration or sensitivity testing.</p>
<p>When creating the base 2d_mat layer, it is common practice to not digitise
the most common or the most difficult to digitise material, and instead use the
following data layering of commands in the .tgc file (see Section <a href="#TGC-3"><strong>??</strong></a>).</p>
<ul>
<li>Use <a href="#tgcSetMat">Set Mat</a> to set the most common material to all cells in a 2D domain.<br />
</li>
<li>Use <a href="#tgcReadGISMat">Read GIS Mat</a> or <a href="#tgcReadGridMat">Read Grid Mat</a> to allocate the remaining material values.</li>
</ul>
<p>The <a href="#tgcReadGISMat">Read GIS Mat</a> and <a href="#tgcReadGridMat">Read Grid Mat</a>
commands may be used as many times as required to further modify the
materials in parts of a 2D domain. Each subsequent dataset will
overwrite the preceding assigned material value, as described in Section <a href="#layering-3"><strong>??</strong></a>.</p>
<p>The default material value is zero. As a material value of zero is not allowed, every cell and cell-side must be assigned a material value using <a href="#tgcSetMat">Set Mat</a>, <a href="#tgcReadGISMat">Read GIS Mat</a> and/or <a href="#tgcReadGridMat">Read Grid Mat</a> in the .tgc file
(it is good practice to always set a default materials value using the <a href="#tgcSetMat">Set Mat</a> as the first material command in the .tgc file). The assigned material ID values do not need to be contiguous but must be within the range 1 to 32,767.</p>
<table>
<caption>
<span id="tab:tab-twoDMaterials">Table 58: </span><strong>2D Materials (2d_mat) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Material
</td>
<td style="text-align:left;">
The material ID value referenced within a Materials File (see Section <a href="#Materials-File-4"><strong>??</strong></a>).
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="log-law-4"><span class="header-section-number">7.3.6.2</span> Log Law Depth Varying Bed Resistance<a href="#log-law-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>At very shallow depths the Manning’s n value and/or equation may not be
a reliable estimate of bed resistance. The Log Law or “Law of the Wall”
approach offers a theoretically based derivation of resistance based on
a bed shear analysis. This relationship along with benchmarking against
flume test results was used by <span class="citation">Boyte (<a href="#ref-Boyte2014">2014</a>)</span> to derive the following
equation that varies Manning’s n with depth based on the roughness
height of the surface. A limiting Manning’s n value based on the n value
that would normally be applied is also specified to transition to
conventional n values at greater depths.</p>
<p><span class="math display" id="eq:equ-law-of-wall-1">\[\begin{equation}
n = \max_{}\left\lbrack \frac{\kappa y^{\frac{1}{6}}}{\sqrt{g}\ln\left( \frac{y}{z_{0}e} \right)},n_{limit}\  \right\rbrack
\tag{38}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-law-of-wall-2">\[\begin{equation}
z_{0} = \ \frac{k_{s}}{30} + \frac{0.11\nu}{U_{f}}
\tag{39}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(k_s\)</span> is the roughness height in m<br />
</li>
<li><span class="math inline">\(\kappa\)</span> is typically in the range 0.38 to 0.42 (recommend 0.4)<br />
</li>
<li><span class="math inline">\(y\)</span> is depth<br />
</li>
<li><span class="math inline">\(\nu\)</span> is the kinematic viscosity and is set to 10<sup>-6</sup> m<sup>2</sup>/s<br />
</li>
<li><span class="math inline">\(U_f\)</span> is the friction velocity defined as <span class="math inline">\(\sqrt{Sgy}\)</span> where <span class="math inline">\(y\)</span> approximates <span class="math inline">\(A/P\)</span> and <span class="math inline">\(S\)</span> is the water surface slope<br />
</li>
<li><span class="math inline">\(n_{limit}\)</span> is the limiting n value, ie. the Manning’s n value applicable to greater depths</li>
</ul>
<p>Figure <a href="#fig:fig-image102">49</a> illustrates how the equivalent Manning’s n varies with depth using the
log law for a roughness height of 10mm (0.01m) that would be applicable
to a small pebble bed. The different series are the variations in the
slope, <span class="math inline">\(S\)</span>, where 0.001 is 0.1% slope, 0.02 is 2% slope and 0.1 is a 10%
slope. As can be seen there is a significant variation in Manning’s n
below 2cm (0.02m) and a trend to a n value of around 0.018, with only a
minor variation due to slope.</p>
<p>In terms of applying a limiting n value, if, for example, <span class="math inline">\(n_{limit}\)</span> was set to 0.02, then the Manning’s n value would
not fall below 0.02.</p>
<p>Figure <a href="#fig:fig-image103">50</a> shows a comparison using the Log Law versus a constant Manning’s n value <span class="citation">(<a href="#ref-Boyte2014">Boyte, 2014</a>)</span>.
The thesis investigated the use of the Law of the Wall for direct rainfall modelling using TUFLOW. The flow depths in this example range from 4 to 20cm and the roughness height, <span class="math inline">\(k_s\)</span>, was 3cm.</p>
<p>The Log Law Depth Varying Bed Resistance is activated by entering special characters in the 2nd column of the Materials File. See Section <a href="#Materials-File-4"><strong>??</strong></a> and Table <a href="#tab:tab-MaterialsFormat">59</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image102"></span>
<img src="images/image102.jpeg" alt="Example of Log Law Variation of Manning’s n with Depth" width="60%" />
<p class="caption">
Figure 49: Example of Log Law Variation of Manning’s n with Depth
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image103"></span>
<img src="images/image103.jpeg" alt="Example of Log Law versus Constant Manning’s n with Depth" width="60%" />
<p class="caption">
Figure 50: Example of Log Law versus Constant Manning’s n with Depth
</p>
</div>
<h4 class="hasAnchor" id="Materials-File-4"><span class="header-section-number">7.3.6.3</span> Materials File<a href="#Materials-File-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Materials file(s) contain information on a material’s roughness and, optionally, rainfall losses if using direct rainfall. The file is referenced within the .tcf file using <a href="#tcfReadMaterialsFile">Read Materials File</a> and can be in one of two formats (.csv or .tmf). The .csv format is the recommended of the two options. It supports all functionality. The .tmf format does not. For example, the log law bed resistance option is only available via the .csv format. The .csv format also supports curves of Manning’s n versus depth.</p>
<p>More than one materials file may be specified by repeat occurrences of the command <a href="#tcfReadMaterialsFile">Read Materials File</a> however, most models will use only a single materials file. Any combination of .tmf and .csv files can be used and up to 1,000 materials are allowed in total.</p>
<p>If a second argument is provided with <a href="#tcfReadMaterialsFile">Read Materials File</a>, this value is used to factor all Manning’s n values. For example, the following command increasing all Manning’s n values by 10%:</p>
<p><tcmd><a href="#tcfReadMaterialsFile">Read Materials File</a></tcmd><teq> == </teq><tblk>My_Materials.tmf | 1.1</tblk></p>
<h5 class="hasAnchor" id="mat-csv-5"><span class="header-section-number">7.3.6.3.1</span> .csv Format<a href="#mat-csv-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The .csv format materials file is a comma delimited text file containing Manning’s n and other information for different materials (e.g. land-uses).
The format is intended to be generated from an Excel file database of materials and associated data in a similar manner to BC databases (with the option of using the Excel TUFLOW Macro .xlam macros to export to the .csv format - the Excel TUFLOW Tools.xlam can be downloaded from <a href="https://www.tuflow.com/downloads/#utilities">here</a>). The .csv can also be written from text editor if preferred.</p>
<p>The format of the materials.csv file is described in Table <a href="#tab:tab-MaterialsFormat">59</a>.</p>
<p>Note: The .csv format offers access to all materials features, whereas the .tmf format does not.</p>
<table>
<caption>
<span id="tab:tab-MaterialsFormat">Table 59: </span><strong>Materials .csv File Format</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mat (Material ID) number, which must be an integer.
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<p>Contains information on the bed resistance values (usually Manning’s n). The options available are:</p>
<ul>
<li>Single n value (the n value is assumed constant at all water depths).</li>
<li>Two pairs of depth and n values (see the y<sub>1</sub>, n<sub>1</sub>, y<sub>2</sub>, n<sub>2</sub> option described in Table <a href="#tab:tab-MaterialsFile">60</a> for the .tmf format (i.e. Columns 5 to 8). The values must be separated by commas.</li>
<li>A .csv file containing n vs depth values. By default, when the n vs depth values are read they are assumed to be in the first two columns of the .csv file containing the curve’s data. However, you can specify the columns to be used by placing the column label after the .csv filename using a vertical bar “|” to separate the column label from the .csv filename. If only one column label is given, this is assumed to be the depth column and the next column must contain the Manning’s n values. As for boundary data, TUFLOW searches down the rows until it finds the first numeric values and will start reading from this row until a row is found with no more numeric values. To view how the n values vary with depth over time, use the “n” option for <a href="#tcfMapOutputDataTypes">Map Output Data Types</a>.</li>
<li>If the first four characters are “VxD:” the Manning’s n values for the material will be varied according the velocity times depth product, rather than depth. The VxD versus n values are provided in the same manner as for depths described above. Note that the Manning’s n value never increases during the simulation, it can only remain the same or decrease. This feature was provided to allow the user to reduce Manning’s n with increasing VxD to represent the “stripping” of river banks in high VxD areas, and then keeping the reduced Manning’s n as the flood recedes, hence why the n value cannot increase once decreased during the simulation. VxD was used in preference for simply V to avoid reducing n values at very shallow depths (but high velocities) when the flood first inundates the 2D cells.</li>
<li>If the first four characters are “Log:” the bed resistance as defined by the theoretically derived log law for shallow flows is applied. Three numbers are required after the “Log:” in space or comma delimited format. These are: Ks (roughness height), Kappa (0.3 to 0.4) and the limiting Manning’s n value. See Section <a href="#log-law-4"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Sets the rainfall loss parameters using the initial loss/continuing loss option. The initial/continuing loss is entered as two comma delimited numbers in a similar manner to the third and fourth column values in the .tmf format. See Table <a href="#tab:tab-MaterialsFile">60</a>. Refer to Section <a href="#Rainfall-Losses-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Reserved.
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Defines the Storage Reduction Factor (SRF) value. If no fifth column entry exists, no SRF is applied. The default is an SRF of 0 (i.e. no change in storage). See Section <a href="#srf-3"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Defines the Fraction Impervious of the overlying material type. The value entered should be a number from 0.0 to 1.0 where 0.0 is fully pervious and 1.0 is fully impervious. The default is a value of 0.0, assuming that the overlying material is 100% pervious. This feature is used to influence the amount of water that is infiltrated into the ground with the soil infiltration feature. Refer to Section <a href="#Infiltration-2"><strong>??</strong></a> for more information.</li>
</ul>
<b>Note: This option works with the Soli Infiltration feature (see Section <a href="#Infiltration-2"><strong>??</strong></a>). It does not apply to materials rainfall losses (Column No 3 above) when applying direct rainfall (see Section <a href="#Rainfall-3"><strong>??</strong></a>).</b>
</td>
</tr>
</tbody>
</table>
<p>An example of a materials.csv is provided in Figure <a href="#fig:fig-image104">51</a>. To give a description of the material, this must be done after all inputs for that material and must be preceded by a “!” or “#”.</p>
<p>In the example shown in Figure <a href="#fig:fig-image104">51</a>:</p>
<ul>
<li>Material 1 has a constant n value of 0.03 and no rainfall loss
parameters.<br />
</li>
<li>Material 5 varies n with depth using the four y<sub>1</sub>,
n<sub>1</sub>, y<sub>2</sub>, n<sub>2</sub> values (as per .tmf format
approach) and no rainfall loss parameters.<br />
</li>
<li>Materials 11 and 12 use depth vaying n sourced from a file called
Grass.csv. As only one column label has been specified, the y values
must occur under that label and the n values must occur in the next
adjoining column (see Figure <a href="#fig:fig-image105">52</a>). An IL of 10mm and CL of 2mm/h for both materials will be used for any direct rainfall.<br />
</li>
<li>Materials 21 and 22 use depth vaying n sourced from a file called Trees.csv. As two column labels have been specified, the y and n values must occur under
the specified labels (see <a href="#fig:fig-image105">52</a>). An IL of 20mm
and CL of 2mm/h for Material 21, and 25 and 2 for Material 22, will be
used.<br />
</li>
<li>Material 31 uses the log law approach (Section <a href="#log-law-4"><strong>??</strong></a>) with a roughness height of 0.01m, Kappa value of 0.4 and limiting Manning’s n of 0.02. IL = 0mm and CL = 0mm. The fraction impervious value is set to 1.0 (fully impervious).</li>
<li>Material 32 use depth vaying n sourced from a file called Buildings.csv. In Buildings.csv Column A is used for y values and Column B for n values. IL = 0 and CL = 0. The storage reduction factor is set to 0.3 (30% reduction in storage) and the fraction impervious value is set to 1 (fully impervious).</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image104"></span>
<img src="images/image104b.png" alt="Example of Materials .csv File Format"  />
<p class="caption">
Figure 51: Example of Materials .csv File Format
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image105"></span>
<img src="images/image105a.png" alt="Example of the Grass.csv file read into the Materials.csv"  />
<p class="caption">
Figure 52: Example of the Grass.csv file read into the Materials.csv
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image106"></span>
<img src="images/image106a.png" alt="Example of the Trees.csv file read into the Materials.csv"  />
<p class="caption">
Figure 53: Example of the Trees.csv file read into the Materials.csv
</p>
</div>
<h5 class="hasAnchor" id="tmf-5"><span class="header-section-number">7.3.6.3.2</span> .tmf Format<a href="#tmf-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The .tmf format is a text file containing Manning’s n and other
information for different materials (e.g. land-uses). The file can
contain comments using the “#” and/or “!” comment characters at any location.
When comment characters are specified, the remainder of the line is ignored.
The format of the materials .tmf file is described in Table <a href="#tab:tab-MaterialsFile">60</a>. The first two
columns are mandatory and must be specified. All other columns are
optional. A maximum of 100 different materials can be specified in this format.</p>
<p>Note: The .tmf format does not offer all materials functionality,
whereas the .csv format in the above section does.</p>
<table>
<caption>
<span id="tab:tab-MaterialsFile">Table 60: </span><strong>Materials .tmf File Format</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Mat (Material ID) number, which must be an integer.
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
<p>Manning’s n value.</p>
<b>Note, if the four values in columns 5 to 8 are specified, the Manning’s n value in this column is ignored and not used.</b>
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Sets the initial loss if using a direct rainfall boundary (via <a href="#tbcReadGISRF">Read GIS RF</a> or <a href="#tcfRainfallControlFile">Rainfall Control File</a>). Refer to Section <a href="#Rainfall-Losses-4"><strong>??</strong></a>. This does not apply to <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a>. The units are mm, or if <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk> inches.
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Sets the continuing loss rate if using a direct rainfall boundary (via <a href="#tbcReadGISRF">Read GIS RF</a> or <a href="#tcfRainfallControlFile">Rainfall Control File</a>). Refer to Section <a href="#Rainfall-Losses-4"><strong>??</strong></a>. This does not apply to <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a>. The units are mm/hr, or if <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk> inches/hr.
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
y<sub>1</sub> – The depth below which the Manning’s n value n1 (column 6) is applied.
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
n<sub>1</sub> –The Manning’s n value applied below depth y<sub>1</sub> (column 5).
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
y<sub>2</sub> – The depth above which the Manning’s n value n<sub>2</sub> (column 8) is applied.
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
<p>n<sub>2</sub> –The Manning’s n value applied above depth y<sub>2</sub> (column 7).</p>
Between y<sub>1</sub> and y<sub>2</sub>, the Manning’s n value is interpolated between n<sub>1</sub> and n<sub>2</sub> according to <a href="#tcfBedResistanceDepthInterpolation">Bed Resistance Depth Interpolation</a>. When specifying values for columns 5 to 8, initial and continuing loss values must be specified in columns 3 and 4 as described above (use zero values if not using direct rainfall).
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Reserved.
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Defines the Storage Reduction Factor (SRF) value. The default is an SRF of 0. Enter 0 to ensure there is no change in 2D cell storage for the material type. See Section <a href="#srf-3"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
<p>Defines the fraction impervious of the overlying material type. The value entered should be a number from 0.0 to 1.0 where 0.0 is fully pervious and 1.0 is fully impervious. The default is a value of 0.0, assuming that the overlying material is 100% pervious. This feature is used to influence the amount of water that is infiltrated into the ground with the soil infiltration feature. Refer to Section <a href="#Infiltration-2"><strong>??</strong></a> for more information.</p>
<b>Note: This option works with the Soli Infiltration feature (see Section <a href="#Infiltration-2"><strong>??</strong></a>). It does not apply to materials rainfall losses (Column No 3 above) when applying direct rainfall (see Section <a href="#Rainfall-3"><strong>??</strong></a>).</b>
</td>
</tr>
</tbody>
</table>
<p>The .tmf file format is shown in the examples below. See <a href="#tgcSetMat">Set Mat</a>, <a href="#tgcReadGISMat">Read GIS Mat</a> and <a href="#tgcReadGridMat">Read Grid Mat</a> for assigning the material IDs to the 2D domains. These material values may also be used to define bed resistance values across 1D XZ cross-sections (see Section <a href="#RR-M-5"><strong>??</strong></a>).</p>
<ol>
<tgrn>! Comments and blank lines are allowed in this file</tgrn><br />
<tgrn>! First value is the Mat value, Second is the Manning’s n value</tgrn><br />
<tblk>1, 0.03</tblk><tgrn>! waterways</tgrn><br />
<tblk>2, 0.08</tblk><tgrn>! river banks</tgrn><br />
<tblk>11, 0.06</tblk><tgrn>! grazing land</tgrn><br />
<tblk>12, 0.04</tblk><tgrn>! parks and gardens</tgrn><br />
<tblk>13, 0.15</tblk><tgrn>! sugar cane</tgrn><br />
<tblk>14, 0.12</tblk><tgrn>! natural forest</tgrn><br />
<tblk>15, 0.02</tblk><tgrn>! roads</tgrn>
</ol>
<p>To include the initial loss (mm) and the continuing loss rate (mm/h)
optionally enter a third and fourth value as shown below. If an IL is
specified, a CL must also be specified otherwise an ERROR occurs. Both
can be omitted, in which case, they are both set to zero.</p>
<ol>
<tblk>1, 0.03</tblk><tgrn>! waterways</tgrn><br />
<tblk>2, 0.08, 20, 2</tblk><tgrn>! river banks</tgrn><br />
<tblk>11, 0.06, 20, 2</tblk><tgrn>! grazing land</tgrn><br />
<tblk>12, 0.04, 5, 1.5</tblk><tgrn>! parks and gardens</tgrn><br />
<tblk>13, 0.15, 10, 2</tblk><tgrn>! sugar cane</tgrn><br />
<tblk>14, 0.12, 30, 2.5</tblk><tgrn>! natural forest</tgrn><br />
<tblk>15, 0.02, 2, 0</tblk><tgrn>! roads</tgrn>
</ol>
<p>To vary n values with depth (m) using two pairs of values optionally
enter values in the fifth to eighth columns as shown below in lines 2
and 3 (Materials 2 and 11) below. IL and CL values must be entered (use
zero if not relevant). If depth varying manning’s n is not used, column
5 to 8 should be left blank, not set to zero.</p>
<ol>
<tblk>1, 0.03</tblk><tgrn>! waterways</tgrn><br />
<tblk>2, 0.08, 20, 2, 0.3, 0.15, 0.5, 0.08</tblk><tgrn>! river banks with long grass 0.3m high</tgrn><br />
<tblk>11, 0.06, 20, 2, 0.1, 0.1, 0.15, 0.06</tblk><tgrn>! grazing land</tgrn><br />
<tblk>12, 0.04, 5, 1.5</tblk><tgrn>! parks and gardens</tgrn><br />
<tblk>13, 0.15, 10, 2</tblk><tgrn>! sugar cane</tgrn><br />
<tblk>14, 0.12, 30, 2.5</tblk><tgrn>! natural forest</tgrn><br />
<tblk>15, 0.02, 2, 0</tblk><tgrn>! roads</tgrn>
</ol>
<p>To reduce the storage of cells, enter a SRF value in the tenth column as
shown in line 7 for Material 15 below. The example shown reduces the
storage of all cells with Material ID of 15 by 20%. Note
that a value of -1 has been entered for the ninth column as this field
has been reserved. If not used, specify 0 to ensure
no change in storage for the material.</p>
<ol>
<tblk>1, 0.03</tblk><tgrn>! waterways</tgrn><br />
<tblk>2, 0.08, 20, 2, 0.3, 0.15, 0.5, 0.08</tblk><tgrn>! river banks with long grass 0.3m high</tgrn><br />
<tblk>11, 0.06, 20, 2, 0.1, 0.1, 0.15, 0.06</tblk><tgrn>! grazing land</tgrn><br />
<tblk>12, 0.04, 5, 1.5</tblk><tgrn>! parks and gardens</tgrn><br />
<tblk>13, 0.15, 10, 2</tblk><tgrn>! sugar cane</tgrn><br />
<tblk>14, 0.12, 30, 2.5</tblk><tgrn>! natural forest</tgrn><br />
<tblk>15, 0.02, 2, 0, , , , , -1, 0.2</tblk><tgrn>! roads with width reduced by 20%</tgrn>
</ol>
<p>To specify a fraction impervious, enter a value between 0.0 and 1.0 in
the eleventh column as shown in line 4 for Material 12 below. The
example shown partially restricts the rate of infiltration by applying a
fraction impervious of 0.1 or 10%.</p>
<ol>
<tblk>1, 0.03</tblk><tgrn>! waterways</tgrn><br />
<tblk>2, 0.08, 20, 2, 0.3, 0.15, 0.5, 0.08</tblk><tgrn>! river banks with long grass 0.3m high</tgrn><br />
<tblk>11, 0.06, 20, 2, 0.1, 0.1, 0.15, 0.06</tblk><tgrn>! grazing land</tgrn><br />
<tblk>12, 0.04, 5, 1.5, , , , , -1, 0, 0.1</tblk><tgrn>! parks and gardens (10% impervious)</tgrn><br />
<tblk>13, 0.15, 10, 2</tblk><tgrn>! sugar cane</tgrn><br />
<tblk>14, 0.12, 30, 2.5</tblk><tgrn>! natural forest</tgrn><br />
<tblk>15, 0.02, 2, 0, , , , , -1, 0.2</tblk><tgrn>! roads with width reduced by 20%</tgrn>
</ol>
<h4 class="hasAnchor" id="Rainfall-Losses-4"><span class="header-section-number">7.3.6.4</span> Rainfall Losses<a href="#Rainfall-Losses-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Rainfall losses applied through the Materials file (.tmf or
.csv format) remove the loss depth from the rainfall before it is
applied as a boundary on the 2D cells. Rainfall losses are ideal for
modelling situations in which water is prevented from reaching the
ground, such as through the interception by trees.</p>
<p><strong>Note that the ILCL rainfall losses are different to the ILCL infiltration
losses that can be applied using the .tsoilf file (refer to Section <a href="#tsoilf-4"><strong>??</strong></a>).</strong> The
ILCL soil infiltration losses will infiltrate ponded water into the
ground. It is possible to use both methods in the same simulation – for
example, rainfall that doesn’t reach the ground would be modelled as a
material IL/CL (applied as a loss to the rainfall) and infiltration into
the ground as IL/CL via soil types. The log file (see Section
<a href="#TLF-3"><strong>??</strong></a>) will report the material and soil properties separately as
shown in the example below:</p>
<p>Example Material Properties:</p>
<ol>
<tgrn>#4 - Material 4:</tgrn><br />
<tblk>Fixed Manning’s n = 0.030<br />
IL = 1.0mm, CL = 0.0mm/h<br />
Landuse Hazard ID not set.<br />
SRF (Storage Reduction Factor) = 0.<br />
Fraction Impervious = 0. <tblk>
</ol>
<p>Example Soil Properties:</p>
<ol>
<tgrn>#1 - Soil 1 [based on pre-defined soil type SAND]:</tgrn><br />
<tblk>Suction = 49.5 mm<br />
HydCond = 117.8 mm/hr<br />
Porosity = 0.417<br />
Initial Moisture = 0.2<br />
Soil Capacity = 0.217 </tblk>
</ol>
<p>Specifying the “fraction impervious” on the material allows the
materials and the soils to be independent (i.e. the same soil can be
present under both road and forest). <strong>This fraction impervious only
applies to the infiltration into the soil, not to the Materials file rainfall
losses.</strong></p>
<h3 class="hasAnchor" id="Infiltration-2"><span class="header-section-number">7.3.7</span> Infiltration<a href="#Infiltration-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Three methods are available to infiltrate ponded water from the surface into the ground:</p>
<ul>
<li>Green-Ampt (GA);<br />
</li>
<li>Horton (HO); and</li>
<li>Initial Loss/Continuing Loss (ILCL).</li>
</ul>
<p>When using TUFLOW HPC, it is possible to model multiple vertical groundwater layers, as well as enable horizontal flow of groundwater. As these features are only available in TUFLOW HPC, they are discussed in Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>.</p>
<p>All three methods mentioned above monitor the amount of water infiltrated and if the ground becomes saturated, infiltration ceases. The amount of water that can be infiltrated depends on:</p>
<ul>
<li>The infiltration approach and soil parameters used for the top most
(infiltration) soil layer.<br />
</li>
<li>The number, thickness, porosities, and initial moisture of the
groundwater layers.<br />
</li>
<li>The fraction impervious value of the overlying material layer.</li>
</ul>
<p>The cumulative infiltration data is stored and computed at cell centres. As such all soil data and groundwater layer geometry is sampled from the GIS / Grid layers at cell centres. Likewise the material “fraction impervious” data is sampled at cell centres (unlike the Manning’s values which are sampled at face
centres).</p>
<p>The following .tgc commands are used to set the ID for the soil type referenced in the TUFLOW soils file (.tsoilf) (Section <a href="#tsoilf-4"><strong>??</strong></a>):</p>
<ul>
<li><a href="#tgcSetSoil">Set Soil</a>;<br />
</li>
<li><a href="#tgcReadGISSoil">Read GIS Soil</a>; and<br />
</li>
<li><a href="#tgcReadGridSoil">Read Grid Soil</a>.</li>
</ul>
<p>Each of these commands has the option of specifying which soil layer(s) the command applies to. Note that 2D infiltration is activated by the occurrence of one of these commands. If none of the commands exists for a 2D domain, soil infiltration does not occur for that domain.</p>
<p>If soils are specified, the soil ID for each cell are written to the
<a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> layer. The .tlf file contains the parameters for each Soil
ID.</p>
<h4 class="hasAnchor" id="infiltration-layer-4"><span class="header-section-number">7.3.7.1</span> Infiltration Layer<a href="#infiltration-layer-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Only wet 2D cells can infiltrate water into the ground. If using soil
infiltration with a single groundwater layer, the default groundwater
depth is infinite. The depth (thickness) of the groundwater layer can be set globally using the following commands:</p>
<ul>
<li><a href="#tgcSetSoilThickness">Set Soil Thickness</a><br />
</li>
<li><a href="#tgcSetSoilBaseElevation">Set Soil Base Elevation</a></li>
</ul>
<p>They can also be set spatially with the following GIS and Grid commands:</p>
<ul>
<li><a href="#tgcReadGISSoilThickness">Read GIS Soil Thickness</a><br />
</li>
<li><a href="#tgcReadGISSoilBaseElevation">Read GIS Soil Base Elevation</a></li>
<li><a href="#tgcReadGridSoilThickness">Read Grid Soil Thickness</a></li>
<li><a href="#tgcReadGridSoilBaseElevation">Read Grid Soil Base Elevation</a></li>
</ul>
<p>The soil thickness sets the layer depth from the surface elevation. The soil base elevation sets the absolute elevation of the bottom of the layer. If both methods are specified for a given grid cell, the highest of the two will be adopted. The input units should be in metres or feet. To set an initial groundwater level within the soil layer, see Section <a href="#IGW-3"><strong>??</strong></a>.</p>
<p>In releases prior to 2023-03, the groundwater level (or depth) was set to represent a water table. For backward compatibility, it is still possible to the set a water table, using these commands:</p>
<ul>
<li><a href="#tgcSetGWD">Set GWD</a> or <a href="#tgcSetGWL">Set GWL</a></li>
<li><a href="#tgcReadGISGWD">Read GIS GWD</a> or <a href="#tgcReadGISGWL">Read GIS GWL</a></li>
<li><a href="#tgcReadGridGWD">Read Grid GWD</a> or <a href="#tgcReadGridGWL">Read Grid GWL</a></li>
</ul>
<p>The amount of water that enters the soil is also dependent on the
fraction impervious value of the overlying material layer. The default
is that the overlying material is 100% pervious (i.e. 0% impervious).
However, if, for example, a concrete parking lot overlies a sandy soil,
the imperviousness of the parking lot can be specified as 100% (i.e.
totally), or 90% (i.e. partially) restrict the rate of infiltration.
This is described in the materials file in Section <a href="#Materials-2"><strong>??</strong></a>.</p>
<p>If using TUFLOW HPC’s SGS functionality (Section <a href="#SGS-3"><strong>??</strong></a>), cells can be considered “partially wet”. This necessitated options for factoring down the rate of infiltration into the topmost groundwater layer, the methods are discussed in Section <a href="#SGS-Advanced-5"><strong>??</strong></a>.</p>
<h5 class="hasAnchor" id="green-ampt-ga"><span class="header-section-number">7.3.7.1.1</span> Green-Ampt (GA)<a href="#green-ampt-ga" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The Green-Ampt approach varies the rate of infiltration over time based
on the soil’s hydraulic conductivity, suction, porosity and initial
moisture content. The method assumes that as water begins to infiltrate
into the soil, a line develops differentiating between the “dry” soil
(with moisture content<span class="math inline">\(\ \theta_{i}\)</span>) and the “wet” soil (with moisture
content equal to the porosity of the soil <em>η</em>). As the infiltrated water
continues to move through the soil profile in a vertical direction, the
soil moisture changes instantly from the initial content to a saturated
state. This concept is presented in Figure <a href="#fig:fig-image109">54</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image109"></span>
<img src="images/image109a.png" alt="Green-Ampt Model Concept[^2]"  />
<p class="caption">
Figure 54: Green-Ampt Model Concept<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</p>
</div>
<p>The basic form of the Green-Ampt equation is expressed as follows:</p>
<p><span class="math display" id="eq:equ-GA">\[\begin{equation}
f(t) = K\left( 1 + \ \frac{\mathrm{\Delta}\theta\left( \varphi + h_{0} \right)}{F(t)} \right)
\tag{40}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(t\)</span> = time<br />
</li>
<li><span class="math inline">\(K\)</span> = saturated hydraulic conductivity<br />
</li>
<li><span class="math inline">\(\mathrm{\Delta}\theta\)</span> = defined as the soil capacity (the difference between the saturated and initial moisture content)<br />
</li>
<li><span class="math inline">\(\varphi\)</span> = soil suction head<br />
</li>
<li><span class="math inline">\(h_{0}\)</span> = depth of ponded water<br />
</li>
<li><span class="math inline">\(F(t)\)</span> = cumulative infiltration calculated from:</li>
</ul>
<p><span class="math display">\[F(t) - \ \mathrm{\Delta}\theta\left( \varphi + h_{0} \right)\ln\left( 1\  + \ \frac{F(t)}{\mathrm{\Delta}\theta\left( \varphi + h_{0} \right)} \right) = Kt\]</span></p>
<p>The <a href="https://wiki.tuflow.com/Green-Ampt_Infiltration_Parameters">TUFLOW Wiki</a> provides a detail description of the various Green-Ampt parameters, including how each influences the soil infiltration behaviour.</p>
<p>United States Department of Agriculture (USDA) soil types have been
hardwired into TUFLOW and are presented in Table <a href="#tab:tab-GreenAmpt">61</a>, along with the soil parameters. Alternatively, it is possible to define a
customised soil type by specifying user defined values as shown in
Table <a href="#tab:tab-tsoilf">62</a>.</p>
<table>
<caption>
<span id="tab:tab-GreenAmpt">Table 61: </span><strong>USDA Soil types for the Green-Ampt Infiltration Method</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
USDA Soil Type
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Suction (mm)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Suction (inches)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Hydraulic Conductivity (mm/hr)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Hydraulic Conductivity (in/hr)
</th>
<th style="text-align:center;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Porosity (Fraction)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Clay
</td>
<td style="text-align:center;">
316.3
</td>
<td style="text-align:center;">
12.453
</td>
<td style="text-align:center;">
0.3
</td>
<td style="text-align:center;">
0.012
</td>
<td style="text-align:center;">
0.385
</td>
</tr>
<tr>
<td style="text-align:left;">
Silty Clay
</td>
<td style="text-align:center;">
292.2
</td>
<td style="text-align:center;">
11.504
</td>
<td style="text-align:center;">
0.5
</td>
<td style="text-align:center;">
0.020
</td>
<td style="text-align:center;">
0.423
</td>
</tr>
<tr>
<td style="text-align:left;">
Sandy Clay
</td>
<td style="text-align:center;">
239.0
</td>
<td style="text-align:center;">
9.409
</td>
<td style="text-align:center;">
0.6
</td>
<td style="text-align:center;">
0.024
</td>
<td style="text-align:center;">
0.321
</td>
</tr>
<tr>
<td style="text-align:left;">
Clay Loam
</td>
<td style="text-align:center;">
208.8
</td>
<td style="text-align:center;">
8.220
</td>
<td style="text-align:center;">
1.0
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.309
</td>
</tr>
<tr>
<td style="text-align:left;">
Silty Clay Loam
</td>
<td style="text-align:center;">
273.0
</td>
<td style="text-align:center;">
10.748
</td>
<td style="text-align:center;">
1.0
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
0.432
</td>
</tr>
<tr>
<td style="text-align:left;">
Sandy Clay Loam
</td>
<td style="text-align:center;">
218.5
</td>
<td style="text-align:center;">
8.602
</td>
<td style="text-align:center;">
1.5
</td>
<td style="text-align:center;">
0.059
</td>
<td style="text-align:center;">
0.330
</td>
</tr>
<tr>
<td style="text-align:left;">
Silt Loam
</td>
<td style="text-align:center;">
166.8
</td>
<td style="text-align:center;">
6.567
</td>
<td style="text-align:center;">
3.4
</td>
<td style="text-align:center;">
0.134
</td>
<td style="text-align:center;">
0.486
</td>
</tr>
<tr>
<td style="text-align:left;">
Loam
</td>
<td style="text-align:center;">
88.9
</td>
<td style="text-align:center;">
3.500
</td>
<td style="text-align:center;">
7.6
</td>
<td style="text-align:center;">
0.299
</td>
<td style="text-align:center;">
0.434
</td>
</tr>
<tr>
<td style="text-align:left;">
Sandy Loam
</td>
<td style="text-align:center;">
110.1
</td>
<td style="text-align:center;">
4.335
</td>
<td style="text-align:center;">
10.9
</td>
<td style="text-align:center;">
0.429
</td>
<td style="text-align:center;">
0.412
</td>
</tr>
<tr>
<td style="text-align:left;">
Loamy Sand
</td>
<td style="text-align:center;">
61.3
</td>
<td style="text-align:center;">
2.413
</td>
<td style="text-align:center;">
29.9
</td>
<td style="text-align:center;">
1.177
</td>
<td style="text-align:center;">
0.401
</td>
</tr>
<tr>
<td style="text-align:left;">
Sand
</td>
<td style="text-align:center;">
49.5
</td>
<td style="text-align:center;">
1.949
</td>
<td style="text-align:center;">
117.8
</td>
<td style="text-align:center;">
4.638
</td>
<td style="text-align:center;">
0.417
</td>
</tr>
</tbody>
</table>
<p>The 2023-03 release introduces a slight change to the soil moisture
initialisation which impacts the computation of the Green-Ampt
infiltration rate. In previous TUFLOW releases, the initial moisture was
used to revise the soil porosity downwards, and the cumulative
infiltration was initialised to zero. In the 2023-03 release the soil
porosity is not modified, and the cumulative infiltration is initialised
as the lesser of the initial moisture fraction and the soil porosity,
times the thickness of the layer. These two approaches produce slightly
different results for the infiltration rate with the Green-Ampt method.
The new approach is perhaps more logical, and was necessary for the
purpose of initialising to a groundwater table. If the previous approach
is required, and the model has only one soil layer and no horizontal
advection, then it can be selected by using the <tcmd><a href="#tcfDefaults">Defaults</a>
</tcmd><teq>==</teq><tblk> Pre 2023</tblk> command.</p>
<h5 class="hasAnchor" id="horton-ho"><span class="header-section-number">7.3.7.1.2</span> Horton (HO)<a href="#horton-ho" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The Horton approach to infiltration uses the following equation:</p>
<p><span class="math display" id="eq:equ-HO">\[\begin{equation}
{f = f}_{c} + \left( f_{0} - f_{c} \right)e^{- kt}
\tag{41}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(f_0\)</span> is the initial infiltration rate in mm/hr or inches/hr (if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>)<br />
</li>
<li><span class="math inline">\(f_c\)</span> is the final (indefinite) infiltration rate<br />
</li>
<li><span class="math inline">\(t\)</span> is time in hours (period of time that the cell is wet)<br />
</li>
<li><span class="math inline">\(k\)</span> is the Horton decay rate.</li>
</ul>
<p>If an initial loss (IL) is specified, the initial loss is applied first,
followed by the Horton infiltration. Figure <a href="#fig:fig-image110">55</a> shows an example of how the infiltration rate varies over time for <span class="math inline">\(f_0\)</span> equal
to 3, <span class="math inline">\(f_c\)</span> equal to 1 and <span class="math inline">\(k\)</span> equal to 0.1.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image110"></span>
<img src="images/image110.jpeg" alt="Example of Horton Infiltration Rate over Time"  />
<p class="caption">
Figure 55: Example of Horton Infiltration Rate over Time
</p>
</div>
<h5 class="hasAnchor" id="initial-losscontinuing-loss-ilcl"><span class="header-section-number">7.3.7.1.3</span> Initial Loss/Continuing Loss (ILCL)<a href="#initial-losscontinuing-loss-ilcl" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The Initial Loss/Continuing Loss (IL/CL) method is a more simplistic approach
compared to the Green-Ampt and Horton infiltration methods. The IL/CL
method infiltrates water based on an initial volume (at any rate) then transitions to a constant rate after the initial loss volume is exceeded.</p>
<p><strong>Note that the IL/CL infiltration is separate to the IL/CL
materials values used to generate excess rainfall for direct rainfall
simulations (refer to Section <a href="#Rainfall-Losses-4"><strong>??</strong></a> for further
information).</strong></p>
<h4 class="hasAnchor" id="tsoilf-4"><span class="header-section-number">7.3.7.2</span> Soils File (.tsoilf)<a href="#tsoilf-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Soils infiltration is applied to the model by defining a soils (.tsoilf)
file, which is read into the .tcf using the <a href="#tcfReadSoilFile">Read Soils
File</a> command. Table <a href="#tab:tab-tsoilf">62</a> presents the parameters of the .tsoilf file and Figure <a href="#fig:fig-image111">56</a> shows an example of a completed file. A number of example models demonstrating the various soil options are available on the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Soil_Options">TUFLOW Wiki - Soil Options</a>. The soils (.tsoilf) file is similar to the materials file where you assign a positive integer ID to each soil, define the infiltration method (options are “NONE”, “GA”, “HO” and “ILCL”) followed by the soil parameters as the remaining
values. The Porosity (saturated moisture content), Initial Moisture (fraction of the soil that is initially wet), Max Ponding Depth and Horizontal Hydraulic Conductivity are all optional with default values of 1.0, 0.0, 0.0 and 0.0 respectively.</p>
<p><strong>Note: Table <a href="#tab:tab-tsoilf">62</a> does not include the additional attributes (in regards to horizontal advection) and soil type (convection) available when using TUFLOW HPC. For groundwater modelling including horizontal and vertical subsurface fluid movement, refer to Table <a href="#tab:tab-tsoilf-hpc">70</a> instead. </strong></p>
<table>
<caption>
<span id="tab:tab-tsoilf">Table 62: </span>Soil File (.tsoilf) Parameters
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No Intriltration
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Green-Ampt
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Green-Ampt
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Horton
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Initial/Continuing Loss
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
NONE
</td>
<td style="text-align:left;">
GA
</td>
<td style="text-align:left;">
GA
</td>
<td style="text-align:left;">
HO
</td>
<td style="text-align:left;">
ILCL
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
USDA<br />
Soil Type<br />
(see Table <a href="#tab:tab-GreenAmpt">61</a>)
</td>
<td style="text-align:left;">
Suction<br />
(mm or in)
</td>
<td style="text-align:left;">
Initial Loss<br />
(mm or inches)
</td>
<td style="text-align:left;">
Initial Loss<br />
(mm or inches)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Initial Moisture<br />
(Fraction)
</td>
<td style="text-align:left;">
Hydraulic Conductivity<br />
(mm/h or in/h)
</td>
<td style="text-align:left;">
Initial Loss Rate (<span class="math inline">\(f_0\)</span>) (mm/h or in/h)
</td>
<td style="text-align:left;">
Continuing Loss<br />
(mm/h or in/h)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Max Ponding Depth<br />
(m or ft)
</td>
<td style="text-align:left;">
Porosity<br />
(Fraction)
</td>
<td style="text-align:left;">
Final Loss Rate (<span class="math inline">\(f_c\)</span>) (mm/h or in/h)
</td>
<td style="text-align:left;">
Porosity<br />
(Fraction)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Initial Moisture<br />
(Fraction)
</td>
<td style="text-align:left;">
Exponential Decay Rate (k)<br />
(h-1)
</td>
<td style="text-align:left;">
Initial Moisture<br />
(Fraction)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Max Ponding<br />
Depth (m or ft)
</td>
<td style="text-align:left;">
Porosity<br />
(Fraction)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Initial Moisture<br />
(Fraction)
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<!-- EFC to PAR: do you think this note should be moved to the green-ampt chapter?-->
<!--PAR fine with this here-->
<p>Note for the Green-Ampt method:</p>
<ul>
<li>the initial moisture and porosity values in Table <a href="#tab:tab-tsoilf">62</a> above are fractions. The soil capacity is defined as the difference between the saturated moisture content (porosity) and the initial moisture content, hence the initial moisture should not exceed the porosity otherwise the soil capacity is set to zero and no infiltration will occur for that soil type. A <a href="http://wiki.tuflow.com/TUFLOW_Message_2508">WARNING 2508</a> is issued if this occurs.<br />
</li>
<li>the max ponding depth value is an optional value that can be used, if desired, to set a limit for the depth of ponded water (<span class="math inline">\(h_0\)</span>) value used in the Green-Ampt equation <a href="#eq:equ-GA">(40)</a>. The minimum of the water depth and the max ponding depth value is used as the <span class="math inline">\(h_0\)</span> value. The default max ponding depth value is 0, to be consistent with the basic form of the Green-Ampt equation, as hydrology models do not necessarily have a depth calculated at cells.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image111"></span>
<img src="images/image111.png" alt=" Example Soils .tsoilf File Format"  />
<p class="caption">
Figure 56:  Example Soils .tsoilf File Format
</p>
</div>
<p>One or more soils need to be specified globally and/or via GIS
layers/raster grids to activate the infiltration feature. The first
attribute of the GIS layer/s must be the Soil ID referenced within the
.tsoilf file, in the same way that a 2d_mat layer references a Material
ID stored within the materials .tmf or .csv file.</p>
<table>
<caption>
<span id="tab:tab-SoilAttribute">Table 63: </span><strong>2D Soil (2d_soil) GIS Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Soil
</td>
<td style="text-align:left;">
The soil ID value referenced within a Soils File (see Table <a href="#tab:tab-tsoilf">62</a>).
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
</tbody>
</table>
<p>Each soil type can have a different infiltration method and infiltration parameters assigned to it, including a no infiltration option, as shown
in Table <a href="#tab:tab-tsoilf">62</a>. Other parameters that can optionally be set are:</p>
<ul>
<li>The imperviousness of the surface (see Fraction Impervious parameter
within the materials definition in Table <a href="#tab:tab-MaterialsFile">60</a> or Table <a href="#tab:tab-MaterialsFormat">59</a>); and<br />
</li>
<li>Groundwater or impervious level beneath the ground surface (refer to
Section <a href="#IGW-3"><strong>??</strong></a>).</li>
</ul>
<p>The current limit to the number of soils types is 1,000 for TUFLOW classic simulations and 255 for TUFLOW HPC simulations.</p>
<!-- 
### Groundwater {#Groundwater-3}
<!-- EFC to PAR: I think we take out groundwater from 2D domains chapter and put in the initial conditions of the Boundaries chapter, this is where we have set IWL commands. That way we can talk about both GWD/GWL and IGW commands in one section rather than common vs HPC?-->
<!--
#### Groundwater Layer Geometry (2d_gw)

<!--EFC to PAR: how do I split this from the soils section in the 'common' section. I think we should maybe take soils out of common and put it in childs like turbulence?-->
<!-- PAR to EFC: keep in common, but add another tsoilf table in here, highligh additional attributes-->
<!-- move 2d_gw to boundaries chapter. -->
<!--
The geometry of the groundwater layers may be defined with either
<span class="mark">Set</span>, <span class="mark">Read GIS</span>, or
<span class="mark">Read Grid</span> commands with \<Soil Thickness \|
Soil Base Elevation\> (required) and \<Layer N\> (optional). Layer
number 1 is the top most layer. If specifying the layers thicknesses,
the base elevation of each layer is offset below the base of the layer
above (or the surface DEM elevation in the case of the first or topmost groundwater layer) by the thickness of that layer. The bottom most layer (or the top layer for a single layer), if not defined in this way, will
be infinitely deep, with infinite water holding capacity. As such a
layer has no sensible water surface elevation, advection of water is not
possible in an infinitely deep layer. Models with more than one layer
require all layers above the bottom layer to have a specified thickness
or base elevation level. Note that the use of Green-Ampt infiltration
model requires that the top most layer has a finite thickness.

For backward compatibility, it is still possible to set groundwater
depth (GWD) or a groundwater level (GWL) with the
“<span class="mark">Set</span>”, “<span class="mark">Read GIS</span>”,
and “<span class="mark">Read GRID</span>” commands.
<span class="mark">More explanation</span> <span class="mark">needed
…</span>

<span class="mark">It is also possible to define a groundwater depth
(GWD) or a groundwater level (GWL). Any infiltrated water causes the
groundwater level to rise. The rate of rise is influenced by the soil
porosity and initial moisture, for the Green-Ampt method, these
attributes are required, they can optionally be specified for ILCL and
Horton infiltration as described above. If the groundwater level rises
to the ground surface, no additional infiltration will occur. The
default setting is for an infinitely deep groundwater level. Only the
vertical filling of the groundwater table can occur (i.e. there is no
horizontal movement of groundwater, groundwater does not fall over
time).</span>

<span class="mark">The depth to groundwater or groundwater level may be
specified globally and/or via GIS layers/ASCII grids to activate the
feature using one or a combination of the following commands:</span>

<span class="mark">[Set GWD](#tgcSet) or [Set GWL](#tgcSet)  
[Read GIS GWD](#tgcReadGIS) or [Read GIS GWL](#tgcReadGIS)  
[Read GRID GWD](#tgcReadGrid) or [Read GRID GWL](#tgcReadGrid)</span>

<span class="mark">If both a groundwater level and groundwater depth are
specified the higher level is applied. For example, if a GWL of 1.0m is
applied to a cell with elevation of 2.5m and a GWD of 1.0 is applied the
starting groundwater level will be 1.5m (2.5m elevation – 1.0m
GWD).</span>
-->
<h3 class="hasAnchor" id="HydraulicStructures-3"><span class="header-section-number">7.3.8</span> Hydraulic Structures<a href="#HydraulicStructures-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="introduction-2"><span class="header-section-number">7.3.8.1</span> Introduction<a href="#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!--PAR to EFC: don't talk in detail about method D, suggest to use 2d_bg instead. The loss approach is the same-->
<!--EFC: Method D removed. SHG recalled that we decided not to mention it at all-->
<p>Bridges, box culverts and other structures that constrict flow can be
modelled in 2D directly, rather than using 1D elements, provided the flow width of
the structure is of a similar or larger size than the 2D cell size. Cells
are modified in their height (invert and obvert) and width. For bridges,
additional losses associated with piers and flow reaching the underside of the
deck are specified. For box culverts, the additional resistance for
vertical walls is specified. Additional form losses (energy head losses)
can be specified for all flow constrictions.</p>
<p>Weir flow (across levees and other embankments) is modelled in 2D
domains by default, this is handled differently between TUFLOW Classic and TUFLOW HPC. Refer to Sections <a href="#CLA-US-Controlled-3"><strong>??</strong></a> and <a href="#HPC-US-Controlled-3"><strong>??</strong></a> respectively.</p>
<p>Modelling hydraulic structures in 2D domains must be carried out with a
good understanding of the limitations of different approaches and the
different flow regimes possible. The modeller must understand why and
where the energy losses occur when assigning form losses to a 2D cell or
contraction and expansion losses to a 1D element <span class="citation">(<a href="#ref-Syme2001b">Syme, 2001b</a>)</span>.</p>
<p>It is important to note that contraction and expansion losses associated
with structures are modelled differently in 1D and 2D schemes. 1D
schemes rely on applying form loss coefficients, as they cannot simulate
the horizontal or vertical changes in velocity direction and speed. 2D
schemes model these horizontal changes and, therefore, do not require
the introduction of form losses to the same extent as that required for
1D schemes. 2D schemes still however require the introduction of
additional form losses since they do not model losses in the vertical or
fine-scale horizontal effects (such as around a bridge pier). See <span class="citation">Syme (<a href="#ref-Syme2001b">2001b</a>)</span> for further details.</p>
<p>The following webinars by Bill Syme and Greg Collecutt (two TUFLOW Developers) discuss the theory behind the energy losses and affluxes modelling associated with hydraulic structures.</p>
<ul>
<li><a href="https://www.tuflow.com/library/webinars/#structures">Modelling Energy Losses at Structures</a></li>
<li><a href="https://www.tuflow.com/library/webinars/#nov2022_hydraulic_modelling_bridge">1D, 2D &amp; 3D Hydraulic Modelling of Bridges</a></li>
</ul>
<p>Additionally, <a href="https://wiki.tuflow.com/TUFLOW_2D_Hydraulic_Structures">the 2D Hydralic Structures Wiki Page</a> contains information regarding 2D hydraulic structures, including theory, setup and Frequently Asked Questions (FAQs).</p>
<p>It is recommended that the losses through a structure be validated through:</p>
<ul>
<li>Calibration to recorded information (if available).</li>
<li>Cross-checked using desktop calculations based on theory and/or
standard publications (e.g. “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or “Guide to Bridge Technology Part 8, Hydraulic Design of
Waterway Structures” <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span>.</li>
<li>Crosschecked with results using other hydraulic software.</li>
</ul>
<p>To validate structure flows and energy losses:</p>
<ul>
<li>Specify time-series output (PO) lines of flow (Q_) and flow area (QA)
across the structure (see Section <a href="#TwoDTS-3"><strong>??</strong></a>). Upstream and
downstream water levels may also be specified using PO points or
extracted from the map (e.g. XMDF) output.<br />
</li>
<li>Using the upstream and downstream water levels, determine whether flow
is upstream or downstream controlled and estimate the flow using
theoretical equations or other methods.<br />
</li>
<li>Using publications such as “Hydraulics of Bridge Waterways”
<span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or “Guide to Bridge Technology Part 8, Hydraulic
Design of Waterway Structures” <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span>, determine the energy
loss coefficient and compare this with the total energy loss
calculated in the model. The total energy loss is given below.
Clearly, any energy losses associated with bed resistance (e.g.
Manning’s equation) need to be allowed for by subtracting this term
from the calculated head difference <span class="math inline">\({(h}_{1} - h_{2})\)</span>.<br />
<span class="math display">\[\zeta_{total} = {(h}_{1} - h_{2})\frac{2g}{V^{2}}\]</span><br />
Where:
<ul>
<li><span class="math inline">\(\zeta_{total}\)</span> = total energy loss<br />
</li>
<li><span class="math inline">\(h_{1}\)</span> = upstream head<br />
</li>
<li><span class="math inline">\(h_{2}\)</span> = downstream head<br />
</li>
<li><span class="math inline">\(V\)</span> = depth and width averaged velocity (i.e. <span class="math inline">\(\frac{Q\_}{QA}\)</span>)</li>
</ul></li>
</ul>
<p>Table <a href="#tab:tab-ModellingApproaches">64</a> lists the recommended approaches for modelling 1D and 2D structures using TUFLOW. This is discussed further in the following paragraphs.</p>
<table>
<caption>
<span id="tab:tab-ModellingApproaches">Table 64: </span><strong>Hydraulic Structure Modelling Approaches</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Structure
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
1D Approach
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
2D Approach
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Box Culvert<br />
(For culverts with a steep slope, use a 1D element)
</td>
<td style="text-align:left;">
OK
</td>
<td style="text-align:left;">
OK
</td>
</tr>
<tr>
<td style="text-align:left;">
Circular Culvert
</td>
<td style="text-align:left;">
OK
</td>
<td style="text-align:left;">
N/A
</td>
</tr>
<tr>
<td style="text-align:left;">
Bridge
</td>
<td style="text-align:left;">
OK
</td>
<td style="text-align:left;">
OK
</td>
</tr>
<tr>
<td style="text-align:left;">
Weirs
</td>
<td style="text-align:left;">
OK
</td>
<td style="text-align:left;">
OK
</td>
</tr>
</tbody>
</table>
<p><strong>1D Approach</strong></p>
<p>1D structures are discussed in Section <a href="#Structures-2"><strong>??</strong></a>. 1D modelling is the
preferred approach where the total structure width is less than one
or two 2D cells. Entry and/or exit losses are defined for each structure.
Testing has shown that these losses may need to be reduced where the
structure width is significant compared with the cell size <span class="citation">(<a href="#ref-Syme2001b">Syme, 2001b</a>)</span>.</p>
<p>1D structures can be linked to the 2D domain using either an SX or HX
connection, as outlined in (see Section <a href="#OneD2dLinking-2"><strong>??</strong></a>). The influence of these connection types on the modelled flow behaviour is shown in Figure <a href="#fig:fig-image114">59</a>.</p>
<p><strong>SX Link:</strong> Momentum is not transferred into or out of the 1D element
to/from the 2D domain. “Suppressed” flow patterns in the 2D domain occur
at the structure outlet when using 1D elements, especially if the
structure width is significant compared with the cell size. The water
tends to spread, rather than jet out, as there is no inertia across the
link. The effect of this is illustrated in Figure <a href="#fig:fig-image113">58</a>, which shows the effect on flow patterns and the preservation of inertia across 1D/2D links when modelling a structure. Figure <a href="#fig:fig-image113">58</a> (red velocity arrows) is that using SX links, whilst Figure <a href="#fig:fig-image112">57</a> (green arrows) is that using a fully 2D solution. As can be seen, using a SX link the water tends to spread from the structure outlet, as opposed to forming a jet as in the fully 2D solution which is conserving momentum. When using the SX link,
a jet like effect can be created using “wing walls” in the 2D domain at
the structure outlet by assigning flood free elevations to the ZU and ZV
Zpts either side of where the 1D element discharges into the 2D domain.</p>
<p><strong>HX Link:</strong> Momentum is not transferred into or out of the 1D element
to/from the 2D domain, however the velocity field across the HX link is
assumed to be undisturbed. Provided the HX link is appropriately located
(i.e. perpendicular to the flow field) this produces the effect of
preserving momentum, as illustrated by the dark blue arrows (Figure <a href="#fig:fig-image114">59</a>). Use of HX links at a structure may require a smaller 1D timestep than that required by a SX link.</p>
<p><strong>2D Approach</strong></p>
<p>2D representation of structures is preferred where the
total structure width is greater than one or two 2D cells. The flow area
must be adequately represented by the 2D Zpts and any adjustments to
cell widths (see Section <a href="#lfcsh-4"><strong>??</strong></a> and <a href="#bg-layer-4"><strong>??</strong></a>. The head drop across the structure during different flow regimes should be validated against other methods and/or literature. Some additional form losses are normally required to achieve correct head drop (see <span class="citation">Syme (<a href="#ref-Syme2001b">2001b</a>)</span>). Momentum is transferred through the
structure as shown in the top image (green arrows) in Figure <a href="#fig:fig-image112">57</a>, providing more realistic flow patterns than using a 1D element with a SX link, as illustrated by the middle image (red arrows) in Figure <a href="#fig:fig-image113">58</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image112"></span>
<img src="images/image112.png" alt="Flow patterns using 2D FC cells (i.e. a fully 2D solution)"  />
<p class="caption">
Figure 57: Flow patterns using 2D FC cells (i.e. a fully 2D solution)
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image113"></span>
<img src="images/image113.png" alt="Flow patterns using a 1D element connected to 2D SX links"  />
<p class="caption">
Figure 58: Flow patterns using a 1D element connected to 2D SX links
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image114"></span>
<img src="images/image114.png" alt="Flow patterns using a 1D element connected to 2D HX links"  />
<p class="caption">
Figure 59: Flow patterns using a 1D element connected to 2D HX links
</p>
</div>
<h4 class="hasAnchor" id="bg-layer-4"><span class="header-section-number">7.3.8.2</span> 2D Bridge Structures (2d_bg)<a href="#bg-layer-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Modelling bridge structures in the 2D domain is possible using the BG
Shape input layer (2d_bg). The 2d_bg layer facilitates the modelling of
bridge structures based on research on energy losses <span class="citation">(<a href="#ref-BridgeDeckAfflux">Collecutt et al., 2022</a>)</span>. This method is similar to the Layered Flow
Constrictions (described below in Section <a href="#lfcsh-4"><strong>??</strong></a>), however, some key updates have been made. The layers in a
2d_bg are called the “pier layer” and the “super structure layer”, which
consists of the “deck layer” and the “rail layer”.</p>
<p>Bridges can be defined as either a line or polygon GIS feature using the
.tgc command <a href="#tgcReadGISBGShape">Read GIS BG Shape</a>. The layer
attribute description is provided in Figure <a href="#fig:fig-2DBGAttributes">60</a> and Table <a href="#tab:tab-BridgeShapeAttributeDescriptions">65</a>.</p>
<p>Points can be used to spatially vary the bridge soffit, deck depth and
rail depth, with the BG Shape points input layer (2d_bg_pts). The layer
attribute description is provided in Table <a href="#tab:tab-BridgePointAttributeDescriptions">66</a>. This can be used to model an arch bridge or sloping deck. The point objects can be placed in
a separate layer to the line or polygon GIS features.</p>
<p>The 2d_bg layer adjusts the FLC value in the vertical as follows:</p>
<p><span class="math display">\[\zeta_{total} = \left( \zeta_{pier} + \zeta_{SuperS}\frac{y_{SuperS}}{D_{IP}} \right)\frac{(y_{pier} + y_{SuperS})}{y_{total}}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\zeta_{pier}\)</span> = FLC of the pier layer.<br />
</li>
<li><span class="math inline">\(\zeta_{SuperS}\)</span> = FLC to the superstructure layer.<br />
</li>
<li><span class="math inline">\(y_{SuperS}\)</span> = depth of water in the superstructure layer (cannot exceed</li>
<li><span class="math inline">\(D_{IP}\)</span>).<br />
</li>
<li><span class="math inline">\(D_{IP}\)</span> = depth to the inflection point from the bridge soffit.<br />
</li>
<li><span class="math inline">\(y_{pier}\)</span> = depth of water in the pier layer (cannot exceed</li>
<li><span class="math inline">\(D_{pier}\)</span>).<br />
</li>
<li><span class="math inline">\(D_{pier}\)</span> = depth of the pier layer, i.e. from the bed elevation to the bridge soffit.<br />
</li>
<li><span class="math inline">\(\zeta_{total}\)</span> = overall form loss coefficient applied</li>
</ul>
<p>The vertical distribution of the form loss coefficient has the following
characteristics:</p>
<ul>
<li>Water level below the deck layer: The same result as the 2d_lfcsh
approaches, i.e. a constant form loss based on that specified for the
pier layer (<span class="math inline">\(\zeta_{pier}\)</span>) is applied.<br />
</li>
<li>Water level between the deck soffit and the inflection point: The FLC
value is linearly increased from <span class="math inline">\(\zeta_{pier}\)</span> to
<span class="math inline">\(\zeta_{pier} + \zeta_{SuperS}\)</span>. The observations from the CFD and the
field measurement indicate the inflection point is located around 1.6
times the bridge deck depth above the bridge soffit. The “Inflection
Depth” (<span class="math inline">\(D_{IP}\)</span>) is assumed as:<br />
<span class="math display">\[D_{IP} = {IPf}_{SuperS}\left( D_{deck}\phi_{Deck} + D_{Rail}\phi_{Rail} \right)\]</span><br />
Where:
<ul>
<li><span class="math inline">\({IPf}_{SuperS}\)</span> = A factor to set the elevation of the inflection point
(IP).<br />
</li>
<li><span class="math inline">\(D_{deck}\)</span> = depth of the bridg deck layer.<br />
</li>
<li><span class="math inline">\(\phi_{Deck}\)</span> = blockage of the deck layer.<br />
</li>
<li><span class="math inline">\(D_{Rail}\)</span> = depth of the rail layer.<br />
</li>
<li><span class="math inline">\(\phi_{Rail}\)</span> = blockage of the rail layer.<br />
</li>
</ul></li>
<li>Note that the effect of partial blockage at the rail layer is
considered by adding the rail layer depth (<span class="math inline">\(D_{Rail}\)</span>) to the
inflection depth proportionally based on the rail layer blockage
(<span class="math inline">\(\phi_{Deck}\)</span>).<br />
</li>
<li>Above the inflection point the FLC gradually reduces with increasing
depth (in a similar manner to the 2D Layered Flow Constrictions METHOD
B and METHOD C approaches). This is to simulate the transition to
drowned flow and tendency to zero energy losses with increasing depth
over the bridge deck.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-2DBGAttributes"></span>
<img src="images/image117.jpeg" alt="2D BG Shape Attributes and Vertical Distribution of Form Loss Coefficient" width="80%" />
<p class="caption">
Figure 60: 2D BG Shape Attributes and Vertical Distribution of Form Loss Coefficient
</p>
</div>
<p>The 2023-03-AD build implemented three extra approaches to adjust the FLC value between in the deck soffit and the inflection point:</p>
<p><tcmd><a href="#tcfBGFLCDefaultApproach">BG FLC Default Approach</a></tcmd><teq> == </teq><tblk>{LINEAR} | LINEAR-CONSTANT | PARABOLIC | INVERTED-PARABOLIC </tblk></p>
<ul>
<li>LINEAR: the default option introduced above. The depth averaged FLC value is linearly increased from the bottom of the bridge deck to the inflection point. After the inflection point it gradually reduces.</li>
<li>LINEAR-CONSTANT: the depth averaged FLC is linearly increased from the bottom of the bridge deck to the top of the bridge deck. Between the top of the bridge deck and the inflection point, the FLC is kept constant. After the inflection point it gradually reduces.</li>
<li>PARABOLIC: the depth averaged FLC is increased using a parabolic function from the bottom of the bridge deck to the inflection point. After the inflection point it gradually reduces.</li>
<li>INVERTED-PARABOLIC: the depth averaged FLC is increased using an inverted parabolic function from the bottom of the bridge deck to the inflection point. After the inflection point it gradually reduces.</li>
</ul>
<p>This approach can be changed for individual BG structure using the Options attribute (see Table <a href="#tab:tab-BridgeShapeAttributeDescriptions">65</a>). The vertical profiles of the depth averaged FLC values applied by the four methods are illustrated in the figure below:</p>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-BGFLCApproach"></span>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f2bc99ca743893138cff" style="width:80%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-f2bc99ca743893138cff">{"x":{"visdat":{"f69445944058":["function () ","plotlyVisDat"]},"cur_data":"f69445944058","attrs":{"f69445944058":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"LINEAR","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.12500000000000003,0.15000000000000005,0.17499999999999996,0.19999999999999998,0.22500000000000001,0.25,0.27500000000000002,0.29999999999999993,0.32499999999999996,0.34999999999999998,0.375,0.40000000000000002,0.42499999999999993,0.44999999999999996,0.47500000000000009,0.50000000000000011,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":"%{y:.2f}<extra><\/extra>","line":{"color":"rgb(26,189,201)"},"type":"scatter","mode":"lines","inherit":true},"f69445944058.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"LINEAR-CONSTANT","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.14000000000000004,0.18000000000000008,0.21999999999999995,0.26000000000000001,0.30000000000000004,0.34000000000000008,0.38000000000000012,0.41999999999999993,0.45999999999999996,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":"%{y:.2f}<extra><\/extra>","line":{"color":"rgb(0,85,129)"},"type":"scatter","mode":"lines","inherit":true},"f69445944058.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"PARABOLIC","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.1484375,0.19375000000000009,0.23593749999999991,0.27500000000000002,0.31093749999999998,0.34375,0.37343750000000009,0.40000000000000002,0.42343750000000002,0.44374999999999998,0.4609375,0.47499999999999998,0.48593750000000002,0.49375000000000002,0.49843749999999998,0.5,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":"%{y:.2f}<extra><\/extra>","line":{"color":"rgb(79,86,80)"},"type":"scatter","mode":"lines","inherit":true},"f69445944058.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"INVERTED-PARABOLIC","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.10156250000000001,0.10625000000000001,0.11406249999999998,0.125,0.13906250000000001,0.15625000000000003,0.17656250000000007,0.19999999999999996,0.22656249999999997,0.25624999999999998,0.2890625,0.32500000000000007,0.36406249999999996,0.40624999999999989,0.45156249999999998,0.5,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":"%{y:.2f}<extra><\/extra>","line":{"color":"rgb(226,1,119)"},"type":"scatter","mode":"lines","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Depth Averaged FLC","range":[0,0.59999999999999998]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Depth","range":[0,5]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":true,"displaylogo":false},"data":[{"name":"LINEAR","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.12500000000000003,0.15000000000000005,0.17499999999999996,0.19999999999999998,0.22500000000000001,0.25,0.27500000000000002,0.29999999999999993,0.32499999999999996,0.34999999999999998,0.375,0.40000000000000002,0.42499999999999993,0.44999999999999996,0.47500000000000009,0.50000000000000011,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":["%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>"],"line":{"color":"rgb(26,189,201)"},"type":"scatter","mode":"lines","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"name":"LINEAR-CONSTANT","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.14000000000000004,0.18000000000000008,0.21999999999999995,0.26000000000000001,0.30000000000000004,0.34000000000000008,0.38000000000000012,0.41999999999999993,0.45999999999999996,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":["%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>"],"line":{"color":"rgb(0,85,129)"},"type":"scatter","mode":"lines","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"name":"PARABOLIC","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.1484375,0.19375000000000009,0.23593749999999991,0.27500000000000002,0.31093749999999998,0.34375,0.37343750000000009,0.40000000000000002,0.42343750000000002,0.44374999999999998,0.4609375,0.47499999999999998,0.48593750000000002,0.49375000000000002,0.49843749999999998,0.5,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":["%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>"],"line":{"color":"rgb(79,86,80)"},"type":"scatter","mode":"lines","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"name":"INVERTED-PARABOLIC","y":[0,2,2.1000000000000001,2.2000000000000002,2.2999999999999998,2.3999999999999999,2.5,2.6000000000000001,2.7000000000000002,2.7999999999999998,2.8999999999999999,3,3.1000000000000001,3.2000000000000002,3.2999999999999998,3.3999999999999999,3.5,3.6000000000000001,3.7999999999999998,4,4.2000000000000002,4.4000000000000004,4.5999999999999996,4.7999999999999998,5,5.2000000000000002,5.4000000000000004,5.5999999999999996,5.7999999999999998],"x":[0.10000000000000001,0.10000000000000001,0.10156250000000001,0.10625000000000001,0.11406249999999998,0.125,0.13906250000000001,0.15625000000000003,0.17656250000000007,0.19999999999999996,0.22656249999999997,0.25624999999999998,0.2890625,0.32500000000000007,0.36406249999999996,0.40624999999999989,0.45156249999999998,0.5,0.47368421052631593,0.45000000000000012,0.42857142857142866,0.40909090909090917,0.39130434782608708,0.37500000000000011,0.3600000000000001,0.34615384615384626,0.33333333333333343,0.32142857142857156,0.31034482758620702],"hovertemplate":["%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>"],"line":{"color":"rgb(226,1,119)"},"type":"scatter","mode":"lines","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 61: Depth Averaged FLC Applied Using Four Adjustment Approaches
</p>
</div>
</center>
<p>Other key features of the BG layer that are different from the Layered
Flow Constriction are:</p>
<ul>
<li>The BG layer does not apply geometry updates. This not only offers
simplicity, but also is a desirable option considering that the size
of TIN polygons used to modify the bridge bed elevations are often
different from the size of polygon used to select BG cell faces.<br />
</li>
<li>For a line layer a “Deck_Width” value of zero sets the layer as a thin
line. It selects one row of faces in the direction of flow, and the
FLC value is applied to the faces unchanged. A “Deck_Width” value
larger than zero sets the layer as a thick line that selects a whole
cell, i.e. two faces in the direction of flow. The FLC values at the
faces are divided by two. The wide line feature is not supported by
the BG layer. BG polygon shapes are recommended if more than 3 rows of
faces must be selected.<br />
</li>
<li>For a polygon layer, the “Deck_Width” defines the bridge width in the
predominant direction of flow. This value is used to distribute the
total FLC value to the selected faces, i.e.:<br />
<span class="math display">\[\zeta_{face} = \zeta_{total} \times Deck\_Width \times Cell Size  \]</span>
This means users no longer need to convert the FLC value to “form loss
per metre”, which is required by the Layered Flow Constrictions
polygons.</li>
</ul>
<p>The overall blockage of the face is calculated using the same method as
the Layered Flow Constriction:</p>
<p><span class="math display">\[\phi_{total} = \frac{{(y}_{pier}\phi_{pier} + y_{deck}\phi_{deck} + y_{rail}\phi_{rail})}{y_{total}}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\phi_{n}\)</span> = layer n blockage.<br />
</li>
<li><span class="math inline">\(y_{n}\)</span> = layer n water depth (set to zero if dry and cannot exceed
depth of layer).<br />
</li>
<li><span class="math inline">\(\phi_{total}\)</span> = overall cell face blockage applied.</li>
</ul>
<p>The FLC value applies an energy loss across 2D cell faces as:</p>
<p><span class="math display">\[\mathrm{\Delta}h = \zeta_{total}\frac{V^{2}}{2g}\]</span></p>
<p>where <span class="math inline">\(V\)</span> is the 2D cell face velocity in the presence of the blockage.
When setting the blockage values, considerations need to be taken into
account whether the source of the FLC value is based on the approach
velocity (the velocity in the absence of piers blockage) or structure
velocity (the velocity with area blocked out by the piers). For example, Hydraulics of Bridge Waterways <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or Guide to Bridge Technology <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span> derives FLC value based on the
cross-sectional averaged velocity in the absence of piers, and thus it
is recommended to set the Layer 1 blockage value as zero
(0). For more information, please see the <a href="https://wiki.tuflow.com/TUFLOW_2D_Hydraulic_Structures">2D Hydraulic Structures</a> TUFLOW Wiki page.</p>
<!-- PAR to EFC: is this sentence necessary, i thought we had a sentence in the 2d_lfcsh layer about using a blockage of zero in layer 1 as that the velocity used in bradley 1978 doen not accoutn for the blockage of the peirs, did you delete this?-->
<!--resolved-->
<table>
<caption>
<span id="tab:tab-BridgeShapeAttributeDescriptions">Table 65: </span><strong>2D Bridge Shape (2d_bg) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
Unique identifier up to 32 characters in length. It may contain any character except for quotes and commas, and cannot be blank. As a general rule, spaces and special characters (e.g. “\”) should be avoided, although they are accepted. The same ID can be used for a channel and a node, but no two nodes and no two channels can have the same ID.
</td>
<td style="text-align:left;">
Char(32)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Options
</td>
<td style="text-align:left;">
This attribute can be used to overwrite the global setting specified with the .tcf command <a href="#tcfBGFLCDefaultApproach">BG FLC Default Approach</a> to change FLC calulation method individually.
</td>
<td style="text-align:left;">
Char(32)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Pier_pBlockage
</td>
<td style="text-align:left;">
<p>The percentage blockage of the pier Layer. For example, enter ‘5’ for a blockage of 5%.</p>
Note: there is no need to apply a blockage value if the FLC is estimated based on the approach velocity (the velocity in the absence of piers). For more discussion, please see the <a href="https://wiki.tuflow.com/index.php?title=TUFLOW_2D_Hydraulic_Structures">TUFLOW Wiki</a> page on the 2D Hydraulic Structures.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Pier_FLC
</td>
<td style="text-align:left;">
Pier layer form loss coefficient.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Deck_Soffit
</td>
<td style="text-align:left;">
The elevation of the bridge soffit (m or ft).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Deck_Depth
</td>
<td style="text-align:left;">
The thickness of the bridge deck (m or ft).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Deck_Width
</td>
<td style="text-align:left;">
<p><b>Line:</b></p>
<p>If equal to zero, sets the layer as a thin line and selects one row of faces in the direction of flow. The FLC value is applied to the faces unchanged. If larger than zero, sets the layer as a thick line that selects a whole cell, i.e. two faces in the direction of flow. The FLC values at the faces are divided by two.</p>
<p><b>Polygon:</b></p>
Defines the bridge width in the predominant direction of flow (m or ft). This value is used to distribute the total FLC value to the selected faces.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
Deck_pBlockage
</td>
<td style="text-align:left;">
The percentage blockage of the deck layer. Enter ‘100’ for a solid bridge deck obstruction.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Rail_Depth
</td>
<td style="text-align:left;">
The depth of the rail layer (m or ft).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Rail_pBlockage
</td>
<td style="text-align:left;">
The percentage blockage of the rail layer.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
SuperS_FLC
</td>
<td style="text-align:left;">
The combined form loss coefficient for the deck and the rail layers. Two layers are treated as a single “super structure” layer in this new bridge method.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
SuperS_Ipf
</td>
<td style="text-align:left;">
A factor to set the elevation of the inflection point (IP) at which the transition from pressure flow to drowned flow commences. The default value is 1.6.
</td>
<td style="text-align:left;">
Char(64)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
Cf
</td>
<td style="text-align:left;">
A calibration factor used to adjust the automatically generated FLC (default = 1.0).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-BridgePointAttributeDescriptions">Table 66: </span><strong>2D Bridge Shape Points (2d_bg_pts) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Deck_Soffit
</td>
<td style="text-align:left;">
The elevation of the bridge soffit (m or ft).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Deck_Depth
</td>
<td style="text-align:left;">
The thickness of the bridge deck (m or ft).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Rail_Depth
</td>
<td style="text-align:left;">
The depth of the rail layer (m or ft).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h5 class="hasAnchor" id="bg-autoFLC-4"><span class="header-section-number">7.3.8.2.1</span> Automatic Generation of Superstructure FLC<a href="#bg-autoFLC-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The 2023-03-AD build implemented a feature to automatically generate the superstructure FLC value based on the CFD benchmarking study <span class="citation">(<a href="#ref-BridgeDeckAfflux">Collecutt et al., 2022</a>)</span> if the SuperS_FLC attribute is left blank.</p>
<p><tcmd><a href="#tcfBlankBGFLCApproach">Blank BG FLC Approach</a></tcmd><teq> == </teq><tblk>{NONE} | METHOD A | METHOD B </tblk></p>
<ul>
<li>NONE: The default approach, i.e. the superstructure FLC must be specified manually.<br />
</li>
<li>METHOD A: The blank superstructure FLC values will be calculated based on the ratio of the depth of the pier layer (<span class="math inline">\(D_{Pier}\)</span> in the equations above) and the thickness of the super structure layer:<br />
<span class="math display">\[T_{SuperS}  = D_{Deck}{Blockage}_{Deck} + D_{Rail}{Blockage}_{Rail}\]</span><br />
</li>
<li>METHOD B: The blank superstructure FLC values will be calculated based on the ratio of the depth of the pier layer (<span class="math inline">\(D_{Pier}\)</span>) and the thickness of the deck layer:<br />
<span class="math display">\[T_{SuperS} = D_{Deck}{Blockage}_{Deck}\]</span></li>
</ul>
<p>With Method A and B, the superstructure FLC value is linearly interpolated within the <span class="math inline">\(D_{Pier}\)</span>/<span class="math inline">\(T_{SuperS}\)</span> range of 1~10 and capped at 0.6 and 0.16 outside this range, as shown in the Figure <a href="#fig:fig-CFDBridgeFLC">62</a>.</p>
<p>A calibration factor specified by the 2d_bg ‘Cf’ attribute is applied as a multiplier to the automatically generated superstructure FLC (Cf = 1 if not specified).</p>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-CFDBridgeFLC"></span>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9c43321dc691c84f1c0b" style="width:50%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-9c43321dc691c84f1c0b">{"x":{"visdat":{"f6945a606371":["function () ","plotlyVisDat"]},"cur_data":"f6945a606371","attrs":{"f6945a606371":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"name":"Category 1","y":[0.59999999999999998,0.59999999999999998,0.41999999999999998,0.28000000000000003,0.20000000000000001,0.16,0.16],"x":[-10,1,2,4,6,10,20],"hovertemplate":"%{y:.2f}<extra><\/extra>","line":{"color":"rgb(26,189,201)"},"point":{"color":"rgb(26,189,201)"},"type":"scatter","markers":"true","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"D<sub>Pier<\/sub>/T<sub>SuperS<\/sub>","range":[0,12]},"yaxis":{"domain":[0,1],"automargin":true,"title":"FLC","range":[0,0.69999999999999996]},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":true,"displaylogo":false},"data":[{"name":"Category 1","y":[0.59999999999999998,0.59999999999999998,0.41999999999999998,0.28000000000000003,0.20000000000000001,0.16,0.16],"x":[-10,1,2,4,6,10,20],"hovertemplate":["%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>","%{y:.2f}<extra><\/extra>"],"line":{"color":"rgb(26,189,201)"},"point":{"color":"rgb(26,189,201)"},"type":"scatter","markers":"true","mode":"markers+lines","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 62: <strong>CFD benchmarking study of FLC vs <span class="math inline">\(D_{Pier}\)</span>/<span class="math inline">\(T_{SuperS}\)</span> ratio (<span class="math inline">\(h_{B}\)</span>/<span class="math inline">\(T\)</span> in the original paper)</strong>
</p>
</div>
</center>
<h4 class="hasAnchor" id="lfcsh-4"><span class="header-section-number">7.3.8.3</span> Layered Flow Constrictions (2d_lfcsh Layers)<a href="#lfcsh-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- PAR: have reworded as previously we said it is similar to FCs, but these had not been introduced yet-->
<p>Layered flow constrictions allow losses and blockages to be varied with water
depth. This provides the opportunity to model the flow under and over a
bridge deck, or a pipeline crossing a waterway.</p>
<p><strong>Note: The 2023-03-AA release introduced the 2d_bg layer, see <a href="#bg-layer-4">2D Bridge Structures</a>. It is recommended that it be used for representation of bridges. Prior to this, bridges were commonly modelled using a 2d_lfcsh.</strong></p>
<p>Four vertical layers within a layered flow constriction (not GIS layers) are represented. The lower three layers each have their own attributes. Each layer is
assigned its own percentage blockage and form loss coefficient. The top
(fourth) layer assumes the flow in Layer 4 is unimpeded. Within the same
shape, the invert of the bed, and thickness of each layer can vary in
3D.</p>
<p>For example, the layers of a bridge structure could be defined as
follows.</p>
<ul>
<li><strong>Layer 1:</strong> Beneath the bridge deck. Might be 5% blocked due to the
bridge piers and have a small form loss for the energy losses
associated with the piers.<br />
</li>
<li><strong>Layer 2:</strong> The bridge deck. This would be 100% blocked and the form
loss coefficient would increase due to the additional energy losses
associated with flow surcharging the deck.<br />
</li>
<li><strong>Layer 3:</strong> The bridge rails. These might be anything from 100%
blocked (solid concrete rails) to 10% blocked (very open rails). Some
form losses would be specified depending on the type of rails.<br />
</li>
<li><strong>Layer 4:</strong> Flow over the top of the rails - flow is assumed to be
unimpeded.</li>
</ul>
<p>Layered flow constrictions function by adjusting the flow width of the 2D cell so as to
represent the combination of blockages of the four layers. When the flow
is only within Layer 1, only the attributes of Layer 1 are applied. As
the water level rises into Layer 2, the influence of the Layer 2
attributes increase as the water continues to rise. Similarly, for Layer
3 and Layer 4.</p>
<p>The cell side flow width is calculated by summing the flow areas of each
layer (including the effects of layer blockages) and dividing by the
water depth.</p>
<p>As of the 2020-10 release three options are available to specify the
method in which form losses are applied:</p>
<ul>
<li><strong>METHOD A</strong> (CUMULATE in releases prior to 2020-10): Accumulates losses through each of the layers in the 2d_lfcsh as the depth of water increases.<br />
</li>
<li><strong>METHOD B</strong> (PORTION in releases prior to 2020-10) – the default: Proportions the losses through each of the layers in the 2d_lfcsh based on the depth of water. - <strong>METHOD C</strong>: Combines the METHOD A and METHOD B approaches by utilising METHOD A through to the top of Layer 3 and METHOD B above Layer 3.<br />
<!-- - **METHOD D**: Allows the modeller to control the depth at which the losses start to reduce when the flow transitions between pressure flow and drowned flow. From the 2023-03-AA release and onwards it is recommended to use the 2d_bg layer, see Section \@ref(bg-layer-4).--></li>
</ul>
<p>The following .tcf command can be used to set the default method to be applied to all structures in the model:</p>
<p><tcmd><a href="#tcfLayeredFLCDefaultApproach">Layered FLC Default Approach</a></tcmd><teq> == </teq><tblk>[ METHOD A | {METHOD B} | METHOD C ]</tblk></p>
<p>To specify the method on a structure by structure basis, populate the Shape_Options attribute (refer to Table <a href="#tab:tab-LayeredFlow">67</a>) with
either “Method A”, “Method B” (the default) or “Method C”.</p>
<p>Whilst the default approach of using METHOD B is unchanged for backward compatibility purposes, it is recommended the new approaches of METHOD C or the TUFLOW HPC’s 2d_bg layer approach be considered as they are shown to emulate behaviour from CFD modelling more closely for pressurised flow conditions <span class="citation">(<a href="#ref-BridgeDeckAfflux">Collecutt et al., 2022</a>)</span>.</p>
<p>Detailed explanation outlining how the losses are applied is provided in the following sections.</p>
<p><strong>METHOD A</strong></p>
<p>If the form loss method has been set to METHOD A (CUMULATE), the losses
are accumulated as the water level rises through the layers according to
the following equation. This approach was replaced as the default
setting for the 2016-03 release due to it producing inconsistent results
where the bridge is substantially overtopped (drowned out) with a large
percentage of the flow occurring through Layer 4, and the overall energy
loss reducing with increasing water depth once the structure is
submerged.</p>
<p><span class="math display">\[\zeta_{total} = \zeta_{1} + \zeta_{2}\frac{y_{2}}{D_{2}} + \zeta_{3}\frac{y_{3}}{D_{3}}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\zeta_{n}\)</span> = layer n FLC<br />
</li>
<li><span class="math inline">\(D_{n}\)</span> = depth of layer n<br />
</li>
<li><span class="math inline">\(y_{n}\)</span> = layer n water depth (set to zero if dry and cannot exceed depth of layer)<br />
</li>
<li><span class="math inline">\(\zeta_{total}\)</span> = overall form loss coefficient applied</li>
</ul>
<p><strong>METHOD B</strong></p>
<p>If the form loss method has been set to METHOD B (PORTION), the losses
are applied pro-rata according to the depth of water in each layer using
the equation below. Note that Layer 4 (e.g. above the bridge deck rails)
is always assumed to contribute a zero FLC. If a layer is not flooded
the depth for that layer, <em>y<sub>n</sub></em>, is set to zero.</p>
<p><span class="math display">\[\zeta_{total} = \frac{{(y}_{1}\zeta_{1} + y_{2}\zeta_{2} + y_{3}\zeta_{3})}{y_{total}}\]</span></p>
<p><span class="math display">\[y_{total} = y_{1} + y_{2} + y_{3} + y_{4}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\zeta_{n}\)</span> = layer n FLC<br />
</li>
<li><span class="math inline">\(y_{n}\)</span> = layer n water depth (set to zero if dry and cannot exceed depth of layer)<br />
</li>
<li><span class="math inline">\(\zeta_{total}\)</span> = overall form loss coefficient applied</li>
</ul>
<p><strong>METHOD C</strong></p>
<p>METHOD C effectively combines the METHOD A (CUMULATE) and METHOD B
(PORTION) approaches by utilising METHOD A through to the top of Layer 3
and METHOD B above Layer 3. METHOD C adjusts the FLC value in the
vertical as follows.</p>
<ul>
<li>Water level below Layer 2: The same result as for all other
approaches (i.e. a form loss based on that specified for Layer 1 is
applied). This is typically used for the energy losses associated with
bridge piers.<br />
</li>
<li>Water level below top of Layer 3: Same approach as for METHOD A.<br />
</li>
<li>Water level above Layer 3: Gradually reduces the energy loss with
increasing depth by proportioning with depth. The energy loss is
calculated as that accumulated from Layers 1 to 3 pro-rated by the
depth of Layers 1 to 3, plus no losses pro-rated by the depth above
the Layer 3.<br />
<span class="math display">\[\zeta_{total} = \left( \zeta_{1} + \zeta_{2}\frac{y_{2}}{D_{2}} + \zeta_{3}\frac{y_{3}}{D_{3}} \right)\frac{{(y}_{1} + y_{2} + y_{3})}{y_{total}}\]</span><br />
<span class="math display">\[y_{total} = y_{1} + y_{2} + y_{3} + y_{4}\]</span><br />
Where:
<ul>
<li><span class="math inline">\(\zeta_{n}\)</span> = layer n FLC<br />
</li>
<li><span class="math inline">\(y_{n}\)</span> = layer n water depth (set to zero if dry and cannot exceed depth of layer)<br />
</li>
<li><span class="math inline">\(\zeta_{total}\)</span> = overall form loss coefficient applied<br />
</li>
<li><span class="math inline">\(D_{n}\)</span> = layer n thickness</li>
</ul></li>
</ul>
<!-- PAR to EFC, given this is the case should we remove this and steer people to 2d_bg?-->
<!--
METHOD D is similar to METHOD C but allows the modeller to control the
depth at which the losses start to reduce when the flow transitions
between pressure flow and drowned flow. METHOD D was a beta feature in
the 2020-10 Release, see the [2020-10 Release
Notes](https://downloads.tuflow.com/TUFLOW/Releases/2020-10/TUFLOW%20Release%20Notes.2020-10-AD.pdf)
for more information. As of the 2023-03 release it is replaced by the 2d_bg layer, which has GIS
attributes altered for clarity.  

The overall blockage of the face is calculated using the same method
regardless of the FLC approach:

$$\phi_{total} = \frac{{(y}_{1}\phi_{1} + y_{2}\phi_{2} + y_{3}\phi_{3})}{y_{total}}$$

Where:

$\phi_{n}$ = layer n blockage  
$y_{n}$ = layer n water depth (set to zero if dry and cannot exceed
depth of layer)  
$\phi_{total}$ = overall cell face blockage applied-->
<p>Regardless of the FLC approach, the FLC value applies an energy loss across 2D cell faces as:</p>
<p><span class="math display">\[\mathrm{\Delta}h = \zeta_{total}\frac{V^{2}}{2g}\]</span></p>
<p>where <em>V</em> is the 2D cell face velocity in the presence of the blockage.
When setting the blockage values, considerations need to be taken into
account whether the source of the FLC value is based on the approach
velocity (the velocity in the absence of piers blockage) or structure
velocity (the velocity with area blocked out by the piers). For example, Hydraulics of Bridge Waterways <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or Guide to Bridge Technology <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span> derives FLC values based on the
cross-sectional averaged velocity in the absence of piers, and thus it
is recommended to set the Layer 1 blockage value as zero
(0). For more information, please see the <a href="https://wiki.tuflow.com/TUFLOW_2D_Hydraulic_Structures">2D Hydraulic Structures</a> TUFLOW Wiki page.</p>
<!--The L2_FLC attribute value refers to the energy loss caused by pressure
flow against the Layer 2 and 3 combined (i.e. the bridge deck and
rails), and the L3_FLC attribute value is used to set the inflection
point (IP) at which the transition from pressure flow to drowned flow
commences. (These attributes have now been labelled as L2_or_L23_FLC and
L3_FLC_or_fIP if empty files are created.) L3_FLC is specified as a
factor of the combined depths of Layers 2 and 3, with observations thus
far indicating this inflection point is around 1.5 to 2 times the depth
of the bridge deck (assuming no rails). The effect of partial blockage
(e.g. 20% blockage of Layer 3 representing the bridge deck rails) is to
reduce the inflection point proportionally by the blockage amount.

METHOD D adjusts the FLC value in the vertical as follows:

- Water level below Layer 2: The same result as for all other
  approaches, i.e. a form loss based on that specified for Layer 1 is
  applied. This is typically used for the energy losses associated with
  bridge piers.  
- Water level between invert of Layer 2 and below the Inflection Depth
  measured from the invert of Layer 2. The Inflection Depth and total
  energy loss are calculated as follows:

  $$D_{IP} = f_{IP}\left( D_{2}{Blockage}_{2} + D_{3}{Blockage}_{3} \right)$$

  $$\zeta_{total} = \left( \zeta_{1} + \zeta_{2}\frac{y_{I}}{D_{IP}} \right)\frac{(y_{1} + y_{Inflection})}{y_{total}}$$

Where:

- $D_{IP}$ = Inflection Depth discussed above.  
- $f_{IP}$ = Factor entered into the L3_FLC attribute to set the inflection point. 
- $D_{n}$ = layer n thickness  
- ${Blockage}_{n}$ = <span class="mark">???</span>  
- $\zeta_{total}$ = overall form loss coefficient applied  
- $\zeta_{n}$ = layer n FLC  
- $y_{n}$ = layer n water depth (set to zero if dry and cannot exceed depth of layer)  
- $y_{Inflection}$ = water depth above the invert of Layer 2 up to (but not exceeding) the Inflection Depth ($D_{IP}$)  
- $y_{total}$ = <span class="mark">???</span>

Above the Inflection Point the energy gradually reduces with
increasing depth in a similar manner to METHOD B and METHOD C to
simulate the transition to drowned flow and tendency to zero energy
losses with increasing depth over the bridge deck.

As of the 2023-03 release the 2d_bg (see   <u>Section 6.11.4</u>) is recommended to be used to model bridge
structures. This method is similar to METHOD D, with the GIS layer
attributes adjusted for easier user input.
-->
<p>Layered FC shapes are defined as either a line or polygon GIS objects
using the .tgc command <a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC
Shape</a>. The file attribute description is
provided in Table <a href="#tab:tab-LayeredFlow">67</a>.</p>
<p>Points can be used to vary the invert of the bed, and thickness of each
layer in 3D. In this case, four attributes are required as outlined in Table <a href="#tab:tab-ShapePoint">68</a>.
This can for example be used to model an arched bridge or sloping deck.
The point objects can be placed in a separate layer to the line or
polygon GIS features.</p>
<p>Please note, overlapping flow constriction inputs is not supported.</p>
<table>
<caption>
<span id="tab:tab-LayeredFlow">Table 67: </span>Layered Flow Constriction Shape (2d_lfcsh) Attribute Descriptions
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Invert
</td>
<td style="text-align:left;">
<p>Performs same function as described for the Z attribute in Table <a href="#tab:tab-ZShapeAttribute">54</a> and is applied to the Invert elevation values. To leave the Zpt levels unchanged (i.e. use the existing Zpt elevations), enter a value of 99999.</p>
<p><b>Point or <b>Line:</b></b><br />
Invert of constriction (m above datum).</p>
<b>Polygon:</b> Used to set the elevation of the polygon perimeter only if NO MERGE option is specified and there are no points snapped to the perimeter. Otherwise ignored and the Zpt elevations within the polygon will be adjusted by triangulated around the perimeter at every half-cell size.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
dZ
</td>
<td style="text-align:left;">
Performs same function as described for dZ in Table <a href="#tab:tab-ZShapeAttribute">54</a> and is applied to the Invert elevation values.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Shape_Width_or_dMax
</td>
<td style="text-align:left;">
Same as for the same attribute in Table <a href="#tab:tab-ZShapeAttribute">54</a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Shape_Options
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line or Polygon:</b></p>
<p>ADD: Add the shape’s ‘Z’ attribute value to the current Zpts. If ADD is specified, any automatic merging around the region perimeter is ignored.</p>
<p>MAX, RIDGE or RAISE: Only changes a Zpt (Invert) elevation if the Z Shape elevation at the Zpt is higher.</p>
<p>MIN, GULLY or LOWER: Only changes a Zpt (Invert) elevation if the Z Shape elevation at the Zpt is lower.</p>
<p>METHOD A (CUMULATE in releases prior to 2020-10): Accumulates losses through each of the layers in the 2d_lfcsh as the depth of water increases. This will overwrite the global setting specified with the .tcf command Layered FLC Default Approach.</p>
<p>METHOD B (PORTION in releases prior to 2020-10): Proportions the losses through each of the layers in the 2d_lfcsh based on the depth of water. This will overwrite the global setting specified with the .tcf command Layered FLC Default Approach.</p>
<p>METHOD C: Combines the METHOD A and METHOD B approaches by utilising METHOD A through to the top of Layer 3 and METHOD B above Layer 3. This will overwrite the global setting specified with the .tcf command Layered FLC Default Approach.</p>
<p><b>Line:</b></p>
<p>NO MERGE: For thin lines (Shape_Width_or_dMax = 0), the final elevations along the line are as specified. If NO MERGE is not specified for a thin line, the final elevations are set to be the same as the current Zpt values plus the dZ value.</p>
<p>TIN: Indicates the line is to only be used for generation of TINs within polygons (only sections of TIN lines that fall within polygons are used).</p>
<p><b>Polygon:</b> If none of the options below are specified, the Invert elevations at perimeter vertices that do not have an elevation point snapped to them are merged with the current Zpt values (provided Invert does not equal 99999).</p>
<p>MERGE ALL: Ignores invert elevations from any points snapped to the perimeter and merges all perimeter vertices with the current Zpt values.</p>
NO MERGE: Does not merge the perimeter elevations with the current Zpt values.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
L1_Obvert
</td>
<td style="text-align:left;">
The obvert (soffit) of Layer 1.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
L1_pBlockage
</td>
<td style="text-align:left;">
The percentage blockage of Layer 1. For example, enter 5 for a blockage of 5%.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
L1_FLC
</td>
<td style="text-align:left;">
<p>Layer 1 form loss coefficient. Used for modelling fine-scale “micro” contraction/expansion losses not picked up by the change in the 2D domain’s velocity patterns (e.g. bridge pier losses, vena-contracta losses, 3<sup>rd</sup> (vertical) dimension etc.).</p>
<p>This parameter should be used as a calibration parameter.</p>
<p><b>Note: So that this attribute is independent of 2D cell size it has different treatment depending on the object it is attached to as follows:</b></p>
<ul>
<li><b><b>Line:</b></b> For thin lines, the FLC value is applied to the cell sides unchanged. For thick (whole cell) lines, the FLC value is divided by two (two cell sides in the direction of flow). For wide lines the FLC value is divided by the number of cells across the line (i.e. the line’s width divided by the cell size) and applied to all cell-sides.</li>
<li><b>Polygon:</b> FLC is the form loss per unit length (in the predominant direction of flow). FLC values are not dependent on the flow width, but are on the length of travel in the direction of flow. The unit of length is metres, or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>.</li>
</ul>
<p><b>However, if a negative FLC value is specified, the absolute value is taken and applied unadjusted to all cell-sides affected by the shape.<br />
Note, this is not cell size independent, therefore if the 2D cell size is changed, this attribute also needs to be changed.</b></p>
<p>The form loss coefficient is applied as an energy loss based on the dynamic head equation below where <span class="math inline">\(\displaystyle \zeta_{a}\)</span> is the FLC vlaue.</p>
<span class="math display">\[\Delta h = \zeta_{a}\:\frac{V^2}{2g}\]</span>
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
L2_Depth
</td>
<td style="text-align:left;">
The depth of Layer 2. Depth units are in metres, or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
L2_pBlockage
</td>
<td style="text-align:left;">
The percentage blockage of Layer 2. For example, enter 100 for a solid obstruction such as a bridge deck or pipe.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
L2_FLC
</td>
<td style="text-align:left;">
Layer 2 form loss coefficient. See notes for L1_FLC
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
L3_Depth
</td>
<td style="text-align:left;">
The depth of Layer 3. Depth units are in metres, or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
L3_pBlockage
</td>
<td style="text-align:left;">
The percentage blockage of Layer 3.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
L3_FLC
</td>
<td style="text-align:left;">
Layer 3 form loss coefficient. See notes for L1_FLC
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
Notes
</td>
<td style="text-align:left;">
Optional field for entering comments. Not used.
</td>
<td style="text-align:left;">
Char(40)
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-ShapePoint">Table 68: </span>Layered Flow Constriction Shape Point (2d_lfcsh…_pts) Attribute Descriptions
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Invert
</td>
<td style="text-align:left;">
<p>Invert of constriction (metres above datum, or feet above datum if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).</p>
To leave the Zpt levels unchanged (i.e. use the existing Zpt elevations), enter a value of 99999.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
L1_Obvert
</td>
<td style="text-align:left;">
The obvert (soffit) of Layer 1.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
L2_Depth
</td>
<td style="text-align:left;">
The depth of Layer 2. Depth units are in metres, or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
L3_Depth
</td>
<td style="text-align:left;">
The depth of Layer 3. Depth units are in metres, or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="cell-mods-3"><span class="header-section-number">7.3.9</span> Cell Modification<a href="#cell-mods-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- EFC to PAR: I think we should be move this after hydraulic structures. Or even just before modelling urban areas-->
<!--done-->
<h4 class="hasAnchor" id="srf-3"><span class="header-section-number">7.3.9.1</span> Storage Reduction (2d_srf)<a href="#srf-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The storage of 2D cells may be reduced (e.g. to model hypothetical filling, or reduced storage from buildings), or increased (e.g. for stability). For example, if a cell has a Storage Reduction Factor (SRF) value of
0.1, then its storage (surface area) is reduced by 10%. If the SRF value
is less than zero, the storage is increased. The default SRF value is
zero (i.e. no change in storage).</p>
<p>SRF values are assigned to cells in one or both of the following ways:</p>
<ol style="list-style-type: decimal">
<li>Using the <a href="#tgcSetSRF">Set SRF</a> and <a href="#tgcReadGISSRF">Read GIS SRF</a> .tgc commands. The 2d_srf layer has only one attribute, a float or real value nominally called SRF.<br />
</li>
<li>Assigned to materials .csv/.tmf files as the 5<sup>th</sup> and
10<sup>th</sup> column values respectively (refer to Table <a href="#tab:tab-MaterialsFormat">59</a> and Table <a href="#tab:tab-MaterialsFile">60</a>).<br />
</li>
<li>Using the .tgc command <a href="#tgcReadGridSRF">Read Grid SRF</a> to assign SRF
values from a raster input grid.</li>
<li>Via SX connections to 1D. The default approach increases the storage in the 2D cells by the average associated 1D node storage. Refer to Section <a href="#SXBoundary-3"><strong>??</strong></a> and .tcf command <a href="#tcfSXStorageApproach">SX Storage Approach</a>.<br />
The applied SRF value is reported in the SRF attribute of the
<a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> layer.</li>
</ol>
<p><strong>Note that a user can apply a combination of material SRF values and
<a href="#tgcReadGISSRF">Read GIS SRF</a> layers. The item that is used by the simulation depends on the order of commands in the .tgc file. The last read input takes precedence. For example, if a cell’s storage is adjusted by layers read in using both the <a href="#tgcReadGISSRF">Read GIS SRF</a> and <a href="#tgcReadGISMat">Read GIS Mat</a> commands, though<a href="#tgcReadGISMat">Read GIS Mat</a> is lower in the .tgc file, it will prevail.</strong></p>
<p>If a large reduction in cell storage is applied, for stability reasons it
may be necessary to also reduce the cell conveyance using a higher
roughness or cell flow width (see Section <a href="#CWF-4"><strong>??</strong></a>). For example,
if a 10m cell size model has a SRF value of 0.99, without any SRF the
cell area is 100m<sup>2</sup> (10m x 10m), with a SRF of 0.99 this would
be reduced to 1m<sup>2</sup>. If no reduction in conveyance for flow entering or
leaving the cell is made, a significant volume of flow may enter
the cell between timesteps, this would cause the water level in the cell
to jump a large amount, potentially leading to oscillations in water
levels.</p>
<h4 class="hasAnchor" id="CWF-4"><span class="header-section-number">7.3.9.2</span> Cell Width Factor (CWF)<a href="#CWF-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The .tgc commands <a href="#tgcSetCWF">Set CWF</a>, <a href="#tgcReadGISCWF">Read GIS CWF</a> and <a href="#tgcReadGridCWF">Read Grid CWF</a> can be used to adjust the 2D cell flow widths (in the same manner as for 2D flow constrictions (refer to Section <a href="#lfcsh-4"><strong>??</strong></a>). The CWF is a factor, for example 0.1 will limit the flow width to 10%. The changed flow width applies to all depths. When reading from a polygon object in GIS format, any cell sides that fall within the
polygon will have the width factor applied. These factors can be
reviewed within the
<a href="http://wiki.tuflow.com/Check_Files_2d_uvpt">uvpt_check</a>
file.</p>
<h4 class="hasAnchor" id="flc-4"><span class="header-section-number">7.3.9.3</span> Form Loss Coefficient (FLC)<a href="#flc-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Form loss coefficients can be applied in the .tgc to add an additional energy
loss at the 2D cell side (in the same manner as for 2D flow
constrictions, see Section <a href="#lfcsh-4"><strong>??</strong></a> and <a href="#bg-layer-4"><strong>??</strong></a>). Unlike flow constrictions, the FLC applied using this approach
does not vary with depth. The form or energy loss can be applied as fixed values with the .tgc commands <a href="#tgcSetFLC">Set FLC</a>, <a href="#tgcReadGISFLC">Read GIS FLC</a> and
<a href="#tgcReadGridFLC">Read Grid FLC</a> or on a form loss per unit length basis with
the .tgc commands <a href="#tgcSetFLC/L">Set FLC/L</a>, <a href="#tgcReadGISFLC/L">Read GIS FLC/L</a> and
<a href="#tgcReadGridFLC/L">Read Grid FLC/L</a>. The advantage to applying the FLC on a per
unit length basis is that it makes these inputs independent
of the 2D cell size when using regions (polygons). As such, if the 2D
cell size is changed, the same energy loss will be applied to both models
over the area of the region.</p>
<p>Any cell sides that fall within the polygon will have the additional form loss
These loss can be reviewed within the
<a href="http://wiki.tuflow.com/Check_Files_2d_uvpt">uvpt_check</a> file.</p>
<p>Section <a href="#HydraulicStructures-3"><strong>??</strong></a> provides a detailed discussion about the application of additional form losses.</p>
<h4 class="hasAnchor" id="mod-conveyance-4"><span class="header-section-number">7.3.9.4</span> Modify Conveyance<a href="#mod-conveyance-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The. tgc command <a href="#tgcReadGISZptModifyConveyance">Read GIS Zpts Modify Conveyance</a> can be used to modify the elevation of a series of cells based on an increase or decrease in conveyance. Three inputs are required for this operation. These are:</p>
<ol style="list-style-type: decimal">
<li>A GIS layer containing a region / polygon object within which the
modification will apply;<br />
</li>
<li>A conveyance multiplication factor; and<br />
</li>
<li>A water level grid.</li>
</ol>
<p>The command syntax is:</p>
<p><tcmd><a href="#tgcReadGISZptModifyConveyance">Read GIS Zpts Modify Conveyance</a></tcmd><teq> == </teq><tblk>&lt;gis layer&gt; | &lt;K_factor&gt; | &lt;Water_Level_Grid&gt;</tblk></p>
<p>The terrain levels are adjusted based on the depth of water relative to the
water surface provided. The elevations are modified by
<span class="math inline">\(depth\left( 1 - f^{\frac{3}{5}} \right)\)</span>, which is effectively a change
in conveyance of <span class="math inline">\(K\times f\)</span> where <span class="math inline">\(K\)</span> is conveyance and <span class="math inline">\(f\)</span> is the multiplication
factor. For example, f = 1.2 would be a 20% increase in conveyance
resulting in a deepening of the waterway. The specified base water level
grid is a grid surface in a supported input raster format. The grid
does not need to be in the same resolution as the 2D domains, but is
typically the _h_Max grid output by TUFLOW from a previous simulation (see Section <a href="#Grid-4"><strong>??</strong></a>).</p>
<p>This feature is useful for sensitivity testing the changes in flood
behaviour due to a deepening or accretion of a river’s bed based on a
change in conveyance.</p>
<p>This command would normally be applied in the .tgc, after all elevation (Zpt) commands as the Zpt adjustment is based
on the Zpt elevations processed up until the location of this command in
the .tgc file. An example is provided below:</p>
<p><tcmd><a href="#tgcReadGISZptModifyConveyance">Read GIS Zpts Modify Conveyance</a></tcmd><teq> == </teq><tblk>gis\2d_mod_river.shp | 0.9 | base_h_Max.tif</tblk></p>
<p>Where:</p>
<ul>
<li>2d_mod_river.shp contains polygons of the areas to be modified, in
this case along the river. This can be in any supported vector format (.gpkg, .shp or .mif).<br />
</li>
<li>0.9 is the factor change in conveyance compared to a base case (i.e.
10% decrease in conveyance).<br />
</li>
<li>base_h_Max.tif is a raster grid of the peak water level grid from a base
case simulation. It is recommended to copy this grid layer from the
results folder and place it somewhere under model\grid\. If this grid
layer varies with AEP, it is recommended to use the one .tcf with a
Variable to define the AEP, or alternatively a Scenario variable.</li>
</ul>
<h3 class="hasAnchor" id="urban-areas-3"><span class="header-section-number">7.3.10</span> Modelling Urban Areas<a href="#urban-areas-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The modelling of urbanised floodplains presents many more challenges to
hydraulic modellers than those of rural floodplains. It requires careful
consideration of the representation of buildings, walls and fences to
accurately replicate the overland flow routes. With the advancement of
modern computing hardware and software, 2D solutions are increasingly
being used over 1D solutions to represent urban areas.</p>
<p>This section of the manual discusses the various methods available in
TUFLOW to represent the features within an urban area. It does not aim
to identify the most appropriate method, however, discusses the pros and
cons to provide the modeller with guidance on selecting the most
suitable method for their study.</p>
<p><span class="citation">Syme (<a href="#ref-Syme2008">2008</a>)</span> explores modelling approaches for buildings and fences, it can be found along with other publications in the <a href="https://www.tuflow.com/library/publications/">TUFLOW Library</a>.</p>
<h4 class="hasAnchor" id="buildings-4"><span class="header-section-number">7.3.10.1</span> Buildings<a href="#buildings-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A number of methods can be used for representing buildings in a TUFLOW
2D model. These are:</p>
<ul>
<li>Utilising a higher bed resistance (roughness);<br />
</li>
<li>Raising the elevation of 2D cells where buildings exist;<br />
</li>
<li>Deactivating the 2D cells (code = 0) where buildings exist;</li>
<li>Reducing the cell storage;<br />
</li>
<li>Restricting the flow using a cell width reduction or additional form loss; or<br />
</li>
<li>Applying a breakline along the upstream faces of buildings.</li>
</ul>
<p>Utilising a high bed resistance parameter for buildings is a commonly
used method to encourage the development of preferential flow paths
around buildings during urban flooding scenarios. This method is
commonly used and preferred over others as it accounts for the storage
that the building provides once it becomes inundated <span class="citation">(<a href="#ref-Syme2008">Syme, 2008</a>)</span>. Depth
varying roughness is recommended if using this approach in combination
with direct rainfall modelling. A low roughness value is recommended at
shallow depths, representing the rapid run-off response associated with
rainfall on building roofs. High bed roughness is recommended for deeper
flows when the building structure impedes overland flow. The application
of depth varying roughness is described in Section <a href="#Materials-2"><strong>??</strong></a>.</p>
<p>Buildings may also be “removed” from the 2D domain by categorising the
buildings as “Land” cells (see Section <a href="#CellCodes-3"><strong>??</strong></a>) or raising the Zpt elevations
above the predicted flood level (see Section <a href="#zsh-4"><strong>??</strong></a>). This method may be appropriate when the
building/s have been designed to not flood. In this case, care should be
taken to ensure the chosen cell size is able to appropriately represent
the area of the building and therefore the storage ‘removed’ from the
floodplain. Representing buildings in this fashion will not take into
account any below ground storage, such as that provided by underground
car parks or basement properties. If using a direct rainfall approach
(rain on grid), this method is most likely not suitable. Any land
(inactive) cells will have no rainfall applied, meaning the flow volume
will be incorrect, artificially high cells (e.g. 10m above ground
levels) may cause stability issues as flows exit the building.</p>
<p>Flood studies often require the simulation of extreme flood events,
where a great number of buildings are expected to become inundated. It
may not be appropriate in these cases to “remove” the building entirely
from the 2D domain. A more suitable approach may be to raise the Zpt
elevations (see Section <a href="#zsh-4"><strong>??</strong></a>) of the building polygons to match the finished floor level,
thereby specifying the elevation at which the building is able to flood.
This may allow for direct rainfall simulations using a modification of
the cell elevations.</p>
<p>The use of a thin breakline around the edges of the building can be used to
prevent the building becoming a flow path, whilst not removing the
storage volume (see Section <a href="#zsh-4"><strong>??</strong></a>). For example, three sides of the building could be blocked, this will still allow water to enter the building but not flow through it.</p>
<p>Layered flow constrictions (see Section <a href="#lfcsh-4"><strong>??</strong></a>) or Cell Width Factor (see Section
<a href="#CWF-4"><strong>??</strong></a>) may be used to impede the flow of water as it passes
through the building. The sides of 2D cells may be partially blocked to
represent obstructions such as internal or external walls. Additionally,
a form loss can be applied using form loss coefficients (see Section <a href="#flc-4"><strong>??</strong></a>).</p>
<p>A storage reduction factor can also be used to reduce the area in the
cell available for water using the SRF options (see Section
<a href="#srf-3"><strong>??</strong></a>). This can be used in conjunction with the other methods,
for example, a building may have the storage reduced by 20% by applying
a SRF of 0.2, this could be combined with a Cell Width Factor of 0.8
(20% reduction in flow area through the building).</p>
<p>In the absence of guidelines in the literature it is recommend that the
approaches for modelling buildings be sensitivity tested or calibrated,
if possible.</p>
<h4 class="hasAnchor" id="roads-4"><span class="header-section-number">7.3.10.2</span> Roads<a href="#roads-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Roads typically represent the main flow routes through urban areas. The
chosen cell size of the 2D domain is a key factor in ensuring an
appropriate number of cells have been used to represent the width of the
roads, as previously discussed in Section <a href="#CellSizes-3"><strong>??</strong></a>. Choosing too coarse a resolution may result in the roads not being accurately represented and minor flow routes not being represented at all. An unnecessarily fine resolution
may translate to excessively long simulation times and stability problems if the
Courant condition is exceeded. Ideally, it is recommended that the main
flow routes be represented with a width of approximately 3-4 cells
across. Note, when using the TUFLOW HPC SGS functionality (see Section <a href="#SGS-3"><strong>??</strong></a>) identification of locations where a breakline should be used to represent a flow control crest may be important. The <a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a> tool (see Section <a href="#SGS-Advanced-5"><strong>??</strong></a>) can assist modellers in identifying where breaklines may need to be added.</p>
<p>For overland flood studies where a high proportion of sheet flow is
predicted, differentiation between the road and pavement elevations may
influence the predicted areas of inundation. A DTM based on LiDAR or ALS
data, may not necessarily pick up this detail, therefore requiring
manual modification of the topography using breaklines.</p>
<p>It is possible to apply the Log Law rule for very shallow flow through automatically varying Manning’s n. This is of particularly interest for modelling flow over smooth surfaces such as roads and concrete (see Section <a href="#log-law-4"><strong>??</strong></a>).</p>
<h4 class="hasAnchor" id="fences-4"><span class="header-section-number">7.3.10.3</span> Fences and Walls<a href="#fences-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Fences and walls can cause significant blockages during a flood event,
influencing the direction that flood waters take. Walls act to deflect
the path of flood waters and if overtopped, may act as weirs. Fences may
partially impede the flow of water and can be prone to becoming blocked
with debris. There is also the potential for both walls and fences to
collapse during a flood event.</p>
<p>Fences and walls are typically included within a TUFLOW model by
digitising a series of breaklines. The 2d_zsh GIS layer permits the
width of the breakline to be specified (see Section <a href="#zsh-4"><strong>??</strong></a>). A “thin” line
modifying only the ZU and ZV (cell side) elevations may be preferred to
represent fences, in situations where the width of the cell size is
notably greater than the width of the obstruction. A “thin” line does
not modify the ZC (cell centre) elevations hence has no impact on the
cell storage. A “thick” line on the other hand, modifies the ZU, ZV and
ZC Zpt elevations and may be more appropriate to represent wider
obstructions such as railway embankments.</p>
<p>The 2d_vzsh GIS layer (see Section <a href="#vzsh-4"><strong>??</strong></a>) may be used to
represent an embankment that collapses during the simulation. The breach
may be triggered at a specified time, by the water level at a defined
location or the water level difference between two locations exceeding a
specified amount.</p>
<h2 class="hasAnchor" id="HPC-specific-2"><span class="header-section-number">7.4</span> TUFLOW HPC Specific<a href="#HPC-specific-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section describes 2D domain functionality that is unique to TUFLOW HPC.</p>
<h3 class="hasAnchor" id="Quadtree-3"><span class="header-section-number">7.4.1</span> Quadtree<a href="#Quadtree-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Quadtree grid refinement functionality enables the user to vary the 2D cell resolution within a TUFLOW HPC model. Quadtree refinement allows for recursive division of square TUFLOW cells into four smaller square cells. Up to 9 levels of cell size refinement are permitted. All cells for all levels of refinement share a common orientation. Bill Syme, one of the TUFLOW author’s, discusses the benefits and implementation of Quadtree within the <a href="https://youtu.be/eJJtsS91XNo?t=1495">Future of 2D Hydraulic Modelling AWS Video</a>. The <a href="https://www.youtube.com/watch?v=2zrNwWUNTXE">How to Implement Quadtree</a> video also useful. An example quadtree mesh is presented in Figure <a href="#fig:fig-QTMeshIntro">63</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-QTMeshIntro"></span>
<img src="images/1D2DHPCQTMesh.png" alt="TUFLOW HPC Quadtree Grid"  />
<p class="caption">
Figure 63: TUFLOW HPC Quadtree Grid
</p>
</div>
<p>The Quadtree solver uses a modified version of the HPC solver. It uses an explicit finite volume solution that is 2<sup>nd</sup> order in space and 4<sup>th</sup> order in time, however there are some subtle differences between the HPC single grid and Quadtree solvers that mean they produce near identical, though not identical results if both run are over the same single grid (same cell size) grid – see Section <a href="#FixedGridorQuadtreeGrid-3"><strong>??</strong></a> for further discussion.</p>
<p>TUFLOW Wiki Tutorial <a href="https://wiki.tuflow.com/Tutorial_M07">Module 7</a> provides a demonstration of quadtree. The followings Sections outline how to use the feature.</p>
<h4 class="hasAnchor" id="qcf-commands-4"><span class="header-section-number">7.4.1.1</span> Quadtree .tcf Commands<a href="#qcf-commands-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To use a Quadtree grid, the solution scheme should be set to HPC and a
Quadtree Control file specified using the command
<a href="#tcfQuadtreeControlFile">Quadtree Control File</a>. GPU Hardware is also recommended. For example:</p>
<p><tcmd>If Scenario</tcmd><teq> == </teq><tblk>HPC </tblk> <br>
 <tcmd>Solution Scheme</tcmd><teq> == </teq><tblk>HPC </tblk> <br>
 <tcmd>Hardware</tcmd><teq> == </teq><tblk>GPU </tblk> <br>
<tcmd>Else If Scenario</tcmd><teq> == </teq><tblk>Quadtree </tblk> <br>
 <tcmd>Solution Scheme</tcmd><teq> == </teq><tblk>HPC </tblk> <br>
 <tcmd>Quadtree Control File</tcmd><teq> == </teq><tblk>..\model\quadtree_001.qcf </tblk><br>
 <tcmd>Hardware</tcmd><teq> == </teq><tblk>GPU </tblk><br>
<tcmd>End If</tcmd></p>
<p>Note, the keyword “Single Level” can be used instead of a control file (e.g.
“<tcmd><a href="#tcfQuadtreeControlFile">Quadtree Control File</a></tcmd><teq> == </teq><tblk>Single Level</tblk>”), to run the Quadtree module as a single 2D domain fixed grid model (ie. a fixed cell size). A simulation run in this manner will likely run slower than HPC, though may require a smaller
memory footprint. This is due to quadtree only storing a grid of active cells compared with single fixed grid models that use the bounding rectangle to allocate memory, which may include large areas of inactive (redundant) cells and
therefore consuming memory.</p>
<p>The Quadtree Control File (.qcf) is described in the next section.</p>
<h4 class="hasAnchor" id="qcf-mandatory-4"><span class="header-section-number">7.4.1.2</span> Quadtree Control File (.qcf) – Mandatory Commands<a href="#qcf-mandatory-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Quadtree Control File (.qcf) is used to define the grid refinement areas and optionally the model location and extent for a Quadtree grid. Appendix <a href="#QCFCommands-1"><strong>??</strong></a> lists and describes the available .qcf commands.</p>
<p>The following commands are mandatory in a .qcf file.</p>
<p><tcmd><a href="#qcfModelOriginandExtent">Model Origin and Extent</a></tcmd><teq> == </teq><tblk>AUTO | TGC</tblk></p>
<p>If set to “AUTO” the extents of the Level 1 GIS polygon are used to
define the model origin and extents. If set to “TGC”, the model is
located as per the commands in the .tgc file. Note, the angle of the
model is defined in the .qcf file using the <a href="#qcfOrientationAngle">Orientation Angle</a> command
below. Also, if set to “AUTO” the GIS nesting polygons must have a
Level 1 polygon defined, otherwise an ERROR is generated.</p>
<p><tcmd><a href="#qcfReadGISNesting">Read GIS Nesting</a></tcmd><teq> == </teq><tblk>&lt;gis file&gt; &gt;</tblk></p>
<p>The <a href="#qcfReadGISNesting">Read GIS Nesting</a> command can be used to define polygons of grid refinement (different levels) in the 2d_qnl format file, as described in Section <a href="#QDT-mesh-4"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="qcf-optional-4"><span class="header-section-number">7.4.1.3</span> Quadtree Control File (.qcf) – Optional Commands<a href="#qcf-optional-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following commands are optional in the Quadtree Control File:</p>
<p><tcmd><a href="#qcfBaseCellSize">Base Cell Size</a></tcmd><teq> == </teq><tblk>&lt;cell size in m/ft&gt; | {TGC}</tblk></p>
<p><a href="#qcfBaseCellSize">Base Cell Size</a> sets the Level 1 (parent) cell size.
This will be the largest cell size in the Quadtree grid. If set to a
numerical value this will override the cell size command in the .tgc
file. If this command is not specified or is set to “TGC”, the cell size defined in the .tgc file is used.</p>
<p><tcmd><a href="#qcfOrientationAngle">Orientation Angle</a></tcmd><teq> == </teq><tblk>&lt;angle in degrees&gt; | OPTIMISE | {TGC}</tblk></p>
<p>If set to a numerical value this defines the grid orientation angle and
overrides any angle / location .tgc commands. If Set to “OPTIMISE” the
parent Level 1 polygon is used to optimise the angle of the grid to
minimise the area of the bounding rectangle, thereby minimising
temporary memory requirements during the simulation startup (the memory
footprint during the simulation is not affected). As such the GIS
nesting polygon must have a Level 1 polygon defined. If the command is not specified
or is set to “TGC”, the orientation angle in the .tgc is used.</p>
<p>When pre-processing the Quadtree grid, a hidden 2D domain is used for
areas of refinement to allow fast processing of geometry on a regular
grid. The default approach is that each nesting level is treated as a 2D
rectangular domain, therefore, for example, with three levels of nesting
the geometry control file is processed three times. To reduce
initialisation memory demands it is possible to treat each GIS polygon
in the 2d_qnl layer as a separate domain for the processing of geometry
inputs. This is set using the optional .qcf control file command:</p>
<p><tcmd><a href="#qcfQuadtreeMeshProcessingMethod">Quadtree Mesh Processing Method</a></tcmd><teq> == </teq><tblk>{FAST} | Memory Efficient</tblk></p>
<p>This allows changing to a more memory efficient approach to process
each polygon in the 2d_qnl layer. However, whilst being more memory
efficient during grid creation, the model startup may be slower. How the grid
is processed has no effect on the speed of the hydraulic computations or
the memory demand during the hydraulic calculations.</p>
<h4 class="hasAnchor" id="QDT-mesh-4"><span class="header-section-number">7.4.1.4</span> Defining Grid Refinement Polygons<a href="#QDT-mesh-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A 2d_qnl (Quadtree Nesting Level) GIS layer (see Table <a href="#tab:tab-QNLAttribute">69</a>) is used to define the
location and levels of grid refinement. The 2d_qnl layers should only contain
polygon / region objects, with all other GIS object types (lines, points, etc.) ignored.</p>
<p>The nesting level attribute must be in the range 1 to 9. A value of:</p>
<ul>
<li>1: indicates that the cell size to be used for that polygon is the Level 1
or base cell size (see <a href="#qcfBaseCellSize">Base Cell Size</a>).</li>
<li>2: indicates the cell size within the polygon would be at Level 2 (i.e.
half the base cell size).</li>
<li>3: indicates the cell size within the polygon would be at Level 3 (i.e. 1/4<sup>th</sup> of the base cell size).</li>
<li>4: indicates the cell size within the polygon would be at Level 4 (i.e. 1/8<sup>th</sup> of the base cell size).</li>
<li>…</li>
<li>9: so on up to a maximum of Level 9 (1/256<sup>th</sup> of the base cell size).</li>
</ul>
<p>For numerical precision reasons when running single precision, the maximum nesting level of 9 or 1/256 of the base cell size has been adopted, but can be increased for double precision mode should there be a demand from users.</p>
<table>
<caption>
<span id="tab:tab-QNLAttribute">Table 69: </span><strong>2D Quadtree (2d_qnl) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Nest_Level
</td>
<td style="text-align:left;">
<p>The value of the quadtree nested level used for grid refinement.</p>
<p>The nesting level attribute must be in the range 1 to 9. For example:</p>
<ul>
<li>1: indicates that the cell size to be used for that polygon is the Level 1 or base cell size (see <a href="#qcfBaseCellSize">Base Cell Size</a>.</li>
<li>2: indicates the cell size within the polygon would be at Level 2 (i.e. half the base cell size).</li>
<li>3: indicates the cell size within the polygon would be at Level 3 (i.e. 1/4th of the base cell size).</li>
<li>4: indicates the cell size within the polygon would be at Level 4 (i.e. 1/8th of the base cell size).</li>
<li>…</li>
<li>9: so on up to a maximum of Level 9 (1/256th of the base cell size).
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
</tbody>
</table></li>
</ul>
<p><strong>Note: there should only be one Level 1 polygon defined in the 2d_qnl
layer, but for all other levels there is no limit on the number of
polygons.</strong></p>
<p>When refining grid areas, if a refinement polygon sits within a polygon
of the next higher level (e.g. a Level 3 polygon is defined within a
Level 2), as per Figure <a href="#fig:fig-image62">64</a>, no automatic grid refining is required.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image62"></span>
<img src="images/image62.png" alt="Example of Quadtree Nesting Level Polygons"  />
<p class="caption">
Figure 64: Example of Quadtree Nesting Level Polygons
</p>
</div>
<p>However, if a nesting level polygon does not sit within a polygon
of the next higher level (e.g. a Level 4 polygon is defined within a
Level 1 or Level 2 polygon), intermediate areas of refinement are
automatically generated by TUFLOW. For example, Figure <a href="#fig:fig-image64">65</a> show the grid generated when transitioning from a Level 1 to Level 3 and a
Level 1 to Level 5.</p>
<p><img src="images/image63.jpg" width="50%" style="display: block; margin: auto;" /></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image64"></span>
<img src="images/image64.jpg" alt="Examples of Automatic Quadtree Refinement" width="50%" />
<p class="caption">
Figure 65: Examples of Automatic Quadtree Refinement
</p>
</div>
<p>No Level 1 polygon is required if the model origin and extent
are defined in the .tgc file. In this situation the rectangle
representing the .tgc computational domain is used as the Level 1
polygon. For example, if the .qcf file includes the following commands
and the only 2d_qnl polygon is Level 3 (red polygon in Figure <a href="#fig:fig-image68">68</a>.
The grid created is based on the rectangular computational domain in the
.tgc file (as shown by the thick dashed black line) with inactive cells
removed from the grid to reduce memory.</p>
<p><tcmd><a href="#qcfBaseCellSize">Base Cell Size</a></tcmd><teq> == </teq><tblk>TGC</tblk><br />
<tcmd><a href="#qcfModelOriginandExtent">Model Origin and Extent</a></tcmd><teq> == </teq><tblk>TGC</tblk><br />
<tcmd><a href="#qcfOrientationAngle">Orientation Angle</a></tcmd><teq> == </teq><tblk>TGC</tblk><br />
<tcmd><a href="#qcfReadGISNesting">Read GIS Nesting</a></tcmd><teq> == </teq><tblk>gis\2d_qnl_999_R.shp</tblk></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image65"></span>
<img src="images/image65.png" alt="Example Showing Removal of Inactive Cells" width="50%" />
<p class="caption">
Figure 66: Example Showing Removal of Inactive Cells
</p>
</div>
<h3 class="hasAnchor" id="HPC-Turbulence-3"><span class="header-section-number">7.4.2</span> HPC Turbulence<a href="#HPC-Turbulence-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section contains information relating to sub-grid-scale turbulence options for TUFLOW HPC.</p>
<h4 class="hasAnchor" id="HPC-Turbulence-4"><span class="header-section-number">7.4.2.1</span> Overview<a href="#HPC-Turbulence-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For TUFLOW HPC, three options exist (Constant, Smagorinsky and Wu) for specifying eddy viscosity for the 2D domains to approximate the effect of sub-grid-scale turbulence. <span class="citation">Collecutt et al. (<a href="#ref-Collecutt2020">2020</a>)</span> discusses the turbulence models in respect to model cell size sensitivity, resulting in the Wu approach (Section <a href="#Wu-4"><strong>??</strong></a>) becoming the default for TUFLOW HPC from the 2020-01 release and onwards. Discussion on the change in defaults is available in the <a href="https://wiki.tuflow.com/HPC_Turbulence_FAQ">HPC Turbulence FAQ</a> TUFLOW Wiki Page.</p>
<p>The <a href="#tcfViscosityFormulation">Viscosity Formulation</a> and <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> commands are used to set the formulation and coefficients. Note that these commands may also be used to select the non-Newtonian module, which is discussed in Section <a href="#NN-3"><strong>??</strong></a> since it is not a sub-grid turbulence model.</p>
<h4 class="hasAnchor" id="Constant-4"><span class="header-section-number">7.4.2.2</span> Constant Eddy Viscosity<a href="#Constant-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Constant approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a> </tcmd><teq>==</teq><tblk> CONSTANT</tblk>)
applies a constant value throughout the model, irrespective of velocity
gradients and variations. This is generally satisfactory when the bed
resistance is dominant or when modelling large ocean basins (in which
case the recommended coefficient for the constant formulation is 1
m<sup>2</sup>/s), but is not recommended for riverine flow paths.</p>
<h4 class="hasAnchor" id="Smagorinsky-4"><span class="header-section-number">7.4.2.3</span> Smagorinsky Approach<a href="#Smagorinsky-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW’s Smagorinsky approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity
Formulation</a> </tcmd><teq>==</teq><tblk> SMAGORINSKY</tblk>) applies a hybrid method that includes elements of both the Constant and Smagorinsky approaches, as given by the equation below. This formulation is better than the CONSTANT option, as the eddy viscosity is
recalculated every timestep at every cell mid-side according to the
change in velocity magnitude and direction. This results in higher
coefficients being applied where there is greater turbulence.</p>
<p>However, this approach has two known limitations:</p>
<ol style="list-style-type: decimal">
<li>It assumes that all turbulent kinetic energy with length scales greater than the
cell size is resolved within the velocity field. This assumption is
reasonable when the 2D cell size is larger than the physical depth of the
flow, but becomes incorrect when the 2D cell size is smaller than
the depth of the flow – turbulence in the vertical direction contributes
significantly to viscosity but is not resolved in the 2D velocity field.
As a result, once the 2D cell size becomes smaller than the flow depth
this approach can underpredict the viscosity, and therefore can underpredict
momentum coupling from river to flood plain.<br />
</li>
<li>It assumes that the physical length scales of the sub-grid turbulence scale with
the 2D cell size. This is reasonable when the 2D cell size is similar to
the depth of the flow, but becomes incorrect when the 2D cell size
becomes significantly larger than the depth of the flow – the bed
resistance and the finite depth of the flow prevent large scale
turbulence. As a result, once the 2D cell size becomes much larger than
the depth of the flow, the Smagorinsky turbulence model can overpredict the
viscosity, and therefore can overpredict the momentum coupling from river
to flood plain.</li>
</ol>
<p>The result of these two limitations, is that model results display some
sensitivity to the 2D cell size. The Wu formulation (Section <a href="#Wu-4"><strong>??</strong></a>)
has proven to be more capable in its ability to provide “out of the box”
calibration and reduced sensitivity of model results to 2D cell size.</p>
<p>Note, if the formulation is changed, the user must also reset the
coefficient using the command
<a href="#tcfViscosityCoefficient">Viscosity Coefficient</a>. <!--EFC to PAR: Just did a quick test and it looks like TUFLOW automatically updates the coefficients when changing formulation. Can this sentence be deleted. It's a bit confusing--></p>
<p>The Smagorinsky option remains the default when using TUFLOW
Classic. The default viscosity coefficients are a Smagorinsky value of
0.5 plus a constant value of 0.05 m<sup>2</sup>/s. The 0.5 Smagorinsky
coefficient is dimensionless. The viscosity coefficient can be output
using the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command.</p>
<p>The hybrid Smagorinsky formulation used by TUFLOW is:</p>
<p><span class="math display" id="eq:equ-smag">\[\begin{equation}
𝜐 = C_{c} + C_{s}A_{c}\sqrt{\left( \frac{\partial u}{\partial x} \right)^{2} + \left( \frac{\partial v}{\partial y} \right)^{2} + {\frac{1}{2}\left( \frac{|\partial u|}{\partial y} + \frac{|\partial v|}{\partial x} \right)}^{2}}
\tag{42}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(u\ and\ v = \ \)</span>Depth averaged velocity components in the X and Y
directions<br />
</li>
<li><span class="math inline">\(x\ and\ y = \ \)</span>Distance in the X and Y direction<br />
</li>
<li><span class="math inline">\(\nu = \ \)</span>Horizontal diffusion of momentum (viscosity) coefficient,
m<sup>2</sup>/s or ft<sup>2</sup>/s<br />
</li>
<li><span class="math inline">\(A_{c} = \ \)</span>Area of Cell<br />
</li>
<li><span class="math inline">\(C_{\ c} = \ \)</span>Constant Coefficient (default = 0.05 m<sup>2</sup>/s)<br />
</li>
<li><span class="math inline">\(C_{s} = \ \)</span>Smagorinsky Coefficient (dimensionless, default = 0.5)</li>
</ul>
<h4 class="hasAnchor" id="Wu-4"><span class="header-section-number">7.4.2.4</span> Wu Approach<a href="#Wu-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Wu approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a> </tcmd><teq>==</teq><tblk> WU</tblk>) is the
default method for TUFLOW HPC from release 2020-01 and onwards. It is not available for
TUFLOW Classic. This eddy viscosity (turbulence) model combines both 2D
and 3D turbulence effects, and is a slightly adapted version of that
described in <span class="citation">W. Wu et al. (<a href="#ref-Wu2005">2005</a>)</span>.</p>
<p>Like the Smagorinsky eddy viscosity model, it is a zero-equation model
whereby the eddy viscosity coefficient can be diagnostically computed
from the mean depth and velocity fields. However, unlike the Smagorinsky
model, where the turbulent length scale is related to cell size, the
length scales used in the Wu model are related to water depth, and hence
the computed eddy viscosity is not related to or dependent on cell size.
This has been shown to significantly improve the cell size convergence
of the results compared to the Smagorinsky model (i.e. the results are
nearly independent of the cell size provided there are enough cells
across the waterways to adequately define the flows).</p>
<p>The computed eddy viscosity is the Pythagorean sum of 3D and 2D
contributions:</p>
<p><span class="math display" id="eq:equ-wu">\[\begin{equation}
\nu_{T} = \sqrt{\nu_{3D}^{2} + \nu_{2D}^{2}} \\

\upsilon_{3D} = C_{3D}U^{*}L_{m} \\

U^{*} = |U|n\frac{\sqrt{g}}{d^{\frac{1}{6}}} \\

\upsilon_{2D} = C_{2D}L_{m}^{2}|\nabla U| \\

|\nabla U| = \sqrt{\left( \frac{\partial u}{\partial x} \right)^{2} + \left( \frac{\partial v}{\partial y} \right)^{2} + \frac{1}{2}\left( \frac{\partial u}{\partial y} + \frac{\partial v}{\partial x} \right)^{2}}
\tag{43}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\nu_{T}\ \)</span> is the final total 2D viscosity<br />
</li>
<li><span class="math inline">\(\nu_{3D}\ \)</span>is the vertical 3D viscosity contribution<br />
</li>
<li><span class="math inline">\(\nu_{2D}\ \)</span>is the horizontal 2D viscosity contribution<br />
</li>
<li><span class="math inline">\(C_{3D}\)</span> coefficient for 3D viscosity contribution<br />
</li>
<li><span class="math inline">\(C_{2D}\)</span> coefficient for 2D viscosity contribution<br />
</li>
<li><span class="math inline">\(U^{*}\)</span> is the friction velocity (is <span class="math inline">\(\sqrt{\frac{\tau_{bed}}{\rho}}\)</span>)<br />
</li>
<li><span class="math inline">\(L_{m}\)</span> is the turbulent length scale (is lesser of flow depth or
distance to wet/dry boundary)<br />
</li>
<li><span class="math inline">\(n\)</span> is Manning’s bed friction (see note below on treatment of high
Manning’s n materials)<br />
</li>
<li><span class="math inline">\(g\)</span> is gravity<br />
</li>
<li><span class="math inline">\(d\)</span> is water depth<br />
</li>
<li><span class="math inline">\(|\nabla U|\)</span> is the magnitude of the 2D velocity strain tensor</li>
</ul>
<p>The computed viscosity <span class="math inline">\(\nu_{T}\)</span> can be output using the <a href="#tcfMapOutputDataTypes">Map
Output Data Types</a> command. In our testing to
date, we have found <span class="math inline">\(C_{3D} = 7\)</span>  and <span class="math inline">\(C_{2D} = 0\)</span> to yield results that
agree well with benchmark tests and that are not significantly
dissimilar from those of the previous Smagorinsky method with its
default coefficients for situations where the depth is not significantly
greater than the cell-size. The values of <span class="math inline">\(C_{3D} = 7\)</span> and <span class="math inline">\(C_{2D} = 0\)</span>
are the default values but can be changed using the
<a href="#tcfViscosityCoefficient">Viscosity Coefficient</a>
command. This effectively ignores the 2D component in the Wu model.
Alternatively, to use only the 2D component of the model (and ignore the
3D component), we have found <span class="math inline">\(C_{3D} = 0\)</span> and <span class="math inline">\(C_{2D} = 4\)</span> to be a
suitable starting point. As always, calibration remains an essential
step. If quality calibration data is available and all Manning’s values
are within industry standard ranges, then we encourage the user to
adjust the coefficients as necessary to achieve calibration. We
anticipate that calibration should be possible with either <span class="math inline">\(C_{2D}\)</span> or
<span class="math inline">\(C_{3D}\)</span> in the range 1 to 7. If values outside this range are required
then this may indicate other errors (eg. boundary values or
schematisation, poor input data, etc). As always, sensitivity testing of
changes in parameters on the model results should also be performed.</p>
<p>It is a common practice to represent buildings in a model as
roughness (i.e. cells with high Manning’s bed friction),
see discussion on modelling buildings in Section <a href="#urban-areas-3"><strong>??</strong></a>.
As the friction velocity includes the Manning’s value, this results in a very high
viscosity value at those cells. This is not unreasonable, but for TUFLOW
HPC, which handles the viscosity explicitly, this can drive the timestep
down to small values. We have found that limiting the Manning’s values
used in the Wu 3D model to a sensible maximum (for example 0.1) makes
very little difference to the model results but can vastly improve
solution time. This upper limit is included as an optional third value
to the
<a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> when
using the Wu approach. Note that the original high Manning’s value, as
defined in the materials database, is used in the momentum equation
where its primary influence is effected.</p>
<h3 class="hasAnchor" id="SGS-3"><span class="header-section-number">7.4.3</span> Sub-Grid Sampling (SGS)<a href="#SGS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!--
This section will be quite large and need to include:

- Intro to SGS
- SGS Methodology
- Infiltration considerations
- SGS commands
- SGS commands - Advanced
- Output options
-->
<!-- write as is for Method C, don't include superseded commands (but put in appendix) inc method a, method b. Ask SG if we include Method A-->
<p>Sub-grid sampling (SGS) stores elevation points sampled at a finer
resolution than the 2D cell to more accurately represent the
variations in terrain inside the cell, as shown in Figure <a href="#fig:fig-image68">68</a>. SGS functionality is introduced in Section <a href="#SubGridSamplingSGS-3"><strong>??</strong></a>. Benchmark testing has shown the benefits of using SGS to be substantial, as discussed in Section <a href="#SGS-benefits-4"><strong>??</strong></a>.</p>
<p>SGS translates the high resolution sampled elevation data into cell curve functions for its hydraulic calculations.<br />
- The cell volume is stored as a non-linear function of elevation (i.e. a
curve of cell volume versus elevation based on the wetted surface area
versus depth measured from the lowest sampled elevation within the 2D
cell).
- Across each cell side the flow area and flow width are calculated based on sampled elevations to produce a non-linear function of conveyance versus elevation (i.e. a curve of conveyance versus elevation. For determining the depth and
width averaged velocity across each cell face the flow area is also
retained as a curve of area versus elevation).</p>
<p>The elevation dataset sample resolution can be defined by the user. For example, using a 8m cell size and a 2m <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> the DEM is sampled at 5 points across each face. Shown in Figure <a href="#fig:fig-image68">68</a> this translates to 25 elevation
points being used to define the volume vs elevation relationship
within the 2D cell, and 5 points along each cell side for defining the
conveyance-elevation relationship of each face.</p>
<div style="display: flex; justify-content: center; align-items: center;">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image67"></span>
<img src="images/image67.jpeg" alt="Traditional (non-SGS) Approach" width="50%" />
<p class="caption">
Figure 67: Traditional (non-SGS) Approach
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image68"></span>
<img src="images/image68.jpeg" alt="SGS Approach" width="50%" />
<p class="caption">
Figure 68: SGS Approach
</p>
</div>
</div>
<p>The flow or conveyance of water through 2D cells is determined through a
full 2D solution of the momentum equation (see Section <a href="#Solvers-2"><strong>??</strong></a>). The bed resistance term (e.g. Manning’s equation) and the determination of the 2D
velocities are controlled by the conveyance properties of each cell
face. If there are considerable variations in bed topography across the cell faces, SGS will provide a significantly more
accurate representation of these variations, compared to a traditional 2D cell with a single elevation value per cell face.</p>
<p>If the resolution of the DEM data layer is coarser or similar to
the 2D cell size, the use of SGS will have little or no benefit. For
example, if the DEM resolution is 2m and the cell size is 2m there is
little benefit in using SGS, although a slight improvement would result
as the slope of the terrain across the cell would be picked up if using
SGS. In contrast, if the cell size is 20m there would be considerable
benefit in using SGS as the variations in terrain across the 2D cell
will be represented. TUFLOW requires an odd number of sample locations across a cell face to ensure the cell mid-face and cell corners are sampled. The number of sample locations across a cell face is referred to as the <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a>.</p>
<p>Note, if the elevation input data has a reasonable representation of the channels, <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tgcReadGISZLine">Read GIS Z Line</a> “MIN, GULLY or LOWER” lines are not required, or recommended, when using SGS. Including gully lines can overestimate conveyance in these channels.</p>
<p>The following section will focus on implementing SGS and options regarding SGS outputs.</p>
<h4 class="hasAnchor" id="SGS-commands-4"><span class="header-section-number">7.4.3.1</span> SGS Methodology and Commands<a href="#SGS-commands-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To implement SGS the only additional command required in the .tcf is “<tcmd><a href="#tcfSGS">SGS</a></tcmd><teq> == </teq><tblk>ON</tblk>”.</p>
<p>By default, using this command will set:</p>
<ul>
<li>the <a href="#tcfSGSApproach">SGS Approach</a> to Method C. Prior to 2023 release the default was Method B. The default Method C is the recommended approach and older versions are considered legacy though are still provided for backward compatibility.</li>
<li>the <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> to sample at the minimum grid elevation resolution that can be found from grids read in to the .tgc.</li>
</ul>
<h5 class="hasAnchor" id="SGS-Distance-5"><span class="header-section-number">7.4.3.1.1</span> SGS Sample Distance<a href="#SGS-Distance-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To manually set the SGS distance, the recommended approach is to use the .tcf <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> command. TUFLOW requires an odd number of sample locations across a cell face, the number of sample points is calculated from Equation <a href="#eq:equ-sgs-smp-freq">(44)</a></p>
<p><span class="math display" id="eq:equ-sgs-smp-freq">\[\begin{equation}
\text{Sample Frequency} = \frac{\text{TUFLOW Cell Size}}{\text{Target Distance}} + 1
\tag{44}
\end{equation}\]</span></p>
<p>For example, using a cell size of 10m and a sample target distance of 1m, TUFLOW will use 11 sample points along the cell face. If the target distance specified gives an even number, TUFLOW will round up to the next odd number. For example, using a cell size of 5m and a sample target distance of 1m, TUFLOW will use 7 sample points instead of 6 points along the cell face. The adopted sampling frequency is reported in the .tlf.</p>
<p>It is also possible to specify the <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> directly instead of the target distance. However, changing the cell size of the model would require a changing to the sample frequency to maintain the same sample distance. When using a target sample distance the same value can be used across all cell sizes.</p>
<p>To obtain the maximum resolution, the sampling frequency can be calculated as the TUFLOW cell size divided by the DEM resolution. If this yields an even number, then it should be rounded up as per Equation <a href="#eq:equ-sgs-smp-freq">(44)</a>. Note, there is no benefit to specify an SGS target distance smaller than the DEM resolution.</p>
<p>If neither the <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> or <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> commands are specified, a scan of the Geometry Control File (.tgc) is performed to find the minimum raster grid resolution used in any <a href="#tgcReadGridZpts">Read Grid Zpt</a> commands, and this is used as the sampling target distance to compute the sampling frequency.
If there are no gridded elevation datasets, a default sampling frequency of 11 is used. In summary, there are four ways for the SGS Sample Frequency to be defined; in decreasing order of priority they are:</p>
<ol style="list-style-type: decimal">
<li>“<tcmd><a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> </tcmd><teq>==</teq>” command.</li>
<li>“<tcmd><a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a></tcmd><teq> ==</teq>” command.</li>
<li>Target distance automatically based on the minimum grid elevation resolution in the .tgc.</li>
<li>Default Sampling Frequency of 11 per face / 121 per cell.</li>
</ol>
<p>Note: the sampling frequency per face is capped at 31 by default to avoid long pre-processing times and high memory usage. In general, a sampling frequency of between 11 and 31 is sufficient for most natural water ways or artificial structures, and users may not benefit from applying a super fine sample distance against the model cell size. However, if required, high sampling resolution is possible and the set upper limit can be increased by using the following tcf command:</p>
<p><tcmd><a href="#tcfSGSMaxSampleFrequency">SGS Max Sample Frequency</a> </tcmd><teq>==</teq> <span class="math inline">\(\langle\)</span>maximum frequency<span class="math inline">\(\rangle\)</span></p>
<p>Note, a hard limit of 127 per face (16,129 samples per cell) still applies.</p>
<h5 class="hasAnchor" id="SGS-Advanced-5"><span class="header-section-number">7.4.3.1.2</span> Advanced SGS Commands<a href="#SGS-Advanced-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>As noted above, the only command required to implement SGS is “<tcmd><a href="#tcfSGS">SGS</a></tcmd><teq> == </teq><tblk>ON</tblk>”. One of the above commands to set the SGS sample distance or frequency is also recommended. The following section lists advanced commands related to SGS.</p>
<hr />
<p><tcmd><a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a></tcmd><teq> == </teq><tblk> [ &lt;maximum_delta_value&gt; ]</p>
<p>When the SGS elevations are being processed, every cell face will store a curve of elevation versus flow width / flow area. Likewise, each cell has a curve defining the relationship of elevation versus cell volume. To make this memory efficient TUFLOW does not store information defining the specific locations within the cell or along the cell face where the low or high points in the topography occur. As a result, without breaklines, SGS will be more likely to allow “leaks” through a levee or embankment compared with running the model without SGS. For example, if a 2D cell straddles a levee, SGS will sample the low elevations on either side of the levee and will flow at a lower level than if SGS was not applied and the 2D cell centre was located on top of the levee, causing the 2D cell to block flow until the levee is overtopped. Therefore, whilst the need to have breaklines is paramount, regardless of whether SGS is used, it is even more important for SGS models to accurately represent hydraulic controls such as levees (artificial or natural), road/rail embankments, fences, etc.</p>
<p><a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a> is designed to identify locations where ridge lines may be required. As noted in Section <a href="#SGS-3"><strong>??</strong></a>, <a href="#tgcReadGISZShape">Read GIS Z Shape</a> or <a href="#tgcReadGISZLine">Read GIS Z Line</a> “MIN, GULLY or LOWER” lines are not recommended for use.</p>
<p>The SGS breakline detection check processes each 2D cell to identify the minimum water surface elevation needed for a continuous wet connection through the cell traversing between left to right and top to bottom. The maximum invert elevation of the left and right faces is subtracted from the left-right minimum water level and reports it as “uDelta”. Similarly, the top to bottom value is reported as “vDelta”. uDelta and vDelta represent the depth of water over the cell face inverts by which a natural ridge (break) line would block any flow. The maximum of uDelta and vDelta is output to the <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> file in the SGS_Delta_Z attribute. If either uDelta or vDelta exceeds the <maximum delta value> a spatial (GIS) <a href="https://wiki.tuflow.com/TUFLOW_Message_3543">CHECK 3543</a> message is issued at the cell location.</p>
<p>This command can add significant time to the initialisation process, it is recommended to perform this check during model set up only, and to turn it off once the creation of breaklines is complete.</p>
<p>Figure <a href="#fig:fig-SGS-Delta">69</a> shows an example of where <a href="https://wiki.tuflow.com/TUFLOW_Message_3543">CHECK 3543</a> indicates where the uDelta or vDelta has exceeded the <maximum delta value> (in this example, a value of 1m).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS-Delta"></span>
<img src="images/SGS-Delta.png" alt="SGS Breakline Detection Delta Output" width="50%" />
<p class="caption">
Figure 69: SGS Breakline Detection Delta Output
</p>
</div>
<hr />
<p><tcmd><a href="#tcfSGSZShapeLineApproach">SGS Z Shape Line Approach</a></tcmd><teq> == </teq><tblk>Method A | {Method B}</tblk></p>
<p>If set to Method A, cell faces modified by <a href="#tgcReadGISZShape">Read GIS Z Shape</a> line are assumed flat (i.e. SGS is not applied and a rectangular section / flat
cell is used). The default, Method B, applies a gradient along the face based on the cell corners and cell side Zpt values and for thick lines uses the ZC, ZU, ZV and ZH values to apply a sloping cell area
for the cell volume.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SGS-Z-Line"></span>
<img src="images/SGS-Z-Line.png" alt="Diagram of SGS Z Shape Line Approach Options" width="50%" />
<p class="caption">
Figure 70: Diagram of SGS Z Shape Line Approach Options
</p>
</div>
<hr />
<p><tcmd><a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a></tcmd><teq> == </teq><tblk>Method A | {Method B}</tblk></p>
<p>If set to Method A, cells that are lowered by the “Z” flag on 2d_bc SX connections are assumed flat (i.e. as per the approach for no SGS). The default Method B retains the SGS information, but shifts it all to
match the lowered elevation, as per Figure <a href="#fig:fig-sgs-SX-Flag">71</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-sgs-SX-Flag"></span>
<img src="images/sgs-SX-Flag.png" alt="Diagram of SGS SX Z Flag Approach Options" width="30%" />
<p class="caption">
Figure 71: Diagram of SGS SX Z Flag Approach Options
</p>
</div>
<!-- EFC to PAR: do I also need to link here from the direct rainfall section?-->
<!-- EFC to PAR: I've copied this from the 2020 release notes what is the SGS Negative Rainfall approach? Is it different to the Soil Negative Rainfall approach command?-->
<!-- SGS neg rainfall approach - is regarding surface water, no soils-->
<hr />
<p><tcmd><a href="#tcfSGSInfiltrationApproach">SGS Infiltration Approach</a></tcmd><teq> == </teq><tblk> {AUTO} | TOTAL AREA | WETTED AREA </tblk></p>
<p>It is possible to control the cell area used when infiltration is applied with SGS, using the <a href="#tcfSGSInfiltrationApproach">SGS Infiltration Approach</a> command. The three available options are:</p>
<ul>
<li>AUTO (the default): uses total area if there is a rainfall boundary and wetted area if no rainfall boundaries are present.</li>
<li>TOTAL AREA: uses the whole cell area, regardless of the portion of the cell that is wet.</li>
<li>WETTED AREA: uses only the wetted portion of the cell, for direct rainfall boundaries this may under predict the infiltration.</li>
</ul>
<hr />
<p><tcmd><a href="#tcfSGSNegativeRainfallApproach">SGS Negative Rainfall Approach</a> </tcmd><teq> == </teq><tblk> TOTAL AREA | {WETTED AREA} </tblk></p>
<p>It is also possible to control the cell area used when negative rainfall is applied in conjunction with SGS, using the <a href="#tcfSGSNegativeRainfallApproach">SGS Negative Rainfall Approach</a> command. The two options available are:</p>
<ul>
<li>TOTAL AREA: uses the whole cell area, regardless of the portion of the cell that is wet.</li>
<li>WETTED AREA (the default): uses only the wetted portion of the cell.</li>
</ul>
<p>With SGS enabled, for cells that are partially wet the treatment of infiltration and direct rainfall is:</p>
<ul>
<li>For positive rainfall (i.e. rainfall on to the 2D cell), the volume source for each cell is the total cell
area times the rainfall irrespective of whether the cell is partially wet or not.</li>
<li>For negative rainfall (evaporation), the volume of evaporation is factored by the wet area fraction
of the cell. That is, if the cell is only 10% wet, only one tenth of the cell’s total area contributes to
the negative source term.</li>
<li>For models with soil infiltration the infiltration rate is proportional to the wet area fraction of the cell.
However, initial infiltration losses are based on the total area of the cell (i.e. infiltration will proceed
at the maximum possible rate until the cumulative infiltration – also based on total cell area - equals
the initial loss value) even if the infiltration occurs with the cell partially wet. This approach is
adopted to conform with that required for direct rainfall, which assumes the rainfall is applied over
the entire cell irrespective of whether the cell is partially wet or not. Likewise, soil capacity is
based on the total cell area (i.e. infiltration will cease once the cumulative infiltration equals soil
capacity), and the cumulative wet time for the Horton model will also increment for cells that are
partially wet.</li>
</ul>
<hr />
<h4 class="hasAnchor" id="SGS-output-4"><span class="header-section-number">7.4.3.2</span> SGS Output Options<a href="#SGS-output-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<h5 class="hasAnchor" id="SGS-check-5"><span class="header-section-number">7.4.3.2.1</span> Check Files<a href="#SGS-check-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>When running a model with SGS enabled there are additional attributes inserted into the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt check</a> layer and an additional raster check file, the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Zmin">_DEM_Zmin</a>.</p>
<p>If the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt check</a> layer is output, with SGS turned on, the following additional attribute information is provided:</p>
<ul>
<li>The “Zmin” attribute for ZC points, previously called “Elevation”, now represents the minimum elevation within the cell. The “Zmin” for ZU/ZV points is the minimum along the cell face. Note, these points are still located at the centre of the cell or cell face, but the minimum value is not necessarily at this location.</li>
<li>“ZExact” is the elevation at the exact location of cell centre, face mid-point, or cell corner.</li>
<li>“ZAvg” is the average (mean) elevation of the sampled values.</li>
<li>“ZMed” is the median elevation of the sampled values.</li>
<li>The “ZMax” attribute is the maximum elevation (i.e. the elevation at which the cell area or cell face flow width is fully wet).</li>
<li>“ZOut” is the elevation used for the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> (Section <a href="#sgs-output-5"><strong>??</strong></a>).</li>
</ul>
<p>If the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z</a> layer is output, with SGS turned on, an additional raster output is produced, the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Zmin">_DEM_Z_min</a>. The _DEM_Zmin contains a raster based on the minimum SGS elevations. When using SGS, the _DEM_Z contains a raster based on the SGS elevations used for the depth output interpolation (based on the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> command.)</p>
<h5 class="hasAnchor" id="sgs-output-5"><span class="header-section-number">7.4.3.2.2</span> Map Outputs<a href="#sgs-output-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The following .tcf commands can be used to control the value of depth (d) map output when SGS is used.</p>
<p><tcmd><a href="#tcfSGSDepthOutput">SGS Depth Output</a></tcmd><teq> == </teq><tblk>EXACT | {CELL AVERAGE} | MEAN | MEDIAN | MINIMUM | PERCENTILE </tblk></p>
<ul>
<li>CELL AVERAGE (default): calculates the depth by dividing the cell volume by cell area.</li>
<li>EXACT: the output depth is the water level minus the exact ZC and ZH elevations (i.e. the elevations that would be sampled exactly at the cell centre (ZC) and cell corner (ZH) locations if SGS was not applied).</li>
<li>MEAN: the output depth is the water level minus the mean elevations of the cells and the cell corners from the SGS sampling. Note the MEAN depth output differs from the CELL AVERAGE depth for partially wet cells. For example, if the water level is smaller than the MEAN cell elevation, the MEAN depth output becomes negative (trimmed as zero), while the CELL AVERAGE depth (water volume / cell area) is still positive.</li>
<li>MEDIAN: the output depth is the water level minus the median (50th percentile) elevation for the cells and the cell corners from the SGS sampling.</li>
<li>MINIMUM: the output depth is the water level minus the minimum elevation for the cells and the cell corners from the SGS sampling (i.e. the map output shows the maximum depth within a cell / around a cell corner).</li>
<li>PERCENTILE: the output depth is water level minus an elevation based on the specified set percentile. This requires a second argument, separated by vertical bar “|”, which is the percentile to use. For example, “<tcmd><a href="#tcfSGSDepthOutput">SGS Depth Output</a></tcmd><teq> == </teq><tblk>Percentile | 25</tblk>” will use the 25th percentile of the SGS elevations sampled within the cell / around the cell corner.</li>
</ul>
<p>The elevations used for the SGS Depth Output are output in the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt_check</a> file as the “ZOut” attribute, see Section <a href="#SGS-check-5"><strong>??</strong></a>.</p>
<p>Note that the water level (h) output is not affected by this command.</p>
<p>For the EXACT, MEAN, MEDIAN, MINIMUM, PERCENTILE approaches, the depth output is trimmed if the modelled water level is lower than the output elevations. Meanwhile, the water level output is not trimmed even if the output depth is below the output elevations, and this can produce different output extents for the water level and other outputs. For this reason, the CELL AVERAGE option is recommended for the consistency of the output extent. But if using the other options, the default trimming option can be changed using the <a href="#tcfSGSMapExtent">SGS Map Extent <Trim or Full></a> command.</p>
<p>For the MEAN, MEDIAN, MINIMUM, PERCENTILE approaches, the corner output elevations depend on the size of the SGS sampling area around the cell corners. By default, cell corner elevations are sampled within a square that has the same size as the 2D cell. The size be manually adjusted using the <a href="#tcfSGSZHSampleRatio">SGS ZH Sample Ratio</a> command.</p>
<p>By default the CELL AVERAGE depth is used to calculate the depth/velocity based map outputs, such as unit flow (q), bed shear stress (BSS), stream power (SP) and hazards, regardless of the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> setting. However, if desired, the depth used to calculate these map outputs can be changed using the following command:</p>
<p><tcmd><a href="#tcfSGSVelocityBasedOutputs">SGS Velocity Based Outputs</a></tcmd><teq> == </teq><tblk> {CELL AVERAGE DEPTH} | SGS DEPTH OUTPUT </tblk></p>
<p>If set to the “SGS DEPTH OUTPUT” option, the output depth specified by the <a href="#tcfSGSDepthOutput">SGS Depth Output</a> command above is used. Note that the velocity (v) output is not affected by these commands.</p>
<h5 class="hasAnchor" id="high-resolution-outputs"><span class="header-section-number">7.4.3.2.3</span> High-Resolution Outputs<a href="#high-resolution-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>When using the default sub-grid sampling (SGS) approach the sampled elevations are retained, including topography modifiers such as breaklines, for result post processing. This allows a high-resolution grid to be written (for either depth (d) or water level (h)) and used for high resolution map outputs and also check grids such as the DEM_Z. High-resolution outputs, made available when using SGS Method C, are discussed in Section <a href="#HRGrid-4"><strong>??</strong></a>.</p>
<p>The following commands can be used to alter the high resolution output and are discussed further in Appendix <a href="#TCFCommands-1"><strong>??</strong></a>.</p>
<ul>
<li><a href="#tcfHRInterpolationApproach">HR Interpolation Approach</a>: can be used to control how the cell centre / corner data is interpolated across the cell.</li>
<li><a href="#tcfHRThinZLineOutputAdjustment">HR Thin Z Line Output Adjustment</a>: for models with thin breaklines, the presence of breaklines can be used to alter the High Resolution output interpolation.</li>
</ul>
<h3 class="hasAnchor" id="HPC-US-Controlled-3"><span class="header-section-number">7.4.4</span> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)<a href="#HPC-US-Controlled-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The original weir flow approximation in TUFLOW HPC was to adjust the water level gradient where flow in the 2D domain becomes upstream controlled. The 2023-03 release (and onwards) defaults to applying the full weir equation in the 2D domain along thin and thick breaklines based on the advanced weir equation (Section <a href="#Adv-Weir-4"><strong>??</strong></a>). However, users can revert to the original approach using the command:</p>
<p><tcmd><a href="#tcfHPCWeirApproach">HPC Weir Approach</a></tcmd><teq> == </teq><tblk>Method A | Method B | {Method B Energy}</tblk></p>
<p>Where:</p>
<ul>
<li>“Method A” is the pre 2023-03 method that applies the water level gradient limiter only.<br />
</li>
<li>“Method B” applies the weir equation and uses the upstream water level above the weir invert as <em>H<sub>u</sub></em>, and downstream water level above the weir invert as <em>H<sub>d</sub></em>.<br />
</li>
<li>“Method B Energy” is the default approach. It applies the weir equation and uses the upstream energy level above the weir invert as <em>H<sub>u</sub></em>, and downstream water level above the weir invert as <em>H<sub>d</sub></em>.</li>
</ul>
<p>The default weir parameters (<em>C<sub>d</sub></em>, <em>Ex</em>, <em>a</em> and <em>b</em>) are
based on the parameters used for a broad crest weir, see Table <a href="#tab:tab-WeirFlows">32</a> (i.e.
0.577, 1.5, 8.55 and 0.556, respectively). The following .tcf commands
can be used to change the coefficients globally.</p>
<p>For a thin breakline:</p>
<p><tcmd><a href="#tcfHPCWeirParameters">HPC Thin Weir Parameters</a></tcmd><teq> == </teq><tblk> &lt;Cd&gt;, &lt;Ex&gt;, &lt;a&gt;, &lt;b&gt;</tblk></p>
<p>For a thick breakline:</p>
<p><tcmd><a href="#tcfHPCWeirParameters">HPC Thick Weir Parameters</a></tcmd><teq> == </teq><tblk>&lt;Cd&gt;, &lt;Ex&gt;, &lt;a&gt;, &lt;b&gt;</tblk></p>
<p>In addition, the weir calibration factor, <em>C<sub>f</sub></em> ,can be
adjusted globally using the using the <a href="#tgcSetWrF">Set WrF</a> command, or
adjusted locally using the <a href="#tgcReadGISWrF">Read GIS WrF</a> command. The
default value of <em>C<sub>f</sub></em> is 1.0.</p>
<h3 class="hasAnchor" id="HPC-Groundwater-3"><span class="header-section-number">7.4.5</span> Groundwater Flow<a href="#HPC-Groundwater-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!--EFC to PAR: I think we needed to separate CO and horizontal movement (so people know they can use horizontal movement without multiple layers) but I think I've tangled the below. -->
<!-- PAR to EFC i think it was largely ok, but have tried to add some clarity...-->
<p>Infiltration of the surface water into the ground/soil has been
supported in previous releases, however, as discussed in Section <a href="#Infiltration-2"><strong>??</strong></a>, this functionality was limited to vertical movement of water, and one vertical soil layer (the soil type could vary spatially across the model).</p>
<p>The 2023-03 release permits horizontal flow (advection) of water (Section <a href="#hhc-5"><strong>??</strong></a>) and multiple vertical groundwater layers (Section <a href="#CO-4"><strong>??</strong></a>) when using TUFLOW HPC. Up to 10 vertical layers are supported, each with horizontal advection within the layer possible, and vertical fluid movement between groundwater soil layers. Movement of water within the ground in the real world is complex. The functionality introduced in the 2023-03 release is not intended to replace detailed groundwater modelling, but provides a functional mechanism by which:</p>
<ul>
<li>Catchment response for 2D direct rainfall (“rain on grid”) models can
be better calibrated to available river flow data.<br />
</li>
<li>Long-term catchment models can be constructed that offer some
prediction of stream-flows long after rainfall events.<br />
</li>
<li>The accuracy of real-time flood forecasts can be improved by taking
into account the drying and draining of catchments that has occurred
since the last rainfall event.<br />
</li>
<li>Groundwater seepage can cause inundation, such as seepage under a
levee bank through a porous layer (e.g., old gravel river course),
resulting in flooding on the protected side of the levee.</li>
</ul>
<p>The basic groundwater modelling approach is conceptualised by dividing the ground into vertical layers, each with
a defined thickness (alternatively a z elevation for the bottom of each
layer), soil type, and cumulative infiltration of water within the
layer. The cumulative infiltration, combined with the porosity defined
by the soil type, allows a theoretical “groundwater elevation” (also
known as a “water table”) to be computed within the layer. Figure <a href="#fig:fig-image108">72</a> illustrates the soil layers in adjoining cells with convective and advective fluxes.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image108"></span>
<img src="images/image108.png" alt=" Illustration of soil layers and flows in adjoining cells"  />
<p class="caption">
Figure 72:  Illustration of soil layers and flows in adjoining cells
</p>
</div>
<p>The horizontal movement of water, <span class="math inline">\(Q^{h}\)</span>, is governed by the horizontal hydraulic conductivity value set in the tsoilf file (see Table <a href="#tab:tab-tsoilf-hpc">70</a>). All groundwater layers allow for horizontal advection of the water within the layer. Horizontal advection is disabled if all horizontal hydraulic conductivities are set to zero (which is the default if they are not specified). An example of a model using horizontal hydraulic conductivity, is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Soil_Options">TUFLOW Example Model Dataset</a>.</p>
<p>The vertical flow of water, <span class="math inline">\(Q^{z}\)</span>, from the surface
water layer into the first (or top) groundwater layer is governed by the soil infiltration model. The infiltration into the top soil can use any of the Green-Ampt (GA), Horton (HO) and Initial/Continuing Loss (IlCL) infiltration methods, as listed in Table <a href="#tab:tab-tsoilf-hpc">70</a>. For layers below the top vertical soil layer then the Convective (CO) type must be used, see Section <a href="#CO-4"><strong>??</strong></a>. An example of a model using two vertical soil layers (i.e. the “CO” type), is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Soil_Options">TUFLOW Example Model Dataset</a>.</p>
<p>The cumulative infiltration data and the vertical movement of water are
stored and computed at cell centres. As such, all soil data and
groundwater layer geometry is sampled from the GIS / Grid layers at cell
centres. Likewise the material “fraction impervious” data is sampled at
cell centres (unlike the mannings values which are sampled at face
centres). For the horizontal advection calculation, which is performed
at cell faces, the horizontal hydraulic conductivity used is the average
of the cell centre values for the adjoining cells.</p>
<h5 class="hasAnchor" id="hhc-5"><span class="header-section-number">7.4.5.0.1</span> Horizontal Advection<a href="#hhc-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For all layers, the horizontal advection of water from one cell to the
next, <span class="math inline">\(Q^{h}\)</span>, is computed using the horizontal hydraulic conductivity
of the soil and the horizontal gradient of a variable called the
“groundwater pressure level”:</p>
<p><span class="math display" id="eq:equ-Qh">\[\begin{equation}
Q^{h} = - k_{h}hp\frac{de}{dx}dy
\tag{45}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(k_{h}\)</span> is the horizontal hydraulic conductivity of the soil (average of the adjoining cells used)<br />
</li>
<li><span class="math inline">\(h\)</span> is the groundwater elevation less the layer bottom elevation<br />
</li>
<li><span class="math inline">\(p\)</span> is the soil porosity<br />
</li>
<li><span class="math inline">\(\frac{de}{dx}\)</span> is the gradient of the “groundwater pressure level”<br />
</li>
<li><span class="math inline">\(dy\)</span> the width of the face.</li>
</ul>
<p>Note, if advection of groundwater is not required, then the
advection calculation may be disabled by setting <span class="math inline">\(k_{h}\)</span> to zero for all
soils. This is the default behaviour if <span class="math inline">\(k_{h}\)</span> is not specified in the
soil parameters.</p>
<p>For cells that are “unsaturated” the “groundwater pressure level” is
exactly the groundwater elevation within that layer. For cells that are
fully saturated, the groundwater pressure level is that of the cell in
the next layer above (or the water surface elevation when considering
the topmost groundwater layer). For cells that are “nearly saturated”
the groundwater pressure level is transitioned between these two
options. The threshold at which the transition begins is called the
“groundwater blending threshold”, <span class="math inline">\(\phi\)</span>.</p>
<p><span class="math display" id="eq:equ-blend">\[\begin{equation}

\xi = \frac{\frac{h_{i}}{dz} - \phi}{(1 - \phi)} \\
e_{i} = (1 - \xi)\left( z_{i} + h_{i} \right) + \xi e_{i - 1} \\
e_{0} = {WSE}_{surface}

\tag{46}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(h_{i}\)</span> is the depth of groundwater in the cell<br />
</li>
<li><span class="math inline">\(dz\)</span> the vertical thickness of the layer<br />
</li>
<li><span class="math inline">\(z_{i}\)</span> the layer bottom elevation<br />
</li>
<li><span class="math inline">\(e_{i - 1}\)</span> the groundwater pressure level for the layer above (or surface layer) - <span class="math inline">\(e_{i}\)</span> the resulting groundwater pressure level for this layer.</li>
</ul>
<p>The layer ordering is such that the surface water is layer “0”, the highest
groundwater layer is “1”, and any subsequent groundwater layers range from
2 to N (i.e. from top to bottom).</p>
<p>The groundwater blending threshold, <span class="math inline">\(\phi\)</span>, defaults to a value of 0.9
but can be overridden by the user in the .tcf using the command:</p>
<p><tcmd><a href="#tcfGroundwaterBlendThreshold">Groundwater Blend Threshold</a></tcmd><teq> == </teq><tblk>&lt;float&gt; | {0.9}</tblk></p>
<p>If the sum of flows into a layer cell causes it to exceed its soil
capacity, the excess is pushed upwards to the next layer. If this happens
for the top-most groundwater layer, the excess is pushed into the
surface water as “return flow”. This is to be expected in the creek beds
but may also happen at the bottom of steep hills where the slope
transitions from steep to shallow.</p>
<h5 class="hasAnchor" id="CO-4"><span class="header-section-number">7.4.5.0.2</span> Convective Flow Layers (CO)<a href="#CO-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For layers below the top groundwater layer, the vertical flow of water, <span class="math inline">\(Q^{z}\)</span>, is
computed using a “convective” hydraulic conductivity (effectively the
same concept as continuing loss):</p>
<p><span class="math display" id="eq:equ-Qz">\[\begin{equation}
Q^{z} = \  - kdxdy
\tag{47}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q^{z}\)</span> is the convective vertical flux</li>
<li><span class="math inline">\(k\)</span> is the convective hydraulic conductivity<br />
</li>
<li><span class="math inline">\(dxdy\)</span> is the cell area.</li>
</ul>
<p>Note that <span class="math inline">\(Q^{z}\)</span> is limited to the available cumulative infiltration
stored in the groundwater layer above, and also limited to the remaining
capacity of the groundwater layer below.</p>
<h4 class="hasAnchor" id="implementation"><span class="header-section-number">7.4.5.1</span> Implementation<a href="#implementation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Although the theory appears complex, the implementation within the
TUFLOW model files is straight forward. The essential steps are:</p>
<ul>
<li>Read a soils (.tsoilf) data file from within the .tcf (see Section <a href="#HPC-tsoilf-5"><strong>??</strong></a>).</li>
<li>Define the soil types in the .tgc (see Section <a href="#HPC-soil-type-5"><strong>??</strong></a>).<br />
</li>
<li>Define the soil layer thickness in the .tgc (see Section <a href="#HPC-soil-type-5"><strong>??</strong></a>).</li>
<li>Specify locations of groundwater boundaries in the .tbc (see Section <a href="#GT-4"><strong>??</strong></a>).<br />
</li>
<li>Specify initial water levels within the soil layers (optional) (see Section <a href="#IGW-3"><strong>??</strong></a>).</li>
<li>Add any additional output data types in the .tcf. For example the Map Output Data Types: dGW, GWd, GWh, GWm, GWq, GWv in Table <a href="#tab:tab-ExcludingHazard">102</a>, or Time Series Output Data Types: GWd, GWh, GWm, GWq, GWqa, GWqu, GWqv, GWVol in Table <a href="#tab:tab-PODataPLPL">107</a>.</li>
</ul>
<h5 class="hasAnchor" id="HPC-tsoilf-5"><span class="header-section-number">7.4.5.1.1</span> HPC Soils File (.tsoilf)<a href="#HPC-tsoilf-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The .tsoilf is the same file mentioned in Section <a href="#tsoilf-4"><strong>??</strong></a>. However, when using TUFLOW HPC there are additional parameters available which can be used to enable horizontal advection, and vertical flow through a convective (CO) layer. These additional parameters are bold in Table <a href="#tab:tab-tsoilf-hpc">70</a>.</p>
<table>
<caption>
<span id="tab:tab-tsoilf-hpc">Table 70: </span><strong>HPC .tsoilf Parameters</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No Intriltration
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Green-Ampt
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Green-Ampt
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Horton
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Initial/Continuing Loss
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Convective
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
Soil ID
</td>
<td style="text-align:left;">
<strong>Soil ID</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
NONE
</td>
<td style="text-align:left;">
GA
</td>
<td style="text-align:left;">
GA
</td>
<td style="text-align:left;">
HO
</td>
<td style="text-align:left;">
ILCL
</td>
<td style="text-align:left;">
<strong>CO</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
USDA Soil Type (see Table <a href="#tab:tab-GreenAmpt">61</a>)
</td>
<td style="text-align:left;">
Suction (mm or inches)
</td>
<td style="text-align:left;">
Initial Loss (mm or inches)
</td>
<td style="text-align:left;">
Initial Loss (mm or inches)
</td>
<td style="text-align:left;">
<strong>Hydraulic Conductivity (mm/h or in/h)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Initial Moisture (Fraction)
</td>
<td style="text-align:left;">
Hydraulic Conductivity (mm/h or in/h)
</td>
<td style="text-align:left;">
Initial Loss Rate (<span class="math inline">\(f_0\)</span>) (mm/h or in/h)
</td>
<td style="text-align:left;">
Continuing Loss (mm/h or in/h)
</td>
<td style="text-align:left;">
<strong>Porosity (Fraction)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Max Ponding Depth (m or ft)
</td>
<td style="text-align:left;">
Porosity (Fraction)
</td>
<td style="text-align:left;">
Final Loss Rate (<span class="math inline">\(f_c\)</span>) (mm/h or in/h)
</td>
<td style="text-align:left;">
Porosity (Fraction)
</td>
<td style="text-align:left;">
<strong>Initial Moisture (Fraction)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h)</strong>
</td>
<td style="text-align:left;">
Initial Moisture (Fraction)
</td>
<td style="text-align:left;">
Exponential Decay Rate (k) (h-1 )
</td>
<td style="text-align:left;">
Initial Moisture (Fraction)
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h)</strong>
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Max Ponding Depth (m or ft)
</td>
<td style="text-align:left;">
Porosity (Fraction)
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h)</strong>
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h)</strong>
</td>
<td style="text-align:left;">
Initial Moisture (Fraction)
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<strong>Horizontal Hydraulic Conductivity (mm/h or in/h)</strong>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<h5 class="hasAnchor" id="HPC-soil-type-5"><span class="header-section-number">7.4.5.1.2</span> Soil Type<a href="#HPC-soil-type-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Setting the soil type for the groundwater layers activates the given layer. The Green-Ampt, Horton and Initial/Continuing Loss infiltration methods can be used for Layer 1. Any layers beneath Layer 1 (e.g. Layer 2, Layer 3) must be the Convective Type. For example, setting the soil type for layers 1 and 2 will activate 2 vertical groundwater layers:</p>
<p><tcmd><a href="#tgcSetSoil">Set Soil Layer 1</a></tcmd> <teq>==</teq> <tblk>1</tblk> <tgrn>! soil ID of infiltration layer e.g. GA type</tgrn><br />
<tcmd><a href="#tgcSetSoil">Set Soil Layer 2</a></tcmd> <teq>==</teq> <tblk>5</tblk> <tgrn>! soil ID of a convective layer e.g. CO type</tgrn></p>
<p>Multiple layers can be set simultaneously (the below will activate 3 interflow layers):</p>
<p><tcmd><a href="#tgcSetSoil">Set Soil Layer 1</a></tcmd> <teq>==</teq> <tblk>1</tblk><br />
<tcmd><a href="#tgcSetSoil">Set Soil Layer 2,3</a></tcmd> <teq>==</teq> <tblk>5</tblk> <tgrn>! sets both layers 2 and 3 to Soil ID 5</tgrn></p>
<p>This method also works for read GIS and Grid commands:</p>
<p><tcmd><a href="#tgcReadGISSoil">Read GIS Soil Layer 1</a></tcmd> <teq>==</teq> <tblk><span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span></tblk><br />
<tcmd><a href="#tgcReadGridSoil">Read Grid Soil Layer 2</a></tcmd> <teq>==</teq> <tblk><span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span></tblk></p>
<p>A maximum of 10 vertical layers is permitted and a soil ID should be assigned for each active layer. For example, if groundwater layer 2 is active, then soil IDs for layer 1 should be assigned. Note, if the layer number is not specified in a .tgc command (e.g. Set Soil), it is assumed to be layer 1.</p>
<h5 class="hasAnchor" id="soil-thickness"><span class="header-section-number">7.4.5.1.3</span> Soil Thickness<a href="#soil-thickness" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The depth (thickness) of each vertical interflow layer can be set using the following commands:</p>
<p><tcmd>[<a href="#tgcSetSoilThickness">Set</a> | <a href="#tgcReadGISSoilThickness">Read GIS</a> | <a href="#tgcReadGridSoilThickness">Read Grid</a>] Soil Thickness Layer N</tcmd> <teq>==</teq> <tblk>[value | <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span>]</tblk><br />
<tcmd>[<a href="#tgcSetSoilBase%20Elevation">Set</a> | <a href="#tgcReadGISSoilBase%20Elevation">Read GIS</a> | <a href="#tgcReadGridSoilBase%20Elevation">Read Grid</a>] Soil Base Elevation Layer N</tcmd> <teq>==</teq> <tblk>[value | <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span>]</tblk></p>
<p>If the soil layer thickness or base elevation is not set for a given layer, it is assumed to be infinite. The soil thickness sets the layer depth from the layer above and soil base elevation sets the absolute elevation of the bottom of the layer. If both methods are specified for a given grid cell, the highest of the two will be adopted. The input units should be in metres or feet (if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>).</p>
<h4 class="hasAnchor" id="top-gw-drying-4"><span class="header-section-number">7.4.5.2</span> Drying of Top Groundwater Layer<a href="#top-gw-drying-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Evaporation is typically implemented with a global negative rainfall. Prior to the 2023-03 release this would only remove water in
wet cells until they dry. It would not draw from the cumulative
infiltration layer. The 2023-03 release and onwards allows for negative
rainfall to draw from the topmost groundwater layer under surface layer
cells that are dry, thus mimicking evapotranspiration. Currently only
one approach is implemented, called “factor”, which applies the
defined negative rainfall, though at a (globally) factored rate. To select
this approach use the <a href="#tcfSoilNegativeRainfallApproach">Soil Negative Rainfall Approach</a> .tcf command.</p>
<p>The default approach is to not apply any negative rainfall to the
topmost groundwater layer. If the “factor” method is selected, then the
factor can be set using the <a href="#tcfSoilNegativeRainfallFactor">Soil Negative Rainfall Factor</a> .tcf command.
The default factor is 1, meaning that the full value of the negative
rainfall is applied. If the topmost groundwater layer is dry, then no
negative rainfall is applied, and the approach does not look any further
than the topmost layer. No water is drawn from subsequent ground water
layers.</p>
<h3 class="hasAnchor" id="NN-3"><span class="header-section-number">7.4.6</span> Non-Newtonian Flow<a href="#NN-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC supports modelling of non-Newtonian fluids. The non-Newtonian flow theory, and an example of its use in TUFLOW is discussed in the <a href="https://www.youtube.com/watch?v=MeDQ35zTexU&amp;t=2159s">Tsunami and Dam Failure and non-Newtonian Modelling AWS Webinar</a>. This feature was introduced in the 2020-01 release. It is not supported in TUFLOW Classic. High-fidelity modelling of non-Newtonian fluids is complex and 3D in nature. However, with some assumptions, it is possible to model non-Newtonian fluids reasonably well in 2D. The assumptions are:</p>
<ol style="list-style-type: decimal">
<li>The 2D (horizontal) viscosity can be represented as a summation of
laminar (derivative of non-Newtonian shear stress model) and
turbulent (from Wu eddy viscosity model) contributions.<br />
</li>
<li>Acceleration effects are small and the laminar fluid shear stress is
linear with depth.<br />
</li>
<li>The bed shear stress can be represented as a summation of laminar
(from non-Newtonian shear stress model) and turbulent (from Manning’s
equation) contributions.</li>
</ol>
<p>The laminar fluid shear stress (for flow that is shearing), is assumed to
follow the Hershel-Bulkley power law model:</p>
<p><span class="math display" id="eq:equ-powerlaw">\[\begin{equation}
\tau = \tau_{0} + k{\dot{\gamma}}^{n}
\tag{48}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\tau_{0}\)</span> = Yield shear stress of the fluid.<br />
</li>
<li><span class="math inline">\(k\)</span> = Viscosity parameter (units Pa.s<sup>n</sup>)<br />
</li>
<li><span class="math inline">\(\dot{\gamma}\)</span> = Shear strain rate of the fluid<br />
</li>
<li><span class="math inline">\(n\)</span> = Power law exponent (1 = Newtonian, &lt;1 is shear thinning, &gt;1 is
shear thickening)</li>
</ul>
<p>For flows where the bed shear stress exceeds the yield stress, a ‘plug
flow’ velocity profile is computed, as shown in Figure <a href="#fig:fig-NN-plug-flow">73</a>. For flows where the bed shear stress does not exceed the yield stress, the fluid is considered locked to the bed and does not flow. Within TUFLOW HPC, at the start of each timestep, a bed stress is
calculated for each cell such that the predicted velocity profile (for
the given bed shear stress) has a depth averaged mean velocity that
matches the current model velocity.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-NN-plug-flow"></span>
<img src="images/NN-plug-flow.png" alt="Non-Newtonian Shear Stress and Velocity Profile"  />
<p class="caption">
Figure 73: Non-Newtonian Shear Stress and Velocity Profile
</p>
</div>
<p>Note that for fluids with a low viscosity parameter, or for deep and/or
faster flows, the bed friction that would arise through the use of
Manning’s equation (which is based on turbulent water flow) can be equal
to or greater than that from the Hershel-Bulkley equation. In this
situation the mathematics is stating that the non-Newtonian flow is
likely to be turbulent and behaving more like water, and the bed shear
stress as computed by the Hershel-Bulkley powerlaw model is likely to be
lower than what is occurring in reality. To account for this transition
in a simple manner, the actual bed friction used is the sum of both
non-Newtonian and Manning’s contributions (note the <em>n</em> in the final term
on the righthand side of the following equation is Manning’s n, not the
Hershel-Bulkley power law exponent):</p>
<p><span class="math display" id="eq:equ-NN-friction">\[\begin{equation}
\tau = \tau_{0} + k{\dot{\gamma}}^{n} + \frac{\rho gn^{2}|U|^{2}}{d^{\frac{1}{3}}}
\tag{49}
\end{equation}\]</span></p>
<p>This provides a very stable and smooth transition from non-Newtonian bed
shear stress to turbulent water-like bed shear stress as and when
needed. The total shear stress is then utilised in the momentum equation
to evolve the flow velocity. The momentum equation also considers the
possibility that the fluid yield stress is sufficient to hold the fluid
against the net momentum flux, in which case the fluid velocity is
zeroed.</p>
<p>For the computation of 2D shear stresses, the yield shear stress is not
used and the fluid is allowed to continue shearing down to low shear
strain rates and correspondingly low shear stresses. The effective
Non-Newtonian 2D viscosity is computed using the derivative of the
Hershel-Bulkley equation:</p>
<p><span class="math display" id="eq:equ-HB-visc">\[\begin{equation}
\mu_{2D} = kn\left| \dot{\gamma} \right|^{n - 1}\\

\left| \dot{\gamma} \right| =
\max\left( \frac{2|U|}{d},\sqrt{\left( \frac{du}{dx} \right)^{2} + \left( \frac{dv}{dy} \right)^{2} + \frac{1}{2}\left( \frac{du}{dy} + \frac{dv}{dx} \right)^{2}} \right)

\tag{50}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\left| \dot{\gamma} \right|\)</span> = Magnitude of shear strain rate</li>
</ul>
<p>Since the <span class="math inline">\(n - 1\)</span> exponent can cause the viscosity to diverge to
infinity at low strain rates for shear thinning fluids, it necessary to
bound the resulting viscosity to a user defined upper limit,
<span class="math inline">\(\mu_{high}\)</span>. For completeness a user defined lower limit, <span class="math inline">\(\mu_{low}\)</span>,
is also applied.</p>
<p>Finally, for deeper and high velocity flows it is possible that the
effective 2D viscosity of turbulent water, as computed by the Wu
turbulence model, is greater than the value computed from the
Hershel-Bulkey powerlaw model. Again, in this situation the mathematics
is stating the non-Newtonian flow is likely to be turbulent and behaving
more like water. To account for this transition the
actual 2D viscosity used is the sum of both non-Newtonian and Wu
turbulence model contributions:</p>
<p><span class="math display" id="eq:equ-actual-visc">\[\begin{equation}
\nu_{T} = \frac{\mu_{2D}}{\rho} + 7U^{*}d
\tag{51}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(U^{*}\)</span> = Friction velocity = <span class="math inline">\(\frac{\sqrt{g}\ n|U|}{d^{\frac{1}{6}}}\)</span></li>
</ul>
<p>This provides a very stable and smooth transition from non-Newtonian 2D
viscosity to turbulent water-2D viscosity as and when needed. The value
of 7 is the default Wu viscosity parameter and is not user-definable for
the non-Newtonian module.</p>
<h4 class="hasAnchor" id="Implementation-4"><span class="header-section-number">7.4.6.1</span> Implementation<a href="#Implementation-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The non-Newtonian flow model is invoked with the <a href="#tcfViscosityFormulation">Viscosity Formulation</a> command in the .tcf. If
invoked there are no default values for the required coefficients (<span class="math inline">\(k\)</span>,
<span class="math inline">\(n\)</span>, <span class="math inline">\(\mu_{low}\)</span>, <span class="math inline">\(\mu_{high}\)</span>, <span class="math inline">\(\tau_{0}\)</span>). These must be supplied with
the <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> command, where:</p>
<ul>
<li><span class="math inline">\(k\)</span>: viscosity coefficient (Pa.s^n)</li>
<li><span class="math inline">\(n\)</span>: shear thickening exponent, must be non zero and positive (shear thinning fluids exhibit <span class="math inline">\(n\)</span> &lt; 1, shear thickening <span class="math inline">\(n\)</span> &gt; 1, and Newtonian fluids <span class="math inline">\(n\)</span> = 1)</li>
<li><span class="math inline">\(\mu_{low}\)</span>: lower viscosity limit (Pa.s)</li>
<li><span class="math inline">\(\mu_{high}\)</span>: higher viscosity limit (Pa.s)</li>
<li><span class="math inline">\(\tau_{0}\)</span>: shear yield stress (Pa)</li>
</ul>
<p>A step-by-step example of how to set up a non-Newtonian model is provided in <a href="https://wiki.tuflow.com/Tutorial_M10#Part_5_-_Non-Newtonian">Tutorial 5</a> on the TUFLOW Wiki. Additionally, an example model is provided in the non-Newtonian section of the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Solver_Options">TUFLOW Wiki Example Models</a>.</p>
<p><strong>Note</strong>: In TUFLOW HPC the 2D momentum diffusion is handled explicitly and
therefore can drive the model timestep to small values when the
viscosity becomes large. Therefore, for shear thinning models, it is
important to define an upper limit, <span class="math inline">\(\mu_{high}\)</span>, that is only as large
as necessary. We suggest starting with 1,000 Pa.s and adjusting
lower if the model is being strongly controlled by the diffusion control
number (Nd). Sensitivity testing should be done to test whether the upper
viscosity limit is influencing results in the region of interest. The
lower viscosity limit, <span class="math inline">\(\mu_{low}\)</span>, may be set to zero if desired.</p>
<h4 class="hasAnchor" id="NN-Mix-4"><span class="header-section-number">7.4.6.2</span> Non-Newtonian Mixing<a href="#NN-Mix-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is possible to consider mixing of the non-Newtonian fluid with water, for example a tailings dam failure into a flowing river. To implement
this, a passive AD tracer must be included in the model, note that this requires a
licence for the <a href="#ADModule-4">Advection-Dispersion (AD) Module</a>. The AD setup is the same as detailed in Chapter <a href="#AD-1"><strong>??</strong></a>. More
than one tracer field is permissible, but the non-Newtonian mixing
calculation will assume that the first tracer represents the fraction of
non-Newtonian fluid, in the range 0 to 1. Care must be taken to ensure
that boundary data and initialisation commands strictly adhere to this
range. Where the tracer value is 1, the properties of the fluid will be
exactly the non-Newtonian properties, as specified with <a href="#tcfViscosityCoefficient">Viscosity Coefficient</a> command, where the tracer value is 0 the fluid will behave as water. For tracer values between 0 and 1, the non-Newtonian properties are blended with those of water using a power-law equation.</p>
<p><span class="math display" id="eq:equ-NN-mixing">\[\begin{equation}
\xi = a^{m} \\

\rho&#39; = (1 - \xi)\rho_{w} + \xi\rho_{NN} \\

K&#39; = (1 - \xi)\mu_{w} + \xi K_{NN} \\

n&#39; = (1 - \xi)1.0 + \xi n_{NN} \\

\tau_{0}&#39; = \xi\tau_{0,NN} \\
\tag{52}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(a\)</span> = the tracer value (0~1)<br />
</li>
<li><span class="math inline">\(m\)</span> = the non-Newtonian mixing exponent<br />
</li>
<li><span class="math inline">\(\rho\)</span> = density of fluid (kg/m<sup>3</sup>)<br />
</li>
<li><span class="math inline">\(\mu\)</span> = dynamic viscosity (Pa.s)<br />
</li>
<li><span class="math inline">\(K\)</span> = the Hershel-Bulkley viscosity parameter (Pa s<em><sup>n</sup></em>)<br />
</li>
<li><span class="math inline">\(n\)</span> = the Hershel-Bulkley powerlaw exponent<br />
</li>
<li><span class="math inline">\(\tau_{0}\)</span> = the material yield stress (Pa)<br />
</li>
<li>subscripts <span class="math inline">\(w\)</span> denotes water, <span class="math inline">\(NN\)</span> denotes undiluted non-Newtonian
fluid<br />
</li>
<li>superscript <span class="math inline">\(‘\)</span> denotes blended value to use in the Hershel-Bulkley
powerlaw model</li>
</ul>
<p>The bed friction and 2D viscosity are computed using the non-Newtonian
method with the blended parameters. To turn on the mixing calculation,
the mixing exponent, <span class="math inline">\(m\)</span>, must be specified with the
<a href="#tcfNon-NewtonianMixingExponent">Non-Newtonian Mixing Exponent</a> command. It is
user’s responsibility to source the non-Newtonian parameters that
represent the undiluted mud, and also to source an appropriate value for
the non-Newtonian mixing exponent, <span class="math inline">\(m\)</span>. This value must be within the
range 1 to 5.</p>
<p>To utilise non-Newtonian mixing in a model, the following is required:</p>
<ol style="list-style-type: decimal">
<li>Select the non-Newtonian viscosity formulation and specify the coefficients for pure non-Newtonian fluid:<br />
<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a></tcmd> <teq>==</teq> <tblk>Non-Newtonian</tblk><br />
<tcmd><a href="#tcfViscosityCoefficient">Viscosity Coefficient</a></tcmd> <teq>==</teq> <tblk>k, n, muLow, muHigh, tau0</tblk><br />
</li>
<li>Include a passive tracer as per standard AD setup (Chapter <a href="#AD-1"><strong>??</strong></a>), making sure boundary data and initialisation are scaled in range 0 to 1.<br />
</li>
<li>Specify the mixing exponents, <em>m</em>, <em>o</em>, and <em>p</em> to be used:<br />
<tcmd><a href="#tcfNon-NewtonianMixingExponent">Non-Newtonian Mixing Exponent</a></tcmd> <teq>==</teq> <tblk>&lt;float&gt; | {0} </tblk><tgrn>! used for all three of <em>m</em>, <em>o</em>, <em>p</em> exponents </tgrn> <br>
or <br>
<tcmd><a href="#tcfNon-NewtonianMixingExponent">Non-Newtonian Mixing Exponent</a></tcmd> <teq>==</teq> <tblk>&lt;float&gt;, &lt;float&gt;, &lt;float&gt; | {0, 0, 0} </tblk><tgrn>! <em>m</em>, <em>o</em>, <em>p</em> exponents</tgrn></li>
</ol>
<p>Note that if the non-Newtonian mixing exponent is not specified it defaults to zero which turns the mixing formulation off, and all fluid in the model will be treated as non-Newtonian regardless of tracer value.</p>
<p>An example non-Newtonian mixing model is provided in the non-Newtonian section of the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Solver_Options">TUFLOW Wiki Example Models</a>.</p>
<h3 class="hasAnchor" id="HPC-Unsupported-3"><span class="header-section-number">7.4.7</span> Unsupported Features in TUFLOW HPC<a href="#HPC-Unsupported-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following features are not supported in TUFLOW HPC:</p>
<ul>
<li>Multiple 2D Domain (Section <a href="#CLA-2D2D-3"><strong>??</strong></a>): This feature has been superseded by the TUFLOW HPC Quadtree functionality (Section <a href="#Quadtree-3"><strong>??</strong></a>).</li>
<li>2D Flow Constrictions (2d_fcsh and 2d_fc) (Section <a href="#CLA-FC-4"><strong>??</strong></a>): This feature has been superseded by the 2d Bridge (2d_bg) (Section <a href="#bg-layer-4"><strong>??</strong></a>) and Layered Flow Constriction (2d_lfcsh) (Section <a href="#lfcsh-4"><strong>??</strong></a>) features.</li>
<li>Coriolis Force (Section <a href="#CLA-Coriolis-3"><strong>??</strong></a>): The inclusion of the Coriolis term in the shallow water equations is possible with TUFLOW Classic only.</li>
<li>Chézy and Fric options: TUFLOW HPC only supports Manning’s n bed resistance values (Section <a href="#CLA-mat-3"><strong>??</strong></a>).</li>
</ul>
<h2 class="hasAnchor" id="tuflow-classic-specific"><span class="header-section-number">7.5</span> TUFLOW Classic Specific<a href="#tuflow-classic-specific" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section describes functionality unique to TUFLOW Classic.</p>
<h3 class="hasAnchor" id="CLA-Turbulence-3"><span class="header-section-number">7.5.1</span> Classic Turbulence<a href="#CLA-Turbulence-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For TUFLOW Classic, two options exist (Constant and Smagorinsky) for specifying eddy viscosity for the 2D domains to approximate the effect of sub-grid-scale turbulence. For TUFLOW Classic, the Smagorinsky approach (Section <a href="#CLA-Smagorinsky-4"><strong>??</strong></a>) is the default approach.</p>
<h4 class="hasAnchor" id="CLA-Constant-4"><span class="header-section-number">7.5.1.1</span> Constant<a href="#CLA-Constant-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Constant approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity Formulation</a> </tcmd><teq>==</teq><tblk> CONSTANT</tblk>)
applies a constant value throughout the model, irrespective of velocity
gradients and variations. This is generally satisfactory when the bed
resistance is dominant or when modelling large ocean basins (in which
case the recommended coefficient for the constant formulation is 1
m<sup>2</sup>/s), but is not recommended for riverine flow paths.</p>
<h4 class="hasAnchor" id="CLA-Smagorinsky-4"><span class="header-section-number">7.5.1.2</span> Smagorinsky<a href="#CLA-Smagorinsky-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW’s Smagorinsky approach (<tcmd><a href="#tcfViscosityFormulation">Viscosity
Formulation</a> </tcmd><teq>==</teq><tblk> SMAGORINSKY</tblk>) applies a hybrid method that includes elements of both the Constant and Smagorinsky approaches, as given by the equation below. This formulation is better than the CONSTANT option, as the eddy viscosity is
recalculated every timestep at every cell mid-side according to the
change in velocity magnitude and direction. This results in higher
coefficients being applied where there is greater turbulence.</p>
<p>However, this approach has two known limitations:</p>
<ol style="list-style-type: decimal">
<li>It assumes that all turbulent kinetic energy with length scales greater than the
cell size is resolved within the velocity field. This assumption is
reasonable when the 2D cell size is larger than the physical depth of the
flow, but becomes incorrect when the 2D cell size is smaller than
the depth of the flow – turbulence in the vertical direction contributes
significantly to viscosity but is not resolved in the 2D velocity field.
As a result, once the 2D cell size becomes smaller than the flow depth
this approach can underpredict the viscosity, and therefore can underpredict
momentum coupling from river to flood plain.<br />
</li>
<li>It assumes that the physical length scales of the sub-grid turbulence scale with
the 2D cell size. This is reasonable when the 2D cell size is similar to
the depth of the flow, but becomes incorrect when the 2D cell size
becomes significantly larger than the depth of the flow – the bed
resistance and the finite depth of the flow prevent large scale
turbulence. As a result, once the 2D cell size becomes much larger than
the depth of the flow, the Smagorinsky turbulence model can overpredict the
viscosity, and therefore can overpredict the momentum coupling from river
to flood plain.</li>
</ol>
<p>The result of these two limitations, is that model results display some
sensitivity to the 2D cell size. The Wu formulation (Section <a href="#Wu-4"><strong>??</strong></a>)
has proven to be more capable in its ability to provide “out of the box”
calibration and reduced sensitivity of model results to 2D cell size.</p>
<p>Note, if the formulation is changed, the user must also reset the
coefficient using the command
<a href="#tcfViscosityCoefficient">Viscosity Coefficient</a>. <!--EFC to PAR: Just did a quick test and it looks like TUFLOW automatically updates the coefficients when changing formulation. Can this sentence be deleted. It's a bit confusing--></p>
<p>The Smagorinsky option remains the default when using TUFLOW
Classic. The default viscosity coefficients are a Smagorinsky value of
0.5 plus a constant value of 0.05 m<sup>2</sup>/s. The 0.5 Smagorinsky
coefficient is dimensionless. The viscosity coefficient can be output
using the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command.</p>
<p>The hybrid Smagorinsky formulation used by TUFLOW is:</p>
<p><span class="math display" id="eq:equ-smag">\[\begin{equation}
𝜐 = C_{c} + C_{s}A_{c}\sqrt{\left( \frac{\partial u}{\partial x} \right)^{2} + \left( \frac{\partial v}{\partial y} \right)^{2} + {\frac{1}{2}\left( \frac{|\partial u|}{\partial y} + \frac{|\partial v|}{\partial x} \right)}^{2}}
\tag{42}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(u\ and\ v = \ \)</span>Depth averaged velocity components in the X and Y
directions<br />
</li>
<li><span class="math inline">\(x\ and\ y = \ \)</span>Distance in the X and Y direction<br />
</li>
<li><span class="math inline">\(\nu = \ \)</span>Horizontal diffusion of momentum (viscosity) coefficient,
m<sup>2</sup>/s or ft<sup>2</sup>/s<br />
</li>
<li><span class="math inline">\(A_{c} = \ \)</span>Area of Cell<br />
</li>
<li><span class="math inline">\(C_{\ c} = \ \)</span>Constant Coefficient (default = 0.05 m<sup>2</sup>/s)<br />
</li>
<li><span class="math inline">\(C_{s} = \ \)</span>Smagorinsky Coefficient (dimensionless, default = 0.5)</li>
</ul>
<h3 class="hasAnchor" id="CLA-US-Controlled-3"><span class="header-section-number">7.5.2</span> 2D Upstream Controlled Flow (Weirs and Supercritical Flow)<a href="#CLA-US-Controlled-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Where flow in the 2D domain becomes upstream controlled, TUFLOW Classic automatically switches between either weir flow or upstream controlled friction flow.</p>
<p>If <a href="#tcfSupercritical">Supercritical</a> is set to ON (the default), the following rules apply.</p>
<ul>
<li>Where the bed slope at a ZU or ZV point is in the same direction as
the water surface slope, tests are carried out to determine whether
the flow is upstream controlled or downstream controlled. The adopted
flow regime is determined by comparing the upstream and downstream
controlled regime flows (preference to the lower flow) and whether the
Froude number exceeds 1 (unless changed by <a href="#tcfFroudeCheck">Froude
Check</a>). The equation used for upstream controlled
flow is the Manning equation, with the water surface slope set to the
bed slope. This check can be disabled for backward compatibility using
<a href="#tcfFroudeDepthAdjustment">Froude Depth Adjustment</a>.<br />
</li>
<li>Weir flow only occurs if the bed slope is adverse (different
direction) to the water surface slope. Weir flow across 2D cell sides
is modelled by first testing whether the flow is upstream or
downstream controlled. If upstream controlled, the broad-crested weir
flow equation is used to replace the calculations for downstream
controlled (sub-critical) flow conditions. Weir flow can be switched
off using the <a href="#tcfFreeOverfall">Free Overfall</a> options.</li>
</ul>
<p>Note: the bed slope at ZU and ZV points is determined as the slope from the upstream ZC point to the ZU or ZV point in the direction of positive flow.</p>
<p>TUFLOW produces an increase in water level at transitions from
supercritical flow to subcritical flow, as occurs with a hydraulic jump.
It does not, however, model the complex 3D flow patterns that occur at a
hydraulic jump, as it uses a 2D horizontal plane solution. Results in
areas of transition should be interpreted with caution. It is also
important to be careful presenting results in areas of supercritical
flow, as complex localised flow interactions may occur that would yield higher localised water levels (such as supercritical flow surcharging against a building) – it is good practice to also view the energy levels when providing advice on flood planning levels.</p>
<p>If <a href="#tcfSupercritical">Supercritical</a> is set to OFF, and <a href="#tcfFreeOverfall">Free
Overfall</a> is set to ON (the default), weir flow may
occur on both adverse and normal bed slopes.</p>
<p>The weir flow switch may be adjusted globally using the .tcf command
<a href="#tcfGlobalWeirFactor">Global Weir Factor</a>. It can also be varied
spatially over the grid by setting a weir factor of zero where there is
to be no automatic weir calculations using <a href="#tgcReadGIS">Read GIS WrF</a>.
The weir factor also allows calibration or adjustment where the
broad-crested weir equation is applied. The weir factor is not the
broad-crested weir coefficient. The broad-crested weir equation is
divided by the weir factor. Therefore, a factor of 1.0 represents no
adjustment, while a factor greater than one will decrease the flow
efficiency. Refer to <span class="citation">Syme (<a href="#ref-Syme2001b">2001b</a>)</span> for further information.</p>
<p><strong>Note, the global weir factor and the spatially varying value are
multiplied together (i.e. one does not replace the other).</strong></p>
<p>The .tcf command <a href="#tcfHXForceWeirEquation">HX Force Weir Equation</a> can
be used to force the weir flow equation to be applied across all active
HX cell sides when the flow is upstream controlled. Note, the
default approach uses either weir flow or super-critical flow when the
flow is upstream controlled, depending on whether the ground surface
gradient from HX cell centre to cell side is adverse (weir flow) or not
adverse (super-critical flow). When the flow is downstream controlled,
regardless of the ground surface slope, the full 2D equations are
applied, including allowance for momentum across the HX 1D/2D link.</p>
<h3 class="hasAnchor" id="CLA-mat-3"><span class="header-section-number">7.5.3</span> Land Use (Materials)<a href="#CLA-mat-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For TUFLOW Classic, bed resistance can be set to Manning’s n, Manning’s M (1/n) or Chezy using the <a href="#tcfBedResistanceValues">Bed Resistance Values</a> command in the .tcf file. Chezy can be specified as a direct value or by bed ripple heights (using the <a href="#tgcSetFRIC">Set FRIC</a>, <a href="#tgcReadGISFRIC">Read GIS FRIC</a>, <a href="#tgcReadGridFRIC">Read Grid FRIC</a> commands). The default and recommended bed resistance formulation is Manning’s n. Manning’s n values can also be varied with depth, the VxD product or varied with depth using the Log Law formula (see Section <a href="#Materials-2"><strong>??</strong></a>).</p>
<p>If using the Chezy formula, a number of commands have been setup to provide backward compatibility. These are <a href="#tcfDepthRippleHeightFactorLimit">Depth/Ripple Height Factor Limit</a> and <a href="#tcfRecalculateChezyInterval">Recalculate Chezy Interval</a>.</p>
<!--EFC to PAR: I've pulled the above out of the common section. What additional should be added? Is the 'Fric' option Manning's M?

The Fric option is related to the Chezy option (if set to chezy then can specify the fric commands)-->
<h3 class="hasAnchor" id="CLA-2D2D-3"><span class="header-section-number">7.5.4</span> Multiple 2D Domain<a href="#CLA-2D2D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- PAR to EFC the m2d link QDTorM2DModule-4 didn't work for me, does it work for you?-->
<!--fixed-->
<p>When using TUFLOW Classic with the Multiple 2D Domain Module (see Section <a href="#QDTorM2DModule-4"><strong>??</strong></a>), any number of 2D domains of different cell size and orientation can be combined to form one model. This TUFLOW Classic feature is discussed in Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="CLA-Coriolis-3"><span class="header-section-number">7.5.5</span> Coriolis Term<a href="#CLA-Coriolis-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When using TUFLOW Classic, it is possible to include the Coriolis term in the shallow water equations (equations <a href="#eq:equ-x-momentum">(35)</a> and <a href="#eq:equ-y-momentum">(36)</a>). To enable this functionality, use the <a href="#tcfLatitude">Latitude</a> command.</p>
<h3 class="hasAnchor" id="legacy-structures"><span class="header-section-number">7.5.6</span> Legacy Structures<a href="#legacy-structures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following features are considered legacy structures and are supported by TUFLOW Classic only. It is recommended, and preferred, to use the layered flow constriction shape (Section <a href="#lfcsh-4"><strong>??</strong></a>) instead, which is supported by both TUFLOW Classic and TUFLOW HPC. To convert from the flow constriction (2d_fc or 2d_fcsh) to the layered flow constriction (2d_lfcsh), refer to the discussion published in the <a href="https://wiki.tuflow.com/TUFLOW_2D_Hydraulic_Structures#How_to_best_convert_flow_constriction_data_.282d_fc_or_2d_fcsh.29_into_newer_formats_.282d_lfcsh_or_2d_bg.29.3F">TUFLOW Wiki</a>.</p>
<h4 class="hasAnchor" id="CLA-FC-4"><span class="header-section-number">7.5.6.1</span> 2D Flow Constrictions (2d_fcsh and 2d_fc)<a href="#CLA-FC-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Flow Constriction (FC) attributes allow the user to constrict the flow
across a 2D cell side as a way to define hydraulic structures, such as bridges and banks of box culverts, within a model. 2D cell sides
can be modified in the following ways:</p>
<ul>
<li>Placing a lid (obvert or soffit) on the cell side.<br />
</li>
<li>Changing the flow width of the cell side.<br />
</li>
<li>Adding additional form (energy) losses.<br />
</li>
<li>Including side wall friction (“BC” FC_Type only).</li>
</ul>
<p>Flow constrictions can be digitised within GIS layers and read into the
.tgc file using the command <a href="#tgcReadGISFCShape">Read GIS FC Shape</a>. This
command is recommended over the previous (and now outdated) <a href="#tcfReadGISFC">Read GIS
FC</a>.</p>
<p>Table <a href="#tab:tab-ConstrictionShape">71</a> describes the different 2d_fcsh layer attributes as used by
<a href="#tgcReadGISFCShape">Read GIS FC Shape</a>. If <a href="#tcfWriteCheckFiles">Write Check
Files</a> is set in the .tcf then the
<a href="http://wiki.tuflow.com/Check_Files_2d_fcsh_uvpt">_fcsh_uvpt_check</a>
file will be created to allow you to cross-check that the changes to the
cell-sides are as intended. The
<a href="http://wiki.tuflow.com/Check_Files_2d_fcsh_uvpt">_fcsh_uvpt_check</a>
file contains information on the cell sides modified by the <a href="#tgcReadGISFCShape">Read GIS FC
Shape</a> command. Details on the properties at ALL cell
sides can be found in the
<a href="http://wiki.tuflow.com/Check_Files_2d_uvpt">_uvpt_check</a>
file.</p>
<p>Point objects associated with the 2d_fcsh layer can be placed in a
separate layer. In this case, only the first two attributes are
required. This is discussed in Section <a href="#point-only-5"><strong>??</strong></a>.</p>
<p>The original <a href="#tcfReadGISFC">Read GIS FC</a> feature continues to be supported and its attributes are documented in Table <a href="#tab:tab-FlowConstriction">72</a>. Floating pontoons should always be modelled using 2d_fc layers. If any 2d_fc inputs are included in the model and <a href="#tcfWriteCheckFiles">Write Check Files</a> is set, then the <a href="http://wiki.tuflow.com/Check_Files_2d_fc">_fc_check</a> file will be created.</p>
<p>Please note, overlapping flow constriction inputs are not supported.</p>
<table>
<caption>
<span id="tab:tab-ConstrictionShape">Table 71: </span><strong>Flow Constriction Shape (2d_fcsh) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Invert
</td>
<td style="text-align:left;">
<p>Invert of constriction. Using metric units (default) the value is metres above the elevation datum . Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the value is feet above the elevation datum.</p>
To leave the Zpt levels unchanged (i.e. use the existing Zpt elevations), enter a value of 99999.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Obvert_or_BC_Height
</td>
<td style="text-align:left;">
<p>FC_Type:</p>
<ul>
<li>Blank or “BD”: Obvert (soffit) of constriction in m above datum.<br />
</li>
<li>“BC”: Height of box culvert (m).<br />
</li>
<li>“FD”: Floating depth (m) of the deck (i.e. depth below the water line).</li>
</ul>
Enter a sufficiently high value (e.g. 99999) if there is no obvert constriction.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Shape_Width_or_dMax
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line:</b> See same attribute in Table <a href="#tab:tab-ZShapeAttribute">54</a> for 2d_zsh layers.</p>
<b>Polygon:</b> Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Shape_Options
</td>
<td style="text-align:left;">
<p><b>Point:</b> Not used.</p>
<p><b>Line or Polygon:</b></p>
<ul>
<li>MAX, RIDGE or RAISE: Only changes a Zpt (Invert) elevation if the Z Shape elevation at the Zpt is higher.<br />
</li>
<li>MIN, GULLY or LOWER: Only changes a Zpt (Invert) elevation if the Z Shape elevation at the Zpt is lower.</li>
</ul>
<p><b>Line:</b></p>
<ul>
<li>TIN: Indicates the line is to only be used for generation of TINs within polygons (only sections of TIN lines that fall within polygons are used).
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
FC_Type
</td>
<td style="text-align:left;">
The FC_Type.</li>
</ul>
<p>Where:</p>
<ul>
<li>Blank for general (does not include allowances for any vertical walls or friction from underside of deck).<br />
</li>
<li>“BC” for Box Culverts (BC is only available if Manning’s n option is specified in Bed Resistance Values).<br />
</li>
<li>“BD” for Bridge Deck.<br />
</li>
<li>“FD” for Floating Bridge Deck.
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
pBlockage
</td>
<td style="text-align:left;">
The percentage blockage of the cells. For example, if 40 is entered (i.e. 40%), the cell sides are reduced in flow width by 40% (i.e. is set to 0.6 times the full flow width).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
FLC_or_FLCpm_below_Obv
</td>
<td style="text-align:left;">
Form Loss Coefficient (FLC) to be applied below the FC obvert. Used for modelling fine-scale “micro” contraction/expansion losses not picked up by the change in the 2D domain’s velocity patterns (e.g. bridge pier losses, vena-contracta losses, 3rd (vertical) dimension etc.).</li>
</ul>
<p>This parameter should be used as a calibration parameter.</p>
<p><b>Note: So that this attribute is independent of 2D cell size it has different treatment depending on the object it is attached to as follows:</b></p>
<ul>
<li><b>Line:</b> For thin lines, the FLC value is applied to the cell sides unchanged. For thick (whole cell) lines, the FLC value is divided by two (two cell sides in the direction of flow). For wide lines the FLC value is divided by the number of cells across the line (i.e. the line’s width divided by the cell size) and applied to all cell-sides.<br />
</li>
<li><b>Polygon:</b> FLC is the form loss per metre length (in the predominant direction of flow). FLC values are not dependent on the flow width, but are on the length of travel in the direction of flow.</li>
</ul>
<p><b>However, if a negative FLC value is specified, the absolute value is taken and applied unadjusted to all cell-sides affected by the shape. Note, this is not cell size independent, therefore if the 2D cell size is changed, this attribute also needs to be changed.</b></p>
<p>The form loss coefficient is applied as an energy loss based on the dynamic head equation below where <span class="math inline">\(\displaystyle \zeta_{a}\)</span> is the FLC value.</p>
<span class="math display">\[\Delta h = \zeta_{a}\:\frac{V^2}{2g}\]</span>
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
FLC_or_FLCpm_above_Obv
</td>
<td style="text-align:left;">
Form Loss Coefficient (FLC) to be applied above the FC obvert. See FLC_below_Obvert attribute above for more information.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Mannings_n
</td>
<td style="text-align:left;">
<p>For box culverts (BC), the Manning’s n of the culverts (typically 0.011 to 0.015) should be specified. This value prevails over any other bed resistance values irrespective of where in the .tgc file they occur (the exception is if another FC BC object overrides this one). If set to less than 0.001, a default value of 0.013 is used.</p>
<p>For bridge decks (BD), can be used to introduce additional flow resistance once the upstream water level reaches the bridge deck obvert (or soffit).</p>
<p>For floating decks (FD) this is always the case as the deck soffit is permanently submerged. The additional flow resistance is modelled as an increase in bed resistance by increasing the wetted perimeter at the cell mid-side by a factor equal to (2.*Bed_n)/FC_n. For example, if the FC Manning’s n and the bed Manning’s n values are the same, the wetted perimeter is doubled, thereby reducing the conveyance and increasing the resistance to flow. This parameter can be used as a calibration parameter to fine-tune the energy losses across a bridge or floating structure.</p>
Ignored for blank FC_Type.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
BC_Width
</td>
<td style="text-align:left;">
<p>The width of one BC culvert barrel in metres. For example, if there are 10 x 1.8metre wide culverts in a bank, enter a value of 1.8. Using metric units (default) the value is in metres. Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the value is in feet.</p>
Applicable to BC FC_Type only. Not used by other types of FCs.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-FlowConstriction">Table 72: </span><strong>Flow Constriction (2d_fc) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
<p>Secondary flag identifier where:</p>
<ul>
<li>Blank for general (does not include allowances for any vertical walls or friction from underside of deck).<br />
</li>
<li>“BC” for Box Culverts (BC is only available if Manning’s n option is specified in Bed Resistance Values).<br />
</li>
<li>“BD” for Bridge Deck.<br />
</li>
<li>“FD” for Floating Bridge Deck.
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Invert
</td>
<td style="text-align:left;">
Invert of constriction (m above datum).</li>
</ul>
<p>Mandatory for box culverts (type = “BC”).</p>
If not a box culvert, and you wish to leave the Zpt levels unchanged (i.e. use the existing Zpt elevations), enter a value greater than the obvert level (see next attribute).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Obvert_or_BC_height
</td>
<td style="text-align:left;">
<p>Type:</p>
<ul>
<li>Blank or “BD”: Obvert of constriction (m above datum)<br />
</li>
<li>“BC”: Height of box culvert (m). Values less than 0.01 are set to 0.01.<br />
</li>
<li>“FD”: Floating depth (m) of the deck (i.e. depth below the water line).</li>
</ul>
<p>Enter a sufficiently high value (e.g. 99999) if there is no obvert constriction.</p>
If using <a href="#tcfUnits">Units</a> <teq>==</teq><tblk> US Customary</tblk>, the height unit is in feet.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
u_width_factor
</td>
<td style="text-align:left;">
Flow width constriction factor in the X-direction (i.e. the flow width perpendicular to the X-direction). For example, a value of 0.6 sets the flow width at the left hand and right-hand sides of the cell to 60% of the cell width. Values less than 0.001 are set to 1. Use a value of 1.0 to leave the flow width unchanged. Values greater than 1 can be specified.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
v_width_factor
</td>
<td style="text-align:left;">
Width constriction factor in the Y-direction. See description above for u_width_factor.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Add_form_loss
</td>
<td style="text-align:left;">
<p>Form loss coefficient. Used for modelling fine-scale “micro” contraction/expansion losses not picked up by the change in the 2D domain’s velocity patterns (e.g. bridge pier losses, vena-contracta losses, 3<sup>rd</sup> (vertical) dimension etc.).</p>
<p>Can be used as a calibration parameter.</p>
<p>The form loss coefficient is applied as an energy loss based on the dynamic head equation below where <span class="math inline">\(\displaystyle \zeta_{a}\)</span> is the add_form_loss value. The form loss coefficient is applied 50/50 to the right and left sides (u-points) of the cell, and similarly to the v-points.</p>
<span class="math display">\[\Delta h = \zeta_{a}\:\frac{V^2}{2g}\]</span>
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Mannings_n
</td>
<td style="text-align:left;">
<p>For box culverts (BC), the Manning’s n of the culverts (typically 0.011 to 0.015) should be specified. This overwrites any previously specified Manning’s n values at the cell’s mid-sides. If set to less than 0.001, a default value of 0.013 is used.</p>
<p>For bridge decks (BD), can be used to introduce additional flow resistance once the upstream water level reaches the bridge deck obvert or soffit. For floating decks (FD) this is always the case as the deck soffit is permanently submerged. The additional flow resistance is modelled as an increase in bed resistance by increasing the wetted perimeter at the cell’s mid-sides by a factor equal to (2.*Bed_n)/FC_n. For example, if the FC Manning’s n and the bed Manning’s n values are the same, the wetted perimeter is doubled, thereby reducing the conveyance and increasing the resistance to flow. To be used as a calibration parameter to fine-tune the energy losses across a bridge or floating structure.</p>
Ignored for “Blank” type FC.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
No_walls_or_neg_width
</td>
<td style="text-align:left;">
<p>Number of vertical walls per grid cell. If set to zero (between 0.001 and 0.001) one vertical wall per cell is used. A non-integer value can be specified.</p>
<p>Alternatively, and more easily, specify the width of one culvert in metres by using a negative value. For example, if the culverts are 1.8m wide, enter a value of 1.8 and the number of vertical walls per cell is automatically calculated.</p>
Applicable to Box Culverts only. Not used by other types of FCs.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
Blocked_sides
</td>
<td style="text-align:left;">
<p>Indicates whether any of the walls of the constricted cell(s) are blocked off (i.e. no flow across/through the side wall). Specify one or more of the following letters in any order with in the field to indicated which wall(s) are blocked:</p>
<ul>
<li>“R” – block right hand side wall</li>
<li>“L” – block left hand side wall</li>
<li>“T” – block top side wall</li>
<li>“B” – block bottom side wall</li>
</ul>
Note: the quotes should be omitted.
</td>
<td style="text-align:left;">
Char(10)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
Invert_2
</td>
<td style="text-align:left;">
leave blank (not used as yet)
</td>
<td style="text-align:left;">
Char(10)
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
Obvert_2
</td>
<td style="text-align:left;">
leave blank (not used as yet)
</td>
<td style="text-align:left;">
Char(10)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
Comment
</td>
<td style="text-align:left;">
Optional field for entering comments. Not used.
</td>
<td style="text-align:left;">
Char(250)
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="applying-form-energy-loss-in-2d-fc-and-fcsh-layers"><span class="header-section-number">7.5.6.2</span> Applying Form (Energy) Loss in 2D FC and FCSH Layers<a href="#applying-form-energy-loss-in-2d-fc-and-fcsh-layers" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following should be noted when adapting structure loss coefficients
from a 1D model or from coefficients that apply across the entire
waterway, for example, from “Hydraulics of Bridge Waterways” <span class="citation">(<a href="#ref-Bradley1978">Bradley, 1978</a>)</span> or “Guide to Bridge Technology Part 8, Hydraulic Design of
Waterway Structures” <span class="citation">(<a href="#ref-Austroads2018">Austroads, 2018</a>)</span>:</p>
<ul>
<li>The TUFLOW 2D solution automatically predicts the majority of “macro”
losses due to the expansion and contraction of water through a
constriction, or around a bend, provided the resolution of the grid is
sufficiently fine <span class="citation">(<a href="#ref-Barton2001">Barton, 2001</a>; <a href="#ref-Syme2001b">Syme, 2001b</a>)</span>.<br />
</li>
<li>Where the 2D model is not of fine enough resolution to simulate the
“micro” losses (e.g. from bridge piers, vena contracta, losses in the
vertical (3<sup>rd</sup>) dimension), additional form loss
coefficients and/or modifications to the cells widths and flow height
need to be added. This can be done by using flow constrictions (FC
cells). Additional form loss can also be added using <a href="#tgcReadGIS">Read GIS
FLC</a> or the command <a href="#tgcReadGridFLC">Read Grid FLC</a>.<br />
</li>
<li>The additional or “micro” losses, which may be derived from
information in publications, such as Hydraulics of Bridge Waterways,
need to be either:
<ul>
<li>Distributed evenly over the FC cells across the waterway by dividing
the overall additional loss coefficient by the number of cells (in
the direction of flow); or<br />
</li>
<li>Assigned unevenly (e.g. more at the cells with the bridge piers),
however, the total of the loss coefficients should be equivalent to
the required overall additional loss coefficient.<br />
</li>
</ul></li>
<li>The head loss across key structures should be reviewed, and if
necessary, benchmarked against other methods. Note that a well-designed 2D model
will be more accurate than a 1D model, provided that any “micro”
losses are incorporated.<br />
</li>
<li>Ultimately the best approach is to calibrate the structure through
adjustment of the additional “micro” losses – but this, of course,
requires good calibration data!</li>
</ul>
<p>An example of how to apply 2D FCs and a 2D FCSH to a bridge structure is
shown in Figure <a href="#fig:fig-image118">74</a> and Figure <a href="#fig:fig-image119">75</a>. <strong>The loss coefficient quoted in the figure is an example. Every structure is invariably different, and as such require structure specific parameters!</strong></p>
<p>When applying FCs, the best approach is to view the structure as a
collection of 2D cells representing the whole structure, rather than
being too specific about the representation of each individual cell. A
good approach is to use a 2d_po layer to extract time histories of the
water levels upstream and downstream of the structure and of the flow
and flow area upstream, downstream and through the structure (see
Section <a href="#TwoDTS-3"><strong>??</strong></a>).</p>
<p>Of particular importance is to check that the correct flow area through
the structure is being modelled. Digitise a 2d_po QA line through the
structure from bank to bank and use this output to cross-check the flow
area of the 2D FC cells is appropriate (the QA line will take into
account any adjustments to the 2D cells due to FC obverts and changes to
the cell side flow widths). If the overall structure flow area is not
correct, then the velocities within the structure will not be correct
and therefore the energy losses due to the changes in velocity direction
and magnitude and additional form losses will not be well modelled.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image118"></span>
<img src="images/image118.png" alt="Setting FC Parameters for a Bridge Structure"  />
<p class="caption">
Figure 74: Setting FC Parameters for a Bridge Structure
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image119"></span>
<img src="images/image119.png" alt="Setting FCSH Parameters for a Bridge Structure" width="80%" />
<p class="caption">
Figure 75: Setting FCSH Parameters for a Bridge Structure
</p>
</div>
<h3 class="hasAnchor" id="CLA-Unsupported-3"><span class="header-section-number">7.5.7</span> Unsupported Features in TUFLOW Classic<a href="#CLA-Unsupported-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following features are not supported in TUFLOW Classic. TUFLOW HPC is required to access these features:</p>
<ul>
<li>Parallelisation / utilising GPU Hardware (Section <a href="#GPUHardware-4"><strong>??</strong></a>)</li>
<li>Wu turbulence approach (Section <a href="#Wu-4"><strong>??</strong></a>)</li>
<li>Topography Sub-grid Sampling (Section <a href="#SGS-3"><strong>??</strong></a>)</li>
<li>Quadtree grid refinement (Section <a href="#Quadtree-3"><strong>??</strong></a>)</li>
<li>Groundwater with multiple sub-surface layers and horizontal hydraulic conductivity (Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>)</li>
<li>Non-Newtonian Flow (Section <a href="#NN-3"><strong>??</strong></a>)</li>
</ul>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Boundaries-InitialConditions-1"><span class="header-section-number">8</span> Boundaries and Initial Conditions<a href="#Boundaries-InitialConditions-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- PAR to EFC: need to add in negative rainfall boundaries are possible and that will remove water from wet cells. then link to 2D domains chapter where we discuss-->
<!--EFC: added comment in rainfall overview and linked to 2D domains section-->
<h2 class="hasAnchor" id="BC-Intro-2"><span class="header-section-number">8.1</span> Introduction<a href="#BC-Intro-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Boundary conditions are a crucial part of hydrodynamic modelling, providing the inputs where fluids can enter or leave the hydrodynamic model area. This chapter of the manual discusses the available boundary conditions
and the boundary condition database, where constant and time-series of boundary elements are specified. 1D and 2D boundaries are discussed
together in this chapter as both access the same boundary database (see Section
<a href="#bcdbase-2"><strong>??</strong></a>), although separate databases can be set up if desired.</p>
<p>The options for applying initial conditions to the 1D and 2D domains of
the model are also discussed.</p>
<h2 class="hasAnchor" id="BCArrangements-2"><span class="header-section-number">8.2</span> Recommended BC Arrangements<a href="#BCArrangements-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section discusses the recommended boundary condition arrangements for downstream, inflow and internal boundaries, summarised in Table <a href="#tab:tab-BCArrangements">73</a>.</p>
<p>The recommended arrangements of downstream boundaries are:</p>
<ul>
<li>Where the downstream boundary is a well-defined water level (e.g. the ocean or a large lake), water level boundaries are typically specified using 1D or 2D HT (water level vs time) boundaries. Note that both outflow and inflow may occur with water level boundaries.<br />
</li>
<li>Where the downstream boundary is intended to represent a “reasonable continuation” of a river, a stage-discharge relationship may be specified using a 1D or 2D HQ (water level vs flow, also commonly referred to as a stage-discharge) boundary. Note that real rivers may exhibit a hysteresis in the stage-discharge relationship (sometimes termed a “looped rating curve”). When this occurs the discharge at a particular water level may be different at different stages in the flood, for example a higher flow may occur on the rising limb compared to the same gauge level on the falling limb. A single height-flow (HQ) curve is therefore an approximation of flood behaviour. Sensitivity testing of any downstream HQ boundaries is recommended, if results in the area of interest are sensitive to changes in HQ curve, consider moving the downstream boundary further from the area of interest.<br />
</li>
<li>In some situations, a hydraulic structure that is inlet controlled acts as the downstream control, in which case, the boundary specified downstream of the structure will have no influence on the results upstream of the structure. For such cases, a downstream water level (HT) boundary may be used with a water level defined below the ground level. In TUFLOW Classic, with a downstream boundary where a water level has been specified below the ground level, for a positive bed slope (based on slope from upstream cell centre to cell face), upstream friction based flow (which may be supercritical) is assumed based on the bed slope, whilst for negative (adverse) slope, weir flow is assumed. For TUFLOW HPC, with a downstream boundary with a defined water level below ground level, it becomes a ‘weir’ calculation - similar to a broad-crested weir. It is possible that subcritical flow just upstream of the boundary may become critical or supercritical at the face where the weir is. Flow that is already supercritical will remain supercritical.</li>
</ul>
<p>The recommended arrangements of inflow/internal boundaries are:</p>
<ul>
<li>For fluvial flood (river/streams breaking bank) models it is common to use an inflow boundary (flow vs time or QT). However, in some situations upstream levels may be known more accurately than flows (level gauges are common whereas cross-section integrated flow measurements are rare) and a water level boundary (HT) may be used instead - particularly during model calibration.<br />
</li>
<li>For 2D pluvial (rainfall exceeding drainage capacity) flood models, inflows may also be defined using 2D flow sources and sinks such as a Rainfall (RF) or SA boundaries.<br />
</li>
<li>For models where the rate of inflow changes dramatically, such as in a dam-break scenario, a QT boundary may have instability issues, in which case the flow vs time inflow may be defined using a area based Source-Area (SA) boundary. SA boundaries are typically more stable than QT boundaries. Alternatively the dam break can be modelled via representation of the storage upstream of the dam within the model with the failure being represented via either a dynamic 1D dambreak channel (DF or PF type channel - refer Section <a href="#PFDF-3"><strong>??</strong></a>) or 2D via variable geometry (variable 2D z shape) - refer Section <a href="#vzsh-4"><strong>??</strong></a>.</li>
</ul>
<!-- CDH this is true, though is very specific and doesn't really fit in with the surrounding text. I feel like this commentary relates to a single problematic support query we struggled with. It's biasing us to focus on it too much. If we want to talk about this specifically I think we should discuss boundary condition data accuracy more broadly, not just for "recorded" flows.

When using recorded flow data for QT boundary inflows, or HQ boundary outflows, take care to ensure that you understand the source of the "Q" data. If there is inaccuracies in the flow data, these will be introduced to your TUFLOW model. For example, if using recorded flow data, understand that obtaining actual flow rate measurements is difficult in practice - it requires an accurate measurement of flow velocity at a number of locations over the cross-section. In the majority of cases, recorded flows are based on a measured water level (stage), and the flow rate data is derived from these using parallel flow analysis for the cross-section in question and with assumed bed friction values. There are many factors that can cause significant errors
with this approach: cross sections that are not at longitudinal equilibrium, or have multiple sub-channels, or have high turbulent eddy viscosity,
or are running near or beyond bank full, not to mention the accuracy of the bed-friction assumptions. These uncertainties should be kept in mind
when using flow vs time and stage vs flow data from a source where you are unsure of the origins of the flow rate data.  An alternative approach is to generate a rating curve based on spot flow measurements which is used to derive flow from the measured water level.  Due to practical reasons, these spot gauges rarely take place during flood events, and the extrapolation of the rating curve can introduce uncertainties. In fact hydrodynamic models have been used to assess the validity of, and extend, such rating curves. -->
<p>For both 1D and 2D models, it is critically important that the inflow and downstream boundary placement location does not affect the model results within the primary area of interest. It is an essential step during the early stages of model creation to sensitivity check the location of the boundary to confirm its location does not cause a material difference in water levels within the region of interest for the modelling. If a difference in result does occur, greater distance between the area of interest and the boundary location should be considered.</p>
<p>With regard to 2D boundaries, particular attention should be given to the placement of water level (HQ and HT) and flow (QT) boundaries. They should be:</p>
<ul>
<li>Digitised as line objects approximately perpendicular to the flow direction. The boundary can be digitised at any orientation to the 2D grid (i.e. does not need to be parallel to the grid) and can be defined using a line with multiple vertices and segments (i.e. it does not have to be a straight line). The reason these boundaries should be digitised perpendicular to flow is that the boundary, depending on type and options (refer Section <a href="#BC-Layers-3"><strong>??</strong></a>), may force a uniform water level along the boundary cells. Spurious circulations can occur along the boundary if it is digitised along (as opposed to across) a waterway. This is often noticed by viewing the flow velocity vectors in the vicinity of the boundary or by an oscillating delta volume (dV) value in the output window (refer to Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>).<br />
</li>
<li>Placed at the edge of the model active area boundary. To achieve this, snap the line vertices to those of the code polygon that defines the model active area. If the boundary is placed inside of the active area, bi-directional and/or recirculating flows are likely to occur. If the boundary line is significantly outside the active code polygon, then flow may not be able to reach the boundary and leave the model.<br />
</li>
<li>Have end points at sufficient elevation so that water levels at the boundary never reach the ends of the line.<br />
</li>
<li>Specifically for the stage-discharge (HQ) boundary, the boundary should only span one primary flow path. If the stage-discharge relationship is to be auto-calculated, the boundary end points should have elevations that are only just a bit above the highest expected water level, alternative the ‘d’ attribute can be used to set the maximum depth, see Table <a href="#tab:tab-ConditionsAttribute">78</a>. This is to ensure that the digitised stage-discharge table has sufficient resolution over the actual working range of the boundary. Further, HQ curves generated for very shallow surface elevation slopes may cause model stability challenges.</li>
</ul>
<p>A good check for the boundary locations is to compare peak flood extent (e.g. maximum water level grid) after a simulation with the active model area and associated boundary locations; typically water should not touch the edge of the model unless a boundary is defined. If water does occur at the edge of the domain, a process called ‘Glass-Walling’, boundaries of the active model area may need to be reviewed and added as appropriate.</p>
<p>Table <a href="#tab:tab-BCArrangements">73</a> provides an overview of the boundary types typically used for different locations.</p>
<table>
<caption>
<span id="tab:tab-BCArrangements">Table 73: </span><strong>Recommended BC Arrangements</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type of Boundary
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
1D
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
2D
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Ocean or Estuary
</td>
<td style="text-align:left;">
HT
</td>
<td style="text-align:left;">
HT
</td>
</tr>
<tr>
<td style="text-align:left;">
Lake
</td>
<td style="text-align:left;">
HT
</td>
<td style="text-align:left;">
HT
</td>
</tr>
<tr>
<td style="text-align:left;">
River/Creek Outflow
</td>
<td style="text-align:left;">
HQ or HT
</td>
<td style="text-align:left;">
HQ or HT
</td>
</tr>
<tr>
<td style="text-align:left;">
River/Creek Inflow
</td>
<td style="text-align:left;">
QT as point on inflow node.
</td>
<td style="text-align:left;">
QT line (preferred) or SA region
</td>
</tr>
<tr>
<td style="text-align:left;">
Local Catchment Inflows around the edge of model or within model.
</td>
<td style="text-align:left;">
QT as regions (flow is distributed between nodes within a region)
</td>
<td style="text-align:left;">
SA.<br />
Use SA with PITS option for directing inflows directly to 1d pits (also referred to as gully traps).
</td>
</tr>
<tr>
<td style="text-align:left;">
Direct Rainfall<br />
(No Hydrology Inflows)
</td>
<td style="text-align:left;">
No option at present
</td>
<td style="text-align:left;">
RF or possibly SA (with RF option).
</td>
</tr>
<tr>
<td style="text-align:left;">
Dambreak Hydrograph
</td>
<td style="text-align:left;">
QT
</td>
<td style="text-align:left;">
SA or QT. SA may offer greater stability and better mass error if mass errors occur using QT.
</td>
</tr>
<tr>
<td style="text-align:left;">
Pumps
</td>
<td style="text-align:left;">
P (Pump) channel
</td>
<td style="text-align:left;">
1D linked via SX preferred.<br />
SH possible
</td>
</tr>
<tr>
<td style="text-align:left;">
Infiltration
</td>
<td style="text-align:left;">
No option at present other than specifying a negative QT.
</td>
<td style="text-align:left;">
Specify rainfall losses on a materail basis (Section <a href="#Rainfall-Losses-4"><strong>??</strong></a>) or use the soil infiltration feature (Section <a href="#Infiltration-2"><strong>??</strong></a>). Alternatively, RF can be used by specifying negative values.
</td>
</tr>
<tr>
<td style="text-align:left;">
Groundwater Level
</td>
<td style="text-align:left;">
HT
</td>
<td style="text-align:left;">
2D HT if on the surface or specify a GT level when using Interflow functionality for sub-surface groundwater level.
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="BC-Solver-2"><span class="header-section-number">8.3</span> Solver Specific Considerations<a href="#BC-Solver-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="ClassicBC-3"><span class="header-section-number">8.3.1</span> Classic Specific Boundaries / Options<a href="#ClassicBC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are a number of boundary types that are considered legacy types, are not commonly used, nor recommended to be used. These boundary types are not supported in HPC/Quadtree and are not currently planned to be supported. These include:</p>
<ul>
<li>ST - Flow vs Time. For an alternative, use the 2d_sa layer (Section <a href="#SA-Layers-3"><strong>??</strong></a>).</li>
<li>QH - Flow vs Water Level.</li>
<li>VG - Variable Geometry. For an alternative, use Variable Z Shapes (Section <a href="#vzsh-4"><strong>??</strong></a>).</li>
<li>WT - Wind Stresses. For an alternative, use either an external stress boundary (Section <a href="#ExternalStress-2"><strong>??</strong></a>) or cyclone boundary (Section <a href="#Cyclones-2"><strong>??</strong></a>).</li>
<li>HS - Sinusoidal Water Level. In TUFLOW Classic these were initially a fixed field boundary where a number of tidal constituents (phase, amplitude and period) could be specified instead of a time-series. This was done initially in TUFLOW Classic in th 1990’s to be more memory efficient, however, memory (in particular time-series data) is typically no longer a limiting factor, so this approach has not been adopted for HPC. In TUFLOW Classic, HS and HT boundaries can be applied simultaneously to represent the different components of the boundary - for example a sinusoidal tide (HS) and a storm surge component (applied as HT), with the summation giving the overall storm tide. If multiple boundaries are to be applied to the same cells (e.g. to apply a storm surge on top of an ocean tide), these must be in <u>separate</u> GIS layers. In contrast, TUFLOW HPC does not support HS boundaries, or the combining of multiple water level boundaries on the same cells. Instead the tidal and surge components must be combined into a single HT time series.</li>
</ul>
<!-- PAR to EFC: test HS, QC (test QC to see if errors) and ST-->
<!-- EFC to PAR: yes QC errors. HS works in CLA, not HPC or QDT, ST works in CLA + HPC (not QDT), have submitted jira ticket-->
<h3 class="hasAnchor" id="ClassicHPC-3"><span class="header-section-number">8.3.2</span> HPC Specific Boundaries / Options<a href="#ClassicHPC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="HPCEnergyOptions-4"><span class="header-section-number">8.3.2.1</span> HPC Energy Options for 2D HT, HQ and QT Boundaries<a href="#HPCEnergyOptions-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Enforcing a uniform water level along the length of a boundary is not always realistic, and in some situations can lead to recirculating flow around the boundary (high velocity flow into the model towards one end of the boundary only for much of this flow to leave the model near the other end of the boundary). Historically, this could sometimes be remedied by increasing the viscosity applied along the boundary. For the TUFLOW HPC scheme we have however found a better approach (drawn from CFD modelling), to utilise a uniform total energy level along the boundary.</p>
<p>Consider the height vs time (HT) boundary, the approach is to utilise the user defined elevation as a total energy, and then apply a negative elevation correction to elevation on in-flowing cells (it is also permissible to apply an energy correction as a positive elevation adjustment on out-flowing cells, but generally this is not necessary for stabilising the boundary). This approach works well, however, it also means that for fast flowing inflow boundaries, a significant discrepancy will occur between the user-specified water elevation and the realised elevation in the model. This discrepancy is addressed by redefining the user-defined elevation as the water surface elevation corresponding to the Root Mean Squared (RMS) inflow velocity:</p>
<!--DRK to EFC: Does RMS stand for Root Mean Squared? If so, should the equation below have a square root within it? -->
<!--EFC to DRK: yes it does, have checked with GRC. The text and equation are correct-->
<p><span class="math display" id="eq:equ-RMS-inflow">\[\begin{equation}
h_{i} = H(t) + \frac{\bar{v^{2}} - v_{i}^{2}}{2g}
\tag{53}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(H(t)\)</span> is the user define height vs time boundary data<br />
</li>
<li><span class="math inline">\(\bar{v^{2}}\)</span> is the mean square flow velocity averaged over boundary cells that are inflowing<br />
</li>
<li><span class="math inline">\(v_{i}^{2}\)</span> is the magnitude squared of flow velocity at the boundary
cells<br />
</li>
<li><span class="math inline">\(h_{i}\)</span> is the applied water level at the boundary cells</li>
</ul>
<p>Note, that this energy correction is only applied on in-flowing cells. In practice this approach means that for an out-flowing boundary the water level is constant over the length of the boundary line, but for an inflowing boundary some variation in water level will be observed along the length of the boundary with slower flowing regions being slightly above the defined elevation and faster flowing regions being slightly below the defined elevation.</p>
<p>For a QT boundary, the user specifies the flow rate as a function of time, not an elevation. However, internal to the software a fixed elevation boundary is utilised (it is a HX boundary connected to 1D storage node – refer Section <a href="#HXBoundary-3"><strong>??</strong></a> for a more detailed description of HX boundaries). Recirculation may also occur on the QT boundary (more so when it is digitised oblique to the flow path or digitised over highly irregular terrain), which again is addressed using the same energy correction described above.</p>
<p>Two new approaches have been introduced in the 2023-03 release and are available for HPC only (including Quadtree). The original approach (Method A) is the default for TUFLOW Classic, while Method B and Method C are new options for HPC. The extent of the energy corrections for the different approaches are detailed in Table <a href="#tab:tab-HPCBoundaryDescriptions">74</a>. Note that Method C, which does not apply the correction to HX channel end boundaries is the default.</p>
<p><tcmd><a href="#tcfHPCBoundaryApproach">HPC Boundary Approach</a></tcmd><teq> == </teq><tblk>Method A | Method B | {Method C}</tblk></p>
<table>
<caption>
<span id="tab:tab-HPCBoundaryDescriptions">Table 74: </span><strong>HPC Boundary Approach Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Method
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Method A
</td>
<td style="text-align:left;">
No energy corrections applied (backward compatible)
</td>
</tr>
<tr>
<td style="text-align:left;">
Method B
</td>
<td style="text-align:left;">
<p>Energy correction applied for:</p>
<ul>
<li>HT and HQ boundaries<br />
</li>
<li>QT boundaries<br />
</li>
<li>HX boundaries connected to a single 1D node (refer Section <a href="#HXBoundary-3"><strong>??</strong></a>)
</td>
</tr>
<tr>
<td style="text-align:left;">
Method C (default)
</td>
<td style="text-align:left;">
Energy correction applied for:<br />
</li>
<li>HT and HQ boundaries<br />
</li>
<li>QT boundaries
</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 class="hasAnchor" id="HpcHQApproach-4"><span class="header-section-number">8.3.2.2</span> HPC HQ Boundary Approach<a href="#HpcHQApproach-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The HQ boundary computes the flux across the entire boundary line and uses a rating curve to apply a water level to the model. Each line is treated as a separate boundary and has a stage-discharge relationship, this is consistent with the TUFLOW Classic approach to HQ boundaries. Earlier versions of TUFLOW HPC applied the water surface slope on a cell by cell basis. It is possible to revert to all model HQ boundaries using a cell by cell approach by specifying ‘Cell’ within the .tcf command:</p>
<p><tcmd><a href="#tcfHPCHQBoundaryApproach">HPC HQ Boundary Approach</a></tcmd><teq> == </teq><tblk>{Total} | Cell</tblk></p>
<h4 class="hasAnchor" id="HpcHQFilter-4"><span class="header-section-number">8.3.2.3</span> HPC HQ Boundary Stability<a href="#HpcHQFilter-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For cross-sections with a very low longitudinal slope, the stage vs flow (HQ) relationship can become unstable - a small change in flow causes a change in level that causes a similar but opposite change in flow. This manifests as high frequency noise on the HQ boundary levels and flows, but unless the model has fine temporal output resolution it can go unnoticed. Starting with release 2023-03-AD, the flow at all HQ boundaries is monitored for stability during the
simulation. A stability warning message will be printed if at any timestep the flow at a given HQ boundary is (1) greater than 0.1% of the maximum flow defined in the HQ table for that boundary, and (2) less than 80% of the flow at that boundary in the previous timestep. The instabilities are easily
addressed by calculating time-filtered flows and using these instead for the HQ table lookup and interpolation:</p>
<p><span class="math display">\[\begin{equation}
Q_{f,i} = \frac{(F - 1)Q_{f,i-1} + Q_i}{F}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q_{f,i}\)</span> is the filtered boundary flow at timestep <span class="math inline">\(i\)</span> (initialised as zero)</li>
<li><span class="math inline">\(Q_i\)</span> is the instantaneous boundary flow</li>
<li><span class="math inline">\(F\)</span> is the filtering factor (must be greater than or equal to 1.)</li>
</ul>
<p>Starting with release 2023-03-AD, the user may specify the global HQ boundary filter constant <span class="math inline">\(F\)</span> using the command below. The default value is 1, which
means no filtering (for backward compatibility).</p>
<p><tcmd><a href="#tcfHPCHQBoundaryFilterConstant">HPC HQ Boundary Filter Constant</a></tcmd><teq> ==</teq><tblk> &lt;float&gt; | {1}</tblk></p>
<h4 class="hasAnchor" id="HpcBoundariesOther-4"><span class="header-section-number">8.3.2.4</span> HPC Additional Boundary Options<a href="#HpcBoundariesOther-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A number of other commands are available for controlling the behaviour of boundaries which are specific to the HPC solver. In most instances, these can be left at the default value. Refer to the following Appendix links for further details on each of these commands:</p>
<ul>
<li><tcmd><a href="#tcfHPCInfiltrationDryingApproach">HPC Infiltration Drying Approach</a></tcmd><teq> == </teq><tblk>Method A | Method B</tblk><br />
</li>
<li><tcmd><a href="#tcfHPCSXMomentumApproach">HPC SX Momentum Approach</a> </tcmd><teq> == </teq><tblk>Method A | {Method B}</tblk></li>
</ul>
<h4 class="hasAnchor" id="HpcQuadtreeParallelInteria-4"><span class="header-section-number">8.3.2.5</span> Quadtree BC Parallel Inertia Approach<a href="#HpcQuadtreeParallelInteria-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Inflow boundaries should be perpendicular to inflow direction, but sometimes this is not possible and a slightly oblique boundary is required. For a momentum
conserving scheme is it important that the incoming flow brings with it the correct amount of transverse momentum. With the 2023-03-AA release, the
handling of transverse momentum, or parallel inertia, for Quadtree simulations (“QT”, “HT” and “HX” type 2d_bc layers) has been changed to
“Method B” to provide better consistency with TUFLOW Classic and HPC. To revert to the 2020 release method, use “Method A” with the following command:</p>
<p><tcmd><a href="#tcfQuadtreeBCParallelInertiaApproach">Quadtree BC Parallel Inertia Approach</a></tcmd><teq> == </teq><tblk>Method A | {Method B}</tblk></p>
<h2 class="hasAnchor" id="OneDBoundaries-2"><span class="header-section-number">8.4</span> 1D Boundaries (1d_bc Layers)<a href="#OneDBoundaries-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Boundary conditions for 1D domains are defined using one or more 1d_bc GIS layers. The different types of boundaries and links are described in Table <a href="#tab:tab-LinkTypes">75</a>.</p>
<p>GIS 1d_bc layer(s) generally contain points that are snapped to the 1D node in a 1d_nwk layer. Each point has several attributes, as described in Table <a href="#tab:tab-BoundaryConditions">76</a>.</p>
<p>In addition to point GIS objects, regions can be specified for 1D QT boundaries. If a region is used, the QT hydrograph is equally distributed to all nodes falling within the region that are not assigned a water level (H) boundary (this includes nodes connected to the 2D domain via a 2D SX). If no suitable nodes are found within a QT region an ERROR occurs.</p>
<p>Note: It is not possible to assign both a flow type boundary and water level type boundary to the same 1D node. For example, a HT and QT boundary on the same node.</p>
<table>
<caption>
<span id="tab:tab-LinkTypes">Table 75: </span><strong>1D Boundary Condition and Link Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Comments
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Water Level
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>HQ</b>
</td>
<td style="text-align:left;">
Water Level (<b>H</b>ead) versus Flow (m)
</td>
<td style="text-align:left;">
<p>Assigns a water level to the node based on the flow entering the node. This boundary is normally applied at the downstream end of a model.</p>
<p>The water level versus flow (HQ) curve can be:</p>
<ul>
<li>Manually assigned using the 1d_bc GIS layer ““Name”” attribute (Table <a href="#tab:tab-BoundaryConditions">76</a>) and the boundary database (Section <a href="#bcdbase-2"><strong>??</strong></a>).</li>
<li>An automatically generated HQ curve based on the cross-sectional properties and a specified friction slope. Specify “slope=friction_slope” (e.g. slope=0.01) for the “Name” attribute in the 1d_bc point layer (Table <a href="#tab:tab-BoundaryConditions">76</a>) defining the HQ boundary. As long as your boundary is sufficiently far from your area of interest, the friction slope can be estimated from the two nearest cross-sections to the downstream boundary. This feature requires a single channel connected to the node and does not work with channels using HW cross-sections with varying roughness. This functionality was added in the 2023-03-AD release.
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>HT</b>
</td>
<td style="text-align:left;">
Water Level (<b>H</b>ead) versus <b>T</b>ime (m)
</td>
<td style="text-align:left;">
Assigns a water level to the node based on a water level versus time curve using the 1d_bc GIS layer ““Name”” attribute (Table <a href="#tab:tab-BoundaryConditions">76</a>) and the boundary database (Section <a href="#bcdbase-2"><strong>??</strong></a>). If other HT or HS boundaries are applied to the node, the water level is set to the sum of the water level boundaries.
</td>
</tr>
<tr>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1D nodes can be wet or dry. If the water level is below the bed, computationally the bed level is assigned as the water level to the node.</li>
</ul>
As the water level in the node is defined by the boundary, the node’s storage has no bearing on the results.
</td>
</tr>
<tr>
<td style="text-align:left;">
Combinations
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<p>Any number of 1D water level boundaries can be assigned to the same node. The sum of the water levels is assigned as the boundary. For example, a storm tide may be specified as a combination of a tidal HS boundary, a HT boundary of the storm surge and another HT boundary of the wave set up. The HS boundary would be water elevations and the two HT boundaries water depths.</p>
<b>If you have a 2D SX boundary connected to a node and also have a HT and/or HS boundary at the same node, the 2D SX boundary prevails and no warning is given.</b>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flow
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>QH</b>
</td>
<td style="text-align:left;">
Flow vs Water Level (<b>H</b>ead) (m<sup>3</sup>/s)
</td>
<td style="text-align:left;">
Assigns a flow to the node based on the water level of the node at the previous half timestep using the 1d_bc GIS layer ““Name”” attribute (Table <a href="#tab:tab-BoundaryConditions">76</a>) and the boundary database (Section <a href="#bcdbase-2"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>QT</b>
</td>
<td style="text-align:left;">
Flow versus <b>T</b>ime (m<sup>3</sup>/s)
</td>
<td style="text-align:left;">
<p>Assigns a flow into the node based on a flow versus time curve using the 1d_bc GIS layer ““Name”” attribute (Table <a href="#tab:tab-BoundaryConditions">76</a>) and the boundary database (Section <a href="#bcdbase-2"><strong>??</strong></a>). A negative flow extracts water from the node.</p>
A region (polygon) can be used to equally distribute the flow hydrograph to all nodes that fall within the region. Any nodes that are an H boundary or are connected to a 2D SX cell are not included. Where pits are connected to the 2D domain, flow is applied to the bottom of the pit (bottom 1D node). The limit on the number of 1D QT regions assigned to a 1D node is ten (10).
</td>
</tr>
<tr>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<p>The 1D node can be wet or dry.</p>
The storage of the 1D node influences the results. If the node storage is made excessively large, the flow hydrograph is attenuated. Conversely, if it is under-sized the node is likely to be unstable.
</td>
</tr>
<tr>
<td style="text-align:left;">
Combinations
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<p>Any number of 1D flow boundaries can be assigned to the same node. The final flow is the sum of the flows assigned.</p>
A connection to a 2D HX boundary (automatically sets as a QX boundary at the node) can be applied in conjunction with other 1D Q boundaries.
</td>
</tr>
</tbody>
</table>
<!-- PAR - reviewed and removed QC from table, does QH boundary still work in 1D ??? -->
<!--EFC to PAR - yes it appears to-->
<table>
<caption>
<span id="tab:tab-BoundaryConditions">Table 76: </span><strong>1D Boundary Conditions (1d_bc) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
The type of BC using one of the two letter flags described in Table <a href="#tab:tab-LinkTypes">75</a>.
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Flags
</td>
<td style="text-align:left;">
<p>Available flags are:</p>
<p><b>S</b> Apply a cubic spline fit to the boundary values (HT, QT, HQ and QH only). Useful for simulating tidal HT boundaries.</p>
<p>The flags below are available for QT regions. Any combination of C, O and P can be used. If C, O or P are not specified, the flow is distributed to all non-H boundaries (1D H boundaries are any boundary starting with H or any 2D SX connections). Note, specifying CO is the same as specifying no flags.</p>
<p><b>QT regions only:</b></p>
<b>C</b> Only direct flow into closed nodes. Closed nodes are those that only have culverts/pipes (C, R or I channels) connected. Pits may or may not be connected to a closed node.<br />
<b>O</b> Only direct flow into nodes that have at least one open channel connected. An open channel is any channel besides C, R or I channels.<br />
<b>P</b> Only direct flow into the bottom of pits, i.e. all nodes with a pit connected.
</td>
<td style="text-align:left;">
Char(6)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>). An error will be generated if no name is specified.<br />
Note for automatic calculation of HQ boundary a slope can be specified with keyword “slope=slope in m/m”. Refer to Table <a href="#tab:tab-LinkTypes">75</a>.
</td>
<td style="text-align:left;">
Char(50)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Description
</td>
<td style="text-align:left;">
Optional field for entering comments. Not used.
</td>
<td style="text-align:left;">
Char(250)
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="TwoDBoundaries-2"><span class="header-section-number">8.5</span> 2D Boundaries (2d_bc, 2d_sa and 2d_rf Layers)<a href="#TwoDBoundaries-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>2D boundary conditions and linkages between the 1D and 2D domains are defined using a combination of one or more 2d_bc, 2d_sa or 2d_rf GIS layers. The different types of boundaries and links are described in Table <a href="#tab:tab-twoDBoundary">77</a>.</p>
<p>Conditions have been built into TUFLOW to ensure a cell can only be assigned one boundary from a single GIS layer (except for: pit SX connections; sink/source points or lines with two vertices only; and polygon boundaries such as SA and RF).</p>
<p>Error checks have been incorporated into TUFLOW during the input pre-processing of 2D boundary conditions, TUFLOW stops with an error if a cell is:</p>
<!-- PAR have removed some obsolete boundaries from the below, maybe we should check the below are actually true...-->
<!-- EFC to PAR: can we chat about the easiest way to test this?-->
<!-- PAR to EFC: very simple square model with overlapping boundaries, 1D node somewhere-->
<!-- EFC to PAR: duncan has done this, jira ticket submitted -->
<ul>
<li>Assigned a HT or HS that is already a QT, SX, ST or HX cell;<br />
</li>
<li>Assigned a 2D or HX that is already any other boundary; <!-- EFC to PAR: HX + RF work--></li>
<li>Assigned a QT that is already a SX or H boundary; and<br />
</li>
<li>Assigned a ST or SX that is already a QT or H boundary. <!-- EFC to PAR: RF works with QT, HT, HX, SX, SA. Therefore I've removed RF from this list --></li>
</ul>
<table>
<caption>
<span id="tab:tab-twoDBoundary">Table 77: </span><strong>2D Boundary Condition and Link Types </strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Comments
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Water Level Boundaries
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>HQ</b>
</td>
<td style="text-align:left;">
Water Level (<b>H</b>ead) versus Flow (<b>Q</b>)
</td>
<td style="text-align:left;">
Assigns a water level to the cell(s) based on a water level versus flow (stage-discharge) curve. Alternatively, TUFLOW can automatically generate the HQ curve if a slope is specified using the 2d_bc GIS layer “b” attribute (see Table <a href="#tab:tab-ConditionsAttribute">78</a>). The variation in Manning’s n with depth feature is taken into account if automatically calculating the stage-discharge curve.
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>HT</b>
</td>
<td style="text-align:left;">
Water Level (<b>H</b>ead) versus <b>T</b>ime
</td>
<td style="text-align:left;">
Assigns a water level to the cell(s) based on a water level versus time curve. Uses the 2d_bc GIS layer (See Section <a href="#BC-Layers-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>HX</b>
</td>
<td style="text-align:left;">
Water Level (<b>H</b>ead) from an e<b>X</b>ternal Source (i.e. a 1D model)
</td>
<td style="text-align:left;">
For linking 1D and 2D domains. One or two 1D nodes provide a water level to the 2D every half timestep. TUFLOW automatically creates 1D QX boundaries at the 1D node(s) (see Table <a href="#tab:tab-LinkTypes">75</a>), which also receives flow from the 2D domain every half timestep. 2D HX boundaries are linked to 1D nodes using CN connections (see below and Figure <a href="#fig:fig-HXSchematicSectionView">90</a>). Uses the 2d_bc GIS layer (See Section <a href="#BC-Layers-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>2D</b>
</td>
<td style="text-align:left;">
Links two 2D domains
</td>
<td style="text-align:left;">
Multiple domain boundary only available for TUFLOW Classic. Refer to Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>. Uses the 2d_bc GIS layer (See Section <a href="#BC-Layers-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>HS</b>
</td>
<td style="text-align:left;">
Sinusoidal (Tidal) Water Level (m)
</td>
<td style="text-align:left;">
Legacy boundary condition, available for Classic solver only. HT boundary is the recommended alternative. Refer to the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a> for further details.
</td>
</tr>
<tr>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<p>Cell(s) can be wet or dry. It is <u>not</u> a requirement that at least one cell is wet.</p>
<p>All H line types can be oblique to the X-Y axes.</p>
<p>The water level can vary in height along a line of cells.</p>
<b>Tip:</b> A common cause of instabilities at or near head boundaries at the start of a simulation is the initial water level specified at the adjacent cells is different to the head value. If your model immediately goes unstable or requires a very low timestep at the boundary, check your initial water levels. If it is a 2D HX boundary, the water levels in the 1D node and the 2D cells should be similar.
</td>
</tr>
<tr>
<td style="text-align:left;">
Combinations
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Multiple water level boundaries that select the same cell are not recommended. For TUFLOW Classic, multiple HT or HS boundaries can be applied and the water level used is the sum of the water levels assigned. This is not recommended, and is not supported in TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Groundwater Boundaries
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>GT</b>
</td>
<td style="text-align:left;">
Groundwater Level versus Time
</td>
<td style="text-align:left;">
<p>Assigns a groundwater level to the cell(s) based on a groundwater level versus time curve.</p>
The same groundwater level boundary applies to all vertical soil layers. If the specified groundwater level is below the elevation at the bottom of the layer, it is dry. If the specified groundwater level is above the elevation at the top of the layer, it is fully saturated. Uses the 2d_bc GIS layer (See Section <a href="#BC-Layers-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flow Boundaries
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
(Directional)
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>QT</b>
</td>
<td style="text-align:left;">
Flow versus Time (m<sup>3</sup>/s)
</td>
<td style="text-align:left;">
<p>Distributes flow in quantity and direction across the cell(s) based on their topography, bed roughness and whether upstream or downstream controlled flow. The limiting assumption is that the water level along the line is constant, therefore, the line must be digitised roughly perpendicular to the flow and should avoid areas where significant super-elevation or other similar effects occur.</p>
<p>Cells can wet and dry, the line can be oblique to the grid.</p>
Multiple QT boundaries should not be applied to the same cell.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flow Boundaries
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
(non-Directional)
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>RF</b>
</td>
<td style="text-align:left;">
Rainfall versus Time (mm)<br />
Infiltration versus Time (mm)
</td>
<td style="text-align:left;">
<p>Applies a rainfall hyetograph. The rainfall time-series data must be in mm depth per timestep. It is converted to a hydrograph to smooth the transition from one rainfall period to another (the converted hydrograph appears in the .tlf file for cross-checking). <b>Note: the input curve is not mm/h versus timestep, but mm vs timestep (i.e. each rainfall value is the amount of rain that fell in mm between the previous time and the current time).</b></p>
Uses the 2d_rf GIS layer (see Section <a href="#Rainfall-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>SA</b>
</td>
<td style="text-align:left;">
Flow versus Time (m<sup>3</sup>/s) over an area,<br />
or<br />
Rainfall versus Time (mm)
</td>
<td style="text-align:left;">
<p>Applies the flow directly onto the cells within the polygon as a source. Negative values remove water directly from the cell(s). Most commonly used to model rainfall-runoff directly onto 2D domains with each polygon representing the sub-catchment of a hydrology model. SA boundaries have their own command, Read GIS SA, and own GIS layer, 2D_SA.</p>
Uses the 2d_sa GIS layer (see Section <a href="#SA-Layers-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>SD</b><br />
<b>SH</b>
</td>
<td style="text-align:left;">
Flow versus Depth or Head (m<sup>3</sup>/s)
</td>
<td style="text-align:left;">
<p>Extracts the flow directly from the cells based on the depth (SD) or water level (SH) of the cell. Used for modelling pumps or other water extraction. Flow values must not be negative. SD or SH boundaries can be connected to another 2D cell or a 1D node, to model the discharge of a pump from one location in a model to another. The connection is made using a “SC” line (see below). In the boundary condition database, the Column 1 data would be depth (SD) or water level (SH) values and the Column 2 data would be flow. The flow value is the rate per 2D cell. If the 2D cell becomes dry, no flow occurs. Uses the 2d_bc GIS layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>).</p>
<p>An example 2D pump model is available in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Boundary_Condition_Options">Example Model Dataset</a> on the TUFLOW Wiki.</p>
This boundary is not supported when using Quadtree and <a href="https://wiki.tuflow.com/TUFLOW_Message_2815">ERROR 2815</a> will be reported.
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>ST</b>
</td>
<td style="text-align:left;">
Flow versus Time (m<sup>3</sup>/s)
</td>
<td style="text-align:left;">
Applies the flow directly to the cells as a source. Negative values remove water directly from the cell(s). Can be used to model concentrated inflows, pumps, springs, evaporation, etc. The flow specified in the boundary file is applied to each cell to which the boundary is connected. For example, if the boundary file specifies 2 m<sup>3</sup>/s and the ST is applied over four cells, then the total flow applied to the model would be 8 m<sup>3</sup>/s. If the total flow required is 2 m<sup>3</sup>/s, then an f attribute of 0.25 could be applied so that only 0.5 m<sup>3</sup>/s is applied to each cell. Uses the 2d_bc GIS layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>).
Alternatively, the <a href="#tbcReadGISSA">Read GIS SA ALL</a> could be used to distribute a flow equally over a number of cells.
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>SX</b>
</td>
<td style="text-align:left;">
Source of flow from a 1D model.
</td>
<td style="text-align:left;">
<p>For linking 1D and 2D domains. 2D SX cell(s) are connected to a 1D node using a <b>single</b> CN connection (see below). The net flow into/out of the 1D node is applied as a source to the 2D cells. For example, a 1D pipe in the 2D domain “sucks” water out of the upstream cell(s) and “pours” water back out at the downstream cell(s) using 2D SX boundaries. Uses the 2d_bc GIS layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>).</p>
If an SX cell falls on an inactive cell (Code -1 or 0), the cell is set as active (Code 1).
</td>
</tr>
<tr>
<td style="text-align:left;">
Treatment
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Sources are applied to all the specified cell(s) whether they are wet or dry, except for SA and SX, which apply only to wet cells, or the lowest dry cell if all the SA or SX cells are dry. Uses the 2d_bc GIS layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
Combinations
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Any number of source boundaries can be assigned to the same cell(s) whether they are SA, SD, SH, ST or SX. The source rate applied is the sum of the individual sources.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Connections
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>CN</b>
</td>
<td style="text-align:left;">
Connection of 2D HX and 2D SX boundaries to 1D nodes
</td>
<td style="text-align:left;">
<p>Used in GIS 2d_bc layers (see Section <a href="#BC-Layers-3"><strong>??</strong></a>) to connect 2D HX and 2D SX boundaries to 1D nodes. A line is digitised that snaps the 2D HX or SX object to the 1D node. The direction or digitised length of the line is not important. The 1D node would be in a 1d_nwk layer. Note that if the 2D SX object is snapped to the 1D node, no CN object is required. However, 2D HX objects always require a CN object to connect to the 1D node. Alternatively, a CN point object can also be used instead of a line.</p>
<p>An ERROR occurs if a CN object is not snapped to a 2D HX or 2D SX object, or is redundant (i.e. not needed). For backward compatibility, use <a href="#tcfUnusedHXandSXConnections">Unused HX and SX Connections</a> (.tcf file) or <a href="#tbcUnusedHXandSXConnections">Unused HX and SX Connections</a> (.tbc file) to change the ERROR to a WARNING.</p>
<b>Note that for connections to 2D SX objects only one (1) CN object is required. Whereas 2D HX objects must have a minimum of two (2) CN objects – one at each end – with intermediate CN objects as needed to connect to any 1D nodes. The same node can be connected to each end of a HX line if the water level should not vary along the line.</b>
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>SC</b>
</td>
<td style="text-align:left;">
Connection of 2D SD and SH boundaries
</td>
<td style="text-align:left;">
<p>Used for connecting 2D SD and SH boundaries to another 2D cell or 1D node (e.g. modelling the pumping of water from one location to another). The direction of the line is important and should be digitised from the SH/SD pump towards the 2D cell or node which the water is to be transferred to. Uses the 2d_bc GIS layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>).</p>
<p>An example 2D pump model is available in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Boundary_Condition_Options">Example Model Dataset</a> on the TUFLOW Wiki.</p>
This boundary is not supported when using Quadtree and <a href="https://wiki.tuflow.com/TUFLOW_Message_2815">ERROR 2815</a> will be reported.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Wind
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>WT</b>
</td>
<td style="text-align:left;">
Modelling Wind Stresses as a force on the water column
</td>
<td style="text-align:left;">
<p>Legacy boundary condition and not recommended for use. Suggest use of the cyclone/hurricane (See Section <a href="#Cyclones-2"><strong>??</strong></a>) or external stress boundary (See Section <a href="#ExternalStress-2"><strong>??</strong></a>) instead.</p>
Refer to the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a> for details on WT boundary.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Variable Geometry
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>VG</b>
</td>
<td style="text-align:left;">
Modelling of breaches, etc.
</td>
<td style="text-align:left;">
<p>Supported in TUFLOW Classic only. Not supported in TUFLOW HPC (including Quadtree).</p>
<p>Used for varying cell elevations over time. Each cell, or line of cells, needs to be assigned a time series of elevations in the same manner that other boundaries are applied.</p>
<p>Also see Section <a href="#vzsh-4"><strong>??</strong></a> on Variable Z Shape layers as a simpler alternative.</p>
<p><b>Note: If varying the elevations of a HX cell, the elevation must not fall below the 1D bed value (see the attributes of the 1d_to_2d_check file for that cell). No run-time checks are made in this regard.</b></p>
Also see <a href="#tcfVGZAdjustment">VG Z Adjustment</a>.
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Other
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
<td style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>CD</b>
</td>
<td style="text-align:left;">
Code Polygon
</td>
<td style="text-align:left;">
<p>Objects in a GIS 2d_bc layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>) used to define the grid’s cell codes using Read GIS Code BC as an alternative to Read GIS Code. The code value is set using the f attribute (see Table <a href="#tab:tab-ConditionsAttribute">78</a>).</p>
The boundary lines are snapped to “CD” regions so that if the boundary location is adjusted, the boundary line and code region can move together. See <a href="#tgcReadGISCode">Read GIS Code [{} | BC]</a>, note that this must be read into the TGC file for setting the cell code.
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>IG</b>
</td>
<td style="text-align:left;">
Ignore
</td>
<td style="text-align:left;">
An object in a GIS 2d_bc layer (see Section <a href="#BC-Layers-3"><strong>??</strong></a>) can be elected to be ignored by using the “IG” type.
</td>
</tr>
<tr>
<td style="text-align:left;">
<b>ZP</b>
</td>
<td style="text-align:left;">
Elevation Point
</td>
<td style="text-align:left;">
Point objects that are used for setting elevations along HX lines. Only used by Read GIS Z HX Line which is specified in the geometry control file. See Section <a href="#BC-Layers-3"><strong>??</strong></a>.
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="BC-Layers-3"><span class="header-section-number">8.5.1</span> Boundary Conditions (2d_bc)<a href="#BC-Layers-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All boundary types listed in Table <a href="#tab:tab-twoDBoundary">77</a> apart from SA and RF are digitised within a 2d_bc GIS layer. The SA and RF boundaries have their own GIS layer and commands, as discussed in Section <a href="#SA-Layers-3"><strong>??</strong></a> and Section <a href="#Rainfall-3"><strong>??</strong></a>.</p>
<p>The attributes of the 2d_bc layers are described in Table <a href="#tab:tab-ConditionsAttribute">78</a>. 2d_bc layers are referenced in the .tbc file using the command <a href="#tbcReadGISBC">Read GIS BC</a>. The GIS layer for a 2d_bc format file may contain points, lines and regions. The method for selecting cells for each is described below:</p>
<p><strong>Points</strong> - When point objects are specified, this will select the cell that the point lies within. Snapping points to the cell sides or corners should be avoided as the selection may be unpredictable.</p>
<p><strong>Lines</strong> - A “cross-hair” approach shown in Figure <a href="#fig:fig-image120a">76</a> is the method for selecting boundary or link cells when line objects are used. Cells are only selected if the boundary or link line intersects the cell cross-hairs that extend from the cell’s mid-sides. As such, if a boundary or link line starts inside a cell, and does not intersect with the cross-hairs, that cell will not be selected.</p>
<p><strong>Regions</strong> - Region objects select all cells where the cell centroid lies within the region.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image120a"></span>
<img src="images/image120a.png" alt=" Cell Cross-hair Selection Approach" width="60%" />
<p class="caption">
Figure 76:  Cell Cross-hair Selection Approach
</p>
</div>
<p>Up to 10 GIS layers are accepted in a single line for the <a href="#tbcReadGISBC">Read GIS BC</a> command. This is needed for where points and lines are both used (for example, if using HX lines and CN points), requiring multiple layers for the one command. The format is similar to the <a href="#tgcReadGISZShape">Read GIS Z Shape</a> command with the different GIS layers separated by the “|” character. For example:</p>
<p><tcmd>Read GIS BC</tcmd><teq> == </teq><tblk>gis\2d_bc_hx_L.shp | gis\2d_bc_hx_P.shp </tblk></p>
<p>Also note that <a href="#tbcBlankBCType">Blank BC Type</a> can be used to set the default BC type to apply when no BC type is specified for an object in the 2d_bc GIS layer. This command may be repeated throughout the .tbc file to change the default setting for different 2d_bc layers. See <a href="#tbcBlankBCType">Blank BC Type</a> for more details.</p>
<!-- PAR Review all optional flags, especially: 
confirm S flag for SD/SH data
“2” – can offer improved performance along HX lines
“S” – The “S” flag
-->
<!--EFC to PAR: S flag works for Classic, doesn't for HPC - no warnings or checks reported - see TPD20-476. Does the S flag work for HS, QT, VG, VT?-->
<!-- PAR to EFC: test S flag for QT in HPC + QDT. Already works for HT in CLA, HPC + QDT -->
<!-- EFC  to PAR: tested S flag for QT i HPC + QDT, the Q Vol In appears to differ between the S flag and non-S flag runs - assume this is working - no check or warning messages in tlf-->
<!-- EFC to DRK: Angelos is testing "2" flag FYI-->
<!--EFC: 2 flag works in CLA, not HPC or QDT. Have noted in below table-->
<table>
<caption>
<span id="tab:tab-ConditionsAttribute">Table 78: </span><strong>2D Boundary Conditions (2d_bc) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
The type of BC using one of the two letter flags described in Table <a href="#tab:tab-twoDBoundary">77</a>. Also see <a href="#tbcBlankBCType">Blank BC Type</a>.
</td>
<td style="text-align:left;">
Char(2)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Flags
</td>
<td style="text-align:left;">
<p>Optional flags as follows:</p>
<p><b>HT</b>, <b>QT</b>, <b>SD</b>, <b>SH</b>, <b>VG</b>: “S” – Fit a cubic spline curve to the data. Note, the “S” flag is only supported by TUFLOW Classic.</p>
<p><b>HX</b>:<br />
“A” – Used to override the RIDGE, MAX or RAISE option in <a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a>
“L” – Sets the ZU and ZV elevations to be the same as the ZC value only if they are lower. This can improve instabilities where the ZU and ZV values are significantly lower in elevation, and can cause a sudden increase in transfer of water to/from the cell when the cell wets.<br />
“2” – TUFLOW Classic only. Can offer improved performance along HX lines by attempting to more smartly allocate water levels along a HX line when there is a dry section (“hump”) between 1D nodes.<br />
“R” – Applies the RIDGE option when setting elevations along HX lines using Read GIS Z HX Line.<br />
“S” – The “S” flag is a legacy and is not recommended unless <a href="#tcfAdjustHeadatESTRYInterface">Adjust Head at ESTRY Interface</a> has been set to ON. Note, the “S” flag is only supported by TUFLOW Classic.<br />
“Z” – Adjust the ZC elevation at each cell at/along the 2D HX object to slightly above the 1D node bed elevation where the 2D HX ZC value is lower. The ZC elevation is set to 1mm above the interpolated 1D node bed less the Cell Wet/Dry Depth. An error occurs if the 2D cell ZC elevation is not above the interpolated 1D node bed. Also see <a href="tcfHXZCCheck">HX ZC Check</a>. It is not recommended to use the Z flag without first checking that the reason for the discrepancy in elevations between 1D and 2D domains is appropriate.</p>
<p><b>QT</b>:<br />
“A” – Do not use – not recommended or supported. Applies the original QT boundary, which required flow volume and direction inputs.</p>
<p><b>SX</b>:<br />
“Z” – Adjust the ZC elevation at each cell at/along/within the 2D SX object to below the 1D node bed elevation where ZC is higher. The ZC elevation is set to the Cell Wet/Dry Depth below the 1D node bed. An error occurs if the minimum ZC elevation plus the Cell Wet/Dry Depth at/along a SX object is not below the connected 1D node bed. Also see SX ZC Check permits the user to define a maximum change in ZC elevation. It is not recommended to use the Z flag without first checking that the reason for the discrepancy in elevations between 1D and 2D domains is appropriate.<br />
For SGS model, the minimum elevation inside a 2D cell is used to judge whether the 2D cell needs to be lowered or not.</p>
<p><b>SX</b>:<br />
“U” – No longer recommended or supported – replaced by the SD and SH boundary options. Was originally used to indicate that the 2D domain receives the flow (in or out) from the 1D domain, but does not set the water level at the 1D node. This allows pumps (modelled as a 1d_bc “QH” or other Q boundary at the 1D node) to discharge into or extract water from the 2D domain.</p>
<b>CD</b>, <b>CN</b>, <b>HS</b>, <b>QC</b>, <b>RF</b>, <b>VC</b>, <b>WT</b>, <b>ZP</b>, <b>GT</b>: Not used.
</td>
<td style="text-align:left;">
Char(3)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p><b>HS</b>, <b>HT</b>, <b>QT</b>, <b>RF</b>, <b>SD</b>, <b>SH</b>, <b>ST</b>, <b>VG</b>, <b>WT</b>, <b>GT</b>: The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).</p>
<p><b>HQ</b>: As per above, however, if using the HQ automatic stage-discharge curve generation (i.e. b attribute is greater than zero), this attribute is ignored.</p>
<b>CD</b>, <b>CN</b>, <b>HX</b>, <b>QC</b>, <b>SX</b>, <b>VC</b>, <b>ZP</b>: Not used.
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
f
</td>
<td style="text-align:left;">
<p><b>HT</b>, <b>QT</b>, <b>RF</b>, <b>ST</b>, <b>VG</b>: Multiplication factor applied to the boundary values. f is assigned a value of one (1) (which has no effect) if the absolute value is less than 0.0001. The values may also be factored using the ValueMult keyword (see Table <a href="#tab:tab-KeywordDescriptions">85</a>).</p>
<p><b>HS</b>: Multiplication factor applied to the amplitude. A value of one (1) is applied if the field is left blank.</p>
<p><b>CN</b>: When used in conjunction (snapped) with a 2D HX object, sets the proportion or weighting to be applied in distributing the water level from the 1D node to the 2D cell. One or two 1D nodes can be connected to the same point on a 2D HX object. <b>Checks are made that the sum of all CN f values connected to a 2D HX point or 2D HX line node equals one (1)</b>. If only one 1D node is connected, set f to one (1). An f value of zero (less than 0.001) is set to one (1).</p>
<p><b>CD</b>: The code value (see Table <a href="#tab:tab-CellCodes">51</a>) to be assigned to cells falling on or within the object.</p>
<p><b>SX</b>: An offset for determining cell invert levels for distributing flows.</p>
<p><b>ZP</b>: Used to set the elevation of the 2D cells selected by the HX line. To adjust the height of the HX cells (usually to represent the levee crest or overtopping height) use ZP points snapped to the vertices of the HX line. If there are no points snapped to the HX line a CHECK is issued and the Zpt elevations of the HX cells are unchanged. ZP points are only used by Read GIS Z HX Line.</p>
<b>HX</b>, <b>QC</b>, <b>VC</b>, <b>HQ</b>, <b>GT</b>: Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
d
</td>
<td style="text-align:left;">
<p><b>2D</b>: The minimum distance between 2D2D water level control points between vertices along the 2D line. If set to zero, only the vertices along the 2D line are used. This value should not be less than the larger of the two 2D domains’ cell sizes.</p>
<p><b>HT</b>, <b>QT</b>, <b>RF</b>, <b>ST</b>, <b>VG</b>: Amount added to the boundary values after the multiplication factor f above. Values may also be adjusted using the ValueAdd keyword (see Table <a href="#tab:tab-KeywordDescriptions">85</a>).</p>
<p><b>HX</b>, <b>ZP</b>: Used to adjust the elevations up or down by the amount of the d attribute. Performs a similar function to the dZ attribute for 2d_zsh layers (see Table <a href="#tab:tab-ZShapeAttribute">54</a>). For example, to raise the 2D HX cells by 0.2 metres set d to 0.2 (note this only applies if ZP points are snapped to the HX line). Only used by Read GIS Z HX Line.</p>
<p><b>HQ</b>: Used to specify the max depth to be used for generating the curve (if less than 1m it is set to 1m).</p>
<p><b>QC</b>, <b>VC</b>: The value of constant velocity or flow.</p>
<p><b>SX</b>: Reserved – set to zero.</p>
<b>CD</b>, <b>CN</b>, <b>GT</b>: Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
td
</td>
<td style="text-align:left;">
<p><b>HT, QT, RF, ST, VG</b>: Incremental amount added per cell to the boundary’s time values. Time values may also be adjusted using the TimeAdd keyword (see Table <a href="#tab:tab-KeywordDescriptions">85</a>).</p>
<p><b>HS</b>: Incremental phase lead or lag in degrees per cell along the boundary.</p>
<p><b>SX</b>: Reserved – set to zero.</p>
<b>CD, CN, HX, QC, VC, ZP, GT</b>: Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
a
</td>
<td style="text-align:left;">
<p><b>2D</b>: Increasing this value from the default of 2 may improve stability, though may unacceptably attenuate results.</p>
<p><b>HT, VG</b>: Incremental adjustment of the multiplication factor per cell along the boundary. For the nth cell along the boundary the water level or cell elevation (h<sub>n</sub>) is adjusted according to:</p>
<p><span class="math display">\[h_{n} = h_{1}\:(1\:+\:a\:(n-1))+b\:(n-1)\]</span></p>
<p>where h1 is the water level at the first cell.</p>
<p><b>HS</b>: Incremental adjustment of the amplitude per cell along the boundary. For the n<sup>th</sup> cell along the boundary the amplitude (<span class="math inline">\(A\)</span>) is adjusted according to:</p>
<p><span class="math display">\[A_{n} = A_{n-1}+a\]</span></p>
<p><b>HX</b>: Used to add FLC value to all HX cells along the HX line. This can be useful for 1D/2D models where additional energy losses are needed to model the flow between a river (1D) and the floodplain (2D). Set to zero for backward compatibility. Alternatively, Read GIS FLC can be used.</p>
<p><b>QT</b>: Can be used to stabilise the boundary if needed by adding more “storage”. The default value is 5. Note: increasing this number by excessive amounts can unacceptably attenuate the hydrograph.</p>
<p><b>QC, QT (with A Flag), VC</b>: Angle of flow direction in degrees relative to the X-axis, (the X-axis left to right is 0°, Y-axis bottom to top is 90°).</p>
<p><b>SX</b>: Storage of the SX boundaries is based on the storage of the associated 1D node. The “a” attribute is a storage multiplier for the SX (but does not modify the associate 1D node storage). For example setting the value to 2 will double the storage. Note that an “a” value of 0.0 assumes a multiplier of 1.0.</p>
<b>CD, CN, RF ST, ZP</b>, <b>GT</b>: Not used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
b
</td>
<td style="text-align:left;">
<p><b>HT, QT (with A Flag), RF, ST, VG</b>: Incremental amount added per cell to the boundary values after any incremental multiplication factor. Values may also be adjusted using the ValueAdd keyword (see Table <a href="#tab:tab-KeywordDescriptions">85</a>).</p>
<p><b>HQ</b>: Water surface slope in m/m for automatic calculation of the stage-discharge relationship. If b is greater than zero, the automatic approach is adopted irrespective of whether the Name attribute is blank or not.<br />
Also see Blank HQ Slope.</p>
<p><b>HS</b>: Incremental amount added per cell to the mean water level.</p>
<p><b>CD, CN, QC, SX, VC, ZP, GT</b>: Not used.</p>
<b>HX</b>: Adjusts the WrF value along HX lines to adjust or calibrate the flow rate across a 1D/2D HX link when upstream controlled weir flow occurs. This is compatible with TUFLOW Classic only. This field similar to using the “a” attribute for applying additional energy (form) loss along the HX line which is valid for TUFLOW Classic and HPC models.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="id_2DBndSlopingLevel-3"><span class="header-section-number">8.5.1.1</span> Sloping Water Level Boundaries<a href="#id_2DBndSlopingLevel-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Temporally and spatially varied 2D water level boundary can be defined by combining some of the boundary types listed in Table <a href="#tab:tab-twoDBoundary">77</a>. This feature is particularly useful for coastal models where the tidal boundary varies in height and phase along the boundary. To do this, digitise a 2d_bc HX line along the boundary. At the ends of the boundary, and at any vertices in between, digitise 1d_bc HT (or HS) boundaries (ensure they are snapped to the 2d_bc HX line). At each 1D HT boundary specify the water level versus time hydrograph at that location (or use a HS curve). The water levels along the 2D HX line are based on a linear interpolation of the 1D HT/HS hydrographs. An example of this set up is shown in Figure <a href="#fig:fig-slopingWL">77</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-slopingWL"></span>
<img src="images/sloping-water-levels.png" alt="Sloping Water Level Boundaries" width="80%" />
<p class="caption">
Figure 77: Sloping Water Level Boundaries
</p>
</div>
<h4 class="hasAnchor" id="GT-4"><span class="header-section-number">8.5.1.2</span> Groundwater Boundaries<a href="#GT-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>At the edges of the active model area, two boundary conditions are currently
supported for the groundwater layers:</p>
<ol style="list-style-type: decimal">
<li>Sealed boundary, no inflow or outflow (default in absence of defined
boundary); and<br />
</li>
<li>Groundwater level vs time (type “GT”) as detailed in
Table <a href="#tab:tab-twoDBoundary">77</a>.</li>
</ol>
<p>To specify a groundwater level vs time boundary, a “GT” type
boundary line can be digitised in the 2d_bc file format. The same
groundwater level boundary applies to all vertical layers. If the
specified groundwater level is below the elevation at the bottom of the
layer, it is dry. If the specified groundwater level is above the
elevation at the top of the layer, the layer is fully saturated.</p>
<h3 class="hasAnchor" id="SA-Layers-3"><span class="header-section-number">8.5.2</span> Source Area Boundaries<a href="#SA-Layers-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A 2d_sa layer is used to define a Source – Area boundary (flow or rainfall vs time), applying the flow directly onto the cells within the digitised polygon. Negative values remove water directly from the cell(s). There are multiple options regarding these boundaries:</p>
<ul>
<li>Source - Area boundary (2d_sa) - see Section <a href="#SA-Option-4"><strong>??</strong></a>.</li>
<li>Source - Area Rainfall boundary (2d_sa_rf) - see Section <a href="#RFOption-4"><strong>??</strong></a>.</li>
<li>Source - Area Trigger option (2d_sa_tr) - see Section <a href="#TriggerOption-4"><strong>??</strong></a>.</li>
<li>Source - Area Flow option (2d_sa_po) - see Section <a href="#FlowFeature-4"><strong>??</strong></a>.</li>
</ul>
<h4 class="hasAnchor" id="SA-Option-4"><span class="header-section-number">8.5.2.1</span> Source Area Options (2d_sa)<a href="#SA-Option-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are a number of options for distributing flows to cells within a SA region, these are:</p>
<ul>
<li>Distributed firstly to the lowest cell and then distributing between wet cells (<a href="#tbcReadGISSA">Read GIS SA</a>). This is the default option.<br />
</li>
<li>Distributed to 2D cells connected to 1D pits (<a href="#tbcReadGISSA">Read GIS SA <strong>PITS</strong></a>).<br />
</li>
<li>Distributed to all cells equally (<a href="#tbcReadGISSA">Read GIS SA <strong>ALL</strong></a>).<br />
</li>
<li>Distributed using to streamlines (<a href="#tbcReadGISSA">Read GIS SA <strong>STREAM ONLY</strong></a>).</li>
</ul>
<!--DRK: An image would help here.  I might have one, will check-->
<p>The cells that the SA polygons are applying flow to can be checked using the <a href="http://wiki.tuflow.com/Check_Files_2d_sac">_sac_check</a> layer.</p>
<p>When distributing the water between the cells there are two options that can be specified in the .tcf. These are:</p>
<ul>
<li><a href="#tcfSAminDepth">SA Minimum Depth</a>, this sets a minimum depth below
which flow will not be distributed to the cell (apart from the lowest
cell). The default minimum depth is -99999 (i.e. 0 depth,
representing a dry cell).<br />
</li>
<li><a href="#tcfSAPropDepth">SA Proportion to Depth</a>, this command proportions
the SA inflows according to the depth of water. The default is ON,
which proportions the flow according to the depth of water in the
cells with deeper cells getting more flow.</li>
</ul>
<p>The <strong>PITS</strong> option directs the inflow to 2D cells that are connected to a
1D pit or node connected to the 2D domain using “SX” for the Conn_1D_2D
(previously Topo_ID) 1d_nwk attribute. The inflow is spread equally over
the applicable 2D cells. An ERROR occurs if no 2D cells are found within
the region.</p>
<p>The <strong>ALL</strong> option is available to apply the flow/rainfall to all active cells (either wet or dry cells) within the region. Not including any inactive or cells that have a water level boundary or HX 1D/2D linkage applied. If
using the ALL option the double precision (see Section <a href="#iSPdSP-3"><strong>??</strong></a>) version may be needed when using TUFLOW Classic as this is a similar approach to direct rainfall modelling.</p>
<p>The <strong>STREAMS ONLY</strong> option is used in combination with the <a href="#tbcReadGISStreams">Read GIS Streams</a> command. It will only apply the SA inflows to the streamline cells (i.e. no non-streamline wet cells in the SA region will receive an inflow). This is discussed further in Section <a href="#Streamlines-4"><strong>??</strong></a>.</p>
<p>Table <a href="#tab:tab-SACombined">79</a> lists the attributes for 2d_sa layers which are referenced in the .tbc file using the command <a href="#tbcReadGISSA">Read GIS SA</a> to read in flow hydrographs</p>
<table>
<caption>
<span id="tab:tab-SACombined">Table 79: </span><strong>2D Source over Area (2d_sa) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).</p>
The 2023-03 release changes the behaviour of HPC and Classic models that use multiple SA polygons with the same boundary name. In the 2023-03 release or newer, these boundaries are treated separately; as if they were different boundary names with the same hydrograph. Previously, these SA boundaries would be treated as a single boundary and the cells selected by each polygon would be grouped together. If duplicate SA boundary names are encountered, TUFLOW will issue <a href="https://wiki.tuflow.com/TUFLOW_Message_2492">CHECK 2492</a> in the 2023-03 Release.
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
</tbody>
</table>
<h5 class="hasAnchor" id="Streamlines-4"><span class="header-section-number">8.5.2.1.1</span> Streamlines<a href="#Streamlines-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Streamlines allow the user to apply SA inflows along the waterways rather than to the lowest cell (when all cells are dry within the SA region). This approach can be useful to apply baseflows to a river channel for instance. If streamlines have been specified using the .tbc <a href="#tbcReadGISStreams">Read GIS Streams</a> command, SA inflows are distributed along the 2D cells selected by the stream lines within each SA region.</p>
<p><a href="#tbcReadGISStreams">Read GIS Streams</a> can be used one or more times in the .tbc file to define streamline cells. Streamlines are line objects, usually representing the path of the waterways. One attribute is required, which is the Stream Order as an integer type, as shown in Table <a href="#tab:tab-STRM">80</a>. Only objects with a Stream Order greater than zero (0) are used by TUFLOW. Therefore, streams that are not to be used for applying SA inflows can be assigned a stream order of 0 (or deleted from the layer). The 2D cells along a streamline are selected as a series of continuous cells in the same
manner as any other boundary line.</p>
<p>GIS and other software have the ability to generate streamlines from DEMs, and usually assign a stream order to each stream line. If needed, rearrange (or copy) the attributes so that the first attribute is the specified stream order. Alternatively, use the ‘<a href="https://wiki.tuflow.com/QGIS_TUFLOW_Insert_TUFLOW_Attributes_to_Existing_Layer">Insert TUFLOW Attributes to existing GIS layer</a>’ tool within the QGIS TUFLOW Plugin.</p>
<p>By default, any wet cells that are not streamline cells are also included in the distribution of the SA inflow. The commands <a href="#tbcReadGISSA">Read GIS SA STREAM ONLY</a> and <a href="#tbcReadGISSA">Read GIS SA STREAM IGNORE</a> provide options for controlling streamline inflows.</p>
<p>The <a href="http://wiki.tuflow.com/Check_Files_2d_sac">_sac_check</a>
layer will show those cells selected as streamline cells.</p>
<table>
<caption>
<span id="tab:tab-STRM">Table 80: </span><strong>Streamlines (2d_strm) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Stream Order
</td>
<td style="text-align:left;">
The stream order. Objects with a stream order greater than 0 are used.
</td>
<td style="text-align:left;">
Integer
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="RFOption-4"><span class="header-section-number">8.5.2.2</span> Rainfall Option (2d_sa_rf)<a href="#RFOption-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="#tbcReadGISSA">Read GIS SA <strong>RF</strong></a> (rainfall) option calculates flow from an input rainfall hyetograph based on catchment area, initial loss and continuing loss information specified in the 2d_sa_rf GIS file. Boundary condition inputs are specified as a rainfall hyetograph (mm versus hours) instead of flow hydrographs, which is required for the other <a href="#tbcReadGISSA">Read GIS SA</a> options.</p>
<p>Initial and continuing loss values applied through the Materials Definition file (.tmf or .csv format) are ignored when using the <a href="#tbcReadGISSA">Read GIS SA <strong>RF</strong></a> (rainfall) option.</p>
<table>
<caption>
<span id="tab:tab-SA-RF">Table 81: </span><strong>2D Source over Area Rainfall (2d_sa_rf) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).</p>
The 2023-03 release changes the behaviour of HPC and Classic models that use multiple SA polygons with the same boundary name. In the 2023-03 release or newer, these boundaries are treated separately; as if they were different boundary names with the same hydrograph. Previously, these SA boundaries would be treated as a single boundary and the cells selected by each polygon would be grouped together. If duplicate SA boundary names are encountered, TUFLOW will issue <a href="https://wiki.tuflow.com/TUFLOW_Message_2492">CHECK 2492</a> in the 2023-03 Release.
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Catchment_Area
</td>
<td style="text-align:left;">
<p>Additional attribute for the RF Option (<a href="#tbcReadGISSA">Read GIS SA RF</a> Command).</p>
<p>The contributing catchment area in m<sup>2</sup> (if using SI units) or miles<sup>2</sup> (if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).</p>
<b>Note: This attribute is required as the polygon area is not used as the sub-catchment area because the rainfall area may be different to the polygon extent. A value of zero will trigger <a href="https://wiki.tuflow.com/TUFLOW_Message_2460">ERROR 2460</a>.</b>
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Rain_Gauge_Factor
</td>
<td style="text-align:left;">
<p>A multiplier that allows for adjusting the rainfall due to spatial variations in the total rainfall.</p>
A value of zero will cause <a href="https://wiki.tuflow.com/TUFLOW_Message_2460">ERROR 2460</a> and the simulation will halt, see also <a href="#tcfZeroRainfallCheck">Zero Rainfall Check</a> command.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
IL
</td>
<td style="text-align:left;">
The Initial Loss amount in mm on inches (if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
CL
</td>
<td style="text-align:left;">
The Continuing Loss rate in mm/hr or inches/hr (if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="TriggerOption-4"><span class="header-section-number">8.5.2.3</span> Trigger Option (2d_sa_tr)<a href="#TriggerOption-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><a href="#tbcReadGISSA">Read GIS SA <strong>TRIGGER</strong></a> option allows the initiation
of inflow hydrographs based on a flow or water level trigger. For
example, reservoir failures can be initiated based on when the flood
wave reaches the reservoir. An example of this option is:</p>
<p><tcmd>Read GIS SA Trigger</tcmd><teq> == </teq><tblk>gis\2d_sa_tr_dambreaks.shp</tblk></p>
<p>The 2d_sa_tr layer is a 2d_sa layer (with one attribute, Name), to which
three additional attributes are added, as listed in Table <a href="#tab:tab-SA-TR">82</a>. These are:</p>
<ul>
<li>Trigger_Type<br />
</li>
<li>Trigger_Location<br />
</li>
<li>Trigger_Value</li>
</ul>
<p>Every timestep during the simulation, the flow (Q_) or water level
(H_) of the 2d_po object referenced by Trigger_Location is monitored.
When the 2d_po exceeds the Trigger_Value value the SA hydrograph
commences.</p>
<p>If applying the hydrograph as a dam break, when digitising the SA
trigger polygon, it should preferably be on the downstream side of the
dam wall, extending the width of the dam wall and possibly be several
cells thick (in the direction of flow). If there are stability issues,
enlarging the SA polygon will help, however applications have indicated
the feature typically performs well with the SA polygon a few cells
thick.</p>
<p>The 2d_po line (flow) or point (water level) referred to by
Trigger_Location can be located anywhere in the model. For cascade
reservoir failure modelling it would usually be modelled using a 2d_po
flow line, or for a 2d_po water level point just upstream of the dam.</p>
<p><strong>Note: 2d_po flow lines MUST be digitised from LEFT to RIGHT looking
downstream (if not, the flow across the 2d_po line will be negative and
the trigger value will never be reached).</strong></p>
<table>
<caption>
<span id="tab:tab-SA-TR">Table 82: </span><strong>2D Source over Area Trigger (2d_sa_tr) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).</p>
The 2023-03 release changes the behaviour of HPC and Classic models that use multiple SA polygons with the same boundary name. In the 2023-03 release or newer, these boundaries are treated separately; as if they were different boundary names with the same hydrograph. Previously, these SA boundaries would be treated as a single boundary and the cells selected by each polygon would be grouped together. If duplicate SA boundary names are encountered, TUFLOW will issue <a href="https://wiki.tuflow.com/TUFLOW_Message_2492">CHECK 2492</a> in the 2023-03 Release.
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Trigger_Type
</td>
<td style="text-align:left;">
Trigger_Type must be set to “Q_” or “Flow” for a trigger based on a flow rate, or “H_” or “Level” for a trigger based on a water level.
</td>
<td style="text-align:left;">
Char(40)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Trigger_Location
</td>
<td style="text-align:left;">
Trigger_Location is the PO Label in a 2d_po layer (see Section <a href="#PlotOutput-4"><strong>??</strong></a>). The 2d_po Type attribute must also be compatible with the Trigger_Type (i.e. it must include Q_ or H_ as appropriate).
</td>
<td style="text-align:left;">
Char(40)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Trigger_Value
</td>
<td style="text-align:left;">
Trigger_Value is the flow or water level value that triggers the start of the SA hydrograph.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="FlowFeature-4"><span class="header-section-number">8.5.2.4</span> Flow Feature (2d_sa_po)<a href="#FlowFeature-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- EFC to PAR: do any updates need to be made here now we have interflow?-->
<!-- PAR to EFC: test-->
<!-- EFC to DRK: have asked AL to do this-->
<!-- EFC: Rusty tested. Works in Classic but not HPC/QDT -->
<p>The <a href="#tbcReadGISSA">Read GIS SA <strong>PO</strong></a> option models seepage or
infiltration based on a varying water level or flow rate elsewhere in
the model. This functionality is available when using TUFLOW Classic only. For example, modelling the seepage of groundwater into a
coastal lagoon that is dependent on the water level in the lagoon.</p>
<p>The feature is set up as follows:</p>
<ol style="list-style-type: decimal">
<li>Create a 2d_po point object of Type “H_” at the water level location.<br />
</li>
<li>Add “<tcmd><a href="#tcfReadGISPO">Read GIS PO</a> </tcmd><teq>==</teq><tblk> …</tblk>” to the .tcf file if not
already there.<br />
</li>
<li>Create a new 2d_sa_po layer, as listed in Table <a href="#tab:tab-SA-PO">83</a>. As of the 2023-03-AF release this layer is automatically created when using the <a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a> command, previously this layer had to be created manually by adding the two following attributes to a 2d_sa layer:
<ol style="list-style-type: decimal">
<li>PO_Type: Char of length 16<br />
</li>
<li>PO_Label: Char of max length 40<br />
</li>
</ol></li>
<li>Digitise the SA polygon(s) covering the area of seepage or
infiltration and for the attributes:
<ol style="list-style-type: decimal">
<li>Set the Name attribute to the name of the water level vs flow
curve in the BC database.<br />
</li>
<li>Set PO_Type to “H_”.<br />
</li>
<li>Set PO_Label to the PO Label of the relevant 2d_po “H_” point
to be used to determine the flow from the h vs Q curve.<br />
</li>
</ol></li>
<li>Add “<tcmd><a href="#tbcReadGISSA">Read GIS SA PO</a> </tcmd><teq>==</teq><tblk> …</tblk>” to the .tbc file.</li>
</ol>
<p>Alternatively, to base the SA flow on the flow elsewhere in the model,
use a 2d_po line object of Type “Q_”. To check the SA in/outflow:</p>
<ol style="list-style-type: decimal">
<li>View the _MB.csv files. The SA in/outflow from the seepage or infiltration will be part/all of the SS columns.<br />
</li>
<li>Add “SS” to the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command. This outputs the net in/outflow from all source flows (ST, SA, SX and rainfalls) over time.</li>
</ol>
<table>
<caption>
<span id="tab:tab-SA-PO">Table 83: </span><strong>2D Source over Area Flow Feature (2d_sa_po) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).</p>
The 2023-03 release changes the behaviour of HPC and Classic models that use multiple SA polygons with the same boundary name. In the 2023-03 release or newer, these boundaries are treated separately; as if they were different boundary names with the same hydrograph. Previously, these SA boundaries would be treated as a single boundary and the cells selected by each polygon would be grouped together. If duplicate SA boundary names are encountered, TUFLOW will issue <a href="https://wiki.tuflow.com/TUFLOW_Message_2492">CHECK 2492</a> in the 2023-03 Release.
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
PO_Type
</td>
<td style="text-align:left;">
PO_Type must be set to “Q_” to set the SA flow in/out of a model based on a flow rate, or “H_” to base it on a water level.
</td>
<td style="text-align:left;">
Char(16)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
PO_Label
</td>
<td style="text-align:left;">
PO_Label is the Label attribute in a 2d_po layer (see Section <a href="#PlotOutput-4"><strong>??</strong></a>). The 2d_po Type attribute must also be compatible with the PO_Type (i.e. it must include Q_ or H_ as appropriate).
</td>
<td style="text-align:left;">
Char(40)
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="OverlappingSA-4"><span class="header-section-number">8.5.2.5</span> Overlapping 2d_sa regions<a href="#OverlappingSA-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>SA regions may overlap and their respective source terms apply
cumulatively on a cell by cell basis. With the TUFLOW Classic solution
scheme there is no limit to the number of regions that stack up (i.e.
overlap) at a given location. However, for the TUFLOW HPC scheme, the
number of 2d_sa regions that apply at a given cell is limited to 4. If
the model also utilises 2d_rf rainfall regions (Section <a href="#Rainfall-3"><strong>??</strong></a>),
then these are also included in this limit (i.e. the maximum stacking
depth of 2d_sa <em>and</em> 2d_rf regions is limited to 4). For HPC and
Quadtree, the stack depth is checked at each cell and
<a href="https://wiki.tuflow.com/TUFLOW_Message_2443">ERROR 2443</a>
will result if the limit is exceeded.</p>
<h3 class="hasAnchor" id="Rainfall-3"><span class="header-section-number">8.5.3</span> Rainfall Boundaries<a href="#Rainfall-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="RainfallOverview-4"><span class="header-section-number">8.5.3.1</span> Rainfall Overview<a href="#RainfallOverview-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Four approaches are available for applying rainfall directly to the 2D cells. These are listed below and described in the following sections.</p>
<ul>
<li>Global rainfall: the same rainfall applies spatially over the model.</li>
<li>2d_rf layers: polygons are assigned a rainfall gauge and spatial and temporal adjustment factors.</li>
<li>Gridded rainfall: rainfall distribution over time as a series of grid files (.tif, .flt, .asc) or in a NetCDF file.</li>
<li>A rainfall control (.trfc) file: allows the user to specify
rainfall gauges/points over the model and a series of commands to
control how the rainfall is interpolated. This approach generates a
series of rainfall grids available to the user for display or
checking.</li>
</ul>
<h4 class="hasAnchor" id="RainfallConsiderations-4"><span class="header-section-number">8.5.3.2</span> Considerations for Rainfall Modelling<a href="#RainfallConsiderations-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When using rainfall as a principal source of the water within a model the following considerations should be made:</p>
<!-- EFC to PAR: can you please fill this section out? We could link to this page https://wiki.tuflow.com/Direct_Rainfall_(Rain_on_Grid)_Modelling_Guidance


- Need to include entire catchment in active area
- Suggest HPC for direct rainfall and maybe link to paper / preso on the importance of SGS for direct rainfall
- Losses as rainfall or soil losses

-<!- PAR to EFC: have a go at writing this, https://www.tuflow.com/media/7545/2022-direct-rainfall-hydraulic-model-validation-ryan-et-al-hwrs.pdf
-->
<ul>
<li>The entire catchment area should be included in the active code area.</li>
<li>It is highly recommended to use HPC, and sub-grid sampling (SGS), when modelling using direct rainfall. SGS has been found to significantly improve direct rainfall modelling by low flow transmission of water with minimal retention or blocking of flows <span class="citation">(<a href="#ref-Ryan2022">Ryan et al., 2022</a>)</span> plus significantly reduced sensitivity to cell size <span class="citation">(<a href="#ref-Kitts2020">Kitts et al., 2020</a>)</span>.<!-- DRK: Add Kitts et al reference--><!--done--><br />
</li>
<li>TUFLOW supports a range of rainfall loss and soil infiltration options, for a comparison of these approaches, see the <a href="https://wiki.tuflow.com/Direct_Rainfall_(Rain_on_Grid)_Modelling_Guidance#What_is_the_difference_between_rainfall_excess_and_soil_infiltration.3F">TUFLOW Wiki</a>. These are split into two broad categories, defined by their respective calculation methods:
<ul>
<li>Rainfall Excess Losses: This initial and continuing loss approach is a simplistic calculation method comparable to the rainfall excess loss methods included in traditional hydrology models.<br />
</li>
<li>Soil Infiltration Losses: This approach is a more realistic representation of the actual physics associated with water infiltration into the soil and is recommended when using direct rainfall modelling.</li>
</ul></li>
<li>Evaporation is typically implemented with a global negative rainfall. The 2023-03 release allows for negative rainfall to draw from the topmost groundwater layer under surface layer cells that are dry, thus mimicking evapotranspiration. See Section <a href="#top-gw-drying-4"><strong>??</strong></a>. Prior to the 2023-03 release this would only decrement the water in wet cells - until they dry – and would not draw from the cumulative infiltration layer.</li>
<li>Choice of wet-dry depth threshold. For models with intense
rainfall, the water depths usually quickly exceed the default <a href="#tcfCellWetDryDepth">Cell
Wet/Dry Depth</a> of 0.002 m (SI units), but for models with long
periods of light to moderate rates of rainfall or steap slopes, the water depths may be
close to the threshold causing the the cells to alternate between wet
and dry status as the “sheet flow” moves in waves over the terrain. This
behaviour is not desirable, and is avoided by reducing the wet-dry depth
threshold. For models with rainfall, a <a href="#tcfCellWetDryDepth">Cell
Wet/Dry Depth</a> of 0.0002 m (or 0.0007ft if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>) is
recommended for both Classic and HPC solution schemes, unless using SGS. For HPC models with SGS enabled, lowering the <a href="#tcfCellWetDryDepth">Cell
Wet/Dry Depth</a> is not necessary, as the wetting/drying occurs in the SGS storage curve.</li>
<li>Model Precision: TUFLOW Classic uses an implicit finite difference solver for which the
primary state variable is the water elevation. The use of water
elevation as the primary variable can have limitations when run in
single precision. When computing differences in water elevations between
adjoining cells, numerical precision errors arise when the model has
high altitude DEM data, or very thin sheet flow (i.e. rainfall models).
When using TUFLOW Classic for models with high altitude and/or rainfall,
it is therefore advisable to run the model with the double precision
executable, see Section <a href="#iSPdSP-3"><strong>??</strong></a>.The .tcf command
<tcmd><a href="#tcfModelPrecision">Model Precision</a></tcmd><teq> == </teq><tblk>Double</tblk> can be used to ensure
that only a double precision version of TUFLOW is used.
TUFLOW HPC (including Quadtree) uses an explicit finite volume scheme
based on water depth, and the single precision executable generally
works well for models with high altitude and/or rainfall. If in doubt,
or even just curious, the user may re-run the same model in double
precision and compare the results.</li>
</ul>
<h4 class="hasAnchor" id="RF-Global-4"><span class="header-section-number">8.5.3.3</span> Global Rainfall<a href="#RF-Global-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To apply a uniform rainfall to all active cells, the .tbc command <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a> may be used. The <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a> command applies a rainfall depth to every active cell within the 2d_code layer based on the input hyetograph. The input hyetograph must be in mm versus time (or inches versus time if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>), and is applied using a stepped approach. The stepped approach holds the rainfall constant for the time interval (i.e. the rainfall has a histogram stair-step shape). This means, for example, the second rainfall value in the time-series is applied as a constant rainfall from the first time value to the second time value. As with all rainfall boundaries, the first and last rainfall entries should be set to zero, otherwise these rainfall values are applied as a constant rainfall if the simulation starts before or extends beyond the first and last time values in the rainfall time-series. The hyetograph information is converted to a flow, and the flow then applied at each cell. The histogram conversion takes into account any losses and can be found in the TLF file (search ‘Global Rainfall histogram’).</p>
<p>As of the 2020-10 release, for TUFLOW Classic models, if rainfall losses have been applied in a materials file (see Section <a href="#Materials-File-4"><strong>??</strong></a>) they will be applied to the global rainfall. Prior to the 2020-10 release, for TUFLOW Classic, they weren’t applied. In TUFLOW HPC models they were already applied in releases prior to 2020-10. In both solvers, if rainfall losses have been specified in the materials file (.csv or .tmf) in conjunction with the <a href="#tbcGlobalRainfallInitialLoss">Global Rainfall Initial Loss</a> or <a href="#tbcGlobalRainfallContinuingLoss">Global Rainfall Continuing Loss</a> commands, the losses in the materials file are applied and the global rainfall loss commands ignored (and <a href="https://wiki.tuflow.com/TUFLOW_Message_2244">WARNING 2244</a> reported). Alternatively, Soil infiltration losses can be used (see Section <a href="#Infiltration-2"><strong>??</strong></a>).</p>
<p>The <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> RFR and RFC may be used to view the rainfall rate (mm/hr or inch/hr) and cumulative rainfall (mm or inch) over time respectively (see Table <a href="#tab:tab-ExcludingHazard">102</a>).</p>
<p>An example of global direct rainfall model is provided in <a href="https://wiki.tuflow.com/Tutorial_M06#Part_1_-_Global_Rainfall">Module 6 - Part 1</a>.</p>
<h4 class="hasAnchor" id="RF-Layers-4"><span class="header-section-number">8.5.3.4</span> Rainfall Polygons (2d_rf)<a href="#RF-Layers-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The 2d_rf GIS layer applies a rainfall depth to every active cell within the
digitised polygon, based on an input rainfall hyetograph. Table <a href="#tab:tab-DirectRainfall">84</a> lists the attributes in 2d_rf layers which are referenced in the .tbc file using the <a href="#tbcReadGISRF">Read GIS RF</a> command. The rainfall time-series data must be in mm versus time in hours (or inches versus time if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>). It is applied using a STEPPED approach. The STEPPED approach holds the rainfall
constant for the time interval (i.e. the rainfall has a histogram
stair-step shape). This means, for example, the second rainfall value in
the time-series is applied as a constant rainfall from the first time
value to the second time value. As with all rainfall boundaries, the
first and last rainfall entries should be set to zero (otherwise these
rainfall values are applied as a constant rainfall if the simulation
starts before or extends beyond the first and last time values in the
rainfall time-series).</p>
<p>The <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> RFR and RFC may be used to view the rainfall rate (mm/hr or inch/hr) and cumulative rainfall (mm or inch) over time respectively (see Table <a href="#tab:tab-ExcludingHazard">102</a>).</p>
<p>Initial and continuing losses can be applied on a material-by-material basis (see Section <a href="#Rainfall-Losses-4"><strong>??</strong></a>). Initial and continuing losses are not applied to negative rainfall values (to model infiltration/evaporation). Alternatively, Soil infiltration losses can be used (see Section <a href="#Infiltration-2"><strong>??</strong></a>)</p>
<p>If the same rainfall is to be applied to all active cells in the model,
the .tbc command <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a> may be used
in lieu of digitising a 2d_rf layer (see Section <a href="#RF-Global-4"><strong>??</strong></a>).</p>
<p>RF regions may overlap and their respective source terms apply
cumulatively on a cell by cell basis. For TUFLOW Classic there is no limit to the number of regions that stack up (i.e. overlap)
at a given location. However, for TUFLOW HPC (both uniform grid and
Quadtree grid), the number of 2d_rf regions that apply at a given cell
is limited to 4. If the model also utilises 2d_sa source regions
(Section <a href="#SA-Layers-3"><strong>??</strong></a>), then these are also included in this limit (i.e. the maximum stacking count of 2d_sa <em>and</em> 2d_rf regions is limited
to 4). For HPC and Quadtree, the stack depth is checked at each cell and
<a href="https://wiki.tuflow.com/TUFLOW_Message_2443">ERROR 2443</a> will result if
the limit is exceeded.</p>
<p>An example direct rainfall model using rainfall polygons is provided in <a href="https://wiki.tuflow.com/Tutorial_M06#Part_2_-_Rainfall_Polygons">Module 6 - Part 2</a>.</p>
<table>
<caption>
<span id="tab:tab-DirectRainfall">Table 84: </span><strong>2D Direct Rainfall over Area (2d_rf) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of the rainfall1 BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).</p>
<b>Note: If two or more RF inflows of the same Name cover the same cell, only the first RF inflow is used. It is recommended that each polygon has a unique Name and they do not overlap.</b>
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
f1
</td>
<td style="text-align:left;">
<p>A multiplier that allows for adjusting the rainfall due to spatial variations in the total rainfall. To vary the rainfall spatially, either apply different f1 and/or f2 attribute values to each polygon.</p>
<p>Values of f1 greater than 1 are permitted when using 2d_rf polygons or points in a <a href="#tcfRainfallControlFile">Rainfall Control File</a> (.trfc).</p>
A value of zero will cause <a href="https://wiki.tuflow.com/TUFLOW_Message_2460">ERROR 2460</a> and the simulation will halt, see also <a href="#tcfZeroRainfallCheck">Zero Rainfall Check</a> command.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
f2
</td>
<td style="text-align:left;">
<p>A second multiplier that allows for adjusting the rainfall spatially. A value of zero will cause zero rainfall to be applied.</p>
<p>Values of f2 greater than 1 are permitted when using 2d_rf polygons or points in a <a href="#tcfRainfallControlFile">Rainfall Control File</a> (.trfc).</p>
A value of zero will cause <a href="https://wiki.tuflow.com/TUFLOW_Message_2460">ERROR 2460</a> and the simulation will halt, see also <a href="#tcfZeroRainfallCheck">Zero Rainfall Check</a> command.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="GriddedRainfall-4"><span class="header-section-number">8.5.3.5</span> Gridded Rainfall<a href="#GriddedRainfall-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Rainfall may also be applied to the model using the .tcf command <a href="#tcfReadGridRF">Read
Grid RF</a>. The command references a .csv index containing
links to rainfall grids or a NetCDF file containing the time-varying data. This allows the applied rainfall to vary spatially across the
model without the need to digitise multiple polygons within a 2d_rf GIS
layer. If using the .csv file index the rainfall grids may be in any TUFLOW supported grid format (.tif, .flt, .asc), noting that .tif and .flt are much faster for TUFLOW to process than .asc.</p>
<p>For the .csv format the rainfall database contains two columns, the
first being time (in simulation hours) and the second being the rainfall
grid. There is no interpolation between times, so a stepped approach is
applied. Each rainfall grid applies from the time of the previous
rainfall grid in the .csv file up to the current time . Time increments do not
have to be a constant interval. An example of a rainfall database is shown
in Figure <a href="#fig:fig-image124">78</a>. The values within rainfall grid should be the rainfall depth in mm (or inches if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>) that
have fallen over the previous period. In the example below the values in
the 2<sup>nd</sup> rainfall grid should be the total rainfall depths
from time 0 to time 3 hours (i.e. not the rainfall intensity in
mm/h or inch/h).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image124"></span>
<img src="images/image124.png" alt="Example Rainfall Database"  />
<p class="caption">
Figure 78: Example Rainfall Database
</p>
</div>
<p>An example direct rainfall model using rainfall grids is provided in <a href="https://wiki.tuflow.com/Tutorial_M06#Gridded_Rainfall_.28Optional.29">Tutorial Module 6 - Optional</a>.</p>
<h4 class="hasAnchor" id="TRFC-File-4"><span class="header-section-number">8.5.3.6</span> Rainfall Control File (.trfc file)<a href="#TRFC-File-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Rainfall can be temporally and spatially controlled, including interpolation of rainfall gauges over time, using a series of commands in a <a href="#tcfRainfallControlFile">Rainfall Control File</a> (.trfc).</p>
<p>The .trfc commands generate rainfall grids based on point rainfall
gauges, with three methods available for spatial interpolation of the
rainfall distribution. The rainfall distribution varies over time
according to the rainfall at the gauges. The three methods for spatially
interpolating the rainfall are:</p>
<ul>
<li>IDW (Inverse Distance Weighting)<br />
</li>
<li>Polygons<br />
</li>
<li>TIN (Triangulation)</li>
</ul>
<p>When the rainfall control file is processed during model initialisation
a series of rainfall grids are output, which are then used by the
simulation to vary the rainfall over the 2D domain(s). This feature may
also be useful simply to generate the series of rainfall grids for other
purposes or display. The rainfall grids are pre-processed to reduce
memory usage whilst TUFLOW is running.</p>
<p>Note, only one .trfc file per 2D domain can be specified in the .tcf file
using the <a href="#tcfRainfallControlFile">Rainfall Control File</a> command.</p>
<p>An example of a total rainfall depth grid, output when using the .trfc IDW approach and four rainfall gauges, is shown in Figure <a href="#fig:fig-imageIDW">79</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-imageIDW"></span>
<img src="images/rf_total_IDW.png" alt="Example Depth Total Grid"  />
<p class="caption">
Figure 79: Example Depth Total Grid
</p>
</div>
<p>Of note is that the polygon approach is similar to using a series of
rainfall polygons read in via the .tbc <a href="#tbcReadGISRF">Read GIS RF</a>
command. However, the .trfc file approach is significantly more
memory efficient.</p>
<p>Whilst there isn’t a specific check file for the rainfall distribution
when using generated rainfall grids, another advantage of the
pre-processing of rainfall grids using this feature is that the grids it produces can be interrogated prior
to the end of the simulation for checking purposes. Note, the
generated rainfall grids are inclusive of adjustments made in the <a href="#tcfBCDatabase">BC Database</a> (e.g. multiplication factors used for climate change) and of adjustment factors in the input GIS
layer’s attributes, but not inclusive of rainfall losses that may be
specified in a materials file. The generated grids, together with a csv file for non NETcdf formats, can be utilised as gridded rainfall as per section <a href="#GriddedRainfall-4"><strong>??</strong></a> for subsequent simulations.</p>
<p><a href="#tcfMapOutputDataTypes">Map Output Data Types</a> RFR or RFC can also be specified (see Table <a href="#tab:tab-ExcludingHazard">102</a>), these are inclusive of rainfall losses, however these results are output as the simulation progresses.</p>
<p>Example .trfc files are available in the <a href="https://wiki.tuflow.com/TUFLOW_Rainfall_Control_File_Examples">TUFLOW
Wiki Example Models</a> and in <a href="https://wiki.tuflow.com/Tutorial_M06#Part_3_-_Rainfall_Control_File">Tutorial Module 6 - Part 3</a>.</p>
<p>Appendix <a href="#TRFCCommands-1"><strong>??</strong></a> lists and describes the available .trfc commands.</p>
<h2 class="hasAnchor" id="bcdbase-2"><span class="header-section-number">8.6</span> Boundary Condition (BC) Database<a href="#bcdbase-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A boundary condition (BC) database is created using spreadsheet software
such as Microsoft Excel. Two types of files are required:</p>
<ol style="list-style-type: decimal">
<li>A database or list of BC events, including information on where to
find the BC data.<br />
</li>
<li>One or more files containing the boundary data (e.g. flow, level,
rainfall data).</li>
</ol>
<p>The database file must be .csv (comma delimited) formatted, or HEC-DSS (see Section <a href="#HECDSS-3"><strong>??</strong></a>). It must contain a row with the pre-defined keywords ‘Name’ and ‘Source’, as listed in Table <a href="#tab:tab-KeywordDescriptions">85</a>. Other keywords control how data is extracted from the Source.</p>
<p>The BC data files can be in a variety of formats, as described for the
‘Source’ keyword in Table <a href="#tab:tab-KeywordDescriptions">85</a>. Additional formats can be incorporated upon
request. It is recommended that all .csv files originate from
<strong>one</strong> spreadsheet with a worksheet dedicated to each .csv file.
The Excel TUFLOW Tools.xlm macros can be used to export the worksheets
to .csv format, see Section <a href="#Excel-3"><strong>??</strong></a>.</p>
<p>The active BC database is specified using the <a href="#tcfBCDatabase">BC Database</a> (.tcf file),
<a href="#ecfBCDatabase">BC Database</a> (.ecf file) and/or <a href="#tbcBCDatabase">BC Database</a> (.tbc file) commands.
Note, specifying <a href="#tcfBCDatabase">BC Database</a> in the
.tcf file automatically applies to both 1D and 2D domains (i.e. there is
no need to specify the command in the .ecf or .tbc files). The active
database can be changed at any point by repeating the command in any of
these files.</p>
<p>The maximum line length (i.e. number of characters including spaces and
tabs) in a single line of a source file is 100,000 characters. If the keyword is not found in the “Name, Source” line, the default column is used to define the column of data for that keyword.</p>
<table>
<caption>
<span id="tab:tab-KeywordDescriptions">Table 85: </span><strong>BC Database Keyword Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Keyword
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default Column
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of a BC data location. The name must be the same name as used in the GIS 1d_bc, 2d_bc, 2d_sa, 2d_sa_rf or 2d_rf layers. It may contain spaces and other characters, though must not contain any commas. It is not case sensitive.</p>
<p>The name of a group of boundaries can be used for RAFTS (.loc and .tot files) and WBNM (via the .ts1 file format) hydrographs. For example, if “N1|Local” is the boundary Name in a 1d_bc or 2d_bc layer, then the group is interpreted as the text to the right of the “|” symbol (i.e. Local), and the text to the left is the ID (i.e. N1) of the time-series data in the file containing the hydrographs. In this example, TUFLOW:</p>
<ul>
<li>Searches for an entry “Local” in the Name column of the BC database.<br />
</li>
<li>Opens the file in the Source column, say Q100.ts1.<br />
</li>
<li>Extracts the hydrograph for node N1 from Q100.ts1.</li>
</ul>
Using this approach, the size of the BC Database .csv file can be reduced from several hundred lines for large hydrologic models to a couple of lines.
</td>
<td style="text-align:left;">
N/A
</td>
</tr>
<tr>
<td style="text-align:left;">
Source
</td>
<td style="text-align:left;">
<p>The file from which to extract the BC data. Acceptable formats are:</p>
<ul>
<li>Blank – if left blank, the BC data is assumed constant over time at the value specified under the Column 2 (Value) column (see Column 2 keyword below).<br />
</li>
<li>Comma delimited (.csv) files. Must have a .csv extension.<br />
</li>
<li>RAFTS-XP .tot and .loc files. 12, 16 and 20 field output is supported.<br />
</li>
<li>TUFLOW .ts1 time-series boundary data format. This format is fast to process and should be used for input of large numbers of hydrographs. See the convert_to_ts1.exe utility (Section <a href="#Processing-Utilites-3"><strong>??</strong></a>) for converting output from RAFTS, RORB, URBS and WBNM to .ts1 format). The ts1 is a comma separated file, which has additional header data to increase its read efficiency. The .ts1 file format is outlined on the TUFLOW Wiki on the <a href="http://wiki.tuflow.com/TS1_File_Format">TS1 file format page</a> should you wish to use a script to write data using this format.<br />
</li>
<li>FEWS files (.csv and .xml) for FEWS boundaries the source column should contain the keyword “FEWS” to indicate the .csv file format is a FEWS file and not a standard .csv file, followed by a vertical bar “|” and then the filename. For example:<br />
<img src="images/image125.png"><br />
</li>
<li>WBNM _Meta.out files. The flow data is read from the 9<sup>th</sup> data column in the hydrographs section of the _Meta.out file, this is the Qout_OS column.</li>
<li>XP .int and .ext interface formats.<br />
</li>
<li>Other file formats are included upon request.</li>
</ul>
<b>Note, the type of file is determined by the extension, therefore, ensure the file has the correct extension.</b>
</td>
<td style="text-align:left;">
N/A
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 1 or Time
</td>
<td style="text-align:left;">
<p>For .csv files, the name of the first column of data (usually time values in simulation hours) in the .csv Source File. Other examples besides Time are Flow for a HQ (stage-discharge) boundary, or Mean Water Level for each wave component in a 2D HS (sinusoidal wave) boundary.</p>
For all other types of Source entry (including FEWS .csv), leave this field blank.
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 2 or Value or ID
</td>
<td style="text-align:left;">
<p>For .csv files, the name of the second column of data in the .csv Source File. For example, water levels in a HT boundary, flows for a QT boundary or water levels for a HQ boundary.</p>
<p>For a Blank Source entry, the constant value to be applied. For example, to apply a mean water level to a HT boundary the source can be left blank and the water level entered in this column.</p>
<p>For RAFTS-XP (.tot or .loc), WBNM _Meta.out and TUFLOW/ESTRY .ts1 files, the name of the hydrograph location to extract.</p>
<p>For FEWS .csv and .xml boundaries the Location ID and Parameter ID need to be defined, separated by a vertical bar. The FEWS .csv file also supports event ensembles. For this an optional 3<sup>rd</sup> argument can be specified defining the ensemble ID. In the 1<sup>st</sup> boundary database entries below a FEWS .csv file is specified with the location ID “Location1” and the parameter ID “Q.sim.hist”. The 2<sup>nd</sup> boundary entry includes a boundary ensemble number 1.<br />
<img src="images/image125.png"></p>
<p>For external wind stress boundaries (.tesf), used to define the wind speed (m/s)</p>
<b>Note: it is NOT possible to combine the Value and ID keywords in the column label, for example “Value or ID”. If they are combined, the default column number of 4 is used.</b>
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Add Col 1 or TimeAdd
</td>
<td style="text-align:left;">
<p>An amount to add to all Column 1 (normally time) values (e.g. a time shift) for the BC data event. If left blank or zero, there is no change to the time values.</p>
<p>For external wind stress boundaries (.tesf), used to define the wind direction (degrees relative to East, ie. East = 0º, North = 90º, etc.).</p>
This field is ignored for Blank Source entries.
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
Mult Col 2 or ValueMult
</td>
<td style="text-align:left;">
<p>A multiplication factor to apply to the Column 2 values. If left blank or one (1), there is no change to the values. Note, Mult Col 2 is applied before Add Col 2 below.</p>
This field is ignored for Blank Source entries.
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
Add Col 2 or ValueAdd
</td>
<td style="text-align:left;">
<p>An amount to add to Column 2 values. If left blank or zero, there is no change to the values. Note, Add Col 2 is applied after Mult Col 2. For example, this could be used to add a base flow to a QT boundary or sea level rise allowance for a HT boundary.</p>
This field is ignored for Blank Source entries.
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 3
</td>
<td style="text-align:left;">
<p>For .csv files, the name of the third column of data when a third column of data is required. For example, the phase difference for each wave component in a 2D HS (sinusoidal wave) boundary.</p>
For all other types of Source entries, leave this field blank.
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 4
</td>
<td style="text-align:left;">
<p>For .csv files, the name of the fourth column of data when a fourth column of data is required. For example, the period for each wave component in a 2D HS (sinusoidal wave) boundary.</p>
For all other types of Source entries, leave this field blank.
</td>
<td style="text-align:left;">
9
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="bcdbase-Example-3"><span class="header-section-number">8.6.1</span> BC Database Example<a href="#bcdbase-Example-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Figure <a href="#fig:fig-image126">80</a> shows a simple example of a BC database setup in a worksheet that is exported as a .csv file for use by TUFLOW.</p>
<p>TUFLOW searches through the file until a row is found with the two keywords <strong>Name</strong> and <strong>Source</strong>. <strong>Name</strong> and <strong>Source</strong> do not have to be located in Columns 1 and 2 (although this is recommended).</p>
<p>Table <a href="#tab:tab-KeywordDescriptions">85</a> describes the purpose of each keyword and the default column where
applicable. At present a range of formats are accepted, and other formats can be incorporated upon request.</p>
<p>The example above is interpreted as follows:</p>
<ul>
<li>A boundary condition data location named “Level” is found in a boundary condition GIS file (eg. 2d_bc, 2d_sa, 2d_rf etc.). The boundary condition time-series data associated with it are found in the file <em>heads.csv</em>. Within the csv file, the time values are located under a column called “Time” and the BC values are located under a column “Lake Level”.<br />
</li>
<li>As an alternative to “Level” above, a boundary condition data location “Level (alternative)” is set a constant value of 2.<br />
</li>
<li>A boundary condition data location named “River Inflow” is found in a boundary condition GIS file. The time-series data associated with it is availabl in <em>flows.csv</em>. Within <em>flows.csv</em>, time details are found in the column titled “Time 1”. Boundary condition values are found in the column titled “River Flow”. Similarly, “Creek Inflow” and “Base Flow” are also located in flows.csv.<br />
</li>
<li>A boundary condition data location named “RAFTS Inflow” extracts the hydrograph from a RAFTS-XP .tot file named “rafts.tot” for RAFTS node “IN”.</li>
</ul>
<p>The heads.csv and flows.csv files are created by saving the worksheets
“heads.csv” and “flows.csv” as .csv files (see Figure <a href="#fig:fig-image127">81</a> and Figure <a href="#fig:fig-image128">82</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image126"></span>
<img src="images/image126a.png" alt="Simple BC Database Example (bc_dbase.csv)"  />
<p class="caption">
Figure 80: Simple BC Database Example (bc_dbase.csv)
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image127"></span>
<img src="images/image127a.png" alt="Example BC Database Source Files (heads.csv)"  />
<p class="caption">
Figure 81: Example BC Database Source Files (heads.csv)
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image128"></span>
<img src="images/image128a.png" alt="Example BC Database Source Files (flows.csv)"  />
<p class="caption">
Figure 82: Example BC Database Source Files (flows.csv)
</p>
</div>
<h3 class="hasAnchor" id="BCEventName-3"><span class="header-section-number">8.6.2</span> BC Event Name Command<a href="#BCEventName-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>The ability to model multiple events using an <a href="#tcfEventFile">Event File</a> (.tef) file offers even more power and flexibility to using <a href="#tcfBCEventText">BC Event Text</a> and <a href="#tcfBCEventName">BC Event Name</a>, as discussed below. This avoids the need to have a separate .tcf file for each simulation. See Section <a href="#Events-3"><strong>??</strong></a> for details on using an event file. The <a href="#tcfBCEventName">BC Event Name</a> will continue to be supported although users are encouraged to use the event file instead.</strong></p>
<p>The <a href="#tcfBCEventText">BC Event Text</a> and <a href="#tcfBCEventName">BC Event Name</a> commands (.tcf file) minimise data repetition by removing the need to create a separate BC database .csv file for each event. These commands are also available in the .ecf file for 1D only models (<a href="#ecfBCEventText">BC Event Text</a> and <a href="#ecfBCEventName">BC Event Name</a>) and .tbc file (<a href="#tbcBCEventText">BC Event Text</a> and <a href="#tbcBCEventName">BC Event Name</a>). The commands allow a wildcard to be set in the BC database and the text to replace the wildcard. How the commands work is illustrated in the example below.</p>
<p>A BC database file worksheet is created, as illustrated in Figure <a href="#fig:fig-image129">83</a>, and the following lines are included in all .tcf files.</p>
<p><tcmd><a href="#tcfBCDatabase">BC Database</a></tcmd><teq> == </teq><tblk>..\bcdbase\PR_bc_dbase.csv</tblk><br />
<tcmd><a href="#tcfBCEventText">BC Event Text</a></tcmd><teq> == </teq><tblk>__event__</tblk></p>
<p>These lines can be specified in a separate file. The file can be read using the <a href="#tcfReadFile">Read File</a> command in
all the .tcf files, see Section <a href="#ReadFile-3"><strong>??</strong></a>. This saves repeating these lines, and other common commands to all .tcf files.</p>
<p>The above commands set the active BC Database to ..\bcdbase\PR_bc_dbase.csv, and defines the text “__event__” as a wildcard to be replaced by the <a href="#tcfBCEventName">BC Event Name</a>. The following command is added to the .tcf file for the 100-year flood simulation:</p>
<p><tcmd><a href="#tcfBCEventName">BC Event Name</a></tcmd><teq> == </teq><tblk>Q100</tblk></p>
<p>TUFLOW replaces <strong><u>every</u></strong> occurrence of “__event__” with “Q100” in each line of the BC database. If “__event__” does not occur the line remains unchanged. In the example below, the following occurs:</p>
<ul>
<li>For the BC event “Oxley Ck Inflow”, the BC data is read from file “Q100.csv” rather than “__event__.csv” as indicated in the spreadsheet.<br />
</li>
<li>Similarly, the same applies for “h Downstream” and “Paradise Ck Inflow” BC events.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image129"></span>
<img src="images/image129a.png" alt="Example BC Database Using Event Text"  />
<p class="caption">
Figure 83: Example BC Database Using Event Text
</p>
</div>
<p>The file Q100.csv is created from the worksheet “Q100.csv” as shown below.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image130"></span>
<img src="images/image130a.png" alt="Example BC Database Source Files Using Event Text"  />
<p class="caption">
Figure 84: Example BC Database Source Files Using Event Text
</p>
</div>
<p>To create other simulations, for example a five year flood simulation, it is simply a process of creating the Q005.csv file, saving a copy of the “Q100.tcf” file as “Q005.tcf” and changing <a href="#tcfBCEventName">BC Event Name</a> to “Q005”:</p>
<p><tcmd><a href="#tcfBCEventText">BC Event Name</a></tcmd><teq> == </teq><tblk>Q005</tblk></p>
<p>There is no need to create another BC database file. As discussed earlier, the newer <a href="#tcfEventFile">Event File</a> option eliminates the need for a separate control file (.tcf) and is the preferred approach, see Section <a href="#Events-3"><strong>??</strong></a> for details on using the event file approach.</p>
<h3 class="hasAnchor" id="BoundaryGenerators-3"><span class="header-section-number">8.6.3</span> TUFLOW Boundary Generators<a href="#BoundaryGenerators-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- DRK: Needs a short section on the tools available within QGIS which generate the bc-dbase, time-series files and TEF for ARR/ReFH2 and SCS.  Small description and signpost to the wiki pages-->
<p>The development of boundary conditions is usually model specific, although there are some common regional approaches to flow and rainfall generation. To assist with this, a number of boundary generator tools have been created within QGIS which allow the modeller to semi-automate the production of the <a href="#tcfBCDatabase">BC Database</a>, boundary data files for different events, patterns and storm duration and also an associated TUFLOW <a href="#tcfEventFile">Event File</a>. Currently, these exists for 3 regional hydrological approaches. For a description of each, the reader is referred to the relevant Wiki page:</p>
<ul>
<li><a href="https://wiki.tuflow.com/QGIS_ARR_to_TUFLOW">Australian Rainfall and Runoff 2019 Tool (ARR to TUFLOW tool)</a>: The ARR to TUFLOW tool interacts with the Australian Bureau of Meteorology website, in conjunction with ARR input parameters, to generate rainfall hyetographs together with optional soil loss files depending on the method (tsoilf or material.csv).</li>
<li><a href="https://wiki.tuflow.com/QGIS_ReFH2_to_TUFLOW">UK Revitalised Flood Estimation Handbook 2 (ReFH2 to TUFLOW tool)</a>: This allows both flow hydrographs and rainfall hyetographs to be developed for a TUFLOW simulation for a range of events and storm durations based on imported FEH Catchment or point descriptors.</li>
<li><a href="https://wiki.tuflow.com/QGIS_SCS_to_TUFLOW">Auckland Region SCS to TUFLOW tool</a>. This tool allows flow hydrographs to be developed for the Auckland, New Zealand region using the U.S. Soil Conservation Service (SCS) (now known as the Natural Resources Conservation Service, part of the U.S. Department of Agriculture) rainfall-runoff model. The implemented approach complies with Auckland City Council’s TP108 policy.</li>
</ul>
<p>Please let <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> know if you have suggestions for a boundary conditions generators</p>
<h3 class="hasAnchor" id="DelftFEWSBoundary-3"><span class="header-section-number">8.6.4</span> Delft FEWS Boundaries<a href="#DelftFEWSBoundary-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Boundary timeseries in the Delft FEWS boundary format are supported, as shown in Table <a href="#tab:tab-KeywordDescriptions">85</a>.</p>
<p>Delft FEWS .csv and .xml files are TUFLOW compatible. In both cases the keyword “FEWS” is required in the ‘Source’ field of the BC Database followed by a vertical bar “|” and then the Delft FEWS filename (for example FEWS | &lt;sourcefile.csv&gt;). Following ‘Source’ in the BC Database:</p>
<ul>
<li>‘Column 1’ is not required. This is due to TUFLOW sourcing time information directly from the Delft FEWS file.<br />
</li>
<li>‘Column 2’ is needed to define the Location ID, Parameter ID, and when using the .csv format, the Ensemble ID. Each parameter is separated by a vertical bar. For example:
<center>
<img src="images/image125.png" />
</center></li>
</ul>
<p>Note, ensemble ID information is only possible using the Delft FEWS .csv format. It is not possible using Delft FEWS xml format.</p>
<p>The header section for an input .xml is shown below. Any data in the timeseries with the value equal to that defined by the &lt;missVal&gt; in the header are ignored. Additional header tags are ignored by TUFLOW.</p>
<center>
<img src="images/image131.png" style="width:4.84914in;height:2.60504in" />
</center>
<p>The <a href="#tcfFEWSInputfile">FEWS Input File</a> command can be used to set the duration of the TUFLOW simulation and the <a href="#tcfNetCDFOutputStartDate">NetCDF Output Start Date</a> based on information within the FEWS boundary file. <a href="#tcfFEWSInputfile">FEWS Input File</a> can refer to either a FEWS .csv or FEWS .xml file. Using this command, the duration and <a href="#tcfEndTime">End Time</a> value of the TUFLOW simulation is determined from the Delft FEWS input file. If using this approach, no <a href="#tcfEndTime">End Time</a> command should be included in the .tcf file. The start date defined in the FEWS input file is used to set the NetCDF output start date (e.g. <a href="#tcfNetCDFOutputStartDate">NetCDF Output Start Date</a>).</p>
<h3 class="hasAnchor" id="HECDSS-3"><span class="header-section-number">8.6.5</span> HEC-DSS Boundaries<a href="#HECDSS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2023-03 release introduced support for time-series data from HEC-DSS files within a boundary condition database.
HEC-DSS is a database system for time series, curve, gridded data and more, developed by the U.S. Army Corps of Engineers Hydrologic Engineering Center (HEC). See their website at <a href="https://www.hec.usace.army.mil/software/hec-dss/" class="uri">https://www.hec.usace.army.mil/software/hec-dss/</a> for more information. It is used by the HEC developed models for data input and output. Rather than convert HEC-DSS time-series curves for use in TUFLOW, this data can be accessed directly.
HEC-DSS files organise data into paths with six parts (Part A – Part F) that resemble how files are organised on disk. Figure <a href="#fig:fig-HEC-DSSfiles">85</a> shows an example DSS file with a single path, with the curve plotted below.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HEC-DSSfiles"></span>
<img src="images/HEC-DSSfiles.png" alt="**Example DSS File**" width="65%" />
<p class="caption">
Figure 85: <strong>Example DSS File</strong>
</p>
</div>
</center>
<p>To use a HEC-DSS time-series curve within a TUFLOW boundary condition database:</p>
<ol style="list-style-type: decimal">
<li>Provide the filename in the “Source” column.</li>
<li>Leave “Column 1”, which is used for time, blank (DSS files store the time with the curve values).</li>
<li>Identify the pathname in “Column 2.” Event placeholders such as <strong>event</strong> can be used as part of the pathname. Wildcards (*) can be used for parts of the path, however, ensure the wildcards will not select more than one path within the file.</li>
<li>The “Add” and “Mult” columns can be used to offset or scale the time-series values, the same as non-DSS time-series curves.</li>
</ol>
<p>Figure <a href="#fig:fig-PartDWildCard">86</a> shows how the time-series curve above could be included in a boundary condition database. A wildcard is used for Part D of the pathname (date range). Note that the pathname must start with a forward slash (/).</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-PartDWildCard"></span>
<img src="images/PartDWildCard.png" alt="**Time-series Curve Example**" width="50%" />
<p class="caption">
Figure 86: <strong>Time-series Curve Example</strong>
</p>
</div>
</center>
<p>By default, TUFLOW uses the first point in the time-series curve as TUFLOW time-zero. This can be changed using the new command “<tcmd><a href="tcfHEC-DSSStartDate">HEC-DSS Start Date</a></tcmd>” to identify the date/time that should be used for time-zero. The date should be in the isodate format: yyyy-mm-dd hh:mm:ss, where the time portions are optional. For example:</p>
<p><tcmd><a href="#tcfHEC-DSSStartDate">HEC-DSS Start Date</a></tcmd> <teq>==</teq> <tblk>2022-01-01</tblk></p>
<p>Note: Non-time series data such as gridded data from a HEC-DSS file is not supported.</p>
<h2 class="hasAnchor" id="Cyclones-2"><span class="header-section-number">8.7</span> Cyclones / Hurricanes / Typhoons<a href="#Cyclones-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Wind and pressure fields created by severe storms can affected flooding and inundation in coastal areas. It is possible to apply a cyclone / hurricane / typhoon boundary within TUFLOW to capture these affects. Cyclone / hurricane / typhoon wind and pressure fields with the Holland parametric model <span class="citation">(<a href="#ref-Holland1980">Holland, 1980</a>)</span> can be read in with either of the .tcf commands below (which are treated identically):</p>
<p><tcmd><a href="#tcfReadGISCyclone">Read GIS Cyclone</a></tcmd> <teq>==</teq> <tblk><span class="math inline">\(\langle\)</span>gis layer<span class="math inline">\(\rangle\)</span></tblk><br />
<tcmd><a href="#tcfReadGISCyclone">Read GIS Hurricane</a></tcmd> <teq>==</teq> <tblk><span class="math inline">\(\langle\)</span>gis layer<span class="math inline">\(\rangle\)</span></tblk></p>
<p>This command can be used to read a cyclone, hurricane or typhoon track. The attributes of the GIS layer are listed in Table <a href="#tab:tab-CycloneAttributes">86</a> and are all float values. Only the first line in the layer is read and used for the track. Points are snapped to the line wherever attribute data are to be assigned. It is not necessary to have points snapped to every vertex of the line – values will be interpolated between the digitised points. There must be points with attribute data snapped to the start and end of the polyline track.</p>
<p>The optional <tcmd>No Pressure</tcmd> and <tcmd>No Wind</tcmd> options deactivate the pressure/wind fields respectively. E.g. <tcmd><a href="#tcfReadGISCyclone">Read GIS Cyclone No Wind</a></tcmd> <teq>==</teq> <tblk><span class="math inline">\(\langle\)</span>gis layer<span class="math inline">\(\rangle\)</span></tblk> will only apply the pressure field and ignore the wind.</p>
<table>
<caption>
<span id="tab:tab-CycloneAttributes">Table 86: </span><strong>GIS Attribute Details for Cyclone (2d_cyc) layer</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Time
</td>
<td style="text-align:left;">
Time in hours.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
p0
</td>
<td style="text-align:left;">
Pressure at the eye (hPa).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
pn
</td>
<td style="text-align:left;">
Pressure of surrounds (hPa).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
R
</td>
<td style="text-align:left;">
Radius to maximum winds (m) (or ft if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
See <span class="citation">Queensland Government (<a href="#ref-QG2001">2001</a>)</span>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
<span class="math inline">\(\rho_{air}\)</span>
</td>
<td style="text-align:left;">
Density of Air (kg/m<sup>3</sup>) (or lb/ft<sup>3</sup> if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>). If zero, <a href="#tcfDensityofAir">Density of Air</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
km
</td>
<td style="text-align:left;">
Density of Air (kg/m<sup>3</sup>) (or lb/ft<sup>3</sup> if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>). If zero, <a href="#tcfDensityofAir">Density of Air</a> is used.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
ThetaMax
</td>
<td style="text-align:left;">
See <span class="citation">Queensland Government (<a href="#ref-QG2001">2001</a>)</span>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
DeltaFM
</td>
<td style="text-align:left;">
See <span class="citation">Queensland Government (<a href="#ref-QG2001">2001</a>)</span>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
bw_speed
</td>
<td style="text-align:left;">
Background wind speed in m/s (or ft/s if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>). Ignored if less than or equal to zero.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
bw_dirn
</td>
<td style="text-align:left;">
Background wind direction in degrees relative to East (0°), North (90°), etc..
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p>The generation of the wind and pressure fields are based on Appendix C of “Queensland Climate Change and Community Vulnerability to Tropical Cyclones – Ocean Hazards Assessment – Stage 1” <span class="citation">(<a href="#ref-QG2001">Queensland Government, 2001</a>)</span>.</p>
<p>The wind and pressure fields can be output using the <tblk>WI10</tblk> and <tblk>AP</tblk> options for <tcmd><a href="#tcfMapOutputDataTypes">Map Output Data Types</a></tcmd>.
The background wind is applied outside R (the radius of maximum winds), if it exceeds the cyclone/hurricane wind speed.</p>
<p>Note: that Latitude must be specified (via .tcf command “<tcmd><a href="#tcfLatitude">Latitude</a></tcmd> <teq>==</teq> <tblk><span class="math inline">\(\langle\)</span>latitude value<span class="math inline">\(\rangle\)</span></tblk>”).</p>
<h2 class="hasAnchor" id="ExternalStress-2"><span class="header-section-number">8.8</span> External Stress Boundaries<a href="#ExternalStress-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The external stress control file (.tesf) allows the definition of time varying global or spatially varying external forcing such as wind or wave radiation stresses. This allows the user to specify one of the following types of wind / stress boundary:</p>
<ul>
<li>Global wind (i.e. temporally but not spatially varying wind field is applied).<br />
</li>
<li>Grid Interpolation. Point winds are applied at locations within / near the model, these point winds are interpolated to gridded stresses across the model.<br />
</li>
<li>User specified time varying gridded datasets.</li>
</ul>
<p>The wind time-series curve is entered as three columns of data (using
Column 1, 2 and 3 labels in the bc_dbase). The three columns are:</p>
<ol style="list-style-type: decimal">
<li>Time (h)<br />
</li>
<li>Wind (m/s)<br />
</li>
<li>Direction (degrees relative to East, i.e. East = 0º, North = 90º,
etc.).</li>
</ol>
<p>Prior to the simulation the wind boundaries are converted into a shear
stress boundary and this shear stress is applied to the model. The shear stress is calculated based on equation <a href="#eq:equ-shear-stress">(54)</a>.</p>
<p><span class="math display" id="eq:equ-shear-stress">\[\begin{equation}
\tau = C_{10}\ \rho_{air}\  U_{10}
\tag{54}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\tau\)</span> = shear stress in N/m<sup>2</sup>.</li>
<li><span class="math inline">\(ρ_{air}\)</span> = density of air in kg/m<sup>3</sup>.</li>
<li><span class="math inline">\(U_{10}\)</span> = wind velocity at 10m above the mean water surface in m/s.</li>
<li><span class="math inline">\(C_{10}\)</span> = wind stress coefficient and is calculated using equation <a href="#eq:equ-wind-stress">(55)</a> based on <span class="citation">J. Wu (<a href="#ref-Wu1980">1980</a>)</span> and <span class="citation">J. Wu (<a href="#ref-Wu1982">1982</a>)</span>.</li>
</ul>
<p><span class="math display" id="eq:equ-wind-stress">\[\begin{equation}
C_{10} = \left( 0.8 + 0.065\ U_{10} \right)\ \times 10^{- 3}
\tag{55}
\end{equation}\]</span></p>
<p>For US Customary units, wind velocity (<span class="math inline">\(U_{10}\)</span>) is specified in ft/s, density (<span class="math inline">\(ρ_{air}\)</span>) is specified in lb/ft<sup>3</sup> and shear stress (<span class="math inline">\(\tau\)</span> ) is calculated / output in lbf/ft<sup>2</sup>.</p>
<p>For the interpolated stress grids, these are output to disk at model
start-up and then loaded in during the model simulation as required. The
grids can be used as a “check” file as they are written prior to the
simulation starting. For each time in the specified boundary series two
stress grids are produced, shear stress in the x direction (<span class="math inline">\(\tau_x\)</span>) and
shear stress in the Y direction (<span class="math inline">\(\tau_y\)</span>). When interpolating grids from
point data the wind boundary at each point is converted to <span class="math inline">\(\tau_x\)</span> and <span class="math inline">\(\tau_y\)</span>
and these x and y component stresses are interpolated using the selected
method (as described below).</p>
<p>Alternatively, a series of <span class="math inline">\(\tau_x\)</span> and <span class="math inline">\(\tau_y\)</span> grids can be directly read into
the simulation. The input grids must be in a format TUFLOW supports for reading (see Section <a href="#GISFormats-3"><strong>??</strong></a>). For all formats except NetCDF, an index .csv file is input containing the time data in Column 1, and the filenames for the x and y component stresses in Columns 2 and 3 respectively. For the NetCDF format, time, <span class="math inline">\(\tau_x\)</span> and <span class="math inline">\(\tau_y\)</span> must all be variables in the same NetCDF file. The format of the user specified external grids is the same as produced by TUFLOW when interpolating from
points to grids.</p>
<center>
<img src="images/image132.png"
style="width:6.26806in;height:0.91944in" />
</center>
<p>As the user specified gridded stresses are applied as a stress term
(rather than a wind boundary) these could potentially be used for
external stress forcing other than winds, for example wave radiation
stresses.</p>
<p>All stress related commands (see Appendix <a href="#TESFCommands-1"><strong>??</strong></a>) are specified in the External Stress File
(.tesf), which is referred to in the .tcf using the command, <a href="#tcfExternalStressFile">External
Stress File</a>. If this command is included TUFLOW
automatically invokes the external stress functionality. Other .tcf
commands relevant to the wind stress functionality are <a href="#tcfDensityofAir">Density of
Air</a>, <a href="#tcfDensityofWater">Density of Water</a>,
<a href="#tcfWindWaveShallowDepths">Wind/Wave Shallow Depths</a>.</p>
<p>In the .tesf one of the following commands is required to apply global, interpolated from point or gridded stresses.</p>
<ul>
<li><a href="#tesfGlobalWindBC">Global Wind BC</a>: Used to invokes a global wind
boundary.<br />
</li>
<li><a href="#tesfReadGISWindPoint">Read GIS Wind Point</a> and <a href="#tesfReadGISWindPoly">Read GIS Wind
Poly</a> invokes grid interpolation.<br />
</li>
<li><a href="#tesfReadGriddedTau">Read Gridded Tau</a> invokes the use of a user
specified grid.</li>
</ul>
<p>If applying a global wind boundary, no additional .tesf file commands
are required.</p>
<p>For the grid interpolation the following commands are applicable:</p>
<ul>
<li><a href="#tesfGridInterpolationMethod">Grid Interpolation Method</a></li>
<li><a href="#tesfOutputGridFormat">Output Grid Format</a><br />
</li>
<li><a href="#tesfOutputGridCellSize">Output Grid Cell Size</a></li>
<li><a href="#tesfOutputGridOrigin">Output Grid Origin</a></li>
<li><a href="#tesfIDWExponent">IDWExponent</a></li>
<li><a href="#tesfIDWMaximumDistance">IDW Maximum Distance</a></li>
<li><a href="#tesfIDWMaximumPoint">IDW Maximum Point</a></li>
</ul>
<p>The GIS attribute format associated with the inputs called by the <a href="#tesfReadGISWindPoint">Read GIS Wind Point</a> and <a href="#tesfReadGISWindPoly">Read GIS Wind Poly</a> commands is provided in Table <a href="#tab:tab-WindStress">87</a>.</p>
<table>
<caption>
<span id="tab:tab-WindStress">Table 87: </span><strong>2D External Wind Stress (2d_ws) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
The name of the BC in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>).
</td>
<td style="text-align:left;">
Char(100)
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="InitialConditions-2"><span class="header-section-number">8.9</span> Initial Conditions<a href="#InitialConditions-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Two options are available for setting initial conditions in the model.
Initial Water Levels (IWLs) can be defined in the 1D and 2D domains to
set a global constant or spatially-varying water level. Alternatively,
the use of restart files sets initial water levels, flow velocities and
flow regime based on a previous simulation of the model.</p>
<h3 class="hasAnchor" id="IWL-3"><span class="header-section-number">8.9.1</span> Initial Water Levels (IWL)<a href="#IWL-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="IWL-1D-4"><span class="header-section-number">8.9.1.1</span> 1D Domains<a href="#IWL-1D-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For 1D domains, initial water levels (IWL) can be set globally as a constant using the .ecf command <a href="#ecfSetIWL">Set IWL</a>. IWLs can also be set to vary spatially using one or more GIS layers. The default initial water level at 1D nodes is zero metres above datum (0 mAD).</p>
<p>To set up a GIS IWL layer for the 1D domains:</p>
<ol style="list-style-type: decimal">
<li>Create a 1d_iwl layer using an empty layer created by <a href="#tcfWriteEmptyGISFiles">Write Empty
GIS Files</a>.<br />
</li>
<li>Digitise points snapped to nodes and assign each point an initial
water level value, alternatively points can be copied from the
<a href="https://wiki.tuflow.com/Check_Files_1d_nwk_N">_nwk_N_check</a> files and assigned an IWL.<br />
</li>
<li>Save the GIS layer.<br />
</li>
<li>Use the <a href="#ecfReadGISIWL">Read GIS IWL</a> command to read in the IWL values.</li>
</ol>
<p>Any number of IWL layers may be used, noting that if a node’s IWL occurs
more than once, the last occurrence prevails (i.e. TUFLOW or ESTRY
overwrites any previous IWL already set).</p>
<p>Differences in initial water levels for related features in the 1D and
2D domain can cause model instabilities at the start of a model
simulation. If your model becomes unstable in the first few timesteps,
review the initial water level values to ensure they are consistent in
both domains and also match the water level of any head boundaries that
they are be connected to.</p>
<table>
<caption>
<span id="tab:tab-WaterLevel">Table 88: </span><strong>1D Initial Water Level (1d_iwl) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
IWL
</td>
<td style="text-align:left;">
Initial water level of object relative to model datum (m).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="IWL-2D-4"><span class="header-section-number">8.9.1.2</span> 2D Domains<a href="#IWL-2D-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>2D IWLs can be set globally as a constant using the <a href="#tcfSetIWL">Set IWL</a> (.tcf file) or <a href="#tgcSet">Set IWL</a> (.tgc file) commands. The default initial water level is zero metres above the model datum (or 0ft if <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>). IWLs can also vary spatially using one or more GIS and/or grid layers. The (<a href="#tcfReadGISIWL">Read GIS IWL</a> can be read into both the .tcf or the .tgc, shown in <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">Example Model</a> EG06_001. The <a href="#tgcReadGridIWL">Read Grid IWL</a>) can be read into the .tgc file, shown in <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">Example Model</a> EG06_002. This is particularly useful for setting initial water levels in lakes, dams, etc.</p>
<p>The easiest way to set up a GIS IWL layer is to:</p>
<ol style="list-style-type: decimal">
<li>Create a 2d_iwl layer using an empty layer created by <a href="#tcfWriteEmptyMIFiles">Write Empty GIS Files</a>.<br />
</li>
<li>Digitise regions or points and assign each object an initial water level value.<br />
</li>
<li>Save the GIS layer.<br />
</li>
<li>Use the .tcf <a href="#tcfReadGISIWL">Read GIS IWL</a> command or tgc <a href="#tgcReadGISIWL">Read GIS IWL</a> command to read in the IWL values.</li>
</ol>
<p>The <a href="#tgcReadGridIWL">Read Grid IWL</a> .tgc command is used to read the IWL from a grid (.tif, .flt or .asc). This can be used to set the IWL based on the water level in a previous simulation, if TIF, FLT or ASC is specified in the <a href="#tcfMapOutputFormat">Map Output Format</a>. The results from one simulation can be directly read by another.</p>
<p>Any number of IWL layers may be used, noting that if a cell’s IWL occurs
more than once, the last occurrence prevails (i.e. TUFLOW overwrites any
previous IWL already set).</p>
<table>
<caption>
<span id="tab:tab-InitialWater">Table 89: </span><strong>2D Initial Water Level (2d_iwl) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
IWL
</td>
<td style="text-align:left;">
Initial water level of object relative to model datum (m).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="IWL-Auto-4"><span class="header-section-number">8.9.1.3</span> Automatic Initial Water Level<a href="#IWL-Auto-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is possible to automatically set the model’s initial water level to the downstream boundary water level using
<tcmd><a href="#tcfSetIWL">Set IWL</a></tcmd><teq> == </teq><tblk>AUTO</tblk>. This command is very useful when performing a Monte Carlo assessment that requires a large number of simulations with each simulation having a unique initial water level!</p>
<h3 class="hasAnchor" id="IGW-3"><span class="header-section-number">8.9.2</span> Initial Groundwater Levels<a href="#IGW-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- EFC is confirming with PAR if this is the best spot for IWG commands. Need to confirm how to split this with the GWD/GWL vs IGW/IGD commands -->
<!--confirmed it is-->
<p>This section discusses available commands to set initial conditions in groundwater layers. As of the 2023-03 release, when using TUFLOW HPC, it is possible to have numerous groundwater layers in the vertical (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). If using this functionality the initial water levels can also be set per layer by using ‘Layer N’. If using only one layer, the syntax may be either ‘Set IGW Depth’ or Set IGW Depth Layer 1’.</p>
<p>The initial water level in the groundwater layer(s) can be set globally in the .tgc using the following commands:</p>
<ul>
<li><a href="#tgcSetIGWDepth">Set IGW Depth [ {} | &lt;Layer N&gt; ]</a><br />
</li>
<li><a href="#tgcSetIGWLevel">Set IGW Level [ {} | &lt;Layer N&gt; ]</a></li>
</ul>
<p>They can also be set on a spatial basis using:</p>
<ul>
<li><a href="#tgcReadGISIGWDepth">Read GIS IGW Depth [ {} | &lt;Layer N&gt; ]</a><br />
</li>
<li><a href="#tgcReadGridIGWDepth">Read Grid IGW Depth [ {} | &lt;Layer N&gt; ]</a></li>
<li><a href="#tgcReadGISIGWLevel">Read GIS IGW Level [ {} | &lt;Layer N&gt; ]</a></li>
<li><a href="#tgcReadGridIGWLevel">Read Grid IGW Level [ {} | &lt;Layer N&gt; ]</a></li>
</ul>
<p>“IGW Depth” is assumed to be the depth of water in the soil (water content divided by porosity). “IGW Level” is assumed to be the level of the water table in each layer. If both methods are specified for a given grid cell, the highest initial condition will be adopted. The input units should be in meters or feet (if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk> US Customary</tblk>). Note, the initial conditions do not automatically cascade into layers below (i.e. setting the initial water level in the top layer will not automatically set the layers below to be 100% saturated).</p>
<p>Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf.</p>
<p>In previous releases, the groundwater initial conditions could be set using the following commands. For backward compatibility, it is still possible to use these commands, though only if using one groundwater (soil) layer in the vertical:</p>
<ul>
<li><a href="#tgcSetGWD">Set GWD</a> or <a href="#tgcSetGWL">Set GWL</a></li>
<li><a href="#tgcReadGISGWD">Read GIS GWD</a> or <a href="#tgcReadGISGWL">Read GIS GWL</a></li>
<li><a href="#tgcReadGridGWD">Read Grid GWD</a> or <a href="#tgcReadGridGWL">Read Grid GWL</a></li>
</ul>
<p>If the above commands are used with the multiple vertical layers (Convective layers), <a href="https://wiki.tuflow.com/TUFLOW_Message_2588">ERROR 2588</a> will be produced.</p>
<p>The groundwater feature may only be used in conjunction with at least one of the soils infiltration methods described in Section <a href="#Infiltration-2"><strong>??</strong></a>. Consequently, the .tgc commands used to define the groundwater depth / level must be read in following (below) at least one of the commands used to define the soil type: <a href="#tgcSetSoil">Set Soil</a>, <a href="#tgcReadGISSoil">Read GIS Soil</a> or <a href="#tgcReadGridSoil">Read Grid Soil</a>.</p>
<!-- EFC to PAR: is the 2d_gw still used by set IGW commands? If so, assume I should move this to initial groundwater levels section?-->
<!-- yes-->
<table>
<caption>
<span id="tab:tab-Groundwater">Table 90: </span><strong>2D Groundwater (2d_gw) GIS Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Groundwater
</td>
<td style="text-align:left;">
The ground water level in metres above datum (if using the command Read GIS GWL) or depth below ground surface in metres (if using the command Read GIS GWD) of the groundwater table at the start of the model simulation. The units are feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="RestartFiles-3"><span class="header-section-number">8.9.3</span> Restart Files<a href="#RestartFiles-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Gradually varying water surface initial water level conditions are best defined using a restart file. This is achieved by running the model for a warm-up period prior to the main event to create a restart file which establishes the initial water levels and flow velocities. This is achieved using the following commands:</p>
<ul>
<li><a href="#tcfWriteRestartFileatTime">Write Restart File at Time</a>: Sets when to write the restart file in hours.</li>
<li><a href="#tcfWriteRestartFileInterval">Write Restart File Interval</a>: Sets the interval in hours between writing the restart file.</li>
<li><a href="#tcfReadRestartFile">Read Restart File</a>: Reads a restart file written from a previous simulation.</li>
<li><a href="#tcfWriteRestartFilename">Write Restart Filename</a>: Controls whether restart files are overwritten or are time-stamped.</li>
</ul>
<p>The 1D and 2D restart files use a .erf and .trf extension respectively and are written to the results folder.</p>
<p>The restart file contains information on the water levels, velocities and flow regimes for the 1D and 2D parts of the model. Therefore, the number of 2D cells and 1D channels must be the same between the original model and the model using the restart file. Permitted changes between runs could include different boundary conditions, cell elevation increases (cell elevation decreases may cause issue) and roughness values.</p>
<p>An example of writing and reading restart files is provided in <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">Example Models</a> EG02_009 and EG06_004 respectively.</p>
<p>The 2023-03-AD build added functionality to allow restart data fields to be ignored. To specify which fields to ignore the command “<tcmd><a href="#tcfRestartFileIgnoreFields">Restart File Ignore Fields</a></tcmd> <teq> ==</teq>” can be set in the .tcf where the fields are any combination of:</p>
<ul>
<li>Geometry (elevations and Manning’s n values)</li>
<li>Groundwater (groundwater depths and groundwater tracer concentrations)</li>
<li>Maximum (scalar and vector maximums; both values and times, minimum timestep)</li>
<li>Rainfall (cumulative rainfall, cumulative rainfall material losses and cumulative cell wet time)</li>
<li>TimeOutputCutoff (Time Output Cutoff; time of first inundation and cumulative time inundated)</li>
<li>Tracer (surface and groundwater tracer concentrations)</li>
<li>Velocity (velocity and turbulence values)</li>
<li>WaterLevel (water level)</li>
</ul>
<p>For example: “<tcmd>Restart File Ignore Fields</tcmd><teq> == </teq><tblk>Geometry Groundwater</tblk>” will ignore the geometry and groundwater information in the restart file (for these, the values set in the control files are used).</p>
<p>By default (without the command above) the geometry information in the restart file is ignored and the .tgc information is used instead. See also <tcmd><a href="#tcfHPCRestartGeometry">HPC Restart Geometry</a></tcmd><teq> == </teq><tblk>Restart File | {TGC} </tblk> command. If the “<tcmd>Restart File Ignore Fields</tcmd> <teq>==</teq>” command is included, but does not include geometry then message “<a href="https://wiki.tuflow.com/TUFLOW_Message_2902">WARNING 2902</a> -‘Restart File Ignore Field’ does not include geometry, overwriting geometry in .tgc with restart file” is issued.</p>
<p>Note: Only one of “<tcmd><a href="#tcfRestartFileIgnoreFields">Restart File Ignore Fields</a></tcmd>” or “<tcmd><a href="#tcfHPCRestartGeometry">HPC Restart Geometry</a></tcmd>” should be used, an error is given if both commands are present in a control file.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="AD-1"><span class="header-section-number">9</span> Advection Dispersion<a href="#AD-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="AD-Overview-2"><span class="header-section-number">9.1</span> Overview<a href="#AD-Overview-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The TUFLOW AD Module is an <a href="#AddonModules-3">add-on Module</a> and extension of the TUFLOW hydrodynamic engines.
By including passive transport fields for tracers, the advection, dispersion and fate of water quality
constituents may be simulated. Examples of constituents include salinity, sediment and/or catchment inflow pollutant concentrations. Both dissolved and
particulate constituents can be simulated. TUFLOW AD takes depth and velocity fields computed by the TUFLOW
Classic or HPC solver and uses this information, together with initial and boundary conditions, to simulate
the transport of the specified constituents. In particular, the effects of both longitudinal dispersion and
transverse turbulent diffusion are included. TUFLOW AD is specifically oriented towards analyses
of systems including coastal waters, estuaries, rivers, floodplains and urban areas. Up to twenty
individual constituents can be simulated within TUFLOW AD. For models with linked 1D-2D domains, transport
through 1D elements linked by SX connections is supported, but transport through 1D elements linked by HX
connections are not.</p>
<h3 class="hasAnchor" id="AD-Solution-3"><span class="header-section-number">9.1.1</span> 2D Depth Averaged Equation of Motion<a href="#AD-Solution-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The equation of motion of a passive tracer <span class="math inline">\(\phi\)</span> (as a concentration), in 2D depth averaged conservative
formulation is:</p>
<p><span class="math display" id="eq:equ-2DTracerFiniteVolume1">\[\begin{equation}
\frac{\partial(h \phi)}{\partial t}
+ \frac{\partial(h u \phi)}{\partial x}
+ \frac{\partial(h v \phi)}{\partial y}
- \frac{\partial}{\partial x} \left( h D \frac{\partial \phi}{\partial x} \right)
- \frac{\partial}{\partial y} \left( h D \frac{\partial \phi}{\partial y} \right)
= h S_\phi
\tag{56}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\phi\)</span> = Tracer concentration as mass (or mols) per unit volume</li>
<li><span class="math inline">\(h\)</span> = Water depth</li>
<li><span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> = Depth averaged velocity components in the x and x directions</li>
<li><span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> = 2D spatial coordinates</li>
<li><span class="math inline">\(t\)</span> = Time</li>
<li><span class="math inline">\(D\)</span> = Isotropic dispersion plus turbulent diffusion coefficients values in the x and y directions</li>
<li><span class="math inline">\(S_\phi\)</span> = Tracer source as mass (or mols) per unit volume per unit time</li>
</ul>
<p>The first term in the equation can be expanded using the chain rule and
then substituting the continuity equation to get:</p>
<p><span class="math display" id="eq:equ-2DTracerFiniteVolume2">\[\begin{equation}
\frac{\partial(h\phi)}{\partial t}
= h \frac{\partial \phi}{\partial t}
+ \phi \frac{\partial h}{\partial t}
= h \frac{\partial \phi}{\partial t}
- \phi \left( \frac{\partial (h u)}{\partial x} + \frac{\partial (h v)}{\partial y} \right)
\tag{57}
\end{equation}\]</span></p>
<p>Combining Equations <a href="#eq:equ-2DTracerFiniteVolume1">(56)</a> and <a href="#eq:equ-2DTracerFiniteVolume2">(57)</a> we get:</p>
<p><span class="math display" id="eq:equ-2DTracerFiniteVolume3">\[\begin{equation}
\frac{\partial \phi}{\partial t}
+ u \frac{\partial \phi}{\partial x}
+ v \frac{\partial \phi}{\partial y}
- \frac{1}{h} \left[
  \frac{\partial}{\partial x} \left( h D \frac{\partial \phi}{\partial x} \right)
+ \frac{\partial}{\partial y} \left( h D \frac{\partial \phi}{\partial y} \right) \right]
= S_\phi
\tag{58}
\end{equation}\]</span></p>
<h3 class="hasAnchor" id="AD-Solution-2"><span class="header-section-number">9.1.2</span> Solution Method (TUFLOW Classic)<a href="#AD-Solution-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2D advection dispersion algorithm in TUFLOW Classic is based on the ULTIMATE QUICKEST method of <span class="citation">Leonard (<a href="#ref-Leonard1991">1991</a>)</span>,
<span class="citation">Leonard &amp; Niknafs (<a href="#ref-LeonardNiknafs1991">1991</a>)</span> and <span class="citation">Leonard et al. (<a href="#ref-Leonard1993">1993</a>)</span>. The equation of motion is based on Equation <a href="#eq:equ-2DTracerFiniteVolume3">(58)</a>,
but reformulated to make use of the offset grid and the TVD interpolation scheme (i.e. it is better to first compute
<span class="math inline">\(\phi\)</span> at the cell faces and then compute <span class="math inline">\(\partial(u\phi)/\partial x\)</span> rather than <span class="math inline">\(\partial\phi/\partial x\)</span>):</p>
<p><span class="math display" id="eq:equ-2DTracerClassic">\[\begin{equation}
\frac{\partial \phi}{\partial t}
+ \frac{\partial (u \phi)}{\partial x}
+ \frac{\partial (v \phi)}{\partial y}
- \frac{1}{h} \left[
  \frac{\partial}{\partial x} \left(D_{x}\frac{\partial\phi}{\partial x}\right)
+ \frac{\partial}{\partial y} \left(D_{y}\frac{\partial\phi}{\partial y}\right) \right]
= S_\phi
+ \phi \left(
  \frac{\partial u}{\partial x}
+ \frac{\partial v}{\partial y}
\right)
\tag{59}
\end{equation}\]</span></p>
<p>TUFLOW AD applies the dispersion formulation described by <span class="citation">Falconer et al. (<a href="#ref-Falconer2005">2005</a>)</span>.
This formulation computes dispersion in the X and Y directions (<span class="math inline">\(D_x\)</span> and
<span class="math inline">\(D_y\)</span> respectively, to suit the Cartesian computational grid) from user
specification of longitudinal and transverse dispersion coefficients <span class="math inline">\(K_L\)</span>
and <span class="math inline">\(K_T\)</span>, respectively. Specifically, <span class="math inline">\(D_x\)</span> and <span class="math inline">\(D_y\)</span> are computed
dynamically at each grid cell and timestep as follows:</p>
<p>X Direction dispersion plus turbulent diffusion:</p>
<p><span class="math display" id="eq:equ-X-Dispersion">\[\begin{equation}
D_x = max \left(
\frac{(K_L u^2 + K_T v^2) h \sqrt g}{|U| C}, D_{w} \right)
\tag{60}
\end{equation}\]</span></p>
<p>Y Direction dispersion plus turbulent diffusion:</p>
<p><span class="math display" id="eq:equ-Y-Dispersion">\[\begin{equation}
D_y = max \left(
\frac{(K_T u^2 + K_L v^2) h \sqrt g}{|U| C}, D_{w} \right)
\tag{61}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(K_L\)</span> = User specified longitudinal dispersion coefficient</li>
<li><span class="math inline">\(K_T\)</span> = User specified transverse diffusion coefficient</li>
<li><span class="math inline">\(g\)</span> = Gravitational acceleration</li>
<li><span class="math inline">\(|U|\)</span> = Velocity magnitude</li>
<li><span class="math inline">\(C\)</span> = Chezy bed friction coefficient <span class="math inline">\(C = \frac{h^\frac{1}{6}}{n}\)</span></li>
<li><span class="math inline">\(D_w\)</span> = User specified lower bound dispersion coefficient</li>
</ul>
<p>The value of <span class="math inline">\(D_w\)</span> can be specified as constant or spatially varied as required.</p>
<p>The source terms also includes sink terms such as settling (for particulate species) and decay.
The scheme also includes representation of mixing due to sub-grid-scale
turbulence and vertical shear via the dispersion formulation provided in <span class="citation">Falconer et al. (<a href="#ref-Falconer2005">2005</a>)</span>.</p>
<p>The TUFLOW AD computational procedure used is an explicit scheme based
on <span class="citation">Leonard (<a href="#ref-Leonard1991">1991</a>)</span>. This contrasts to the TUFLOW Classic engine, which employs an
implicit scheme. As such, TUFLOW AD is generally subject to stricter
stability constraints than the Classic hydrodynamic engine. As such, the TUFLOW
AD calculation takes the form of three steps within each timestep.</p>
<p>The first step involves calculation of the Courant-Friedrichs-Lewy (CFL)
condition at all wet cells, where the CFL in 1 dimension is:</p>
<p>CFL Condition:</p>
<p><span class="math display" id="eq:equ-CFL">\[\begin{equation}
CFL =  \frac{u \bullet \Delta t}{\Delta x}
\tag{62}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(u\)</span> (or <span class="math inline">\(v\)</span>) = Fluid velocity<br />
</li>
<li><span class="math inline">\(\Delta x\)</span> = Grid scale<br />
</li>
<li><span class="math inline">\(\Delta t\)</span> = Timestep</li>
</ul>
<p>This condition is typically required to be less than 1.0 (additive for both X and Y directions)
and has a broad physical interpretation requiring that the distance fluid is advected in one
timestep (<span class="math inline">\(u∆t\)</span>) is less than one grid cell (<span class="math inline">\(∆x\)</span>).</p>
<p>The second step is the computation of a similar condition for the
diffusive lengthscale (related to the Peclet number) that ensures that
dispersion also does not cause instability at any grid cell. The CFL and
dispersion dimensionless numbers are then added and the maximum sum at
any given location within a timestep is used to compute the number of
sub-stepping iterations required by TUFLOW AD to remain stable within
one TUFLOW timestep.</p>
<p>The third step within each TUFLOW timestep is to execute the advection
dispersion calculations for the required number of iterations, with a
modified (smaller) <span class="math inline">\(∆t\)</span>.</p>
<p>The original ULTIMATE QUICKEST solution method has been enhanced and
improved as applied in TUFLOW AD. For example, TUFLOW AD also employs
adaptive computational stencil expansion where it identifies sharp
constituent concentration gradients <span class="citation">(<a href="#ref-LeonardNiknafs1991">Leonard &amp; Niknafs, 1991</a>)</span>. Where
possible (i.e. away from boundaries and dry cells) and required, the
ULTIMATE QUICKEST stencil is expanded from the standard third order
scheme to a ninth order scheme, only on principle computational axes.
Cross terms greater than third order are not included. If insufficient
wet cells exist to switch to ninth order, then seventh and fifth order
schemes are progressively tested (with commensurately decreasing
stencils) until all required wet cells are located.</p>
<p>Application of the ULTIMATE limiter <span class="citation">(<a href="#ref-Leonard1991">Leonard, 1991</a>)</span> has been found to
induce steady flow anisotropy when extended to multi-dimensional
problems and the numerical cross terms associated with additional
dimensions are included in calculations. <span class="citation">Wu &amp; Falconer (<a href="#ref-Wu2000">2000</a>)</span> developed
a modification to the ULTIMATE limiter that reduces this anisotropy, and
this has been applied within the TUFLOW AD computational engine.</p>
<h3 class="hasAnchor" id="AD-Solution-HPC-3"><span class="header-section-number">9.1.3</span> Solution Method (TUFLOW HPC)<a href="#AD-Solution-HPC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- EFC to GRC - I've added the below from the AF release notes-->
<p>The TUFLOW HPC solver tracks areal density, <span class="math inline">\(b=h\phi\)</span>, of the passive tracer as
the primary prognostic variable. With this change, equations
<a href="#eq:equ-2DTracerFiniteVolume1">(56)</a> and <a href="#eq:equ-2DTracerFiniteVolume2">(57)</a>
combine to become:</p>
<p><span class="math display" id="eq:equ-2DConservationHPC">\[\begin{equation}
\frac{\partial b}{\partial t}
+ \frac{\partial (ub)}{\partial x}
+ \frac{\partial (vb)}{\partial y}
- \frac{\partial \phi_{bu}}{\partial x}
- \frac{\partial \phi_{bv}}{\partial y}
= S_b
\tag{63}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\phi_{bu}\)</span> and <span class="math inline">\(\phi_{by}\)</span> are the combined dispersive and diffusive unit
fluxes of tracer in the x and y directions respectively</li>
<li><span class="math inline">\(S_b\)</span> = source terms (areal density rate)</li>
</ul>
<p>The diffusive fluxes of tracer across cell faces are comprised of two components.
The first is dispersion (induced by shear in the vertical velocity profile)
which acts in the direction of the flow, and the second is turbulent diffusion
which acts in both longitudinal and transverse directions. Both calculations use the
same formulation, but with different coefficients <span class="citation">(<a href="#ref-Falconer2005">Falconer et al., 2005</a>)</span>:</p>
<p><span class="math display" id="eq:equ-AD-Solution-2">\[\begin{equation}
\left( \substack{ \phi_{bL} \\ \phi_{bT}} \right)
= -\frac{|U|h\sqrt{g}}{C}
\left[ \substack{K_L \:\:\: 0 \\ 0 \:\:\: K_T} \right]
\left( \substack{ \frac{\partial \phi}{\partial L} \\ \frac{\partial \phi}{\partial T}} \right)
\tag{64}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(L\)</span> and <span class="math inline">\(T\)</span> denote longitudinal and transverse directions</li>
</ul>
<p>The concentration gradients in the longitudinal and transverse directions can be obtained
from those in cartesian coordinates with a rotational transformation:</p>
<p><span class="math display" id="eq:equ-AD-Solution-3">\[\begin{equation}
\left( \substack{\frac{\partial \phi}{\partial L} \\ \frac{\partial \phi}{\partial T}} \right)
= \left[ \substack{cos \theta \:\:\: -sin \theta \\ sin \theta \:\:\: cos \theta} \right]
\left( \substack{\frac{\partial \phi}{\partial x} \\ \frac{\partial \phi}{\partial y}} \right)
\tag{65}
\end{equation}\]</span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(\theta\)</span> = angle of flow vector such that <span class="math inline">\(cos \theta = \frac{u}{|U|}\)</span> and <span class="math inline">\(sin \theta = \frac{v}{|U|}\)</span></li>
</ul>
<p>And similarly the dispersive and diffusive fluxes can be transformed back from flow direction
coordinates to the cartesian coordinates with the reverse transform:</p>
<p><span class="math display" id="eq:equ-AD-Solution-3">\[\begin{equation}
\left( \substack{ \phi_{bu} \\ \phi_{bv}} \right)
= \left[ \substack{cos \theta \:\:\: sin \theta \\ -sin \theta \:\:\: cos \theta} \right]
\left( \substack{ \phi_{bL} \\ \phi_{bT}} \right)
\tag{65}
\end{equation}\]</span></p>
<p>Putting all of this together, and adding an isotropic diffusion term <span class="math inline">\(D_w\)</span>
(which can be used to represent wind/wave induced diffusion) yields:</p>
<p><span class="math display" id="eq:equ-XY-DispersionHPC">\[\begin{equation}
\left( \substack{\phi_{bu} \\ \phi_{by}} \right)
= -hRDR^{-1}
\left(\substack{\frac{\partial \phi}{\partial x} \\ \frac{\partial \phi}{\partial y}}\right)
\tag{66}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:equ-AD-Solution-4">\[\begin{equation}
RDR^{-1} = \frac{|U|h\sqrt{g}}{C_z} \left[
\substack{ K_l cos^2 \theta + K_t sin^2 \theta \:\:\: (K_l - K_t) cos \theta sin \theta
\\ (K_l - K_t) cos \theta sin \theta \:\:\: K_l sin^2 \theta + K_t cos^2 \theta} \right]
+ \left[ \substack {D_w \\ 0} \: \substack {0 \\ D_w} \right]
\tag{67}
\end{equation}\]</span></p>
<p>Note that this form is similar to that of Equations <a href="#eq:equ-X-Dispersion">(60)</a> and <a href="#eq:equ-Y-Dispersion">(61)</a>
but includes the off diagonal terms that arise in the matrix. Also note that the isotropic diffusion <span class="math inline">\(D_w\)</span> in HPC is a global constant.</p>
<h3 class="hasAnchor" id="local-constituent-transformation"><span class="header-section-number">9.1.4</span> Local Constituent Transformation<a href="#local-constituent-transformation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In addition to pure advection and dispersion/diffusion, constituents simulated
within TUFLOW AD (in both Classic and HPC) are modified by transient boundary
conditions, and optional settling (for sediment constituents) and decay processes
(dissolved and degradable constituents).</p>
<p>TUFLOW AD boundary conditions can be set to vary in time for each constituent, and
can be applied to all TUFLOW boundaries that set water levels and flows
(either user-specified or computed), such as HT or QT. TUFLOW AD also
supports SA inflow boundaries, where flows and concentrations are used
to compute mass loads that are delivered to the model domain, mixed with
ambient water and then resultant concentrations computed, prior to
execution of the advection routines. Consituents are not supported in
rainfall boundaries, which are assumed to be pure water.</p>
<p>Settling of constituents to simulate removal of particulate matter from
the water column has been included in the engine as a simple linear
process. Once settled, constituents do not re-enter the computational
domain. The local source contribution from settling is given by:</p>
<p><span class="math display" id="eq:equ-settling">\[\begin{equation}
S_\phi = -\frac{w_s}{h} \phi
\: ; \: or \:
S_b = -\frac{w_s}{h} b
\tag{68}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(w_s\)</span> is the settling velocity for the particles</li>
</ul>
<p>TUFLOW AD also supports the decay of individual species (if
positive decay rates are specified) and employs first order rate
equations to do so. These equations draw on user defined decay rates:</p>
<p><span class="math display" id="eq:equ-decay">\[\begin{equation}
S_\phi = -\omega \phi
\: ; \: or \:
S_b = -\omega b
\tag{69}
\end{equation}\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\omega\)</span> is the decay rate for the constituent</li>
</ul>
<h3 class="hasAnchor" id="groundwater"><span class="header-section-number">9.1.5</span> Groundwater<a href="#groundwater" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2023-03-AA release introduces tracking of constituents through the groundwater layers when run using the TUFLOW HPC solver, including return flow to surface water when horizontal hydraulic conductivity in included in the soils file. When this feature is used, groundwater return to the surface typically occurs at the bottom of slopes or adjacent to creeks, representative of catchment baseflows in reality. Refer to Section <a href="#GW-initial-conditions"><strong>??</strong></a> for commands for setting initial concentrations for sub-surface layers. No dispersion is modelled in the groundwater layers. The 2d_bc “GT” type groundwater boundary does not support defined inflow values for constituents.</p>
<p>Advection-dispersion in groundwater is not supported in TUFLOW Classic or the TUFLOW HPC Quadtree Module.</p>
<h3 class="hasAnchor" id="limitations-and-recommendations"><span class="header-section-number">9.1.6</span> Limitations and Recommendations<a href="#limitations-and-recommendations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW AD is designed to model dissolved and particulate constituent
advection and dispersion in coastal waters, estuaries, rivers, and
floodplains. This is achieved through solution of the 2D transport
equation combined with sub-models for settling or decay.</p>
<p>Limitations to note include:</p>
<ol style="list-style-type: decimal">
<li>Simulation of constituents through 1D culverts linked to 2D SX connections is currently
only on a mass balance basis. That is, it is assumed that the
concentration of a constituent exiting an SX connection is the same
as that at the entrance SX connection at the same timestep. This
approach conserves mass to the limit that the water inflows and outflows are approximately equal and that the transit time is small compared to the timescale at which constituent concentrations vary. In recognition of this simplification, only relatively ‘short’ 1D culverts linked to SX connections (using this timescale definition) should be simulated in the present release.</li>
<li>The dispersion scheme adopted by TUFLOW AD <span class="citation">(<a href="#ref-Falconer2005">Falconer et al., 2005</a>)</span> is
such as to allow use of literature values for longitudinal and transverse dispersion coefficients (<span class="math inline">\(K_{L}\)</span> and <span class="math inline">\(K_{T}\)</span>). Users adopting literature values for these coefficients (as provided in <span class="citation">(<a href="#ref-Falconer2005">Falconer et al., 2005</a>)</span>), should however do so with extreme caution, as they are known to vary widely, and by up to several orders of magnitude. It is always preferable
to use monitoring data to calibrate advection dispersion models
(TUFLOW AD included) and this should be done whenever and wherever
possible. If no such data is available, then literature values can
be used for <span class="math inline">\(K_{L}\)</span> and <span class="math inline">\(K_{T}\)</span>, however results need to be
appropriately caveated, and TUFLOW AD predictions (as for any AD
model) should be seen as qualitative or indicative at best.<br />
</li>
<li>Modelling predictions should also be cross checked with desktop
calculations where possible. For example, this might include a hand
calculation of expected salt masses in a given tidal system, with
comparison made to TUFLOW AD outputs.<br />
</li>
<li>TUFLOW AD allows for specification and computation of large
dispersion coefficients, and with the automatic substepping
implementation it should generally remain stable. However,
specification of large (i.e. greater than approximately 100-500)
dispersion coefficients may lead to results that are not physically
real or defensible. As such, (in conjunction with 2 and 3 above)
results should always be sanity checked and correlated with
measurements. Relying on uncalibrated model predictions is not
recommended.</li>
</ol>
<h2 class="hasAnchor" id="the-modelling-process"><span class="header-section-number">9.2</span> The Modelling Process<a href="#the-modelling-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="data-input-requirements"><span class="header-section-number">9.2.1</span> Data Input Requirements<a href="#data-input-requirements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The minimum requirements for setting up a
TUFLOW AD model are:</p>
<ol style="list-style-type: decimal">
<li>A properly constructed and stable TUFLOW hydraulic model; and</li>
<li>Boundary conditions for constituent concentrations (e.g. ocean
salinities, catchment inflow pollutant concentrations etc.).</li>
</ol>
<p>Initial conditions, dispersion coefficients, settling and decay rates
will all be set to zero if not specified to be otherwise.</p>
<p>Preferable (and recommended) data requirements include:</p>
<ol style="list-style-type: decimal">
<li>Water quality calibration information as time-series data at points.
This is particularly important for dispersion coefficient
calibration;<br />
</li>
<li>Spatially variant initial conditions;<br />
</li>
<li>Particulate matter settling rates (if any); and<br />
</li>
<li>Dissolved species decay/transformation rates (if any).</li>
</ol>
<h3 class="hasAnchor" id="calibration-and-sensitivity"><span class="header-section-number">9.2.2</span> Calibration and Sensitivity<a href="#calibration-and-sensitivity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Advection dispersion models are usually calibrated against water quality
observations. For example, salinity recovery data can be used to
calibrate and validate models, with longitudinal and transverse
dispersion coefficients being the primary free variables. Dissolved
and/or particulate constituents can then be simulated using the derived
dispersion coefficients, and can include use of settling and/or decay
rates as needed.</p>
<p>Ideally, models should be calibrated for conditions similar to those
under investigation (e.g. a catchment inflow to an estuary) although
this is not always possible, particularly when data is limited. In these
situations, sensitivity analyses could be carried out by increasing and
decreasing calibration variables, though this not a preferred approach due
to the large variability in the literature with respect to acceptable
dispersion coefficients.</p>
<h3 class="hasAnchor" id="model-resolution"><span class="header-section-number">9.2.3</span> Model Resolution<a href="#model-resolution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2D domain cell size needs to be sufficiently small to reproduce
advection dispersion behaviour. It is worth noting that, in general, the
larger the cell size is with respect to the scale of mixing processes,
the greater potential there is for numerical dispersion to play a role
in the model execution process. Even though TUFLOW AD has in-built
measures to reduce these effects, it is advisable to keep this in mind,
and perform at least some limited testing with your model to determine
its sensitivity to cell size.</p>
<h3 class="hasAnchor" id="AD-Computational-Timestep-3"><span class="header-section-number">9.2.4</span> Computational Timestep<a href="#AD-Computational-Timestep-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With TUFLOW Classic, the selection of the timestep is important in
that the run time is directly proportional to the number of timesteps
required to calculate model behaviour for the required time period.
Notwithstanding this, with TUFLOW Classic the AD module will automatically substep
with respect to the main hydraulic engine on the basis of maintaining both advective and dispersive stability (see Section <a href="#AD-Solution-2"><strong>??</strong></a>) so the selection of timestep should be
focused on ensuring hydraulic stability, as AD stability should follow,
providing reasonable dispersion coefficients are set.</p>
<p>TUFLOW HPC, being an explicit method already, uses a self-adaptive timestep
which is much smaller than Classic. Further, it uses the fourth order Runge-Kutta
temporal integration scheme, and the advection dispersion calculations are
performed on the same timestep and with the same scheme. When running AD models
in HPC There is generally no need for the user to change the timestepping from
the default method. Using high dispersion coefficients may cause TUFLOW HPC
to use a smaller timestep than otherwise required for the hydraulic calculations due
to the diffusion (Peclet) number control.</p>
<h3 class="hasAnchor" id="example-ad-models"><span class="header-section-number">9.2.5</span> Example AD Models<a href="#example-ad-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A step-by-step descrition outlining how to set up an AD model is provided on the <a href="https://wiki.tuflow.com/Advection_Dispersion_Modelling">TUFLOW Wiki</a>. An example model dataset is also available in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Advection_Dispersion">Advection Dispersion Example Models</a>.</p>
<h2 class="hasAnchor" id="data-input"><span class="header-section-number">9.3</span> Data Input<a href="#data-input" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="simulation-control-file"><span class="header-section-number">9.3.1</span> Simulation Control File<a href="#simulation-control-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<h4 class="hasAnchor" id="ADControlFile-4"><span class="header-section-number">9.3.1.1</span> TUFLOW AD Control File (.adcf File)<a href="#ADControlFile-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The TUFLOW AD Control File or .adcf file points to the two mandatory files required for AD model execution. It is the top of the tree for the AD model and is called into the .tcf by the <a href="#tcfADControlFile">AD Control File</a> command. The .adcf file must reference:</p>
<ul>
<li>One global database file, using the <a href="#adcfADGlobalDatabase">AD Global Database</a> command. For example, <br> <tcmd>AD GLOBAL DATABASE</tcmd><teq> == </teq><tblk>..\bc_dbase\2d_ad_globaldatabase_Demo1.csv</tblk></li>
<li>One boundary database file, using the <a href="#adcfADBCDatabase">AD BC Database</a> command. For example, <br> <tcmd>AD BC DATABASE</tcmd><teq> == </teq><tblk>..\bc_dbase\2d_ad_dbase_Demo1.csv</tblk></li>
</ul>
<p>Appendix <a href="#ADCFCommands-1"><strong>??</strong></a> lists and describes these commands and their parameters. No other commands are required in the adcf file.</p>
<h4 class="hasAnchor" id="AD-inputs-4"><span class="header-section-number">9.3.1.2</span> GIS Input File Types and Naming Conventions<a href="#AD-inputs-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Spatial variation in initial condition and minimum dispersion coefficient is an optional data entry that can be used. If adding this feature to your model, it is recommended that the prefixes described in Table <a href="#tab:tab-AD-GIS-Inputs">91</a> be adhered to for 2D GIS layers. This greatly enhances the data management efficiency and importantly makes it much easier for another modeller or reviewer to quickly interpret the model. This approach is also
consistent with that of TUFLOW.</p>
<table>
<caption>
<span id="tab:tab-AD-GIS-Inputs">Table 91: </span>GIS Input Data Layers and Recommended Prefixes
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
2D Domain GIS Layers
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Suggested File Prefix
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Section
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2D AD Initial Conditions
</td>
<td style="text-align:left;">
2d_ad_ic_
</td>
<td style="text-align:left;">
Layer containing polygons defining the spatial distribution of initial conditions for a given constituent. Optional.
</td>
<td style="text-align:left;">
Section <a href="#initial-conditions"><strong>??</strong></a>
</td>
</tr>
<tr>
<td style="text-align:left;">
2D AD Minimum Dispersion Coefficient
</td>
<td style="text-align:left;">
2d_ad_md_
</td>
<td style="text-align:left;">
Layer containing polygons defining the spatial distribution of minimum dispersion coefficients (<span class="math inline">\(D_w\)</span>) for a given constituent. Optional.
</td>
<td style="text-align:left;">
Section <a href="#minimum-dispersion-coefficient"><strong>??</strong></a>
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="d-geometries"><span class="header-section-number">9.3.2</span> 1D Geometries<a href="#d-geometries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW AD does not require any further 1D data in addition to the features already included in the TUFLOW hydraulic model.</p>
<h3 class="hasAnchor" id="ADConstituentProp-3"><span class="header-section-number">9.3.3</span> Specification of Constituent Properties<a href="#ADConstituentProp-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Constituent properties are specified in the Global Database file, which is identified in the .adcf file using the <a href="#adcfADGlobalDatabase">AD Global Database</a> command. This database file has a set structure, in much the same way as TUFLOW boundary database files, and can be created in software such as Microsoft Excel. The number of constituents simulated by TUFLOW AD is simply the number of line entries in this file (excepting the header data). Constituents can be removed from the simulation by prefacing rows
in the global database file with the ‘!’ or ‘#’ character. The maximum number of constituents TUFLOW AD can simulate is 20.</p>
<p>The global database file must be .csv (comma delimited) formatted. The first row must contain the predefined keywords (in order) as listed in Table <a href="#tab:tab-AD-GlobalDatabase">92</a>, separated by commas. Subsequent rows contain constituent data.</p>
<p>An example global database file is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Advection_Dispersion">Advection Dispersion Example Models</a>.</p>
<table>
<caption>
<span id="tab:tab-AD-GlobalDatabase">Table 92: </span>Global Database Keyword Descriptions
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Keyword
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
The name of a constituent. This might be ‘TN’ or ‘Salinity’ (without the inverted commas). The Name field is limited to 40 characters and must be alphanumeric characters only. Mandatory.
</td>
</tr>
<tr>
<td style="text-align:left;">
Heat Name
</td>
<td style="text-align:left;">
Not currently used. Leave blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Decay Rate
</td>
<td style="text-align:left;">
<p>The decay rate (k) of the constituent in units of day<sup>-1</sup>. This value is used in a first order decay calculations at each timestep, i.e.</p>
<center>
<span class="math inline">\(C(t) = C_{0}e^{-kt}\)</span>
</center>
<p>Where:</p>
<p><span class="math inline">\(\cdot\)</span> <span class="math inline">\(C(t)\)</span> is constituent concentration at time <span class="math inline">\(t\)</span><br />
<span class="math inline">\(\cdot\)</span> <span class="math inline">\(C_{0}\)</span> is a reference concentration<br />
<span class="math inline">\(\cdot\)</span> <span class="math inline">\(k\)</span> is the decay rate specified here; and<br />
<span class="math inline">\(\cdot\)</span> <span class="math inline">\(t\)</span> is time</p>
If no decay is required, then either enter 0 or leave the field blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Settling Rate
</td>
<td style="text-align:left;">
<p>The settling rate of the constituent in units of m.day<sup>-1</sup>. This value is used in a simple mass balance calculation that removes the constituent from the water column based on this rate.</p>
If no settling is required, then either enter 0 or leave the field blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Longitudinal Dispersion Coefficient
</td>
<td style="text-align:left;">
<p>The value <span class="math inline">\(K_{L}\)</span> for the constituent, as per Equation <a href="#eq:equ-X-Dispersion">(60)</a> for TUFLOW Classic and Equation <a href="#eq:equ-AD-Solution-2">(64)</a> for TUFLOW HPC. Allowing such variation between constituents permits simultaneous simulation of multiple constituents with varying dispersion properties. This is useful at the model calibration stage when a range of dispersion coefficients can be tested within one simulation to ascertain the best match to monitoring data. This feature can also be used in sensitivity testing. Notwithstanding this, this value should not be varied from constituent to constituent once the AD model is calibrated.</p>
If the field is blank or set to zero, then longitudinal dispersion is switched off.
</td>
</tr>
<tr>
<td style="text-align:left;">
Transverse Dispersion Coefficient
</td>
<td style="text-align:left;">
<p>The value <span class="math inline">\(K_{T}\)</span> for the constituent, as per Equation <a href="#eq:equ-Y-Dispersion">(61)</a> for TUFLOW Classic and Equation <a href="#eq:equ-AD-Solution-2">(64)</a> for TUFLOW HPC. Allowing such variation can be exploited in the same manner as described above for longitudinal dispersion. This value should not be varied from constituent to constituent once the AD model is calibrated.</p>
If the field is blank or set to zero, then transverse dispersion is switched off.
</td>
</tr>
<tr>
<td style="text-align:left;">
Initial Condition
</td>
<td style="text-align:left;">
<p>This can be set to either a single number or a path reference to a GIS layer (2d_ad_ic_). If the former is specified, then that value is applied uniformly to all wet cells at initialisation.</p>
<p>If a path to a GIS layer is specified, then the layer must comprise of (only) polygons with a single attribute. The attribute must be of type Float. The field name is not used by TUFLOW AD, so can be set to a label that is meaningful to the user. The polygon data, with spatially varying attributes of initial concentration is applied to wet cells at simulation initiation. Wet cells not covered by any polygon in the specified GIS layer are set to a concentration of zero.</p>
If the field is left blank, then a concentration of zero is applied to all cells.
</td>
</tr>
<tr>
<td style="text-align:left;">
Minimum
</td>
<td style="text-align:left;">
Not currently used. Leave blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Maximum
</td>
<td style="text-align:left;">
Not currently used. Leave blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Minimum Dispersion
</td>
<td style="text-align:left;">
<p>This sets the value of <span class="math inline">\(D_{w}\)</span> as per Equations <a href="#eq:equ-X-Dispersion">(60)</a> and <a href="#eq:equ-Y-Dispersion">(61)</a> for TUFLOW Classic and Equation <a href="#eq:equ-AD-Solution-4">(67)</a> for TUFLOW HPC. It can be set to either a single number or a path reference to a GIS layer. If the former is specified, then that value is applied uniformly to all wet cells at each timestep.</p>
<p>If a path to a GIS layer is specified, then the layer must comprise of (only) polygons with a single attribute. The attribute must be of type Float. The field name is not used by TUFLOW AD, so can be set to a label that is meaningful to the user. The polygon data, with spatially varying values of <span class="math inline">\(D_{w}\)</span> is applied to wet cells at each timestep. Wet cells not covered by any polygon in the specified GIS layer will have <span class="math inline">\(D_{w}\)</span> set to zero.</p>
This field cannot be left blank. If a minimum dispersion of zero is required, then 0.0 must be entered in this field. Errors will result if this field is left blank.
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="ADBoundaryConditions-3"><span class="header-section-number">9.3.4</span> Boundary Conditions<a href="#ADBoundaryConditions-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW AD uses the same approach as TUFLOW to setting up boundary
conditions, in that two types of files are required:</p>
<ul>
<li>Boundary condition database; and<br />
</li>
<li>Boundary condition data files (i.e. timeseries).</li>
</ul>
<p>Like TUFLOW, TUFLOW AD also uses a comma delimited format for both these
file types.</p>
<p>TUFLOW AD does not require specification of any geographical information
regarding the location of boundary conditions. All such required data is
passed from TUFLOW to TUFLOW AD for TUFLOW boundary types HT, QT, HS,
HQ, QC, VC, VT, and SA.</p>
<h4 class="hasAnchor" id="boundary-condition-bc-database"><span class="header-section-number">9.3.4.1</span> Boundary Condition (BC) Database<a href="#boundary-condition-bc-database" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A boundary condition (BC) database is created using spreadsheet software,
such as Microsoft Excel. It must be .csv (comma delimited) formatted and
is identified in the .adcf file (see <a href="#adcfADBCDatabase">AD BC Database</a>). The database contains a list of files and attribute names to search for within those files. The attribute names are then used to extract the desired boundary condition data.</p>
<p>The TUFLOW AD BC Database is structured in the same way as a standard TUFLOW BC Database,
in that it must contain a header line with subsequent rows of
information. The header line must contain the following keywords, in the below order, with meanings as per Table <a href="#tab:tab-AD-Database-Keywords">93</a>.</p>
<p>“Name, Source, Column 1, Column 2, Add Col 1, Mult Col 2, Add Col 2,
Column 3, Column 4”</p>
<table>
<caption>
<span id="tab:tab-AD-Database-Keywords">Table 93: </span>AD BC Database Keyword Descriptions
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Keyword
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
<p>The name of a BC data set. It consists of two concatenated elements as follows:</p>
<ul>
<li>First: This must be the same ‘Name’ attribute used in the GIS 2d_bc layer(s) specified in TUFLOW. This is third attribute in the 2d_bc layer and follows ‘Type’ and ‘Flags’. It may contain spaces, but must not contain commas. It is not case sensitive.<br />
</li>
<li>Second: This must be the name of the appropriate constituent for which the boundary condition is being specified. This name must be one of those specified in the AD Global Database ‘Name’ field.</li>
</ul>
<p>These two names are joined by a double underscore. As such, if there are “M” 2d_bc boundary condition objects specified in TUFLOW, and “N” constituents to be simulated by TUFLOW AD, then M*N entries are required in the AD BC Database.</p>
<p>An example is Ocean__Salinity, where the TUFLOW 2d_bc file has a line with Name attribute “Ocean” and the AD Global Database has a variable called “Salinity” listed.</p>
Mandatory.
</td>
</tr>
<tr>
<td style="text-align:left;">
Source
</td>
<td style="text-align:left;">
<p>The file from which to extract the BC data. It must be a .csv file. Paths are relative to the AD Global Database.</p>
Mandatory.
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 1
</td>
<td style="text-align:left;">
<p>The name of the first column of data (time values) in the .csv Source File.</p>
Mandatory.
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 2
</td>
<td style="text-align:left;">
<p>The name of the column of data in the .csv Source File. Values in this column are always concentrations, for all allowable BC sets. These are applied to cells corresponding to the appropriate locations of all types of BCs specified in TUFLOW 2d_bc GIS layers. These specified concentrations override any other computed concentrations at the boundary locations.</p>
<p>The exception to the above is for SA boundaries, where the specified concentration is multiplied by the inflow corresponding to that concentration (as passed to TUFLOW AD from TUFLOW) and the mass load over the SA polygon computed. This mass load is then added to the mass of constituent within the wet computational cells within the SA polygon, and mass conservation used to compute a new resultant ambient concentration.</p>
Mandatory.
</td>
</tr>
<tr>
<td style="text-align:left;">
Add Col 1
</td>
<td style="text-align:left;">
Not used. Leave Blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Mult Col 2
</td>
<td style="text-align:left;">
Not used. Leave Blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Add Col 2
</td>
<td style="text-align:left;">
Not used. Leave Blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 3
</td>
<td style="text-align:left;">
Not used. Leave Blank.
</td>
</tr>
<tr>
<td style="text-align:left;">
Column 4
</td>
<td style="text-align:left;">
Not used. Leave Blank.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="bc-database-example"><span class="header-section-number">9.3.4.2</span> BC Database Example<a href="#bc-database-example" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Excel spreadsheet below illustrates a simple example of a TUFLOW AD BC
Database, created in a Microsoft Excel worksheet that is exported as a .csv file for use
by TUFLOW AD. Four line boundaries have been specified via GIS in the TUFLOW model (with Name fields “West”, “North”, “East” and “South”) and two
constituents have been specified in the AD Global Database (with Name
fields “Tracer_01” and “Tracer_02”). Four boundaries and two
constituents thus require eight entries in the TUFLOW AD BC
Database file.</p>
<p><img src="images/AD_Database_Example1.png" style="display: block; margin: auto;" /></p>
<p>The Demo1_Concs.csv file was created by saving the below as a .csv file
from Excel. All values are concentrations in mg/L, with the exception of
the Time column, which has units of hours.</p>
<p><img src="images/AD_Database_Example2.png" style="display: block; margin: auto;" /></p>
<h3 class="hasAnchor" id="initial-conditions"><span class="header-section-number">9.3.5</span> Initial Conditions<a href="#initial-conditions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Initial conditions are specified for each constituent as either a
constant value or spatially varied value (see Table <a href="#tab:tab-AD-GlobalDatabase">92</a>). The former is
simply entered as a decimal (or integer) in the Initial Condition field
of the AD Global Database. This value is applied to all wet cells at
model initiation. The latter is applied by entering a relative (or absolute) file path to
a GIS layer in the Initial Condition field of the AD Global Database.
The GIS file has the attributes described in Table <a href="#tab:tab-AD-GIS-Inputs2">94</a>.</p>
<table>
<caption>
<span id="tab:tab-AD-GIS-Inputs2">Table 94: </span>2D Initial Conditions (2d_ad_ic) Attribute Descriptions
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Attribute
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Conc
</td>
<td style="text-align:left;">
The initial condition concentration.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p>As many polygons as needed can be included in this layer. Any wet cells
not covered by these polygons will be initialised to a concentration of
zero. The naming convention prefix for this layer is 2d_ad_ic_. The
objects must be polygons. Rectangles, round rectangles etc. are not
supported by TUFLOW. The attribute name is not read by TUFLOW AD and can
be anything meaningful to the user - “Conc” is used as an example above
for clarity.</p>
<h3 class="hasAnchor" id="GW-initial-conditions"><span class="header-section-number">9.3.6</span> Groundwater Initial Conditions<a href="#GW-initial-conditions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Initial concentrations can be set within groundwater layers using the following .tgc commands:</p>
<p><tcmd><a href="#tgcSetIGWConc">[Set | Read GIS | Read Grid] IGW Conc Layer N1,N2,..N Tracer M1,M2,..M</a><tcmd> <teq>==</teq> <tblk>[value | /path/to/file]</tblk></tblk></p>
<p>Where:</p>
<ul>
<li>N = The groundwater layer number (reference multiple in a single command)</li>
<li>M = The tracer number (reference multiple in a single command), as ordered in the AD Global Database</li>
</ul>
<p>If a layer number is not referenced, it is assumed to apply to layer 1. Likewise, if a tracer number is not referenced it is assumed to apply to the first tracer.
<em>Note, the order that ‘Layer’ and ‘Tracer’ appear in the command does not matter (i.e. tracer numbers could be listed before layer numbers).</em></p>
<h3 class="hasAnchor" id="minimum-dispersion-coefficient"><span class="header-section-number">9.3.7</span> Minimum Dispersion Coefficient<a href="#minimum-dispersion-coefficient" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Minimum dispersion coefficients are specified for each constituent as
either a constant value or spatially varied value (see Table <a href="#tab:tab-AD-GlobalDatabase">92</a>). The former
is simply entered as a decimal (or integer) in the Minimum Dispersion
field of the AD Global Database. This value is applied to all wet cells
at all timesteps. The latter is applied by entering a relative (or
absolute) file path to a GIS layer in the Minimum Dispersion field of
the AD Global Database. The GIS file has the attributes described in
Table <a href="#tab:tab-AD-GIS-Inputs3">95</a>.</p>
<table>
<caption>
<span id="tab:tab-AD-GIS-Inputs3">Table 95: </span>2D Minimum Dispersion Coefficient (2d_ad_md) Attribute Descriptions
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Attribute
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Conc
</td>
<td style="text-align:left;">
The initial condition concentration.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p>As many polygons as needed can be included in this layer. Any wet cells
not covered by these polygons will be assigned a minimum dispersion
coefficient of zero. The naming convention prefix for this layer is
2d_ad_md_. The objects must be polygons. Rectangles, round rectangles etc. are not
supported by TUFLOW. The attribute name is not
read by TUFLOW AD and can be anything meaningful to the user - “MD” is
used as an example above for clarity.</p>
<h2 class="hasAnchor" id="data-output"><span class="header-section-number">9.4</span> Data Output<a href="#data-output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- CDH review:  I think we ignore what's in the Console Window. I assume its a volume report (water vol / AD tracer conc). That metric however becomes meaningless when multiple tracers are used (ie. up to 20) 

### Console Window Display

In addition to the standard information displayed to the Console (DOS) Window during the data input stage (see Section \@ref(ConsoleDisplay-2)), when using TUFLOW HPC, an additional column is output titled 'tracer'. <!-- Waiting on PAR to provide me with what this column contains -->
<!--
<img src="images/AD_console.png" style="display: block; margin: auto;" />
-->
<!-- EFC to reviewer: this is what was in the original section that I have removed based on comments between me and PAR below.

TUFLOW AD displays a lot of information to the Console (DOS) Window
during the data input stages (for more information on the TUFLOW DOS Window see Section \@ref(ConsoleDisplay-2)). If there are data input problems, trace back through the Window buffer to
establish where in the input data process the problem occurs.
Alternatively, search the .adlf file (Section \@ref(AD-log-4)) or .tlf (Section \@ref(TLF-3)).

Once the simulation has started, the simulation status at each timestep
is displayed. The AD module writes to screen as an additional line to
the TUFLOW output as (for a constituent called 'Tracer_X'):

<tblk>Finished computing AD field for constituent: Tracer_X</tblk>
-->
<!-- EFC to PAR: I don't think this is true? I've run using Classic and the above is not written. I've also run in HPC, I can't see this. For a HPC model, it appears there is a new column called 'tracer'-->
<!-- PAR to EFC: try with verbose == on-->
<!-- EFC to PAR: still nothing with verbose on, give the above isn't written to the DOS window, can we delete this section-->
<h3 class="hasAnchor" id="tuflow-ad-log-files"><span class="header-section-number">9.4.1</span> TUFLOW AD Log Files<a href="#tuflow-ad-log-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW AD log files are written to the location specified by <a href="#tcfLogFolder">Log Folder</a> command in the .tcf file, or if this command is not usedthe same location as the .tcf file. The following logs are available:</p>
<ul>
<li>An AD simulation log file (.adlf);<br />
</li>
<li>A CFL condition log file - output when using <tcmd><a href="#adcfWriteCFL">Write CFL</a></tcmd><teq> == </teq><tblk>ON</tblk>, for TUFLOW Classic only; and<br />
</li>
<li>A mass balance log file - output when using <tcmd><a href="#adcfWriteMass">Write Mass</a></tcmd><teq> == </teq><tblk>ON</tblk>.</li>
</ul>
<h4 class="hasAnchor" id="AD-log-4"><span class="header-section-number">9.4.1.1</span> Simulation Log File<a href="#AD-log-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This file is named ‘<em>TCF name</em>.adlf’. It contains commentary of input reading, constituent specification etc. as the simulation sets itself up.</p>
<p>Following model initialisation, if <tcmd><a href="#adcfWriteIterations">Write Iterations</a></tcmd><teq> == </teq><tblk>ON</tblk> is used, for TUFLOW Classic only, the following is output at each timestep. For example:</p>
<p><tblk>Simulation time (h) 0.0125<br />
Finished constituent Tracer_01 at AD substep iteration number 1<br />
Finished constituent Tracer_02 at AD substep iteration number 1<br />
Finished constituent Tracer_02 at AD substep iteration number 2<br />
Finished constituent Tracer_02 at AD substep iteration number 3 </tblk></p>
<p>These lines show information regarding the simulation time for each
constituent. In particular, the number of AD sub-steps needed to be
executed to maintain stability under CFL and Peclet conditions is
reported. In the above example, constituent Tracer_01 required no
substepping, whilst constituent Tracer_02 required 3 substep iterations
to maintain stability. This is caused by Tracer_02 being set up with
greater dispersion coefficients than Tracer_01 in the <a href="#adcfADGlobalDatabase">AD Global
Database</a>. Additional rows are added as required by the number of
constituents simulated.</p>
<!-- PAR to EFC: try Write iterations == on-->
<!-- EFC to PAR: this is then written to the adcf but for CLA only-->
<!-- CDH Review: The timestep output would be meaningless for HPC. I've added the text below. -->
<p>This TUFLOW AD timestep information is not available for TUFLOW HPC, or needs review by the modeller, due to the fact the TUFLOW HPC hydraulic engine and advection dispersion calculations are performed on the same timestep and with the same scheme. See Section <a href="#AD-Computational-Timestep-3"><strong>??</strong></a> for discussion regarding timestep differences relating to TUFLOW Classic and TUFLOW HPC.</p>
<h4 class="hasAnchor" id="ADCFLLogFile-4"><span class="header-section-number">9.4.1.2</span> CFL Log File<a href="#ADCFLLogFile-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This file is named ‘<em>TCF name</em>_ADcfl.csv’. It can be output when using TUFLOW Classic in conjunction with the <tcmd><a href="#adcfWriteCFL">Write CFL</a></tcmd><teq> == </teq><tblk>ON</tblk> command. It contains commentary on CFL and Peclet
numbers, maximum dispersion coefficients and number of substep
iterations. The column data is as per Table <a href="#tab:tab-AD-Results1">96</a>:</p>
<table>
<caption>
<span id="tab:tab-AD-Results1">Table 96: </span>_ADcfl.csv File Columns
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
time (h)
</td>
<td style="text-align:left;">
The simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
Constituent Name
</td>
<td style="text-align:left;">
The name of the constituent as specified in the AD global database.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_CFL_u
</td>
<td style="text-align:left;">
The maximum CFL for u velocities anywhere in the computational domain at that timestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_CFL_v
</td>
<td style="text-align:left;">
The maximum CFL for v velocities anywhere in the computational domain at that timestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_Peclet_u
</td>
<td style="text-align:left;">
The maximum Peclet number for u dispersion anywhere in the computational domain at that timestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_Peclet_v
</td>
<td style="text-align:left;">
The maximum Peclet number for v dispersion anywhere in the computational domain at that timestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_sum_u
</td>
<td style="text-align:left;">
The maximum of the sum of CFL and Peclet numbers in the x (u) direction anywhere in the computational domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_sum_v
</td>
<td style="text-align:left;">
The maximum of the sum of CFL and Peclet numbers in the y (v) direction anywhere in the computational domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_Disp_x
</td>
<td style="text-align:left;">
The maximum dispersion coefficient in the x (u) direction anywhere in the computational domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
Max_Disp_y
</td>
<td style="text-align:left;">
The maximum dispersion coefficient in the y (v) direction anywhere in the computational domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
Num_iterations
</td>
<td style="text-align:left;">
The number of iterations required by TUFLOW AD to remain stable. This can vary from constituent to constituent if different dispersion coefficients are applied.
</td>
</tr>
</tbody>
</table>
<p>As per the TUFLOW AD timestep information in the ‘.adlf’ file. This log information is not available for TUFLOW HPC, or needs review by the modeller, due to the fact the TUFLOW HPC hydraulic engine and advection dispersion calculations are performed on the same timestep and with the same scheme. See Section <a href="#AD-Computational-Timestep-3"><strong>??</strong></a> for discussion regarding timestep differences relating to TUFLOW Classic and TUFLOW HPC.</p>
<h4 class="hasAnchor" id="ADLogMass-4"><span class="header-section-number">9.4.1.3</span> Mass Log File<a href="#ADLogMass-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This file is named ‘<em>TCF name</em>_ADmass.csv’. It can be output when using TUFLOW Classic or TUFLOW HPC in conjunction with the <tcmd><a href="#adcfWriteMass">Write Mass</a></tcmd><teq> == </teq><tblk>ON</tblk> command. It contains commentary on mass conservation.
Specifically, the column data is as per Table <a href="#tab:tab-AD-Results2">97</a>:</p>
<table>
<caption>
<span id="tab:tab-AD-Results2">Table 97: </span>_ADmass.csv File Columns
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
time (h)
</td>
<td style="text-align:left;">
The simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
Constituent Name 1
</td>
<td style="text-align:left;">
The total mass of that constituent in the computational domain. TUFLOW AD assumes that the constituent concentrations are specified in mg/L, and this number is then in tonnes of constituent. If the concentration is g/L, then this number should be multiplied by 1000 to be in units of tonnes.
</td>
</tr>
<tr>
<td style="text-align:left;">
Constituent Name 2
</td>
<td style="text-align:left;">
As per constituent 1. Column repeated until all constituents have been accounted for
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="check-files"><span class="header-section-number">9.4.2</span> Check Files<a href="#check-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When using the AD module, an <a href="https://wiki.tuflow.com/Check_Files_2d_ad_check">_AD_check</a> file will be output. For check file information, see the <a href="https://wiki.tuflow.com/Check_Files_2d_ad_check">_AD_check TUFLOW Wiki Page</a>.</p>
<h3 class="hasAnchor" id="result-files"><span class="header-section-number">9.4.3</span> Result Files<a href="#result-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Result files contain the computed spatial and temporal evolution of simulated constituents. The output is a temporal format (maximums are not available) and will be output in the format specified by the <a href="#tcfMapOutputFormat">Map Output Format</a> command. For example, if <tcmd><a href="#tcfMapOutputFormat">Map Output Format</a></tcmd><teq> == </teq><tblk>XMDF</tblk> is used, the XMDF output will contain a result type called “Conc Tracer_X”.</p>
<p>The AD output will automatically be produced unless the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command is set to “AD OFF”. This off option can also be set on a Map Output format basis (e.g. <tcmd>FLT Map Output Data Types</tcmd><teq> == </teq><tblk>AD OFF</tblk>).</p>
<p><a href="#tcfReadGISPO">Plot Outputs</a> are currently not supported for TUFLOW AD outputs.</p>
<!-- PAR to EFC Plot outputs not currently supported.-->
<!-- Thanks, have noted-->
<!-- PAR to EFC: If mass == on, should also get mass of a constituent in a cell.-->
<!-- EFC to PAR: doesn't look like it-->
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<!-- # Domain Linking  {#DomainLinking-1} -->
<!-- # Multi-Models - 1D, 2D, Variable 2D, External 1D  {#DomainLinking-1} -->
<h1 class="hasAnchor" id="DomainLinking-1"><span class="header-section-number">10</span> Combining Domains and Solvers<a href="#DomainLinking-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- EFC/WJS - I think we should review the title for this chapter, and possibly others -->
<h2 class="hasAnchor" id="Linked-1D2D-Models-Intro-2"><span class="header-section-number">10.1</span> Introduction<a href="#Linked-1D2D-Models-Intro-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter discusses methods available for dynamically linking 1D and 2D domains, linking with external (third-party) 1D solvers, and linking 2D domains together using Classic’s Multiple 2D Domains feature. HPC’s Quadtree feature, whilst allowing variable 2D cell sizes, is essentially one 2D domain over which a full 2D solution is applied is discussed in Section <a href="#Quadtree-3"><strong>??</strong></a>. A comparison between Classic’s M2D feature and HPC’s quadtree grid is presented in Section <a href="#TwoD2DLinking-2"><strong>??</strong></a>.</p>
<p>The range of functionalities discussed in the Chapter offer numerous benefits, including greater model design flexibility, greater computational efficiency and performance, and ability to integrate TUFLOW domains within supported third-party 1D solvers and models.</p>
<p>1D-2D linked models utilise the individual benefits of 1D
and 2D solution schemes. 1D schemes are typically used to represent
culverts or sub-surface pipe networks, and sometimes rivers, where the flow is essentially one-directional. 2D schemes are suited to the representation of, for example, rivers and floodplains or estuarine and coastal waters, where the hydrodynamics can flow in multiple horizontal directions, which requires the ability to simulate flow in a two-dimensional plane.</p>
<p>TUFLOW’s 2D solutions (Classic and HPC) may be dynamically linked to a variety of different 1D solutions, including TUFLOW 1D (ESTRY), EPA SWMM (herein referred to as SWMM in this chapter), Flood Modeller (formerly ISIS), 12D Dynamic Drainage (DDA), and XPSWMM from Autodesk (formerly XP-Software then Innovyze).</p>
<p>Within the one model, 1D domains that are TUFLOW 1D (ESTRY) and other 1D domains that are an external 1D scheme can occur. This may be useful where different 1D solvers offer different capabilities. Further, linking of TUFLOW 1D (ESTRY) directly to either Flood Modeller or SWMM is also possible.</p>
<p>The software environment for the 1D Solver / TUFLOW 2D combination varies:</p>
<ul>
<li>TUFLOW 1D (ESTRY) and SWMM are integrated within the TUFLOW executable. Model build tasks and result viewing associated with these linked 1D solvers is typically completed using traditional TUFLOW compatible GIS software.</li>
<li>12D Dynamic Drainage is developed by 12D Solutions. They have developed a TUFLOW interface within their own <a href="https://www.12d.com/product/12d_model_tuflow.html">12D GUI</a> that offers GUI functionality for 1D and 2D modelling tasks. The interface provides users with the ability to build models and view results entirely within its GUI. Alternatively, existing TUFLOW files created in a GIS form can be imported and used in the 12D GUI.</li>
<li>Flood Modeller, developed by Jacobs (formerly the ISIS software developed by Halcrow), is not built into the TUFLOW executable. Flood Modeller must be purchased from Jacobs, installed and configured, and to link with TUFLOW, the <a href="https://www.floodmodeller.com/tuflow">Flood Modeller TUFLOW Link</a> must also be purchased and installed. Flood Modeller accesses the TUFLOW solvers via the TUFLOW_LINK.dll that is part of the standard TUFLOW download. The Flood Modeller GUI is used for 1D model build tasks, and execution of the linked Flood Modeller 1D / TUFLOW model. The TUFLOW script (control) file and GIS environment is typically used for the TUFLOW 1D and 2D components.<br />
</li>
<li>XPSWMM functions in a fully independent GUI with TUFLOW fully embedded and operated “behind-the-scenes”. As such, the model development and results viewing information in this manual is not applicable and reference should be made to the XPSWMM documentation as supplied with the software. However, when XPSWMM runs a simulation with TUFLOW linked, all the standard TUFLOW script files, GIS layers and result outputs are written to disk should the user with to access these in their native formats.</li>
</ul>
<p>Varying the 2D cell size within a single model enables use of smaller cell sizes (finer resolution) in areas where a more detailed assessment is required or a finer grid is required to accurately represent the hydraulics, with the larger cell sizes covering the remaining areas of the model. The ability to vary 2D cell sizes within the one model optimises the grid construct thereby reducing simulation times and the memory footprint compared to a model that adopts a fine resolution over the entire model domain.</p>
<p>Both TUFLOW Classic and HPC offer the ability to vary 2D cell sizes using two different approaches:
- TUFLOW Classic offers 2D-2D linking of different 2D domains via the Multiple 2D Domains (M2D) Module. 2D-2D linked Classic models allow for a single model to contain multiple 2D domains of different cell sizes and different orientations. The 2D-2D link is via hidden TUFLOW 1D nodes that essentially pass the water from one 2D domain to another using HX links. Therefore, the solution across the link is not a full 2D solution, rather a linked 2D-1D-2D solution results that may not be as accurate as a full 2D solution.
- TUFLOW HPC doesn’t support Classic’s 2D-2D linking, but supports varying 2D cell sizes using a full 2D solution across a quadtree grid (the Quadtree Module, which purchase/licence wise is shared with Classic’s M2D Module, is required). The quadtree grid requires all 2D cells are on the same orientation and they can only vary in size by a factor of two when transitioning from a smaller cell to a larger cell.</p>
<h2 class="hasAnchor" id="OneD2dLinking-2"><span class="header-section-number">10.2</span> 1D and 2D Domain Linking Theory<a href="#OneD2dLinking-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW 1D and 2D domains can be linked in a variety of ways. Common configurations, as shown in Figure <a href="#fig:fig-1D-2DLinkingConfigurations">87</a>, include:</p>
<ul>
<li>1D culverts through 2D embankments.<br />
</li>
<li>1D pipe networks underneath the 2D domain.<br />
</li>
<li>Nesting of a 1D open channel (e.g. creek or river) through a 2D domain.<br />
</li>
<li>Connection of a broader 1D network catchment model to a high resolution 2D domain.</li>
</ul>
<center>
<div class="figure"><span style="display:block;" id="fig:fig-1D-2DLinkingConfigurations"></span>
<img src="images/1D2DLinkingConfigurations.png" alt="**1D/2D Linking Configurations**" width="100%" />
<p class="caption">
Figure 87: <strong>1D/2D Linking Configurations</strong>
</p>
</div>
</center>
<p>There are two types of 1D/2D linking options available:</p>
<ol style="list-style-type: decimal">
<li>Head (water level) boundaries to the 2D cells (HX); and<br />
</li>
<li>Source boundaries to the 2D cells (SX).</li>
</ol>
<p>These are described in the sections below.</p>
<h3 class="hasAnchor" id="HXBoundary-3"><span class="header-section-number">10.2.1</span> HX 2D Head Boundary<a href="#HXBoundary-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The HX terminology is derived from a <strong>H</strong>ead boundary being applied to
the 2D cell using data from an e<strong>X</strong>ternal 1D scheme. This type of
connection can be used to connect TUFLOW 2D with the 1D schemes of ESTRY (TUFLOW 1D), SWMM, Flood Modeller and XPSWMM. HX lines are typically used along riverbanks to define the 1D-2D exchange when 1D is used for in-channel representation, linked to the floodplain in 2D (commonly referred to as, 1D nested open channel modelling).</p>
<p>For 1D nested open channel modelling, the HX cells are defined using HX lines, connected to 1D nodes (i.e. the start and end of 1D channel lines) via connection (CN) lines. HX and CN line type objects are defined in the 2d_bc format layer. The 2d_bc layer is often renamed with the prefix 2d_hx should the modeller choose to store the HX lines in their own layer(s). The CN lines are snapped to the 1D nodes and vertices along the HX line.</p>
<p>The open channel area modelled by 1D must be deactivated from the 2D domain (2d_code: code = 0) otherwise the flow down the open channel will be duplicated in both the 1D and 2D domains. These model features are presented in Figure <a href="#fig:fig-HXSchematicPlanView">88</a>.</p>
<p>When TUFLOW carries out the hydraulic calculations, water level information at the 1D nodes is transferred to the HX line vertices that are connected to the 1D nodes via the CN lines. Along the HX lines, between the connected vertices, the water levels are linearly interpolated.</p>
<p>A HX line must have a CN line connected to each of its ends, along with any connections from intermediate 1D nodes to HX line vertices. Not every HX vertex has to have a 1D node connected. However, should a 1D node not be connected, the water level from that 1D node will not contribute to setting the water level profile along the HX line and undesirable results may occur.</p>
<p>If a single 1D node is connected to both ends of a HX line, the water levels in the 2D cells along the HX line will all be the same thereby producing a horizontal water level profile along the HX line. This approach is typically used for upstream boundaries into a 2D domain, and the line must be roughly digitised perpendicular to the flow (alternatively use a 2D QT boundary which automates this set up).</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HXSchematicPlanView"></span>
<img src="images/1D2DHXWaterLevel_001.png" alt="**HX Connection: Nested 1D Open Channel – Plan View**" width="100%" />
<p class="caption">
Figure 88: <strong>HX Connection: Nested 1D Open Channel – Plan View</strong>
</p>
</div>
</center>
<p>Flow can either enter or leave HX cells. The volume of water entering or leaving the cells is added or subtracted from the connected 1D nodes to conserve mass. The HX link preserves momentum in the sense that the velocity field is assumed to be undisturbed across the link, however, the solution across the HX line is not a complete 2D solution as the velocity field on the inactive side of the HX line is assumed, not calculated. The 2D velocity direction is not influenced by the direction of the linked 1D channel.</p>
<p>Because of the momentum preservation, the HX link approach produces a superior 1D-2D linking performance where complex flow behaviour occurs (e.g. river/floodplain interactions) than using a flow source approach such as applying a weir flow equation across the link. Figure <a href="#fig:fig-HXFlowPatterns">89</a> shows an example of the preservation of momentum across HX lines (shown in light purple) as water flows across a meander where the main channel is represented in 1D.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HXFlowPatterns"></span>
<img src="images/1D-2D%20flow%20patterns%20at%20meanders.100dpi.jpg" alt="**HX Connection: Example of Momentum Preservation across HX Lines**" width="100%" />
<p class="caption">
Figure 89: <strong>HX Connection: Example of Momentum Preservation across HX Lines</strong>
</p>
</div>
</center>
<p>The elevations of 1D-2D boundary cells determine when water can transfer between the 1D and 2D. Water level is calculated at the cell centres in the 2D engine (see Section <a href="#Schematisation-3"><strong>??</strong></a>), once the water level in the 1D node exceeds the elevation in the HX cell, water can enter or leave the cell. As such, an accurate definition of the 2D HX cell centre elevations is important. If a levee aligns with the HX line, a 2d_zsh thick breakline is recommended along the levee to ensure that the 1D-2D boundary cell elevations are consistent with the levee or spill crest.</p>
<p>In the four panels of Figure <a href="#fig:fig-HXSchematicSectionView">90</a>, the 2D HX connection is shown in section view at four differing water level stages:</p>
<ul>
<li>Panel 1: In bank flow: the water level in the 1D section is below the 2D cell
elevation and no flow is occurring across the 1D-2D connection.<br />
</li>
<li>Panel 2: Spill into the floodplain: the water level in the 1D section is above the 2D
cell elevation along the left bank (but not the right bank). In this
case, water is spilling from the 1D channel into the 2D floodplain on
the left bank.<br />
</li>
<li>Panel 3: Flow from floodplain: the water level in the 1D is below the
water levels on the 2D floodplains and water will drain from the
2D domain into the 1D channel, which typical occurs during a flood recession.<br />
</li>
<li>Panel 4: Perched floodplain: the flow is still moving from the 2D into
the 1D on the left bank, however, on the right bank, the water level
in the floodplain is below the 2D HX cell elevation and no flow is
occurring (the water is perched).</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HXSchematicSectionView"></span>
<img src="images/1D2DHXWaterLevelSectionView.png" alt="**HX Connection: Nested 1D Open Channel – Section View**" width="100%" />
<p class="caption">
Figure 90: <strong>HX Connection: Nested 1D Open Channel – Section View</strong>
</p>
</div>
</center>
<p>In addition to 1D-2D connections associated with nested 1D open channel / 2D floodplain situations, HX connections are also used to connect a 2D domain embedded within a broader 1D network representing the upstream and/or downstream river sections further afield. In Figure <a href="#fig:fig-HXExternalBoundaryConnection">91</a>, HX lines are shown along the upstream inflow to the 2D Domain as purple lines, the CN lines are shown in green. The CN lines are snapped to the 1D node at the end of the 1D network and the two vertices at either end of the HX line.</p>
<p>The water level at the 1D node is uniformly applied to the HX cells wherever the water level exceeds the cell ZC elevation. As the water level applied along the HX line will be horizontal the HX line must be digitised roughly perpendicular to the expected flow direction. Should the line not be perpendicular, circulatory flows maybe generated, so check that the flow patterns along HX lines appear to be reasonable.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HXExternalBoundaryConnection"></span>
<img src="images/1D2DHXExternalLink_001.png" alt="**HX Connection: External 1D Network Boundary Connection**" width="100%" />
<p class="caption">
Figure 91: <strong>HX Connection: External 1D Network Boundary Connection</strong>
</p>
</div>
</center>
<p>Note that for all HX links, the cell centre elevation (ZC) at a HX cell must be above the 1D bed level (interpolated between connected 1D nodes) otherwise an artificial flow across the link will be produced. To enforce this, TUFLOW produces an error message during the model initialisation, and terminates the simulation, if the interpolated 1D node elevation exceeds the 2D HX cell centre elevation (ZC). The ERROR message(s) are geo-referenced to easily identify the HX cells that lie below the 1D bed profile.</p>
<h3 class="hasAnchor" id="SXBoundary-3"><span class="header-section-number">10.2.2</span> SX 2D Flow Boundary<a href="#SXBoundary-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The SX terminology is derived from a <strong>S</strong>ource boundary being applied to the 2D cell using data from an e<strong>X</strong>ternal 1D scheme. This type of connection can be used to connect TUFLOW 2D with the 1D schemes of TUFLOW 1D (ESTRY), Flood Modeller, SWMM and XPSWMM. SX connections are typically used to transfer flow between 1D and 2D for 1D structures and at pits/drains/gully traps that capture water into the pipe network. Unique to SWMM, when using it as the 1D solver, an SX connection is only required at the downstream end of a 1D culvert (it uses a HX link at the upstream end due to limitations of the SWMM software).</p>
<p>At SX connections, the water level at the 1D node is reset every timestep as the average water level along the 2D SX cell(s). Conversely, the flow into or out of the 1D element feeds into the 2D SX cell(s) as a flow of water with the water level at the 2D cells computed as part of the 2D SWE solution. As the water level at the 1D node is set based on the water level in the SX cells, the storage in the 1D node is not used computationally in the 1D. Where there is an SX connection to 2D cell(s) from a 1D node, the average 1D node storage is distributed across the connected 2D SX cells.</p>
<p>The flow onto the SX cells is treated as a source flow, i.e. it can be positive or negative in magnitude but has no directional component. If there is more than one SX cell connected, the flow is, by default, proportioned via the depths in the 2D SX cells. The <a href="#tcfSXFlowDist">SX Flow Distribution Cutoff Depth</a> command can be used to control the depth of water below which an SX cell does not receive flows from the connected 1D element.</p>
<p>SX objects are digitised in the 2d_bc layer and have the type set to “SX”. They
can either be a point (a single SX cell), line (multiple
SX cells) or region object (multiple SX cells). When using the SX line
and region objects, these are joined to the 1D nodes with a single CN type
object, also in the 2d_bc layer, as shown in Figure <a href="#fig:fig-SXSchematicCrossDrainageStructure">92</a>. The (2d_bc) SX point, line and region objects are shown in purple, the (2d_bc) CN lines are shown in green, and the cells selected for the SX 1D-2D connection are highlighted in white.</p>
<ul>
<li>When using an SX point, the point object needs to snap to the 1d network (1d_nwk) at the nodes (end of the culvert). A single 2D cell is selected for the 1D-2D SX connection.<br />
</li>
<li>When using an SX line, a connection line snaps to the SX line and the 1d network (1d_nwk) node. Multiple 2D cells are selected for the 1D-2D SX connection. If the line does not select any 2D cells a single 2D cell is selected based on the line’s mid-point.</li>
<li>When using an SX region, a connection line snaps to a vertex of the SX region and 1d network (1d_nwk) node. Multiple 2D cells are selected for the 1D-2D SX connection based on whether the 2D cell centre falls within the region. If the region does not select any 2D cells a single 2D cell is selected based on the region’s centroid.</li>
</ul>
<p><strong>Note that when connecting an SX connection for a 1D structure it is important to
ensure that the width of connected SX cells at the structure invert (and higher levels for irregular shaped structures) is equal or more than the width of the
1D structure. This check should take into account whether any of the 2D SX cells are dry at the level being checked. If the width of water flow across the SX cells is less than the flow width of the 1D structure, the 2D SX cells become the constriction and instabilities or unrealistic flow patterns may result.</strong></p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SXSchematicCrossDrainageStructure"></span>
<img src="images/1D2DSXConfigurations_001.png" alt="**SX Connection Options**" width="100%" />
<p class="caption">
Figure 92: <strong>SX Connection Options</strong>
</p>
</div>
</center>
<p>The lowest 2D SX cell (based on the ZC, cell centre, elevation) must be below the 1D bed level (invert) otherwise mass can be artificially generated. TUFLOW produces an ERROR message during the model initialisation and a simulation will not run if a 1D node elevation falls below the lowest 2D ZC SX cell elevation.</p>
<p>In addition to culverts through embankments, SX connections are used to connect 1D pipe network inlets (pits) to the ground surface, which is modelled in 2D. An example is presented in Figure <a href="#fig:fig-SXSchematicPipeNetworkPlan">93</a> and Figure <a href="#fig:fig-SXSchematicPipeNetwork">94</a>. The SX connections are used to transfer flow between the 1D pit/pipe network and the 2D domain. To make the workflow more efficient, pit SX connections can be simply defined using one the pit attributes in a 1d_nwk or 1d_pit layer, thereby removing the need to have a 2d_bc layer - see Section <a href="#Pits-3"><strong>??</strong></a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SXSchematicPipeNetworkPlan"></span>
<img src="images/1D2DSXPipeNetwork_001.png" alt="**SX Connection: Pipe Network – Plan View**" width="100%" />
<p class="caption">
Figure 93: <strong>SX Connection: Pipe Network – Plan View</strong>
</p>
</div>
</center>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SXSchematicPipeNetwork"></span>
<img src="images/image140.jpeg" alt="**SX Connection: Pipe Network -Section View**" width="100%" />
<p class="caption">
Figure 94: <strong>SX Connection: Pipe Network -Section View</strong>
</p>
</div>
</center>
<h2 class="hasAnchor" id="OneD2DLinking-Estry-2"><span class="header-section-number">10.3</span> TUFLOW 1D (ESTRY) to TUFLOW 2D Linking<a href="#OneD2DLinking-Estry-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Linked TUFLOW 1D and 2D domain models use 2D HX and 2D SX boundary types
connected to 1D nodes (1d_nwk layer) using CN lines or points in the
2d_bc layer, as described in Section <a href="#TwoDBoundaries-2"><strong>??</strong></a>. The recommended approach
for HX and SX connections are summarised in the following sections.</p>
<h3 class="hasAnchor" id="OneD2DESTRYChannel-3"><span class="header-section-number">10.3.1</span> 1D Open Channel and 2D Domain Linking<a href="#OneD2DESTRYChannel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>2D_bc HX boundaries are preferred for transitioning between 1D domains and 2D domains (shown in Figure <a href="#fig:fig-HXExternalBoundaryConnection">91</a>) or when nesting a 1D open channel network within a 2D domain (shown in Figure <a href="#fig:fig-HXSchematicPlanView">88</a>).</p>
<p>An example of these HX connections is provided in Module 11 of the
<a href="https://wiki.tuflow.com/Tutorial_Introduction">TUFLOW Wiki Tutorials</a>. The <a href="https://wiki.tuflow.com/TUFLOW_1D2D_Boundary_Configuration_Guidance">TUFLOW Wiki</a> also
includes useful guidance on how to stabilise problematic 1D/2D TUFLOW HPC HX
connections.</p>
<h3 class="hasAnchor" id="OneD2DESTRYCulverts-3"><span class="header-section-number">10.3.2</span> 1D Structures Embedded within 2D Domains<a href="#OneD2DESTRYCulverts-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>2D_bc SX boundaries are preferred for inserting 1D culverts inside a 2D domain. For example, a 1D culvert underneath a road embankment, as shown in Figure <a href="#fig:fig-SXSchematicCrossDrainageStructure">92</a>.</p>
<p>An example of these SX connections is provided in Module 3 of the
<a href="https://wiki.tuflow.com/Tutorial_Introduction">TUFLOW Wiki Tutorials</a>. The <a href="https://wiki.tuflow.com/TUFLOW_1D2D_Boundary_Configuration_Guidance">TUFLOW Wiki</a> also
includes useful guidance how to stabilise problematic 1D/2D SX
connections.</p>
<h3 class="hasAnchor" id="OneD2DESTRYPipeNetwork-3"><span class="header-section-number">10.3.3</span> 1D Pipe Network Pits linked to 2D Domains<a href="#OneD2DESTRYPipeNetwork-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pits/Inlets within an urban drainage environment provide bi-directional connectivity between the urban surface represented by 2D domains and the 1D sub-surface pipe network. They use the SX type linking described in Section <a href="#SXBoundary-3"><strong>??</strong></a>. To simplify the model setup process the SX connections are automatically created by setting the Conn_1D_2D attribute for the pit/inlet point object to “SX” in the 1d_pit or 1d_nwk layer. The type of pit is defined using the ‘Type’ attribute:</p>
<ul>
<li>“C” pits use zero length circular culverts to calculate the flow transferred between the 1D network and 2D domain.<br />
</li>
<li>“R” pits use zero length box culverts to calculate the flow transferred between the 1D network and 2D domain.<br />
</li>
<li>“W” pits use the weir equation to calculate the flow transferred between the 1D network and 2D domain.<br />
</li>
<li>“Q” pits use a user-specified Depth-Discharge curve to transfer flow between the 2D domain and the 1D domain, based on the 2D water depth.</li>
</ul>
<p>Section <a href="#Pits-3"><strong>??</strong></a> contains information about the specification of pit parameters. A pipe network model example is provided in Module 5 of the
<a href="https://wiki.tuflow.com/Tutorial_Introduction">TUFLOW Wiki Tutorials</a>.</p>
<h3 class="hasAnchor" id="id_2DVirtualPits-3"><span class="header-section-number">10.3.4</span> Virtual Pits linked to 2D Domains<a href="#id_2DVirtualPits-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Compared to the above-mentioned approach, virtual pits are an alternative way to model pits/inlets where the sub-surface pipe network is not being modelled. The flow entering a virtual pit can either be discharged back into the model further downstream or permanently extracted from the model. There are three main approaches to using virtual pits:</p>
<ul>
<li>Virtual Pit Inlets (Type ‘VPI’) only are used to extract flow from the model. One examples would be where there is no or insufficient data on the pipe network. Another example is where the pipe network flow discharges to a river (assuming the level in the river does not affect the flow into the pits) and no pit surcharging back onto the 2D domain occurs.<br />
</li>
<li>VPIs are used in with Virtual Pipe Outlets (VPOs), which allow the flow into VPIs to be discharged back onto the model. VPIs can be allocated to specific VPOs via a common network ID. VPOs can have a limiting outlet flow. Once the VPO flow reaches the limit, the excess flow is surcharged back through VPIs, which can be prioritised as to which ones surcharge first. By default, the routing of flow between VPIs and VPOs on the same network is instantaneous (i.e. no lag). However from the 2023-03-AB build, it is possible to apply a lag or shift to the flows from the inlet to the outlet by using the 1d_pit Lag_Approach and Lag_Value attributes.<br />
</li>
<li>Flows from VPIs can be connected to 1D channel nodes to drain flow from the 2D surface and reintroduce them to the 1D domain further downstream. This is a useful approach to modelling the major sub-surface drainage system as a pipe network and the minor system as VPIs feeding into the major system.</li>
</ul>
<p>Section <a href="#Virtual-Pipes-2"><strong>??</strong></a> contains more information about virtual pits. Examples of these model configurations are provided in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Multiple_Domain_Model_Design">1D Pipe Network / 2D Floodplain Modelling Example Model Database</a>.</p>
<p>As previously mentioned, pits, virtual pits and nodes can be automatically connected to 2D domains using the 1d_nwk Conn_1D_2D attribute (see Table <a href="#tab:tab-PitsAttributeDescriptions">42</a> and Table <a href="#tab:tab-PitsModelNetwork">41</a>). If Conn_1D_2D is set to “SX”, TUFLOW automatically connects the upstream end of the pit channel or node to the 2D domain.</p>
<ul>
<li>For this automated 1D-2D SX connection to establish, it is a requirement that the 2D cell must be active (2d_code, Code = 1). If no active 2D cells are found from any 2D domain, a <a href="https://wiki.tuflow.com/TUFLOW_Message_2122">WARNING 2122</a> or <a href="https://wiki.tuflow.com/TUFLOW_Message_2123">2123</a> is issued.<br />
</li>
<li>The command <a href="#ecfPitDefault2DConnection">Pit Default 2D Connection</a> can be used to set the global default value for the 1d_nwk Conn_1D_2D attribute.<br />
</li>
<li>By default, TUFLOW will connect the 1D pit/virtual pit/node to one or more 2D cells at pit connections. The number of 2D cells selected is a function of the flow width of the pit inlet (including the effects of the Number_of and Width_or_Dia 1d_nwk attributes), or the total flow width of the channels connected to the node. The total width of the 2D cells selected is always more than the pit inlet width or width of channels. For example, a width of 3.6 m on a 2 m grid selects two cells. The advantage of selecting more than one 2D cell is to provide enhanced stability at the 1D/2D connection when the 1D flow width exceeds the 2D cell size. The number of 2D connection cells is limited to 10 per pit inlet.</li>
<li>The 1d_nwk Conn_No attribute can be used to change the number of 2D cells connected as follows:
<ul>
<li>A positive value adds that number of 2D cells to the automatic number. In the example above, if Conn_No is set to 1, three (2 + 1) 2D cells are connected. The upper limit is 10 connected cells.<br />
</li>
<li>If Conn_No is negative, this ignores the automatic approach and fixes the number of 2D cells connected to the absolute value of Conn_No. For example, a value of -1 would only connect the pit or node to one (1) 2D cell irrespective of the width.<br />
</li>
</ul></li>
<li>If more than one 2D cell is being connected, there are two approaches available for how the 2D cells are selected.
<ul>
<li>For pits, the default is the G (on Grade) option that selects the 2nd, 3rd, etc… cells by traversing to the next highest 2D cell that neighbours the 2D cell(s) already selected (this includes diagonal cells, i.e. all 8 cells around a cell are considered). These cells are also automatically lowered to the same height as the first cell so that their ZC value is at or below the pit inlet.<br />
</li>
<li>For nodes, the default is the S (Sag) option that selects the 2nd, 3rd, etc… cells by traversing to the next lowest 2D cell. The ZC values of these cells are not changed as they are already at or below the node invert.<br />
</li>
</ul></li>
<li>The above approaches can be changed using the G (Grade) and S (Sag) flags for the 1d_nwk Conn_1D_2D attribute. The G approach is that adopted by default for pits and S for nodes. To override the default approach, specify G or S as appropriate. For example, if the S approach is preferred for a pit that is draining a depression, specify an S flag for the Conn_1D_2D attribute (i.e. “SXS”). Note SX must come first before an optional flag is specified.</li>
</ul>
<p>Note, the conventional 1D-2D link approach using 2d_bc SX points, lines or regions can still be used to connect 1D channel ends. This gives the user complete control over the 2D cells selected and may still be preferred in situations where large 1D structures are being connected to 2D cells.</p>
<h2 class="hasAnchor" id="OneD2DLinkingSWMM-2"><span class="header-section-number">10.4</span> SWMM to TUFLOW Linking<a href="#OneD2DLinkingSWMM-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>New in the 2023-03-AD release, TUFLOW’s 1D linking and solver options have been expanded to support the EPA Storm Water Management Model (SWMM), see Chapter <a href="#OneD-SWMM-1"><strong>??</strong></a>. The SWMM engine (version 5) has been integrated into the TUFLOW executable as a 2D and 1D dynamically linked 1D solver. SWMM version 5 input (.inp) files can be directly input to TUFLOW.</p>
<p>In TUFLOW-SWMM there are three categories of connections between SWMM 1D and TUFLOW:</p>
<ul>
<li>Direct Connections: These apply to inlets/outlets associate with culverts passing through an embankment (modelled in 2D), or also open outlets from a pipe network.<br />
</li>
<li>Storm-Drain Inlets: These apply to surface pits/inlets for capturing overland flow into a pipe network. Geometry information associated with the storm-drain inlet is used to determine the discharge that should flow from the 2D domain into the 1D SWMM pipe network.<br />
</li>
<li>SWMM 1D connection to TUFLOW 1D (ESTRY) that allows 1D domains to be a combination of ESTRY and SWMM.</li>
</ul>
<h3 class="hasAnchor" id="OneD2DSWMMCulverts-5"><span class="header-section-number">10.4.1</span> 1D Culvert Connections to 2D Domains<a href="#OneD2DSWMMCulverts-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This type of connection is used for cross-drainage such as culverts through an embankment. Due to limitations within SWMM, HX connections are used at the Nodes–Storage object (upstream side) and SX connections are applied at the Nodes–Outfalls object (downstream). This configuration is presented in Figure <a href="#fig:fig-1D2DSWMMCulvert">95</a>.</p>
<p>Where a Nodes–Storage point is connected to the 2D domain using an inlet or HX connection, TUFLOW will compute the discharge that should be transferred between the 1D and 2D domain. If the water level in the 2D domain is higher than the 1D (potentially ponded) water level, then flow will be transferred from the 2D domain to the 1D. The discharge rate will depend on the difference in water levels.</p>
<p>A TUFLOW-SWMM culvert model is provided in Module 1 of the
<a href="https://wiki.tuflow.com/TUFLOW_SWMM_Tutorial_Introduction">TUFLOW-SWMM Wiki Tutorials</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-1D2DSWMMCulvert"></span>
<img src="images/1D2DSWMMCulvert.png" alt="**SWMM 1D Connection: Culvert**" width="70%" />
<p class="caption">
Figure 95: <strong>SWMM 1D Connection: Culvert</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="OneD2DSWMMPipeNetwork-3"><span class="header-section-number">10.4.2</span> 1D Pipe Network Connections to 2D Domains<a href="#OneD2DSWMMPipeNetwork-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>SX type linking described in Section <a href="#SXBoundary-3"><strong>??</strong></a> is recommended for pipe network storm-drain inlets. For a TUFLOW-SWMM model, storm-drain inlets can be defined in one of two ways, either:</p>
<ol style="list-style-type: decimal">
<li>Fully defined in a SWMM input (.inp) file format: In this form, all table items listed below (Streets, Conduits, Inlets, and Inlet Usage) are required. In addition, a “2d_bc” layer is required to provide the connectivity between the 1D inlets and the 2D domain.
<ul>
<li>Streets: SWMM uses the street cross-section information in this table to help compute storm drain inlet discharges, particularly for on-grade inlets.<br />
</li>
<li>Conduits (Streets): The conduits table is used to define streets for overland runoff and the slope is used in the storm drain inlet discharges. This table is not used directly when running a TUFLOW-SWMM model because the overland flows are calculated within TUFLOW.<br />
</li>
<li>Inlets: This table defines inlet configurations that describe how to determine inlet discharges. Inlets can be defined based on type and shape such as grates, curbs, and combination, or through curves that describe the relationship between depth and inlet discharge or approach flow and inlet discharge. The inlets table defines these parameters. The same inlet configuration can be used in multiple pit locations within the model.<br />
</li>
<li>Inlet Usage: This table identifies the placement of inlets including the street conduit, inlet (configuration), the node receiving the flow, and local parameters including blockage, size of local gutter depressions, and specification of on-grade, on-sag placement, or automatic placement.<br />
</li>
</ul></li>
<li>Defined using a SWMM input (.inp) file with a “swmm_inlet_usage” GIS layer: In this form TUFLOW creates a GIS layer to assist in the 1D-2D specification. <strong>Due to reduced data requirements and model build workflow efficiency the combined SWMM input (.inp) file / “swmm_inlet_usage” GIS layer format is the recommended approach.</strong> Using this format:
<ul>
<li>Table <a href="#tab:tab-SWMMinletusage">98</a> lists the attributes associated with the swmm_inlet_usage GIS layer.<br />
</li>
<li>Automatic inlet connections between the 1D network and 2D domain can be implemented via the “Conn1D_2D” attribute field (instead of manual specification of SX connection cells within a “2d_bc” GIS layer).</li>
<li>SWMM 5 “Inlet Usage” tables are not used, and Conduits (Streets) are not required. However, Streets and Inlet tables must be defined in the SWMM input (.inp) file.</li>
<li>2d_bc SX lines may be used to manually define connections associated with on-grade inlets. This gives the user complete control over the 2D cells selected for the on-grade flow calculations.</li>
<li>The conventional 1D-2D link approach using 2d_bc CN lines and SX lines can be used (instead of the automated methods) should greater control be required over the selected 2D cells for the 1D-2D on-grade inlet connections.</li>
<li>The conventional 1D-2D link approach using 2d_bc HX lines and SX points, lines or regions is required to connect 1D channel ends where “direct” connection to the 2D is desired.</li>
</ul></li>
</ol>
<p>An example model configuration is shown in Figure <a href="#fig:fig-1D2DSWMMPipeNetwork">96</a>, and example TUFLOW-SWMM pipe network models are also provided in Module 2, 3 and 4 of the
<a href="https://wiki.tuflow.com/TUFLOW_SWMM_Tutorial_Introduction">TUFLOW-SWMM Wiki Tutorials</a>.</p>
<p>Whether inlet usage details are defined in SWMM or in a separate GIS layer, the inlet discharges are computed within TUFLOW using EPA SWMM 5.2 code before being passed to the SWMM engine for the 1D solution computations. This approach has been selected to leverage the 2D domain hydraulic calculations.</p>
<p>If the pressure head in the 1D domain exceeds the 2D water level, the 1D domain will overflow (surcharge) into the 2D domain. The approach used to compute the surcharge discharge depends on the inlet setup and whether or not the SWMM node ponds.</p>
<ol style="list-style-type: decimal">
<li>If the node allows ponding (ponding &gt; 0) (recommended configuration):
<ul>
<li>The surcharge discharge is based on the depth vs flow curve for custom inlets or from the orifice equation for other inlet types, plus any additional discharge from the use of the <a href="#tscfMaximumInletPondedDepth">Maximum Inlet Ponded Depth</a> command.<br />
</li>
<li>The coefficient used for inlet surcharging can be specified with the <a href="#tscfInletSurchargeOrificeCoefficient">Inlet Surcharge Orifice Coefficient</a> command.<br />
</li>
<li>The discharge for custom curves is applied directly in reverse. For example, a 1D water level 0.3 feet above the 2D water level will produce the equal, though opposite, discharge as a 2D water level 0.3 feet above the 1D water level (or ground elevation).</li>
</ul></li>
<li>If the node does not allow ponding (ponding = 0):
<ul>
<li>Any volume that exceeds the maximum nodal water level (YMax) plus any surcharge depth (YSur) is reported as flooding by SWMM, which no longer tracks it. Therefore, the water is passed directly from the SWMM engine to the TUFLOW 2D cells. Although possible, this approach is not recommended because it prevents the 1D network from utilising the full pressure head in its flow calculations.</li>
</ul></li>
</ol>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-1D2DSWMMPipeNetwork"></span>
<img src="images/1D2DSWMMPipeNetwork_001.png" alt="**SWMM 1D Connection: Pipe Network**" width="70%" />
<p class="caption">
Figure 96: <strong>SWMM 1D Connection: Pipe Network</strong>
</p>
</div>
</center>
<table>
<caption>
<span id="tab:tab-SWMMinletusage">Table 98: </span><strong>SWMM Inlet Usage (swmm_iu) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 5%; ">
1
</td>
<td style="text-align:left;width: 10%; ">
Inlet
</td>
<td style="text-align:left;width: 30%; ">
The name of the inlet defined in the SWMM inp file “INLETS” section
</td>
<td style="text-align:left;width: 10%; ">
Char (100)
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
2
</td>
<td style="text-align:left;width: 10%; ">
StreetXSEC
</td>
<td style="text-align:left;width: 30%; ">
The name of the street cross-section that must be included in the SWMM SWMM inp file “Streets” section.
</td>
<td style="text-align:left;width: 10%; ">
Char (100)
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
3
</td>
<td style="text-align:left;width: 10%; ">
Elevation
</td>
<td style="text-align:left;width: 30%; ">
The elevation of the inlet. If a value of –99999 is entered, the elevation will be based on the 2D cell’s elevation.  
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
4
</td>
<td style="text-align:left;width: 10%; ">
SlopePct_Long
</td>
<td style="text-align:left;width: 30%; ">
The longitudinal slope of the street near the inlet.
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
5
</td>
<td style="text-align:left;width: 10%; ">
Number
</td>
<td style="text-align:left;width: 30%; ">
The number of inlets in series at the location (generally 1).
</td>
<td style="text-align:left;width: 10%; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
6
</td>
<td style="text-align:left;width: 10%; ">
CloggedPct
</td>
<td style="text-align:left;width: 30%; ">
The percentage that the inlet is blocked (defaults to 0.0).
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
7
</td>
<td style="text-align:left;width: 10%; ">
Qmax
</td>
<td style="text-align:left;width: 30%; ">
The maximum discharge through the inlet (default is 0 which does not enforce a maximum).
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
8
</td>
<td style="text-align:left;width: 10%; ">
aLocal
</td>
<td style="text-align:left;width: 30%; ">
The depth of a local depression at the inlet (default 0.0).
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
9
</td>
<td style="text-align:left;width: 10%; ">
wLocal
</td>
<td style="text-align:left;width: 30%; ">
The width of a local depression at the inlet (default 0.0).
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
10
</td>
<td style="text-align:left;width: 10%; ">
Placement
</td>
<td style="text-align:left;width: 30%; ">
Specifies whether the inlet should be treated as a sag or on-grade. Options are ON_GRADE, ON_SAG, or AUTOMATIC. AUTOMATIC (the default) will switch between ON_GRADE and ON_SAG depending upon the flow conditions at the inlet.
</td>
<td style="text-align:left;width: 10%; ">
Char(10)
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
11
</td>
<td style="text-align:left;width: 10%; ">
Conn1D_2D
</td>
<td style="text-align:left;width: 30%; ">
<p>Used to specify a “SX” connection and any additional flags such as “SXZ” or “SXG” that automatically creates a 2D SX cell and connection at the 2D cell within which the SWMM node occurs. This negates the need to create SX objects in a 2d_bc layer.</p>
<p>Flags:</p>
<ul>
<li>“L” – sets the ZU and ZV elevations to be the same as the ZC value only if they are lower. This can improve instabilities where the ZU and ZV values are significantly lower in elevation and can cause a sudden increase in transfer of water to/from the cell when the cell wets.</li>
<li>“Z” – Adjust the ZC elevation at each cell at/along/within the 2D SX object to below the 1D node bed elevation where ZC is higher. The ZC elevation is set to the Cell Wet/Dry Depth below the 1D node bed. An error occurs if the minimum ZC elevation plus the Cell Wet/Dry Depth at/along a SX object is not below the connected 1D node bed. Also see the SX ZC Check command that permits the user to define a maximum change in ZC elevation. It is not recommended to use the Z flag without first checking that the reason for the discrepancy in elevations between 1D and 2D domains is realistic.</li>
</ul>
By default, if more than one 2D cell is automatically connected, nodes are assumed to be connected using the Sag (S) approach. To override the default approach, specify “SXG” for an on-grade connection.
</td>
<td style="text-align:left;width: 10%; ">
Char (10)
</td>
</tr>
<tr>
<td style="text-align:right;width: 5%; ">
12
</td>
<td style="text-align:left;width: 10%; ">
Conn_Width
</td>
<td style="text-align:left;width: 30%; ">
<p>If “SX” is specified for Conn1D_2D, this field controls the number of 2D cells connected as follows. Note this approach is slightly different than is used by TUFLOW-ESTRY models.</p>
<ul>
<li>A positive value indicates the flow width that should be used to compute the number of 2D cells to connect to. TUFLOW will choose the nearest cells that are collectively as wide or wider than the specified flow width.</li>
<li>If negative, the number of cells selected is the absolute value of the number specified. For example, a value of –1 would connect the inlet to a single 2D cell.
</td>
<td style="text-align:left;width: 10%; ">
Float
</td>
</tr>
</tbody>
</table></li>
</ul>
<h3 class="hasAnchor" id="OneD2DLinkingSWMM1D-3"><span class="header-section-number">10.4.3</span> SWMM to TUFLOW 1D (ESTRY) Linking<a href="#OneD2DLinkingSWMM1D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>SWMM can be linked to TUFLOW 1D (ESTRY) allowing the modeller to use the different solvers and their benefits across the 1D domains of a model. Also, note that full support for 1D open channel modelling using SWMM is not yet available, but can be readily modelled using TUFLOW 1D. A typical combined scenario would be 1D open channel modelling using TUFLOW 1D dynamically linked to a SWMM pipe network. Combined SWMM 1D-TUFLOW 1D configurations can be dynamically linked to TUFLOW 2D using the approaches outlined in the previous sections.</p>
<p>SWMM and TUFLOW 1D nodes will be considered linked if:</p>
<ol style="list-style-type: decimal">
<li>A TUFLOW 1D node in a 1d_nwk layer, and a SWMM node layer are snapped to each other, and<br />
</li>
<li>The TUFLOW 1D node has a 1d_nwk Conn_1D_2D attribute of either “X1DH” or
“X1DQ”.
<ul>
<li>A “X1DH” link means a SWMM 1D water level is being
applied at the TUFLOW 1D node (i.e. SWMM sends TUFLOW 1D a water
level and TUFLOW 1D sends back a +/- flow to SWMM). This is applicable at SWMM Nodes–Junctions and Nodes–Storage locations.<br />
</li>
<li>A “X1DQ” link means a SWMM inflow/outflow is being
applied at the TUFLOW 1D node (i.e. SWMM sends TUFLOW 1D a +/-
flow and TUFLOW 1D sends back a water level). This is applicable at SWMM Nodes–Outfalls locations.</li>
</ul></li>
</ol>
<p>Note:</p>
<ul>
<li>The upstream and downstream inverts for the TUFLOW 1D node linked to SWMM should be set to -99999 unless the node is also being used to set the inverts of channels snapped to it.<br />
</li>
<li>SWMM cannot be connected to TUFLOW 1D and TUFLOW 2D from the same SWMM node. Only a single linkage is supported from a single SWMM node. This limitation is highlighted in the zoomed inset of Figure <a href="#fig:fig-1D1DSWMMTUFLOWConnection">97</a>. In this example the SWMM Link–Conduit is only linked to TUFLOW 1D, it is not connected to TUFLOW 2D via CN and HX lines. The connection of TUFLOW 2D is associated with the TUFLOW 1D open channels, offset from SWMM by a single short TUFLOW 1D channel length.</li>
</ul>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-1D1DSWMMTUFLOWConnection"></span>
<img src="images/1D1DSWMMTUFLOWLink.png" alt="**SWMM 1D / TUFLOW 1D Connection**" width="70%" />
<p class="caption">
Figure 97: <strong>SWMM 1D / TUFLOW 1D Connection</strong>
</p>
</div>
</center>
<h2 class="hasAnchor" id="OneD2DLinkingFM-2"><span class="header-section-number">10.5</span> Flood Modeller to TUFLOW Linking<a href="#OneD2DLinkingFM-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW 2D domains can be dynamically linked to Flood Modeller
(previously known as ISIS). Flood Modeller can also link to TUFLOW 1D
(previously known as ISIS-TUFLOW-PIPE or ISIS-ESTRY).</p>
<p>Unlike TUFLOW 1D or SWMM, Flood Modeller is not included in the TUFLOW executable download. It must be installed and configured to support the linking to TUFLOW. The <a href="https://www.floodmodeller.com/tuflow">TUFLOW Link</a> must be purchased from Jacobs and an appropriate software version used. It is recommended that TUFLOW 2020-10-AD or later is used in conjunction with Flood Modeller Version 5 or later. Figure <a href="#fig:fig-FMTUFLOWVersionCompatability">98</a> provides the compatibility between Flood Modeller and TUFLOW for versions prior to Flood Modeller 6 and TUFLOW 2020-10-AE. Post these releases, all TUFLOW Classic and TUFLOW HPC (including Quadtree) functionality is supported and compatible with Flood Modeller. Versions prior to Flood Modeller 4.5 will support TUFLOW Classic only. Regardless of the TUFLOW 2D solver (i.e. Classic or HPC), the linking mechanism is the same.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-FMTUFLOWVersionCompatability"></span>
<img src="images/FM_TUFLOW_Version_Compatability.png" alt="**Compatibility of Recent Flood Modeller and TUFLOW versions**" width="80%" />
<p class="caption">
Figure 98: <strong>Compatibility of Recent Flood Modeller and TUFLOW versions</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="oneD2DFMLinking2D-3"><span class="header-section-number">10.5.1</span> Flood Modeller 1D to TUFLOW 2D Linking<a href="#oneD2DFMLinking2D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To link Flood Modeller’s 1D scheme to TUFLOW 2D, a TUFLOW 1d_x1d GIS layer defining the locations of the Flood Modeller 1D nodes is required. The 1d_x1d layer can either be created by the user or by the Flood Modeller interface.</p>
<p>For linking 1D Flood Modeller to TUFLOW 2D, the TUFLOW 1d_x1d layer requires only one attribute, namely a string 12 characters long that contains the unique IDs of the Flood Modeller 1D nodes/sections. Any other attributes are presently ignored. Creation of this layer manually is possible through exporting a text or csv file containing the Node ID and XY coordinates of the nodes, provided the
Flood Modeller co-ordinates are in the same projection as the TUFLOW model. <strong>Note, the IDs are case sensitive (because Flood Modeller IDs are case sensitive).</strong></p>
<p>In the .tcf file, use either the <a href="#tcfReadGISX1DNodes">Read GIS X1D Nodes</a> or <a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a> command to read the 1d_x1d layer, as shown in the example below:</p>
<p><tcmd><a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a></tcmd><teq> == </teq><tblk>..\model\gis\1d_x1d_FM_nodes.shp</tblk></p>
<p>The digitising of channels (lines) within a 1d_x1d GIS layer is
optional and is only necessary if the model uses 1D Water Level Lines to display map outputs in the 1D domain (refer to Section <a href="#OneDMap-3"><strong>??</strong></a> for further details). If GIS layer(s) are provided including channels, they are also read into the .tcf file using the command <a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a>, and should be used with <a href="#tcfReadGISX1DWLL">Read GIS X1D
WLL</a>.</p>
<p>The example below shows the use of these commands (with the nodes and channels in separate files):</p>
<p><tcmd><a href="#tcfReadGISX1DNodes">Read GIS X1D Nodes</a></tcmd><teq> == </teq><tblk>..\Model\gis\1d_x1d_FM_nodes.shp</tblk><br />
<tcmd><a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a></tcmd><teq> == </teq><tblk>..\Model\gis\1d_x1d_FM_channels.shp</tblk><br />
<tcmd><a href="#tcfReadGISX1DWLL">Read GIS X1D WLL</a></tcmd><teq> == </teq><tblk>..\Model\gis\1d_x1d_FM_wlls.shp</tblk></p>
<p>Note, legacy models may include reference to ISIS in the above commands. For example, “X1D” in <a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a> can be substituted with “ISIS” (i.e. <a href="#tcfReadGISX1DNetwork">Read GIS ISIS Network</a>).</p>
<p>Connections (CN) in the 2d_bc layer are snapped to the nodes in the
1d_x1d layer in the same manner as a TUFLOW 1D 1d_nwk layer.</p>
<p>The following restrictions apply when connecting Flood Modeller nodes to TUFLOW 2D:</p>
<ul>
<li>HX lines should only be connected to Flood Modeller RIVER units. Flood
Modeller INTERPOLATE and REPLICATE units are also permitted. This
requires that the Flood Modeller unit between consecutive connections
along a HX line is always a RIVER unit. If this is not the case, an
“<a href="https://wiki.tuflow.com/TUFLOW_Message_2043">ERROR 2043</a> - 2D HX cell has been assigned to a non-RIVER unit” occurs. Where a non-RIVER unit occurs (e.g. at a structure), the HX
line needs to be broken.<br />
</li>
<li>Special Flood Modeller units may be required for some HX and SX
connections (refer to the <a href="https://help.floodmodeller.com/docs/how-to-select-the-tuflow-link-type-to-use">Flood Modeller
documentation</a>).</li>
</ul>
<p>It is not necessary for all Flood Modeller RIVER units between the
upstream and downstream ends of the HX line to be connected. Nodes/Sections may
be intentionally or accidentally omitted as with TUFLOW 1D nodes. Please note
that this is not recommended because by missing or omitting nodes the 1D
water level water surface gradient that is applied along the HX lines
will not be correctly represented.</p>
<p>TUFLOW checks whether the ZC elevation of a HX cell lies above the bed
of the 1D nodes and that the ZC elevation of a SX cell lies below the 1D
node bed, and if not, an error occurs (see Section <a href="#HXBoundary-3"><strong>??</strong></a> and Section <a href="#SXBoundary-3"><strong>??</strong></a>).</p>
<p>Use the <a href="https://wiki.tuflow.com/Check_Files_1d_x1d_nodes">_x1d_nodes_check</a> file to cross-check the external 1D nodes/sections that
were read by TUFLOW, and the associated information passed from the 1D scheme. Also use
the <a href="https://wiki.tuflow.com/Check_Files_1d_to_2d_bc">_1d_to_2d_check</a> file to cross-check the correct HX and SX cells are
connected to the correct channels (units). The HX cells in the <a href="https://wiki.tuflow.com/Check_Files_1d_to_2d_bc">_1d_to_2d_check</a> layer can be colour coded using the “Primary_no” attribute to identify the external 1D channel (unit) that the
flow in/out across the HX cells is associated with. For Flood Modeller,
by default HX cells are assigned to the upstream end of a river unit as a lateral
flow as per Flood Modeller conventions.</p>
<p>Note, the start and end simulation times and the timestep are
controlled by Flood Modellers GUI input fields, therefore, any
<a href="#tcfStartTime">Start Time</a>, <a href="#tcfEndTime">End Time</a> and
<a href="#tcfTimestep">Timestep</a> commands are ignored in the .tcf file. Therefore, it is best practice to remove (or comment out) these commands. Within the Flood Modeller GUI, the Flood Modeller 1D timestep can differ from the TUFLOW timestep. It is recommended that the Flood Modeller timestep be set as an integer divisor of the TUFLOW timestep.</p>
<p>No TUFLOW 1D .ecf file is required, and the TUFLOW 1D <a href="#tcfESTRYControlFile">ESTRY Control
File</a> command should not be specified unless there
are also TUFLOW 1D domain(s) in addition to the external scheme 1D
domain(s). Flood Modeller nodes can be directly linked to TUFLOW 1D
nodes allowing models to have a combination of Flood Modeller 1D and TUFLOW 1D (ESTRY) - refer to Section <a href="#oneD2DFMLinking1D-3"><strong>??</strong></a>. An example model demonstrating both ‘SX’ and ‘HX’ type links between Flood Modeller and TUFLOW is available <a href="https://gitlab.com/tuflow-user-group/third-party-tools/other/flood-modeller-tuflow-linked-examples">here</a>.</p>
<p>Note that Flood Modeller HX links may benefit from assigning a Form Loss Coefficient
(typically 0.1 to 0.5 in value) to HX lines using the 2d_bc “a”
attribute. For HX lines running along the riverbanks, especially
those with high overtopping velocities, improved stability and
representation of the energy losses associated with the water peeling
off from the river to the floodplain or vice versa can be achieved.</p>
<p>For model review purposes, the .tcf command <a href="#tcfWriteX1DCheckFiles">Write X1D Check Files</a> writes
out check_x1D_H_to_2D.csv and check_2D_Q_to_x1D.csv files. These contain
the water levels and flows sent to the 2D to/from Flood Modeller.</p>
<p>Example models demonstrating TUFLOW / Flood Modeller linking are available from the <a href="https://gitlab.com/tuflow-user-group/third-party-tools/other/flood-modeller-tuflow-linked-examples">TUFLOW Gitlab User Group</a>. Detailed documentation for the example models is available from the <a href="https://wiki.tuflow.com/TUFLOW_1D_Flood_Modeller_Connectivity">TUFLOW Wiki</a>. A TUFLOW / Flood Modeller linked model is provided in Module 1 of the <a href="https://wiki.tuflow.com/Flood_Modeller_Tutorial_Module02">TUFLOW / Flood Modeller Wiki Tutorials</a>.</p>
<h3 class="hasAnchor" id="oneD2DFMLinking1D-3"><span class="header-section-number">10.5.2</span> Flood Modeller 1D to TUFLOW 1D (ESTRY) Linking<a href="#oneD2DFMLinking1D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW 1D (ESTRY) domains can be dynamically linked with Flood Modeller. The most common reason this is carried out is to utilise TUFLOW 1D’s powerful pipe network features (see
Section <a href="#Pipes-2"><strong>??</strong></a>).</p>
<p>Flood Modeller and TUFLOW 1D (ESTRY) nodes will be considered linked if:</p>
<ol style="list-style-type: decimal">
<li>A TUFLOW 1D node in a 1d_nwk layer, and a Flood Modeller node in a <a href="#tcfReadGISX1DNodes">Read GIS X1D Nodes</a> or <a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a> layer are snapped.
<ul>
<li>Note, legacy models may include reference to ISIS in the command. For example, “X1D” in <a href="#tcfReadGISX1DNodes">Read GIS X1D Nodes</a> can be substituted with “ISIS” (i.e. <a href="#tcfReadGISX1DNodes">Read GIS ISIS Nodes</a>).<br />
</li>
</ul></li>
<li>The TUFLOW 1D node connection method is defined using the TUFLOW 1D 1d_nwk Conn_1D_2D attribute. If the Conn_1D_2D field is blank, a “X1DH” type is assumed - this is the default approach. Alternatively, a value of “X1DH” or “X1DQ” can be manually specified.
<ul>
<li>A “X1DH” link means a Flood Modeller 1D water level is applied at the TUFLOW 1D node (i.e. Flood Modeller sends TUFLOW 1D a water level and TUFLOW 1D sends back a +/- flow to Flood Modeller).</li>
<li>A “X1DQ” link means a Flood Modeller inflow/outflow is being applied at the TUFLOW 1D node (i.e. Flood Modeller sends TUFLOW 1D a +/- flow and TUFLOW 1D sends back a water level).</li>
<li>If the end of the TUFLOW 1D channel and the snapped Flood Modeller / TUFLOW 1D nodes are not in the same location a TUFLOW 1D 1d_nwk connector “X” channel type can be used to connect the end of the linked TUFLOW 1D channel to the TUFLOW 1D node snapped to the Flood Modeller node.<br />
</li>
<li>Note that the upstream and downstream inverts for the TUFLOW 1D node
linked to Flood Modeller should be set to -99999 unless the node
is also being used to set the inverts of channels snapped to it.</li>
<li>As a general rule, a TUFLOW 1D X1DH (the default) would be used for most Flood Modeller
TUFLOW 1D links. An X1DQ might be more appropriate where a Flood
Modeller model stops and flows into a TUFLOW 1D model.</li>
</ul></li>
</ol>
<p>Generally, a TUFLOW 1D timestep will be smaller than the Flood Modeller
timestep. In these cases, the total volume is accumulated over all TUFLOW 1D
timesteps within a Flood Modeller timestep, and applied to the Flood
Modeller model as a discharge by dividing the volume by the Flood
Modeller timestep.</p>
<p>When running a TUFLOW 1D Flood Modeller linked model, the mass balance output _MB1D.csv file includes four new columns (which are not present if the 1D-1D linking is not used):</p>
<ul>
<li>X1DH V In: The volume of water in via a X1DH link.<br />
</li>
<li>X1DH V Out: The volume of water out via a X1DH link.<br />
</li>
<li>X1DQ V In: The volume of water in via a X1DQ link.<br />
</li>
<li>X1DQ V Out: The volume of water out via a X1DQ link.</li>
</ul>
<p>Also, for model review purposes, the type or existence of a connection can be checked following a simulation by viewing the Conn_1D_2D attribute in the <a href="https://wiki.tuflow.com/Check_Files_1d_nwk_N">_nwk_N_check</a> layer. The
_messages GIS layer also contains <a href="https://wiki.tuflow.com/TUFLOW_Message_1393">CHECK 1393</a> messages at each TUFLOW 1D node linked to a Flood Modeller node.</p>
<p>Example models demonstrating TUFLOW Flood Modeller linking are available from the <a href="https://gitlab.com/tuflow-user-group/third-party-tools/other/flood-modeller-tuflow-linked-examples">TUFLOW Gitlab User Group</a>. Detailed documentation for the example models is available from the <a href="https://wiki.tuflow.com/TUFLOW_1D_Flood_Modeller_Connectivity">TUFLOW Wiki</a>. A TUFLOW 1D Flood Modeller linked model is also provided in Module 2 of the <a href="https://wiki.tuflow.com/Flood_Modeller_Tutorial_Module02">TUFLOW / Flood Modeller Wiki Tutorials</a>.</p>
<h2 class="hasAnchor" id="oneD2D12D-2"><span class="header-section-number">10.6</span> 12D-DDA to TUFLOW Linking<a href="#oneD2D12D-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>12D Dynamic Drainage Analysis (DDA) is developed by 12D Solutions based on the USA EPA-SWMM solver. 12D have developed a TUFLOW interface within their own <a href="https://www.12d.com/product/12d_model_tuflow.html">12D GUI</a> that offers GUI functionality for 1D and 2D modelling tasks. The interface provides users with the ability to build models and view result entirely within its GUI. Alternatively, existing TUFLOW files created in a GIS form can be imported and used in the 12D environment.</p>
<p>A TUFLOW engine licence, either purchased directly from <a href="https://www.12d.com/sales/australia.html">12D Solutions</a> or from <a href="sales@tuflow.com">TUFLOW</a> is required to use TUFLOW with 12D-DDA. If purchased from TUFLOW, the 12D modules, such as the TCF Interface Module and 12D-DDA Drainage Integration (Linking) Module, will need to be purchased from 12D Solutions.</p>
<p>For information detailing how to complete TUFLOW modelling using the 12D GUI, and linking TUFLOW 2D’s solvers with 12D-DDA, please contact <a href="https://www.12d.com/sales/australia.html">12D Solutions</a>.</p>
<h2 class="hasAnchor" id="TwoD2DLinking-2"><span class="header-section-number">10.7</span> Multiple 2D Domains<a href="#TwoD2DLinking-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Multiple 2D Domain Module license provides access to TUFLOW HPC’s Quadtree and TUFLOW Classic’s Multiple 2D Domain (M2D) features. Both of these features allow the 2D cell resolution (cell sizes) to vary across the model. However, they are very different in their hydraulic solution and construct as described below.</p>
<h3 class="hasAnchor" id="TwoD2DLinkingQDT-3"><span class="header-section-number">10.7.1</span> Classic’s M2D Feature versus HPC Quadtree<a href="#TwoD2DLinkingQDT-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>TUFLOW HPC only supports one 2D domain, however, the 2D cell size can be varied within the domain using the quadtree grid feature. In contrast, TUFLOW Classic’s M2D feature allows different 2D domains of different cell size/orientation to be linked together via hidden 1D nodes and HX lines.</li>
<li>For a HPC quadtree grid, the numerical solution remains a full 2D solution without loss of accuracy, undesirable numerical artefacts or wave reflections when transitioning from one cell size to another. For Classic’s M2D feature, there is a loss of accuracy, particularly where the flow is complex/circulating and the assumptions associated with momentum and the linear water level profile associated with HX lines are influential.</li>
<li>TUFLOW HPC Quadtree grids are set up by the modeller using a largely automated approach. Definition of 2D cell resolution regions is all that’s required. By comparison, TUFLOW Classic M2D requires manual definition of each 2D domain and the linkage between domains using 2D-2D links.</li>
</ul>
<p>Please contact <a href="mailto:sales@tuflow.com" class="email">sales@tuflow.com</a> if you wish to use these features, but do not have the M2D/Quadtree Module enabled on your licence.</p>
<!-- EFC (WJS) - I've commented out below text as not needed/duplicated in Ch 7
### TUFLOW HPC Quadtree {#TwoD2DLinkingQDT-3}

The Quadtree grid refinement functionality allows the user to vary the 2D cell resolution within a TUFLOW HPC model. Quadtree refinement allows for recursive division of square TUFLOW cells into four smaller square cells. Up to 9 levels of cell size refinement are currently permitted. All cells for all levels of refinement share a common orientation. The quadtree grid concept is presented in Figure \@ref(fig:fig-HPCQTGridIntro)

<center>
<div class="figure" style="text-align: center">
<img src="images/1D2DHPCQTMesh.png" alt="**TUFLOW HPC Quadtree Grid Concept**" width="70%" />
<p class="caption">(\#fig:fig-HPCQTGridIntro)**TUFLOW HPC Quadtree Grid Concept**</p>
</div>
</center>

TUFLOW HPC Quadtree grid refinement is activated when a Quadtree Control File is specified, using the TCF command '[Quadtree Control File](#tcfQuadtreeControlFile)'. The nesting level (i.e. levels of grid refinement) is defined using the Quadtree Control File (QCF) GIS file reference command 
'[Read GIS Nesting](#qcfReadGISNesting)'. Within the GIS Nesting layer (2d_qnl), the nest level attribute must be in the range 1 to 9. A value of 1 value represents the most coarse resolution, and is also referred to as the "Base Cell Size" value. A value of 2 indicates the cell size within the polygon would be at Level 2 (i.e. half the base cell size). 3 would be cells at ¼ of the base cell size, 4 for 1/8th and so on up to a maximum of 9 (1/256th). For numerical precision reasons, the maximum nesting level of 9 (or 1/256) of the base cell size has been adopted. Note, if it is defined, there should only be a maximum of one Level 1 polygon included in the 2d_qnl layer, but for all other nest levels there is no limit on the number of polygons. 

It is a requirement that each 2D cell face can have a maximum of 2 adjoining cell faces. When refining grid areas, if a nesting level polygon does not sit within another polygon of the next higher level, such as if a Level 4 polygon is defined within a Level 1 or Level 2 polygon, intermediate areas of refinement are automatically generated by TUFLOW. This Quadtree grid behaviour is shown at the road intersection in Figure \@ref(fig:fig-HPCQTGridAuto). Alternatively if a refinement polygon sits within a polygon of the next higher level (e.g. a Level 3 polygon is defined within a Level 2), no automatic refinement is required or occurs, as shown in Figure \@ref(fig:fig-HPCQTGridManual).

<center>
<div class="figure" style="text-align: center">
<img src="images/1D2DHPCQTMesh_Auto.png" alt="**TUFLOW HPC Quadtree Grid - Automatic Refinement**" width="70%" />
<p class="caption">(\#fig:fig-HPCQTGridAuto)**TUFLOW HPC Quadtree Grid - Automatic Refinement**</p>
</div>
</center>

<center>
<div class="figure" style="text-align: center">
<img src="images/1D2DHPCQTMesh_Manual.png" alt="**TUFLOW HPC Quadtree Grid - Manual Refinement **" width="70%" />
<p class="caption">(\#fig:fig-HPCQTGridManual)**TUFLOW HPC Quadtree Grid - Manual Refinement **</p>
</div>
</center>
-->
<p>Due to the workflow efficient nature of its implementation, superior stability, numerical accuracy and preservation of inertia, TUFLOW HPC Quadtree has superseded TUFLOW Classic’s Multiple 2D Domain (M2D) feature as the recommended approach for models that require varied 2D cell sizes within a single model.</p>
<p>For a complete description of the 2D TUFLOW HPC Quadtree solution and associated commands, please refer to Section <a href="#Quadtree-3"><strong>??</strong></a>.</p>
<p>An example TUFLOW HPC Quadtree model is available in Module 7 of the <a href="https://wiki.tuflow.com/Tutorial_Introduction">TUFLOW Wiki Tutorials</a>. A video demonstration the implementation of this multiple 2D Domain feature is also available in the <a href="https://www.tuflow.com/library/videos/#howtoquadtree">TUFLOW Library</a>.</p>
<h3 class="hasAnchor" id="TwoD2DLinkingM2D-3"><span class="header-section-number">10.7.2</span> TUFLOW Classic’s Multiple 2D Domains<a href="#TwoD2DLinkingM2D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When using TUFLOW Classic with the M2D feature, any number of 2D domains of different cell size and orientation can be combined to form one model. The 2D domains can be linked via 1D domains
or directly to each other. For example, a 1D domain of a river system
may have several 2D domains embedded to represent several towns
where a more detailed analysis is required. Alternatively, direct 2D to
2D linking can be achieved by using the 2d_bc 2D link type (see Section <a href="#TwoDBoundaries-2"><strong>??</strong></a>).
Examples of these model configurations are shown in Figure <a href="#fig:fig-MultipleDomainModellinkedvia1DDomain">99</a> and Figure <a href="#fig:fig-MultipleDomainModellinkedvia2DLink">100</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-MultipleDomainModellinkedvia1DDomain"></span>
<img src="images/image142.png" alt="**Schematic of a Multiple Domain Model linked via a 1D Domain**" width="80%" />
<p class="caption">
Figure 99: <strong>Schematic of a Multiple Domain Model linked via a 1D Domain</strong>
</p>
</div>
</center>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-MultipleDomainModellinkedvia2DLink"></span>
<img src="images/image143.png" alt="**Schematic of a Multiple 2D Domain Model using the 2d_bc “2D” Link**" width="80%" />
<p class="caption">
Figure 100: <strong>Schematic of a Multiple 2D Domain Model using the 2d_bc “2D” Link</strong>
</p>
</div>
</center>
<p>To specify more than one 2D domain use <a href="#tcfStart2DDomain">Start 2D
Domain</a> and <a href="#tcfEnd2DDomain">End 2D Domain</a> in the
.tcf file to start and end blocks of commands applicable for each 2D
domain. The <a href="#tcfESTRYControlFile">ESTRY Control File</a> and <a href="#tcfBCDatabase">BC
Database</a> commands are independent of the 2D domain
block. As such they are typically not included within the 2D domain
block.</p>
<p>The mandatory .tcf commands that occur within a 2D domain block are:</p>
<table>
<colgroup>
<col style="width: 49%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>
<a href="#tcfGeometryControlFile">Geometry Control File</a><br />
<a href="#tcfBCControlFile">BC Control File</a>
</th>
<th>
<a href="#tcfTimestep">Timestep</a>
</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>Optional commands that can be used are:</p>
<table>
<colgroup>
<col style="width: 49%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>
<a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a><br />
<a href="#tcfInstabilityWaterLevel">Instability Water Level</a><br />
<a href="#tcfReadGISFC">Read GIS FC</a><br />
<a href="#tcfReadGISGLO">Read GIS GLO</a>
</th>
<th>
<a href="#tcfReadGISIWL">Read GIS IWL</a><br />
<a href="#tcfReadGISDIWL">Read RowCol IWL</a><br />
<a href="#tcfReadGISLP">Read GIS LP</a><br />
<a href="#tcfReadGISPO">Read GIS PO</a>
</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p><strong>Note that specifying one of the above commands outside a Start/End 2D
Domain block does not apply that command to all 2D domains.</strong> For
example, specifying <a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a> outside a
block will not set the <a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a> value
to all 2D domains, and causes ERROR 2107 to occur.</p>
<p>An example of using 2D domain blocks is given below:</p>
<tcmd><a href="#tcfStart2DDomain">Start 2D Domain</a></tcmd><teq> == </teq><tblk>East_Domain</tblk><br>
<ol>
<tcmd><a href="#tcfGeometryControlFile">Geometry Control File</a></tcmd><teq> == </teq><tblk>..\model\east_domain.tgc</tblk><br>
<tcmd><a href="#tcfBCControlFile">BC Control File</a></tcmd><teq> == </teq><tblk>..\model\east_domain.tbc</tblk><br>
<tcmd><a href="#tcfTimestep">Timestep</a></tcmd><teq> == </teq><tblk>10</tblk><br>
</ol>
<p><tcmd><a href="#tcfEnd2DDomain">End 2D Domain</a></tcmd><br></p>
<tcmd><a href="#tcfStart2DDomain">Start 2D Domain</a></tcmd><teq> == </teq><tblk>West_Domain</tblk><br>
<ol>
<tcmd><a href="#tcfGeometryControlFile">Geometry Control File</a></tcmd><teq> == </teq><tblk>..\model\west_domain.tgc</tblk><br>
<tcmd><a href="#tcfBCControlFile">BC Control File</a></tcmd><teq> == </teq><tblk>..\model\west_domain.tbc</tblk><br>
<tcmd><a href="#tcfTimestep">Timestep</a></tcmd><teq> == </teq><tblk>5</tblk><br>
</ol>
<p><tcmd><a href="#tcfEnd2DDomain">End 2D Domain</a></tcmd></p>
<p><tcmd><a href="#tcfBCDatabase">BC Database</a></tcmd><teq> == </teq><tblk>..\bc_dbase\bcdbase_Q100_2hr_001.csv</tblk><br>
<tcmd><a href="#tcfESTRYControlFile">ESTRY Control File</a></tcmd><teq> == </teq><tblk>..\model\1D_domain.ecf</tblk><br>
<tcmd><a href="#tcfReadMaterialsFile">Read Materials File</a></tcmd><teq> == </teq><tblk>..\model\n_values.tmf</tblk><br>
<tcmd><a href="#tcfStartTime">Start Time</a></tcmd><teq> == </teq><tblk>0</tblk><br>
<tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> == </teq><tblk>12</tblk></p>
<p>Multiple 2D domain models use the 2d_bc “2D” link type (see Table <a href="#tab:tab-twoDBoundary">77</a> and Table <a href="#tab:tab-ConditionsAttribute">78</a>) as the boundary cells that transfer flow between the
neighbouring domains. The link type creates hidden 1D nodes at each
vertex along the 2D link line and also at a regular interval, as defined
by the “d” attribute (see Table <a href="#tab:tab-ConditionsAttribute">78</a>). The hidden 1D nodes act as storage
that convey the water from one 2D domain to the other.</p>
<p>The water levels along the 2d_bc 2D link line are linearly interpolated using the water
levels in the hidden 1D nodes. If the water level profile in reality is
not close to linear between vertices, strange flow patterns may occur
which can lead to model instability or unrealistic results. As such, appropriate resolution of
the hidden 1D nodes is an important feature of multiple 2D domain
models.</p>
<p>The .tcf command <a href="#tcfReveal1DNodes">Reveal 1D Nodes</a> can be
used to view the hidden 1D nodes. The hidden nodes will be written to
the nwk_N check layer, as shown in Figure <a href="#fig:fig-Multiple2DDomainModelLinkCheckFiles">101</a> . For multiple domain
models using the 2d_bc “2D” link, note that this GIS layer must be read
into the .tbc files of <strong>both</strong> 2D domains. The 2D link can then be
checked by viewing the <a href="https://wiki.tuflow.com/Check_Files_2d_to_2d_bc">_2d_to_2d_check</a> layer which displays the 2D
cells used to link the two domains together. These features, and their
check files are shown in Figure <a href="#fig:fig-Multiple2DDomainModelLinkCheckFiles">101</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-Multiple2DDomainModelLinkCheckFiles"></span>
<img src="images/image144.png" alt="**Multiple 2D Domain Model “2D” Link Check Files**" width="50%" />
<p class="caption">
Figure 101: <strong>Multiple 2D Domain Model “2D” Link Check Files</strong>
</p>
</div>
</center>
<p>The following guidance is recommended when defining the location and
orientation of the 2d_bc “2D” link.</p>
<ul>
<li>2D link lines will be most stable if digitised perpendicular to the
dominant flow direction in high conveyance locations (e.g. rivers and
creeks).<br />
</li>
<li>Orientation of the 2D link lines is less critical in low conveyance
regions, such as floodplain storage areas (i.e. perpendicular
orientation is not a necessity). High resolution definition of the
hidden 1D nodes may be required. If used, the automated hidden 1D
nodes distance attribute “d” should not be set finer than three times
the larger cell size.</li>
</ul>
<p>If the extents of the 2D domains overlap, it will be necessary to
deactivate the overlapping cells in the other domain. Using the example
above, the active area for the ‘West Domain’ will need to be deactivated
in the .tgc file of the ‘East Domain’ and vice versa. The <a href="#tgcReadGISCode">Read GIS Code
Invert</a> command is useful for this process as it allows
for the same GIS layer to be used to active/deactivate cells.</p>
<p>A unique model <a href="#tcfTimestep">Timestep</a> is recommended for each 2D
domain. The timestep should be defined so that it conforms to the Courant
stability criteria for each domain, as discussed in Section <a href="#TUFLOWClassicTimestep-3"><strong>??</strong></a>.
The timesteps of all 2D and 1D domains should be an integer multiple of
one another.</p>
<p>A TUFLOW Classic Multiple 2D Domain model is available in Module 9 of the <a href="https://wiki.tuflow.com/Tutorial_Model_Archive">TUFLOW Wiki Tutorials Archive</a>.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Outputs-1"><span class="header-section-number">11</span> Outputs<a href="#Outputs-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Meeting notes
Reorganise sections/headings - big task, probably needs draft and chat between EAS/EFC
Shorten headings
Section heading name - "Outputs" - link to viewing outputs in first paragraph
Version referenced removed from text but included in appendices
-->
<!-- EFC
Some notes on the broader structure:
- maybe the section title should be 'Output Customisation' - it just makes more sense to me to put the keyword (Output) first. Or maybe simplified to 'Ouputs' or 'Output Options'
- sub-headings should use a consistent convention (i.e. currently there is 'configuring plot output options' and then 'customising map output')
- I think sub-headings should be simplified:
    - Introduction
    - Ouput Control Commands
    - Plot Ouputs (maybe could be renamed time series outputs?)
    - Map Outputs
    - 1D Map Outputs
    - Map Output Formats
    - Map Output Data Types
    - Specialised Outputs
- how much flexibility do we have in changing the section order? is this locked it to try and keep some backward consistency? To me, map output sections should be grouped.
- missing 1D outputs - e.g. Output Data Types == (in the ecf) or 1D Output Data Types == (in the tcf)
- maybe listing the minimum required commands is useful
-->
<!-- EFC: above has been done-->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1,
              "sort": false
             });
         } );
</script>
<p>Prior to carrying out a simulation the desired output needs to be configured and customised. For viewing outputs, see Chapter <a href="#Viewing-Output-1"><strong>??</strong></a>. There are also a variety of post-processing utilities available, see Chapter <a href="#Utilities-1"><strong>??</strong></a>.</p>
<p>The chapter includes discussion on:</p>
<ul>
<li>Setting the folder location of where outputs are written (Section <a href="#Location-2"><strong>??</strong></a>).</li>
<li>Configuring map output options including 1D results in a 2D form and the powerful output zones feature (Section <a href="#Map-2"><strong>??</strong></a>).</li>
<li>Options for setting up time-series output from 1D and 2D domains at specified locations (Section <a href="#TimeSeries-2"><strong>??</strong></a>).</li>
<li>Specialised outputs such as time and depth of inundation along evacuation routes (Section <a href="#Specialised-2"><strong>??</strong></a>).</li>
<li>Options for customising the check and log file outputs (Section <a href="#ChecksLogs-2"><strong>??</strong></a>).</li>
<li>List of commands available for customising all the different output options, including output to the simulation console window, check files and folder locations (Section <a href="#Commands-2"><strong>??</strong></a>).</li>
</ul>
<h2 class="hasAnchor" id="Location-2"><span class="header-section-number">11.1</span> Output Location<a href="#Location-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To set the location of where the outputs are written to, the <a href="#tcfOutputFolder">Output Folder</a> command is used. For example “<tcmd>Output Folder</tcmd><teq> == </teq><tblk>&lt;folder&gt;</tblk>” redirects all TUFLOW output data except the log and summary files to the specified folder.</p>
<p>Outputs can be written in a different location to where the model sits. It is typically recommended to write outputs to your local C: or D: drive instead of filling up the network drive, or to keep results separate to the input data. A URL can be used (e.g. \myserver), which is useful for running simulations on other computers, but with the output directed to your local drive (your drive will need to be shared) or other location.</p>
<p>The <a href="#tcfOutputDrive">Output Drive</a> command can be used to change the drive letter of any output files with a full path specified. For example “<tcmd>Output Drive </tcmd><teq>==</teq><tblk> K</tblk>” changes any output filepaths that have a drive letter to the K drive.</p>
<h2 class="hasAnchor" id="Map-2"><span class="header-section-number">11.2</span> Map Outputs<a href="#Map-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW has a range of commands that allows the user to control the formats, data types, frequency, sub-areas (output zones) or resolution (SGS high-resolution) of a simulation’s output. The options are highly flexible and can be customised to be different for different output formats and/or output zones.</p>
<p>For example, time-based map output may be produced using one format (e.g. XMDF), and the peak flood level surface for another output (e.g. TIF). Output over a township maybe at a higher output interval frequency than for the whole
model so as to produce a higher quality animation of flooding through the township, or if using SGS, at a higher resolution (e.g. HRTIF).</p>
<p>The main commands to control map outputs are:</p>
<ul>
<li><a href="#tcfStartMapOutput">Start Map Output</a> and <a href="#tcfMapOutputInterval">Map Output Interval</a>: to control when and how frequently to write map output (Section <a href="#TimeControl-3"><strong>??</strong></a>).</li>
<li><a href="#tcfMapOutputFormat">Map Output Format</a>: to specify the format of the outputs to be written (Section <a href="#Format-3"><strong>??</strong></a>).</li>
<li><a href="#tcfMapOutputDataTypes">Map Output Data Types</a>: to specify the data type, such as water level, stream power, etc. (Section <a href="#DataTypes-3"><strong>??</strong></a>).</li>
</ul>
<p>For example, application of the above commands may look like:</p>
<p><tcmd>Output Folder</tcmd><teq> == </teq><tblk>..\results\</tblk><tgrn> ! Location of the output files</tgrn><br />
<tcmd>Map Output Format</tcmd><teq> == </teq><tblk>XMDF TIF</tblk><tgrn> ! Produce map output in XMDF and TIF formats</tgrn><br />
<tcmd>Map Output Data Types</tcmd><teq> == </teq><tblk>h V d</tblk><tgrn> ! Output water level, velocities and
depths</tgrn><br />
<tcmd>Start Map Output</tcmd><teq> == </teq><tblk>10</tblk><tgrn> ! Start map output at 10 hours</tgrn><br />
<tcmd>Map Output Interval (s)</tcmd><teq> == </teq><tblk>300</tblk><tgrn> ! Write map output every 5 minutes (300s)</tgrn><br />
<tcmd>TIF Map Output Interval (s)</tcmd><teq> == </teq><tblk>0</tblk><tgrn> ! Output maximums only for TIF format</tgrn></p>
<h3 class="hasAnchor" id="TimeControl-3"><span class="header-section-number">11.2.1</span> Output Time Controls<a href="#TimeControl-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To control when and how frequent outputs are written, time control commands are used. They can be set as a global setting or customised for each output format. A variety of formats can be output for a single simulation, the supported formats are discussed in Section <a href="#Format-3"><strong>??</strong></a>.</p>
<p>To set default settings the followings commands can be used:</p>
<ul>
<li><a href="#tcfStartMapOutput">Start Map Output</a>: to control when to start writing outputs.<br />
</li>
<li><a href="#tcfMapOutputInterval">Map Output Interval (s)</a>: to control the frequency of the output.<br />
</li>
<li><a href="#tcfEndMapOutput">End Map Output</a>: to control when to stop writing outputs.</li>
</ul>
<p>To customise the time control commands to be different to the default or global settings, the map output format acronym is included at the start of the command. For example, “<tcmd>XMDF Map Output Interval</tcmd><teq> ==</teq><tblk> 360</tblk>” will set the output frequency to 360s just for the XMDF format. The format acronym must be identical to that used in <a href="#tcfMapOutputFormat">Map Output Format</a>. The following commands can be applied in this manner.</p>
<ul>
<li>&lt;format&gt; <a href="#tcfStartMapOutput">Start Map Output</a><br />
</li>
<li>&lt;format&gt; <a href="#tcfMapOutputInterval">Map Output Interval (s)</a><br />
</li>
<li>&lt;format&gt; <a href="#tcfEndMapOutput">End Map Output</a></li>
</ul>
<p>To apply the same setting to more than one format, the command needs to be repeated for each format. If a format is not customised the default setting or the setting applied to the whole of the model is used. The order of commands is important, ensure that commands defining the map output settings for all format types are read in prior to any commands specific to a certain format type. For example:</p>
<ul>
<li><p>The following commands set a <a href="#tcfMapOutputInterval">Map Output Interval</a> of 120 seconds for the XMDF format and 3600 seconds for the TIF format:<br />
<tcmd>Map Output Format</tcmd><teq> == </teq><tblk>XMDF TIF</tblk><br />
<tcmd>Map Output Interval</tcmd><teq> == </teq><tblk>120</tblk><br />
<tcmd>TIF Map Output Interval</tcmd><teq> == </teq><tblk>3600</tblk></p></li>
<li><p>Swapping the order of the second and third command lines will set a <a href="#tcfMapOutputInterval">Map
Output Interval</a> of 120 seconds for all output
formats as the third command overwrites the <a href="#tcfMapOutputInterval">TIF Map Output
Interval</a> command.<br />
<tcmd>Map Output Format</tcmd><teq> == </teq><tblk>XMDF TIF</tblk><br />
<tcmd>TIF Map Output Interval</tcmd><teq> == </teq><tblk>3600</tblk><br />
<tcmd>Map Output Interval</tcmd><teq> == </teq><tblk>120</tblk></p></li>
</ul>
<p>Of note is that each output is tracked every timestep for its maximum if <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a> is set to “ON” or “ON MAXIMUMS ONLY” (the default) to ensure that the peak result (water level, depth, hazard etc.), independent of the time it occurred during a simulation, is recorded.</p>
<h3 class="hasAnchor" id="Format-3"><span class="header-section-number">11.2.2</span> Map Output Formats<a href="#Format-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW offers a wide range of map output formats, all non-proprietary, to cater for a range of GIS and GUI software. There are no constraints over how many output formats a single simulation can produce. Different formats can have different output settings, and by using Output Zones different regions of the model can output in different formats.</p>
<p>Map output is offered in the following forms:</p>
<ul>
<li><a href="#MeshBased-4">Mesh Based</a>: The output is based on a quadrilateral and/or
triangular mesh of the 1D and 2D domains. This output is the closest reproduction of the hydraulic calculations, with minimal interpolation from the 1D and 2D computational points. These formats include: XMDF, DAT, TMO and WRB.<br />
</li>
<li><a href="#Grid-4">Grid Based</a>: The output is over a regular north-south grid in a similar manner to a raster DEM. The hydraulic output at each output grid cell is interpolated from the computational mesh using the Mesh Based output above. These formats include: TIF, GPKG, FLT, ASC, NC, TGO, WRR.</li>
<li><a href="#HRGrid-4">High Resolution Grid Based</a>: If using <a href="#tcfSGS">SGS</a>, the retained sampled elevations can be used to produce high-resolution (HR) grid outputs. All supported <a href="#Grid-4">Grid Based</a> outputs can be high-resolution: HRTIF, HRGPKG, HRFLT, HRASC, HRNC, HRTGO, HRWRR.</li>
<li><a href="#Combined-4">Combination Mesh and Grid</a>: This format includes: WRC.<br />
</li>
<li><a href="#GISBased-4">GIS Based</a>: GIS layers written as the simulation proceeds (similar to using the post-processing <a href="https://wiki.tuflow.com/TUFLOW_to_GIS">TUFLOW_to_GIS</a> utility). The format is set by <a href="#tcfGISFormat">GIS Format</a>.</li>
</ul>
<p>The selection of formats is controlled by the TCF command <a href="#tcfMapOutputFormat">Map Output Format</a>. One or more formats may be specified for the whole model or for an Output Zone (refer to Section <a href="#OutputZones-3"><strong>??</strong></a>). <!--The only restriction is that the SMS HIGH RES option cannot be specified in combination with any of the other formats, and is not recommended for use being a legacy format that is no longer supported.--><!--EFC: I've removed this sentence as we mentioned in the next section that sms is no longer supported--></p>
<p>If no output format has been specified, the results are written by default using the XMDF format. The following sections describe the supported map output formats.</p>
<h4 class="hasAnchor" id="MeshBased-4"><span class="header-section-number">11.2.2.1</span> Mesh Based Formats<a href="#MeshBased-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Mesh based map outputs use a mesh of quadrilaterals and/or triangles of the 2D cells and any 1D WLLs to manage and store the model results.</p>
<p>The recommended mesh format is the XMDF.</p>
<table>
<caption>
<span id="tab:tab-FormatOptionsMesh">Table 99: </span><strong>Map Output Format Options - Mesh Based Output Formats</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Format
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
XMDF
</td>
<td style="text-align:left;">
<p><strong><em>The default mesh format</em></strong>.</p>
<p>XMDF (.xmdf) was developed by Aquaveo as a faster and more space efficient replacement to the DAT format. The XMDF format complies with the HDF5 standard. The advantages of the XMDF format are:</p>
<ul>
<li>all specified Map Output Data Types are in the one file;</li>
<li>clear labelling of output types and maximum outputs;</li>
<li>an internal folder structure is available for use by GUIs; and</li>
<li>supports compression (see XMDF Output Compression).</li>
</ul>
<p>For more information on the XMDF structure for standard and specialised outputs see the <a href="https://wiki.tuflow.com/TUFLOW_XMDF_Specification">TUFLOW Wiki</a>.</p>
The XMDF format is supported by most GUIs, the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW QGIS Viewer</a> and the <a href="https://wiki.tuflow.com/TUFLOW_Utilities">TUFLOW Utilities</a>. For these reasons XMDF is the default.
</td>
</tr>
<tr>
<td style="text-align:left;">
DAT
</td>
<td style="text-align:left;">
The DAT (.dat) format is a legacy format now superseded by XMDF and no longer recommended for use. For more info on the DAT format see the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
TMO
</td>
<td style="text-align:left;">
<p>The TMO (.tmo) output format is utilised by 12D Solutions for their TUFLOW GUI interface. If using 12D to display/view results this format will need to be specified using <a href="#tcfMapOutputFormat">Map Output Format</a>. This format contains 2D domain cell centred outputs from the model.</p>
Note, the <a href="#tcfModelOutputZones">Output Zones</a> feature (Section <a href="#OutputZones-3"><strong>??</strong></a>) is currently not yet available for the TMO format.
</td>
</tr>
<tr>
<td style="text-align:left;">
WRB
</td>
<td style="text-align:left;">
<p>WaterRIDE by Worley Parsons is commercial software for visualising and post-processing hydraulic modelling results. TUFLOW supports the WRB (.wrb), WRC (.wrc) (Section <a href="#Mesh-5"><strong>??</strong></a>) and WRR (.wrr) (Section <a href="#Combined-4"><strong>??</strong></a>) WaterRIDE formats. WaterRIDE triangulation format for visualising and post-processing hydraulic modelling results. Results are only output in the cell centred triangular mesh arrangement as WaterRIDE does not support quadrilateral elements in a mesh.</p>
<p>One .wrb file is produced for each simulation that contains the model’s ground/bathymetric elevations, water levels, velocities (scalar and vector), and optionally the Z0 (VxD product) and one hazard category. The .wrb format is restricted to these data types, other data types specified using <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> are ignored for WaterRIDE output. Also, WaterRIDE can only display a single hazard category (the first one is used if more than one is specified). If Z0 and/or a hazard category are not specified for WRB output, WaterRIDE can optionally post-process these hazard values noting that the maximum of these hazard values, and the actual values, may differ from those directly output from TUFLOW due to post-processing interpolation effects. Other data types such as depth are also post-processed by WaterRIDE (and may differ from those directly output from TUFLOW).</p>
If maximums are tracked (see <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a>) these are also added to the .wrb file for the data types mentioned above. Note that if WaterRIDE is used to post-process maximums the values will be different to those provided by TUFLOW. TUFLOW tracks maximums every timestep, whilst WaterRIDE post-processes maximums using the values in the .wrb file, which only occur every <a href="#tcfMapOutputInterval">Map Output Interval</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
CC
</td>
<td style="text-align:left;">
A cell centred map output format. The output writes to NetCDF file
format and uses the 2D domain’s cell size and orientation. This feature
is only compatible with single 2D domain models and does not include any
1D output via WLLs. The CC option allows for rotated TUFLOW model grids
to be output at the 2D cell size resolution without interpolation to a
north-south aligned raster. The file format of the output is described
on the <a href="https://wiki.tuflow.com/TUFLOW_NetCDF_Cell_Centre_Output_Format">TUFLOW
Wiki</a>.
</td>
</tr>
</tbody>
</table>
<p>Additional time outputs are available using <a href="#tcfTimeOutputCutoff">Time Output Cutoff
Depths</a> or <a href="#tcfTimeOutputCutoff">Time Output Cutoff
Hazards</a> to output maps of the duration of
inundation and the time of first inundation above specified depth(s) or
VxD(s).</p>
<p>The options in the table below only apply to the XMDF format. Only one (or none) can be specified.</p>
<p>Note that the <a href="#tcfMapOutputFormat">Map Output Format</a> SMS HIGH RES option is a legacy feature no longer supported and is, therefore, not included in the table below. For details on the SMS HIGH RES feature search the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a>.</p>
<table>
<caption>
<span id="tab:tab-FormatOptionsDATXMDF">Table 100: </span><strong>Map Output Format Options - Options for XMDF Format</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Format
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
SMS
</td>
<td style="text-align:left;">
This is the default SMS option and outputs ground elevations and results at the cell corners only.
</td>
</tr>
<tr>
<td style="text-align:left;">
SMS TRIANGLES
</td>
<td style="text-align:left;">
<p>Outputs 2D cells as four triangles rather than as a quadrilateral if DAT and/or XMDF are specified. The triangles are constructed so that the 2D cell centre is a common vertex to all four triangles. This means that the mesh is entirely constructed of triangles (four triangles per 2D cell and any 1D WLL triangles).</p>
<b>Note: For the formats that rely on this triangle only mesh (e.g. ASC, FLT, NC, T3, TGO, WRB, WRR), the SMS TRIANGLES option does not need to be invoked. Only specify SMS TRIANGLES if you require your XMDF or DAT output to be based on a triangle only mesh rather than the default mesh of quadrilaterals for 2D cells and triangles for 1D WLLs. See Section <a href="#Mesh-5"><strong>??</strong></a>.</b>
</td>
</tr>
</tbody>
</table>
<h5 class="hasAnchor" id="Mesh-5"><span class="header-section-number">11.2.2.1.1</span> Mesh Configurations<a href="#Mesh-5" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong><em>Quadrilateral and Triangle Mesh Option</em></strong></p>
<p>The default mesh used by the XMDF format uses quadrilaterals
(squares) for the 2D cells and triangles for representing any 1D WLLs as
discussed in Section <a href="#OneDMap-3"><strong>??</strong></a>. Each 2D domain and the 1D WLL triangles
are treated as separate meshes, although they will appear as one when
viewing the .2dm file.</p>
<p>The advantage of this format is that the amount of data output is
optimised keeping file sizes small with little loss of accuracy in
translating results from the computational mesh.</p>
<p>Only the XMDF format supports the combination of quadrilaterals
and triangles.</p>
<p><strong><em>Triangular Mesh Option</em></strong></p>
<p>Except for the XMDF format, all the other mesh-based formats
use a triangular mesh to represent the computational 1D and 2D domains.
The triangular mesh is also used by the grid-based formats (TIF, FLT, ASC,
NC, TGO, WRR) to interpolate from the triangular mesh the values at the
grids cells’ centres (this is the cell centres of the output grid, not the 2D
domain grid cells).</p>
<p>To utilise this format using the XMDF format, specify SMS
TRIANGLES anywhere in the arguments for the <a href="#tcfMapOutputFormat">Map Output
Format</a> command.</p>
<p>The triangular mesh option incorporates output at the cell centres, so
the exact water level calculated by TUFLOW at the 2D domain cell centres
is used when translating results, thereby providing a slightly more
representative surface of the hydraulic calculations. Each 2D cell is
represented as four triangles with a common vertex at the cell centre,
giving a higher resolution spatial representation than just using the 2D cell
corners.</p>
<p>However, the number of nodes in the mesh for the 2D domains increases by
20% and the number of elements by a factor of 4, therefore, the output file sizes
will be larger and the viewing and processing times possibly slower. Any
triangular elements from 1D WLLs are not affected and remain the same in
either mesh arrangement.</p>
<p><strong><em>2D Cell Corner Interpolation/Extrapolation</em></strong></p>
<p>Irrespective of the mesh option being used, the <a href="#tcfMapOutputDataTypes">Map Output Data
Type</a> values at the 2D cell corners need to be
interpolated (or extrapolated if at the wet-dry interface). Two methods were developed that can be set using the command <a href="#tcfMapOutputCornerInterpolation">Map
Output Corner Interpolation</a> == METHOD
B or METHOD C. Method C (the default) is recommended as it is simpler
and extensive testing has indicated it resolves issues associated with prior methods. METHOD B
does largely resolve earlier issues, and has the added advantage that the effect
of thin breaklines is better handled when they are dry or flow is upstream
controlled.</p>
<p>For model results where the water has risen upwards (e.g. river
flooding), the Method B or C approaches should cause no significant
changes in results (i.e. fractions of a mm). Where the flow is downwards
over steep slopes, some changes in results at cell corners will occur,
but usually only slightly. However, maximum hazard values on very steep
slopes may experience a more significant change.</p>
<h4 class="hasAnchor" id="Grid-4"><span class="header-section-number">11.2.2.2</span> Grid Based Formats<a href="#Grid-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Grid-based formats output the results over a regular grid in similar formats to DEMs and other raster-based data. The output grid resolution and origin is not necessarily the same as the 2D hydraulic modelling grid, and will also use any 1D WLL triangulations to include map based output of 1D domains. Grid based formats are highly suited for use in GIS, and especially for handling output from very large models (e.g. GPU models).</p>
<p>The available grid formats are listed in Table <a href="#tab:tab-FormatOptionsGrid">101</a>. The output grid format is set with the <a href="#tcfMapOutputFormat">Map Output Format</a> command, for example:</p>
<p><tcmd>Map Output Format</tcmd><teq> == </teq><tblk>TIF</tblk></p>
<p>Alternatively, instead of including a specific format (e.g. TIF or FLT) in the <a href="#tcfMapOutputFormat">Map Output Format</a> list, this can also be specified using the <tcmd><a href="#tcfMapOutputFormat">Map Output Format</a></tcmd><teq> == </teq><tblk>Grid</tblk> command. In this case the grids are written by default in TIF format. This can be changed to other grid formats by specifying the specific format in the .tcf command <a href="#tcfGridFormat">Grid Format</a>. If <a href="#tcfWriteCheckFiles">Write Check Files</a> is used, the DEM_Z and DEM_M grid outputs will be of the format specified by the <a href="#tcfGridFormat">Grid Format</a> command (or TIF by default). Note that not all formats support compression, so those that don’t can produce considerably larger file sizes.</p>
<p>The output grids are placed in a sub-folder called “grids”. For TUFLOW Classic the default output grid resolution is half the smallest 2D cell size (considering that multiple 2D domains may exist). For TUFLOW HPC the default is half the 2D cell size. For HPC models using Quadtree, the output resolution is the smallest 2D cell size. The resolution of the output grid can be controlled by the <a href="#tcfGridOutputCellSize">Grid Output Cell Size</a> command. Only one output grid resolution is possible. If multiple commands exist, the last occurrence of the command will prevail. The origin of the output grid is rounded to the nearest cell size. This can be set to the exact model origin using the <tcmd><a href="#tcfGridOutputOrigin">Grid Output Origin</a> </tcmd><teq>==</teq><tblk> Model Origin</tblk>.</p>
<p>The TUFLOW grid output formats (listed in Table <a href="#tab:tab-FormatOptionsGrid">101</a>) support all available <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> (listed in Table <a href="#tab:tab-ExcludingHazard">102</a> and Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>). The minor exceptions are noted in Table <a href="#tab:tab-FormatOptionsGrid">101</a>.</p>
<p>Grids outputs store data on a grid by grid basis and in a north-south direction, therefore interpolation must occur to convert the data from the TUFLOW calculation points. The raster data is interpolated from the values at the cell corners and centres.</p>
<p>For example, the image below shows:</p>
<ul>
<li>A <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> file (black lines)</li>
<li>A <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt_check</a> showing the TUFLOW calculation (ZC, ZU, ZV and ZH) points;</li>
<li>An output water level TIF grid (underlying grey grid); and</li>
<li>Orange dotted lines showing the triangulation between the cell corners and centres.</li>
</ul>
<p>The raster data (grid centre indicated by red cross) obtains its value from the triangulation between A, B, and E.</p>
<center>
<img src="images/output-interpolation.png"/>
</center>
<p>To more closely align the grid output with the TUFLOW calculation points:</p>
<ul>
<li>Set the domain to have an <a href="#tgcOrientationAngle">Orientation Angle</a> of zero, and</li>
<li>Use the <tcmd><a href="#tcfGridOutputOrigin">Grid Output Origin</a> </tcmd><teq>==</teq><tblk> Model Origin</tblk> command.</li>
</ul>
<p>The &lt;format&gt; <a href="#tcfMapOutputInterval">Map Output Interval</a> can be set to zero as follows to trigger only outputting the maximums for those formats. For example:</p>
<p><tcmd>TIF Map Output Interval </tcmd><teq>==</teq><tblk> 0 </tblk><tgrn>! Only output result maximums for TIF grids</tgrn><br />
<tcmd>FLT Map Output Interval </tcmd><teq>==</teq><tblk> 0 </tblk><tgrn>! Only output result maximums for FLT grids</tgrn></p>
<p>All time outputs are supported by the grid map output formats. The grid file extensions are:</p>
<ul>
<li>_TDur_&lt;cutoff&gt; for duration of inundation;<br />
</li>
<li>_TExc_&lt;cutoff&gt; for time &lt;cutoff&gt; is exceeded;<br />
</li>
<li>_TMax_h for time of peak water level; and<br />
</li>
<li>_TMax_V for time of peak velocity.</li>
</ul>
<table>
<caption>
<span id="tab:tab-FormatOptionsGrid">Table 101: </span><strong>Map Output Format Options - Grid Based Output Formats</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Format
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TIF
</td>
<td style="text-align:left;">
<p>The GeoTIFF raster compressible format is supported from the 2023-03 Release and onwards and is the default format. A projection can be set for the output GeoTIFF rasters by using the <a href="#tcfTIFProjection">TIF Projection</a> command. Individual files are created for each output type, time, maximums, etc.</p>
TUFLOW supports several compression methods for GeoTIFF, see <a href="#tcfTIFCompression">TIF Compression</a>, the default is the “deflate” method. A compression predictor “horizontal differencing” is used to improve the compression ratio, see <a href="#tcfTIFCompressionPredictor">TIF Compression Predictor</a>. TUFLOW will default to using all available CPU cores when writing GeoTIFF files which can speed up processing when using compression. This can be changed by specifying the number of threads using the command line argument “-nt[thread count]”.
</td>
</tr>
<tr>
<td style="text-align:left;">
FLT
</td>
<td style="text-align:left;">
<p>ESRI binary (float) version of the ASC format. The data is uncompressed. The file header containing the dimensions of the grid is output to a .hdr (text) file and contains the same header as for an .asc file. The remainder of the output, the 3D surface values, is written to a .flt file as a binary dump rather than as a text file.</p>
Advantages of this format are that it is very simple and is much faster to write and open than the ASC format. Main limitations are that file sizes are large, and a separate file needs to be written for every Map Output Data Type specified and for every output time (that can be a lot of files!).
</td>
</tr>
<tr>
<td style="text-align:left;">
GPKG
</td>
<td style="text-align:left;">
<p>The GeoPackage grid format is supported from the 2023-03 Release onwards. The format uses a tiled structure to make rendering and loading faster by enabling the ability to only process the required tiles. The tiled structure also makes pyramids (sometimes referred to as ‘overviews’) inherently available for the format. Individual files are created for each output type, time, maximums, etc.</p>
<p>The GPKG raster outputs will be grouped if the <a href="#tcfSpatialDatabase">Spatial Database</a> command is set to “grouped” (the default).</p>
The GPKG raster format supports LZW compression of the data, see <a href="#tcfGPKGCompression">GPKG Compression</a>. A compression predictor “horizontal differencing” is used to improve the compression ratio, see <a href="#tcfGPKGCompressionPredictor">GPKG Compression Predictor</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
ASC
</td>
<td style="text-align:left;">
<p>ESRI ASCII (.asc) uncompressed grid format, a long-established industry standard format often used for transferring 3D surfaces between GIS software.</p>
Advantages of this format are that it is very simple and can be viewed in a text editor. Limitations are that for large grids the file maybe slow to write, slow to open and work with, file sizes can be very large, and a separate file needs to be written for every Map Output Data Type specified and for every output time (that can be a lot of files!).
</td>
</tr>
<tr>
<td style="text-align:left;">
GRID
</td>
<td style="text-align:left;">
Outputs grid files in the default grid output (.tif) unless <a href="#tcfGridFormat">Grid Format</a> is specified in the .tcf.
</td>
</tr>
<tr>
<td style="text-align:left;">
NC
</td>
<td style="text-align:left;">
<p>The <a href="https://en.wikipedia.org/wiki/NetCDF">NETCDF</a> (Network Common Data Format) is a commonly used compressible format for storing modelling and scientific data. A single file is created that contains all output types, output times and static outputs (e.g. maximums).</p>
<p>A number of NetCDF specific commands are supported as listed below. The TUFLOW Wiki page <a href="http://wiki.tuflow.com/index.php?title=TUFLOW_NetCDF_Raster_Output_Format">TUFLOW NetCDF Raster Format</a> provides additional information.</p>
<ul>
<li><a href="#tcfNetCDFOutputCompression">NetCDF Output Compression</a><br />
</li>
<li><a href="#tcfNetCDFOutputStartDate">NetCDF Output Start Date</a><br />
</li>
<li><a href="#tcfNetCDFOutputTimeUnit">NetCDF Output Time Unit</a><br />
</li>
<li><a href="#tcfNetCDFOutputDirection">NetCDF Output Direction</a><br />
</li>
<li><a href="#tcfNetCDFOutputFormat">NetCDF Output Format</a></li>
</ul>
If using FEWS to view NC output, please ensure that <a href="#tcfNetCDFOutputFormat">NetCDF Output Format == FEWS</a> has been set.
</td>
</tr>
<tr>
<td style="text-align:left;">
TGO
</td>
<td style="text-align:left;">
The TGO format is utilised by 12D Solutions for their TUFLOW interface. The output is a north-south aligned raster and includes outputs from multiple domains and water level lines. Unlike the mesh .tmo format, all <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> are supported, and the resolution of the output grids can be set using the command <a href="#tcfGridOutputCellSize">Grid Output Cell Size</a>. Individual files are created for each output type.
As of the 2020-10 release the TGO velocity angle is in radians, previously this was degrees.
</td>
</tr>
<tr>
<td style="text-align:left;">
WRR
</td>
<td style="text-align:left;">
A WaterRIDE uncompressed format that contains the time varying grid output using a north-south aligned raster and includes outputs from multiple domains and 1D WLLs. All <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> are supported, and the resolution of the output grids can be set using the command <a href="#tcfGridOutputCellSize">Grid Output Cell Size</a>. A single file is created for all output types, times, etc. Due to no compression, file sizes can be very large.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="HRGrid-4"><span class="header-section-number">11.2.2.3</span> High-Resolution Grids<a href="#HRGrid-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When using the Method C sub-grid sampling (SGS) approach the sampled elevations are retained including topography
modifiers such as breaklines. At the end of the geometry processing this allows a high-resolution grid to be written and used for high resolution map outputs and also DEM check grids (DEM_Z_HR). All grid formats in Table <a href="#tab:tab-FormatOptionsGrid">101</a> are supported. Currently, high resolution raster outputs are only available for depth (d) and water level (h) output data types.</p>
<p>To produce high-resolution output, add “HR” to the grid format. For example “HRTIF” or “HRFLT” to produce a high resolution TIF or FLT respectively. Note, the <a href="#tcfMapOutputInterval">Map Output Interval</a> will also have to be set, for example, “<tcmd>HRTIF Map Output Interval</tcmd><teq> ==</teq><tblk> 0</tblk>” will output just the maximums using the HRTIF format.</p>
<p>The high resolution grid output uses the following approach:</p>
<ul>
<li>The water level at each HR raster output cell is interpolated from the computed 2D water levels.</li>
<li>The depth is the difference between the interpolated water level and the terrain elevation interpolated from the surrounding SGS sampled elevations.</li>
</ul>
<p>The regular grid output interpolates depth from cell centres/corners with a default output resolution of half the cell size. The difference between the regular and the HR grid output is illustrated in Figure <a href="#fig:fig-HR-Output">102</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HR-Output"></span>
<img src="images/HRExample.png" alt="**Regular Grid Depth Output (Left) and HR Grid Depth Output (Right)**" width="80%" />
<p class="caption">
Figure 102: <strong>Regular Grid Depth Output (Left) and HR Grid Depth Output (Right)</strong>
</p>
</div>
</center>
<p>When modelling breaklines in TUFLOW, “thin” breaklines modify the cell face elevations but do not modify the cell storages. When outputting the high-resolution outputs, the user can set whether the cell face elevations are included using the .tcf command (the default is ON, to use face elevations):</p>
<p><tcmd><a href="#tcfHRGridOutputUseFaceElevations">HR Grid Output Use Face Elevations</a></tcmd><teq> == </teq><tblk>{ON} | OFF</tblk></p>
<p>The water level and depth interpolation approaches for the high resolution outputs can be altered depending on the type of model (e.g. hydrology inflows or direct rainfall) and specifically how TUFLOW outputs the high resolution results around thin breaklines. These output options are discussed on the <a href="https://wiki.tuflow.com/TUFLOW_HR_Output">HR Output TUFLOW Wiki page</a>.</p>
<p>HR grid outputs are also compatible with the output zone functionality, see Section <a href="#OutputZones-3"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="Combined-4"><span class="header-section-number">11.2.2.4</span> Combined Format<a href="#Combined-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Combination of a mesh and grid-based approach. The only available combined format is the WRC format. The WRC format produces a master (.wrc) file and one or more WRR and WRB files. The approach adopted by TUFLOW is as follows:</p>
<ul>
<li>Each 2D domain is output as a rotated WRR format grid with the cell
size equal to the TUFLOW cell size. The WRR format is significantly faster than than the WRB format due
to its grid-based formatting. The output values are the cell centre values for each 2D cell.</li>
<li>Any 1D WLL triangulations are output as a separate WRB file.</li>
<li>The WRC “master” file is output to the specified results folder, while the WRR and WRB files are written to a “waterRIDE” sub folder.</li>
</ul>
<h4 class="hasAnchor" id="GISBased-4"><span class="header-section-number">11.2.2.5</span> GIS Based Format<a href="#GISBased-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>GIS based map outputs use the format specified by <a href="#tcfGISFormat">GIS Format</a> to write out map output as a series of GIS layers. Gridded output format as GIS layers can be written directly from TUFLOW during the simulation by including “GIS” in the <a href="#tcfMapOutputFormat">Map Output Format</a> command. This offers a similar functionality to that using the <a href="https://wiki.tuflow.com/TUFLOW_to_GIS">TUFLOW_to_GIS</a> utility via, for example, the –shp option. For scalar outputs, these are output as a point GIS layer with a separate file for each output time. For vector outputs, this can be either as a point or region GIS layer. Specific commands to this output format are:</p>
<ul>
<li><a href="#tcfGISGridVectorType">GIS Grid Vector Type</a></li>
<li><a href="#tcfGISGridVectorDirection">GIS Grid Vector Direction</a></li>
<li><a href="#tcfGISGridVectorSF">GIS Grid Vector SF</a></li>
<li><a href="#tcfGISGridVectorTTF">GIS Grid Vector TTF</a></li>
</ul>
<p>The commands above can be applied to all vector outputs or can be specific to the data type by prefixing with a “v”, “q” or “W”, for velocity, unit flow or wind respectively. The example below sets the scale factor to 1 for all outputs except unit flow, which has a smaller factor of 0.1.</p>
<p><tcmd>GIS Grid Vector SF </tcmd><teq>== </teq><tblk>1.0 </tblk><tgrn>! Set scale factor for all GIS vector output to 1.0 </tgrn><br />
<tcmd>q GIS Grid Vector SF </tcmd><teq>== </teq><tblk>0.1 </tblk><tgrn>! Set scale factor for unit flow GIS output to 0.1</tgrn></p>
<h3 class="hasAnchor" id="DataTypes-3"><span class="header-section-number">11.2.3</span> Map Output Data Types<a href="#DataTypes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW can output a wide range of output types in map format. Table <a href="#tab:tab-ExcludingHazard">102</a> describes all the non-hazard map output types, while Table <a href="#tab:tab-MapOutputHazardZTypes">103</a> contains all flood hazard category (Z) map output types. The map output types produced by a simulation are controlled using the .tcf command <a href="#tcfMapOutputDataTypes">Map Output Data Types</a>.</p>
<p>The map output types’ flags are listed in the first column of the tables and are used to denote the type(s) to be output. They can occur in any combination or order and are not case-sensitive. For example, to output water level, velocity and unit flow, enter the following line in the .tcf file:</p>
<p><tcmd>Map Output Data Types </tcmd><teq>==</teq><tblk> h V q</tblk></p>
<p>Although optional, it is strongly recommended that spaces are used between each data type for clarity.</p>
<p>The output types are available in a wide range of <a href="#tcfMapOutputFormat">Map Output Formats</a> and can be varied for different formats (Section <a href="#Format-3"><strong>??</strong></a>) and between output zones (Section <a href="#OutputZones-3"><strong>??</strong></a>). Not all <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> are available for all <a href="#tcfMapOutputFormat">Map Output Formats</a> due to limitations or constraints of the type/format. The supported formats for each type are documented in Table <a href="#tab:tab-ExcludingHazard">102</a> and Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>.</p>
<p>It is possible to get different output types for different output formats, as discussed in Section <a href="#Format-3"><strong>??</strong></a>. For example:</p>
<p><tcmd>TIF Map Output Data Types</tcmd><teq> == </teq><tblk>h V Z0</tblk><br />
<tcmd>XMDF Map Output Data Types </tcmd><teq>==</teq><tblk> h V q d ci z0</tblk></p>
<table>
<caption>
<span id="tab:tab-ExcludingHazard">Table 102: </span><strong>Map Output Types (Excluding Hazard (Z) Types)</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flag
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Map Output<br />
Data Type
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Supported Formats
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AP
</td>
<td style="text-align:left;">
Atmospheric Pressure
</td>
<td style="text-align:left;">
Atmospheric pressure in hPa. Atmospheric Pressure is only available if using the <a href="#tcfReadGISCyclone">Read GIS Cyclone</a> or <a href="#tcfReadGISCyclone">Read GIS Hurricane</a> commands. Maximum and minimum output is not available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
BSS
</td>
<td style="text-align:left;">
Bed Shear Stress
</td>
<td style="text-align:left;">
<p>Bed Shear Stress in N/m<sup>2</sup> (or lbf/ft<sup>2</sup> in English Units) is given by the equation below where ρ is density, g gravity, V velocity, n Manning’s n, and y depth:</p>
<p>Metric Units: <span class="math display">\[\tau_{bed} = \frac{\rho g V^2 n^2}{y^{\frac{1}{3}}} \hspace{3em} (N/m^2)\]</span><br />
English Units: <span class="math display">\[\tau_{bed} = \frac{\rho g V^2 n^2}{2.208 y^{\frac{1}{3}}} \hspace{3em} (lbf/ft^2)\]</span></p>
<p>The Bed Shear Stress map output can be misleading at very shallow depths as the BSS formula divides by the depth. The BSS and SP outputs are linearly reduced to zero once the depth is below a threshold (by default, 0.1m). This threshold can be changed using the .tcf command <a href="#tcfBSSCutoffDepth">BSS Cutoff Depth</a>.</p>
Note, prior to the 2017 release BSS output in English Units were in Poundals per square foot (pdl/ft<sup>2</sup>).
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
CI
</td>
<td style="text-align:left;">
Cumulative Infiltration
</td>
<td style="text-align:left;">
<p>The cumulative infiltration over the entire simulation in mm or inches when a soil infiltration method has been used (see Section <a href="#Infiltration-2"><strong>??</strong></a>). Also see the IR (infiltration rate) map output type below. Maximum and minimum output is not applicable/available as it is a cumulative output.</p>
<p>Note, the CI output is restricted to models for which the value is cumulative, specificially this means models that have:</p>
<ul>
<li>A single vertical soil layer.<br />
</li>
<li>No horizontal movement of ground water.<br />
</li>
<li>No drying of the soil layer through negative rainfall.</li>
</ul>
When any of the three options (multiple vertical layers, horizontal movement or negative rainfall) are used, the water content in the layer is no longer a “cumulative value”.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cr
</td>
<td style="text-align:left;">
Courant Number
</td>
<td style="text-align:left;">
<p>Classic Only.</p>
Courant number (2D domains only). Maximum and minimum output is not available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
CWF
</td>
<td style="text-align:left;">
Cell Width Factor
</td>
<td style="text-align:left;">
No longer supported - previously available via the legacy SMS HIGH RES option.
</td>
<td style="text-align:left;">
N/A
</td>
</tr>
<tr>
<td style="text-align:left;">
d
</td>
<td style="text-align:left;">
Depth
</td>
<td style="text-align:left;">
<p>Water depths in m or ft. For the cell cornered results formats (see Section <a href="#Mesh-5"><strong>??</strong></a>) the depths are calculated as the interpolated water level at the nodes (see _h below) less the ZH value. The interpolated water level may occasionally lie below the ZH value, in which case a negative depth may result, which is set to zero by default (see <a href="#tcfZeroNegativeDepths">Zero Negative Depths</a>). Both maximum and minimum output are available.</p>
For maximum depth output this is calculated at the end of the simulation based on the maximum water level and the ground elevation. For models that utilise varying ground elevations (using the <a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a> or variable geometry (VG) boundaries), care should be taken when interpreting maximum depth outputs. Hazard outputs (based on velocity and depth) are tracked at each timestep, and the maximum for these is the maximum at any timestep during the model.
</td>
<td style="text-align:left;">
All formats excluding WRB.
</td>
</tr>
<tr>
<td style="text-align:left;">
dGW
</td>
<td style="text-align:left;">
Depth to Groundwater
</td>
<td style="text-align:left;">
<p>Depth to groundwater (from the ground surface) over time in metres or feet when a groundwater depth or level has been defined (see Section <a href="#Infiltration-2"><strong>??</strong></a>).</p>
<p>If using multiple sub-surface layers in TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a> it is the distance from the ground surface to the groundwater level of the layer in question.</p>
Maximum and minimum output is not available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
dt
</td>
<td style="text-align:left;">
Minimum Timestep
</td>
<td style="text-align:left;">
<p>HPC Only.</p>
The dt map output is a grid map output that displays the calculated minimum timestep at each grid cell. It does not necessarily align with the timestep adopted in the model (the timestep in the model could be less if the previous timesteps were smaller). This helps identify which cells in the model are controlling the model timestep. For more information see the <a href="https://wiki.tuflow.com/HPC_Model_Review#dt_Map_Output">TUFLOW Wiki</a>.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
E
</td>
<td style="text-align:left;">
Energy
</td>
<td style="text-align:left;">
<p>Scalar data file containing the energy levels at the element nodes (cell corners). The energy levels are based on the interpolation of water levels and dynamic head (V<sup>2</sup>/2g) at the output location. As both the 1D and both 2D solutions use a staggered computational scheme, the interpolation of the water levels and/or velocities to the output location may occasionally cause an “increase” in energy to be apparent in the output, therefore, energy output should be treated with caution.</p>
<p>For 1D areas, this output should be treated with additional caution as it is derived from interpolation of water levels and approximations of the channel velocities across the WLLs, which can be problematic in 1D channels with high velocities. The energy output for 1D nodes is available as part of the plotting output (Section <a href="#view-tpc-3"><strong>??</strong></a>).</p>
Maximum energy levels is for when the maximum water level occurs (<b>Note: This may cause undulations in the maximum energy due to variations in the time of the maximum water level</b>).
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
Froude Number
</td>
<td style="text-align:left;">
Froude number output. No maximum and minimum output is available at this stage.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
FLC
</td>
<td style="text-align:left;">
Form Loss Coefficient
</td>
<td style="text-align:left;">
No longer supported - previously available via the legacy SMS HIGH RES option.
</td>
<td style="text-align:left;">
N/A
</td>
</tr>
<tr>
<td style="text-align:left;">
GWd
</td>
<td style="text-align:left;">
Groundwater Depth
</td>
<td style="text-align:left;">
<p>Depth of water within each sub-surface layer(s) when layered interflow has been defined (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). Determined by dividing the cumulative infiltration by porosity.</p>
Reported in metres or feet.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
GWh
</td>
<td style="text-align:left;">
Groundwater Level
</td>
<td style="text-align:left;">
<p>Elevation of the groundwater surface (water table) for each sub-surface layer(s) when layered interflow has been defined (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>).</p>
Reported in metres or feet.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
GWm
</td>
<td style="text-align:left;">
Groundwater Moisture
</td>
<td style="text-align:left;">
Groundwater moisture output. Dimensionless number in the range of zero to one representing a “fraction full” for each sub-surface layer(s) when layered interflow has been defined (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>).
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
GWq
</td>
<td style="text-align:left;">
Groundwater Unit Flow
</td>
<td style="text-align:left;">
<p>Groundwater unit flow (m<sup>2</sup>/s, flow per unit width) at the nodes (cell corners) of the sub-surface layer(s) when layered interflow has been defined (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>).</p>
Reported in m<sup>2</sup>/hr or ft<sup>2</sup>/hr.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
GWv
</td>
<td style="text-align:left;">
Groundwater Velocity
</td>
<td style="text-align:left;">
<p>Groundwater flow velocity when layered interflow has been defined (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The resulting groundwater velocity vector is calculated from the surrounding u and v-points.</p>
Reported in m/hr or ft/hr.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
h
</td>
<td style="text-align:left;">
Water Level
</td>
<td style="text-align:left;">
Water level output. For the cell cornered results formats (see Section <a href="#Mesh-5"><strong>??</strong></a>) the water levels are interpolated from the water levels calculated at the cell centres. Both maximum and minimum outputs are available.
</td>
<td style="text-align:left;">
All formats.
</td>
</tr>
<tr>
<td style="text-align:left;">
IR
</td>
<td style="text-align:left;">
Infiltration Rate
</td>
<td style="text-align:left;">
<p>The infiltration rate in mm/hr or inches/hr over time when a soil infiltration method has been used (see Section <a href="#Infiltration-2"><strong>??</strong></a>). See also the CI (cumulative infiltration) map output type above. Maximum and minimum output is not available.</p>
If using multiple sub-surface layers (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>) the infiltration rate is reported for the first (top) layer only.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
MB1
</td>
<td style="text-align:left;">
Mass Balance
</td>
<td style="text-align:left;">
<p>TUFLOW Classic only (for HPC, see the ‘dt’ output).</p>
<p>Measure of the convergence level of the solution. The measure is a cumulative value since the last output time, therefore is an effective way of identifying problem areas in a model that repeatedly have poor convergence and most likely mass error. Very useful for identifying problem areas within a model.</p>
This output does not include 1D output from WLLs.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
MB2
</td>
<td style="text-align:left;">
Mass Balance
</td>
<td style="text-align:left;">
<p>TUFLOW Classic only (for HPC, see the ‘dt’ output).</p>
<p>Same as MB1 above but is accumulated over the entire simulation.</p>
This output does not include 1D output from WLLs.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
n
</td>
<td style="text-align:left;">
Manning’s n
</td>
<td style="text-align:left;">
Manning’s n values. The n values only vary over time for materials using the Manning’s n varying with depth feature. The n values at the cell corners in the _n.xmdf file are interpolated from the surrounding four cell mid-sides. Maximum and minimum output is not available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
Nc
</td>
<td style="text-align:left;">
Shallow Wave Celerity Number
</td>
<td style="text-align:left;">
<p>HPC Only.</p>
The Shallow Wave Celerity Number. One of the three controls TUFLOW HPC uses to determine the maximum timestep to maintain stability. See the <a href="https://wiki.tuflow.com/HPC_Adaptive_Timestepping">HPC Adaptive Timestepping Wiki Page</a> for discussion on adaptive timestepping and the Nc number.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
Nd
</td>
<td style="text-align:left;">
Diffusion Number
</td>
<td style="text-align:left;">
<p>HPC Only.</p>
The Diffusion Number. One of the three controls TUFLOW HPC uses to determine the maximum timestep to maintain stability. See the <a href="https://wiki.tuflow.com/HPC_Adaptive_Timestepping">HPC Adaptive Timestepping Wiki Page</a> for discussion on adaptive timestepping and the Nd number.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
Nu
</td>
<td style="text-align:left;">
Courant Number
</td>
<td style="text-align:left;">
<p>HPC Only.</p>
The Courant Number. One of the three controls TUFLOW HPC uses to determine the maximum timestep to maintain stability. See the <a href="https://wiki.tuflow.com/HPC_Adaptive_Timestepping">HPC Adaptive Timestepping Wiki Page</a> for discussion on adaptive timestepping and the Nu number.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
q
</td>
<td style="text-align:left;">
Vector Unit Flow
</td>
<td style="text-align:left;">
<p>Unit flow (m<sup>2</sup>/s, flow per unit width) at the nodes (cell corners). The resulting flow vector is calculated from the surrounding u and v-point velocities and the depth.</p>
<p>Unit flow may also be used as a measure of flood hazard (i.e. velocity by depth or VxD).</p>
Note: The maximum unit flow is not tracked for the q output, the Z0 scalar hazard value option can be used, as this output is tracked at each timestep.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
R
</td>
<td style="text-align:left;">
Flow Regime
</td>
<td style="text-align:left;">
<p>TUFLOW Classic only.</p>
Flow regime. The output value is 0 (zero) for normal (sub-critical flow with momentum); greater than 1 for upstream controlled friction flow (e.g. supercritical flow); ‑1.5 for broad-crested weir flow; and ‑1 for flow through a flow constriction when the deck is submerged. No maximum and minimum output is available at this stage. The flow regime at the cell corners and centre is a weighted average (using unit flow) of the flow regimes at the four surrounding cell mid-sides, therefore, where there’s different flow regimes at any of the four cell faces the R value can be misleading due to the averaging.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
RC
</td>
<td style="text-align:left;">
Route Category
</td>
<td style="text-align:left;">
<p>The route category output over time for evacuation routes. The definition and number of categories is based on the values specified within the Cut_Off_Values attribute of the 2d_zshr GIS layer (see Section <a href="#EvaculationRoutes-3"><strong>??</strong></a>). The RC values are output as an integer representing the closure category specified by the user.</p>
The maximum RC category value is tracked every timestep and output (if tracking maximums is switched on, which is the default).
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
RFC
</td>
<td style="text-align:left;">
Cumulative Rainfall
</td>
<td style="text-align:left;">
<p>The cumulative rainfall in mm or inches over time when direct rainfall has been applied to the model (refer to Section <a href="#Rainfall-3"><strong>??</strong></a>). See also the RFR (rainfall rate) map output type below. Both the RFC and RFR outputs (see next item) are inclusive of any boundary adjustments (e.g. in the boundary database) and rainfall losses applied in the materials file. Soil infiltration is applied once the rainfall has been applied to the cells, so this is not accounted for in the rainfall outputs, see also CI (cumulative infiltration) and IR (infiltration rate) output types.</p>
Maximum and minimum output is not applicable/available, as it is a cumulative output.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
RFML
</td>
<td style="text-align:left;">
Material Based Rainfall Loss
</td>
<td style="text-align:left;">
The output contains the total rainfall losses applied due the initial and continuing rainfall losses specified in the <a href="#tcfReadMaterialsFile">Read Materials File</a> (.tmf or .csv) file. The RFML option can be used to track the rainfall based material losses that have been applied spatially. The RFC and RFR map output data types can be used to output the cumulative rainfall and rainfall rate.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
RFR
</td>
<td style="text-align:left;">
Rainfall Rate
</td>
<td style="text-align:left;">
The rainfall rate in mm/hr or inches/hr over time when direct rainfall has been applied to the model (refer to Section <a href="#Rainfall-3"><strong>??</strong></a>). See also the RFC (cumulative rainfall) map output type above. Maximum and minimum output is not available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
SP
</td>
<td style="text-align:left;">
Stream Power
</td>
<td style="text-align:left;">
<p>Stream Power as given by the equation below where τbed is bed shear stress (see BSS above) and V is velocity.</p>
<p><span class="math display">\[Stream Power = |V|\tau_{bed} \hspace{3em} (W/m^2)\]</span></p>
<p>The Stream Power map output can be misleading at very shallow depths as the BSS formula divides by the depth. The BSS and SP outputs are linearly reduced to zero once the depth is below a threshold (by default, 0.1m). This threshold can be changed using the .tcf command BSS Cutoff Depth.</p>
Prior to the 2017 release SP output in English Units were in Poundals per square foot (pdl/ft<sup>2</sup>). From the 2017 release onwards the units are in Pounds Force per square foot (lbf/ft<sup>2</sup>), therefore, the SP values are 32.174 times smaller than for releases prior to 2017.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
SS
</td>
<td style="text-align:left;">
Sink / Source Flow
</td>
<td style="text-align:left;">
<p>The net source/sink inflows. Note the flow rate for a cell is shown at the ZH point (top right of the cell).</p>
Maximum and minimum output is not available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
t
</td>
<td style="text-align:left;">
Viscosity Coeff
</td>
<td style="text-align:left;">
Eddy viscosity coefficient. This is useful for checking the Smagorinsky coefficient values. No maximum and minimum output is available at this stage.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
tau
</td>
<td style="text-align:left;">
Shear stress
</td>
<td style="text-align:left;">
<p>This output contains the shear stress values applied via the external stress file (.tesf).</p>
The output values are in Newtons per square metre (N/m<sup>2</sup>) for SI units and pound-force per square foot (lbf/ft<sup>2</sup>) for US customary (English) units.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
V
</td>
<td style="text-align:left;">
Vector Velocity
</td>
<td style="text-align:left;">
<p>Flow velocity. The resulting velocity vector is calculated from the surrounding u and v-points.</p>
Note: The maximum and minimum velocities are tracked over time, however, be careful interpreting maximum velocities displayed as vectors as the flow patterns may appear to be opposing each other - this is due to the maximum velocities not all occuring at the same instant in time. By default the maximum velocities are tracked over 0.1m depth, below this depth the velocity at maximum water level is used. See the <a href="#tcfMaximumVelocityCutoffDepth">Maximum Velocity Cutoff Depth</a> command for more information.
</td>
<td style="text-align:left;">
All formats excluding HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
WI10
</td>
<td style="text-align:left;">
Wind Vector
</td>
<td style="text-align:left;">
Wind Vector output in m/s at a height of 10m. Available when a cyclone/hurricane boundary is used, see Section <a href="#Cyclones-2"><strong>??</strong></a>.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZH
</td>
<td style="text-align:left;">
Bathymetry
</td>
<td style="text-align:left;">
<p>Elevations at the cell corners (ZH points). This information is already contained in the .2dm file, however, this option is useful if the model’s bathymetry varies over time because of variable geometry (2d_vzsh or VG boundaries) or for morphological modelling. This output is very useful if you are comparing two or more runs that have different topography (e.g. before and after scenarios), and you wish to easily view or compare the topography for each scenario.</p>
<p>If the topography in the model does not change over time (i.e. no variable Z shapes or morphological changes), for the default .xmdf output format the ZH Zpt values are output once, rather than every timestep, thereby not consuming disk space unnecessarily. The ZH map output will appear under a XMDF folder “Fixed”. This feature is only available if using the XMDF format, for other output formats, the bathymetry will be output at each output interval.</p>
Currently, no maximum and minimum output is available.
</td>
<td style="text-align:left;">
All formats excluding TMO, WRB and HR.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="Hazards-4"><span class="header-section-number">11.2.3.1</span> Hazard Data Types<a href="#Hazards-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Table <a href="#tab:tab-MapOutputHazardZTypes">103</a> presents the hazard category outputs. Of note is that each hazard is tracked every timestep for its maximum if <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a> is set to “ON” or “ON MAXIMUMS ONLY” (the default) to ensure that the peak hazard category is recorded during the simulation. Up to ten (10) different hazard categories per simulation can be specified for map output. Grid map output hazard categories are output as integer grids (i.e. values are rounded to the nearest integer when a grid output cell centre is located at a change in category) when using <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> except for output Z0, ZUK0 and ZUK2, which are output as real numbers.</p>
<p>Users have the option to customise hazard outputs based on a .csv file input using the “ZUD1” hazard type. This feature allows users to define a number of depth, velocity and depth-velocity product thresholds to create custom hazard categories. Like other hazards these are assessed at each computational timestep and the maximum is tracked every timestep. To specify a user defined hazard, add output type “ZUD1” in
the “<a href="#tcfMapOutputDataTypes">Map Output Data Types</a>” command, e.g.:</p>
<p><tcmd><a href="#tcfMapOutputDataTypes">Map Output Data Types</a></tcmd><teq> == </teq><tblk>h d V <strong>ZUD1</strong></tblk></p>
<p>The thresholds are defined through reading a .csv file using the following command:</p>
<p><tcmd><a href="#tcfReadHazardFile">Read Hazard File</a> </tcmd><teq>== </teq><tblk>&lt;file_name&gt;.csv</tblk></p>
<p>The csv file should contain three (3) columns defining the thresholds for depth, velocity, and depth-velocity product respectively. The example below produces the same output as for “ZNZ1” described in Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-ZUD1"></span>
<img src="images/image169.png" alt="**Example Hazard File for User Defined Hazard**" width="20%" />
<p class="caption">
Figure 103: <strong>Example Hazard File for User Defined Hazard</strong>
</p>
</div>
</center>
<ul>
<li>Category 1: D &lt; 0.1. Note: the velocity, and depth-velocity product
thresholds are effectively not applied by using a large threshold
value such as 99999.<br />
</li>
<li>Category 2: D &lt; 0.5 and V &lt; 1.0. Note: the depth-velocity product
threshold is effectively not applied by using the large threshold value
of 99999.<br />
</li>
<li>Category 3: D &lt; 1.0 and V &lt; 2.0 and D*V &lt; 1.0<br />
</li>
<li>Category 4: Otherwise<br />
</li>
<li>Dry points are assigned Category 0.</li>
</ul>
<p>A maximum of 10 categories can be specified by the .csv file, but just
one User Defined Hazard is currently allowed per simulation. This functionality is
compatible with both TUFLOW Classic and HPC solvers.</p>
<p>Please email <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> if you would like to code a unique hazard output that is currently not included as an output type option or possible using the user defined hazard type (ZUD1).</p>
<table>
<caption>
<span id="tab:tab-MapOutputHazardZTypes">Table 103: </span><strong>Map Output Hazard (Z) Types</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flag
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Supported Formats
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Z0
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
Velocity x Depth product
</td>
</tr>
<tr>
<td style="text-align:left;">
Z1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Flood hazard category based on the Australian NSW Floodplain Management Manual <span class="citation">(<a href="#ref-NSWManual2005">NSW Goverment, 2005b</a>)</span>. The output is an integer number from 1 to 3 as follows and as illustrated in the figure below.</p>
<ul>
<li>1: Low Hazard<br />
</li>
<li>2: Intermediate Hazard (dependent on site conditions)<br />
</li>
<li>3: High Hazard</li>
</ul>
<img src="images/image151.PNG" width="480" height="360">
</td>
</tr>
<tr>
<td style="text-align:left;">
Z2
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>V &gt; 2.0: Category 5 (Extreme Hazard)<br />
D*V &gt; 1.0: Category 4 (High Hazard Floodway)<br />
D &gt; 1.0: Category 3 (High Hazard Depth)<br />
V + 3.3*D &gt; 2.64: Category 2 (High Hazard)<br />
Otherwise Category 1 (Low Hazard)<br />
Dry points are assigned Category 0</p>
<img src="images/image152.PNG" width="480" height="360">
</td>
</tr>
<tr>
<td style="text-align:left;">
Z3
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>V &gt; 2.4: Category 7 (Extreme Hazard)<br />
D*V &gt; 2.0: Category 6 (Extreme Hazard Floodway)<br />
V &gt; 2.0 OR V*D &gt; 1.0: Category 5 (High Hazard Floodway)<br />
D &gt; 2.0: Category 4 (Extreme Hazard Depth)<br />
D &gt; 1.0: Category 3 (High Hazard Depth)<br />
V + 3.3*D &gt; 2.64: Category 2 (High Hazard)<br />
Otherwise Category 1 (Low Hazard)<br />
Dry points are assigned Category 0</p>
<img src="images/image153.png" width="355" height="266">
</td>
</tr>
<tr>
<td style="text-align:left;">
Z4
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Flood hazard mapping approach based on the Australian Guidelines <span class="citation">(<a href="#ref-CSIRO2000">CSIRO, 2000</a>)</span> using the following logic:</p>
<ul>
<li>D ≤ 0.3 and V ≤ 0.38: Category 1 (Low Hazard)<br />
</li>
<li>D ≤ 0.6 and V ≤ 0.8 and D + 0.64*V ≤ 0.82: Category 2 (Medium Hazard)<br />
</li>
<li>D ≤ 1.2 and V ≤ 1.5 and D + 0.69*V ≤ 1.38: Category 3 (High Hazard)<br />
</li>
<li>Otherwise Category 4 (Extreme Hazard)<br />
</li>
<li>Dry points are assigned Category 0</li>
</ul>
<img src="images/image154.png" width="319" height="407">
</td>
</tr>
<tr>
<td style="text-align:left;">
Z7
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Based on Figure L1 of the NSW Floodplain Risk Development Manual <span class="citation">(<a href="#ref-NSWManual2005">NSW Goverment, 2005b</a>)</span>, using the following logic:</p>
<ul>
<li>Category 1 (low hazard): V ≤ 2 and V + 6.667 x D ≤ 3</li>
<li>Category 2 (vehicles unstable) : V ≤ 2 and V + 3.333 x D ≤ 2.667</li>
<li>Category 3 (wading unsafe) : V ≤ 2 and D ≤ 2 and V x D ≤ 1</li>
<li>Category 4 (extreme) : Otherwise</li>
</ul>
<img src="images/image155.png">
</td>
</tr>
<tr>
<td style="text-align:left;">
Z9
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Flood hazard mapping approach based on the draft storm tide hydraulic hazard categorisation developed for Moreton Bay Regional Council <span class="citation">(<a href="#ref-GHD2011">GHD, 2011</a>)</span>. Z9 output values are 0 (zero) for no hazard and 1 to 5 for H1 to H5 respectively.</p>
<img src="images/image156.png">
</td>
</tr>
<tr>
<td style="text-align:left;">
ZAEM1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Flood hazard category as outlined by Australian Emergency Management Institute in 2014 <span class="citation">(<a href="#ref-AEMI2014">Australian Emergency Management Institute, 2014</a>)</span>. ZAEM1 output values are 0 (zero) for no hazard and 1 to 6 for H1 to H6 respectively.</p>
<img src="images/image158a.png">
</td>
</tr>
<tr>
<td style="text-align:left;">
ZGC1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Flood Intensity output used by Gold Coast City Council (Australia). The logic applied is as follows:</p>
<ul>
<li>D &lt; 0.3, V &lt; 0.4 and D*V &lt; 0.25: Category 1 (Low Intensity)<br />
</li>
<li>D &lt; 0.6, V &lt; 0.8 and D*V &lt; 0.4: Category 2 (Medium Intensity)<br />
</li>
<li>D &lt; 1.2, V &lt; 1.5 and D*V &lt; 0.6: Category 3 (High Intensity)<br />
</li>
<li>Otherwise Category 4 (Extreme Intensity)<br />
</li>
<li>Dry points are assigned Category 0 (No Intensity).
</td>
</tr>
<tr>
<td style="text-align:left;">
ZMBRC
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
Flood hazard output used by Moreton Bay Regional Council (Australia). Where:</li>
</ul>
<p>V &gt; 2.5 or D &gt; 2.5 or V*D &gt; 2.5: Category 5 (H5)<br />
V &gt; 2.0 or D &gt; 2.0 or V*D &gt; 1.0: Category 4 (H4)<br />
V &gt; 3.2 - 4D: Category 3 (H3)<br />
V &gt; 0.5 or D &gt; 0.3: Category 2 (H2)<br />
Otherwise Category 1 (H1)<br />
Dry points are assigned Category 0</p>
<p><img src="images/image160.PNG" width="480" height="360"></p>
Where:<br />
H1: Hydraulically suitable for parked or moving cars.<br />
H2: Hydraulically suitable for parked or moving heavy vehicles and wading by able-bodied adults.<br />
H3: Hydraulically suitable for light construction (e.g. Timber frame and brick veneer).<br />
H4: Hydraulically suitable for heavy construction (e.g. steel frame and reinforced concrete).<br />
H5: Generally unsuitable
</td>
</tr>
<tr>
<td style="text-align:left;">
ZMW1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
No longer recommended by Melbourne Water. For details on this hazard category, see the <a href="https://downloads.tuflow.com/TUFLOW/Releases/Latest/TUFLOW%20Manual.pdf">2018 TUFLOW Manual</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZMW2
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
No longer recommended by Melbourne Water. For details on this hazard category, see the <a href="https://downloads.tuflow.com/TUFLOW/Releases/Latest/TUFLOW%20Manual.pdf">2018 TUFLOW Manual</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZMW3
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Based on Melbourne Water (Australia) FM&amp;M Technical Specifications <span class="citation">(<a href="#ref-MW2016">Melbourne Water, 2016</a>)</span> to quantify Safety Risk in Roads. The logic used is as follows:</p>
D*V &lt; 0.4 and D &lt; 0.4: Low Risk<br />
D*V &lt; 0.8 and D &lt; 0.8: Medium Risk<br />
Otherwise: High Risk<br />
Dry points are assigned Category 0
</td>
</tr>
<tr>
<td style="text-align:left;">
ZNZ1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>The flood hazard category based on the Hamilton City Council (New Zealand) Flood Hazard Report [HamiltonFloodMapping].</p>
<p>The categories are defined as:</p>
<ul>
<li>D &lt; 0.1: Category 1 (Insignificant)</li>
<li>D &lt; 0.5 and V &lt; 1.0: Category 2 (Low)</li>
<li>D &lt; 1.0 and V &lt; 2.0 and D*V &lt; 1.0: Category 3 (Medium)</li>
<li>Otherwise Category 4 (High)</li>
<li>Dry points are assigned Category 0.</li>
</ul>
<img src="images/image162a.png">
</td>
</tr>
<tr>
<td style="text-align:left;">
ZNZ2
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Hazard category used by Auckland Council, New Zealand.</p>
<ul>
<li>Category 1 (Low Safety Risk): D*V &lt; 0.4, V &lt; 3.0 m/s and D &lt; 0.5 m<br />
</li>
<li>Category 2 (Moderate Safety Risk): D*V &lt; 0.8, V &lt; 3.0 m/s and D &lt; 1.2 m<br />
</li>
<li>Category 3 (High Safety Risk): D*V ≥ 0.8, V ≥ 3.0 m/s and D ≥ 0.1m, and D ≥ 1.2 m<br />
</li>
<li>Dry points are assigned Category 0.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZPA
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
People Hazard category “Hazard to Adults” based on the Australian Rainfall and Runoff (ARR) Project 10 Stage One Report <span class="citation">(<a href="#ref-CoxShard2010">Cox et al., 2010</a>)</span>.</li>
</ul>
<p>The values within the ZPA output are:</p>
<ul>
<li>0 = Safe (no hazard)<br />
</li>
<li>1 = Low Hazard<br />
</li>
<li>2 = Moderate Hazard<br />
</li>
<li>3 = Significant Hazard<br />
</li>
<li>4 = Extreme Hazard</li>
</ul>
<p>It is possible to specify cut-off depth/s representing when the Safe category applies by using the .tcf command ZP Hazard Cutoff Depth. Up to three values can be defined, which are the cut-off depths for ZPA, ZPC and ZPI respectively.</p>
<p>The relevant tables and figures are reproduced below:</p>
<img src="images/image163.png"><br />
<img src="images/image164.png">
</td>
</tr>
<tr>
<td style="text-align:left;">
ZPC
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
People Hazard category “Hazard to Children” based on the ARR Project 10 Stage One Report <span class="citation">(<a href="#ref-CoxShard2010">Cox et al., 2010</a>)</span>. Refer to the description of output values for ZPA.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZPI
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
People Hazard category “Hazard to Infants and frail/elderly People” based on the ARR Project 10 Stage One Report <span class="citation">(<a href="#ref-CoxShard2010">Cox et al., 2010</a>)</span>. Refer to the description of output values for ZPA.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZPMH
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>The flood hazard category based on the Port Macquarie-Hastings Council Flood Policy <span class="citation">(<a href="#ref-PortMacquarieFloodPolicy2018">Port Macquarie-Hastings Council, 2018</a>)</span>.</p>
<p>The logic used is as follows:</p>
<ul>
<li>D &lt; 0.4 and V &lt; 0.5 and D*V &lt; 0.2: Category 1 (Low Risk)<br />
</li>
<li>D &lt; 0.8 and V &lt; 2.0 and D*V &lt; 0.5: Category 2 (Medium Risk)<br />
</li>
<li>D &lt; 1.8 and V &lt; 2.0 and D*V &lt; 1.5: Category 3 (High Risk)<br />
</li>
<li>V &lt; 4.0 and D*V &lt; 2.5: Category 4 (Very High Risk)<br />
</li>
<li>Otherwise Category 5 (Extreme Risk)<br />
</li>
<li>Dry points are assigned Category 0.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZQRA
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
Hazard categories for the Queensland Reconstruction Authority <span class="citation">(<a href="#ref-QRAResilientFloodplains2018">Queensland Reconstruction Authority, 2012</a>)</span>.</li>
</ul>
<img src="images/image165.png">
</td>
</tr>
<tr>
<td style="text-align:left;">
ZTMR
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>Hazard category for the Queensland Department of Transport and Main Roads. Areas of a model with the Material ID set to a value of 100 (roads) will be tested for their submergence /closure status:</p>
<ul>
<li>Material ID ≠ 100: No hazard reporting (0)<br />
</li>
<li>D &lt;= 0: Road is immune (1)<br />
</li>
<li>D+V<sup>2</sup>/2g &lt; 0.3: Road is submerged (2)<br />
</li>
<li>Other: Road Closed (3)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZUD1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
Customisable hazard output based on a .csv file input read in using the <a href="#tcfReadHazardFile">Read Hazard File</a> command. This feature allows users to define a number of depth, velocity and depth-velocity product thresholds to create custom hazard categories. The csv file should contain three (3) columns defining the thresholds for depth, velocity, and depth-velocity product respectively.</li>
</ul>
<p>The example below produces the same output as for “ZNZ1”:</p>
<p><img src="images/image169.png"></p>
This hazard type is further detailed in Section <a href="#Hazards-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
ZUK0
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
The (real) value of the UK Hazard formula based on <span class="citation">Environment Agency (<a href="#ref-UKFloodRisks2006">2006</a>)</span> (see <a href="#tcfUKHazardFormula">UK Hazard Formula</a>, <a href="#UKHazardLandUse">UK Hazard Land Use</a> and <a href="#tcfUKHazardDebrisFactor">UK Hazard Debris Factor</a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
ZUK1
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>The UK Hazard category (integer) based on <span class="citation">Environment Agency (<a href="#ref-UKFloodRisks2006">2006</a>)</span> (see <a href="#tcfUKHazardFormula">UK Hazard Formula</a>, <a href="#tcfUKHazardLandUse">UK Hazard Land Use</a> and <a href="#tcfUKHazardDebrisFactor">UK Hazard Debris Factor</a>).</p>
<p>ZUK1 outputs a .xmdf file containing an integer, as per:</p>
<ul>
<li>0 = No Hazard (H <span class="math inline">\(\le\)</span> 0)<br />
</li>
<li>1 = Low Hazard (H <span class="math inline">\(\le\)</span> 0.75)<br />
</li>
<li>2 = Moderate Hazard (H <span class="math inline">\(\le\)</span> 1.25)<br />
</li>
<li>3 = Significant Hazard (H <span class="math inline">\(\le\)</span> 2.5)<br />
</li>
<li>4 = Extreme Hazard (H <span class="math inline">\(\ge\)</span> 2.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
ZUK2
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
The (real) value of the UK Hazard formula based on UK FD2320 Technical Report <span class="citation">(<a href="#ref-UKExplanatoryNote2008">Environment Agency, 2008</a>)</span>.</li>
</ul>
<p><span class="math display">\[Flood Hazard Rating = ((v+0.5)\:*\:D) + DF\]</span></p>
Where:<br />
v = velocity (m/s)<br />
D = depth (m)<br />
DF = debris factor
</td>
</tr>
<tr>
<td style="text-align:left;">
ZUK3
</td>
<td style="text-align:left;">
All formats
</td>
<td style="text-align:left;">
<p>The UK Hazard category (integer) based on UK FD2320 Technical Report <span class="citation">(<a href="#ref-UKExplanatoryNote2008">Environment Agency, 2008</a>)</span>.</p>
<p>Where:</p>
<ul>
<li>1 = Low</li>
<li>2 = Moderate</li>
<li>3 = Significant</li>
<li>4 = Extreme</li>
</ul>
<img src="images/image166.jpeg">
</td>
</tr>
</tbody>
</table>
<!-- WJS References for Z1, Z7, Z9, ZAEM1, ZMW3, ZPA, ZPC need not appearing correctly in above xls-->
<!-- EFC: Have asked WJS how he could prefer them-->
<!-- WJS Add integer value description to ZUK1 and ZUK3. I suspect it is:
1 = Low
2 = Moderate
3 = Significant
4 = Extreme
-->
<!-- EFC: added-->
<h3 class="hasAnchor" id="OneDMap-3"><span class="header-section-number">11.2.4</span> 1D Map Outputs<a href="#OneDMap-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>1D domain results can be output in combination with 2D domain(s) by
using the 1d_wll GIS layer and the <a href="#ecfReadGISWLL">Read GIS WLL</a> 1D
command. 1d_wll GIS layer(s) are used to define and control the 1D map
output. The layer(s) contain lines (called Water Level Lines or WLLs)
that cross or snap to 1D channels and/or nodes. A WLL is essentially a line of
horizontal water level, and should be digitised on this basis (i.e.
perpendicular to the flow direction).</p>
<p><strong>The direction of WLLs is important. They must be digitised from left
to right looking in the positive direction of the digitised channel.</strong></p>
<p>When viewing the results, if the 1D WLLs and 2D domains overlap, the 1D
results are displayed on top of the 2D results. However, depending on
the viewing platform, when observing the scalar and vector magnitudes as
the cursor is moved around, the 2D values maybe given precedence over
the 1D where the overlap occurs.</p>
<p>Two WLL options are available. The preferred method can be specified by
using the command <a href="#ecfWLLApproach">WLL Approach</a>. Of the two options,
Method A and Method B, Method B allows more advanced and accurate
mapping of 1D results in map formats and is the default and recommended
method, and that described below. For documentation on Method A, refer
to the <a href="https://www.tuflow.com/Download/TUFLOW/Manuals/TUFLOW%20Manual.2010-10-AB.docx">TUFLOW 2010
Manual</a>.</p>
<p>It should be noted that water level lines do <strong><u>NOT</u></strong> change the
1D hydraulic computations, they are purely used in order to display the
1D results in plan (2D) formats.</p>
<h4 class="hasAnchor" id="WLL-4"><span class="header-section-number">11.2.4.1</span> Water Level Lines<a href="#WLL-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ground elevations and optionally material (Manning’s n) values can be
assigned to points along a WLL. A more accurate representation of 1D
domain velocity and flood hazard can be mapped using this approach. The
velocity at a point on the WLL is estimated by carrying out a parallel
channel analysis along the WLL using the flow in the channel the WLL is
associated with as explained further below.</p>
<p>The parallel channel analysis assumes the water surface slope is that of the associated channel, and the water level at the WLL is linearly interpolated between the upstream and downstream nodes based on the digitised channel length.</p>
<p>WLLs can have any number of vertices. The association of WLLs to channels and nodes is as follows:</p>
<ul>
<li>At the channel ends, to lock in the water level at a node, use a 3 vertex line with the
middle vertex snapped to the 1D node. If you use a 3 vertex line
across a channel, the channel “thalweg” is taken at the middle vertex,
otherwise, for 2 vertex lines the mid-point of the WLL line is used.<br />
</li>
<li>If a WLL crosses two or more channels, the channel closest to the
middle vertex (3 point line) or half-way point (2 point line) is
used.<br />
</li>
<li>If a WLL middle vertex snaps to a node with two or more channels on
the upstream side, the channel that is closest in angle to the WLL’s
perpendicular (based on the WLL’s two end points) is used.<br />
</li>
<li>For 4 or more vertices, one of the middle vertices (i.e. not an end
vertex) must snap to a vertex on the channel line.</li>
</ul>
<p>There is one 1d_wll attribute required as described in <a href="#tab:tab-WaterLevelLine">104</a>. The attribute,
Dist_for_Add_Points, is the minimum distance in metres along which to
generate points for that WLL. If Dist_for_Add_Points is zero,
only the vertices along the WLL are generated.</p>
<p>Estimates of the elevation, depth, velocity and other hydraulic outputs from the parallel channel analysis are produced at each WLL point including any automatically added ones. The user can subsequently assign elevations and materials to each point to improve the topographic representation if so desired (see Section <a href="#WLLp-4"><strong>??</strong></a>).</p>
<p>An automatically generated triangulation (TIN) of the WLL points is used to display the outputs in map based formats.</p>
<table>
<caption>
<span id="tab:tab-WaterLevelLine">Table 104: </span><strong>1D Water Level Line (1d_wll) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Dist_for_Add_Points
</td>
<td style="text-align:left;">
The minimum distance interval along the WLL to generate elevation and material sampling points (WLL Points). These points form the corners of the triangulation.<br />
If set to zero, no additional points are generated (i.e. only the existing vertices along the WLL are used).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p>Use the 1D command <a href="#ecfReadGISWLL">Read GIS WLL</a> to specify the 1d_wll layer and automatically create 1D map output for TUFLOW 1D domains. For Flood Modeller or XPSWMM linked TUFLOW models, use <a href="#tcfReadGISISISWLL">Read GIS
ISIS WLL</a> or <a href="#tcfReadGISXPWLL">Read GIS XP WLL</a> in
the <strong>.tcf</strong> file to read the 1d_wll layer(s). The Flood Modeller units
or XPSWMM links will also need to be built into a GIS layer and read
using <a href="#tcfReadGISISISNetwork">Read GIS ISIS Network</a> or <a href="#tcfReadGISXPNetwork">Read GIS XP
Network</a> from the <strong>.tcf</strong> file.</p>
<p>Several 1d_wll layers can be specified covering different sections of
the 1D domain(s) if required. The TIN of triangular elements is created
from the WLL points and included in the .2dm mesh file that can be viewed using the QGIS TUFLOW Viewer or in SMS to check they have been created correctly. In particular, look for overlapping or strange triangulations that arise from WLLs not being digitised correctly.</p>
<p>The default approach uses the processed cross-section data (height–width data) from the channel for setting elevations at each WLL point.
For Flood Modeller and XPSWMM, these data are automatically fed through
to TUFLOW and is based on the cross-section information entered into the
Flood Modeller/XPSWMM model.</p>
<p>If a WLL is snapped to a node, the processed data used for setting any
bed elevations is from the higher channel unless it is a bridge in which
case it uses the bridge processed data.</p>
<p><tcmd><a href="#ecfWLLAutomatic">WLL Automatic</a></tcmd><teq> == </teq><tblk>CULVERTS</tblk> is particularly useful for
automatically generating WLLs for pipe network systems. <a href="#ecfWLLNoWeirs">WLL No
Weirs</a> is useful for not assigning WLLs to weir channels
where they are in parallel to another channel (this is particularly
useful for BW, CW and RW channels).</p>
<h4 class="hasAnchor" id="WLLp-4"><span class="header-section-number">11.2.4.2</span> Water Level Line Points<a href="#WLLp-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If <a href="#tcfWriteCheckFiles">Write Check Files</a> in the .tcf file is
specified, two GIS check layers are created from the WLLs. These are
labelled 1d_WLLo and 1d_WLLp. 1d_WLLo (Water Level Line Objects)
reproduces the WLLs with attributes containing the channel and node the
WLL is allocated to for cross-checking purposes.</p>
<p>1d_WLLp layers (Water Level Line Points) contain all of the elevation
points generated based on the Dist_for_Add_Points attribute. This layer
can then be used to allocate elevations (first attribute) to each point
from a DEM (in the same manner that 2D Zpts can be assigned elevations).</p>
<p>A second attribute, RR, contains the relative resistance of each point
(which will have a value of 1 when first generated). The RR attribute
can be replaced by the integer material value at each point by using GIS
to assign values from material polygons. The material value must exist
in the .tmf file or a materials.csv file (see <a href="#tcfReadMaterialsFile">Read Materials
File</a>).</p>
<p>The attributes of a 1d_WLLp layer created by <a href="#tcfWriteCheckFiles">Write Check
Files</a> and used in
<a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a>, <a href="#tcfReadGISISISWLLPoints">Read GIS ISIS WLL
Points</a> or <a href="#tcfReadGISXPWLLPoints">Read GIS XP WLL
Points</a> are listed in Table <a href="#tab:tab-LinePoint">105</a>.</p>
<p>The parallel channel analysis carried out for each WLL in future simulations will then use the WLL point data to estimate velocities and other outputs across the WLL instead of using the default approach of using processed hydraulic data as previously described. Note, the WLLs do <strong><u>NOT</u></strong> change the 1D hydraulic computations, they are purely used in order to display the 1D results in plan (2D) formats.</p>
<p>For Flood Modeller and XP-SWMM, the layers are essentially the same, but
are named using xWLLo and xWLLp.</p>
<p>Note: If using <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a> or <a href="#tcfReadGISISISWLLPoints">Read GIS
X1D WLL Points</a>, this layer must be a copy of
the 1d_WLLp layer produced by <a href="#tcfWriteCheckFiles">Write Check Files</a>.
Points from this layer can be deleted, but not added. At deleted points,
the default of estimating an elevation from the channel’s processed data
is used. If the 1d_WLL layer is modified or any of the
Dist_for_Add_Points attribute values changed, the 1d_WLLp layer needs to
be regenerated and repopulated again.</p>
<p>For culvert channels (R and C channel type), only the end and mid
vertices are used along the WLL, and the elevations are set to the
culvert invert irrespective of the number of points along the WLL or the
Dist_for_Add_Points value.</p>
<table>
<caption>
<span id="tab:tab-LinePoint">Table 105: </span><strong>1D Water Level Line Point (1d_wllp) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
Ground elevation of the point. Automatically generated from the channel cross-section processed data or updated based on a point inspection of a DEM or other approach.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
RR or Material
</td>
<td style="text-align:left;">
<p>In the 1d_WLLp check file, the relative resistance of the point. A value of 1 is assigned if the elevation was estimated from the channel’s processed data. If the elevation was provided through a point using <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a>, RR is the material Manning’s n value divided by the channel’s n value.</p>
In a 1d_WLLp layer being used in <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a> or <a href="#tcfReadGISX1DWLLPoints">Read GIS X1D WLL Points</a>, this column should either be set to an integer material value (normally sourced from a GIS layer of material polygons) – the material value must exist in the .tmf file (see <a href="#tcfReadMaterialsFile">Read Materials File</a>).
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<p>Elevation values along WLLs for bridge channels are always based on the
processed data (i.e. any WLLp Z values are overridden) to ensure that
the bridge deck underside is correctly represented. This has benefits
when using the post-processing utility TUFLOW_to_GIS.exe (see Section
<a href="#Console-2"><strong>??</strong></a>) when extracting obverts of structures for longitudinal
profiles.</p>
<p>A useful tip at a junction of 1D channels is to use a connector for any
side channels (Type = “X” – see Section <a href="#XConnect-3"><strong>??</strong></a>). Separate WLLs can
then be allocated to the side channel and main channel removing the
confusion that sometimes occurs in generating the triangulation between
WLLs at junctions.</p>
<h4 class="hasAnchor" id="WLLtriangles-4"><span class="header-section-number">11.2.4.3</span> Adding Triangles into the 1d_WLL Layer<a href="#WLLtriangles-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When using Method B, triangular regions can also be included in the 1d_WLL
layer (as a separate region or polygon layer if using the .gpkg or .shp formats). The triangles are inserted into the WLL triangulation. This is particularly useful at junctions or between parallel
channels to enhance the WLL TIN by facilitating a smooth transition of the water level surface at, for example, junctions or across meanders to infill areas and avoid steps in the output surfaces.</p>
<p>The triangles must snap to the ends of WLL line objects. In the example below, the WLLs are shown in red and the triangles are shown as yellow. These are connected (snapped) to the ends of the WLLs. The map output surfaces will interpolate over the triangle based on the hydraulic output values at the snapped WLLs.</p>
<p>If the region object is not correctly snapped an <a href="http://wiki.tuflow.com/TUFLOW_Message_1311">ERROR 1311</a>
message occurs, pointing to the vertex on the triangle that is not snapped.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-WLL-Triangles"></span>
<img src="images/image148.png" alt="**Adding Triangles into 1d_WLL Layer to Infill Areas**" width="40%" />
<p class="caption">
Figure 104: <strong>Adding Triangles into 1d_WLL Layer to Infill Areas</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="OutputZones-3"><span class="header-section-number">11.2.5</span> Output Zones<a href="#OutputZones-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Output Zones are a powerful feature that allows users to generate map and check file outputs for sub-regions of a model. The region is defined using a polygon feature using the 2d_oz_empty template file. No attributes are associated with the polygon. One polygon per output zone and GIS layer is recommended. Note, multiple polygons within a single layer are not supported.</p>
<p>Different Output Zones can have different output formats, start/end
times, frequency of output, and output data types. Any number of Output
Zones can be defined for a model, and all, a selection of, or none of the
Output Zones can be activated when the model is run.</p>
<p>Output zones are very useful, particularly for large models, where
higher frequency map output is required for a portion of a model, for
example to create an animationfor an urban region using a shorter map output interval. Another useful
purpose is to create an Output Zone for a problematic section of model
that requires closer examination, by generating output on a fine time
interval during the period in question. Another benefit is simply
reducing the size of the output files by only outputting where
information is required, and disabling the output for the whole model
using <a href="#tcfMapOutputEntireModel">Map Output Entire Model</a> == OFF. Output
zones currently only apply to TUFLOW’s map and GIS check file outputs
(i.e. does not apply to time series and other plot outputs).</p>
<p><strong>Note: the <a href="#tcfModelOutputZones">Model Output Zones</a> command is used to
select which Output Zones are to be used (activated). If this command is omitted, no
output from the Output Zones is written.</strong> Separate multiple Output
Zones using a “|” (vertical bar or pipe character). For example, to
output from zones ZoneA and ZoneC specify:</p>
<p><tcmd>Model Output Zones </tcmd><teq>==</teq><tblk> ZoneA | ZoneC </tblk></p>
<p>If there are numerous Output Zones, it is recommended that the
definitions are placed in one or more separate files, and use the <a href="#tcfReadFile">Read
File</a> command to reference these file(s). This
will keep the size of the .tcf file to a minimum. This, however, is not a
requirement.</p>
<p>Each Output Zone is defined using a definition block as follows:</p>
<p><tcmd>Define Output Zone</tcmd><teq> ==</teq><tblk> &lt;ZoneA&gt;</tblk></p>
<p>…..</p>
<p><tcmd>End Define</tcmd></p>
<p>The following commands can be used within an Output Zone definition.
With the exception of <a href="#tcfReadGISOutputZone">Read GIS Output Zone</a>, all
commands are optional. The optional commands can be used to change the
default setting or the setting applied outside the Output Zone
definitions.</p>
<p><a href="#tcfReadGISOutputZone">Read GIS Output Zone</a><br />
<a href="#tcfMapOutputFormat">Map Output Format</a><br />
<a href="#tcfStartMapOutput">Start Map Output</a><br />
<a href="#tcfEndMapOutput">End Map Output</a><br />
<a href="#tcfMapOutputInterval">Map Output Interval</a><br />
<a href="#tcfMapOutputDataTypes">Map Output Data Types</a><br />
<a href="#tcfOutputFolder">Output Folder</a><br />
<a href="#tcfMaximumsandMinimums">Maximums and Minimums</a><br />
<a href="#tcfMaxandMinOnlyforGrids">Maximums and Minimums Only for Grid</a><br />
<a href="#tcfWriteCheckFiles">Write Check Files</a></p>
<p>The <a href="#tcfReadGISOutputZone">Read GIS Output Zone</a> reads a GIS layer
containing one or more polygons that define the regions to be output.
The attributes of the layer are not used.</p>
<p><strong>Note: If one of the commands above is not specified within the Output
Zone’s definition, the latest setting of that command prior to the
Output Zone’s definition, or the global default if the command has not
been used prior to that location in the .tcf file, will be used. If,
for example, all output is to be in the .xmdf format, only specify <a href="#tcfMapOutputFormat">Map
Output Format</a> == XMDF once and prior to any Output
Zone definitions.</strong></p>
<p><a href="#tcfMapOutputEntireModel">Map Output Entire Model</a> can be used outside
an Output Zone definition block to turn on or off map output for the
entire model (the default is ON). If set to OFF only map output for any
Output Zones is written. Map output commands that occur outside Output
Zone definitions apply to the entire model output.</p>
<p><strong>Example: Defining an Output Zone</strong></p>
<p>The example below defines Output Zone “ZoneA”. In the example, a DEM_Z
check grid will be the only check layer written for the Output Zone, and
Grid, WRB and XMDF outputs will be produced. The Grid output will
consist of water level (h) and VxD (Z0) results, starting at time 0.5
hours and ending at 4 hours at an interval of 0.5 hours. The WRB and
XMDF output files will contain water levels (h), velocities (V) and the
ZMBRC hazard categories starting at the simulation beginning and
finishing at 6 hours at an interval of 6 minutes.</p>
<p><tgrn> ! Entire Model settings </tgrn><br />
<tcmd>Map Output Format </tcmd><teq>==</teq><tblk> TIF XMDF</tblk><br />
<tcmd>Map Output Interval </tcmd><teq>==</teq><tblk> 3600 <tgrn>! Default output interval is hourly</tgrn></tblk><br />
<tcmd>TIF Map Output Interval </tcmd><teq>==</teq><tblk> 0 <tgrn>! Maximums only for .tif output</tgrn></tblk><br />
<tcmd>Map Output Data Types </tcmd><teq>==</teq><tblk> h v q d z0 <tgrn>! Default output types</tgrn></tblk></p>
<p><tcmd>Model Output Zones </tcmd><teq>==</teq><tblk> ZoneA | ZoneB <tgrn>! Output both of the zones below</tgrn></tblk></p>
<p><tcmd>Define Output Zone </tcmd><teq>==</teq><tblk> ZoneA</tblk></p>
<div class="line-block">  <tcmd>Read GIS Output Zone </tcmd><teq>==</teq><tblk> ..\2d_oz_ZoneA.shp</tblk><br />
  <tcmd>Write Check Files Include </tcmd><teq>==</teq><tblk> DEM_Z</tblk><br />
  <tcmd>Map Output Formats </tcmd><teq>==</teq><tblk> TIF XMDF WRB</tblk><br />
  <tcmd>End Map Output </tcmd><teq>==</teq><tblk> 6.0</tblk><br />
  <tcmd>Map Output Interval </tcmd><teq>==</teq><tblk> 360</tblk><br />
  <tcmd>TIF Start Map Output </tcmd><teq>==</teq><tblk> 0.5</tblk><br />
  <tcmd>TIF End Map Output </tcmd><teq>==</teq><tblk> 4.0</tblk><br />
  <tcmd>TIF Map Output Interval </tcmd><teq>==</teq><tblk> 1800</tblk><br />
  <tcmd>XMDF Map Output Data Types </tcmd><teq>==</teq><tblk> h V ZMBRC</tblk><br />
  <tcmd>TIF Map Output Data Types </tcmd><teq>==</teq><tblk> h Z0</tblk></div>
<p><tcmd>End Define </tcmd></p>
<p><tcmd>Define Output Zone </tcmd><teq>==</teq><tblk> ZoneB</tblk></p>
<div class="line-block">  <tcmd>Read GIS Output Zone </tcmd><teq>==</teq><tblk> ..\2d_oz_ZoneB.shp</tblk><br />
  <tcmd>Map Output Formats </tcmd><teq>==</teq><tblk> XMDF</tblk><br />
  <tcmd>Map Output Interval </tcmd><teq>==</teq><tblk> 360</tblk><br />
  <tcmd>XMDF Map Output Data Types </tcmd><teq>==</teq><tblk> h V ZMBRC</tblk></div>
<p><tcmd>End Define</tcmd></p>
<h3 class="hasAnchor" id="GaugeLevel-3"><span class="header-section-number">11.2.6</span> Gauge Level Output<a href="#GaugeLevel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 2d_glo GIS layer uses the .tcf command <a href="#tcfReadGISGLO">Read GIS GLO</a> and writes map-based output data when the water level at the gauge reaches user defined levels.</p>
<p><strong>Note: Map output based on reaching gauge levels replaces the
conventional approach of using a <a href="#tcfStartMapOutput">Start Map Output</a>
time and a <a href="#tcfMapOutputInterval">Map Output Interval</a>.</strong></p>
<p>The 2d_glo GIS layer is used to define the location of the gauge within
the modelled extent. The gauge is digitised as a point object within a
2d_glo layer with the attributes as described in Table <a href="#tab:tab-GaugeLevel">106</a> and
referenced within the .tcf using the command <a href="#tcfReadGISGLO">Read GIS
GLO</a>.</p>
<p>For TUFLOW Classic only, the water level at the gauge location is tracked by TUFLOW throughout the simulation and output to the Console DOS Window (see Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>) preceded by the letters “GL”.</p>
<p>When the water level reaches a user specified value, the map output results at that simulation time will be written. The results are therefore useful for mapping the predicted area of inundation for specified gauge heights. The range of water levels at the gauge for which the results are written
may be defined using one of two methods:</p>
<ul>
<li>By referencing a .csv file within the 2d_glo GIS layer using the first
attribute. The .csv file contains a single column of levels, and
comment lines are allowed using the “!” or “#” character. If a .csv
file is specified in the first attribute, the remaining attributes are
not used, but dummy or empty values for these attributes must exist.<br />
</li>
<li>By populating the remaining attributes of the 2d_glo GIS layer as
described below.</li>
</ul>
<p>When using the attributes of the 2d_glo GIS layer to define the gauge
heights, the map output results are first written when the water level
at the gauge reaches the specified “Bottom_elevation”. Subsequent
results are written as the water level at the gauge rises based on the
value of the “increment” attribute. The map output ceases once the water
level at the gauge reaches the “Top_elevation”.</p>
<p>For example, if the 2d_glo GIS layer has been defined as shown below,
map output results will be written when the water level at the gauge
reaches 41m, 41.5m, 42m, 42.5m and 43m.</p>
<center>
<img src="images/image147.png"
style="width:2.10232in;height:1.77383in" />
</center>
<p>Only one gauge location may be specified per model simulation. If more
than one object exists within the 2d_glo layer, the gauge that is
monitored by TUFLOW will be the last digitised point object. Similarly, if the
<a href="#tcfReadGISGLO">Read GIS GLO</a> command is used more than once, only the
last occurrence of the command will be used.</p>
<table>
<caption>
<span id="tab:tab-GaugeLevel">Table 106: </span><strong>2D Gauge Level Output (2d_glo) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Datafile
</td>
<td style="text-align:left;">
<p>Filename (and relative or full path if needed) of the file containing the gauge levels to trigger map output. Must be a comma or space delimited text file such as a .csv file. Only the first column is used, and this column must contain the gauge levels. Comment lines using a leading “!” or “#” can be used at any point within the file.</p>
If this attribute is blank, the following three attributes are used to define the gauge levels to trigger map output. If this attribute is not blank, the following three attributes are not used, but they must exist and can simply be populated with empty or default values.
</td>
<td style="text-align:left;">
Char (254)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Bottom_Elevation
</td>
<td style="text-align:left;">
The water level in m above datum at the gauge at which the writing of map output results will commence.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Top_Elevation
</td>
<td style="text-align:left;">
The water level in m above datum at the gauge at which writing of the map output results will cease.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Increment
</td>
<td style="text-align:left;">
The water level increments in metres between the Bottom_Elevation and Top_Elevation at which the map output results will be written.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="TimeSeries-2"><span class="header-section-number">11.3</span> Time-Series Outputs<a href="#TimeSeries-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Time-series results (sometimes referred to as Plot Output) produces output for graphing in charts and profiles. The data output are specified using the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command, at an interval specified by the <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a> command.</p>
<p>Time-Series data can be output for 1D domains (Section <a href="#OneDTS-3"><strong>??</strong></a>) and 2D domains (Section <a href="#TwoDTS-3"><strong>??</strong></a>). If the total flow across the floodplain is required for a 1D/2D model where the river is in 1D and the floodplain in 2D, flows can be combined using Reporting Locations (Section <a href="#ReportingLocation-3"><strong>??</strong></a>). The Structure Reporting feature outputs time-series and summary data for structures (Section <a href="#Structure-3"><strong>??</strong></a>).</p>
<p>There are two formats available for time-series outputs: comma-separated values (.csv) (the default) and NetCDF (.nc). One of the advantages of NetCDF is all the timeseries output is in a single compressed .nc file, rather than multiple uncompressed .csv files. To change the format use <a href="#tcfTimeSeriesOutputFormat">Time Series Output Format</a> command.</p>
<p>It is possible to write 1D and 2D time-series outputs as the simulation progresses, using the <a href="#tcfWritePOOnline">Write PO Online</a> command.</p>
<h3 class="hasAnchor" id="OneDTS-3"><span class="header-section-number">11.3.1</span> 1D Time-Series Output<a href="#OneDTS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Time-series data output from 1D domains is available for a range of hydraulic parameters. The <a href="#ecfOutputDataTypes">Output Data Types</a> ECF command or the <a href="#ecfOutputDataTypes">1D Output Data Types</a> TCF command controls the types to output. The options are:</p>
<ul>
<li>A: flow area at channels (m<sup>2</sup>);</li>
<li>E: energy at nodes (m);</li>
<li>H: water level at nodes (m);</li>
<li>Q: flow at channels (m<sup>3</sup>/s);</li>
<li>QI: integral flow at channels (m<sup>3</sup>);</li>
<li>S: structure and grouped structure output (see Section <a href="#Structure-3"><strong>??</strong></a>);</li>
<li>V: velocity at channels (m/s); and</li>
<li>Vol: volume at nodes (m<sup>3</sup>).</li>
</ul>
<p>To review the 1D time-series data see <a href="#view-1D-2"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="TwoDTS-3"><span class="header-section-number">11.3.2</span> 2D Time-Series Output<a href="#TwoDTS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Time-series data output from 2D domains is available for a range of hydraulic parameters (as listed in Table <a href="#tab:tab-PODataPLPL">107</a>). Output takes the form of time-series hydrographs (referred to as PO – Plot Output) or longitudinal profiles (LP) over time.</p>
<p>This is carried out by creating one or more GIS layers containing points, lines and regions that define the locations of PO and LP output. Figure <a href="#fig:fig-PO-Objects">105</a> illustrates how 2d_po objects are interpreted.</p>
<p>The start time for PO and LP output and the output interval is set using <a href="#tcfStartTimeSeriesOutput">Start Time Series Output</a> and <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a>. If no start time is specified the simulation start time is used. If no output interval is specified the simulation will stop with <a href="http://wiki.tuflow.com/TUFLOW_Message_0046">ERROR 0046</a> to prevent excessive amounts of memory and disk space from being used.</p>
<p>The output is written to a .csv file and also to the _TS layer (refer to Section <a href="#TS-GIS-3"><strong>??</strong></a>). 2D domain time-series (PO) output is synchronised with 1D domain output by default. This allows both 1D and 2D time-series to be placed in the _TS layer. Set <a href="#ecfOutputTimesSameas2D">Output Times Same as 2D</a> to OFF in the .ecf file if 1D and 2D time-series data is not to be synchronised. In this case, no 2D PO is written to the _TS layer.</p>
<p>Maximums and minimums are output to four additional rows near the top of the _PO.csv file, and columns in the _LP.csv files, containing the Maximum, Time of Maximum, Minimum, and Time of Minimum values. The _TS GIS layer also contains the tracked values. For TUFLOW Classic this information is tracked every computational timestep. For TUFLOW HPC the maximum/minimum values are post-processed at the end of the simulation based on the <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a>, not every computational timestep. Tracking of maximums and minimums can be disabled by setting the <a href="#tcfMaxMinTS">Maximums and Minimums Time Series</a> command to OFF in the .tcf file.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-PO-Objects"></span>
<img src="images/image146.jpg" alt="**Interpretation of PO Objects and Map Output**"  />
<p class="caption">
Figure 105: <strong>Interpretation of PO Objects and Map Output</strong>
</p>
</div>
</center>
<!-- WJS should above figure be reworked to also include regions? -->
<!-- EFC to WJS: I've emailed Mel-->
<!-- EFC: done-->
<h4 class="hasAnchor" id="PlotOutput-4"><span class="header-section-number">11.3.2.1</span> Plot Output<a href="#PlotOutput-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The data types available for PO are as listed in Table <a href="#tab:tab-PODataPLPL">107</a>, noting that only supported object types (i.e. Point, Line and Region) for the data type are documented in the table. PO data is read into a simulation using the <a href="#tcfReadGISPO">Read GIS PO</a> .tcf command. This is carried out by creating one or more GIS layers containing points, lines and regions that define the locations of PO and LP output. Figure <a href="#fig:fig-PO-Objects">105</a> illustrates how 2d_po objects are interpreted.</p>
<table>
<caption>
<span id="tab:tab-PODataPLPL">Table 107: </span><strong>Time-Series (PO) Data Types - Point, Line or Region</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flag
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Comments
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
CI
</td>
<td style="text-align:left;">
Cumulative Infiltration
</td>
<td style="text-align:left;">
<b>Point</b>: Represents the current water content of each layer (mm or in of pure water). This value may increase or decrease depending on the flows into and out of the cell (it is not the cumulative value).
</td>
</tr>
<tr>
<td style="text-align:left;">
D_
</td>
<td style="text-align:left;">
Depth
</td>
<td style="text-align:left;">
<p><b>Point</b>: Depth of the nearest cell.</p>
<b>Line</b>: The average depth of all wet cells along the line. Note: In TUFLOW Classic if a line with more than 2 vertices (i.e. a polyline) is used, the average water level along each line segment is output, therefore, use of polylines is not recommended for this output type at present. TUFLOW HPC, will take the average depth along the entire polyline.
</td>
</tr>
<tr>
<td style="text-align:left;">
G_
</td>
<td style="text-align:left;">
Gauge Level
</td>
<td style="text-align:left;">
<b>Point</b>: Water level at the cell center of the nearest cell. If the cell is dry, the ground level (ZC) is output. Used for Read GIS Objects to record gauge levels when a receptor is first inundated. Refer to Section <a href="#ReportingLocation-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
GWd
</td>
<td style="text-align:left;">
Groundwater Depth
</td>
<td style="text-align:left;">
<b>Point</b>: Depth of water within sub-surface layer(s) (cumulative infiltration divided by porosity).
</td>
</tr>
<tr>
<td style="text-align:left;">
GWh
</td>
<td style="text-align:left;">
Groundwater Level
</td>
<td style="text-align:left;">
<b>Point</b>: Elevation of groundwater surface (water table) within sub-surface layer(s), reported in m or ft.
</td>
</tr>
<tr>
<td style="text-align:left;">
GWm
</td>
<td style="text-align:left;">
Groundwater Moisture
</td>
<td style="text-align:left;">
<b>Point</b>: A dimensionless number in range 0 - 1 representing “fraction full” of the sub-surface layer(s).
</td>
</tr>
<tr>
<td style="text-align:left;">
GWq
</td>
<td style="text-align:left;">
Groundwater Unit Flow
</td>
<td style="text-align:left;">
<p><b>Point</b>: Unit flow magnitude within the sub-surface layer(s).</p>
<b>Line</b>: Total flow passing through the given line within each sub-surface layer(s). The positive flow convention is left to right looking downstream (same as the Q_ type).
</td>
</tr>
<tr>
<td style="text-align:left;">
Gwqa
</td>
<td style="text-align:left;">
Groundwater Unit Flow Angle
</td>
<td style="text-align:left;">
<b>Point</b>: Angle of unit flow vector within each layer. Reported in degrees clockwise from north (i.e. a compass bearing).
</td>
</tr>
<tr>
<td style="text-align:left;">
Gwqu
</td>
<td style="text-align:left;">
Groundwater Unit Flow<br />
U-Component
</td>
<td style="text-align:left;">
<b>Point</b>: Unit flow u-component within each sub-surface layer(s).
</td>
</tr>
<tr>
<td style="text-align:left;">
GWqv
</td>
<td style="text-align:left;">
Groundwater Unit Flow<br />
V-Component
</td>
<td style="text-align:left;">
<b>Point</b>: Unit flow v-component within each sub-surface layer(s).
</td>
</tr>
<tr>
<td style="text-align:left;">
GWVol
</td>
<td style="text-align:left;">
Groundwater Volume
</td>
<td style="text-align:left;">
<b>Region</b>: Total volume of water within the polygon for each layer (m<sup>3</sup> or ft<sup>3</sup>).
</td>
</tr>
<tr>
<td style="text-align:left;">
H_
</td>
<td style="text-align:left;">
Water Level (Head)
</td>
<td style="text-align:left;">
<b>Point</b>: Water level of the nearest cell. If the cell is dry, the ground level (ZC) is output.
</td>
</tr>
<tr>
<td style="text-align:left;">
HAvg
</td>
<td style="text-align:left;">
Average Water Level
</td>
<td style="text-align:left;">
<b>Region</b>: The average water level within the region (wet cells only).
</td>
</tr>
<tr>
<td style="text-align:left;">
HD
HU
</td>
<td style="text-align:left;">
Downstream and Upstream Structure Water Levels
</td>
<td style="text-align:left;">
<p><b>Point</b>:<br />
Used to define the upstream (HU) and downstream (HD) water levels of a QS structure (see QS below and Section <a href="#Structure-3"><strong>??</strong></a>). The 2D water level is used to populate the upstream and downstream water level data in the new structure output feature. For a point the water level at the nearest 2D cell centre is used.</p>
<p>To associate the HU and HD objects with the QS line, all three (QS, HU and HD) must have the same ID for the 2d_po Label attribute (see Table <a href="#tab:tab-PlotOutput">108</a>).</p>
Note that the water levels over time are output to a 2D PO .csv file and the summary information at the flood peak to the new _SHmx.csv file. If the point or line is completely dry, -99999 is output to the .csv files. The _SHmx.csv file is currently not produced for 2D only models.
</td>
</tr>
<tr>
<td style="text-align:left;">
HMax
</td>
<td style="text-align:left;">
Maximum Water Level
</td>
<td style="text-align:left;">
<b>Region</b>: The maximum water level within the region.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q_
</td>
<td style="text-align:left;">
Flow or discharge
</td>
<td style="text-align:left;">
<p><b>Line</b>: The flow crossing the line.</p>
<p>The flow is determined by summing the flow across cell sides whose perpendiculars intersect the line (see Figure <a href="#fig:fig-PO-Objects">105</a>).</p>
<p>The flow is positive if the water is flowing away from you when looking in a direction with the start of the PO line on your left and the end of the line on your right.</p>
If digitising a flow line across a 1D channel that is carved through the 2D domain, ensure that the line is digitised so that it crosses the 1D channel where there is a change in colour in linked 2D HX cells as shown in the 1d_to_2d_check or _TSMB1d2d layers (thematically map using the Primary Node if not using MapInfo). The 1D flow can then be added manually in a spreadsheet. <strong>However, note that <a href="#tcfGISReportingLocation">Read GIS Reporting Location</a> is now the preferred method for cumulating flows across a line for 1D/2D models. See Section <a href="#ReportingLocation-3"><strong>??</strong></a> for discussion on Reporting Locations.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;">
QA
</td>
<td style="text-align:left;">
Flow Area
</td>
<td style="text-align:left;">
<b>Line</b>: The flow area is calculated using the same cell sides as for Q_. An adjustment for oblique lines is made.
</td>
</tr>
<tr>
<td style="text-align:left;">
QI
</td>
<td style="text-align:left;">
Integral Flow
</td>
<td style="text-align:left;">
<b>Line</b>: Integrates the flow (as determined for Q_ above) over time (i.e. the area under a Q_ time-series curve) (i.e. cumulative volume). If Write PO Online is set to ON, the integral flow is not calculated until the simulation is complete.
</td>
</tr>
<tr>
<td style="text-align:left;">
Qin
</td>
<td style="text-align:left;">
Flow In
</td>
<td style="text-align:left;">
<b>Region</b>: The flow into a region.
</td>
</tr>
<tr>
<td style="text-align:left;">
Qout
</td>
<td style="text-align:left;">
Flow Out
</td>
<td style="text-align:left;">
<b>Region</b>: The flow out of a region.
</td>
</tr>
<tr>
<td style="text-align:left;">
QS
</td>
<td style="text-align:left;">
Structure Flow
</td>
<td style="text-align:left;">
<b>Line</b>: Same as Q_ above, but also used to set up a 2D structure output (see Section <a href="#Structure-3"><strong>??</strong></a>) that will include in addition to the 2D flow any flows from intersected 1D structures and the split between below and above deck flows. Note the flow output to the 2D PO .csv files is only the 2D flow, while that to the new _SQ.csv file is the combined 1D/2D structure flow. The _SQ.csv file is currently not produced for 2D only models.
</td>
</tr>
<tr>
<td style="text-align:left;">
QX
</td>
<td style="text-align:left;">
Flow in X-direction.
</td>
<td style="text-align:left;">
<b>Line</b>: The X component of Q_ (i.e. the sum of the flows at the u-points).
</td>
</tr>
<tr>
<td style="text-align:left;">
QY
</td>
<td style="text-align:left;">
Flow in Y-direction.
</td>
<td style="text-align:left;">
<b>Line</b>: The Y component of Q_ (i.e. the sum of the flows at the v-points).
</td>
</tr>
<tr>
<td style="text-align:left;">
SS
</td>
<td style="text-align:left;">
Sink Source
</td>
<td style="text-align:left;">
<b>Region</b>: Sink / source flows applied within the region (rainfall, infiltration, source area inflow and SX flows).
</td>
</tr>
<tr>
<td style="text-align:left;">
V_
</td>
<td style="text-align:left;">
Velocity
</td>
<td style="text-align:left;">
<p><b>Point</b>: The magnitude of the resolved vector based on the two u-points and two v-points of the cell in which the point falls. Exactly which cell is selected may be uncertain if the point falls exactly on a cell’s side.</p>
<b>Line</b>: Velocity as Q_/QA (i.e. the depth and width averaged velocity along the line). Prior to release 2020-10-AA it used the cell in which the line starts.
</td>
</tr>
<tr>
<td style="text-align:left;">
VA
</td>
<td style="text-align:left;">
Velocity Angle
</td>
<td style="text-align:left;">
<b>Point</b>: The angle of V_ (degrees relative to east where east is zero, north is 90, etc.).
</td>
</tr>
<tr>
<td style="text-align:left;">
Vol
</td>
<td style="text-align:left;">
Volume
</td>
<td style="text-align:left;">
<b>Region</b>: Total volume within the region.
</td>
</tr>
<tr>
<td style="text-align:left;">
Vu or Uu
</td>
<td style="text-align:left;">
u-point velocity
</td>
<td style="text-align:left;">
<b>Point</b>: The magnitude of the u-point velocity (i.e. across the right hand side of the cell).
</td>
</tr>
<tr>
<td style="text-align:left;">
Vv
</td>
<td style="text-align:left;">
v-point velocity
</td>
<td style="text-align:left;">
<b>Point</b>: The magnitude of the v-point velocity (i.e. across the top side of the cell).
</td>
</tr>
<tr>
<td style="text-align:left;">
VX
</td>
<td style="text-align:left;">
Velocity in X-direction
</td>
<td style="text-align:left;">
<b>Point</b>: The magnitude of the average of the u-point velocities (i.e. across the left and right hand sides of the cell).
</td>
</tr>
<tr>
<td style="text-align:left;">
VY
</td>
<td style="text-align:left;">
Velocity in Y-direction
</td>
<td style="text-align:left;">
<b>Point</b>: The magnitude of the average of the v-point velocities (i.e. across the bottom and top sides of the cell).
</td>
</tr>
</tbody>
</table>
<p>Table <a href="#tab:tab-PlotOutput">108</a> describes the GIS attributes of the 2d_po layer.</p>
<table>
<caption>
<span id="tab:tab-PlotOutput">Table 108: </span><strong>2D Plot Output (2d_po) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
Any combination of the <b> two</b> letter flags listed in Column 1 of Table <a href="#tab:tab-PODataPLPL">107</a> (limit of 10 flags per entry). For example, to output water level and flow time-series for the same line, enter “H_Q_”.
</td>
<td style="text-align:left;">
Char (20)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Label
</td>
<td style="text-align:left;">
<p>Label up to 30 characters long defining the name of the time-series. The label appears at the top of the columns of data in the _PO.csv file. Spaces are permitted, but do not use commas.</p>
<a href="#tcfGISReportingLocation">Read GIS Reporting Location</a> is the preferred method for cumulating flows in 2D1D models. See Section <a href="#ReportingLocation-3"><strong>??</strong></a> for discussion on Reporting Locations.
</td>
<td style="text-align:left;">
Char (30)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Comment
</td>
<td style="text-align:left;">
Optional field for entering comments. Not used.
</td>
<td style="text-align:left;">
Char (250)
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="LongProfile-4"><span class="header-section-number">11.3.2.2</span> Long Profile Output<a href="#LongProfile-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>H_ (water level) and V_ (velocity) are the only data types available for long profile (LP) outputs. LP locations and data types are initiated for a simulation using the <a href="#tcfReadGISLP">Read GIS LP</a> .tcf command.</p>
<p>Table <a href="#tab:tab-LongitudinalProfiles">109</a> describes the GIS attributes of the 2d_lp layer. The 2d_lp layer(s) contain lines defining where the profile data are to be generated. Each line is given a label to uniquely define the profile in the output. The starting vertex of the line will set the distance origin for the profile.</p>
<p>The advantage of having TUFLOW generate the profiles directly rather than post-processing them is the outputs will be slightly more accurate due to no post-processing interpolation rounding, plus if the profile(s) are repeatedly being plotted, the plotting process can be streamlined via python scripts that use the LP outputs.</p>
<table>
<caption>
<span id="tab:tab-LongitudinalProfiles">Table 109: </span><strong>2D Longitudinal Profiles (2d_lp) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Type
</td>
<td style="text-align:left;">
Specify “H_” to output water level. Specify “V_” to output velocity.
</td>
<td style="text-align:left;">
Char (20)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Label
</td>
<td style="text-align:left;">
Label up to 30 characters defining the name of the longitudinal profile. The label appears at the top of the columns of data in the _LP.csv file. Spaces are permitted. Commas are not permitted.
</td>
<td style="text-align:left;">
Char (30)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Comment
</td>
<td style="text-align:left;">
Optional field for entering comments. Not used.
</td>
<td style="text-align:left;">
Char (250)
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="ReportingLocation-3"><span class="header-section-number">11.3.3</span> Reporting Locations<a href="#ReportingLocation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="#tcfGISReportingLocation">Read GIS Reporting Location</a> allows for plotting of time-series results that automatically combines 1D and 2D outputs. For example, it is possible to digitise a reporting location line that extends across 1D and 2D domains, including multiple 2D domains, and TUFLOW will sum the flow across any 1D channels intersected by the line and all the 2D cells. This will save the need to post-process time-series output from 1D and 2D domains to accumulate the flow.</p>
<p>Reporting location lines are digitised into a 0d_RL GIS layer containing only a single attribute, the name of the reporting location, as outlined in Table <a href="#tab:tab-ReportingLocation">110</a>. Points, lines and regions can be used. Points will be treated as water level output, lines as flow output and regions as volume output. For a point snapped to a 1D node, the 1D water level is used, if no 1D node is snapped a 2D water level is output.</p>
<p>The flow line can cross 1D and 2D sections of the model, for the 1D channels it does not have to snap to any vertices on the channels, it just needs to intersect them.</p>
<table>
<caption>
<span id="tab:tab-ReportingLocation">Table 110: </span><strong>0d_RL Reporting Location Attributes</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
The name of the reporting location. Lines and points can share the same name.
</td>
<td style="text-align:left;">
Char (32)
</td>
</tr>
</tbody>
</table>
<p>The RL outputs are written to the “plot\csv\” folder. The following files are produced:</p>
<ul>
<li>_RLL_Q.csv - flow time-series;</li>
<li>_RLL_Qmx.csv - maximum flow information;</li>
<li>_RLP_H.csv – water level time series;</li>
<li>_RLP_Hmx.csv – maximum water level information;</li>
<li>_RLR_Vol.csv - volume time-series; and</li>
<li>_RLR_Volmx.csv - maximum volume information.</li>
</ul>
<p>As well as the maximum water level and flow information, the time that these occur, the water level at maximum flow and vice versa, and the maximum change between timesteps are also output to the mx.csv files.</p>
<p>The RLs are also output to the plot\gis PLOT GIS layers and can be viewed and their time-series data displayed using the TUFLOW Viewer using the QGIS TUFLOW Plugin as illustrated in Figure <a href="#fig:fig-RL-Example">106</a>.</p>
<p>An example model using reporting locations is available in the Example Models on the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Output_Options">TUFLOW Wiki</a>. In addition, see Section <a href="#View-PO-3"><strong>??</strong></a> for information on plotting of Reporting Location results.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-RL-Example"></span>
<img src="images/image145.jpeg" alt="**Example of the QGIS TUFLOW Plugin for a Reporting Location**" width="80%" />
<p class="caption">
Figure 106: <strong>Example of the QGIS TUFLOW Plugin for a Reporting Location</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="Structure-3"><span class="header-section-number">11.3.4</span> Structure Output<a href="#Structure-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Structure Reporting feature outputs time-series and summary data for single and grouped structures. 1D and 2D structures are all output together to give a complete set of results. The summary output at the flood peak also produces the flow split between below and above deck, along with other information such as the head drop. The structure output is particularly useful in the reporting of hydraulic structure flows and afflux.</p>
<p>Structures are classified according to the following logic:</p>
<p>1D Structures:</p>
<ul>
<li>1D structures that are in parallel (i.e. two structures that link to
the same upstream and downstream nodes) are automatically grouped
together and treated as a single structure for this output. The ID
assigned to the group is the structure with the lowest bed elevation.
Note that the directions of the digitised channels is important, that
is, to form a group all channels must be digitised in the same
direction.<br />
</li>
<li>For 1D structures that have no parallel 1D structures, these are also
included in the output so as to provide a complete set of results for
all 1D structures.<br />
</li>
<li>The flow split between below and above deck is based on the structure
geometry, except weirs contributing to the below deck flow and/or
above deck flow, depending on the configuration.</li>
</ul>
<p>2D and 1D/2D Structures:</p>
<ul>
<li>To create a structure output that includes 2D flow, and optionally any
1D structures, the “QS” PO line is digitised in a 2d_po layer (see
Section <a href="#PlotOutput-4"><strong>??</strong></a>). All 2D flow across this line and any 1D structures that intersect this line
are grouped together. The 1D structure’s 1d_nwk line does not have to
snap with the QS line; they only have to cross over each other. The ID
assigned to the structure output group is the 2d_po QS Label (see Table <a href="#tab:tab-PlotOutput">108</a>).<br />
</li>
<li>If the 2d_po QS line selects cell sides that are modified by the Layered
Flow Constriction or 2D Bridge feature, the summary output will split the flow into
a below and above “deck” component based on Layers 1 to 2 being below
“deck” and Layer 3 and 4 above.<br />
</li>
<li>2d_po HU and HD lines or points can be used to define the upstream and
downstream water levels of the structure. HU objects should be located
upstream of the structure and HD downstream. The average 2D water
level along a line object will be used to populate the upstream and
downstream water level data in the output. Lines can have more than
two vertices (i.e. polylines are accepted). To associate the HU and HD
objects with the QS line, all three (QS, HU and HD) must have the same
ID for the 2d_po Label attribute Label (see Table <a href="#tab:tab-PlotOutput">108</a>). If a QS line has no HU and/or HD
objects associated with it, output that cannot be produced, such as the
water level drop across the structure, is given a -99999 value in the
_SHmx.csv output file described below. HU and HD inputs are necessary
for 2d_lfcsh and 2d_bg bridges.</li>
</ul>
<p>An example model of the structure output for a bridge represented by a 2d_lfcsh is available in the Example Models on the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Output_Options">TUFLOW Wiki</a>.</p>
<p>The structure output is located in the plot/csv folder and includes:</p>
<ul>
<li>_SQ.csv file that contains time-series data of the flow through the
structure. This file is similar to other time-series .csv output, but
it only contains 1D and/or 2D structures as described above.<br />
</li>
<li>_SHmx.csv file that contains a summary of each structure when the
upstream water level reached its maximum. To generate this output the
flow and other information is tracked every timestep for grouped
structures. The output columns include: flow, area and average
velocity for below and above deck; total flow, area and average
velocity for the whole structure; upstream and downstream water
levels; the head drop across the structure (i.e. upstream minus
downstream water level); and the time these data were recorded (e.g. the
time the upstream water level peaked).<br />
</li>
<li>Time-series output for the upstream and downstream water levels are
available through the 1d_H.csv, 2d_HD.csv and 2d_HU.csv files. Note
that for the 2d_HD.csv and 2d_HU.csv files, if all 2D cells are dry a
-99999 is output.</li>
</ul>
<p>See Section <a href="#View-PO-3"><strong>??</strong></a> for further information on plotting of grouped structure results.</p>
<p>Two structure group check files are output if a model contains any structure groups (either
automatically created, or via a “QS” type line in a 2d_po layer). The check files are both .csv files as follows:</p>
<ul>
<li>&lt;simulation name&gt;_Str_Grp_All.csv, contains information for all
structure groups, including single 1D structures.<br />
</li>
<li>&lt;simulation name&gt;_Str_Grp_Multi.csv, contains information for
structure groups that are comprised of more than one 1D channel or are
generated from a 2d_po “QS” line.</li>
</ul>
<p>For more information on the structure group check files, please see the
<a href="https://wiki.tuflow.com/Check_Files_Str_Grp">Check File Page on the TUFLOW Wiki</a>.</p>
<h2 class="hasAnchor" id="Specialised-2"><span class="header-section-number">11.4</span> Specialised Outputs<a href="#Specialised-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Specialised outputs include:</p>
<ul>
<li>Receptors: records the flood level and time at one or more gauge(s) when the receptor is inundated above the specified trigger level, see Section <a href="#Receptors-3"><strong>??</strong></a>.</li>
<li>Evacuation Routes: provides additional information (e.g. first point of closure) along routes, see Section <a href="#EvaculationRoutes-3"><strong>??</strong></a>.</li>
</ul>
<h3 class="hasAnchor" id="Receptors-3"><span class="header-section-number">11.4.1</span> Receptors<a href="#Receptors-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="#tgcReadGISObjects">Read GIS Objects RECORD GAUGE DATA</a> records the
flood level and simulation time at one or more gauge(s) when receptors
are first inundated above their trigger inundation levels (e.g. floor
levels). <a href="#tgcReadGISReceptors">Read GIS Receptors</a> can be used as an
alias to <a href="#tgcReadGISObjects">Read GIS Objects</a>. Level output associates
a flood level at one or more gauges with the time of first inundation at
properties, buildings, or other areas of interest within the modelled
extent.</p>
<p>When the water level at the property reaches a user-defined
trigger inundation level, the gauge height and simulation time are
recorded and tagged to the receptor. This is particularly useful for
flood warning and forecasting studies where property specific
information on the likelihood of a property being inundated for a given
gauge height can be generated. An example of translating gauge data information to catchment receptors can be found in the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models">TUFLOW Wiki Example Models</a>.</p>
<p>Gauges are defined as a point within a 2d_po GIS layer with type “G_”
(see Section <a href="#TwoDTS-3"><strong>??</strong></a> and Table <a href="#tab:tab-PODataPLPL">107</a>). The levels from all gauges are recorded
at each receptor once inundated.</p>
<p>Receptors must be GIS point and/or polygon objects located in one or
more GIS layers nominally prefixed by 2d_obj or 2d_rec. Each object
within the layer represents a receptor, property or other object of
interest. For information on the attributes of the GIS layer see the
<a href="#tgcReadGISObjects">Read GIS Objects</a> .tgc command. The command also
includes options to set the Zpt elevations to the receptor level or the
first attribute in the layer (for example, to set the Zpts to the floor
level of the buildings), or to alternatively use the existing ZC
elevations.</p>
<p>Once simulated, a GIS layer is written to the location as specified
using the .tcf command <a href="#tcfOutputFolder">Output Folder</a>, and has a
_GDO extension standing for Gauge Data Output. The layer contains point
objects (for regions the centroid is used). The attribute data for the
layer are described in Table <a href="#tab:tab-GaugeDataOutput">111</a>. Figure <a href="#fig:fig-GaugeOutput">107</a> shows an example of how the output GIS layers may be used to illustrate the flooding of properties
in relation to the water level at a gauge.</p>
<p>As well as outputting the water levels at gauge objects (as described above), the water levels at all point reporting locations and flows for all line reporting locations are also recorded. The reporting locations can be 1D and/or 2D locations. See Section <a href="#ReportingLocation-3"><strong>??</strong></a> for a full description of the reporting location functionality. For example, flows past a gauge can be recorded, including combined flows from 1D channels and the 2D domain(s).</p>
<table>
<caption>
<span id="tab:tab-GaugeDataOutput">Table 111: </span><strong>2d_GDO_ Gauge Data Output Attributes</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Attribute
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
&lt;gauge_1&gt; </gauge_1>
</td>
<td style="text-align:left;">
The water level in metres or feet above datum at &lt;gauge_1&gt; (as defined in a 2d_po layer) when the water level first reaches the Trigger_Level at the property/building/object. </gauge_1>
</td>
</tr>
<tr>
<td style="text-align:left;">
&lt;gauge_n&gt;… </gauge_n>
</td>
<td style="text-align:left;">
If a second, third, fourth… gauge exists, the water level in metres above datum at each gauge.
</td>
</tr>
<tr>
<td style="text-align:left;">
Time
</td>
<td style="text-align:left;">
The simulation time in hours when the water level at the receptor first reaches the Trigger_Level.
</td>
</tr>
<tr>
<td style="text-align:left;">
Trigger_Level
</td>
<td style="text-align:left;">
The trigger inundation level at the receptor. The level will be either the first attribute in the GIS layer (typically either the ground level of the property or the floor level of a building), or the lowest ZC value within the property or building polygon if the “USE ZC” option is specified (i.e. <a href="#tgcReadGISObjects">Read GIS Objects USE ZC</a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
Use_ZC
</td>
<td style="text-align:left;">
“Y” if the ZC 2D cell elevation was used for the Trigger_Level; “N” if not.
</td>
</tr>
</tbody>
</table>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-GaugeOutput"></span>
<img src="images/image168.jpeg" alt="**Example Use of Gauge Data Output Layer**" width="60%" />
<p class="caption">
Figure 107: <strong>Example Use of Gauge Data Output Layer</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="EvaculationRoutes-3"><span class="header-section-number">11.4.2</span> Evacuation Routes<a href="#EvaculationRoutes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Evacuation routes can be specified to output information relating to:</p>
<ul>
<li>Evacuation route suitability;<br />
</li>
<li>Warning times;<br />
</li>
<li>Risks;<br />
</li>
<li>Degree of route inundation; and<br />
</li>
<li>Duration of inundation.</li>
</ul>
<p>The .tgc <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a> is used to
define the routes and, by default, also adjust the Zpt elevations along
the route using the standard Z Shape options. The 2d_zshr layer is the
same as a 2d_zsh layer, but with three additional attributes, as shown
in Table <a href="#tab:tab-ShapeRoute">112</a>. Note, if using the TUFLOW HPC SGS functionality (Section <a href="#SGS-3"><strong>??</strong></a>, the cells/faces selected by this command are assumed flat (e.g. the traditional sampling approach using a single cell centre/face elevation).</p>
<p>The commands <a href="#tcfSetRouteCutOffValues">Set Route Cut Off Values</a> and
<a href="#tcfSetRouteCutOffType">Set Route Cut Off Type</a> can be used in the .tcf
and/or .tgc files. If used in the .tcf file, this sets the default
values for the 2d_zshr Cut_Off_Type and Cut_Off_Values attributes if
these attributes are left blank. The default values can be changed
between different <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a>
commands in the .tgc file by repeat usage of the same commands.</p>
<p>The _RCP output layer is a layer of points showing where a route’s cut
off value(s) were first exceeded (e.g. first point of closure). The
layer contains the attributes as shown in Table <a href="#tab:tab-RCPOutput">113</a>.</p>
<p>The _RC.xmdf output file contains the Route Categories over time and is
written when adding RC to the .tcf command <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a>. This file can be used to view and
animate the route category values.</p>
<p>A range of evacuation route examples are available in the Example Models on the <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Output_Options">TUFLOW Wiki</a>.</p>
<table>
<caption>
<span id="tab:tab-ShapeRoute">Table 112: </span><strong>2D Z-Shape Route (2d_zshr) Attribute Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Z
</td>
<td style="text-align:left;">
Unless the BRIDGE Shape_Options is specified (see below), the Z Shape lines adjust the Zpts as described in Table <a href="#tab:tab-ZShapeAttribute">54</a> for the same attribute.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
dZ
</td>
<td style="text-align:left;">
Unless the BRIDGE Shape_Options is specified (see below), the Z Shape lines adjust the Zpts as described in Table <a href="#tab:tab-ZShapeAttribute">54</a> for the same attribute.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Shape_Width_or_dMax
</td>
<td style="text-align:left;">
Refer to the same attribute in Table <a href="#tab:tab-ZShapeAttribute">54</a>.
</td>
<td style="text-align:left;">
Float
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Shape_Options
</td>
<td style="text-align:left;">
<b>BRIDGE:</b> Does not use the Z attribute to adjust the Zpts, instead uses it to assign evacuation route categories. This allows for a Z Shape Route Line to cross a river without physically blocking it. Because a route can be comprised of more than one line (as long as each line is given the same Route_Name) they will all be regarded as being part of the same route. Therefore, to represent a bridge, split the route line either side of the bridge and give all three lines the same Route_Name, with the line representing the bridge or river crossing assigned a Shape_Options of “BRIDGE”.
</td>
<td style="text-align:left;">
Char(20)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Route_Name
</td>
<td style="text-align:left;">
Used to label the evacuation route. A route can be split into several lines if required, provided all the lines have the same Route_Name attribute. This can be useful where the route is more easily sourced or digitised as several lines, or if using the BRIDGE option described above.
</td>
<td style="text-align:left;">
Char(40)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Cut_Off_Type
</td>
<td style="text-align:left;">
<p>Options are as follows:</p>
<ul>
<li><b>Blank</b>: The value from the latest Set Route Cut Off Type command is applied at that point in the .tgc file.<br />
</li>
<li><b>Depth:</b> Depth is used to define the cut-off (default setting).<br />
</li>
<li><b>VxD, Z0</b> or<b> Hazard:</b> The velocity x depth hazard product is used.<br />
</li>
<li><b>V</b> or <b>Velocity:</b> The velocity is used.<br />
</li>
<li><b>Energy:</b> Energy depth is used. The energy-depth is calculated as:</li>
</ul>
<p><span class="math display">\[Energy Depth = d + \frac{V^2}{2g}\]</span></p>
More than one 2d_zshr layer may be used if different cut-off types are required.
</td>
<td style="text-align:left;">
Char(40)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
Cut_Off_Values
</td>
<td style="text-align:left;">
A comma delimited list of one or more values (e.g. depths) used to categorise the severity of the overtopping along the routes. For example, if “0.1, 0.3, 0.7” is specified for a depth Cut_Off_Type, then where the water depth exceeds 0.1 m, these sections of the route are assigned a Category 1; above 0.3 m deep Category 2; and above 0.7 m Category 3. The values must be in ascending order. Elsewhere the route is assigned Category 0 (i.e. no or less than Category 1 overtopping). The Route Categories are output over time in the _RC.dat file and summarised in the _RCP layer. Multiple cut-off values allow for the assessment of different risk levels (e.g. shallow depths would be acceptable for most vehicles and people to safely negotiate, while deeper depths would only be acceptable for higher set vehicles).
</td>
<td style="text-align:left;">
Char(80)
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-RCPOutput">Table 113: </span><strong>RCP Output (2d_zshr) Attribute Description</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Attribute
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Route_Name
</td>
<td style="text-align:left;">
The name of the route.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cut_Off_Value
</td>
<td style="text-align:left;">
The cut off value applied.
</td>
</tr>
<tr>
<td style="text-align:left;">
First_Cut_Off_Time
</td>
<td style="text-align:left;">
The simulation time in hours the Cut_Off_Value was first exceeded.
</td>
</tr>
<tr>
<td style="text-align:left;">
Last_Cut_Off_Time
</td>
<td style="text-align:left;">
The simulation time in hours when the Cut_Off_Value was last exceeded.
</td>
</tr>
<tr>
<td style="text-align:left;">
Duration_Cut_Off
</td>
<td style="text-align:left;">
The duration in hours that the Cut_Off_Value was exceeded – not necessarily the difference between the first and last cut off times if the route reopened during this time.
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="ChecksLogs-2"><span class="header-section-number">11.5</span> Check and Log Files<a href="#ChecksLogs-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The options to control check and log file outputs are discussed in Chapter <a href="#Checks-and-Logs-1"><strong>??</strong></a>, with common commands to control these outputs listed in Table <a href="#tab:tab-TUFLOWOutput">114</a>.</p>
<h2 class="hasAnchor" id="Commands-2"><span class="header-section-number">11.6</span> Output Control Commands<a href="#Commands-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- EFC
There's a lot going on in this section and it's quite hard to read since there are just so many tables in a row. I understand why it's been done this way and i'm not completely sure how to improve it, but here are some of my suggestions:
- Table labels should be simple so it's easy to quickly see what they are showing e.g. "Table 9.1 - Simulation Time Controls"
- Maybe a brief description paragraph before each table to introduce it, just so the tables are broken up by some text
- Put a list of tables with links at the start of the section so it's easy to see what is coming and also easy to find the correct table without having to scroll through them all
- Maybe the tables can be grouped by the sub-sections (in this section) and remain here, or moved into the subsections themselves?
- There's commands here that also aren't mentioned in the rest of this section (check files, log folders, restart files etc) - do the commands really belong here if they aren't mentioned at all in the rest of the sections?

Some other notes
- link each command to the corresponding appendix command
- maybe another column indicating which engines are supported (e.g. I'm pretty sure 'display water level' only works in classic) - or maybe just a note in the description text if most of them are supported in all engines.
-->
<!-- WJS agree with above. Some thoughts:
- Can we easily filter the Requirement and Category columns as this would help improve navigation and possibly allevaite the need to split up into separate sections.
- The Category column fields should be simplified and suggest Category be changed to "Output Type" and something like the following fields are used. And maybe make this column the third one. 
  "Map"
  "Check"
  "Grid"
  "Tabular"
  "Time-Series"
  "Console"
  "Log"
  "Mass Balance"
  "Tracking Max/Min"
  "Other"
  "Output Zones"
  "File Management" - this can also cover XF Files, Write Empty GIS Files 
  "Hazards" 
- Maybe for after going live, but more cross-referencing with other sections of the manual in the Description column could be nice.
-->
<!-- EFC: done-->
<!-- EFC - missing command - Spatial Database Output == Separate | {Grouped} -->
<!-- EFC: added-->
<p>A wide range and variety of commands allow the user to configure TUFLOW output to be different to the default settings. Table <a href="#tab:tab-TUFLOWOutput">114</a> lists these commands in different categories followed by a brief description.</p>
<!-- WJS Table below, should it be default sorted based on Command? I've made this change if in agreement -->
<table>
<caption>
<span id="tab:tab-TUFLOWOutput">Table 114: </span><strong>Commands used to Control TUFLOW Outputs</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Requirement
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mandatory
</td>
<td style="text-align:left;">
<a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a>, or <a href="#tcfMIProjection">MI Projection</a>
</td>
<td style="text-align:left;">
Define the projection for the output of GIS layers. Not all projection commands are mandatory, i.e. only specify projection settings for the formats required. Commands are:
<a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfMIProjection">MI Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a>, <a href="#tcfGISProjectionCheck">GIS Projection Check</a>, <a href="#tcfSHPProjectionCheckMethod">SHP Projection Check Method</a>, <a href="#tcfTIFProjection">TIF Projection</a>.
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Mandatory
</td>
<td style="text-align:left;">
<a href="#tcfMapOutputFormat">Map Output Format</a>
</td>
<td style="text-align:left;">
Specify one or more map output formats to be written.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Mandatory
</td>
<td style="text-align:left;">
<a href="#tcfMapOutputInterval">Map Output Interval</a>
</td>
<td style="text-align:left;">
Mandatory command that controls the frequency of map output. Alternatively, set this value to zero to only output maximums.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Mandatory
</td>
<td style="text-align:left;">
<a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a>
</td>
<td style="text-align:left;">
Mandatory command that controls the frequency of time-series output.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Recommended
</td>
<td style="text-align:left;">
<a href="#tcfWriteCheckFiles">Write Check Files</a>
</td>
<td style="text-align:left;">
Customise which check files/layers to output.
</td>
<td style="text-align:left;">
Check
</td>
</tr>
<tr>
<td style="text-align:left;">
Recommended
</td>
<td style="text-align:left;">
<a href="#tcfLogFolder">Log Folder</a>
</td>
<td style="text-align:left;">
Customise the location for the .tlf and other files.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Recommended
</td>
<td style="text-align:left;">
<a href="#tcfOutputFolder">Output Folder</a>
</td>
<td style="text-align:left;">
Customise the parent folder for the 2D based output files. If the command is place in the .ecf or <a href="@tcfStart1DDomain">1D Domain</a> controls the folder for the 1D based output files.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Recommended
</td>
<td style="text-align:left;">
<a href="#tcfGISFormat">GIS Format</a>
</td>
<td style="text-align:left;">
Controls the format for output GIS layers.
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Recommended
</td>
<td style="text-align:left;">
<a href="#tcfMapOutputDataTypes">Map Output Data Types</a>
</td>
<td style="text-align:left;">
Controls the map data types to be output. Default is just water level and velocity, but there are many more!
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#ecfPitChannelOffset">Pit Channel Offset</a>
</td>
<td style="text-align:left;">
Change the default distance that a pit and its results are displayed relative to the 1D node the pit flows into.
</td>
<td style="text-align:left;">
Check
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWriteX1DCheckFiles">Write X1D Check Files</a>
</td>
<td style="text-align:left;">
Set to ON to output additional check files for linked external 1D schemes.
</td>
<td style="text-align:left;">
Check
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMassBalanceOutput">Mass Balance Output</a>
</td>
<td style="text-align:left;">
Switch mass balance tracking and outputting on or off.
</td>
<td style="text-align:left;">
Console
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMassBalanceOutputInterval">Mass Balance Output Interval</a>
</td>
<td style="text-align:left;">
Set the time interval for outputting mass balance information.
</td>
<td style="text-align:left;">
Console
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a>
</td>
<td style="text-align:left;">
Controls how often information is displayed and written to the .tlf file whilst a simulation is underway.
</td>
<td style="text-align:left;">
Console
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfOutputDrive">Output Drive</a>
</td>
<td style="text-align:left;">
Override the drive letter for all output files.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfOutputFiles">Output Files</a>
</td>
<td style="text-align:left;">
Control which output files are to be written.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfSimulationsLogFolder">Simulations Log Folder</a>
</td>
<td style="text-align:left;">
Customise the location for logging simulations.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a>
</td>
<td style="text-align:left;">
Output empty GIS layers. Very useful command when setting up a new model.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWriteRestartFileatTime">Write Restart File at Time</a>
</td>
<td style="text-align:left;">
Controls how and when restart files are output.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWriteRestartFileInterval">Write Restart File Interval</a>
</td>
<td style="text-align:left;">
Sets the interval at which to write a restart file.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWriteRestartFileVersion">Write Restart File Version</a>
</td>
<td style="text-align:left;">
Controls the version of the restart file feature to output.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWriteRestartFilename">Write Restart Filename</a>
</td>
<td style="text-align:left;">
Controls the approach on whether to keep overwriting or give a unique name for each restart file.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfXFFiles">XF Files</a>
</td>
<td style="text-align:left;">
Global setting on whether or not to use and output XF files.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfXFFilesIncludeinFilename">XF Files Include in Filename</a>
</td>
<td style="text-align:left;">
Set a unique text to be included in XF filenames.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tgcReadGISObjects">Read GIS Objects</a>
</td>
<td style="text-align:left;">
Add gauge levels and other information to GIS receptor layer(s).
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tgcWriteGISDomain">Write GIS Domain</a>
</td>
<td style="text-align:left;">
Output a GIS layer of the 2D domains processed thus far in the .tgc file.
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tgcWriteGISZpt">Write GIS Zpts</a>
</td>
<td style="text-align:left;">
Output a GIS layer of the current 2D Zpts elevations at that point in the .tgc file.
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfSpatialDatabaseOutput">Spatial Database Output</a>
</td>
<td style="text-align:left;">
Sets how the outputs are written when using GeoPackages. The grouped (default) option will group outputs by folder location. For example all check file outputs will be contained within one database.
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfGridFormat">Grid Format</a>
</td>
<td style="text-align:left;">
Controls the format for output GIS grid layers.
</td>
<td style="text-align:left;">
Grid
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfGridOutputCellSize">Grid Output Cell Size</a>
</td>
<td style="text-align:left;">
Sets the cell size of output grids, including check grids. This can be different to the 2D cell size(s).
</td>
<td style="text-align:left;">
Grid
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfGridOutputOrigin">Grid Output Origin</a>
</td>
<td style="text-align:left;">
Change how the grid output origin is determined.
</td>
<td style="text-align:left;">
Grid
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tgcWriteGISGrid">Write GIS Grid</a>
</td>
<td style="text-align:left;">
Output a GIS layer of the current active 2D cells and their attributes at that point in the .tgc file.
</td>
<td style="text-align:left;">
Grid
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfUKHazardDebrisFactor">UK Hazard Debris Factor</a><br />
<a href="#tcfUKHazardFormula">UK Hazard Formula</a><br />
<a href="#tcfUKHazardLandUse">UK Hazard Land Use</a>
</td>
<td style="text-align:left;">
Change the default settings on how the UK flood hazard output is calculated.
</td>
<td style="text-align:left;">
Hazard
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfZPHazardCutoffDepth">ZP Hazard Cutoff Depth</a>
</td>
<td style="text-align:left;">
Change the cutoff depth for outputting People Hazard categories (ZPA, ZPC and ZPI).
</td>
<td style="text-align:left;">
Hazard
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfBSSCutoffDepth">BSS Cutoff Depth</a>
</td>
<td style="text-align:left;">
Change the default cutoff depth setting for bed shear stress output.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfEndMapOutput">End Map Output</a>
</td>
<td style="text-align:left;">
Change the end time for map output to be different to the simulation end time. Useful for output zones where a shorter output period is required.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMapCutoffDepth">Map Cutoff Depth</a>
</td>
<td style="text-align:left;">
Change the default cutoff depth for setting whether a 2D cell is wet or dry in the map output. Useful for direct rainfall modelling. Only used for map output, ie. it does not affect the hydraulic computations like Cell Wet/Dry Depth does.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMapOutputEntireModel">Map Output Entire Model</a>
</td>
<td style="text-align:left;">
Switch on or off the map output for the entire model. Useful if using output zones and map output for the whole model is not needed.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMaximumVelocityCutoffDepth">Maximum Velocity Cutoff Depth</a>
</td>
<td style="text-align:left;">
Change the default depth that the approach to tracking maximum velocities is changed.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfReadGISGLO">Read GIS GLO</a>
</td>
<td style="text-align:left;">
Change from regular time-based map output to map output produced at different water levels at a gauge. GLO stands for Gauge Level Output.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a><br />
<a href="#tcfReadGISX1DWLLPoints">Read GIS X1D WLL Points</a>
</td>
<td style="text-align:left;">
Change the ground elevations and materials at WLL points along WLLs.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<p><a href="#ecfReadGISWLL">Read GIS WLL</a></p>
<a href="#tcfReadGISX1DWLL">Read GIS X1D WLL</a>
</td>
<td style="text-align:left;">
Include the results from 1D elements in the map output using WLLs.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfStartMapOutput">Start Map Output</a>
</td>
<td style="text-align:left;">
Change the start of map output to be different to the simulation start time.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfTimeOutputCutoff">Time Output Cutoff</a>
</td>
<td style="text-align:left;">
Add time of exceedance and time of duration for one or more depth or hazard values to the map output data set.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMeshparts">Meshparts</a>
</td>
<td style="text-align:left;">
Adds flags to the .2dm file for use by some map output viewers such as SMS to control the display of different parts of a model.
</td>
<td style="text-align:left;">
Other
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfReveal1DNodes">Reveal 1D Nodes</a>
</td>
<td style="text-align:left;">
Add the hidden 1D nodes used in 2D/2D links to the 1D output.
</td>
<td style="text-align:left;">
Other
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfSetRouteCutOffType">Set Route Cut Off Type</a>
</td>
<td style="text-align:left;">
Controls the parameter to use when determining whether a route is closed. For example, depth or hazard.
</td>
<td style="text-align:left;">
Other
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfSetRouteCutOffValues">Set Route Cut Off Values</a>
</td>
<td style="text-align:left;">
Define one or more values for route closure categories.
</td>
<td style="text-align:left;">
Other
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfCSVTime">CSV Time</a>
</td>
<td style="text-align:left;">
Change the units of the time column.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfExcelStartDate">Excel Start Date</a>
</td>
<td style="text-align:left;">
Start the time column at a specific date for use in Excel.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#ecfOrderOutput">Order Output</a>
</td>
<td style="text-align:left;">
Controls whether 1D nodes and channels are output in alphanumeric order or in the order they are processed during input.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfReadGISLP">Read GIS LP</a>
</td>
<td style="text-align:left;">
Set up 2D longitudinal profile output.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfReadGISPO">Read GIS PO</a>
</td>
<td style="text-align:left;">
Set up 2D time-series output locations.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfReadGISReportingLocation">Read GIS Reporting Location</a>
</td>
<td style="text-align:left;">
Set up combined 1D and 2D time-series output locations.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfStartTimeSeriesOutput">Start Time Series Output</a>
</td>
<td style="text-align:left;">
Change the start of time-series output to be different to the simulation start time.
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfWritePOOnline">Write PO Online</a>
</td>
<td style="text-align:left;">
Write time-series output at each time map output is written (rather than just at the end of the simulation).
</td>
<td style="text-align:left;">
Time-Series
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMaximumsandMinimums">Maximums and Minimums</a>
</td>
<td style="text-align:left;">
Change the default setting on whether to track maximums and/or minimums.
</td>
<td style="text-align:left;">
Tracking Max/Min
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMaximumsandMinimumsOnlyforGrids">Maximums and Minimums Only for Grids</a>
</td>
<td style="text-align:left;">
Controls whether grid based map output is only written out as maximums, ie. switch on or off the grid temporal map output.
</td>
<td style="text-align:left;">
Tracking Max/Min
</td>
</tr>
<tr>
<td style="text-align:left;">
Optional
</td>
<td style="text-align:left;">
<a href="#tcfMaximumsandMinimumsTimeSeries">Maximums and Minimums Time Series</a>
</td>
<td style="text-align:left;">
Controls whether to track maximums for time-series outputs.
</td>
<td style="text-align:left;">
Tracking Max/Min
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfDisplayWaterLevel">Display Water Level</a>
</td>
<td style="text-align:left;">
Display a water level on the console window whilst running.
</td>
<td style="text-align:left;">
Console
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfForceFileIODisplay">Force File IO Display</a>
</td>
<td style="text-align:left;">
Show file opening information to the console window.
</td>
<td style="text-align:left;">
Console
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfVerbose">Verbose</a>
</td>
<td style="text-align:left;">
Controls how much information is displayed and written to the .tlf file.
</td>
<td style="text-align:left;">
Console
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfReadFile">Read File</a>
</td>
<td style="text-align:left;">
Insert a file into a control file.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfSetVariable">Set Variable</a>
</td>
<td style="text-align:left;">
Define user variables for use within the control files. Useful for setting output folder names based on a scenario.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfTSFUpdateInterval">TSF Update Interval</a>
</td>
<td style="text-align:left;">
Change when and how often the .tsf file is to be updated.
</td>
<td style="text-align:left;">
File Management
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfCalibrationPointsMIFile">Calibration Points GIS File</a>
</td>
<td style="text-align:left;">
Add the maximum water levels to a GIS layer of calibration or gauge points.
</td>
<td style="text-align:left;">
GIS
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfMapOutputCornerInterpolation">Map Output Corner Interpolation</a>
</td>
<td style="text-align:left;">
Apply different approaches to interpolating results to 2D cell corners. Primarily provided for backward compatibility for legacy models.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#ecfWLLpInterpolateBed">WLLp Interpolate Bed</a>
</td>
<td style="text-align:left;">
Change how the bed level along a WLL is assigned.
</td>
<td style="text-align:left;">
Map
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfDefineOutputZone">Define Output Zone</a><br />
…<br />
<a href="#tcfEndDefine">End Define</a>
</td>
<td style="text-align:left;">
Set up a definition block of commands for an output zone.
</td>
<td style="text-align:left;">
Output Zones
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfModelOutputZones">Model Output Zones</a>
</td>
<td style="text-align:left;">
Controls which output zones are output.
</td>
<td style="text-align:left;">
Output Zones
</td>
</tr>
<tr>
<td style="text-align:left;">
Advanced
</td>
<td style="text-align:left;">
<a href="#tcfReadGISOutputZone">Read GIS Output Zone</a>
</td>
<td style="text-align:left;">
Defines the region for the output zone.
</td>
<td style="text-align:left;">
Output Zones
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Hardware-1"><span class="header-section-number">12</span> Hardware and Operating System<a href="#Hardware-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="HardwareIntro-2"><span class="header-section-number">12.1</span> Introduction<a href="#HardwareIntro-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter provides information and guidance that aims to help users choose computer hardware that will suit their modelling needs. TUFLOW Classic and HPC utilise distinctly different solution schemes, and likewise have different requirements with regard to the choice of computer hardware. Descriptions for a number of hardware related commands and options that are specific to HPC are provided in Section <a href="#HardwareCommands-2"><strong>??</strong></a>.</p>
<p>Additional material on performance/benchmarking and hardware selection advice can be found on the TUFLOW Wiki:</p>
<ul>
<li><a href="https://wiki.tuflow.com/Hardware_Benchmarking_(2018-03-AA)">Hardware Speed Benchmarking</a></li>
<li><a href="https://wiki.tuflow.com/Hardware_Selection_Advice">Hardware Selection Advice</a></li>
</ul>
<h2 class="hasAnchor" id="OperatingSystems-2"><span class="header-section-number">12.2</span> Operating Systems<a href="#OperatingSystems-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW Classic and HPC are only available as 64-bit binaries for 64-bit Microsoft Windows operating systems. Unix/Linux and Mac operating systems are not currently supported. While TUFLOW Classic and HPC may run on older versions of Windows, support is only available for Windows 10 and later, and Windows Server 2016 and later.</p>
<h2 class="hasAnchor" id="TUFLOWClassic-2"><span class="header-section-number">12.3</span> TUFLOW Classic<a href="#TUFLOWClassic-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW Classic uses the ADI (alternating direction implicit <span class="citation">(<a href="#ref-Stelling1984">Stelling, 1984</a>)</span>) finite difference scheme that has been further refined by <span class="citation">Syme (<a href="#ref-Syme1991">1991</a>)</span>. For further details on the TUFLOW Classic solution scheme refer to Section <a href="#TUFLOW-CLA-3"><strong>??</strong></a>. It is a highly efficient scheme, but is difficult to parallelise to use multiple threads. As such it runs on a single core of the main CPU (central processing unit). General hardware advice for TUFLOW Classic is summarised below:</p>
<ul>
<li>As all modern CPUs have multiple cores, it is possible to run more than one
model at a time on the computer, provided the user has access to sufficient licences.</li>
<li>If running only one model at a time, the primary factor for model speed is the
single core computational capability of the CPU. Generally this is mostly
driven by the CPU clock speed - a CPU with fewer cores but a higher clock
speed will likely provide better performance than one with many cores and a
lower clock speed. CPU type and architecture do also play a role in single core
performance. For more information refer to the subsection on performance
proxies. When running models with Classic, having a dual socket mainboard
will be of little benefit if running just one model at a time. Dual socket mainboards are capable of holding two CPUs, doubling the total number of CPU cores available (e.g. 2 x 16 core CPUs), these are primarily found in server setups.</li>
<li>If running multiple models simultaneously, the memory bandwidth between CPUs
and the mainboard RAM is quite important, in which case a dual CPU mainboard will
usually offer better performance than a single CPU mainboard. Further, running multiple
models simultaneously will also require increased CPU RAM, which again typically
favours a dual CPU mainboard.</li>
<li>The mainboard memory required for a particular model will vary significantly
due to a number of factors related to model setup. In general the memory required
will scale proportionally with number of model cells.</li>
<li>There is no requirement for a particular GPU (Graphics Processing Unit) to be
installed. However, having a medium quality GPU installed may assist with
graphics rendering in any GIS software being used for visualising model inputs
and outputs.</li>
<li>The amount of CPU RAM will determine the size of the model that can be run or a number of models that can be run at one time. Faster RAM will result in quicker runtimes, however this is usually a secondary consideration to chip speed, cache size and architecture.</li>
</ul>
<h2 class="hasAnchor" id="TUFLOWHPC-2"><span class="header-section-number">12.4</span> TUFLOW HPC (Including Quadtree)<a href="#TUFLOWHPC-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW HPC uses an explicit finite volume scheme which is parallelised to
utilise multiple CPU cores, or equally the thousands of cores available on GPUs.
The explicit finite volume scheme is not as
computationally efficient as the ADI finite difference scheme used in
TUFLOW Classic. However, because it can be parallelised, <a href="https://wiki.tuflow.com/Hardware_Benchmarking_Topic_HPC_on_CPU_vs_GPU">benchmarking</a> has found
that using the HPC solution scheme on a modern GPU can run a typical model
anywhere from 10 to 100 times faster than using the Classic scheme on a single
core of a modern CPU. For further details on the TUFLOW HPC solution scheme refer to Section <a href="#TUFLOW-HPC-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="HPC-CPU-3"><span class="header-section-number">12.4.1</span> TUFLOW HPC Solver on CPU<a href="#HPC-CPU-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC can be run using multiple CPU cores of a single or dual
CPU mainboard, in which case it may offer solution times that are comparable with
TUFLOW Classic on a single CPU core. However, most users prefer to utilise the performance of GPU compute, refer to Section <a href="#HPC-GPU-3"><strong>??</strong></a>. Note that compute using GPU does require a GPU module licence, refer to Section <a href="#AddonModules-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="HPC-GPU-3"><span class="header-section-number">12.4.2</span> TUFLOW HPC Solver on GPU<a href="#HPC-GPU-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC uses the CUDA API that NVIDIA makes available for their GPUs, and
therefore only NVIDIA GPUs are supported. The GPU is a physically separate device
that is connected to the mainboard at a PCI slot. It has its own separate memory
which has to be sufficient to hold the working data for the model solution
process, and draws power from the main power supply unit through its own supply
cables. The computer’s power supply unit must be capable of supplying the
mainboard (with the CPUs) and the GPUs attached to the mainboard. The power draw
of the GPUs and the cooling requirements of the whole system can become a
constraining issue with regard to the overall system design.</p>
<p>Note that due to the use of NVIDIA CUDA API, AMD GPU are not supported.</p>
<h3 class="hasAnchor" id="GPUTypes-3"><span class="header-section-number">12.4.3</span> Types of GPU<a href="#GPUTypes-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In general, the price and performance of a GPU are related to the size of its
memory, the number of compute cores, and importantly the internal architecture
of the GPU. In this regard, the NVIDIA GPUs fall into two broad categories:</p>
<ol style="list-style-type: decimal">
<li><strong>Gaming GPUs</strong>. These usually offer excellent computational performance, but are
often physically large and have high power draw. This means that it is often
difficult to have more than two attached to a mainboard. Despite these
drawbacks, installing gaming GPUs often provides the best overall performance
relative to price for TUFLOW modelling.</li>
<li><strong>Scientific GPUs</strong>. The top-line scientific GPUs can offer superior computational
performance to the top-line gaming GPUs, also offer more GPU memory, and are
usually physically smaller in size with lower power draw. So it is
more feasible to have four or more attached to a mainboard. However, they are
significantly more expensive - sometimes an order of magnitude more expensive
than even best gaming GPUs.</li>
</ol>
<h3 class="hasAnchor" id="MultipleGPUs-3"><span class="header-section-number">12.4.4</span> Utilising Multiple GPUs for One Model<a href="#MultipleGPUs-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC (including Quadtree) can utilise multiple GPUs (that are all
connected to the same mainboard) to compute a single simulation. For larger models
(typically more than 5,000,000 2D cells), useful reductions in solve times
can be achieved with multiple GPUs. For smaller models (typically less than
100,000 cells), the solve time may actually increase when run across multiple
GPUs due to the device to device communication latency.</p>
<p>Multiple GPU may be used to run very large models that require more GPU memory than available on a single GPU device.</p>
<h3 class="hasAnchor" id="MultipleModelsoneGPU-3"><span class="header-section-number">12.4.5</span> Running Multiple Models on a Single GPU<a href="#MultipleModelsoneGPU-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is also possible to run multiple TUFLOW HPC simulations on a single GPU card provided
it has sufficient memory to accommodate both simulations. Both of the models will, however, solve more slowly
as the GPU compute resources are shared between the models. Occasionally it has
been noted that the amount of time taken for two models to complete when running
simultaneously can be less than the sum of times when the models are
run sequentially.</p>
<h3 class="hasAnchor" id="differences-in-results-between-cpu-and-gpu"><span class="header-section-number">12.4.6</span> Differences in results between CPU and GPU<a href="#differences-in-results-between-cpu-and-gpu" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW Classic uses a very different solution scheme to TUFLOW HPC, and there will be some differences between these solutions.
However what we are discussing here is running the HPC solver on CPU, and then also on GPU, and comparing the difference. TUFLOW HPC has
been written to utilise one source code, that with the use of macros can be compiled for CPU execution or for GPU execution
without duplication of code. So the lines of code are the same, but the compilers are different, and the physical hardware that executes
the binary instructions is different. In particular, the number of bits used for floating point representation within the CPU cores
and GPU cores can differ, though both meet the minimum IEEE standards for single (or double) precision. The math libraries for computing square-roots
and logarithms are not absolutely identical. These differences produce very subtle differences in depth calculations. The differences are very, very, small -
maybe at the 7th decimal place for single precision calculations, but when an embankment is being over-topped by just a little bit, then a 0.0001% difference in depth
can become a 0.1% difference in over-topping flux, leading to what appear to be larger relative differences in depth at shallow locations. Such differences can become as large as a few mm or even cm. These differences are certainly much smaller than the uncertainties involved in flood modelling, and much smaller than the differences
that will arise from running the same model at a different resolution, or (to the extent possible) in a different software. It is important for all modellers
to understand what constitutes real differences in results vs what is “numerical noise”.</p>
<h3 class="hasAnchor" id="HPCRAM-3"><span class="header-section-number">12.4.7</span> RAM<a href="#HPCRAM-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RAM is the computer memory required to store all of the model data used during the computation. A computer has CPU RAM, which is located on the motherboard and accessed from the CPU, and it has GPU RAM, which is located on the GPU device and accessed from the GPU. The two memory storage systems are physically separate. Both are required for TUFLOW HPC simulations (when using GPU for the compute) The amount of GPU RAM is one of two factors that will determine the size of the model that can be run (the other being CPU RAM). As a general rule, approximately 5 million 2D cells can be simulated per gigabyte (GB) of GPU RAM depending on the model features (e.g. a model with infiltration requires more memory due to the extra variables needed for the infiltration calculation).</p>
<p>TUFLOW HPC on GPU hardware still uses the CPU to compute and store data (in CPU RAM) during model initialisation and for all 1D calculations. During initialisation and simulation a model will typically require 4-6 times the amount of CPU RAM relative to GPU RAM. As an example, a model that utilises 11GB of GPU RAM (typical memory for high-end gaming card, and corresponds to about a 50 million cell model) the CPU RAM required during initialisation will typically be in range 44GB to 66GB.</p>
<h2 class="hasAnchor" id="ProxiesforCPUandGPU-2"><span class="header-section-number">12.5</span> Proxies for CPU and GPU performance<a href="#ProxiesforCPUandGPU-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When choosing hardware for running engineering software, it is important
to consider performance for price, including an allowance for the cost of the
software licencing. With licencing costs included, this often favours choosing
recent high performance hardware. Prices for hardware can be well known in
advance, but knowing what performance will be achieved on particular hardware,
for a specific software, can be difficult.</p>
<p>TUFLOW publishes computational performance results for a benchmark
2D hydraulic model - refer to the links in Section <a href="#HardwareIntro-2"><strong>??</strong></a>. For other hardware that is not listed on these pages, the TUFLOW development
team has found that some published 3rd party hardware benchmarks offer a
relative performance comparison that appears to be consistent with our own
performance measurements. These may be found at:</p>
<p><a href="https://www.videocardbenchmark.net/" class="uri">https://www.videocardbenchmark.net/</a></p>
<p>At this site there is a “High End Video Card Chart”. The scores for each GPU
are calculated from a number of different tests, mostly to do with graphics
performance. There is also a “GPU Compute Video Card Chart”, but interestingly
we have found the former chart to be a better proxy for how well a GPU will run
a TUFLOW HPC model. This site also has excellent CPU charts for multi-core and single-core performance.</p>
<h2 class="hasAnchor" id="Virtualisation-2"><span class="header-section-number">12.6</span> Virtualisation<a href="#Virtualisation-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is possible to share high-performance compute resources amongst multiple users
simultaneously by running virtual desktops on a machine that users connect to
remotely. There are many reasons why IT professionals favour this
solution for sharing expensive resources. However, the important question that
must be asked in advance is: how will the GPU(s) be shared between users?
Unless the Virtual Desktop Infrastructure (VDI) environment is implemented correctly, users may experience
erratic model start up and solve times. There are different sharing mechanisms
possible depending on the type of GPU and the choice of operating system.
Some key points are:</p>
<ul>
<li>Solving the 2D Shallow Water Equations is a computationally intensive task.
TUFLOW HPC is a well-optimised engine that will efficiently utilise all of a GPU’s
compute resources for hours, sometimes days depending on the size of the
model. For optimum performance, it is generally safest to only allow one
HPC compute job per GPU device.</li>
<li>In a VDI environment for modellers, where resources are typically pooled and
assigned dynamically, GPU resources should instead be assigned as isolated and
independent resources, dedicated to a user session.</li>
<li>When opting for large NVIDIA GPUs, choosing a GPU model and a hypervisor that support Multi Instance GPU is recommended. Otherwise, select multiple smaller GPUs that can be exclusively assigned to individual user sessions.</li>
</ul>
<h2 class="hasAnchor" id="CloudCompute-2"><span class="header-section-number">12.7</span> Cloud Compute<a href="#CloudCompute-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Organisations may host their TUFLOW network licences on the cloud and run simulations on cloud virtual machines. There are numerous ways both, licencing and simulation can be configured in a cloud environment, depending on the cloud provider (Microsoft, Google, Amazon, other etc.) and internal company protocols. Configuration of your cloud environment is your own responsibility. The <a href="https://wiki.tuflow.com/Organisation_Cloud_Software_Execution">Cloud Execution</a> page of the TUFLOW Wiki provides guidance on this subject.</p>
<h2 class="hasAnchor" id="HardwareCommands-2"><span class="header-section-number">12.8</span> Commands<a href="#HardwareCommands-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following commands, all optional, are available for the HPC solution scheme (<tcmd><a href="#tcfSolutionScheme">Solution Scheme</a></tcmd><teq> == </teq><tblk>HPC</tblk>).</p>
<hr />
<p><tcmd><a href="#tcfHardware">Hardware</a></tcmd><teq> == </teq><tblk>GPU | {CPU}</tblk></p>
<p>If an NVIDIA GPU is available, then this may be selected using the Hardware
command. If GPU hardware is specified, but the system cannot find an NVIDIA
GPU, then <a href="https://wiki.tuflow.com/TUFLOW_Message_3005">ERROR 3005</a> will result. The memory required for the TUFLOW model will be
compared against the free memory available on the GPU. If the available
memory is insufficient to run the model <a href="https://wiki.tuflow.com/TUFLOW_Message_3017">ERROR 3017</a> will result. For models
that only just fit within the available device memory by a small margin, it
is possible that a memory allocation will fail due to being unable to find
the required memory as a contiguous block, in which case <a href="https://wiki.tuflow.com/TUFLOW_Message_3018">ERROR 3018</a> will be
reported during model initialisation.</p>
<hr />
<p><tcmd><a href="#tcfHPCDPCheck">HPC DP Check</a></tcmd><teq> == </teq><tblk>OFF | {ERROR}</tblk></p>
<p>The default setting of “ERROR”, causes TUFLOW to stop with <a href="https://wiki.tuflow.com/TUFLOW_Message_2420">ERROR 2420</a> (advising
that it is recommended to use the single precision binary) if the HPC solution
scheme is selected when running the double precision binary. Due to its explicit
finite volume formulation and being depth based, the HPC 2D scheme does not generally
require to be run in double precision (DP) mode. There can also be substantial
speed gains using single precision (SP) on some GPU cards, and there is
significantly less memory footprint. However, 1D-2D linked models that also use
the ESTRY 1D engine may still require double precision in situations where the
model is at higher elevations. Accordingly it is still possible to run the HPC
solution scheme in double precision by explicitly setting <a href="#tcfHPCDPCheck">HPC DP Check</a> to “OFF”.</p>
<hr />
<p><tcmd><a href="#tcfGPUDeviceIDs">GPU Device IDs</a></tcmd><teq> == </teq><tblk>&lt;list_of_device_ids&gt;</tblk></p>
<p>For computers with more than one GPU, the NVIDIA GPU driver will search all
connected GPUs, and compile an enumerated list of NVIDIA GPUs. This list will
range from 0 to n-1, where n is the number of attached NVIDIA GPUs. This
command may be used to:</p>
<ul>
<li>Run a model on a particular GPU, e.g. “<tcmd><a href="#tcfGPUDeviceIDs">GPU Device IDs</a></tcmd><teq> == </teq><tblk>1</tblk>” will run the model
on the second NVidia GPU in the list of available NVIDIA GPUs.</li>
<li>Distribute a model over two or more GPUs, e.g. “<tcmd><a href="#tcfGPUDeviceIDs">GPU Device IDs</a></tcmd><teq> == </teq><tblk>0 1</tblk>” will run the model spread over the first two NVIDIA GPUs in the list. Note that the
GPUs do not have to be consecutive and the device IDs can appear in any order.<br />
</li>
<li>If you only have one GPU device, or you wish to use the primary device, this command is not needed.</li>
</ul>
<p>If desired, the selection of GPU Device IDs can be specified on the command line
when running the executable:</p>
<ul>
<li>To select a specific GPU, specify “-puN” where N is the device ID.</li>
<li>To select mutliple GPUs for a distributed run, supply a “-puN” argument for each
device ID required, for example -pu0 -pu1.</li>
<li>The “-pu” arguments will automatically override any GPU Device IDs specified
in the tcf.</li>
</ul>
<p>Also note:</p>
<ul>
<li>If the list of device IDs is longer than the number of available
devices, then the list will be truncated to the number of available devices
and <a href="https://wiki.tuflow.com/TUFLOW_Message_2784">WARNING 2784</a> issued.</li>
<li>If a device ID is specified that is outside of the range 0…n-1 then
<a href="https://wiki.tuflow.com/TUFLOW_Message_3005">ERROR 3005</a> will result.</li>
<li>If a device ID is specified that already has a model running on it, then
the requested GPU will be loaded up with the additional model, which will
cause both the existing model and the new model to solve more slowly.</li>
<li>A GPU module licence is required for each GPU.</li>
<li>A CPU thread is created for managing the compute stream for each GPU device.</li>
<li>Available memory checks are performed on all GPUs in the list.</li>
<li>If Hardware target is CPU then this command is ignored.</li>
</ul>
<hr />
<p><tcmd><a href="#tcfCPUThreads">CPU Threads</a></tcmd><teq> == </teq><tblk>{4} | &lt;number_of_threads&gt;</tblk></p>
<p>These two commands are identical and control the number of CPU threads used by
HPC (including Quadtree) when solving on CPU instead of GPU. For example,
“CPU Threads == 6” runs the HPC 2D solver across 6 CPU cores. The number of
threads may also be specified as a command line argument -nt[number_of_threads].
Using the command line argument will override any definition in the tcf file.</p>
<p>Notes:</p>
<ul>
<li>TUFLOW licences have 4 times the number of TUFLOW engine licences available
as HPC “thread” licences. For example a local or network 4 licence has 16 thread
licences available.</li>
<li>The default number of threads that HPC will use for the CPU solver run is 4.</li>
<li>The maximum number of threads possible is the lesser of the maximum number
of cores available on the machine and the number of available TUFLOW thread
licences.</li>
<li>Pre-processing of SGS elevations can be computationally intensive, as can
the compression of TIF output files. If the number of threads has not
been specified then the number of threads used for these tasks will default to
the maximum number of cores available without requiring any additional thread
licences.</li>
</ul>
<hr />
<p><tcmd><a href="#tcfHPCDeviceSplit">HPC Device Split</a></tcmd><teq> == </teq><tblk>&lt;list_of_device_load_factors&gt;</tblk></p>
<p>When a model is spread over two or more GPUs (or CPU threads), the model is
partitioned into vertical ribbons and each device solves its own ribbon, with
boundary data synchronised between the devices at each timestep. By default
the ribbons are of equal width. However, the computational
burden for each GPU is rarely uniform due to each ribbon
having a different active cell or wet cell count. This command will vary the ribbon sizes in
accordance with the load factors in the list, and therefore can improve overall
solution time for unbalanced models. Also, for models that require nearly all
of the available GPU memory on systems with GPUs of different memory, this
command can be used to apportion ribbon sizes accordingly. Additional notes:</p>
<ul>
<li>Load factors are mapped respectively to the devices in the same order in
which they appear in the list of device IDs.</li>
<li>Load factors are normalised after reading, if required, so their
average is one.</li>
<li>Upon completion of the model, TUFLOW will report the approximate computational
load split across the devices, and offer a suggested list of load factors that
may improve the workload balance.</li>
<li>When running on CPU, this command adjusts the ribbon size for each thread.</li>
<li>For a Quadtree model, the decomposition is not performed in ribbons, instead
the list of cells is partitioned.</li>
</ul>
<hr />
<p><tcmd><a href="#tcfGPUPeertoPeerAccess">GPU Peer to Peer Access</a></tcmd><teq> == </teq><tblk>DISABLED | {ENABLED IF AVAILABLE}</tblk></p>
<p>Some models of NVIDIA GPUs allow for a direct communications link between them,
either via a specific hardware connector or via the PCI bus controller. This is
known as ‘peer to peer’ access. TUFLOW HPC will by default enable peer to peer
access if the driver reports that it is available. This command may be used to
specifically disable peer to peer communications if desired.</p>
<hr />
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Running-Simulations-1"><span class="header-section-number">13</span> Managing and Starting Simulations<a href="#Running-Simulations-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="RunningSimulationsIntro-2"><span class="header-section-number">13.1</span> Introduction<a href="#RunningSimulationsIntro-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter provides guidance on model naming conventions
and how TUFLOW’s powerful Variables, Events and Scenarios functionalities may be used to
simulate any number of scenarios and events from a single control (.tcf) file.</p>
<p>The latter part of the chapter discusses the installation of TUFLOW, the
different TUFLOW dongle types and how to start a simulation, both as a standalone TUFLOW simulation and in conjunction with third-party software.</p>
<p>Finally, there is a section on the reproducibility of results when using different hardware.</p>
<h2 class="hasAnchor" id="FileNaming-2"><span class="header-section-number">13.2</span> File Naming<a href="#FileNaming-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Each hydraulic modelling study can easily generate hundreds, if not thousands, of model
input files in addition to a large number of check and result files.
Devising a sound naming convention as part of the modelling process is
key to modelling that is easily interpreted, logical, efficient, quick to
error check and quality control, and provide traceability for quality assurance.</p>
<p>The examples below are presented as guidance only. They demonstrate the
progression of a simple model naming convention to a more complex
version that incorporates different flood events and scenarios. The
examples focus on the name of the .tcf control file, as this
determines the prefix assigned to both the 1D and 2D check and result
files.</p>
<p><em>Tip: A general recommendation is to avoid long filenames and use acronyms where
possible. For example, for a simulation of the Brisbane River for the existing topography for the 1 in 100, 12 hour duration flood event, “BR_Exg_100yr_12hr_001.tcf” is preferable to “Brisbane_River_Existing_100year_12hour_001.tcf”.</em></p>
<p><strong>Example 1: Basic</strong></p>
<p><em>MODEL_001.tcf</em></p>
<p>In its simplest form, the names of the majority of TUFLOW models consist
of a few characters denoting the study name and a version number. The
characters denoting the study name are typically included in all input
files to specify that the files are unique or created for this study.
The numbering is used to denote different versions of the model, where
each time a change is made and the model re-simulated, the version
number is incremented. Use of a model version numbering system ensures
it is clear which model input files generated which model output files.
This is particularly important when troubleshooting or quality controlling a model.</p>
<p><strong>Example 2: Event Naming</strong></p>
<p><em>MODEL_0100F_001.tcf</em></p>
<p><em>MODEL_1000F_001.tcf</em></p>
<p>Most hydraulic modelling studies require the simulation of more than one
event. In these cases, it is preferable to include the name of the
event within the simulation name rather than simply incrementing the
model version number. Note that the same number of characters is
retained for the 100-year (0100F) and 1000-year (1000F) events and, in this case, the use of ‘F’ to
denote the simulation is a fluvial flood event. Retaining the same number of characters (for example, by using preceding zeroes) ensures when the files are viewed in Windows Explorer, they are
presented in ascending order. The model version number is the same in
this example and tells the user that the same version of the model has
been simulated for two different flood events.</p>
<p>Refer to Section <a href="#Events-3"><strong>??</strong></a> which presents a method to model numerous
hydraulic events using a single .tcf control file.</p>
<p><strong>Example 3: Scenario Naming</strong></p>
<p><em>MODEL_0100F_EXG_001.tcf</em></p>
<p><em>MODEL_0100F_PRP_001.tcf</em></p>
<p>Many hydraulic modelling studies require the simulation of multiple
scenarios, such as pre- and post-development topography scenarios or sensitivity
testing where one or more model parameters are varied. Incorporating the
name of the modelled scenario into the .tcf filename easily differentiates the
output files associated with each scenario. The characters used to
denote the scenario are typically also used for model input files
specific to the scenario. For example, the post-development scenario
‘PRP’ may involve the raising of flood defences, hence the GIS layer used to raise the defences
might be named ‘2d_zsh_MODEL_PRP_defence_001.shp’. The presence of this
layer in a model simulation of the pre-development scenario ‘EXG’, will
immediately highlight to the user that a mistake has been made.</p>
<p>Refer to Section <a href="#Scenarios-3"><strong>??</strong></a> which presents a method to model one or
more scenarios using a single .tcf control file.</p>
<h2 class="hasAnchor" id="SimulationManagement-2"><span class="header-section-number">13.3</span> Simulation Management<a href="#SimulationManagement-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW incorporates powerful functionality to manage the simulation of
multiple events and multiple scenarios. The flexibility offered allows
the user the ability to initiate all simulations using the one .tcf file should they so desire. Rather than create a new .tcf file for every simulation
and a new .tgc and/or .ecf file for every different model scenario, it
is possible to just have one of each of these files, or at least
markedly reduce the number of these files. An example application using a single set of control files to simulate 328,986 combinations of different model domains, events and scenarios is published in the <a href="https://www.tuflow.com/insights/2021_12-scenarios-events-and-variables/">TUFLOW Insights Library</a>.</p>
Numerous tutorial examples (with associated data downloads) are available which demonstrate these powerful features:
<ol>
<li>
<a href="https://www.tuflow.com/training/training-catalogue/tt105e-bulk-simulation-management-scenarios-user-defined-variables-and-events-elearning/">eLearning - Bulk Simulation Management Scenarios, Events and Variables</a>
<li>
<a href="https://wiki.tuflow.com/Tutorial_M08">TUFLOW Wiki Tutorial 8 - Scenario Management</a>
<li>
<a href="https://wiki.tuflow.com/Tutorial_M09">TUFLOW Wiki Tutorial 9 - Event Management</a>
<li>
<a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Bulk_Simulation_Management">TUFLOW Wiki Example Models - Scenarios, Events and Variables</a>
</ol>
<p>The following sections of the manual discuss the available options.</p>
<h3 class="hasAnchor" id="Events-3"><span class="header-section-number">13.3.1</span> Events<a href="#Events-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most hydraulic modelling studies require the simulation of different
probabilistic events. For example, a flood study may have to consider the
2, 5, 10, 20, 50, 100, 200 and 500 year Average Recurrence Interval
events, and one or two extreme floods. Each, or most of these, may have to
be simulated using a range of different duration rainfalls. A downstream
boundary such as the ocean may also need to be varied to model different
probability storm tides or climate change scenarios. The final number of
simulations can easily be in the hundreds, if not thousands.</p>
<p>The ability to simulate
multiple events using a single .tcf control file not only makes
management of the model easier, it also ensures consistency between the
simulations and supports better project quality control.</p>
<p>Multiple events are set up through the creation of a TUFLOW Event File
(recommended extension .tef) containing .tcf and .ecf commands that are
particular to a specific event. The event specific commands are
contained between <a href="#tefDefineEvent">Define Event</a> and <a href="#tefEndDefine">End
Define</a> commands. Global .tcf and .ecf commands can also
be used by placing these commands outside the <a href="#tefDefineEvent">Define
Event</a> blocks (normally at the top). The .tef file is referenced in the .tcf file using the <a href="#tcfEventFile">Event File</a> command. The TUFLOW Event File is typically the last line in a .tcf file. Placing it in this location ensures it will be the final .tcf command that is read, and any global .tcf and .ecf commands within it will take precedence over conflicting commands in the parent .tcf and .ecf files.</p>
<p>Up to nine (9) different event groups can be
specified for a single simulation. Unlimited events can be defined within an event group. Example event groups and associated events could be:</p>
<ul>
<li>Flood event magnitude: 2, 5, 10, 20, 50, 100, 200 and 500 year Average Recurrence Interval storms.</li>
<li>Storm Duration: 1hr, 2hr, 3hr, 4hr, 6hr, 9hr, 12hr etc.</li>
<li>Design event temporal pattern: TP01, TP02, TP03, TP04, TP05, TP06, TP07, TP08, TP09, TP10.<br />
</li>
<li>Downstream boundary condition: LAT, HAT, 5 year, 10 year.</li>
<li>Climate change time horizon: 2025, 2050, 2100.</li>
</ul>
<p>Since the .tef file typically lists all available event options, the file can be viewed as a database of all available event possibilities. This is useful for model peer review purposes.</p>
<p>To automatically insert the event name(s) into the output filenames, making them unique, place “~e~” or “~e&lt;X&gt;~” (where &lt;X&gt; is from 1 to 9) into the .tcf filename.<br>
<em>Note ~e~ is effectively the same as ~e1~ and is typically used if there is only one event type being varied.</em></p>
<p>For example,</p>
<p>MODEL_~e1~_~e2~_EXG_001.tcf can be configured to run any number of events within the e1 and e2 event groups, such as:</p>
<ul>
<li>e1=0100F and e2=12h results in MODEL_0100F_12h_EXG_001<br />
</li>
<li>e1=0100F and e2=24h results in MODEL_0100F_24h_EXG_001<br />
</li>
<li>e1=1000F and e2=12h results in MODEL_1000F_12h_EXG_001<br />
</li>
<li>e1=1000F and e2=24h results in MODEL_1000F_24h_EXG_001</li>
</ul>
<p>Two options are available to define the event choice for a model simulation:</p>
<ol style="list-style-type: decimal">
<li>Using a batch file (.bat): Specify the –e or –eX options (see Table
<a href="#tab:tab-TUFLOWOptions">116</a>) to run the multiple events using the same .tcf file – refer to the examples below. This option is best suited to executing bulk simulations.<br />
</li>
<li>Using the <a href="#tcfModelEvents">Model Events</a> command: Change the events manually
before each simulation within the .tcf file. Note that if using the
–e or -ex option, this will override any events defined
using <a href="#tcfModelEvents">Model Events</a> in the .tcf file. This option is useful for carrying out quick what-if or sensitivity simulations. It is not practical for bulk simulation.</li>
</ol>
<p>The examples below demonstrate two approaches for running simulations of a 20
and 50 year flood and 1 and 2 hour duration storms.</p>
<ul>
<li>Example 1 uses a single event group.</li>
<li>Example 2 achieves the same outcome as Example 1, though by using two event groups (~e1~ and ~e2~) it avoids some of the command repetition required for Example 1.</li>
</ul>
<p>In the examples, note how the same command (in this case <a href="#tcfEndTime">End
Time</a>) is used within the event blocks to assign a
different simulation end time depending on the duration of the event. Also note the use of <a href="#tcfBCEventSource">BC Event Source</a>, which is a much more powerful alternative to using <a href="#tcfBCEventText">BC Event Text</a> and <a href="#tcfBCEventName">BC Event Name</a>, in that it can be used to define
up to 100 different event text / name combinations instead of being
limited to one. The key text field linkages with the <a href="#tcfBCDatabase">BC Database</a> file
are highlighted in yellow.
<br><br></p>
<p><strong>Events Example 1: One Event Group</strong></p>
<p>Within the BC Database file:</p>
<p>Name,Source,Column 1,Column 2,Add Col 1,Mult Col 2,Add Col 2,<br>
C001,..\Inflows\<em><mark>~ARI~</mark>_<mark>~DUR~</mark>.csv,Time,C001<br>
C002,..\Inflows\</em><mark>~ARI~</mark>_<mark>~DUR~</mark>.csv,Time,C002<br>
…</p>
<p>Include “~e~” in the .tcf filename, for example “Nile_~e~.tcf”, and
add the following line at the bottom of the file:</p>
<p><tcmd><a href="#tcfEventFile">Event File</a></tcmd><teq> ==</teq><tblk> Nile_Events.tef</tblk></p>
<p>The “Nile_Events.tef” file contains lines such as the below:</p>
<p><tgrn>!____ Global Default Settings_______________________</tgrn></p>
<p><tcmd><a href="#tcfStartTime">Start Time</a></tcmd><teq> ==</teq><tblk> 0</tblk> <tgrn>! Global value, unless specified below</tgrn></p>
<p><tgrn>!____ 20 year event definitions______________________</tgrn></p>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 020y_01h</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~ARI~</mark> | 020y</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~DUR~</mark> | 01h</tblk><br />
      <tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> ==</teq><tblk> 3</tblk><br />
      <tcmd><a href="#tcfOutputFolder">Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\2d\020y</tblk><br />
      <tcmd><a href="#ecfOutputFolder">1D Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\1d\020y</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 020y_02h</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~ARI~</mark> | 020y</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~DUR~</mark> | 02h</tblk><br />
      <tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> ==</teq><tblk> 4</tblk><br />
      <tcmd><a href="#tcfOutputFolder">Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\2d\020y</tblk><br />
      <tcmd><a href="#ecfOutputFolder">1D Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\1d\020y</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<p><tgrn>!____ 50 year event definitions______________________</tgrn></p>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 050y_01h</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~ARI~</mark> | 050y</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~DUR~</mark> | 01h</tblk><br />
      <tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> ==</teq><tblk> 3</tblk><br />
      <tcmd><a href="#tcfOutputFolder">Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\2d\050y</tblk><br />
      <tcmd><a href="#ecfOutputFolder">1D Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\1d\050y</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 050y_02h</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~ARI~</mark> | 050y</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~DUR~</mark> | 02h</tblk><br />
      <tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> ==</teq><tblk> 4</tblk><br />
      <tcmd><a href="#tcfOutputFolder">Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\2d\050y</tblk><br />
      <tcmd><a href="#ecfOutputFolder">1D Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\1d\050y</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<p> <br />
Multiple events can be simulated from a single .tcf file using a batch
file. Refer to Section <a href="#StartingaSim-3"><strong>??</strong></a> for details how to create a batch
file. Below is an events batch file example in its simplest form, without looping.</p>
<p><tblk><strong>set</strong> TUFLOWEXE=C:\Program Files\TUFLOW\TUFLOW_iSP_w64.exe<br />
<strong>set</strong> RUN=start “TUFLOW” /low /wait /min “<strong>%TUFLOWEXE%</strong>” -b<br />
<strong>%RUN%</strong> –e1 020y_01h Nile_~e~.tcf<br />
<strong>%RUN%</strong> –e1 020y_02h Nile_~e~.tcf<br />
<strong>%RUN%</strong> –e1 050y_01h Nile_~e~.tcf<br />
<strong>%RUN%</strong> –e1 050y_02h Nile_~e~.tcf<br />
</tblk>
<br></p>
<p><strong>Events Example 2: Two Event Groups</strong></p>
<p>Within the BC Database file:</p>
<p>Name,Source,Column 1,Column 2,Add Col 1,Mult Col 2,Add Col 2,<br>
C001,..\Inflows\Nile\<em><mark>~ARI~</mark>_<mark>~DUR~</mark>.csv,Time,C001<br>
C002,..\Inflows\Nile\</em><mark>~ARI~</mark>_<mark>~DUR~</mark>.csv,Time,C002<br>
…</p>
<p>Include “~e1~” and “~e2” in the .tcf filename, for example
“Nile_~e1~_~e2~.tcf”, and add the following line:</p>
<p><tcmd><a href="#tcfEventFile">Event File</a></tcmd><teq> == </teq><tblk>Nile_Events.tef</tblk></p>
<p>The “Nile_Events.tef” file would contain lines such as the below:</p>
<p><tgrn>!____ Global Default Settings_______________________</tgrn></p>
<p><tcmd><a href="#tcfStartTime">Start Time</a></tcmd><teq> ==</teq><tblk> 0</tblk><tgrn>!! Global value, unless specified below</tgrn></p>
<p><tgrn>!____ ARI Definitions___________________________</tgrn></p>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 020y</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~ARI~</mark> | 020y</tblk><br />
      <tcmd><a href="#tcfOutputFolder">Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\2d\020y</tblk><br />
      <tcmd><a href="#ecfOutputFolder">1D Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\1d\020y</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd><br />
<tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 050y</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~ARI~</mark> | 050y</tblk><br />
      <tcmd><a href="#tcfOutputFolder">Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\2d\050y</tblk><br />
      <tcmd><a href="#ecfOutputFolder">1D Output Folder</a></tcmd><teq> ==</teq><tblk> ..\Results\1d\050y</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<p><tgrn>!____ DUR Definitions___________________________</tgrn></p>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 01h</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~DUR~</mark> | 01h</tblk><br />
      <tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> ==</teq><tblk> 3</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<div class="line-block"><tcmd><a href="#tefDefineEvent">Define Event</a></tcmd><teq> ==</teq><tblk> 02h</tblk><br />
      <tcmd><a href="#tcfBCEventSource">BC Event Source</a></tcmd><teq> ==</teq><tblk> <mark>~DUR~</mark> | 02h</tblk><br />
      <tcmd><a href="#tcfEndTime">End Time</a></tcmd><teq> ==</teq><tblk> 4</tblk><br />
<tcmd><a href="#tefEndDefine">End Define</a></tcmd></div>
<p>To run multiple events from the one .tcf file a .bat file may be used, such as below
(see Section <a href="#StartingaSim-3"><strong>??</strong></a>):</p>
<p><tblk><strong>set</strong> TUFLOWEXE=C:\Program Files\TUFLOW\TUFLOW_iSP_w64.exe<br />
<strong>set</strong> RUN=start “TUFLOW” /low /wait /min “<strong>%TUFLOWEXE%</strong>” -b<br />
<strong>%RUN%</strong> –e1 020y -e2 01h Nile_~e1~_~e2~.tcf<br />
<strong>%RUN%</strong> –e1 020y -e2 02h Nile_~e1~_~e2~.tcf<br />
<strong>%RUN%</strong> –e1 050y -e2 01h Nile_~e1~_~e2~.tcf<br />
<strong>%RUN%</strong> –e1 050y -e3 02h Nile_~e1~_~e2~.tcf<br />
</tblk></p>
<p><a href="#tcfIfEvent">If Event</a> logic blocks are also permitted in the same
manner as the <a href="#tcfIfScenario">If Scenario</a> command. Refer to
Section <a href="#Scenarios-3"><strong>??</strong></a> for further information. Also, events are automatically defined as variables and can be used, for example, to set the output folder name. See Section <a href="#Variables-3"><strong>??</strong></a> for information on “Variables”.</p>
<p><em><strong>Reminder: The location of <a href="#tcfEventFile">Event File</a> within the .tcf
file and the location of the commands within the .tef file are
important.</strong> If, for example <a href="#tcfEndTime">End Time</a> occurs in the
.tcf file after where <a href="#tcfEventFile">Event File</a> occurs, this latter
occurrence of <a href="#tcfEndTime">End Time</a> will prevail over those specified
in the .tef file. Essentially, the commands from the .tef file (for the
events specified using the –e or -e<X> run options or <a href="#tcfModelEvents">Model
Events</a>) are inserted into the .tcf at the location of
the <a href="#tcfEventFile">Event File</a> command, and are processed as if they
are embedded into the .tcf file at that location. </em></p>
<p><em>Tip: To distinguish between 1D and 2D commands in a .tef file, prefix
.ecf commands by “1D” followed by a space. In the examples below, the
.ecf <a href="#ecfOutputFolder">Output Folder</a> command is used to set different
folders for the 1D results depending on the event.</em></p>
<h3 class="hasAnchor" id="Scenarios-3"><span class="header-section-number">13.3.2</span> Scenarios<a href="#Scenarios-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using <a href="#tcfIfScenario">If Scenario</a> is similar to
using <em>If…Else If… Else…End If</em> constructs in a programming or macro
language. This feature enables control of the commands to include or exclude depending on the scenario or combination of scenarios specified by the user at the time of simulation execution.</p>
<p>Scenarios can be added into most of TUFLOW’s control files. The only control files not supporting scenarios are the TUFLOW Rainfall Control File (.trcf), TUFLOW External Stress File (.tesf), Advection Control File (.adcf) or within a <a href="#tocDefineControl">Define Control</a> command inside a TUFLOW Operational Control (.toc) file. Similar to “events”, 9 scenario groups can be specified. Unlimited scenario variations can be defined within each scenario group.</p>
<p>In Example 1 below, an <a href="#tcfIfScenario">If Scenario</a> logic block has
been inserted into a .tgc file:
<br><br></p>
<p><strong>Scenarios Example 1:</strong></p>
<p><tgrn>!____ MAT Definitions___________________________</tgrn></p>
<div class="line-block"><tcmd><a href="#tgcSet">Set Mat</a></tcmd><teq> ==</teq><tblk> 1</tblk> <tgrn>! Set unspecified materials to default of 1</tgrn><br />
<tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_existing.shp</tblk> <tgrn>! Apply existing materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">If Scenario</a></tcmd><teq> ==</teq><tblk> opA</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opA.shp</tblk> <tgrn>! Option A materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">End If</a></tcmd></div>
<p><br></p>
<p>TUFLOW will carry out the following steps:</p>
<ol style="list-style-type: decimal">
<li>Set all material values over the entire 2D domain to a value of 1.<br />
</li>
<li>Process the 2d_mat_existing.shp layer to assign material values from
a layer of land-use polygons representing the existing situation.<br />
</li>
<li>One of the following will then occur:
<ol style="list-style-type: decimal">
<li>If either “–s1 opA” was specified as a run selection in a batch file, or “<a href="#tcfModelScenarios">Model Scenarios</a> <teq>==</teq> opA” was
specified in the .tcf file, then the 2d_mat_opA.shp layer would be
processed to modify the material values affected by the Option A scenario. If “~s1~” occurs within the .tcf
filename, it is replaced by “opA” in the output filenames,
otherwise “opA” is appended to the end of the .tcf filename for
the output filenames.<br />
</li>
<li>If opA was not specified as the chosen scenario for a simulation, 2d_mat_opA.shp would be ignored. For example, that option would be required if modelling the existing scenario.</li>
</ol></li>
</ol>
<p>Example 1 can be extended to include an Option B, where Option B is an extension of Option A, and also Option C, which is a complete alternative to Option A and the combined Option A and B design. The <a href="#tcfIfScenario">If Scenario</a> logic block for this situation is shown in Example 2a below:
<br><br></p>
<p><strong>Scenarios Example 2a:</strong></p>
<div class="line-block"><tcmd><a href="#tgcSet">Set Mat</a></tcmd><teq> ==</teq><tblk> 1</tblk> <tgrn>! Set unspecified materials to default of 1</tgrn><br />
<tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_existing.shp</tblk> <tgrn>! Apply existing materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">If Scenario</a></tcmd><teq> ==</teq><tblk> opA | opB</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opA.shp</tblk> <tgrn>! Option A materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd><teq> ==</teq><tblk> opB</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opB.shp</tblk> <tgrn>! Option B materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd><teq> ==</teq><tblk> opC</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opC.shp</tblk> <tgrn>! Option C materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">End If</a></tcmd></div>
<p><br></p>
<p>In the above example:</p>
<ul>
<li>If “–s1 opA” is selected as the scenario for simulation, only 2d_mat_opA.shp will be read.</li>
<li>If “–s1 opB” is selected as the scenario for simulation, 2d_mat_opA.shp and 2d_mat_opB.shp will be read.</li>
<li>If “–s1 opC” is selected as the scenario for simulation, only 2d_mat_opC.shp will be read.</li>
</ul>
<p>Example 2b has been expanded further to include an <a href="#tcfIfScenario">Else</a> and <a href="#tcfPause">Pause</a> command in 2c. The command in the <a href="#tcfIfScenario">Else</a> section will apply if any scenario except opA, opB or opC is called. The <a href="#tcfPause">Pause</a> command will halt the simulation initialisation and display the specified message in the DOS window. The user then has the option to continue or discontinue the simulation. It is good practice to include Pause commands as a way to avoid accidental use of unspecified scenarios.
<br><br></p>
<p><strong>Scenarios Example 2c:</strong></p>
<div class="line-block"><tcmd><a href="#tgcSet">Set Mat</a></tcmd><teq> ==</teq><tblk> 1</tblk> <tgrn>! Set unspecified materials to default of 1</tgrn><br />
<tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_existing.shp</tblk> <tgrn>! Apply existing materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">If Scenario</a></tcmd><teq> ==</teq><tblk> opA | opB</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opA.shp</tblk> <tgrn>! Option A materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd><teq> ==</teq><tblk> opB</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opB.shp</tblk> <tgrn>! Option B materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd><teq> ==</teq><tblk> opC</tblk><br />
      <tcmd><a href="#tgcReadGIS">Read GIS Mat</a></tcmd><teq> ==</teq><tblk> shp\2d_mat_opC.shp</tblk> <tgrn>! Option C materials</tgrn><br />
<tcmd><a href="#tcfIfScenario">Else</a></tcmd><br />
      <tcmd><a href="#tcfPause">Pause</a></tcmd><teq> == </teq><tblk> Invalid op Scenario</tblk><br />
<tcmd><a href="#tcfIfScenario">End If</a></tcmd></div>
<p><br></p>
<p>In the example above, the batch file used to run the Option A, Option B and Option C
scenarios may look like this:</p>
<p><tblk><strong>set</strong> TUFLOWEXE=C:\Program Files\TUFLOW\TUFLOW_iSP_w64.exe<br />
<strong>set</strong> RUN=start “TUFLOW” /low /wait /min “<strong>%TUFLOWEXE%</strong>” -b<br />
<strong>%RUN%</strong> –b -s1 opA Nile_~s1~_001.tcf<br />
<strong>%RUN%</strong> –b –s1 opB Nile_~s1~_001.tcf<br />
<strong>%RUN%</strong> –b –s1 opC Nile_~s1~_001.tcf<br />
</tblk></p>
<p>As demonstrated above, it is recommended that scenario group placeholders be used (~s1~, ~s2~ etc.) in the .tcf file name. This provides the modeller with increased output file name control. Above, ~s1~ in the .tcf file name will be substituted with the chosen scenario in all result, log and check files. For example, for the first simulation in the queue, Nile_~s1~__001.tcf would become M01_opA_001 for all output files.</p>
<p>The <a href="#tcfIfScenario">If Scenario</a> command can be nested up to 10 levels. An example is provided in Scenario Example 3.
<br><br></p>
<p><strong>Scenarios Example 3:</strong></p>
<div class="line-block"><tcmd><a href="#tcfIfScenario">If Scenario</a></tcmd><teq> ==</teq><tblk> CLA </tblk><br />
      <tcmd><a href="#tcfSolutionScheme">Solution Scheme</a> </tcmd><teq> ==</teq><tblk> CLASSIC </tblk><br />
      <tcmd><a href="#tcfMapOutputDataTypes">Map Output Data Types</a> </tcmd><teq> ==</teq><tblk> h V q d MB1 MB2 </tblk><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd><teq> ==</teq><tblk> HPC </tblk><br />
      <tcmd><a href="#tcfSolutionScheme">Solution Scheme</a> </tcmd><teq> ==</teq><tblk> HPC </tblk><br />
      <tcmd><a href="#tcfHardware">Hardware</a> </tcmd><teq> ==</teq><tblk> GPU </tblk><br />
      <tcmd><a href="#tcfMapOutputDataTypes">Map Output Data Types</a> </tcmd><teq> ==</teq><tblk> h V q d dt </tblk><br />
      <tcmd><a href="#tcfIfScenario">If Scenario</a></tcmd><teq> ==</teq><tblk> SGS </tblk><br />
          <tcmd><a href="#tcfSGS">SGS</a> </tcmd><teq> ==</teq><tblk> ON </tblk><br />
      <tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd><teq> ==</teq><tblk> noSGS </tblk><br />
          <tcmd><a href="#tcfSGS">SGS</a> </tcmd><teq> ==</teq><tblk> OFF </tblk><br />
      <tcmd><a href="#tcfIfScenario">Else</a></tcmd> </tblk><br />
          <tcmd><a href="#tcfPause">Pause</a></tcmd><teq> == </teq><tblk> Error: Invalid SGS Scenario </tblk><br />
      <tcmd><a href="#tcfIfScenario">End If</a></tcmd><br />
<tcmd><a href="#tcfIfScenario">Else</a></tcmd><br />
      <tcmd><a href="#tcfPause">Pause</a></tcmd><teq> == </teq><tblk> Error: Invalid Solver Scenario<br />
<tcmd><a href="#tcfIfScenario">End If</a></tcmd></div>
<p><br>
Scenarios are automatically defined as “Variables” and can be used, for example, to set the output folder name. See Section <a href="#Variables-3"><strong>??</strong></a> for information on Variables.</p>
<h3 class="hasAnchor" id="Variables-3"><span class="header-section-number">13.3.3</span> Variables<a href="#Variables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="#tcfSetVariable">Set Variable</a> command can be used to assign different
values for the same variable in different parts of the various TUFLOW control files. It is an efficient way to centralise information. It is regularly used to consolidate the definition of multiple variables in a single logic block rather than having multiple <em>If..Else If.. End If</em>
command blocks in different locations or control files.</p>
<p>The <a href="#tcfSetVariable">Set Variable</a> command can only be specified in the .tcf or
within a read file (.trd) referenced from the .tcf. The variables can then be
used in all control files (.tcf, .tgc, .tbc, .ecf, etc). The variables are referenced within the control files by being enclosing the character string within “&lt;&lt;” and “&gt;&gt;”.</p>
<p>An example is provided below. Variables associated with modelling at different cell sizes are defined in the .tcf within a single logic block.</p>
<div class="line-block"><tcmd><a href="#tcfIfScenario">If Scenario</a></tcmd><teq> ==</teq><tblk> 2m</tblk><br />
      <tcmd><a href="#tcfSetVariable">Set Variable</a></tcmd> 2D_CELL_SIZE <teq>==</teq><tblk> 2</tblk><br />
      <tcmd><a href="#tcfSetVariable">Set Variable</a></tcmd> 2D_TIMESTEP <teq>==</teq><tblk> 1.0</tblk><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd> <teq>==</teq><tblk> 5m</tblk><br />
      <tcmd><a href="#tcfSetVariable">Set Variable</a></tcmd> 2D_CELL_SIZE <teq>==</teq><tblk> 5</tblk><br />
      <tcmd><a href="#tcfSetVariable">Set Variable</a></tcmd> 2D_TIMESTEP <teq>==</teq><tblk> 2.5</tblk><br />
<tcmd><a href="#tcfIfScenario">Else If Scenario</a></tcmd> <teq>==</teq><tblk> 10m</tblk><br />
      <tcmd><a href="#tcfSetVariable">Set Variable</a></tcmd> 2D_CELL_SIZE <teq>==</teq><tblk> 10</tblk><br />
      <tcmd><a href="#tcfSetVariable">Set Variable</a></tcmd> 2D_TIMESTEP <teq>==</teq><tblk> 5.0</tblk><br />
<tcmd><a href="#tcfIfScenario">End If</a></tcmd></div>
<p><br>
Along with this variable definition, the following is used in the respective control files:</p>
<ul>
<li>.tcf: <a href="#tcfTimestep">Timestep</a> <teq>==</teq><tblk> &lt;&lt;2D_TIMESTEP&gt;&gt;</tblk></li>
<li>.tcf: <a href="#tcfGridOutputCellSize">Grid Output Cell Size</a> <teq>==</teq><tblk> &lt;&lt;2D_CELL_SIZE&gt;&gt;</tblk><br></li>
<li>.tgc: <a href="#tgcCellSize">Cell Size</a> <teq>==</teq><tblk> &lt;&lt;2D_CELL_SIZE&gt;&gt;</tblk></li>
</ul>
<p>Refer to <a href="https://wiki.tuflow.com/TUFLOW_Example_Models#Bulk_Simulation_Management">TUFLOW Wiki Example Models - Variables</a> for various examples of variables in a working model.</p>
<p><em>Note: Set Variable scenario blocks are often contained within “read files”, referenced in the .tcf using the <a href="#tcfReadFile">Read File</a> command.</em></p>
<p>All events and scenarios are automatically set as a variable that can be
used within your control files. For example, if your model results are
to be output to different folders depending on Scenario 1 (~s1~), enter
the following into the .tcf file noting the use of &lt;&lt; and &gt;&gt; to
delineate the variable name.</p>
<p><a href="#tcfOutputFolder">Output Folder</a> <teq>==</teq><tblk> ..\results\&lt;&lt;~s1~&gt;&gt;</tblk></p>
<p>In the case above, if Scenario ~s1~ is set to “OpA”, TUFLOW
automatically sets a variable named “~s1~” to a value of “OpA”, and the
output will be directed to ..\results\OpA.</p>
<p>As an extension to the example above, if the output folder is to also
include the first event name, which, for example, is the return period
of the flood, the following could be used:</p>
<p><a href="#tcfOutputFolder">Output Folder</a> <teq>==</teq><tblk>..\results\&lt;&lt;~e1~&gt;&gt;_&lt;&lt;~s1~&gt;&gt;</tblk></p>
<p>If Event ~e1~ is set to “Q100”, the output will be directed to
..\results\Q100_OpA.</p>
<h2 class="hasAnchor" id="TUFLOWExecDownload-2"><span class="header-section-number">13.4</span> TUFLOW Executable Download<a href="#TUFLOWExecDownload-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="InstallOverview-3"><span class="header-section-number">13.4.1</span> Overview and Where to Install<a href="#InstallOverview-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The TUFLOW release consists of two different versions of the executable
as follows:</p>
<ul>
<li>TUFLOW_iSP_w64.exe<br />
</li>
<li>TUFLOW_iDP_w64.exe</li>
</ul>
<p>The naming convention for each executable is explained in Table <a href="#tab:tab-TUFLOWVersions">115</a>. Each version
has associated TUFLOW .dll and .ptx files, and several system .dll files.</p>
<p>For each version all .exe, .dll and .ptx files must be placed in the same
folder and kept together at all times. Older versions of TUFLOW may not have any .ptx files (these are associated with GPU based simulations. When replacing with a new build,
archive the files by creating a folder of the same name as the Build ID
(e.g. 2023-03-AD), and place all files in this folder.</p>
<p>The Build ID includes the acronym and appears in the top bar of the
Console window, in the .tlf file and elsewhere. For example, if running
the single precision, Windows 64-bit version, the Build ID would be
“2023-03-AD-iSP-w64”.</p>
<p>Older builds can always be setup in a similar manner by placing the
build in its own folder, if they are needed for running legacy models.</p>
<p><a href="#tcfModelTUFLOWBuild">Model TUFLOW Build</a> or a combination of <a href="#tcfModelTUFLOWRelease">Model
TUFLOW Release</a>, <a href="#tcfModelPrecision">Model
Precision</a> and <a href="#tcfModelPlatform">Model Platform</a>
can be used to force a simulation to use a specific TUFLOW build,
release, or precision (SP or DP). This can be
very useful for ensuring a consistent TUFLOW build/release/version is
used for a project.</p>
<p>It is recommended that a folder structure such as that shown in Figure <a href="#fig:fig-TUFLOWEngineFiles">108</a> is used.
If an update (patch) is issued, archive the old build by moving all
files to a separate folder or .zip file, and copy in the new TUFLOW
files. This way, batch files, text editors and GIS packages that are
used to start TUFLOW simulations will access the latest build. Previous
versions can still be used if required.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-TUFLOWEngineFiles"></span>
<img src="images/image176a.png" alt="**TUFLOW Engine Files**"  />
<p class="caption">
Figure 108: <strong>TUFLOW Engine Files</strong>
</p>
</div>
</center>
<!-- WJS
Above image might need to be clearer/higher resolution
-->
<!--EFC: I've updated this-->
<table>
<caption>
<span id="tab:tab-TUFLOWVersions">Table 115: </span><strong>TUFLOW Versions (iSP, iDP, w64)</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Version
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Single Precision<br />
(iSP)
</td>
<td style="text-align:left;">
Compiled using single precision (4-byte) real numbers that typically have around 7 significant figures. This version is recommended for the majority of TUFLOW simulations. See Section <a href="#iSPdSP-3"><strong>??</strong></a> for discussion on precision.
</td>
</tr>
<tr>
<td style="text-align:left;">
Double Precision<br />
(iDP)
</td>
<td style="text-align:left;">
<p>Compiled using double precision (8-byte) real numbers that typically have around 16 significant figures. See Section <a href="#iSPdSP-3"><strong>??</strong></a> for discussion on precision.</p>
<p>For TUFLOW Classic, this version should be used for models with high ground elevations (greater than 100 to 1,000m) and for direct rainfall models. If a model falls into these categories and is experiencing mass errors when using the single precision version, re-run using the double precision version and should the mass errors reduce to acceptable levels, continue to use double precision, otherwise contact <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<p>For TUFLOW HPC, due to its depth based formulation (rather than using elevation as required for implicit schemes like Classic), it double precision rarely needs to be used. However, for long-running simulations involving millions of timesteps, subsurface water levels can be subject to round-off errors during the integration process. Should mass volume errors occur, or if you are concerned about the accuracy of ground water levels, run in double precision and compare with single precision. Should the mass errors reduce to acceptable levels, continue to use double precision, otherwise contact <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<p><a href="#tcfModelPrecision">Model Precision</a> can be used to ensure that a simulation is started using the single or double precision version. For example, a single precision version of TUFLOW will generate an error if used to start the simulation if the command below is included in the .tcf:</p>
<a href="#tcfModelPrecision">Model Precision</a> <teq>==</teq> Double
</td>
</tr>
<tr>
<td style="text-align:left;">
Windows 32-bit<br />
(w32)
</td>
<td style="text-align:left;">
Legacy builds that were compiled as a 32-bit process. w32 TUFLOW builds can be run on Windows 32-bit and 64-bit platforms. All builds/releases prior to the 2010-10 release (except for the 2009-07-XX-iDP-64 build) are 32-bit. 32-bit programs are unable to access as much memory (RAM) as 64-bit versions of TUFLOW. For large models TUFLOW may generate an error that it is unable to allocate enough memory. Typically, when the memory requirement is ~1.5GB per simulation the 32-bit version of TUFLOW will not be able to allocate enough RAM.<br />
The 32-bit version of TUFLOW is only available for pre 2017-09 releases. Users should use the 64-bit versions where possible.
</td>
</tr>
<tr>
<td style="text-align:left;">
Windows 64-bit<br />
(w64)
</td>
<td style="text-align:left;">
<p>Compiled as a 64-bit process. w64 TUFLOW builds can only be run on Windows 64-bit platforms.</p>
<p>w64 2010-10 builds have been found to reduce simulation times by 20 to 50% compared with the 2009-07 (32-bit) release. Slightly different results (mostly fractions of a mm) will occur between w32 and w64 for the same model.</p>
<p><a href="#tcfModelPlatform">Model Platform</a> can be used to force a simulation to use a w32 or w64 version.</p>
<b>Note that the 64-bit versions of TUFLOW may only be run using a WIBU dongle </b> .
</td>
</tr>
</tbody>
</table>
<!-- WJS
Greg, please review comment on HPC needing DP in above table.
-->
<!--EFC: Greg has done this-->
<p>Running TUFLOW is carried out by initiating the TUFLOW_X.exe file using
one of the approaches discussed in Section <a href="#StartingaSim-3"><strong>??</strong></a>. The system
.dll files are required for the following purposes:</p>
<ul>
<li>TUFLOW_LINK_X.dll allows other schemes such as 12D DDA, FloodModeller 1D, EPA SWMM and XPSWMM to dynamically link with TUFLOW.<br />
</li>
<li>TUFLOW_USER_DEFINED_X.dll allows users to customise TUFLOW to suit
their purposes (see Section <a href="#CustomingTUFLOW-3"><strong>??</strong></a>).<br />
</li>
<li>TUFLOW_AD_X.dll contains the AD (advection-dispersion) module
algorithms.<br />
</li>
<li>TUFLOW_MORPHOLOGY_X.dll contains the morphology module algorithms. These are deprecated and retained for backward compatibility.<br />
</li>
<li>Other supplied .dlls are system DLLs required by TUFLOW.</li>
</ul>
<p>A number of .ptx files are required to run TUFLOW HPC/Quadtree simulations on a GPU card, these are:</p>
<ul>
<li>hpcKernels_nSP.ptx</li>
<li>hpcKernels_nDP.ptx<br />
</li>
<li>qpcKernels_nSP.ptx<br />
</li>
<li>qpcKernels_nDP.ptx</li>
</ul>
<p><strong>As a general rule, once a build is over three years old, it is no
longer supported.</strong> It can still be used, but there is no guarantee that
older builds will recognise newer dongles or are updated with bug fixes.</p>
<h3 class="hasAnchor" id="iSPdSP-3"><span class="header-section-number">13.4.2</span> Single and Double Precision<a href="#iSPdSP-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When storing floating point values on a computer, a certain number of
bytes per value is needed. Single precision numbers use 4 bytes and
double precision 8 bytes. This will yield from 6 to 9 digits
of precision for single precision and 15 to 17 digits for double. TUFLOW Classic and TUFLOW HPC are available in both single precision and double precision, however, the reasons why you would use double precision instead of single are somewhat different for the two solvers.</p>
<h4 class="hasAnchor" id="iSPdSP-Classic"><span class="header-section-number">13.4.2.1</span> TUFLOW Classic<a href="#iSPdSP-Classic" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Being an implicit matrix based solution, TUFLOW Classic solves for water levels rather than depths. The affect of this is best illustrated by an example. Consider a model where the highest ground level is under 10mAD. If a tiny amount of rainfall falls on the cell, this might raise the water level in the cell to 5.000001mAD. Both single and double precision will handle the accuracy needed as the resulting water level falls within the acceptable number of significant figures for both precisions.</p>
<p>However, consider another model with much higher elevations, and a cell that has a water level of 1000.000mAD. If this cell receives 0.000001m of rainfall in one timestep, for single precision the resulting water level will be 1000.000mAD (i.e. the added rainfall has disappeared resulting in an incorrect calculation and associated mass error). However, for double precision the resulting water level is 1000.00000100000, which is the correct water level and mass is conserved.</p>
<p>The need to use double precision for Classic also depends on other factors such as cell size and timestep. As there is no simple rule-of-thumb, the recommended action is to run the model in single and double precision modes. If the results are unacceptably different, and especially if the mass error is significantly lower in double precision, then double precision should be used.</p>
<p>Note that the choice of single or double precision also impacts on
simulation times and RAM allocation. iDP versions of TUFLOW Classic will take
approximately 25% longer to run and require up to twice as much memory,
limiting the ability to run concurrent simulations. Therefore, if the results of a model run in both iSP and iDP versions are consistent, the iSP version of TUFLOW is recommended to take advantage of the faster
simulation times and smaller memory footprint.</p>
<h4 class="hasAnchor" id="iSPdSP-HPC"><span class="header-section-number">13.4.2.2</span> TUFLOW HPC<a href="#iSPdSP-HPC" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Being an explicit solution, the calculation method in TUFLOW HPC uses depth, unlike TUFLOW Classic which uses water level as discussed above. This means that precision issues associated with, for example, applying a very small rainfall to a high elevation are not applicable in TUFLOW HPC, resulting in most models being accurately solved using single precision. However, carrying out simulations in single and double precision and checking for consistency is still a recommended task, especially if the simulation is using for example, very small inflows or other metrics that are unusually fine-scale.</p>
<p>Unless testing shows otherwise, use the single precision version for all TUFLOW HPC simulations. <strong>Note: Double precision solutions on GPU cards can be four times slower than single precision on some GPU devices!</strong> If the TUFLOW HPC simulation is started with the single precision version of TUFLOW, the HPC solver will utilise a single precision version. If the simulation is started with the double precision version of TUFLOW, error message <a href="https://wiki.tuflow.com/TUFLOW_Message_2420">ERROR 2420</a> will be output by default stating that the single precision version should be used. This can be overridden by using the <a href="#tcfHPCDPCheck">HPC DP Check</a> <teq>==</teq><tblk> OFF</tblk> command.</p>
<h3 class="hasAnchor" id="CustomingTUFLOW-3"><span class="header-section-number">13.4.3</span> Customising TUFLOW using TUFLOW_USER_DEFINED.dll<a href="#CustomingTUFLOW-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The TUFLOW_USER_DEFINED.dll is a legacy feature for TUFLOW Classic that was primarily used for customising hazard category outputs and is no longer supported as the same service cannot be offered for HPC given its GPU code base.</p>
<p><strong>Note: For customising hazard category outputs, see Section <a href="#Hazards-4"><strong>??</strong></a>.</strong></p>
<!-- WJS
I've assumed we're no longer supporting above? So, I've deleted and changed to no longer supported. Please add link to user defined hazard feature.
-->
<!--EFC: added-->
<h2 class="hasAnchor" id="RunningSims-2"><span class="header-section-number">13.5</span> Running Simulations<a href="#RunningSims-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- EFC: put in chapter of what to do when sim not starting correctly and link to https://wiki.tuflow.com/TUFLOW_crashing -->
<h3 class="hasAnchor" id="DongleTypesandSetup-3"><span class="header-section-number">13.5.1</span> Dongle Types and Setup<a href="#DongleTypesandSetup-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>BMT dongles are generally distributed as a WIBU Codemeter (metal) dongle or software licence. These dongles were introduced in 2010. The older ‘SoftLok’ dongles are no longer supported.</p>
<p>Two types of licences are currently provided:</p>
<ul>
<li>Local or Standalone Licence – Allows up to a specified limit the
number of TUFLOW simulations to be run from the one computer. For
example, a Local 1 licence will allow a single simulation to be
performed on the machine. A local 4 licence allows up to 4 concurrent
simulations. Local 1 to Local 16 licences can be configured.<br />
</li>
<li>Network Licence – allows for multiple TUFLOW processes running at any
one time across multiple machines within the limitations of the <a href="https://downloads.tuflow.com/_archive/Licensing/TUFLOW%20Products%20Licence%20Agreement.pdf">TUFLOW EULA</a>. For example, a Network 5 licence allows up to 5
concurrent simulations to be performed. This could be 5 simulations on
a single computer, 5 simulations with each one on a different computer, or
anything in between.</li>
</ul>
<p>Refer to the <a href="https://wiki.tuflow.com/TUFLOW_Licensing">installation instructions</a> on the TUFLOW
Wiki for both types of dongles.</p>
<h4 class="hasAnchor" id="DongleAccessProtocols-4"><span class="header-section-number">13.5.1.1</span> Protocols for Accessing Dongles<a href="#DongleAccessProtocols-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If more than one type of dongle is available the protocols for taking
and checking licences are:</p>
<ol style="list-style-type: decimal">
<li>WIBU Codemeter licences are searched for, and if a licence is free
it is taken.<br />
</li>
<li>If no licence is available, you can optionally set for TUFLOW to
continue to try and find an available WIBU dongle licence. This is
achieved using the “C:\BMT\TUFLOW_Dongle_Settings.dcf” file
described below. This is useful if there are no free licences and
you wish to start a simulation (the simulation will start once a
free licence becomes available).<br />
</li>
<li>Once a simulation is under way, and if the licence is lost, TUFLOW
will try to regain a licence, but it cannot switch to a different
dongle type / provider. For example, a WIBU dongle can’t be used to
finish a simulation if it is started with another WIBU dongle which is
removed.</li>
</ol>
<p>There are five varieties of licence type / vendor:</p>
<ul>
<li>BMT physical USB lock (dongle)<br />
</li>
<li>BMT software lock (tied to a particular machine)<br />
</li>
<li>Aquaveo (SMS) USB lock<br />
</li>
<li>Jacobs (Flood Modeller) USB lock<br />
</li>
<li>Jacobs (Flood Modeller) software lock</li>
</ul>
<p>With numerous licencing options available, setting the preferred licence
type can (slightly) speed the simulation start-up. The licence search order can be set
via a licence control file “TUFLOW_licence_settings.lcf”, this replaces
the TUFLOW_Dongle_Settings.dcf. Note that this file can occur in several
locations. When looking for a licence setting file TUFLOW searches in
the following locations:</p>
<ol style="list-style-type: decimal">
<li>A “TUFLOW_licence_settings.lcf” in the same location as the TUFLOW executable.<br />
</li>
<li>A “TUFLOW_licence_settings.lcf” in a TUFLOW folder in the “ProgramData” environment variable location. By default this will resolve to C:\ProgramData\TUFLOW\TUFLOW_licence_settings.lcf.
Entering %programdata% into the windows explorer path will take you to the location.<br />
</li>
<li>C:\BMT\TUFLOW_Licence_Settings.lcf<br />
</li>
<li>C:\BMT\TUFLOW_Dongle_Settings.dcf</li>
</ol>
<p>If no licence settings files are found, TUFLOW defaults to the order
listed above. <a href="#tcfWIBUFIRMCodeSearchOrder">WIBU Firm Code Search Order</a> can be used
to control the search order in the TUFLOW_licence_settings.lcf file.</p>
<p><strong>Note: Use of C:\BMT\ above is for legacy reasons and is not recommended as read/write access to local drives is now often blocked for protection against hackers.</strong></p>
<h4 class="hasAnchor" id="DongleSettingsFile-4"><span class="header-section-number">13.5.1.2</span> TUFLOW_Licence_Settings.lcf File<a href="#DongleSettingsFile-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The TUFLOW Licence Settings (.lcf) file can be used to set WIBU settings, such as retry time interval and count. It has the same form and notation as a TUFLOW .tcf file.</p>
<p>This file is optional and if not found the settings below are the default:</p>
<p><tgrn>! Use this file to set general and WIBU specific dongle parameters </tgrn><br />
<tgrn>! Use ! or # to comment out commands or make comments</tgrn><br />
<tcmd>Simulations Log Folder</tcmd><teq> ==</teq><tblk> C:\ProgramData\TUFLOW\&lt;username&gt;\log</tblk> <tgrn>! Path or URL to global .log file </tgrn><br />
<tcmd>WIBU Retry Time</tcmd><teq> ==</teq><tblk> 60</tblk> <tgrn>! seconds. Values less than 3 are reset to 3. Default = 60.</tgrn><br />
<tcmd>WIBU Retry Count</tcmd><teq> ==</teq><tblk> 0</tblk> <tgrn>! Use -1 for indefinitely.</tgrn><br />
<tcmd>WIBU Dongles Only</tcmd><teq> ==</teq><tblk> OFF</tblk> <tgrn>! If ON, searches for WIBU dongles only.
Default is OFF.</tgrn></p>
<p>In the above, the:</p>
<ul>
<li><tcmd>Simulations Log Folder</tcmd> sets the folder path or URL to a folder for
logging all simulations. If the keywords “DO NOT USE” occur within the
folder path or URL, this feature is disabled. Also see <a href="#tcfSimulationsLogFolder">Simulations Log
Folder</a>.<br />
</li>
<li><tcmd>WIBU Retry Time</tcmd> sets the interval in seconds for retrying to take a
licence or regain a lost licence. The default is 60 and values less than
3 are set to 3.<br />
</li>
<li><tcmd>WIBU Retry Count</tcmd> sets the number of times to retry for a licence at
the start of a simulation. By default, if a licence is lost during the simulation,
TUFLOW tries indefinitely to regain a licence so as not to lose the
simulation.<br />
</li>
<li><tcmd>WIBU Dongles</tcmd> Only if set to ON will force TUFLOW to only search for WIBU dongles.</li>
</ul>
<h4 class="hasAnchor" id="DongleFailure-4"><span class="header-section-number">13.5.1.3</span> Dongle Failure during a Simulation<a href="#DongleFailure-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If TUFLOW fails to recognise a network lock during a simulation
(e.g. the network dongle server computer is down) it enters a holding
pattern and continues trying until a license is found.</p>
<p>For local, standalone locks, TUFLOW prompts with a message that the lock
could not be found. If it’s a USB lock try a different USB port,
and press Enter to continue.</p>
<h3 class="hasAnchor" id="StartingaSim-3"><span class="header-section-number">13.5.2</span> Starting a Simulation<a href="#StartingaSim-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are a number of ways TUFLOW can be started, in each case the
TUFLOW executable is started with the TUFLOW control file (.tcf) as the
input argument. There are a number of optional switches that can be
specified when starting a simulation; these are outlined in Table <a href="#tab:tab-TUFLOWOptions">116</a>.</p>
<p>Starting a TUFLOW simulation can be carried out in a multitude of
methods:</p>
<ol style="list-style-type: decimal">
<li>From within a text editor such as <a href="https://wiki.tuflow.com/NotepadPlusPlus_Run_TUFLOW">Notepad++</a><br />
</li>
<li>Through a <a href="https://wiki.tuflow.com/Run_TUFLOW_From_a_Batch-file">batch file</a><br />
</li>
<li>From within your GIS software:
<ol style="list-style-type: decimal">
<li>QGIS via the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">QGIS TUFLOW Plugin</a><br />
</li>
<li>ArcMap via the use of the <a href="https://wiki.tuflow.com/ArcGIS_TUFLOW_Toolbar#Run_TUFLOW_Simulation">ArcTUFLOW toolbox</a><br />
</li>
<li>MapInfo (through the <a href="https://wiki.tuflow.com/MiTools_Tips#TUFLOW_Capabilities">MiTools</a> add-on)<br />
</li>
</ol></li>
<li>From a <a href="https://wiki.tuflow.com/Run_TUFLOW_through_the_command_window">Console (DOS) Window</a><br />
</li>
<li>Via the right mouse button in Microsoft Explorer<br />
</li>
<li>Via a runner such as the <a href="https://gitlab.com/tuflow-user-group/tuflow/simulation-management/tuflow-runner">TUFLOW Runner</a> or <a href="https://wiki.tuflow.com/TRIM_Tips">TRIM</a></li>
</ol>
<p>This section of the manual only provides detailed instructions on
initiating simulations through batch files as it is the most effective
method to run several or many simulations. Instructions on all methods
have been described on the <a href="https://wiki.tuflow.com/Running_TUFLOW">TUFLOW
Wiki</a>.</p>
<h4 class="hasAnchor" id="BatchFileExamples-4"><span class="header-section-number">13.5.2.1</span> Batch File Example and Run Options (Switches)<a href="#BatchFileExamples-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A batch file is a text file that contains a series of commands or
instructions that is read by the Windows Operating System. The batch
file requires the extension .bat to be recognised by Windows.</p>
<p>The simplest format of a TUFLOW batch file is to specify a single
simulation. This is of the format:</p>
<p><tblk>&lt;TUFLOW Executable&gt; &lt;TUFLOW Control File&gt;</tblk></p>
<p>For example:</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe MR_H99_C25_Q100.tcf</tblk></p>
<p>The .bat file is run or opened by double clicking on it in Windows
Explorer. This opens a Console Window and then executes each line of the
.bat file. The above batch file will start the TUFLOW executable with
the control file “MR_H99_C25_Q100.tcf” as the input file. As the control
file argument does not have a file path, the batch file must be located
in the same folder as the .tcf file. This could also include a relative
or absolute file path, for example in the batch file line below, the
batch file could be stored in any folder as the absolute file path is
used. As outlined in Section <a href="#FilePath-3"><strong>??</strong></a>, the relative file path is recommended
for TUFLOW modelling inputs.</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe C:\Example\MR_H99_C25_Q100.tcf</tblk></p>
<p>To start multiple simulations one after the other, these can be listed
in succession.</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe –b MR_H99_C25_Q100.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe –b MR_H99_C25_Q050.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe –b MR_H99_C25_Q020.tcf<br />
<em>pause</em></tblk></p>
<p>Note the use of the –b (batch) switch, which suppresses the need to press
the return key at the end of a simulation. This ensures that one
simulation proceeds on to the next without any need for user input. The
pause at the end stops the Console window from closing automatically
after completion of the last simulations so you can check the status of the simulations.</p>
<p>The –t (test) switch is very useful for testing the data input without
running the simulation. It is good practice to use this switch before
carrying out the simulations, as this will tell you whether there are
any data input problems. The –t switch runs TUFLOW to just before it
starts the hydrodynamic computations.</p>
<p>Using the example above, the recommended approach is to first run the
following batch file:</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –t
MR_H99_C25_Q100.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –t
MR_H99_C25_Q050.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –t
MR_H99_C25_Q020.tcf<br />
<em>pause</em></tblk></p>
<p>This will indicate any input problems (note some WARNINGS do not require
a “press return key”, but they can be located in the .tlf file).</p>
<p>From TUFLOW version 2018-03-AA, it is possible to use the test model option without using a TUFLOW licence noting no diagnostics are reported so don’t use this option whilst you are developing/building a model. To utilise this licence free test, the -nlc (No Licence Check) input argument
must be specified, e.g. the command line below would run the model in test model (-t) without needing a licence (-nlc):</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –t -nlc MR_H99_C25_Q020.tcf </tblk></p>
<p>To carry out the simulations the –t can be removed (and -nlc flag if used) or replaced with the –x (execute) switch. The -x switch is optional, but is useful when editing
the .bat file to quickly change between –t and –x switches.</p>
<p><tblk>
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –x MR_H99_C25_Q100.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –x MR_H99_C25_Q050.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –x MR_H99_C25_Q020.tcf<br />
<em>pause</em></tblk></p>
<p>Comment lines are specified in a .bat file using “REM” (remark) in the
first column. Alternatively, “::” has a similar effect. The <a href="https://ss64.com/nt/rem.html">ss64 website</a> has further guidance on using comment lines in batch files. For example, if you want to re-run only
the first simulation in the examples above, edit the file as follows:</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –x MR_H99_C25_Q100.tcf<br />
:: C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –x MR_H99_C25_Q050.tcf<br />
:: C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe -b –x MR_H99_C25_Q020.tcf<br />
<em>pause</em></tblk></p>
<p>Table <a href="#tab:tab-TUFLOWOptions">116</a> below describes other switches that are available. The switches are also
displayed to the console if TUFLOW.exe is executed without any arguments
(i.e. double click on TUFLOW.exe in Windows Explorer).</p>
<p>Any of the options can be prefixed by a:</p>
<ul>
<li>“-” (short dash or minus sign);<br />
</li>
<li>“-” (long dash); or<br />
</li>
<li>“/” (forward slash)</li>
</ul>
<p>For example, to start a model in batch mode, the following all perform
the exact same function:</p>
<p><tblk>C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe <strong>-</strong>b MR_H99_C25_Q100.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe <strong>–</strong>b MR_H99_C25_Q100.tcf<br />
C:\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe <strong>/</strong>b MR_H99_C25_Q100.tcf</tblk></p>
<table>
<caption>
<span id="tab:tab-TUFLOWOptions">Table 116: </span><strong>TUFLOW.exe Options (Switches)</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Switch
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
-acf
</td>
<td style="text-align:left;">
Automatically create folders (the default). Prevents the dialog prompt from appearing when encountering non-existent folders (ie. results folders), and creates these folders automatically. If for any reason the folder can’t be created, a dialog will appear.
</td>
</tr>
<tr>
<td style="text-align:left;">
-b
</td>
<td style="text-align:left;">
Batch mode. Used when running two or more simulations in succession from a .bat file (see Section <a href="#BatchFileExamples-4"><strong>??</strong></a>). Suppresses display of the TUFLOW “simulation has finished” dialogue window, or a request to press Enter at the end of a simulation, so that the .bat file can continue onto the next simulation.
</td>
</tr>
<tr>
<td style="text-align:left;">
<p>-c</p>
<p>Optional additional flags of “a” , “L”, “p” or “ncf”.</p>
(e.g. -c, -cap, -cpncf, -cncf)
</td>
<td style="text-align:left;">
<p>A copy of a TUFLOW model can be created as described below. Making a copy of a model is useful for transferring a model to another site or for making an archive of the input data. Also see the -pm (package model) option as an alternative.</p>
<p>To copy a TUFLOW model, the -c switch must be included on the TUFLOW command line, as a minimum. The -c switch copies only the files read by TUFLOW. Therefore, for MapInfo users, the .mif and .mid files read by TUFLOW will be copied. To copy the remaining MapInfo format files (.tab, .id, .dat and .map) use the -ca option described further below.</p>
<p>Additional optional flags can be added to the base -c switch, in any combination, including:</p>
<ul>
<li>“a” (all);<br />
</li>
<li>“L” (list);<br />
</li>
<li>“p” (path); and<br />
</li>
<li>“ncf” (no check files).</li>
</ul>
<p>The addition of the “a” flag (e.g. -ca) copies all files of the same name for all input files (i.e. same name, but different extensions). This option is particularly useful if the .tab and other associated files of a GIS layer need to be archived or delivered.</p>
<p>The addition of the “L” flag will output the files used by TUFLOW into a .tcl (TUFLOW Copy List) file but not copy the files to a destination folder. This can be useful if scripting the copying of models. To run the copy list the character “L” needs to be specified after the -c input argument. This works for all copy options, for example the following are all valid; -cL, -caL -capL. The .tcl file produced is output in the same directory as the .tcf and takes the simulation name.</p>
<p>The addition of the “p” flag (e.g. -cp) allows the user to specify an alternate path in which to copy the model. Without this flag, the location defaults to the .tcf’s location. For example, specifying the following, will place a copy of the model into a folder C:\put_model_here:</p>
<p>“TUFLOW.exe” -cp “C:\put_model_here” “C:\TUFLOW\runs\M01_5m_003.tcf”</p>
<p>The addition of the “ncf” flag (e.g. -cncf) copies the essential input files and excludes all check files.</p>
<p>Note that these optional flags can be added in any combination to the base -c switch (e.g. -c, -ca, -cp, -cncf, -cap, -cancf, -cpncf, -capncf).</p>
<p>Specifying -c on the TUFLOW command line creates a folder “<span class="math inline">\(\lt\)</span>.tcf filename<span class="math inline">\(\gt\)</span>_copy” (or “<span class="math inline">\(\lt\)</span>.tcf filename<span class="math inline">\(\gt\)</span>_copy_all” if the “a” flag is added) in the same location as the .tcf file. Under the folder, input files are copied (including the full folder structure), and any check files and output folders created. For example, specifying:</p>
<p>TUFLOW.exe -c “C:\tuflow_models\my model.tcf” will make a copy of the TUFLOW model based on the file “my model.tcf” in a folder “my model.tcf_copy”, or “my model.tcf_copy_all” if using the “a” flag.</p>
<p>Notes:</p>
<ol style="list-style-type: decimal">
<li><b>Use the full path to the .tcf file (this is generally the default if running from an editor such as UltraEdit or using the right click approach).</b><br />
</li>
<li>Make sure there is sufficient disk space (no checks for sufficient disk space are made).<br />
</li>
<li>Output folders and some output files are created but these will be empty.<br />
</li>
<li>Unless the -ncf option is used, any check folder(s) are created and check files written (these can be deleted if wishing to minimise the size of the folder).<br />
</li>
<li>The full path of the input files is reproduced to provide traceability and also handle inputs from other drives and URLs. Drive letters are replaced, for example, “C:” becomes a folder “C Drive”. URLs (denoted by “\” or “//” at the beginning of the path) are replaced by a folder called “URL\”.<br />
</li>
<li>To run the copied .tcf file, it will be necessary to change any non-relative pathnames according to the point above. Alternatively you can share and then map, for example, the “D Drive” folder as “D:”.<br />
</li>
<li>If using MapInfo formats, the <a href="#tcfCheckMISaveDate">Check MI Save Date</a> will need to be set to WARNING or OFF in the .tcf file if the –ca option has not been used as the .tab and other files will not have been copied.<br />
</li>
<li>There is a limit of 1,000 characters (including spaces) on pathnames. As very long pathnames can result due to the above approach, if the number of characters exceeds 1,000, problems may occur.<br />
</li>
<li>The -c switch automatically invokes the -t (i.e. the simulation does not commence, only the input data is tested/checked).<br />
</li>
<li>The -b option still applies if several models wish to be copied using a batch (.bat) file.
</td>
</tr>
<tr>
<td style="text-align:left;">
-e&lt;name&gt;</li>
</ol>
-e{1-9}&lt;name&gt; </name></name>
</td>
<td style="text-align:left;">
<p>Specifies an event name to be used by <a href="#tcfDefineEvent">Define Event</a> in a .tef <a href="#tcfEventFile">Event File</a> to customise inputs for an event. There must be a space between –e and &lt;name&gt;. &lt;name&gt; may itself contain spaces, but if it does the event name must be enclosed in quotes. More than one (up to a maximum of nine) events per simulation may be specified by placing a number after –e. –e and –e1 are treated the same (don’t specify both of them otherwise indeterminate results may occur).</p>
<p>Also see Section <a href="#Events-3"><strong>??</strong></a> and <a href="#tcfModelEvents">Model Events</a>.</p>
Examples:<br />
–e Q100 Run the Q100 event.<br />
–e1 Q100 –e2 02h Run the Q100, 2 hour storm event.<br />
–e Q100 –e2 02h Same as above.<br />
–e “100 yr” Run the event name “100 yr” noting quotes required as there is a space in the name. </name></name>
</td>
</tr>
<tr>
<td style="text-align:left;">
-et&lt;time_in_hours&gt; </time_in_hours>
</td>
<td style="text-align:left;">
The end time for a simulation can be specified using the run option -et&lt;time_in_hours&gt;. Any end time specified via this run option argument is given the highest priority and overrides the <a href="#tcfEndTime">End Time</a> settings in the .tcf, event files (.tef) and override files. </time_in_hours>
</td>
</tr>
<tr>
<td style="text-align:left;">
-nc
</td>
<td style="text-align:left;">
<p>The use of the -nc (no console) switch suppresses the appearance (hides) the console window (Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>). You won’t be able to see the simulation running, however there will be a TUFLOW process visible in Windows Task Manager. The -nc switch automatically invokes the -nmb and -b switches.</p>
<p>The “start” command included in the Advanced Batch File examples in Section <a href="#AdvancedBatchFiles-4"><strong>??</strong></a> should not be used with the -nc command.</p>
<p>It is strongly recommended to redirect standard console window output to a text file. It’s recommended that this file be given a unique name for each run, matching your simulation. “…TUFLOW.exe” –nc my_run.tcf &gt; my_run.txt</p>
<p>Build 2018-03-AB included some enhancements when running with the -nc (no console option). These were designed to remove any need for user input to TUFLOW as follows:</p>
<ul>
<li>If no .tcf is specified, no licence check is performed and the simulation is halted. Previously a licence check was performed and the user was prompted to hit a key to release licences and close the simulation.<br />
</li>
<li>If an invalid .tcf file is specified, the simulation stops and returns an error level of 1 to the operating system. Previously the user was prompted to enter a valid .tcf filename.<br />
</li>
<li>If the set log path (-slp) is specified in conjunction with the no console option (-nc) the simulation stops and returns an error level of 1 to the operating system. Previously the user was prompted to confirm the set log path.<br />
</li>
<li>Removed a number of locations where a simulation could pause and wait for a user input before closing.
</td>
</tr>
<tr>
<td style="text-align:left;">
-nlc
</td>
<td style="text-align:left;">
For Build 2018-03-AA or later it is possible to use the copy model (-c option) or test model (-t option) without using a licence. To utiltise this licence free copy / test, the -nlc (No Licence Check) input argument must be specified.</li>
</ul>
If running without a TUFLOW licence no diagnostic output is generated (e.g. messages layer). If these are required, the -nlc option must be removed.
</td>
</tr>
<tr>
<td style="text-align:left;">
-nmb
</td>
<td style="text-align:left;">
No Message Boxes. Suppress use of windows message boxes to prompt the user. All prompts will be via the console window.
</td>
</tr>
<tr>
<td style="text-align:left;">
-nq
</td>
<td style="text-align:left;">
The use of the -nq (no queries) switch prevents the termination query dialog from displaying when Ctrl+C is pressed to terminate a simulation cleanly. If –nq is specified and Ctrl-C is pressed, the simulation terminates cleanly without a query dialog to check you are certain, so be careful!
</td>
</tr>
<tr>
<td style="text-align:left;">
-nt
</td>
<td style="text-align:left;">
Sets the number of CPU threads (cores) to use for a TUFLOW HPC simulation. Noting that the number of threads requested is limited to the maximum number of CPU cores available on the machine, and the available TUFLOW Thread licences.
</td>
</tr>
<tr>
<td style="text-align:left;">
-nwk
</td>
<td style="text-align:left;">
Force TUFLOW to search for a network licence (i.e. skip the search for a local licence).
</td>
</tr>
<tr>
<td style="text-align:left;">
-od&lt;drive&gt; </drive>
</td>
<td style="text-align:left;">
The Output Drive for a simulation can be specified with the –od command line option.  For example –odC will redirect all outputs to the C:\ drive.
</td>
</tr>
<tr>
<td style="text-align:left;">
-oz&lt;name&gt; </name>
</td>
<td style="text-align:left;">
Map output includes Output Zone &lt;name&gt;. For more information on Output Zones, please refer to Section <a href="#OutputZones-3"><strong>??</strong></a>. For example “-oz ZoneA” would include output for Zone A, similar to the .tcf command: <a href="#tcfModelOutputZones">Model Output Zones</a> <teq>==</teq><tblk> Zone A</tblk>. </name>
</td>
</tr>
<tr>
<td style="text-align:left;">
<p>-pm</p>
Optional additional flags of “All” , “L” or “ini”.
</td>
<td style="text-align:left;">
<p>The package model (-pm) function copies all input files for all events and scenarios defined in the model. Unlike the -c option, -pm does not read and process the data during the file copy. As such it is substantially faster than -c. </p>
<p>The package model function does not require access to a TUFLOW licence.</p>
<p>Optional switches are:</p>
<ul>
<li>“All” (e.g. -pmAll) copies all file extensions (e.g. 1d_nwk_culv_L.mif, will become 1d_nwk_culv_L.*).<br />
</li>
<li>“L” (e.g. -pmL) list the files to be copied into an output file, but doesn’t copy the files.<br />
</li>
<li>“ini” (-pmini &lt;file.ini&gt;) provides a .ini file with user defined options as described below.</li>
</ul>
<p>Combinations of the above are also valid, with the order of the optional switches not being important (-pmAllL would be treated the same as -pmLAll).</p>
<p>Three options are also available for handling of the binary processed files created by TUFLOW to speed up the simulation start. These options are:</p>
<ul>
<li>-xf0: Do not copy .xf files, only the original inputs are copied.<br />
</li>
<li>-xf1: Copy both raw input files and .xf files.<br />
</li>
<li>-xf2: Copy only .xf files, if xf files exist for an input only the xf file will be copied.</li>
</ul>
<p>For example, the command line below will package the model but not include any .xf files.</p>
<p>TUFLOW_iSP_w64.exe -pm -xf0 PR_~s1~_~e1~_~e2~_001.tcf</p>
<p>When using package model the default destination folder is created in the same directory as the .tcf file, with the prefix “pm_”. For example, C:\Projects\Modelling\TUFLOW\runs\Run_001.tcf will create a package in the folder “C:\Projects\Modelling\TUFLOW\runs\pm_Run_001”.</p>
<p>A .ini file can be used to overwrite the default base and destination folders. A .ini file is specified by including the optional ini argument after -pm followed by the ini file name. For example:</p>
<p>TUFLOW_iSP_w64.exe -pmini package.ini PR_~s1~_~e1~_~e2~_001.tcf</p>
<p>Valid commands in the .ini file are:</p>
<ul>
<li>Base Folder == &lt;folder&gt;<br />
</li>
<li>Copy Destination == &lt;folder&gt;<br />
</li>
<li>Model Scenario ~s&lt;number&gt; == &lt;scenario a&gt; | &lt;scenario b&gt; | …<br />
</li>
<li>Model Event ~e&lt;number&gt; == &lt;event a&gt; | &lt;event b&gt; | …</li>
<li>Max Event Name == &lt;number&gt; </number></event></event></number></scenario></scenario></number></folder></folder>&lt;/file.ini&gt;</li>
</ul>
</td>
</tr>
<tr>
<td style="text-align:left;">
-pu&lt;id&gt; </id>
</td>
<td style="text-align:left;">
<p>Used to select which processing units to direct the simulation towards. At present this only applies to the HPC GPU solver where a simulation is to be directed to a particular GPU card or cards. –pu must be specified once for each device. For example, to direct the simulation to GPU devices 0 and 2, specify –pu0 –pu2. Can be used in place of the .tcf command <a href="#tcfGPUDeviceIDs">GPU Device IDs</a>. Note that the numbering starts at 0 for GPU devices.</p>
Override files (see Section <a href="#Override-3"><strong>??</strong></a>) can be used to control the device ID’s used by a range of computers accessing the same control file.
</td>
</tr>
<tr>
<td style="text-align:left;">
-qcf
</td>
<td style="text-align:left;">
Query the creation of a folder. If you would prefer to have the create folder query dialog to appear (rather than TUFLOW automatically creating folders - see -acf), you can specify the –qcf run time option.
</td>
</tr>
<tr>
<td style="text-align:left;">
<p>-s&lt;name&gt;</p>
-s{1-9}&lt;name&gt; </name></name>
</td>
<td style="text-align:left;">
<p>Specifies a scenario name to be used by <a href="#tcfIfScenario">If Scenario</a> blocks to include/exclude commands. There must be a space between –s and &lt;name&gt;. &lt;name&gt; may itself contain spaces, but if it does the scenario name must be enclosed in quotes. More than one (maximum of nine) scenarios per simulation maybe specified by placing a number after –s. –s and –s1 are treated the same, so don’t specify both of them otherwise indeterminate results may occur.</p>
<p>Also see Section <a href="#Scenarios-3"><strong>??</strong></a> and <a href="#tcfModelScenarios">Model Scenarios</a>.</p>
Examples:<br />
–s exg Process all exg scenario commands.<br />
–s1 opA –s2 opB Process all opA and opB scenarios.<br />
–s opA –s2opB Same as above.<br />
–s “Option A” Quotes required as there is a space in the scenario name. </name></name>
</td>
</tr>
<tr>
<td style="text-align:left;">
-slp
</td>
<td style="text-align:left;">
Simulation Log Path is a legacy option for Softlok (blue) dongles to set the path to a folder on the intranet to log all simulations initiated from the lock. Refer to the 2018 manual or earlier for details.
(See Section <a href="#DongleSettingsFile-4"><strong>??</strong></a> for equivalent option for WIBU Codemeter licences, and also <a href="#tcfSimulationsLogFolder">Simulations Log Folder</a>.)
</td>
</tr>
<tr>
<td style="text-align:left;">
-st&lt;time_in_hours&gt; </time_in_hours>
</td>
<td style="text-align:left;">
The start time for a simulation can be specified using the run option -st&lt;time_in_hours&gt;. Any start time specified via this run option argument is given the highest priority and overrides the <a href="#tcfStartTime">Start Time</a> settings in the .tcf, event files (.tef) and override files. </time_in_hours>
</td>
</tr>
<tr>
<td style="text-align:left;">
-t
</td>
<td style="text-align:left;">
Test input only. Processes all input data including writing of check files, but does not start the simulation. Useful for checking that simulations in a .bat file all initialise without error, prior to carrying out the simulations (especially when the runs will take all night or all weekend and you made a change you forgot to test!).
</td>
</tr>
<tr>
<td style="text-align:left;">
-wibu
</td>
<td style="text-align:left;">
Search for a WIBU Codemeter licence only.
</td>
</tr>
<tr>
<td style="text-align:left;">
-x
</td>
<td style="text-align:left;">
eXecute the simulation (the default).
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="CopyModelBatchFiles-4"><span class="header-section-number">13.5.2.2</span> Copy/Package Model from Batch Files<a href="#CopyModelBatchFiles-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW can be run
in copy mode, which can be useful for transferring a model to another site or for making an archive of the input data. To copy a TUFLOW model, the -c switch must be included on the TUFLOW command line. The -nlc (no licence check) flag can be used to copy a model without the need for a TUFLOW licence. Further details can be found <a href="https://wiki.tuflow.com/Run_TUFLOW_From_a_Batch-file#Copy_a_TUFLOW_model">here</a>.</p>
<p>A licence free package model function that copies all input files for all events and scenarios defined in the model is also available using the -pm switch. If only a single set of events and scenarios is required, -c is preferable. Unlike the -c option, -pm does not read and process the data during the file copy, as such it is substantially faster than -c. The package model function does not require access to a TUFLOW licence. More information on the Package model function can be found <a href="https://wiki.tuflow.com/Run_TUFLOW_From_a_Batch-file#Package_a_TUFLOW_model">here</a>.</p>
<h4 class="hasAnchor" id="AdvancedBatchFiles-4"><span class="header-section-number">13.5.2.3</span> Advanced Batch Files<a href="#AdvancedBatchFiles-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Batch files can be set up so that they are more generic and easily
customised when moving from one project to another. Within the example
below, a variable, TUFLOWEXE, is used to define the path to the TUFLOW
executable, and a variable RUN is used to incorporate options such as
starting the simulation on a low priority and to minimise the console window when the process starts (/min option).</p>
<p><tblk><strong>set</strong> TUFLOWEXE=C:\ProgramFiles\TUFLOW\2023-03\TUFLOW_iSP_w64.exe<br />
<strong>set</strong> RUN=start “TUFLOW” /low /wait /min “<strong>%TUFLOWEXE%</strong>” -b<br />
<strong>%RUN%</strong> MR_H99_C25_Q100.tcf<br />
<strong>%RUN%</strong> MR_H99_C25_Q050.tcf<br />
<strong>%RUN%</strong> MR_H99_C25_Q020.tcf</tblk></p>
<p>The advantage of using variables in batch files is if the path to the TUFLOW executable
changes, or to run a different version of TUFLOW, it is just a simple
single line change in the batch file. In the above, note the use of
quotes around %TUFLOWEXE% in the definition for the RUN variable –
quotes are needed around file path names whenever they contain a space.
Also note there is no space between the variable name and the equals
sign.</p>
<p>For examples of batch files used for running multiple events and
different scenarios from the same .tcf file, see Sections <a href="#Events-3"><strong>??</strong></a>
and <a href="#Scenarios-3"><strong>??</strong></a>.</p>
<p>It is also possible to create control logic such as loops in a batch
file. For example, this could be used to loop through a large number of
events and scenarios such as the example <a href="https://www.tuflow.com/insights/2021_12-scenarios-events-and-variables/">here</a>.</p>
<p><tblk>:: This sets the variables as local, another batch file can use the same
variables<br />
SetLocal<br />
:: Set up variables<br />
<strong>set</strong> TUFLOWEXE=C:\Program Files\TUFLOW\Releases\2023-03\TUFLOW_iSP_w64.exe<br />
<strong>set</strong> RUN=start “TUFLOW” /low /wait /min “<strong>%TUFLOWEXE%</strong>” -b<br />
<strong>set</strong> A=Q010 Q020 Q050 Q100 Q200<br />
<strong>set</strong> B=10min 30min 60min 120min 270min<br />
:: Loop through each simulation<br />
FOR %%a in (%A%) do (<br />
  FOR %%b in (%B%) DO (<br />
    %RUN% -e1 %%a -e2 %%b filename_~e1~_~e2~.tcf<br />
  )<br />
)<br />
<strong>pause</strong>
</tblk></p>
<p>Further guidance on advanced batch files, including looping examples can
be found on this page of the <a href="https://wiki.tuflow.com/Run_TUFLOW_From_a_Batch-file">TUFLOW
Wiki</a>.</p>
<h3 class="hasAnchor" id="RunningHPC-3"><span class="header-section-number">13.5.3</span> Running TUFLOW HPC<a href="#RunningHPC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The front end of TUFLOW Classic and TUFLOW HPC are identical. No modification
of the model input is needed to utilise the TUFLOW HPC solver (in CPU or GPU
compute mode). Similarly, the output data is written by TUFLOW in
the same output formats and data types irrespective of whether Classic or HPC solvers are used.</p>
<p>The .tcf <a href="#tcfSolutionScheme">Solution Scheme</a> command is used to switch the solution scheme from TUFLOW Classic (the default) to TUFLOW HPC.</p>
<p><a href="#tcfHardware">Hardware</a> is used to access GPU hardware (CPU is the default). As such, to convert a model
from TUFLOW Classic to TUFLOW HPC and run using GPU hardware only
requires two additional TCF commands in most cases:</p>
<p><tcmd><a href="#tcfSolutionScheme">Solution Scheme</a></tcmd><teq> ==</teq><tblk> HPC </tblk><br />
<tcmd><a href="#tcfHardware">Hardware</a></tcmd><teq> ==</teq><tblk> GPU </tblk></p>
<p>With TUFLOW HPC it is possible to use multi-GPU cards to split the simulation across multiple cards to reduce run times or access more GPU memory. This is carried out either by using the <a href="#tcfGPUDeviceIDs">GPU Device IDs</a> command or with the processing unit command line switch “-pu<device id>”). More information can be found <a href="https://wiki.tuflow.com/HPC_Running_and_Converting_Models#Running_HPC_on_Multiple_GPU_Devices">here</a>. It is also possible to simulate multiple simulations on a single GPU card, should model memory requirements allow it, however, the simulations will slow down proportionately.</p>
<p>TUFLOW HPC simulations are started in the same manner as a standard
TUFLOW simulation and explained in Section <a href="#StartingaSim-3"><strong>??</strong></a>.</p>
<h4 class="hasAnchor" id="HPCGPUCommands-4"><span class="header-section-number">13.5.3.1</span> TUFLOW HPC and GPU Module Commands<a href="#HPCGPUCommands-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following .tcf commands (apart from <a href="#tcfTimestep">Timestep</a>) are
commands specific to the TUFLOW HPC solver:</p>
<table>
<caption>
<span id="tab:tab-TCFCommandsa">Table 117: </span><strong>TCF commands (apart from Timestep) specific to the TUFLOW HPC solver</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="#tcfControlNumberFactor">Control Number Factor</a>
</td>
<td style="text-align:left;">
The default HPC Courant, shallow wave celerity and diffusion control number limits can be reduced to effectively underclock the simulation. Using the above command factors all three control numbers. For example, a value of 0.8 reduces the default limits by 20%. Reducing the control number limits may be useful if the simulation is exhibiting erratic behaviour or numerical “noise”, although testing has found this is rare in real-world models, and if occurring is more likely to be a sign of poor data or poor model schematisation.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfHardware">Hardware</a>
</td>
<td style="text-align:left;">
<p>TUFLOW HPC can be run using CPU or GPU hardware. This command defines the hardware to be used for the compute. CPU is the default and will run a simulation using the Central Processing Unit (CPU). GPU will run the simulation using the Graphics Processor Unit (GPU).</p>
<p>When running TUFLOW HPC using the GPU hardware module, the pre (reading of data) and post processing (writing outputs) is managed by the standard TUFLOW CPU engine. This allows the user to utilise the extensive range of GIS input functionality available in TUFLOW.</p>
Simulation using GPU hardware requires the GPU Hardware Module in addition to a standard TUFLOW licence.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfHPCDPCheck">HPC DP Check</a>
</td>
<td style="text-align:left;">
<p>TUFLOW HPC is available in both single precision and double precision. If the simulation is started with the single precision version of TUFLOW, the HPC solver will utilise a single precision version. If the simulation is started with the double precision version of TUFLOW, error message <a href="https://wiki.tuflow.com/TUFLOW_Message_2420">ERROR 2420</a> will be output by default stating that the single precision version should be used.</p>
<p>The calculation method in TUFLOW HPC uses depth due to its explicit nature, unlike TUFLOW Classic that uses water level due to its implicit scheme. This means that precision issues when using the Classic solver, such as when applying a very small rainfall to a high elevation, are not applicable in HPC.</p>
<p>Unless testing shows that single and double precision produce significantly different results, use the single precision version of TUFLOW for all TUFLOW HPC simulations. Note: Double precision solutions on GPU cards can be four times slower than single precision! Also, NVIDIA Cards with a compute capability of 1.2 or less are only able to run single precision versions.</p>
The <a href="#tcfHPCDPCheck">HPC DP Check</a> command allows the user to disable the default setting of issuing <a href="https://wiki.tuflow.com/TUFLOW_Message_2420">ERROR 2420</a> should double precision be required.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfHPCTemporalScheme">HPC Temporal Scheme</a>
</td>
<td style="text-align:left;">
<p>Sets the order of the temporal solution. The default is the recommended 4<sup>th</sup> order temporal solution, therefore this command is usually not specified.</p>
We recommend the use of the 4<sup>th</sup> order temporal scheme as it is unconditionally stable with adaptive timestepping turned on and has been found to give accurate results and is results are not affected due to changing the timestepping. Lower order schemes save a little on memory requirements but are more prone to instability and in some cases unreliable results that are sensitive to the timestepping intervals.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfGPUDeviceIDs">GPU Device IDs</a>
</td>
<td style="text-align:left;">
Controls the GPU device or devices to be used for the simulation if multiple CUDA enabled GPU cards are available in the computer or on the GPU itself.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfSolutionScheme">Solution Scheme</a>
</td>
<td style="text-align:left;">
This command is used to select the desired solution scheme for the compute. Use “HPC” to call TUFLOW HPC’s finite volume 2<sup>nd</sup> order solver (recommended over the 1<sup>st</sup> order alternative).
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="#tcfTimestep">Timestep</a>
</td>
<td style="text-align:left;">
<p>If adaptive timestepping is active (the default), the timestep value is only used for the very first step. To allow the same command to be used for either a TUFLOW Classic or a HPC simulation the timestep value is divided by 10 for the initial HPC timestep, therefore, enter a timestep value similar to that that you would use for TUFLOW Classic.</p>
If adaptive timestepping is off, sets the fixed timestep. The timestep will always be much smaller than TUFLOW Classic’s timesteps as the scheme is explicit (TUFLOW uses an implicit scheme). As a general rule of thumb specify a timestep that is around one tenth of the TUFLOW Classic timestep you would use.
</td>
</tr>
</tbody>
</table>
<h4 class="hasAnchor" id="GPUCompatibility-4"><span class="header-section-number">13.5.3.2</span> Compatible Graphics Cards<a href="#GPUCompatibility-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>TUFLOW HPC’s GPU hardware module requires an NVIDIA CUDA enabled GPU card. A
list of CUDA enabled GPUs can be found on the following website:
<a href="https://developer.nvidia.com/cuda-gpus" class="uri">https://developer.nvidia.com/cuda-gpus</a>.</p>
<p>To check if your computer has an NVIDIA GPU and if it is CUDA enabled:</p>
<ol style="list-style-type: decimal">
<li>Right click on the Windows desktop.<br />
</li>
<li>If you see “NVIDIA Control Panel” or “NVIDIA Display” in the pop-up
dialogue, the computer has an NVIDIA GPU.<br />
</li>
<li>Click on “NVIDIA Control Panel” or “NVIDIA Display” in the pop-up
dialogue.<br />
</li>
<li>The GPU model should be displayed in the graphics card information.<br />
</li>
<li>Check to see if the graphics card is listed on the following
website: <a href="https://developer.nvidia.com/cuda-gpus" class="uri">https://developer.nvidia.com/cuda-gpus</a>.</li>
</ol>
<p>The following screen images show the steps outlined above, this may vary
slightly between NVIDIA GPU card models.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-NvidiaSettings"></span>
<img src="images/image170a.png" alt="**Accessing NVIDIA Control Panel from the Desktop**"  />
<p class="caption">
Figure 109: <strong>Accessing NVIDIA Control Panel from the Desktop</strong>
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-NvidiaGPUModel"></span>
<img src="images/image171a.png" alt="**NVIDIA GPU Model**"  />
<p class="caption">
Figure 110: <strong>NVIDIA GPU Model</strong>
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-NvidiaWebsite"></span>
<img src="images/image172.png" alt="**Check the Website for your NVIDIA Card**" width="80%" />
<p class="caption">
Figure 111: <strong>Check the Website for your NVIDIA Card</strong>
</p>
</div>
<p>More information on the card can be found in the “System Information”
section, which is accessed from the NVIDIA Control Panel. The system
information contains more details on the following:</p>
<ul>
<li>The number of CUDA cores.<br />
</li>
<li>Frequency of the graphics, processors and memory.<br />
</li>
<li>Available memory including dedicated graphics and shared memory.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-NVIDASystemInfo"></span>
<img src="images/image174a.jpg" alt="**NVIDIA System Information**" width="50%" />
<p class="caption">
Figure 112: <strong>NVIDIA System Information</strong>
</p>
</div>
<p>On the NVIDIA website, each CUDA enabled graphics card has a “Compute
Capability” listed. For cards with a compute capability of 1.2 or less,
only the single precision version of the GPU Module can be utilised.
<strong>However, benchmarking has indicated that the double precision version, except in rare situations,
is NOT required and that for nearly all GPU simulations, TUFLOW_iSP engine versions should
suffice. Refer to Section <a href="#iSPdSP-3"><strong>??</strong></a>.</strong></p>
<p>Extensive GPU hardware benchmarking has been undertaken to assist users
who are upgrading hardware for TUFLOW modelling, with numerous
hardware options tested for their speed performance. The
results are provided on the <a href="https://wiki.tuflow.com/Hardware_Benchmarking_(2018-03-AA)">TUFLOW
Wiki</a>.</p>
<h4 class="hasAnchor" id="UpdatingGPUDrivers-4"><span class="header-section-number">13.5.3.3</span> Updating NVIDIA Drivers<a href="#UpdatingGPUDrivers-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It is likely that the NVIDIA drivers will need to be updated periodically to the
latest version as the drivers shipped with Windows Operating Systems are not always up-to-date. To update, open the NVIDIA Control Panel (by right clicking on
the desktop and selecting NVIDIA Control Panel or NVIDIA Display). Once
the control panel has loaded, select Help &gt;&gt; Updates from the menu
items. For further guidance see the <a href="https://wiki.tuflow.com/GPU_Setup">Updating NVIDIA Drivers Wiki Page</a>.</p>
<p>If new drivers are available, please download and install these by
following the prompts.</p>
<p><strong>NOTE: Even if not prompted by the system, a restart is recommended
to ensure the new drivers are correctly detected prior to running any
simulations.</strong></p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-GPUDriverInfo"></span>
<img src="images/image175.png" alt="**Accessing Driver Updates from the NVIDIA Control Panel**" width="50%" />
<p class="caption">
Figure 113: <strong>Accessing Driver Updates from the NVIDIA Control Panel</strong>
</p>
</div>
</center>
<h4 class="hasAnchor" id="GPUNVLink-4"><span class="header-section-number">13.5.3.4</span> NVLink – Multi-GPU Performance (HPC Only)<a href="#GPUNVLink-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>NVLink is a connection (cable) for NVIDIA GPU devices providing peer-to-peer (direct) access
between GPUs, rather than having to communicate via the CPU, giving faster communication. For
example, data transfer rate for the RTX 2080 Ti is 32GB/s on the CPU PCIe and 100 GB/s via an
NVLink. The TUFLOW 2020-01 and later releases automatically recognises and utilises any peer-to-peer (p2p) access between GPUs that is possible according to the hardware setup. Peer-to-peer access typically requires an NVLink connector between GPUs, or in some cases peer-to-peer access can occur via the PCI bus if all cards are placed into TCC driver mode.</p>
<p>Whilst testing thus far has not produced a huge jump in performance, it is expected greater gains in the future will arise as it is increasingly possible to connect to large numbers of GPU devices, especially Cloud-based instances. The user can choose to disable peer-to-peer GPU access by specifying the .tcf command:
<a href="#tcfGPUPeertoPeerAccess">GPU Peer to Peer Access</a> <teq>==</teq><tblk> DISABLED | {ENABLED IF AVAILABLE}</tblk>. This can also be specified using the command line argument -p2p0 to disable, or -p2p1 to enable (if available). Peer-to-peer access in rare occasions has failed to work when a peer connection has been reported as possible by the NVIDIA console or API.</p>
<h4 class="hasAnchor" id="GPUTroubleshooting-4"><span class="header-section-number">13.5.3.5</span> Troubleshooting<a href="#GPUTroubleshooting-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If you receive the following error when trying to run the TUFLOW GPU
model:</p>
<p><tblk>TUFLOW GPU: Interrogating CUDA enabled GPUs …<br />
TUFLOW GPU: Error: Non-CUDA Success Code returned</tblk></p>
<p>Please try the following steps:</p>
<ol style="list-style-type: decimal">
<li>Check the compatibility of your GPU card and whether the latest
drivers are installed (see instructions in Section <a href="#GPUCompatibility-4"><strong>??</strong></a>).<br />
</li>
<li>Test with a user account that has administrator privileges as these
may be required for running computations on the GPU.<br />
</li>
<li>If multiple monitors are running from the video card, try running
with only a single monitor.</li>
</ol>
<p>If the above steps fail to get the simulation to run, please email the
NVIDIA system information (see Section <a href="#fig:fig-NVIDASystemInfo">112</a>) and
TUFLOW log file (.tlf) to <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<h3 class="hasAnchor" id="Running1D-3"><span class="header-section-number">13.5.4</span> Running TUFLOW 1D Only Simulations<a href="#Running1D-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW is set up to run as either a 2D model or as a 1D/2D model. It is, however, possible to run a TUFLOW 1D only model by including a small ‘dummy’ 2D domain within the model files. The 2D domain can be set up with the .tgc file and can be small, contain few cells of uniform material type and elevation values. The .tbc file will be set up so that the 2D domain does not receive any flows and therefore will not impact simulation runtimes. The 1D model can then be constructed within the .ecf and the simulation set up within the .tcf as per usual. An example model exists on the <a href="https://gitlab.com/tuflow-user-group/third-party-tools/other/1d_only_example_model">TUFLOW User Gitlab Page</a>.</p>
<h2 class="hasAnchor" id="TUFLOWExternalSchemes-2"><span class="header-section-number">13.6</span> Using TUFLOW with Flood Modeller, SWMM, XP-SWMM, 12D or from SMS<a href="#TUFLOWExternalSchemes-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW supports the linking with third-party external 1D schemes such as Flood Modeller (Jacobs), SWMM (USA EPA SWMM Version 5), XP-SWMM (Autodesk), 12D (12D Solutions) as well as integration within the SMS GUI (Aquaveo). Flood Modeller (formerly known as ISIS), XP-SWMM and 12D executables access
the TUFLOW hydraulic computational engine via the TUFLOW_LINK.dll. EPA SWMM (Version 5) is built into the standard TUFLOW release (2023-03-AF build or later). Flood Modeller, XP-SWMM, 12D and SMS are generally distributed with the latest supported version of TUFLOW at the time of release. It is possible to utilise different versions of TUFLOW with external 1D schemes using the processes described in the following sections.</p>
<h3 class="hasAnchor" id="SWMMSimulations-3"><span class="header-section-number">13.6.1</span> Using TUFLOW with EPA SWMM<a href="#SWMMSimulations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When running a TUFLOW - SWMM model, TUFLOW controls the execution of the simulation. SWMM input commands are specified within a <a href="#tcfSWMMControlFile">SWMM Control File</a> (.tscf). The SWMM control file is referenced in the TUFLOW Control File (.tcf) and the available commands listed in Appendix <a href="#TSCFCommands-1"><strong>??</strong></a>.</p>
<p>The SWMM Control File can reference multiple SWMM input files (inp) potentially varying by scenario. These input files are merged giving preferences to later files allowing for the overriding (upgrading) of existing features. After the input files are merged, the final SWMM model will be placed in the TUFLOW output folder and will be executed from there. The report and output files generated by the SWMM engine will also be placed in the TUFLOW output folder.</p>
<h3 class="hasAnchor" id="FMSimulations-3"><span class="header-section-number">13.6.2</span> Using TUFLOW with Flood Modeller<a href="#FMSimulations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Flood Modeller is shipped with the latest release of TUFLOW available at the time of development. It is possible to set Flood Modeller up to use a different version of TUFLOW. Before changing the version of TUFLOW, firstly check the compatibility between Flood Modeller and TUFLOW versions in Figure <a href="#fig:fig-FMTUFLOWVersionCompatability">98</a>. To utilise a newer, or different, version of TUFLOW with Flood Modeller, use the Flood Modeller interface to set the TUFLOW Engine File location to the path of the TUFLOW executable required in the Project Settings as shown in Figure <a href="#fig:fig-FMSettings">114</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-FMSettings"></span>
<img src="images/FM_Settings.png" alt="**Flood Modeller Settings**" width="50%" />
<p class="caption">
Figure 114: <strong>Flood Modeller Settings</strong>
</p>
</div>
</center>
<p>If running TUFLOW HPC utilising GPU hardware, it is important that the Flood Modeller folder contains copies of four TUFLOW files (aka kernels). The Flood Modeller folder is called the “bin” folder and is located (by default) in “C:\Program Files\Flood Modeller”. It is important that the kernel files in the Flood Modeller ‘bin’ folder match those of the TUFLOW version specified in the Flood Modeller project settings. For TUFLOW versions 2023-03-AA release or later, the names of the kernels have changed and are:</p>
<ul>
<li>hpcKernels_nSP.ptx<br />
</li>
<li>hpcKernels_nDP.ptx<br />
</li>
<li>qpcKernels_nSP.ptx<br />
</li>
<li>qpcKernels_nDP.ptx</li>
</ul>
<p>If you need to use a later release of TUFLOW or if you find that the link in a Flood Modeller-TUFLOW coupled model is failing with a <a href="https://wiki.tuflow.com/TUFLOW_Message_3999">ERROR 3999</a> message (and an error description of ‘ptx file version mismatch’ in the hpc.tlf), then browse to your TUFLOW engine folder, and copy the above four files and then paste them into your Flood Modeller bin folder (replacing the files there). If wanting to use the 2023-03-AA release or later, ensure the relevant kernels are in the Flood Modeller Bin folder and any other older TUFLOW .ptx files (ie, kernels_nSP.ptx, kernels_nDP.ptx) are removed.</p>
<p>It is also possible to run Flood Modeller-TUFLOW models using a batch file, which can be useful where different combinations of Flood Modeller and TUFLOW versions are required. This <a href="https://wiki.tuflow.com/Running_linked_Flood_Modeller_-_TUFLOW_Models#Batch_File">page</a> provides instructions on how to set this up.</p>
<h3 class="hasAnchor" id="TwelveDSimulations-3"><span class="header-section-number">13.6.3</span> Using TUFLOW with 12D<a href="#TwelveDSimulations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>12D is shipped and installed with the latest version of TUFLOW at the time of release. Although it is recommended to use the latest version of TUFLOW, it is possible to use other versions of TUFLOW by copying the TUFLOW engine files into the 12D installation folder, which is usually C:Files\12d\12dmodel\15.00_2d. It is possible to have multiple versions of 12D installed to allow multiple 12D-TUFLOW pairs to be installed.</p>
<p>There are two ways to run a TUFLOW model within 12D. The first is via the 2D Quick Analysis, which enables an efficient approach to using TUFLOW with a limited number of parameter options as shown in Figure <a href="#fig:fig-twelveD2DQuickSettings">115</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-twelveD2DQuickSettings"></span>
<img src="images/12D_2D_Quick_Analysis.png" alt="**12D 2D Quick Setting**" width="50%" />
<p class="caption">
Figure 115: <strong>12D 2D Quick Setting</strong>
</p>
</div>
</center>
<p>The second approach is to use the TCF editor allowing full TCF control, and String attribute editing which exposes all the TUFLOW functionality to a 12D user. The TCF editor is shown in Figure <a href="#fig:fig-twelveDTUFLOWProjectEditor">116</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-twelveDTUFLOWProjectEditor"></span>
<img src="images/12D_TUFLOW_Project_Editor.png" alt="**12D TUFLOW Project Editor**" width="50%" />
<p class="caption">
Figure 116: <strong>12D TUFLOW Project Editor</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="XPSWMMSimulations-3"><span class="header-section-number">13.6.4</span> Using TUFLOW with XP-SWMM<a href="#XPSWMMSimulations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>XP-SWMM is generally shipped with the latest release of TUFLOW available at the time of development.
To utilise a new version of TUFLOW with XP-SWMM, all of the .dll and .ptx
files described in the previous section need to be copied to the
location where XP SWMM accesses them (usually in the
same folder as the XP-SWMM .exe files).
Alternatively, modifying the path and environment variable found within
Advanced Settings allows the user to point to the location of the
TUFLOW .dll and .ptx files. They do not access the TUFLOW.exe file, although there
are no issues in copying this file as well. Note, it is always wise to
keep copies of any old .dll/.ptx files in a separate folder.</p>
<h3 class="hasAnchor" id="SMSSimulations-3"><span class="header-section-number">13.6.5</span> Using TUFLOW with SMS<a href="#SMSSimulations-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When running TUFLOW from SMS, SMS by default looks for a TUFLOW.exe in
the installation folder. To change this to the location where you have
placed the TUFLOW.exe and .dll/.ptx files, go to the Edit, Preferences, File
Locations tab as shown in Figure <a href="#fig:fig-SMSSettings">117</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-SMSSettings"></span>
<img src="images/image177.png" alt="**SMS Settings**" width="50%" />
<p class="caption">
Figure 117: <strong>SMS Settings</strong>
</p>
</div>
</center>
<h3 class="hasAnchor" id="OptimisingSims-3"><span class="header-section-number">13.6.6</span> Optimising Startup and Run Times<a href="#OptimisingSims-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Regardless of the method for initiating a TUFLOW simulation, a simulation start stats file (<simulation_name>_start_stats.txt) is output to the same location as the .tlf file (see Section <a href="#start-stats-3"><strong>??</strong></a>). This file contains information on the total time and the time elapsed for each stage of model initialisation. This can be used to identify the stages causing slow simulation start-up. If you have a problematic (slow starting) model, please email this file and corresponding .tlf file through to <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<p>From the 2018-03-AA release, a new output file is created named “<simulation_name>_run_stats.txt” (see Section <a href="#run-stats-3"><strong>??</strong></a>). This file contains the amount of time that TUFLOW spends in the 1D and 2D computations. At each mass balance output interval, the percentage of the total computational effort that TUFLOW has spent in 1D calculations, 2D calculations and other is output to the run_stats file. The “other” column includes a variety of tasks that are neither 1D or 2D computations, such as writing of outputs, and transfer of data to GPU (if running on GPU devices). “Other” also includes time spent within an external 1D solver.</p>
<h4 class="hasAnchor" id="Improved1DInputs-4"><span class="header-section-number">13.6.6.1</span> Improved pre-processing of 1D Model Inputs<a href="#Improved1DInputs-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the 2020-01 release, reading and processing of 1D inputs has been
significantly improved, particularly for large urban drainage models
(&gt;1,000 1D pipe network elements). For a tested model with 25,000 1D
channels, the start-up was approximately 40 times faster with the
2020-01 release compared to the previous 2018-03 release changing the start-up
time from nearly two hours to less than 3 minutes. No changes in model
files is required to implement this improved pre-processing time.</p>
<h4 class="hasAnchor" id="SGSParallelProcessing-4"><span class="header-section-number">13.6.6.2</span> Parallel Processing for SGS initialisation<a href="#SGSParallelProcessing-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With the default SGS Method C (the default if “<tblk><a href="#tcfSGS">SGS</a> </tblk><teq>==</teq><tblk> ON</tblk>”), the SGS elevations are retained in memory throughout the pre-processing stage, with the generation of the storage and face hydraulic data curves occurring only once at the end of the pre-processing. This is a computationally intense exercise, particularly for large models with small SGS sample distances. To speed up model initialisation, this has been parallelised to utilise multiple CPU cores.</p>
<p>By default, all CPU threads will be used for final SGS elevation pre-processing unless the number of threads (-nt[thread count]) command line argument has been specified. For example, to run on 8 threads the command line argument “-nt8” would be used. There is no check for thread licensing used for pre-processing. If the number of threads specified in the command line argument exceeds the number of threads available, all threads are used.</p>
<p>At the end of the .tgc file, after all elevation datasets have been processed, an XF file is written if the <a href="#tcfXFFiles">XF Files</a> command is set to on (default). The XF file is written to an “xf” folder, which sits in the same location as the .tgc. The XF file is then used for any subsequent simulations for optimised pre-processing performance. To avoid re-processing when changes are made to .tgc data other than elevation (e.g. active cells, materials, soils, etc.), the XF file is not written with the same filename as the .tgc. Instead, the .xf will be prefixed by “hpc” or “qdt” for HPC single grid and Quadtree simulations respectively and includes the nesting level and cell size. Any text set with the .tcf command <a href="#tcfXFFilesIncludeinFilename">XF Files Include in Filename</a> is included.</p>
<p>When reading the pre-processed SGS XF file, a check is done on the final SGS elevations, if these are consistent then the XF file is used.</p>
<h4 class="hasAnchor" id="OptimisingMultiGPUPerformance-4"><span class="header-section-number">13.6.6.3</span> Optimising Multi-GPU Performance (HPC Only)<a href="#OptimisingMultiGPUPerformance-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If a model is simulated across multiple GPU devices, one of the devices (usually the one with the
most wet cells) will be controlling the speed of the simulation and the other devices will be underutilised. By default, TUFLOW HPC divides a model equally over multiple GPU devices. However,
for real-world models, it is usual for the GPUs to have an inequitable amount of workload due to the number of active cells and number of wet cells, and this can change throughout the simulation as the model wets and dries.</p>
<p>From the TUFLOW 2020-01 release it is possible to distribute the workload unequally to the GPU
devices. During a simulation the workload efficiency of each GPU is output to the console and to
the .tlf file with a suggested distribution provided at the end of the simulation. A number of iterations may be required to fully optimise the distribution.</p>
<p>For example, a model simulated across four GPU devices reported at the end of the simulation in the .tlf file:</p>
<p><tblk>Relative device loads: 60.3% 100.0% 83.7% 53.2%<br />
HPC Suggested workload balance HPC Device Split == 1.23, 0.74, 0.89, 1.40.</tblk></p>
<p>The command <tblk><a href="#tcfHPCDeviceSplit">HPC Device Split</a> </tblk><teq>==</teq><tblk> 1.23, 0.74, 0.89, 1.40</tblk> was added to the .tcf file for the next simulation producing the improved device workload efficiencies below and a 20% faster run time.</p>
<p><tblk>Relative device loads: 100.0% 96.1% 96.8% 94.6%</tblk></p>
<p><strong>Note: The benefit depends on the model, but if you have a significant variation in workload efficiencies between GPU devices this feature should provide a noticeable decrease in run times.</strong></p>
<h3 class="hasAnchor" id="AutoTerminateOptions-3"><span class="header-section-number">13.6.7</span> Auto Terminate (Simulation End) Options<a href="#AutoTerminateOptions-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW Classic and HPC include an Auto-Terminate feature for stopping
simulations after the flood peak has been experienced within the simulation. This can help project efficiencies by avoiding unnecessary model simulation time once the peak flood extent has been achieved.</p>
<p>The 2D cells that are monitored to trigger the auto-termination are
controlled by specifying a value of 0 (exclude) or 1 (include) using the
.tcf commands: <a href="#tcfSetAutoTerminate">Set Auto Terminate</a> and <a href="#tcfReadGISAutoTerminate">Read GIS
Auto Terminate</a>.</p>
<p>For example, in the below, all cells are first set to be excluded for
monitoring followed by the reading of a GIS layer to set cells
individually.</p>
<p><tcmd><a href="#tcfSetAutoTerminate">Set Auto Terminate</a></tcmd> <teq>==</teq><tblk> 0</tblk><br />
<tcmd><a href="#tcfReadGISAutoTerminate">Read GIS Auto Terminate</a></tcmd> <teq>==</teq><tblk>
..\model\gis\2d_AT_001_R.shp</tblk></p>
<p>At each <a href="#tcfMapOutputInterval">Map Output Interval</a> the monitored cells
are compared against two criteria:</p>
<ol style="list-style-type: decimal">
<li>The percentage of the wet cells that have become wet since the last
map output interval.<br />
</li>
<li>The velocity-depth product at the current timestep compared to the
tracked maximum.</li>
</ol>
<p>For the percentage of cells that have become wet since the last
interval, the maximum allowable value is controlled with the .tcf
command:</p>
<p><tcmd><a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell Tolerance</a>&lt;/&gt;
<teq>== </teq><tblk>&lt;maximum_allowable_%_of_newly_wet_cells&gt;</tblk></p>
<p>If set to 0, then if any monitored cells have become wet since the last
map output the simulation continues. If set to a value of 5, then up to
5% of monitored cells can become wet since the last map output while still
triggering an auto-termination of the simulation.</p>
<p>For the velocity-depth tolerance, at each output interval the velocity-depth product is compared to the tracked maximum value. If the current
dV product is within the specified tolerance <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value
Tolerance</a> the simulation is not
terminated.</p>
<p>The total number of cells that are allowable within the specified range
is controlled with <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell Tolerance</a>. If set to a value of 1, then up to 1% of monitored cells can be within the tolerance value
without triggering an auto-termination of the simulation. The larger the <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV
Value Tolerance</a> the further the dV
product needs to have dropped from the peak value.</p>
<p>The time that the auto-terminate feature commences can be controlled
using the .tcf command <a href="#tcfAutoTerminateStartTime">Auto Terminate Start Time</a> otherwise the <a href="#tcfStartTime">Start Time</a> is used.</p>
<p><strong>Note, this option is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</strong></p>
<h2 class="hasAnchor" id="ResultsReplication-3"><span class="header-section-number">13.7</span> Reproducibility of Results<a href="#ResultsReplication-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A key concern with hydraulic modelling is the replication of results across a range of hardware. The following sections provide some information to be aware of when looking at the replication of results.</p>
<h3 class="hasAnchor" id="ResultsReplicationClassic-3"><span class="header-section-number">13.7.1</span> TUFLOW Classic (CPU only)<a href="#ResultsReplicationClassic-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The TUFLOW Classic engine is written in Fortran and compiled for
Windows™ with Intel™’s Fortran compiler, leading to well optimised CPU
code. The computational algorithm is implicit in nature and difficult
to parallelise for multi-thread execution. As a
result race conditions do not exist and a repeat run of a model with the
same inputs, with the same executable on the same type of CPU, should
yield bit-wise identical results (i.e. a subtraction of results should
be exactly zero). If a user finds that repeat model runs (same
executable, same CPU) do not yield identical results then please contact
<a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> as this may indicate a memory access error or an
un-initialised variable in the code.</p>
<p>A repeat model run with the same executable but on a different type of
CPU (e.g. Intel Xeon vs i9, or AMD Epyc vs Ryzen, or Intel vs AMD) may
produce very slight differences in results due to the CPUs having
different instruction set extensions that may or may not be utilised.
Such differences are typically less than 1 mm water surface elevation
but, in some locations, the differences can become accentuated due to
changes in overtopping or an operational structure threshold.</p>
<p>Even though the source code for TUFLOW Classic is currently seeing
little development, as we update Intel Fortran compilers, different
releases of TUFLOW can be expected to show minor differences even on the
same CPU.</p>
<h3 class="hasAnchor" id="ResultsReplicationHPCCPU-3"><span class="header-section-number">13.7.2</span> TUFLOW HPC (incl. Quadtree) on CPU<a href="#ResultsReplicationHPCCPU-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The TUFLOW HPC engine (incl Quadtree) is written in C++ with NVIDIA™
CUDA GPU kernels. The kernels have been carefully written so that they
can be compiled for both GPU and CPU execution. When compiled for CPU
execution, the Microsoft Visual Studio compiler is used and the code is
built into the dynamic link libraries (DLLs) in the executable bundle.
Similar to TUFLOW Classic, repeat model runs of the same model (same
TUFLOW executable, same CPU type) should produce bit-wise identical
results. Again, if differences are observed please contact
<a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> as this may indicate an issue that needs to be
addressed.</p>
<p>As the TUFLOW HPC and Quadtree solvers are fundamentally different to TUFLOW
Classic, there will always be minor differences between solutions from
the different schemes even when using the same turbulence model and
without sub-grid sampling (SGS). As TUFLOW HPC and Quadtree both default to using the
Wu turbulence model while Classic can only use the Smagorinksy model,
the differences will be more significant when run with the default
settings.</p>
<h3 class="hasAnchor" id="ResultsReplicationHPCGPU-3"><span class="header-section-number">13.7.3</span> TUFLOW HPC (incl. Quadtree) on GPU<a href="#ResultsReplicationHPCGPU-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When the CUDA kernels are compiled for GPU execution, a GPU agnostic
intermediate code file (ptx) is produced with the final compilation of
that being done on a just-in-time basis by the GPU driver on the machine
that the executable is running on. The results may now depend not just
on the version of TUFLOW executable used and type of CPU (since the
pre-processing of the model input is still performed on CPU), but also
on the type of GPU <em>and</em> the version of the GPU driver installed. GPUs
have thousands of cores that work in parallel. However, the kernels have
been carefully written to avoid race conditions, and the adaptive
timestep control avoids relying on variables summed with atomic
additions of floating point data. Therefore, provided these factors
(version of TUFLOW, CPU type, GPU type, GPU driver version) are kept
constant, a repeat model run will yield bit-wise reproducible results.</p>
<p>Also note that the GPU cores use different hardware for the floating
point operations and the GPU compiler may re-optimise the sequence of
instructions for complex lines of code compared to the CPU compiler.
Therefore, even when using the same version of TUFLOW HPC, very small
differences in the solution can be seen when the model is run on GPU
compared to running on CPU. These differences are typically less than
1 mm water surface elevation but again, in some locations, the differences can become accentuated due to
changes in overtopping or an operational structure threshold.</p>
<h3 class="hasAnchor" id="ResultsReplicationHPCMultiThread-3"><span class="header-section-number">13.7.4</span> TUFLOW HPC (incl. Quadtree) on multiple GPUs / CPU threads<a href="#ResultsReplicationHPCMultiThread-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC (incl. Quadtree) support running a model across multiple GPU
devices in one computer. In this case the model is decomposed into
subdomains, and model data are exchanged and sychronised at the domain
boundaries as required. Care has been taken to ensure that results when
run on multiple GPUs (of all the same GPU type) are bit-wise identical
to when run on a single GPU. If differences are observed between results
from a run on multiple devices vs a single device please contact
<a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<p>Likewise when running on multiple CPU threads (default is four unless
specified), the model results should be bit-wise identical to when
running on a single thread (<a href="#tcfCPUthreads">CPU Threads</a> <teq>==</teq><tblk> 1</tblk>). Please contact us at <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> if found
otherwise.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Checks-and-Logs-1"><span class="header-section-number">14</span> Checks and Log Files<a href="#Checks-and-Logs-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="Log-Introduction-1"><span class="header-section-number">14.1</span> Introduction<a href="#Log-Introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter of the Manual describes the check, log and quality control
outputs from TUFLOW. This encompasses the following outputs:</p>
<ul>
<li>The Console Window (Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>);</li>
<li>Message boxes (Section <a href="#MessageBox-2"><strong>??</strong></a>);</li>
<li>Local and Global .log (Section <a href="#SimLog-2"><strong>??</strong></a>);</li>
<li>Simulation log files (e.g. .tlf, hpc.tlf, .tsf) (Section <a href="#SimLogFiles-2"><strong>??</strong></a>);</li>
<li>1D Output File (.eof) (Section <a href="#EOF-2"><strong>??</strong></a>);</li>
<li>Check Files (Section <a href="#CheckLayers-2"><strong>??</strong></a>); and</li>
<li>Mass Balance Outputs (Section <a href="#MB-2"><strong>??</strong></a>).</li>
</ul>
<p>Viewing and processing of results are described in Chapter <a href="#Viewing-Output-1"><strong>??</strong></a>.</p>
<h2 class="hasAnchor" id="ConsoleDisplay-2"><span class="header-section-number">14.2</span> Console (DOS) Window Display<a href="#ConsoleDisplay-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW displays a lot of information to the Console (DOS) Window during
the data input and simulations stages. However, this typically processes
so quick, that it may be difficult to read. The log file (.tlf) (Section
<a href="#SimLogFiles-2"><strong>??</strong></a>) and check files (Section <a href="#CheckLayers-2"><strong>??</strong></a>) contains this
information in much more usable formats, most of which is geo-referenced GIS layers. However, should you wish, you can look back through
the Window buffer to establish where in the input data process the
problem occurs.</p>
<p>After a model has completed initialising its input data and has started
its computations, the simulation status is displayed. The default display frequency for TUFLOW Classic is every timestep and for TUFLOW HPC on GPU is every 100 timesteps. To change the frequency of display, the <a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a> command can be used. Where different timesteps are used for different domains, the display interval is based on the largest timestep. The console window contains a lot of useful information to
keep an eye on your simulations as they progress. Whilst it isn’t expected to continuously watch the simulations DOS window, it is useful to glance at occasionally to check that your simulations are “happy”.</p>
<p>If the Console window does not appear (i.e. TUFLOW.exe won’t start) there could be a few reasons why, this is discussed on the <a href="https://wiki.tuflow.com/TUFLOW_crashing#Introduction">TUFLOW Wiki</a>.</p>
<p>If you are running from a batch file and the window briefly appears, then disappears straight away, you can force the window to stay open so you can diagnose the issue. This is discussed in Section <a href="#ConsoleDisappear-3"><strong>??</strong></a>.</p>
<h3 class="hasAnchor" id="Classic-3"><span class="header-section-number">14.2.1</span> TUFLOW Classic<a href="#Classic-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once the hydraulic calculations commence, the TUFLOW Classic Console Window appears as something similar to that
shown below:</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image179"></span>
<img src="images/Classic_Console.png" alt="Example TUFLOW Classic Console (DOS) Display Window" width="80%" />
<p class="caption">
Figure 118: Example TUFLOW Classic Console (DOS) Display Window
</p>
</div>
</center>
<p>The following information is shown along each line in order of
occurrence.</p>
<ul>
<li>Number of timesteps completed, based on the largest timestep of all 1D
and 2D domains.<br />
</li>
<li>Simulation time in hhhh:mm:ss.<br />
</li>
<li>“-d” followed by two numbers:
<ul>
<li>The <u>maximum</u> number of 1D nodes per timestep that experienced
negative depths below ‑0.1m <u>since</u> the previous display line.<br />
</li>
<li>The <u>maximum</u> number of 2D cell sides per timestep that
experienced negative depths below ‑0.1m <u>since</u> the previous
display line.<br />
The locations of these negative depths are output as warnings in the _messages layer (see Section <a href="#Messages-3"><strong>??</strong></a>). Negative depths indicate the model is having difficulty in convergence at that location, which may lead to an instability. See also Section <a href="#tuflowinstability-3"><strong>??</strong></a>.<br />
</li>
</ul></li>
<li>“Wet” followed by number of wet or active 2D cells.<br />
</li>
<li>If automatic weir switching is active (see <a href="#tcfFreeOverfall">Free Overfall</a>) the next information is “CS” (<u>C</u>ell
<u>S</u>ides) followed by two numbers as follows:
<ul>
<li>The number of cell sides where upstream controlled friction flow
occurred (see <a href="#tcfSupercritical">Supercritical</a>).<br />
</li>
<li>The number of cell sides where upstream controlled broad-crested
weir flow occurred (see <a href="#tcfFreeOverfall">Free Overfall</a>).<br />
</li>
</ul></li>
<li>If the free-overfall algorithm is set to ON WITHOUT WEIRS (see <a href="#tcfFreeOverfall">Free
Overfall</a>), the next information is “FO” followed by
the number of cell sides where the free-overfall algorithm is being
applied. Note: this option is now rarely used in lieu of the automatic
weir and supercritical flow options.<br />
</li>
<li>If <a href="#tcfDisplayWaterLevel">Display Water Level</a> was specified, the
next piece of information is a “GL” (Gauge Level) followed by the
water level at the location indicated. This is useful to monitor the
rise and fall of the water level at a key location.<br />
</li>
<li>If <a href="#tcfMassBalanceOutput">Mass Balance Output</a> is set to ON, “CE”
(Cumulative Error) followed by three percentages is displayed to show
the cumulative mass error as follows:
<ul>
<li>The whole of model % cumulative mass error for all 1D and 2D
domains.<br />
</li>
<li>The % cumulative mass error for all 1D domains.<br />
</li>
<li>The % cumulative mass error for all 2D domains.<br />
</li>
</ul></li>
<li>If <a href="#tcfMassBalanceOutput">Mass Balance Output</a> is set to ON the
following are displayed after the “CE” percentages:
<ul>
<li>“Qi” followed by the total flow into the model (all domains) in
m<sup>3</sup>/s. If the inflow exceeds 999999m<sup>3</sup>/s or
falls below -99999m<sup>3</sup>/s, the flow is expressed in units of
1,000m<sup>3</sup>/s and a single quote symbol is displayed after
the number. A double quote symbol indicates the flow is expressed in
units of 1,000,000m<sup>3</sup>/s.<br />
</li>
<li>“Qo” followed by the total flow out of the model (all domains) in
m<sup>3</sup>/s. If the outflow exceeds 999999m<sup>3</sup>/s or
falls below -99999m<sup>3</sup>/s, the flow is expressed in units of
1,000m<sup>3</sup>/s and a single quote symbol is displayed after
the number. A double quote symbol indicates the flow is expressed in
units of 1,000,000m<sup>3</sup>/s.<br />
</li>
<li>“dV” followed by the change in volume in m<sup>3</sup> of the model
(all domains) since the last display time. If the change in volume
exceeds 999999m<sup>3</sup> or falls below -99999m<sup>3</sup>, the
amount is expressed in units of 1,000m<sup>3</sup> (mL) and a single
quote symbol is displayed after the number. A double quote symbol
indicates the change in volume is expressed in units of
1,000,000m<sup>3</sup>.<br />
</li>
</ul></li>
<li>If maximums are being tracked (i.e. <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a> is set to ON or ON MAXIMUMS ONLY),
additional information will be displayed to the Console Window and .tlf file for each <a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a>. Three numbers are displayed
after “Mx” at the end of each line. The first two numbers are the
percentage of 1D nodes and percentage of 2D cells that reached a new
maximum in the last computational timestep. The third number is the
time in decimal hours since no new maximum was recorded anywhere
within the model. For example, “Mx 10 21 0.0” indicates that 10% of 1D
nodes and 21% of 2D cells recorded a new maximum last timestep, and
the time since the last recorded maximum is zero. Once all 1D nodes
and 2D cells have reached their maximums the third (time) value will
increase above zero.</li>
</ul>
<p>The negative depth numbers, cumulative error percentages, inflow,
outflow and change in volume figures are very useful to gauge the health
of the model. Frequent negative depths, poor cumulative error (&gt;1%,
noting that some models will show a high mass error at the start, which
can be acceptable provided it diminishes quickly) and “bouncy” inflow,
outflow and change in volume values are all indicators of an unhealthy
model. For further discussion see Section <a href="#QAIntroduction-2"><strong>??</strong></a>.</p>
<p>Whenever the map output is written (see <a href="#tcfStartMapOutput">Start Map
Output</a> and <a href="#tcfMapOutputInterval">Map Output
Interval</a>), a line “Writing Output at:” is
displayed, followed by the simulation clock time and CPU time. If the
CPU time is significantly lower than the clock time, then either the
simulation was paused for a period of time (see Section <a href="#QuickEdit-3"><strong>??</strong></a>), the CPU
is overloaded or the CPU is not being fully utilised (having Hyper
Threading switched on can cause this to occur).</p>
<h3 class="hasAnchor" id="HPC-3"><span class="header-section-number">14.2.2</span> TUFLOW HPC<a href="#HPC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once the hydraulic calculations commence, the TUFLOW HPC Console Window appears similar to the two images shown below:</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-image180"></span>
<img src="images/HPC_Console.png" alt="Example TUFLOW HPC Console (DOS) Display Windows" width="80%" />
<p class="caption">
Figure 119: Example TUFLOW HPC Console (DOS) Display Windows
</p>
</div>
</center>
<p>For lines starting with “HPC:” the following information is shown along each line in order of
occurrence.</p>
<ul>
<li>Number of timesteps completed, based on the largest timestep of all 1D and 2D domains.<br />
</li>
<li>Simulation time in hhhh:mm:ss.<br />
</li>
<li>Timestep Control Numbers:
<ul>
<li>Nu: Courant Number.<br />
</li>
<li>Nc: Shallow Wave Celerity Number.<br />
</li>
<li>Nd: Diffusion Number.<br />
</li>
</ul></li>
<li>Number of wet cells.<br />
</li>
<li>Volume.<br />
</li>
<li>Computed timestep.<br />
</li>
<li>The timestep efficiency.</li>
</ul>
<p>If the model contains virtual pipe networks, the following additional information is shown:</p>
<ul>
<li>qInlet: flow extracted from the 2D domain.</li>
<li>qSurcharge: flow surcharging out of inlets, due to the outlet flow being limited.</li>
<li>qOutput: flow entering the 2D domain.</li>
</ul>
<p>For lines starting with “SIM:”, which occur at regular simulation time increments, additional statistics are output:</p>
<ul>
<li>Simulation time in hhhh:mm:ss.<br />
</li>
<li>“-d” followed by two numbers:
<ul>
<li>The <u>maximum</u> number of 1D nodes per timestep that experienced
negative depths below ‑0.1m <u>since</u> the previous display line.<br />
</li>
<li>The <u>maximum</u> number of 2D cell sides per timestep that
experienced negative depths below ‑0.1m <u>since</u> the previous
display line.<br />
</li>
</ul></li>
<li>Three compute percentage values:
<ul>
<li>0D % time spent on pre/post processing and CPU/GPU communication
overhead.<br />
</li>
<li>1D % time spent on 1D compute.<br />
</li>
<li>2D % time spent on 2D compute.<br />
</li>
</ul></li>
<li>“CE” (Cumulative Error) followed by three percentages is displayed to
show the cumulative mass error as follows:
<ul>
<li>The whole of model % cumulative mass error for all 1D and 2D
domains.<br />
</li>
<li>The % cumulative mass error for all 1D domains.<br />
</li>
<li>The % cumulative mass error for all 2D domains.</li>
</ul></li>
<li>Model volumes:
<ul>
<li>“Vi” followed by the total volume of water into the model in
m<sup>3</sup>/s. If the volume in exceeds 999999m<sup>3</sup> or falls below -99999m<sup>3</sup>, the
amount is expressed in units of 1,000m<sup>3</sup> (mL) and a single
quote symbol is displayed after the number. A double quote symbol
indicates the change in volume is expressed in units of
1,000,000m<sup>3</sup>.</li>
<li>“Vo” followed by the total volume of water out of the model (all domains) in
m<sup>3</sup>/s. If the volume out exceeds 999999m<sup>3</sup> or falls below -99999m<sup>3</sup>, the
amount is expressed in units of 1,000m<sup>3</sup> (mL) and a single
quote symbol is displayed after the number. A double quote symbol
indicates the change in volume is expressed in units of
1,000,000m<sup>3</sup>.<br />
</li>
<li>“dV” followed by the change in volume in m<sup>3</sup> of the model
(all domains) since the last display time. If the change in volume
exceeds 999999m<sup>3</sup> or falls below -99999m<sup>3</sup>, the
amount is expressed in units of 1,000m<sup>3</sup> (mL) and a single
quote symbol is displayed after the number. A double quote symbol
indicates the change in volume is expressed in units of
1,000,000m<sup>3</sup>.</li>
</ul></li>
</ul>
<h3 class="hasAnchor" id="ConsoleDisappear-3"><span class="header-section-number">14.2.3</span> The Console (DOS) Window Does Not Appear<a href="#ConsoleDisappear-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you are running from a batch file and the window briefly appears,
then disappears straight away, you can force the window to stay open so
you can diagnose the issue.</p>
<p>To do this, insert “pause” at the end of the batch file and remove any Start “TUFLOW”, -b and/or -t switch. For example:</p>
<p><tblk>C:\TUFLOW\Releases\2023-03-AF\TUFLOW_iSP_w64.exe MR_H99_C25_Q100.tcf<br />
Pause</tblk></p>
<p>Using this simple batch file will start the simulation in the main batch window and give you greater control. Adding “Pause” at the end of the batch will keep the window open.</p>
<p>Common troubleshoot tips can be found <a href="https://wiki.tuflow.com/Tutorial_Troubleshooting_QGIS#Troubleshooting_Steps">here</a>.</p>
<h3 class="hasAnchor" id="QuickEdit-3"><span class="header-section-number">14.2.4</span> Unexpected Simulation Pause (DOS Quick Edit Mode)<a href="#QuickEdit-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Windows 10 and onwards includes a Quick Edit mode option in the DOS window that can
artificially pause TUFLOW simulations. The Quick edit mode is initiated
if the cursor clicks somewhere on the DOS window while a TUFLOW
simulation is running. Quick Edit mode can be deactivated to avoid this
issue.</p>
<ol style="list-style-type: decimal">
<li>Right click the DOS window header. Select “Properties”.<br />

<center>
<img src="images/image184a.png" />
</center></li>
<li>Uncheck “Quick Edit Mode”. This will turn it off for the current session.<br />

<center>
<img src="images/image185a.png"  />
</center></li>
<li>Update the default DOS window properties so this becomes the default mode. Right click the DOS window header. Select “Defaults”.<br />
</li>
<li>Uncheck “Quick Edit Mode”, just like in the “Properties” dialog box. This will turn Quick Edit Mode off for all future sessions.</li>
</ol>
<h3 class="hasAnchor" id="ConsoleShortcut-3"><span class="header-section-number">14.2.5</span> Stopping the Console Window<a href="#ConsoleShortcut-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is possible to stop a simulation by using Ctrl+C. When pressed the first time (with the TUFLOW console as the active window) the dialogue below is displayed asking whether to stop the simulation. Clicking on “Yes” will finish the simulation, write all output files and release any network dongle licence. The simulation is logged as being INTERRUPTED in the .tlf and .log files (refer to Section <a href="#SimLog-2"><strong>??</strong></a>). Clicking on “No” will continue the simulation.</p>
<center>
<img src="images/image187.png"
style="width:2.51042in;height:1.67708in" />
</center>
<p>Ctrl+C is recommended instead of manually cancelling the simulation via clicking the display window close button. TUFLOW will not finalise writing the output result files if the simulation is cancelled via clicking the display window close button. For example, result maximums and minimums will not be written, even if <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a> is set to ON.</p>
<p>In versions of Windows prior to Windows 10, it was possible to pause output processing in a terminal window by pressing Ctrl+S, which would effectively suspend TUFLOW. In modern versions of Windows, you may be able to achieve the same by either pressing Ctrl+S, the Pause button, or selecting text in the terminal window with the mouse (if quick edit mode is turned on, see Section <a href="#QuickEdit-3"><strong>??</strong></a>). This depends on the versions of software used and their configuration.</p>
<h3 class="hasAnchor" id="ConsoleCustomisation-3"><span class="header-section-number">14.2.6</span> Customisation of Console Window<a href="#ConsoleCustomisation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The windows and buffer sizes of the Console Window are by default set by TUFLOW. During the model input stages the window is set to 122 characters wide and 30 lines high. During the hydraulic calculations the width varies depending on the length of the output to the window and the height is set to 40 lines.</p>
<p>It is possible to manually set the Console Window buffer as well as change the font and colours of the TUFLOW window. The latter may be useful when differentiating different models on a shared computer. For further information, refer to guidance found on the <a href="https://wiki.tuflow.com/DOS_Window_Tips">TUFLOW
Wiki</a>.</p>
<h3 class="hasAnchor" id="ErrorLevel-3"><span class="header-section-number">14.2.7</span> TUFLOW Windows ERROR LEVEL Reporting<a href="#ErrorLevel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If TUFLOW exits unsuccessfully, e.g. an error during initialisation or
due to the model going unstable an ERRORLEVEL is reported to the Windows
operating system. This value is 1 if a premature exit has been
encountered and 0 for a normal exit. This can be useful for tracking
simulation issues if using batch files, scripts or a simulation run
manager. In a batch file the error level can be obtained with the
%errorlevel% variable. For example:</p>
<p><tblk>Start “TUFLOW” /wait TUFLOW_iSP_w64.exe runfile.tcf<br />
echo error level is %errorlevel%</tblk></p>
<p>Prior to the 2018-03-AA version of TUFLOW, no error level was reported.</p>
<h2 class="hasAnchor" id="MessageBox-2"><span class="header-section-number">14.3</span> Message Boxes<a href="#MessageBox-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Windows message boxes are used to alert the user to an input problem and
when a simulation has stopped/finished, or is unable to start. This can
be suppressed with the -nmb input switch as described in Table <a href="#tab:tab-TUFLOWOptions">116</a>.</p>
<p>Some example message boxes are shown below.</p>
<center>
<img src="images/image188.png" style="width:3.06in;height:1.37in" /> <img src="images/image189.png" style="width:2.87in;height:1.36in" /> <img src="images/image190.png" style="width:2.42in;height:1.36in" />
</center>
<h2 class="hasAnchor" id="SimLog-2"><span class="header-section-number">14.4</span> Simulations .log<a href="#SimLog-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW activity (when simulations are started, finished, interrupted) is
written to two log files:</p>
<ul>
<li>A local file named “\_ TUFLOW Simulations.log”, located in the same
folder as the .tcf file. This file is described in Section <a href="#LocalLog-3"><strong>??</strong></a>.</li>
<li>A global log file that can optionally be located in a fixed location
on your organisation’s intranet. By default this is written to “C:\ProgramData\TUFLOW\<username>\log\_All TUFLOW Simulations.log”. To alter the location of this, use the <a href="#tcfSimulationsLogFolder">Simulations Log
Folder</a> tcf command. This global log file can also be disabled by setting the <a href="#tcfSimulationsLogFolder">Simulations Log
Folder</a> command to “DO NOT USE”. This file is described in Section <a href="#GlobalLog-3"><strong>??</strong></a>.</li>
</ul>
<h3 class="hasAnchor" id="LocalLog-3"><span class="header-section-number">14.4.1</span> Local .log File<a href="#LocalLog-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “\_ TUFLOW Simulations.log” file is a text file containing a record
of every simulation initiated from that folder, and is located in the
same folder as the .tcf file(s). For the 2023-03 release, information contained in the file
includes the following:</p>
<ul>
<li>Date and time of the log entry;<br />
</li>
<li>Dongle ID (if applicable);<br />
</li>
<li>Type of TUFLOW licence. The notation on the type of licence varies
depending on the licence origin as follows:
<ul>
<li>WIBU Licence:
<ul>
<li>LOC3/4 for a Local (Standalone) Licence (the numbers in this
example indicate it was the third licence out of four available).<br />
</li>
<li>NWK03/10 for a Network Licence (the numbers in this example
indicate it was the third licence out of ten available).<br />
</li>
</ul></li>
<li>Jacobs (Flood Modeller) Software Licence:
<ul>
<li>“HalcS” for a local Standalone licence<br />
</li>
<li>“HalcN” for a network licence<br />
</li>
</ul></li>
<li>XP-Software Licence:
<ul>
<li>“XP” for all types of licences.<br />
</li>
</ul></li>
<li>A Tutorial Model (no dongle required):
<ul>
<li>“TUT” for all tutorial or demo models.<br />
</li>
</ul></li>
</ul></li>
<li>Computer Name on which the simulation is being run;<br />
</li>
<li>TUFLOW Build ID;<br />
</li>
<li>Time:
<ul>
<li>Clock time “CT” after initialisation;</li>
<li>Processor time “PT” after initialisation;<br />
</li>
<li>Clock time “CT” at end of simulation;<br />
</li>
<li>Processor time “PT” at end of simulation;<br />
Note that the processor time is summed across all threads and includes GPU hardware. If parallel processing is used in model initialisation or solver this number may be larger than clock time.</li>
</ul></li>
<li>Hardware type and number of processor used:
<ul>
<li>“CPUx1” for a model run using one CPU thread;</li>
<li>“GPUx1” for a model run using one GPU card;</li>
</ul></li>
<li>Simulation status as one of the following:
<ul>
<li>“Started”;<br />
</li>
<li>“Finished”;<br />
</li>
<li>“Interrupted” (the simulation was stopped by pressing Ctrl+C);</li>
<li>UNSTABLE (the simulation became unstable based on the water level exceedance
checks).<br />
</li>
</ul></li>
<li>Simulation name;<br />
</li>
<li>Performance for “Finished” or “Interrupted” simulations:
<ul>
<li>“HPC Solver Used” for models using the HPC Solver.</li>
<li>For models using the Classic Solver:
<ul>
<li>“fCME” is the Final Cumulative Mass Error at the end of the
simulation.<br />
</li>
<li>“pCME” is the Peak CME throughout the whole simulation.<br />
</li>
<li>“pCME5” is the Peak CME for the period of the simulation that the
flow in and out of the model exceeds 5% of the peak flow in and out
(this value generally excludes any initial high ME values that may
occur at the start of some simulations).<br />
</li>
<li>“pddV” is the Peak change in dV (change in volume) over one timestep
divided by the peak dV value expressed as a percentage.<br />
</li>
<li>“pddV5” is the same as pddV but over the period of the simulation
where the flow in and out of the model exceeds 5% of the peak flow
in and out.</li>
</ul></li>
</ul></li>
<li>.tcf filename;<br />
</li>
<li>.tlf filepath.</li>
</ul>
<p><strong>It is strongly recommended that this file is not deleted or edited as it could provide a valuable trace back to past simulations.</strong></p>
<p>Excerpts from a local “\_ TUFLOW Simulations.log” file are shown below:</p>
<tblk><font size=2>
<div class="table-wrapper" markdown="block">
<p>2024-May-30 13:46 Don: 00004465001 NWK 01/20 BMT-1 Build: 2023-03-AE-iSP-w64 Started: M05_001_CLA M05_001.tcf “D:\TUFLOW\runs\log\M05_001_CLA.tlf”</p>
<p>2024-May-30 13:47 Don: 00004465001 NWK 01/20 BMT-1 Build: 2023-03-AE-iSP-w64 Ini: 0:00:01 CT 0:00:00 PT Tot: 0:00:41 CT 0:00:00 PT CPUx1 Finished:M05_001_CLA fCME = -0.78% pCME = -2.12% pCME5 = -0.78% pddV = 3% pddV5 = 2% M05_001.tcf “D:\TUFLOW\runs\log\M05_001_CLA.tlf”</p>
<p>2024-May-30 13:47 Don: 00004465001 NWK 01/20 BMT-1 Build: 2023-03-AE-iSP-w64 Started: M05_001_HPC M05_001.tcf “D:\TUFLOW\runs\log\M05_001_HPC.tlf”</p>
<p>2024-May-30 13:47 Don: 00004465001 NWK 01/20 BMT-1 Build: 2023-03-AE-iSP-w64 Ini: 0:00:02 CT 0:00:00 PT Tot: 0:00:17 CT ——- PT GPUx1 Finished: M05_001_HPC HPC Solver Used. M05_001.tcf “D:\TUFLOW\runs\log\M05_001_HPC.tlf”</p>
<p>2024-May-30 13:47 Don: 00004465001 NWK 01/20 BMT-1 Build: 2023-03-AE-iSP-w64 Started: M05_001_HPC_CPU M05_001.tcf “D:\TUFLOW\runs\log\M05_001_HPC_CPU.tlf”</p>
<p>2024-May-30 13:48 Don: 00004465001 NWK 01/20 BMT-1 Build: 2023-03-AE-iSP-w64 Ini: 0:00:01 CT 0:00:00 PT Tot: 0:01:18 CT 0:02:16 PT CPUx4 Finished: M05_001_HPC_CPU HPC Solver Used. M05_001.tcf “D:\TUFLOW\runs\log\M05_001_HPC_CPU.tlf”</p>
</div>
<p></tblk></font></p>
<h3 class="hasAnchor" id="GlobalLog-3"><span class="header-section-number">14.4.2</span> Global .log File<a href="#GlobalLog-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This file is named “\_ All TUFLOW Simulations.log” and by default is
located in a folder called “C:\ProgramData\TUFLOW\<username>\log”.</p>
<p>The path to the global .log file can be changed using the following
options:</p>
<ul>
<li>For all types of licenses use the <a href="#tcfSimulationsLogFolder">Simulations Log
Folder</a> command in the Dongle Control File
(see Section <a href="#DongleSettingsFile-4"><strong>??</strong></a>).<br />
</li>
<li>Alternatively, use <a href="#tcfSimulationsLogFolder">Simulations Log Folder</a>
in the .tcf file (this option is given priority over the option
above).<br />
</li>
<li>For either of the options above, if the keywords “DO NOT USE” occur
within the folder path or URL name, writing to the global .log file is
disabled.</li>
</ul>
<p>The entries to the global .log file are as described for the local .log
file above, but will be for all simulations carried out across the organisation (provided they are all referencing the same folder).</p>
<h2 class="hasAnchor" id="SimLogFiles-2"><span class="header-section-number">14.5</span> Simulation Log Files<a href="#SimLogFiles-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW writes a number of files to a folder typically called the ‘log’ folder and contained within the ‘TUFLOW\runs’. The location can be controlled using the <a href="#tcfLogFolder">Log Folder</a> command. The files written to this folder contain:</p>
<ul>
<li><a href="#TLF-3">TUFLOW Log File</a> (.tlf)</li>
<li><a href="#HPCTLF-4">HPC TUFLOW Log File and HPC timestep history file</a> (.hpc.tlf and .dt.csv)</li>
<li><a href="#TSF-3">TUFLOW Summary File</a> (.tsf)</li>
<li><a href="#start-stats-3">Simulation start statistics</a> (start_stats.txt)</li>
<li><a href="#run-stats-3">Simulation run statistics</a> (run_stats.txt)</li>
<li><a href="#Messages-3">Messages</a> (in both tabular and GIS format) (.csv and .gpkg/.shp/.mif)</li>
<li><a href="#Workspaces-2">GIS workspace</a> (.qgs and .wor)</li>
</ul>
<h3 class="hasAnchor" id="TLF-3"><span class="header-section-number">14.5.1</span> TLF<a href="#TLF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW produces a log file (.tlf file) containing a record of the simulation. TUFLOW HPC also produces a hpc.tlf file due to difficulties in coordinating CPU and GPU file writing processes - see Section <a href="#HPCTLF-4"><strong>??</strong></a>. The file is very useful for establishing data input problems and identifying instabilities.</p>
<p>Take time to familiarise yourself with the content of the log file. Much of it is a repeat of the information displayed to the Console Window, so if you can’t access information from the Console Window, check the log file using a text editor.</p>
<p>At key stages during the model development and application search the file for any “WARNING”, “CHECK” or “NOTE” messages. “WARNING” messages
in particular should be checked regularly. An “ERROR” keyword indicates an unrecoverable error and causes the simulation to stop. As many errors as possible are trapped before stopping.</p>
<p>An “XY:” at the beginning of a line indicates the error, warning, check or other message has also been redirected to a geo-spatial layer (.gpkg, .shp or .mif) (see Section <a href="#Messages-3"><strong>??</strong></a>). Opening the layer in the GIS often provides a far more rapid location of the message within the model domain(s) than via other ways.</p>
<p>For more information on the .tlf, see the <a href="https://wiki.tuflow.com/HPC_Model_Review#TUFLOW_Log_File_.28.2A.tlf.29">TUFLOW Wiki</a>.</p>
<h4 class="hasAnchor" id="HPCTLF-4"><span class="header-section-number">14.5.1.1</span> HPC TLF and DT<a href="#HPCTLF-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Two additional files are produced when using TUFLOW HPC, the hpc.tlf and hpc.dt.csv.</p>
<p>The .hpc.tlf log file records the model timestep, control numbers and volume of water in the model at each timestep, as described in Section <a href="#HPC-3"><strong>??</strong></a>. It also shows repeated timesteps if the control number limits were exceeded or there is a significant change in control numbers (more than 20%). Sometimes repeated timesteps are of no concern, such as when a direct rainfall model has a sudden change in rainfall when transitioning through a rainfall histogram, or there is a warmup period with small or no flow rate before a large inflow - the adaptive timestepping is simply adjusting to the sudden change in flow conditions somewhere within the model. However, if there is a high occurrence of repeating timesteps when the boundary inflows are smooth, this could be an indicator of model instability and sensitivity tests reducing the timestepping intervals, using the <a href="#tcfControlNumberFactor">Control Number Factor</a> command, carried out. The total number of repeated timesteps is also recorded in the Simulation Summary of the .tlf file.</p>
<p>For more information on the hpc.tlf, see the <a href="https://wiki.tuflow.com/HPC_Model_Review#HPC_TUFLOW_Log_File_.28.2Ahpc.tlf.29">TUFLOW Wiki</a>.</p>
<p>The hpc.dt.csv output provides a timeseries of the model timestep and the value of each control number at each timestep. The following columns are shown:</p>
<ul>
<li>iStep: Timestep display frequency, as mentioned in Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>.</li>
<li>tEnd: Simulation time at the end of timestep.</li>
<li>dtStar: Desired timestep from the 2D component of the model.</li>
<li>dt: Actual timestep, can be affected by the 1D timestep and output frequency.</li>
<li>Nu: Courant Number.</li>
<li>Nc: Shallow Wave Celerity Number.</li>
<li>Nd: Diffusion Number.</li>
<li>Eff: Efficiency value that represents the ratio of actual 2D timestep (dt) to possible 2D timestep (dtStar).</li>
</ul>
<p>It is possible to view the minimum timestep (dt) in a map output format using <tcmd><a href="#tcfMapOutputDataTypes">Map Output Data Types</a></tcmd><teq> == </teq><tblk>dt</tblk> to identify which part(s) of the model are controlling the timestepping. For more information see the <a href="https://wiki.tuflow.com/HPC_Model_Review#dt_Map_Output">TUFLOW Wiki</a>.</p>
<p>For more information of the hpc.dt.csv, see the <a href="https://wiki.tuflow.com/HPC_Model_Review#HPC_dt_Time_Series_Output_.28.2A.hpc.dt.csv.290">TUFLOW Wiki</a>.</p>
<h3 class="hasAnchor" id="TSF-3"><span class="header-section-number">14.5.2</span> TSF<a href="#TSF-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A TUFLOW Summary File (.tsf file) is output to the same location as the .tlf file and provides a more concise summary of the simulation. This file can also be regularly updated during a simulation. By default, the summary output interval for a Classic model is set so there are 101 summary output values (for example, an interval of 180 seconds for a 5 hour model). For a HPC model the summary output interval is set to the <a href="#tcfMassBalanceOutputInterval">Mass Balance Output Interval</a>. If no <a href="#tcfMassBalanceOutputInterval">Mass Balance Output Interval</a> is specified, the lesser of the <a href="#tcfMapOutputInterval">Map Output Interval</a> and <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a> is used.</p>
<p>Features are:</p>
<ul>
<li>The <a href="#tcfTSFUpdateInterval">TSF Update Interval</a> command can be used to control the interval in seconds to update the .tsf file while a
simulation is running.<br />
</li>
<li>The .tsf file has a TUFLOW control file style syntax and contains
information on the solution scheme, hardware, primary simulation
inputs, the simulation status, mass balance outputs, etc. Additional
information will be added based on user feedback (please email
<a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a> if you have a suggestion).</li>
</ul>
<p>The .tsf is updated as the model is running, users can open this file as the model is running to check on key features and progress. Table <a href="#tab:tab-tsf">118</a> provides an example of a .tsf. What is written to the .tsf is listed under ‘Column’ and then described under ‘Description’.</p>
<table>
<caption>
<span id="tab:tab-tsf">Table 118: </span><strong>TUFLOW Summary File Example</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>TUFLOW Control File == “D:_001.tcf”</tblk>
</td>
<td style="text-align:left;">
File path of the TUFLOW Control File (.tcf), see Section <a href="#TCF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>TUFLOW Log File == “D:_001.tlf”</tblk>
</td>
<td style="text-align:left;">
File path of the TUFLOW Log File (.tlf), see Section <a href="#TLF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>TUFLOW Build == Build: 2023-03-AE-iSP-w64</tblk>
</td>
<td style="text-align:left;">
Name of the TUFLOW Build used, see Section <a href="#InstallOverview-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Solution Scheme == HPC</tblk>
</td>
<td style="text-align:left;">
The <a href="#tcfSolutionScheme">Solution Scheme</a> used. The options are TUFLOW Classic, or TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Hardware == GPU</tblk>
</td>
<td style="text-align:left;">
The <a href="#tcfHardware">Hardware</a> used. The options are CPU or GPU, see Chapter <a href="#Hardware-1"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>GPU Device IDs == 0</tblk>
</td>
<td style="text-align:left;">
The GPU Device IDs. If multiple GPUs are used, see Section <a href="#MultipleGPUs-3"><strong>??</strong></a>, they will be listed here.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Computer Name == BMT-WS2111</tblk>
</td>
<td style="text-align:left;">
The computer name that the simulation is running on.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Simulation Status == FINISHED</tblk>
</td>
<td style="text-align:left;">
<p>Simulation status as one of the following:</p>
<ul>
<li>“Started”;<br />
</li>
<li>“Finished”;<br />
</li>
<li>“Interrupted” (the simulation was stopped by pressing Ctrl+C); or<br />
</li>
<li>UNSTABLE (the simulation became unstable based on the water level exceedance checks).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Simulation Time (h) == 3.</tblk>
</td>
<td style="text-align:left;">
Simulation time at time .tsf is opened (this updates as the simulation progresses).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Simulation Start Time (h) == 0.</tblk>
</td>
<td style="text-align:left;">
Simulation Start Time.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Simulation End Time (h) == 3.</tblk>
</td>
<td style="text-align:left;">
Simulation End Time.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Percentage Complete (%) == 100</tblk>
</td>
<td style="text-align:left;">
Progress of the simulation at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Completed Computational Steps == 10769</tblk>
</td>
<td style="text-align:left;">
Number of completed computational steps at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>CPU Time (h) == 0.002218</tblk>
</td>
<td style="text-align:left;">
CPU Time at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Clock Time (h) == 0.006389</tblk>
</td>
<td style="text-align:left;">
Clock Time at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Approximate Clock Time Remaining (h) == 0.</tblk>
</td>
<td style="text-align:left;">
Approximate time remaining of simulation.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>TUFLOW 1D Negative Depths == 0</tblk>
</td>
<td style="text-align:left;">
Number of negative 1D depth reported at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>HPC HCN Repeated Timesteps == 0</tblk>
</td>
<td style="text-align:left;">
If using TUFLOW HPC, the number of repeated timesteps due to High Control Numbers (HCN) at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>HPC NaN Repeated Timesteps == 0</tblk>
</td>
<td style="text-align:left;">
If using TUFLOW HPC, the number of repeated timesteps due to Not a Number (NaN) occurring at time .tsf is opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>HPC NaN WARNING 2550 == 0</tblk>
</td>
<td style="text-align:left;">
Number of <a href="https://wiki.tuflow.com/TUFLOW_Message_2550">WARNING 2550</a> reported at time of .tsf being opened.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>WARNINGs Prior to Simulation == 1</tblk>
</td>
<td style="text-align:left;">
Number of WARNINGs prior to the simulation (i.e. during initialisation phase).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>WARNINGs During Simulation == 0</tblk>
</td>
<td style="text-align:left;">
Number of WARNINGs during the simulation (i.e. as the computations are happening).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>CHECKs Prior to Simulation == 0</tblk>
</td>
<td style="text-align:left;">
Number of CHECKs prior to the simulation (i.e. during initialisation phase).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>CHECKs During Simulation == 0</tblk>
</td>
<td style="text-align:left;">
Number of CHECKs during the simulation (i.e. as the computations are happening).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Volume at Start (m3) == 269</tblk>
</td>
<td style="text-align:left;">
Volume at the start of the model.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Volume at End (m3) == 3478</tblk>
</td>
<td style="text-align:left;">
Volume at the end of the model.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Total Volume In (m3) == 3472</tblk>
</td>
<td style="text-align:left;">
The current amount of volume that has entered the model.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Total Volume Out (m3) == 265</tblk>
</td>
<td style="text-align:left;">
The current amount of volume that has left the model.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Volume Error (m3) == 2</tblk>
</td>
<td style="text-align:left;">
The current volume error.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Volume Error (%) == 0.05</tblk>
</td>
<td style="text-align:left;">
The current percent of volume error.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Cumulative Mass Error [ME] (%) == 0.05</tblk>
</td>
<td style="text-align:left;">
The current cumulative mass error reported in the model.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Summary Output Interval (s) == 300.</tblk>
</td>
<td style="text-align:left;">
The interval that the .tsf file is being updated.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Number Summary Values == 37</tblk>
</td>
<td style="text-align:left;">
The number of summary values written.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Volume In Values [Qi] == 0.0, …, 39.3</tblk>
</td>
<td style="text-align:left;">
The volume in values for each interval.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Volume Out Values [Qo] == 0.0, …, 0.1</tblk>
</td>
<td style="text-align:left;">
The volume out values for each interval.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Change in Volume Values [dV] == 0.0, …, 39.0</tblk>
</td>
<td style="text-align:left;">
The change in volume values for each interval.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Mass Error Values [ME] (%) == 0.0, …, 0.1</tblk>
</td>
<td style="text-align:left;">
The mass error values for each interval.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Number TUFLOW 1D Nodes == 0</tblk>
</td>
<td style="text-align:left;">
The number of 1D nodes within the model, see Section <a href="#Scheme-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Number TUFLOW 1D Channels == 0</tblk>
</td>
<td style="text-align:left;">
The number of 1D channels within the model, see Section <a href="#Scheme-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Active 2D Cells == 20611</tblk>
</td>
<td style="text-align:left;">
The number of active 2D cells. Typically set using a 2d_code polygon with attribute of ‘1’, see Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Total 2D Cells == 34000</tblk>
</td>
<td style="text-align:left;">
The number of cells within the 2D domain, see Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Inactive 2D Cells == 13389</tblk>
</td>
<td style="text-align:left;">
The number of inactive 2D cells (i.e. the total cells minus the active cells).
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Number 2D Domains == 1</tblk>
</td>
<td style="text-align:left;">
The number of 2D domains. This will be one unless using the M2D functionality, see Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>2D Domain Cell Sizes == 5.</tblk>
</td>
<td style="text-align:left;">
The 2D domain cell size used, see Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>2D Domain Timestep == 0.500 ! Variable</tblk>
</td>
<td style="text-align:left;">
The 2D timestep. When using HPC this is a variable timestep and users should refer to the hpc.dt.csv , see Section <a href="#HPCTLF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>First Start Map Output (h) == 0.</tblk>
</td>
<td style="text-align:left;">
Time of the first map output.
</td>
</tr>
<tr>
<td style="text-align:left;max-width: 40em; vertical-align:top;">
<tblk>Shortest Map Output Interval (s) == 300.</tblk>
</td>
<td style="text-align:left;">
The time of the shortest <a href="#tcfMapOutputInterval">Map Output Interval</a>.
</td>
</tr>
</tbody>
</table></li>
</ul>
<h3 class="hasAnchor" id="start-stats-3"><span class="header-section-number">14.5.3</span> Start Stats<a href="#start-stats-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A simulation start stats file (\&lt;simulation_name&gt;\_start_stats.txt) is output to the same location as the .tlf file. This file contains
information on the total time and the time elapsed for each stage of model initialisation. This can be used to identify the stages causing
slow simulation start-up, and allows the TUFLOW development team to prioritise development tasks to remove bottlenecks in the start-up through the use of XF files and other enhancements. If you have a problematic (slow starting) model, please email the _start_stats.txt and corresponding .tlf file through to <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<h3 class="hasAnchor" id="run-stats-3"><span class="header-section-number">14.5.4</span> Run Stats<a href="#run-stats-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A simulation run stats file (\&lt;simulation_name&gt;\_run_stats.txt) is also output to the same location as the .tlf file. This file contains the amount of time that TUFLOW spends in the 1D and 2D computations. At each mass balance output interval, the percentage of the total computational effort that TUFLOW has spent in 1D calculations, 2D calculations and other is output to the run_stats file. The “other” column includes a variety of tasks that are neither 1D or 2D computations, such as writing of outputs, and transfer of data to GPU (if running on GPU devices). The “other” column also includes time spent within an external 1D solver.</p>
<h3 class="hasAnchor" id="Messages-3"><span class="header-section-number">14.5.5</span> Messages<a href="#Messages-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Error, warning, check and other useful messages that are output to the Console Window and log file are also output to a .csv file and geo-spatial layer (e.g. .gpkg, .shp or .mif depending of the GIS format set in the model). Messages output to the geo-spatial layer are those that can be geographically located within the model domains. These messages layers are output in the <a href="#tcfLogFolder">Log Folder</a>.</p>
<p>The three levels of messages generated in increasing order of severity
are:</p>
<ul>
<li><strong>CHECK</strong>: A check indicates that something unusual occurred and may, for example, indicate erroroneous data. For example a breakline failed to modify any cell elevations (<a href="http://wiki.tuflow.com/TUFLOW_Message_2079">CHECK 2079</a>).</li>
<li><strong>WARNING</strong>: A warning is more severe than a check message, but the simulation will still progress. For example, a Manning’s n value of 0.001 would be considered outside typical industry ranges and will trigger <a href="http://wiki.tuflow.com/TUFLOW_Message_2218">WARNING 2218</a>.<br />
</li>
<li><strong>ERROR</strong>: An error indicates that the simulation is unable to continue. For example, if no active cell is found within a source area boundary an <a href="http://wiki.tuflow.com/TUFLOW_Message_2014">ERROR 2014</a> will occur and the simulation will terminate.</li>
</ul>
<p><strong>This feature allows rapid identification of the error location within
the GIS environment of data input errors and simulation instabilities
and potential problems. Using this feature can save considerable time when setting
up and checking new models.</strong></p>
<p>Of note is that some messages can be changed from their default setting in situations where the modeller has determined that the message level does not need to be enforced, or enforced to a higher level.</p>
<p>A message numbering system has been adopted, prefixing all warnings with
a four digit number. These numbers may be used to cross-reference the
warning with a message database that is stored on the <a href="https://wiki.tuflow.com/TUFLOW_Messages">TUFLOW
Wiki</a>. The database contains
detailed information on the CHECK, WARNING or ERROR to help
check/resolve the issue. Each message falls into one of the following
message categories:</p>
<ul>
<li><a href="https://wiki.tuflow.com/0xxx_TUFLOW_Messages">0xxx</a> warning messages refer to errors that occur in neither the 1D or 2D domains.<br />
</li>
<li><a href="https://wiki.tuflow.com/1xxx_TUFLOW_Messages">1xxx</a> warning messages refer to errors that occur in the 1D domains.<br />
</li>
<li><a href="https://wiki.tuflow.com/2xxx_TUFLOW_Messages">2xxx</a> warning messages refer to errors that occur in the 2D domains.<br />
</li>
<li><a href="https://wiki.tuflow.com/3xxx_TUFLOW_Messages">3xxx</a> warning messages refer to errors that are unique to TUFLOW HPC.</li>
<li><a href="https://wiki.tuflow.com/4xxx_TUFLOW_Messages">4xxx</a> warning messages refer to errors that are unique to Advection Dispersion module.</li>
</ul>
<p>As of the QGIS TUFLOW Plugin Version 3.9, it is possible to filter messages by code ID, as shown in Figure <a href="#fig:fig-FilterCode">120</a>. For more information see the <a href="https://docs.tuflow.com/qgis-tuflow-plugin/changelog/version/changelog-3.9.html#filter-messages-by-id">QGIS TUFLOW Plugin Changelog</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-FilterCode"></span>
<img src="images/FilterCode.png" alt="Filter by Code Number"  />
<p class="caption">
Figure 120: Filter by Code Number
</p>
</div>
<h3 class="hasAnchor" id="Workspaces-2"><span class="header-section-number">14.5.6</span> GIS Workspaces<a href="#Workspaces-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A QGIS workspace (.qgs) and MapInfo workspace (.wor) is automatically
created for every simulation. They are named &lt;tcf_filename&gt;.qgs / .wor
and are written to the same folder as the .tlf file. The workspace
contains all GIS layers used as input to the simulation, and is an
excellent way of ascertaining the GIS layers used to set up a
model, particularly large models with many GIS inputs, or those with
multiple events or scenarios.</p>
<p>Opening the .qgs file in QGIS will open all GIS input and output check
layers (.gpkg, .shp and/or .mif). Note that the visibilities of the output
layers are unchecked so that the display time is quick.</p>
<p>The .wor file, when opened in MapInfo, simply opens the .tab layers. No
Map or Browser windows are automatically opened. If the simulated model
contains any other vector formats (e.g. .gpkg or .shp files), these are not opened.</p>
<p>For ArcMap users, the .mxd files cannot be directly written by TUFLOW, as the format is proprietary. However, the
<a href="https://wiki.tuflow.com/ArcTUFLOW_Load_Simulation_Input_Files">ArcTUFLOW Toolbox</a> can be used to load the simulation input files into ArcMap.</p>
<h2 class="hasAnchor" id="EOF-2"><span class="header-section-number">14.6</span> 1D Output File<a href="#EOF-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The .eof file is both a summary file for the 1D, as well as a results file. It contains the 1D domain input datasets, including a complete output of the final input data before the simulation
commences. For example, if a second table overwrites a channel
cross-section properties table during the input process, the table in
the .eof file relates to the second table. Similarly, adjustments to
data, for example, a datum shift in a gradient channel’s cross-section
based on the upstream and downstream inverts, are also incorporated.
Therefore, the .eof file contains the final dataset that is used by the
simulation.</p>
<p>By default the .eof file also contains a result summary of the
simulation, including useful information such as culvert flow regimes at
each output time, time of maximum water level, etc. The channel and node
regime flags are located in the two spaces after the velocity, flow and
head values in the time based output. The flags, described in Table <a href="#tab:tab-RegimeFlags">119</a>, are useful for interrogating the hydraulic regime at nodes and channels. The writing of the outputs in the .eof file can be suppressed
by the <tcmd><a href="#tcfOutputFiles">Output Files Exclude</a> </tcmd><teq>==</teq><tblk> EOF</tblk> command in the .tcf <!--WJS .ecf? --><!-- looks like tcf is the right place-->file.</p>
<table>
<caption>
<span id="tab:tab-RegimeFlags">Table 119: </span><strong>Channel and Node Flow Regime Flags (.eof File)</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flag (Space 1)
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Flag (Space 2)
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
*
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
The depth at a node fell below -0.1m. A WARNING is also output to the _messages GIS layer (see Section <a href="#Messages-3"><strong>??</strong></a>. The occurrence of significant negative depths may cause mass conservation errors in the 1D domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
*
</td>
<td style="text-align:left;">
One end of a normal channel is close to being dry and a transitioning algorithm was used to dry/wet the channel.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
#
</td>
<td style="text-align:left;">
The gradient channel algorithm was applied. This occurs when one end of the channel is either dry or very shallow. The gradient channel algorithm applies a weir equation at the dry or shallow end in combination with the momentum equation by adjusting the water surface slope along the channel.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
Adverse flow (i.e. flow gradient is against the slope of the channel).
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
Upstream controlled friction flow occurred in a Steep (S) channel when the downstream end was dry.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:left;">
Upstream controlled friction flow occurred in a Steep (S) channel with a Froude Number greater than one (1).
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
T
</td>
<td style="text-align:left;">
Upstream controlled friction flow occurred in a Steep (S) channel with a Froude Number between 0.5 and one (1). T stands for Transitioning from normal flow to upstream controlled friction flow.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
N
</td>
<td style="text-align:left;">
Upstream controlled friction flow occurred in a Steep (S) channel with a Froude Number less than 0.5. N stands for normal flow, however, in this case the upstream controlled friction flow approach was adopted. This may occur during the transitioning of flow from downstream controlled to upstream controlled. If it occurs repetitively, the configuration of the channel should be reviewed.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
Culvert Flow Regime Flags
</td>
<td style="text-align:left;">
The culvert flow regime flag as documented in Table <a href="#tab:tab-FlowRegimes">23</a>. Culvert channels only.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
E
</td>
<td style="text-align:left;">
The channel or node is empty or dry (i.e. the head or water level is at the bottom of the node). E stands for Empty.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
The head exceeds the top of the nodes elevation versus surface area table (NA table). F stands for Full.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
F
</td>
<td style="text-align:left;">
The head at the mid-point of the channel exceeds the top of the channel’s hydraulics properties table (CS table). F stands for Full.
</td>
</tr>
<tr>
<td style="text-align:left;">
L
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
The velocity rate limit was applied to the channel to try and prevent oscillations or instabilities – non-inertial channels (structures) only. See Vel Rate Limit.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
U
</td>
<td style="text-align:left;">
The uni-directional flag assigned to the channel was invoked and the velocity/flow was set to zero.
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
W
</td>
<td style="text-align:left;">
For a Sluice Gate type channel, the flow is not in contact with the sluice gate and the channel has reverted to Weir or Rectangular channel flow as outlined in Section <a href="#SG-SGO-3"><strong>??</strong></a>.
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="CheckLayers-2"><span class="header-section-number">14.7</span> Check Files<a href="#CheckLayers-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When the command <a href="#tcfWriteCheckFiles">Write Check Files</a> is specified in the .tcf file and/or .ecf file a number of various 2D, 1D, 1D/2D and 2D/2D check files can be output. At key stages in a model’s development, produce these check files, and check their contents to ensure that the input data are as expected. Note that a number of the check files listed below are only output when the corresponding feature has been used in the simulated model. The attributes of some check files (like that of the <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a>) may vary depending on the feature used within the model.</p>
<p>Table <a href="#tab:tab-CheckFiles">120</a> lists the various 2D, 1D, 1D/2D and 2D/2D check files that are available to be output. Links are provided to the <a href="https://wiki.tuflow.com/TUFLOW_Check_Files">TUFLOW Wiki</a> which contains detailed descriptions of the files.</p>
<p>Many of the GIS check layers output by TUFLOW may be mapped within GIS to provide a visual representation of how the input data has been interpreted by the model. This often makes it easier and quicker to review a certain aspect of the model rather than individually viewing the attributes of each GIS check layer.</p>
<p>For example, using the styling functionality (thematic mapping) of GIS software, the
user could:</p>
<ul>
<li>View the spatial distribution of the Soil Infiltration layer
(attribute in <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> layer).<br />
</li>
<li>View the conveyance of 1D channel layers (attribute in <a href="https://wiki.tuflow.com/Check_Files_1d_hydroprop">_hydroprop_check</a> layer).</li>
</ul>
<p>Examples of viewing these check files for different GIS packages are provided via the links below to the TUFLOW
Wiki:</p>
<ul>
<li><a href="https://wiki.tuflow.com/QGIS_Thematic_Mapping">QGIS Thematic Mapping</a></li>
<li><a href="https://wiki.tuflow.com/MapInfo_Style_Check_Files">MapInfo Thematic Mapping</a><br />
</li>
<li><a href="https://wiki.tuflow.com/Arc_Style_Check_Files">ArcMap Thematic Mapping</a></li>
</ul>
<p>Tip: the QGIS TUFLOW Plugin and ArcGIS Toolbox contain an ‘Apply TUFLOW Styles to Open Layers’ tool. This tool automatically styles inputs and outputs, including check layers, greatly enhancing the visual interpretation of the geo-spatial data.</p>
<table>
<caption>
<span id="tab:tab-CheckFiles">Table 120: </span><strong>Types of Check Files</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
2D Check Files
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
1D Check Files
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
1D/2D Check Files
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
2D/2D Check Files
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_bc_tables">_2d_bc_tables_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_bc_tables">_1d_bc_tables_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_x1D_to_2D.csv">_x1D_H_to_2D</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_to_2d_bc">_2d_to_2d_check</a>
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_ad_check">_ad_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_pit_inlet_tables">_1d_pit_inlet_tables_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_x1D_to_2D.csv">_x1D_H_from_2D</a>
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_bg_uvpt_check">_bg_uvpt_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_ta_tables">_1d_ta_tables_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_x1D_to_2D.csv">_2D_Q_to_x1D</a>
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_bcc_check">_bcc_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_Str_Grp">_Str_Grp_All</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_x1D_to_2D.csv">_2D_Q_from_x1D</a>
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_DEM_M">_DEM_M</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_Str_Grp">_Str_Grp_Multi</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_to_2d_bc">_1d_to_2d_check</a>
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_bc_check">_1d_bc_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_dom">_dom_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_hydroprop">_hydroprop_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_fc">_fc_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_inverts">_inverts_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_fcsh_uvpt">_fcsh_uvpt_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_IWL">_iwl_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_glo">_glo_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_mhc">_mhc_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_nwk_C">_nwk_C_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_input_layers">_input_layers</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_nwk_N">_nwk_N_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_lfcsh_uvpt">_lfcsh_uvpt_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_pit_A">_pit_A_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_LP">_lp_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_WLLo">_WLLo_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_PO">_po_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_WLLo">_xWLLo_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_sac">_sac_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_WLLp">_WLLp_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_sh_obj">_sh_obj_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_WLLp">_xWLLp_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_uvpt">_uvpt_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_xsl">_xsl_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_vzsh">_vzsh_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_x1d_chans">_x1d_chans_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_zln_zpt">_zln_zpt_check</a>
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_1d_x1d_nodes">_x1d_nodes_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/Check_Files_2d_zsh_zpt">_zsh_zpt_check</a>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="MB-2"><span class="header-section-number">14.8</span> Mass Balance Output<a href="#MB-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mass balance information for TUFLOW Classic or HPC, and TUFLOW 1D (ESTRY), is generated by setting <a href="#tcfMassBalanceOutput">Mass Balance
Output</a> to ON (the default). Due to the different mathematics employed for the two 2D solvers, the information produced varies between Classic and HPC.</p>
<!--WJS Should 1D mass balance output be put into its own section below as it applies to both Classic and HPC? -->
<!-- EFC to WJS: I've had a go at seperating this, can you please review??-->
<h3 class="hasAnchor" id="OneD-MB-3"><span class="header-section-number">14.8.1</span> TUFLOW 1D Mass Balance<a href="#OneD-MB-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For simulations with a TUFLOW 1D (ESTRY) component, if <a href="#tcfMassBalanceOutput">Mass Balance Output</a> is ON the following mass balance output is available for 1D:</p>
<ul>
<li>As discussed in Section <a href="#Classic-3"><strong>??</strong></a> the cumulative mass error
percentage appears as three numbers after the letters “CE” in the
Console Window. This data is also output to the .tlf file (Section
<a href="#TLF-3"><strong>??</strong></a>). The first percentage is the overall model (all 1D and 2D
domains) and the second is for all of the TUFLOW 1D domains (the third discussed in Section <a href="#MB-CLA-3"><strong>??</strong></a>) (see the description of the “Cum ME (%)” column in Table <a href="#tab:tab-MBFile">121</a> and Table <a href="#tab:tab-MB1DFile">122</a>). Monitoring these numbers is important so as to establish the “health” of the model, as discussed in Section <a href="#QAIntroduction-2"><strong>??</strong></a>.
Ideally all these percentages should be within ±1%. Much higher
numbers may occur at the start of a simulation, especially if there
are 2D domain(s) rapidly wetting. This should not be an issue provided
the model quickly settles down and the CE percentages fall within
acceptable amounts.<br />
</li>
<li>The <strong>_MB1D.csv</strong> file contains mass balance reporting for all the 1D (ESTRY) domains (see Table <a href="#tab:tab-MB1DFile">122</a>). It is written to the .ecf <a href="#ecfOutputFolder">Output Folder</a>.</li>
<li>Time based 1D mass error is output as a GIS layer to a _TSMB_P.shp layer (see Table <a href="#tab:tab-TSMB">124</a> for a description of the attributes). Using GIS thematic mapping of the ME_Avg_Abs attribute is a powerful way of identifying any problematic 1D nodes.</li>
<li>Time based mass error reporting across 1D/2D HX links is output as a GIS _TSMB1d2d layer. Note, when viewing this layer that each 1D node point object is connected to a collection of 2D cell objects that make one overall GIS object (called a Collection). This layer is also useful for identifying which 2D cells are connected to a 1D node for the 2D HX links. See Table <a href="#tab:tab-TSMB1d2d">125</a> for a description of the attributes. Using GIS thematic mapping of the ME_Avg_Abs attribute is a powerful way of identifying any problematic 2D HX links.</li>
</ul>
<h3 class="hasAnchor" id="MB-CLA-3"><span class="header-section-number">14.8.2</span> TUFLOW Classic Mass Balance<a href="#MB-CLA-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For TUFLOW Classic simulations, if <a href="#tcfMassBalanceOutput">Mass Balance
Output</a> is ON the following mass balance output
is available:</p>
<ul>
<li>As discussed in Section <a href="#Classic-3"><strong>??</strong></a> the cumulative mass error
percentage appears as three numbers after the letters “CE” in the
Console Window. This data is also output to the .tlf file (Section
<a href="#TLF-3"><strong>??</strong></a>). The first percentage is the overall model (all 1D and 2D
domains), the second is for all of the TUFLOW 1D domains and the third for
all of the 2D domains (see the description of the “Cum ME (%)” column
in Table <a href="#tab:tab-MBFile">121</a>, Table <a href="#tab:tab-MB1DFile">122</a> and Table <a href="#tab:tab-MB2DFile">123</a>. Monitoring these numbers is important so as to establish the “health” of the model, as discussed in Section <a href="#QAIntroduction-2"><strong>??</strong></a>.
Ideally all these percentages should be within ±1%. Much higher
numbers may occur at the start of a simulation, especially if there
are 2D domain(s) rapidly wetting. This should not be an issue provided
the model quickly settles down and the CE percentages fall within
acceptable amounts.<br />
</li>
<li>Two _MB.csv files are output by TUFLOW reporting on the various
inflows and outflows, volume, predicted volume error and the mass and
cumulative mass errors as a percentage as follows:
<ul>
<li>The <strong>_MB.csv</strong> file is for the overall model (all 1D and 2D
domains) (see Table <a href="#tab:tab-MBFile">121</a>). It is written to the .tcf <a href="#tcfOutputFolder">Output
Folder</a> .<br />
</li>
<li>The <strong>_MB2D.csv</strong> file contains mass balance reporting for all 2D domains together and for each individual 2D domain if using Classic’s Multiple 2D Domain feature (see Table <a href="#tab:tab-MB2DFile">123</a>). The _MB2D.csv is written to the .tcf <a href="#tcfOutputFolder">Output Folder</a>. These files also report inflows and outflows across HX and SX connections for 1D/2D links between TUFLOW’s 1D scheme (ESTRY) and other external 1D schemes (e.g. FloodModeller or SWMM). The overall mass balance reported does not include flows in any external 1D scheme, but does include flows across links to an external 1D scheme.<br />
</li>
</ul></li>
<li>Map output of the 2D mass error can be output by specifying the MB1
and/or MB2 option for <a href="#tcfMapOutputDataTypes">Map Output Data Types</a>.
Both MB1 and MB2 outputs are a measure of the convergence level of the
solution. The measure is a cumulative value since the last output
time, therefore is an effective way of identifying problem areas in a
model that repeatedly have poor convergence and most likely mass
error. The MB1 output is accumulated since the previous output time
and the MB2 output is accumulated over the entire simulation.</li>
</ul>
<p>It is possible to specify different time intervals for the display on
the screen and the _MB.csv output files. The .tcf command <a href="#tcfMassBalanceOutputInterval">Mass Balance
Output Interval</a> is used for setting the
interval in the _MB.csv files.</p>
<p>A summary of key model performance indicators is also reported at the
end of the simulation in the Console Window and .tlf file (see Section
<a href="#TUFLOWQAIndicators-3"><strong>??</strong></a>).</p>
<p>Healthy TUFLOW Classic models fall within ±1% cumulative mass error (see Section
<a href="#QAIntroduction-2"><strong>??</strong></a> for discussion on “unhealthy” models). If a model
experiences higher mass errors this may be due to the following:</p>
<ul>
<li>Poor numerical convergence due to using too large a timestep and/or areas of the model are slightly unstable (major instabilities will generate warnings and eventually an error).<br />
</li>
<li>Models with significant areas of complex hydraulics, or steep and very shallow flows when using the
direct rainfall approach (<a href="#tbcReadGISRF">Read GIS RF</a>). These models
should be tested using double precision versions of TUFLOW Classic (see Section
<a href="#iSPdSP-3"><strong>??</strong></a>). This scenario may also require the default wet/dry depth
(<a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a>) to be reduced to minimise
mass errors that can arise from cells frequently wetting and drying
with larger wet/dry depths.<br />
</li>
<li>Poorly configured 1D/2D or 2D boundaries that are causing
oscillations to occur.<br />
</li>
<li>High frequency of repeated wetting and drying.<br />
</li>
<li>Models located at high elevations above sea level, especially if the
inflows are relatively small or direct rainfall is applied. These
models should be run using double precision versions of TUFLOW Classic (see
Section <a href="#iSPdSP-3"><strong>??</strong></a>). There are no fixed guidelines for when to switch
to double precision, other than to carry out sensitivity tests using
single and double precision versions (as a general rule for Classic, not HPC, all direct
rainfall models and models with elevations greater than 100 to 1,000m
usually require or will benefit from using double precision).<br />
</li>
<li>1D nodes that are frequently drying (undershooting), or are being
limited if <a href="#ecfHeadRateLimit">Head Rate Limit</a> is being used (not
recommended) can result in mass errors. The _TSMB and
_TSMB1d2d GIS layers are useful for reviewing 1D mass error. These files
report the mass error values as a flow rate (m<sup>3</sup>/s) so that
they can be compared with the total flow through the model at that
location (i.e. a mass error of 1m<sup>3</sup>/s at a node where
1,000m<sup>3</sup>/s is passing through is not an issue, while it would
be if only 2m<sup>3</sup>/s was passing through the node).<br />
</li>
<li>Note that the calculation of mass errors will not detect errors in the model flow boundary inputs. It is
recommended that conventional mass balance checks be carried out (irrespective of the software used) as a
matter of course as a cross-check that the correct amount of water is entering and leaving the model (see Section <a href="#QAchecklist-2"><strong>??</strong></a>).</li>
</ul>
<table>
<caption>
<span id="tab:tab-MBFile">Table 121: </span><strong>MB.csv File Columns</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Time (h)
</td>
<td style="text-align:left;">
The simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
H Vol In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the model across water level (HQ, HS, HT) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
H Vol Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the model across water level (HQ, HS, HT) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q Vol In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the model from flow (QH, QS, QT, RF, SA, ST) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q Vol Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the model across flow (QH, QS, QT, RF, SA, ST) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Tot Vol In
</td>
<td style="text-align:left;">
The total volume of water entering the model since the previous time in m<sup>3</sup>.
</td>
</tr>
<tr>
<td style="text-align:left;">
Tot Vol Out
</td>
<td style="text-align:left;">
The total volume of water leaving the model since the previous time in m<sup>3</sup>.
</td>
</tr>
<tr>
<td style="text-align:left;">
Vol I-O
</td>
<td style="text-align:left;">
“Tot Vol In” minus “Tot Vol Out” (i.e. the net volume of water in m<sup>3</sup> entering the model since the previous time).
</td>
</tr>
<tr>
<td style="text-align:left;">
dVol
</td>
<td style="text-align:left;">
The change in the model’s volume since the previous time in m<sup>3</sup>.
</td>
</tr>
<tr>
<td style="text-align:left;">
Vol Err
</td>
<td style="text-align:left;">
“dVol” minus “Vol I-O” (i.e. the volume error or amount of water in m<sup>3</sup> unaccounted for since the previous time). A positive value indicates the solution may have gained mass, while a negative value indicates a possible mass loss.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q ME (%)
</td>
<td style="text-align:left;">
(“Vol Err”/“Vol I+O”)*100 (i.e. the percentage mass error based on the volume of water flowing through the model since the previous time). This figure can be large at the start of a simulation if there are 2D cells rapidly wetting and the flow through the model (“Vol I+O”) is relatively small. This is a characteristic of 2D domains, particularly when using the direct rainfall approach. If “Vol I+O” is less than 1m<sup>3</sup>, “Q ME (%)” is set to zero to avoid divide by zero calculations.
</td>
</tr>
<tr>
<td style="text-align:left;">
Vol I+O
</td>
<td style="text-align:left;">
“Tot Vol In” + “Tot Vol Out” (i.e. the volume of water in m<sup>3</sup> entering and leaving the model since the previous time).
</td>
</tr>
<tr>
<td style="text-align:left;">
Tot Vol
</td>
<td style="text-align:left;">
The total volume of water in the model in m<sup>3</sup>.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Vol I+O
</td>
<td style="text-align:left;">
The cumulative volume of water entering and leaving the model in m<sup>3</sup> (i.e. the cumulative total of “Vol I+O”).
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Vol Err
</td>
<td style="text-align:left;">
The cumulative volume error in m<sup>3</sup> (i.e. the cumulative total of “Vol Err”).
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum ME (%)
</td>
<td style="text-align:left;">
(“Cum Vol Err”/max(“Tot Vol” and “Cum Vol I+O”))*100 (i.e. the percentage mass error based on the maximum of the volume of water that has flowed through the model and total volume of water in the model). This figure can be large at the start of a simulation if there are 2D cells rapidly wetting and the flow through the model (“Cum Vol I+O”) is relatively small. This is a particular characteristic of steep models, particularly when using the direct rainfall approach. This figure can also be misleadingly low if the model has a very large volume of “stagnant” water such as a lake or part of the ocean. If max (“Tot Vol” and “Cum Vol I+O”) is less than 1m<sup>3</sup>, “Cum ME (%)” is set to zero to avoid divide by zero calculations. This figure is the first number displayed after “CE” on the Console Window.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Q ME (%)
</td>
<td style="text-align:left;">
(“Cum Vol Err”/“Cum Vol I+O”)*100 (i.e. the percentage mass error based on the cumulative volume of water that has flowed through the model). This figure can be large at the start of a simulation if there are 2D cells rapidly wetting and the flow through the model (“Cum Vol I+O”) is relatively small. This is a particular characteristic of steep models, particularly when using the direct rainfall approach. If “Cum Vol I+O” is less than 1m<sup>3</sup>, “Cum Q ME (%)” is set to zero to avoid divide by zero calculations.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-MB1DFile">Table 122: </span><strong>MB1D.csv File Columns</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Time (h)
</td>
<td style="text-align:left;">
The simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
H V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into all 1D domains at 1D water level (HQ, HS, HT) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
H V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of all 1D domains at 1D water level (HQ, HS, HT) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
SX2D V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into all 1D domains from 2D SX links since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
SX2D V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of all 1D domains from 2D SX links since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into all 1D domains from 1D flow (QH, QS, QT) boundaries, except for 1D QT Regions, since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of all 1D domains from 1D flow (QH, QS, QT) boundaries, except for 1D QT Regions since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
QR V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into all 1D domains from 1D QT Region flow boundaries, since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
QR V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of all 1D domains from 1D QT Region flow boundaries, since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q2D V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into hidden 1D nodes from 2D QT flow boundaries, since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q2D V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of hidden 1D nodes from 2D QT flow boundaries, since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
HX2D V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into all 1D domains across 2D HX links since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
HX2D V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of all 1D domains across 2D HX links since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Vol In-Out
</td>
<td style="text-align:left;">
Sum of all the volumes in less the sum of all the volumes out (i.e. the net volume of water in m<sup>3</sup> entering all the 1D domains since the previous time).
</td>
</tr>
<tr>
<td style="text-align:left;">
dVol
</td>
<td style="text-align:left;">
The change in the 1D domains’ volume in m<sup>3</sup> since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Vol Err
</td>
<td style="text-align:left;">
“dVol” minus “Vol In-Out” (i.e. the volume error or amount of water in m<sup>3</sup> unaccounted for since the previous time). A positive value indicates the 1D domains may have gained mass, while a negative value indicates a possible mass loss.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q ME (%)
</td>
<td style="text-align:left;">
(“Vol Err”/(ΣV In + ΣV Out))*100 (i.e. the percentage mass error based on the volume of water flowing through the 1D domains since the previous time). If (ΣV In + ΣV Out) is less than 1m<sup>3</sup>, “Q ME (%)” is set to zero to avoid divide by zero calculations.
</td>
</tr>
<tr>
<td style="text-align:left;">
Total Vol
</td>
<td style="text-align:left;">
The total volume of water in m<sup>3</sup> in the 1D domains.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Vol In+Out
</td>
<td style="text-align:left;">
The cumulative volume of water in m<sup>3</sup> entering and leaving the 1D domains (i.e. the cumulative total of (ΣV In + ΣV Out)).
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Vol Error
</td>
<td style="text-align:left;">
The cumulative volume error in m<sup>3</sup> (i.e. the cumulative total of “Vol Err”).
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum ME (%)
</td>
<td style="text-align:left;">
(“Cum Vol Error”/max(“Cum Vol In+Out” and “Total Vol”))*100 (i.e. the percentage mass error based on the maximum of the volume of water that has flowed through the 1D domains and the total volume of water in the 1D domains). This figure can be misleadingly low if the 1D domains have a very large volume of “stagnant” water such as from lakes or part of the ocean. If max (“Cum Vol In+Out” and “Total Vol”) is less than 1 m<sup>3</sup>, “Cum ME (%)” is set to zero to avoid divide by zero calculations. This figure is the second number displayed after “CE” on the Console Window.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Q ME (%)
</td>
<td style="text-align:left;">
(“Cum Vol Error”/“Cum Vol In+Out”)*100 (i.e. the percentage mass error based on the volume of water that has flowed through the 1D domains). If “Cum Vol In+Out” is less than 1 m<sup>3</sup>, “Cum Q ME (%)” is set to zero to avoid divide by zero calculations.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-MB2DFile">Table 123: </span><strong>MB2D.csv File Columns</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Time (h)
</td>
<td style="text-align:left;">
The simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
H V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the 2D domain/s at 2D water level (HQ, HS, HT) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
H V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the 2D domain/s at 2D water level (HQ, HS, HT) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Es HX V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the 2D domain/s across HX links to TUFLOW 1D (ESTRY) domains since the previous time. Note, this figure includes any 2D QT boundaries and 2D links as these become HX links connected to hidden 1D nodes.
</td>
</tr>
<tr>
<td style="text-align:left;">
Es HX V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the 2D domain/s across HX links to TUFLOW 1D (ESTRY) domains since the previous time. Note, this figure includes any 2D QT boundaries and 2D links as these become HX links connected to hidden 1D nodes.
</td>
</tr>
<tr>
<td style="text-align:left;">
x1D HX V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the 2D domain/s across HX links to an external 1D scheme since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
x1D HX V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the 2D domain/s across HX links to an external 1D scheme since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
SS V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the 2D domain/s from 2D flow sources (RF, SA, SH, ST) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
SS V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the 2D domain/s from 2D flow sources (RF, SA, SH, ST) boundaries since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Es SX V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the 2D domain/s through SX links to TUFLOW 1D (ESTRY) domains since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
Es SX V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the 2D domain/s through SX links to TUFLOW 1D (ESTRY) domains since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
x1D SX V In
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing into the 2D domain/s through SX links to an external 1D scheme since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
x1D SX V Out
</td>
<td style="text-align:left;">
The volume of water in m<sup>3</sup> flowing out of the 2D domain/s through SX links to an external 1D scheme since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
V In-Out
</td>
<td style="text-align:left;">
Sum of all the volumes in less the sum of all the volumes out (i.e. the net volume of water in m<sup>3</sup> entering the 2D domain/s since the previous time).
</td>
</tr>
<tr>
<td style="text-align:left;">
dVol
</td>
<td style="text-align:left;">
The change in the 2D domain/s’ volume in m<sup>3</sup> since the previous time.
</td>
</tr>
<tr>
<td style="text-align:left;">
V Err
</td>
<td style="text-align:left;">
“dVol” minus “V In-Out” (i.e. the volume error or amount of water in m<sup>3</sup> unaccounted for since the previous time). A positive value indicates the 2D domain/s may have gained mass, while a negative value indicates a possible mass loss.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q ME (%)
</td>
<td style="text-align:left;">
(“V Err”/(ΣV In + ΣV Out))*100 (i.e. the percentage mass error based on the volume of water flowing through the 2D domain/s since the previous time). This figure can be large at the start of a simulation if the 2D domain/s are rapidly wetting and the flow through the 2D domain/s is relatively small. This is a particular characteristic of steep 2D domains, particularly when using the direct rainfall approach. If (ΣV In + ΣV Out) is less than 1m<sup>3</sup>, “Q ME (%)” is set to zero to avoid divide by zero calculations.
</td>
</tr>
<tr>
<td style="text-align:left;">
Total V
</td>
<td style="text-align:left;">
The total volume of water in m<sup>3</sup> in the 2D domain/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum V In+Out
</td>
<td style="text-align:left;">
The cumulative volume of water in m<sup>3</sup> entering and leaving the 2D domain/s (i.e. the cumulative total of (ΣV In + ΣV Out)).
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum V Error
</td>
<td style="text-align:left;">
The cumulative volume error in m<sup>3</sup> (i.e. the cumulative total of “V Err”).
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum ME (%)
</td>
<td style="text-align:left;">
(“Cum V Error”/max(“Cum V In+Out” and “Total V”))*100 (i.e. the percentage mass error based on the maximum of the volume of water that has flowed through the 2D domain/s and the total volume of water in the 2D domain/s). This figure can be large at the start of a simulation if the 2D domain/s are rapidly wetting and the flow through the 2D domain/s is relatively small. This is a particular characteristic of steep 2D domains, particularly when using the direct rainfall approach with builds prior to Build 2008‑08‑AA. This figure can also be misleading low if the 2D domain/s have a very large volume of “stagnant” water such as from lakes or part of the ocean. If max (“Cum V In+Out” and “Total V”) is less than 1m<sup>3</sup>, “Cum ME (%)” is set to zero to avoid divide by zero calculations. This figure is the third number displayed after “CE” on the Console Window.
</td>
</tr>
<tr>
<td style="text-align:left;">
Cum Q ME (%)
</td>
<td style="text-align:left;">
(“Cum V Error”/“Cum V In+Out”)*100, ie. the percentage mass error based on the cumulative volume of water that has flowed through the 2D domain/s. This figure can be large at the start of a simulation if the 2D domain/s are rapidly wetting and the flow through the 2D domain/s is relatively small. This is a particular characteristic of steep 2D domains, particularly when using the direct rainfall approach. If “Cum V In+Out” is less than 1m<sup>3</sup>, “Cum Q ME (%)” is set to zero to avoid divide by zero calculations.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-TSMB">Table 124: </span><strong>TSMB GIS Layer Attributes</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
ID of the 1D node.
</td>
</tr>
<tr>
<td style="text-align:left;">
ME_Avg_Abs
</td>
<td style="text-align:left;">
The average of the absolute mass errors throughout the simulation. This is an excellent attribute for identifying 1D nodes that are regularly “bouncing”. By using the average of the absolute values, rather than the ME_Avg attribute below, any nodes that are bouncing either side of zero mass error will be identified. The best approach to identify these nodes is to using GIS thematic mapping tools to show, for example, large circles around nodes with high ME_Avg_Abs values down to small or no circle around nodes with zero ME_Avg_Abs values. The units are in m<sup>3</sup>/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
ME_Peak_m3s
</td>
<td style="text-align:left;">
The peak (positive or negative) mass error in m<sup>3</sup>/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
ME_Avg
</td>
<td style="text-align:left;">
The average mass error in m<sup>3</sup>/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
Not_used
</td>
<td style="text-align:left;">
This attribute is not yet used.
</td>
</tr>
<tr>
<td style="text-align:left;">
t____
</td>
<td style="text-align:left;">
The mass error in m<sup>3</sup>/s at time t____ hours.
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-TSMB1d2d">Table 125: </span><strong>TSMB1d2d GIS Layer Attributes</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
ID of the 1D node. The object appears as a 1D point for the node collectively combined with the 2D cells connected to that 1D node via the 2D HX link.
</td>
</tr>
<tr>
<td style="text-align:left;">
ME_Avg_Abs
</td>
<td style="text-align:left;">
The average of the absolute mass errors throughout the simulation. This is an excellent attribute for identifying HX links that have poor mass error or are “bouncing”. By using the average of the absolute values, rather than the ME_Avg attribute below, any HX links that are bouncing either side of zero mass error will be identified. The best approach to identify these links is to use GIS thematic mapping tools to differentiate the object display based on the ME_Avg_Abs values. The units are in m<sup>3</sup>/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
ME_Peak_m3s
</td>
<td style="text-align:left;">
The peak (positive or negative) mass error in m<sup>3</sup>/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
ME_Avg
</td>
<td style="text-align:left;">
The average mass error in m<sup>3</sup>/s.
</td>
</tr>
<tr>
<td style="text-align:left;">
Not_used
</td>
<td style="text-align:left;">
This attribute is not yet used.
</td>
</tr>
<tr>
<td style="text-align:left;">
t____
</td>
<td style="text-align:left;">
The mass error across the 2D HX link in m<sup>3</sup>/s at time t____ hours.
</td>
</tr>
</tbody>
</table>
<h3 class="hasAnchor" id="MB-HPC-3"><span class="header-section-number">14.8.3</span> TUFLOW HPC Mass Balance<a href="#MB-HPC-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- PAR + GRC to work out what to put in this chapter-->
<!-- done-->
<p>TUFLOW HPC writes the <strong>_MB_HPC.csv</strong> instead of the _MB2D.csv. The file contains mass balance tracking of volumes of water in and out, mass error calculations and other information (see Table <a href="#tab:tab-FileColumns">126</a>). The HPC scheme, being a finite volume scheme, is mathematically volume conservative. However, small mass errors may arise due to rounding errors in the summation of fluxes around the cell faces. These mass errors are real but very small - they are a direct function of the numerical precision used. Further, the summation process for computing the total volume in the domain is also subject to rounding errors. These errors are not real but may show as a very slight jitter in the summation result from timestep to timestep. Note that single precision computations use approximately 8 significant figures, and double precision computations use approximately 16 significant figures.</p>
<p>Unlike Classic, the HPC scheme does not provide a 2D map output of estimated mass error as this is essentially always zero due to the finite volume scheme formulation. However, a running estimate of domain integrated mass error is computed considering all inflows and outflows and the running surface water volume integral. These metrics are written to the _MB_HPC.csv file in the .tcf <a href="#tcfOutputFolder">Output Folder</a>.</p>
<table>
<caption>
<span id="tab:tab-FileColumns">Table 126: </span><strong>MB_HPC.csv File Columns</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Column
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Time (h)
</td>
<td style="text-align:left;">
Simulation time in hours.
</td>
</tr>
<tr>
<td style="text-align:left;">
iStep
</td>
<td style="text-align:left;">
Number of computational steps.
</td>
</tr>
<tr>
<td style="text-align:left;">
nRS_NaNs
</td>
<td style="text-align:left;">
Number of repeated timesteps due to Not a Number (NaN) occurring. A NaN occurs when the solution becomes unstable causing a divide by zero or other undefined calculation forcing a lowering and repeat of the timestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
nRS_HCNs
</td>
<td style="text-align:left;">
Number of repeated timesteps due to High Control Numbers (HCN). A HCN means that one of the three stability criteria was exceeded by more than 20% forcing a lowering and repeat of the timestep.
</td>
</tr>
<tr>
<td style="text-align:left;">
dtTarget
</td>
<td style="text-align:left;">
The target timestep (ie. the preferred timestep) calculated from the stability criteria. A lower timestep may have been used if approaching a times series or map output time, as HPC will reduce the timestep so that the solution timestepping coincides with the output time.
</td>
</tr>
<tr>
<td style="text-align:left;">
tLastMax
</td>
<td style="text-align:left;">
Time of the last recorded maximum water level.
</td>
</tr>
<tr>
<td style="text-align:left;">
H Vol In
</td>
<td style="text-align:left;">
Volume in since the previous time via 2D H boundaries (HQ, HT).
</td>
</tr>
<tr>
<td style="text-align:left;">
H Vol Out
</td>
<td style="text-align:left;">
Volume out since the previous time via 2D H boundaries (HQ, HT).
</td>
</tr>
<tr>
<td style="text-align:left;">
S/RF Vol In
</td>
<td style="text-align:left;">
Volume in since the previous time from 2D source boundaries (RF, SA, ST, Subsurface water return).
</td>
</tr>
<tr>
<td style="text-align:left;">
S/RF Vol Out
</td>
<td style="text-align:left;">
Volume out since the previous time from 2D source boundaries (RF, SA, ST, Infiltration).
</td>
</tr>
<tr>
<td style="text-align:left;">
HX Vol In
</td>
<td style="text-align:left;">
Volume in since the previous time via 2D HX boundaries.
</td>
</tr>
<tr>
<td style="text-align:left;">
HX Vol Out
</td>
<td style="text-align:left;">
Volume out since the previous time via 2D HX boundaries.
</td>
</tr>
<tr>
<td style="text-align:left;">
SX Vol In
</td>
<td style="text-align:left;">
Volume in since the previous time via 2D SX boundaries.
</td>
</tr>
<tr>
<td style="text-align:left;">
SX Vol Out
</td>
<td style="text-align:left;">
Volume out since the previous time via 2D SX boundaries.
</td>
</tr>
<tr>
<td style="text-align:left;">
V In-Out
</td>
<td style="text-align:left;">
Volume In less Volume Out of 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
dVol
</td>
<td style="text-align:left;">
Change in total volume of water within 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
V Err
</td>
<td style="text-align:left;">
“dVol” less “V In-Out”.
</td>
</tr>
<tr>
<td style="text-align:left;">
Total V
</td>
<td style="text-align:left;">
Total volume of water in 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;">
Q ME%
</td>
<td style="text-align:left;">
Mass error expressed as a percentage of “V Err”/(Vin + Vout).
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Viewing-Output-1"><span class="header-section-number">15</span> Viewing Outputs<a href="#Viewing-Output-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Meeting notes
 - Link from utilities to Ch15
 - Introduction mention terminology
 - Chapter rename - Output Viewing
 - videos to capture attention
-->
<!-- EFC
Proposed structure:
- Introduction
  (see ch9 for setting up output options)

- output folders (maybe) (certain folders (plot, grid) will always be created, find plot stuff in plot folder etc). nice to give examples (e.g. variables) link to {#Location-2}

- Map Output
  - overview
  - output structure 
    - 2d output folder 
    - formats (can reference other sections)
    - 1D (mmh, etc) {#GISBased-4}
    - 2D (mesh, grid etc)

  - viewing
    - mesh.
    - Grid
    - HR GRID
    - Thematic mapping
       (what is it?)
    - labelling
    
    - SGS Considerations (some specific text on SGS)
    
  - post processings
    (TUFLOW Utilities, Python (NC format) - if you want to do custom post-process on anything, best to use NC format (time varying,))
  
- Time Series Output
  - overview
  - output structure
    (e.g. plot folder - this is where you will find 1d, 2d po, 0d_rl outputs
      could be a table (credit EFC))
    - 1d output folder, plot folder, swmm output folder
    - formats
      (CSV, NC, GPKG, _TS Layers)
    - 1D (1d time series)
    - 2D (PO outputs)
    - Combined (RL outputs)
    - Structure Output
  - viewing
    (QGIS, ArcGIS, Mapinfo, Python)
  - post processing
    (excel, python)

- Impact analysis (EFC has done)

- Animations (EFC has done)

!!!!!New New structure!!!!

ES: I'd like to see practical tips or examples dotted throughout

- Introduction
- Folder Structure
- 1D Output
  - min/max - styling (there are defaults)
  - ccA - styling (there are defaults)
  - _TS
  - TPC - loading in via tuflow viewer - point to wiki
  - EOF
  - MB1D
  - WLL
- 2D Output
  - Mesh - tuflow viewer
  - Grid (raster) - netcdf raster can be loaded tuflow viewer (use HRNC)
  - PO outputs (PO.csv) - po outputs are also written to the TPC \ref@TPC
- post-processing
- Impact mapping
- animation  

-->
<h2 class="hasAnchor" id="Introduction-Viewing-2"><span class="header-section-number">15.1</span> Introduction<a href="#Introduction-Viewing-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter provides guidance on viewing and processing TUFLOW output. For guidance on customising outputs, see Chapter <a href="#Outputs-1"><strong>??</strong></a>. The fundamental software necessary for viewing results is discussed in Section <a href="#TheTUFLOWModellingConcept-2"><strong>??</strong></a>. The recommended software for viewing TUFLOW results, due to the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> contained within the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">QGIS TUFLOW Plugin</a>, is QGIS. This chapter is based on using QGIS as the viewing platform. It describes the following:</p>
<ul>
<li>Output folder structure (Section <a href="#Output-Folder-2"><strong>??</strong></a>);</li>
<li>1D outputs (Section <a href="#view-1D-2"><strong>??</strong></a>);</li>
<li>2D outputs (Section <a href="#view-2D-2"><strong>??</strong></a>);</li>
<li>Post processing and scripting (Section <a href="#Post-Process-2"><strong>??</strong></a>);</li>
<li>Impact mapping (Section <a href="#Impact-Map-2"><strong>??</strong></a>); and</li>
<li>Animation generation (Section <a href="#Animations-2"><strong>??</strong></a>).</li>
</ul>
<h2 class="hasAnchor" id="Output-Folder-2"><span class="header-section-number">15.2</span> Folder Structure<a href="#Output-Folder-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img align="right" style="border: 20px solid white" src="images/Results_Folder_v2.png" /></p>
<p>Simulation outputs are written, by default, as long as the <a href="#tcfMapOutputInterval">Map Output Interval</a> tcf command has been specified (a mandatory command). If an output folder has not been specified (see Section <a href="#Location-2"><strong>??</strong></a>), TUFLOW will write results to the folder in which the .tcf is located. It is recommended to use the <a href="#tcfOutputFolder">Output Folder</a> command to write results to a results folder, for example ‘TUFLOW\results’.</p>
<p>The adjacent image shows the typical folder structure of a TUFLOW model folder, including the breakdown of the results folder. The typical files found within the results folder are listed in Table <a href="#tab:tab-plotFolderplot">127</a>. Note, this will depend on the model and the output commands specified in the .tcf.</p>
<p>If no other output commands (detailed in Chapter <a href="#Outputs-1"><strong>??</strong></a>) have been defined, by default TUFLOW will write outputs in XMDF format, at the interval specified by the mandatory <a href="#tcfMapOutputInterval">Map Output Interval</a> command.</p>
<p>Within the results folder, TUFLOW will automatically create a ‘plot’ folder (for example ‘TUFLOW\results\plot’), containing both the .tpc output and a gis folder containing the TUFLOW plot output in .csv and GIS format (see Section <a href="#TimeSeries-2"><strong>??</strong></a>). If the user has requested <a href="#Grid-4">grid outputs</a>, TUFLOW will automatically create a ‘grids’ folder in the location where the results have been written (for example ‘TUFLOW\results\grids’). <br clear="right"/></p>
<p>What TUFLOW outputs depends on the output settings specified in the model. Table <a href="#tab:tab-plotFolderplot">127</a> describes the typical files contained within the Output folder. If using the <a href="#ecfOutputFolder">Output Folder</a> command within the .ecf (or <a href="#tcfStart1DDomain">Start 1D Domain</a> block) some of these outputs will be located in the folder referenced by that command.</p>
<table>
<caption>
<span id="tab:tab-plotFolderplot">Table 127: </span><strong>Plot Folder File Descriptions</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Folder
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Filename
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
results\
</td>
<td style="text-align:left;">
.xmdf / .dat
</td>
<td style="text-align:left;">
The 2D temporal mesh output (e.g. XMDF or DAT and associated file types). See Section <a href="#view-mesh-3"><strong>??</strong></a> for information on how to view these outputs.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\
</td>
<td style="text-align:left;">
_MB.csv<br />
_MB_HPC.csv<br />
_MB1d.csv<br />
_1d_MB.csv
</td>
<td style="text-align:left;">
Contains information on inflows and outflows, volume, predicted volume error and the mass and cumulative mass errors as a percentage. See Section <a href="#MB-CLA-3"><strong>??</strong></a> and Section <a href="#MB-HPC-3"><strong>??</strong></a> for information on these outputs.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\
</td>
<td style="text-align:left;">
_PO.csv<br />
_POMM.csv
</td>
<td style="text-align:left;">
<p>Contains time series data output from 2D domains, for a range of hydraulic parameters based on the specified time-series output data type.<br />
The _POMM file contains maximums, minimums, time of maximum and time of minimum information.</p>
See Section <a href="#View-PO-3"><strong>??</strong></a> for information on how to view these outputs.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\
</td>
<td style="text-align:left;">
_TS<br />
_TSF<br />
_TSL<br />
_TSMB<br />
_TSMB1d2d
</td>
<td style="text-align:left;">
<p>The _TS GIS layers contain time-series output with each layer presenting different information.<br />
The _TSF GIS layer contain the flow regimes of the culverts and pipes.<br />
The _TSL GIS layer contains the losses of the culverts and pipes.<br />
The _TSMB contains the time based 1D mass error.</p>
These time-series outputs are discussed further in Section <a href="#TS-GIS-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\
</td>
<td style="text-align:left;">
_1d_ccA
</td>
<td style="text-align:left;">
Contains information on culverts and bridges. See Section <a href="#ccA-4"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\
</td>
<td style="text-align:left;">
_1D_mmH<br />
_1D_mmQ<br />
_1D_mmV
</td>
<td style="text-align:left;">
GIS layers containing maximum/minimum values for water levels at nodes, and flows and velocities in channels. See Section <a href="#mm-4"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\grid
</td>
<td style="text-align:left;">
.tif / .flt / .asc
</td>
<td style="text-align:left;">
TUFLOW automatically writes raster outputs to a results\grids folder, in the format specified by the <a href="#tcfMapOutputFormat">Map Output Format</a> command. Users typically write maximum raster output only. User the mesh output for the temporal outputs due to file size and viewing abilities. See Section <a href="#view-raster-3"><strong>??</strong></a> for information on how to view these outputs.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\
</td>
<td style="text-align:left;">
.tpc
</td>
<td style="text-align:left;">
TUFLOW Plot Control file is a text file. It is used by the QGIS TUFLOW Plugin to load plotting dataset, as documented in the <a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Load_Results_-_Time_Series">TUFLOW Wiki</a>.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\csv\
</td>
<td style="text-align:left;">
_1d_Chan.csv<br />
_1d_Cmx.csv<br />
_1d_Nmx.csv<br />
_1d_Node.csv
</td>
<td style="text-align:left;">
The _1d_Chan layer contains information on the channel connectivity and properties.<br />
The _1d_Cmx layer contains the channel maximums data: flows and velocities as well as time of the maximums.<br />
The _1d_Nmx layer contains the node maximums data: water levels and energy levels.<br />
The _1d_Node layer contains information on the 1D nodes.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\csv\
</td>
<td style="text-align:left;">
_1d_&lt;ot&gt;.csv </ot>
</td>
<td style="text-align:left;">
Time series output for output type &lt;ot&gt; at the 1D nodes or channels. The output is controlled by the <a href="#ecfOutputDataTypes">Output Data Types</a> command, which by default includes “H”, “Q”, “S” and “V”. </ot>
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\csv\
</td>
<td style="text-align:left;">
_1d_O.csv
</td>
<td style="text-align:left;">
Operational structures time series output, including information on the operational status and time varying values of variables.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\csv\
</td>
<td style="text-align:left;">
_2d_&lt;ot&gt;.csv </ot>
</td>
<td style="text-align:left;">
Time series output for each 2d_po output type &lt;ot&gt;, as triggered by Read GIS PO commands. </ot>
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\csv\
</td>
<td style="text-align:left;">
_RLP_H.csv<br />
_RLP_Hmx.csv<br />
_RLL_Q.csv<br />
_RLL_Qmx.csv
_RLR_Vol.csv<br />
_RLR_Volmx.csv
</td>
<td style="text-align:left;">
<p>Reporting Location water levels (_H) and maximums plus other information at the peak water level (_Hmx).<br />
Reporting Location flows (_Q) and maximums plus other information at the peak flow (_Qmx).<br />
Reporting Location volumes (_Vol) and maximums plus other information at the peak volume (_Volmx).</p>
See Section <a href="#ReportingLocation-3"><strong>??</strong></a> for information on reporting locations.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\csv\
</td>
<td style="text-align:left;">
_SHmx.csv<br />
_SQ.csv
</td>
<td style="text-align:left;">
Maximums and other information (_SHmx) and time-series total structure flow (_SQ) for all 1D structures and grouped structure output (see Section <a href="#Structure-3"><strong>??</strong></a>). This output is controlled by the “S” option in <a href="#ecfOutputDataTypes">Output Data Types</a>, which by default includes “S”.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\gis\
</td>
<td style="text-align:left;">
_PLOT.csv
</td>
<td style="text-align:left;">
Summary .csv file containing information on the GIS objects and plot types available.
</td>
</tr>
<tr>
<td style="text-align:left;">
results\plot\gis\
</td>
<td style="text-align:left;">
_PLOT_L<br />
_PLOT_P<br />
_PLOT_R
</td>
<td style="text-align:left;">
GIS layer in a vector format containing all plot line objects (e.g. 1D channels and flow Reporting Locations), plot point objects (e.g. 1D nodes and water level Reporting Locations) or region objects (e.g. total volume within the region).
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="view-1D-2"><span class="header-section-number">15.3</span> 1D Output<a href="#view-1D-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW outputs the following 1D outputs:</p>
<ul>
<li>TUFLOW Plot Control file (.tpc) (Section <a href="#view-tpc-3"><strong>??</strong></a>)</li>
<li>Maximum and Minimum Output (Section <a href="#mm-4"><strong>??</strong></a>)</li>
<li>Closed Channels Performance (Section <a href="#ccA-4"><strong>??</strong></a>)</li>
<li>GIS Time Series Outputs (_TS) (Section <a href="#TS-GIS-3"><strong>??</strong></a>)<!--ES: Mainly thinking about how it can be used for stability checking--></li>
<li>Open Channel Water Level Line Output (Section <a href="#Viewing-WLL-4"><strong>??</strong></a>)</li>
<li>ESTRY Output File (.eof) (Section <a href="#EOF-2"><strong>??</strong></a>)<br />
</li>
<li>MB1D.csv (Section <a href="#MB-CLA-3"><strong>??</strong></a>)</li>
</ul>
<p>For viewing SWMM 1D results, see the <a href="https://wiki.tuflow.com/TUFLOW_Viewer#TUFLOW-SWMM_Results">TUFLOW-SWMM Result Wiki page</a></p>
<h3 class="hasAnchor" id="view-tpc-3"><span class="header-section-number">15.3.1</span> TUFLOW Plot Control file (TPC)<a href="#view-tpc-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A range of model time-series results from the 1D and 2D domains are output in .csv file format to the “results\plot\csv” folder. These files are traditionally used in spreadsheet software for graphing and time-series analysis. TUFLOW Plot Control file is a text file used by the TUFLOW Viewer (included in the QGIS TUFLOW Plugin) to load the plotting dataset into QGIS. Viewing the data spatially and temporally in QGIS is generally considered the preferred approach for day to day interaction with the csv files due to the increased workflow efficiency working in this manner. Documentation focused on viewing the .tpc in the TUFLOW Viewer is contained in the <a href="https://wiki.tuflow.com/TUFLOW_Viewer#Time_Series_Output">Time Series Output TUFLOW Wiki page</a>. Some key pages related to viewing 1D time-series (plot) outputs are listed below:</p>
<ul>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Load_Results_-_Time_Series">Loading in TPC</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Time_Series_Outputs_-_Plotting_Time_Series">Plotting Time Series</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Time_Series_Outputs_-_Plotting_Longitudinal_Profiles">Plotting Longitudinal Profiles</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Plotting_1D_Flow_Regime">Plotting 1D Flow Regimes</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Time_Series_Outputs_-_Plotting_1D_Cross-Section_Inputs">Plotting 1D Cross-Section Inputs</a></li>
</ul>
<p>An example of loading in a .tpc file into the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> is shown below.</p>
<center>
<video   width = "1000" autoplay muted id="myVideo">
<source src="videos/loading_tpc_sml.mp4" type="video/mp4">
</video>
</center>
<p><em>Note: The tcf <a href="#tcfStartTimeSeriesOutput">Start Time Series Output</a> and <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a> commands are used to control the period and frequency of output available in TUFLOW Viewer in QGIS.</em></p>
<h3 class="hasAnchor" id="mm-4"><span class="header-section-number">15.3.2</span> Maximum and Minimum Output<a href="#mm-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Maximum and minimum values for water levels at nodes, and flows and velocities in channels, are output to GIS layers with the
extensions 1d_mmH, 1d_mmQ and 1d_mmV, as well as to the end of the .eof file (see Section <a href="#EOF-2"><strong>??</strong></a>). The GIS layers can be opened in a GIS software, an example of the 1d_mmH and 1d_mmQ, with its automatic styling, is shown in Figure <a href="#fig:fig-mm-output">121</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-mm-output"></span>
<img src="images/mm-output.png" alt="**Maximum and Minimum Water Level and Flow Output**"  />
<p class="caption">
Figure 121: <strong>Maximum and Minimum Water Level and Flow Output</strong>
</p>
</div>
<p>The following attributes are contained in the 1d_mmH layer:</p>
<ul>
<li>Node: ID of the node.</li>
<li>Hmax: maximum water level.</li>
<li>Hmin: minimum water level.</li>
<li>tHmax: time of occurrence of the Hmax value.</li>
<li>tHmin: time of occurrence of the Hmin value.</li>
<li>dH: the largest water level drop across the channels that end at that node. Only channels that are digitised so that their downstream end is at the node are used to determine dH. Provided channels are digitised from upstream to downstream this is useful for identifying any increases in water level caused by any instabilities (thematically map the dH attribute – negative values indicate the water levels are increasing downstream). Pit channels are excluded from determining dH.</li>
</ul>
<p>The following attributes are contained in the 1d_mmQ layer:</p>
<ul>
<li>Channel: ID of the channel.</li>
<li>Qpeak: equal to the absolute maximum (positive or negative) flow. This is particularly useful for tidal reaches or where a channel has significant flows in both directions.</li>
<li>Qmax: maximum flow.</li>
<li>Qmin: minimum flow.</li>
<li>tQpeak: time of occurrence of the Qpeak value.</li>
<li>tQmax: time of occurrence of the Qmax value.</li>
<li>tQmin: time of occurrence of the Qmin value.</li>
<li>dHmax: difference in maximum water level drop through the channel. This is useful for quickly identifying large unexpected changes in flood level.</li>
<li>pSmax: the slope as a percentage of the water surface along the channel. This is useful for quickly identifying any troublesome behaviour along 1D networks by viewing/searching for any negative (adverse) slopes.</li>
<li>Style_SF: used for the automatic styling of the output. The value is a ratio based on the the channels Qmax value, and the maximum of all vMax values within the table and therefore will range between 0 and 1.</li>
<li>Style_dir: angle based on the channels digitised direction.</li>
</ul>
<p>The following attributes are contained in the 1d_mmV layer:</p>
<ul>
<li>Channel: ID of the channel.</li>
<li>Vpeak: equal to the absolute maximum (positive or negative). This is particularly useful for tidal reaches or where a channel has significant flows in both directions.</li>
<li>Vmax: maximum velocity.</li>
<li>Vmin: minimum velocity.</li>
<li>tVpeak: time of occurrence of the Vpeak value.</li>
<li>tVmax: time of occurrence of the Vmax value.</li>
<li>tVmin: time of occurrence of the Vmin value.</li>
<li>Style_SF: used for the automatic styling of the arrow. The value is a ratio based on the the channels Vmax value, and the maximum of all Vmax values within the table and therefore will range between 0 and 1.</li>
<li>Style_dir: angle based on the channels digitised direction.</li>
</ul>
<h3 class="hasAnchor" id="ccA-4"><span class="header-section-number">15.3.3</span> ccA GIS Layer<a href="#ccA-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The _ccA GIS layer contains a summary of information for culverts and bridges. It includes the following attributes:</p>
<ul>
<li>Channel = The ID of the channel.</li>
<li>pFull_Max = The percentage of the peak flow area over the culvert/bridge area. If the culvert/bridge flowed full at any point during the simulation this will be 100%.<br />
</li>
<li>pTime_Full = The percentage of time the culvert/bridge ran full over the time the culvert/bridge ran at least 10% full.<br />
</li>
<li>Area_Max = The peak flow area that occurred during the simulation.<br />
</li>
<li>Area_Culv = The culvert/bridge flow area (when full).<br />
</li>
<li>Dur_Full = The time in hours the culvert/bridge was running full.<br />
</li>
<li>Sur_CD = Surcharge cut-off depth. Depth above pit upstream invert for a pit to be considered surcharging.</li>
<li>Dur_Sur = Duration of surcharge. Total duration (hrs) that the pipe is considered surcharging.</li>
<li>pTime_Sur = Percent time that the pipe is surcharging relative to the time the pipe is running at 100% full.</li>
<li>TFirst_Sur = Time of first surcharge (hrs).</li>
<li>Dur_10pFull = The time in hours the culvert/bridge ran 10% full or more.</li>
</ul>
<p>The layer’s lines can be coloured and thickened according to the pFull_Max attribute (styled using the QGIS TUFLOW Plugin ‘Apply TUFLOW Styles’ Tool for .shp/.gpkg format or output directly for the .mid/.mif format). The thinner and paler the line, the smaller the pFull_Max value. The pFull_Time attribute is also useful for thematically mapping in GIS to identify culverts that are performing well, and others that are not. The example shown in Figure <a href="#fig:fig-ccA">122</a> illustrates the _ccA GIS layer output.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-ccA"></span>
<img src="images/cca.png" alt="Example of the ccA GIS Layer Highlighting Culvert Performance"  />
<p class="caption">
Figure 122: Example of the ccA GIS Layer Highlighting Culvert Performance
</p>
</div>
<h3 class="hasAnchor" id="TS-GIS-3"><span class="header-section-number">15.3.4</span> _TS GIS Layer<a href="#TS-GIS-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The 1D water levels at nodes (_1d_H.csv), and flows (_1d_Q.csv) and velocities (_1d_V.csv) in
channels are output in separate .csv files. This information is also provided in the _TS GIS layer and within the .eof file (Section <a href="#EOF-2"><strong>??</strong></a>). Maximum and minimum values are not output to the .csv files however are contained within both the _TS GIS layer and the .eof file as well as the 1d_mmH, 1d_mmQ and 1d_mmV GIS layers (Section <a href="#mm-4"><strong>??</strong></a>).</p>
<p>The _TS GIS layers contain time-series output with each layer presenting different information, as described below and in Table <a href="#tab:tab-TSGIS">128</a>. In addition to the time-series data, each layer contains several attributes at the start, summarising the time-series data. These attributes are:</p>
<ul>
<li>The maximum and minimum values;<br />
</li>
<li>The time in hours of the maximum and minimum values; and<br />
</li>
<li>The average and the average of the absolute mass error values (for the TSMB and TSMB1d2d files only).</li>
</ul>
<table>
<caption>
<span id="tab:tab-TSGIS">Table 128: </span>_TS GIS Layer Descriptions
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
GIS Layer Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
_TS_L<br />
_TS_P
</td>
<td style="text-align:left;">
Contains all 1D channel (velocities and flows), 1D nodes (water levels) and 2D PO (plot output locations from 2d_po layers).
</td>
</tr>
<tr>
<td style="text-align:left;">
_TSF_P
</td>
<td style="text-align:left;">
Contains the flow regime flags for culverts (see Table <a href="#tab:tab-FlowRegimes">23</a>), and other types of channels (see Table <a href="#tab:tab-RegimeFlags">119</a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
_TSL_P
</td>
<td style="text-align:left;">
Contains the culvert and bridge loss coefficients after any adjustments if <tcmd><a href="#ecfStructureLosses">Structure Losses</a></tcmd><teq> == </teq><tblk>ADJUST</tblk> or the “A” flag has been specified.<br />
If there is a manhole connected to one/both ends of a culvert, the loss coefficients will be affected by any manhole energy losses, as discussed in Sections <a href="#FixedLoss-4"><strong>??</strong></a>.<br />
For culverts, the three values shown for each time are the inlet (entry) loss coefficient; additional loss coefficient (this value is the sum of any 1d_nwk Form_Loss (bend loss) value on the channel or an upstream pit and any manhole energy loss contribution); and outlet (exit) loss coefficient.<br />
For bridges, the bridge loss coefficient adopted is shown.
</td>
</tr>
<tr>
<td style="text-align:left;">
_TSMB_P
</td>
<td style="text-align:left;">
Contains the mass errors at 1D nodes (refer to Section <a href="#MB-2"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;">
_TSMB1d2d_P
</td>
<td style="text-align:left;">
Contains the mass errors across 1D/2D interface linkages, ie. HX links (refer to Section <a href="#MB-2"><strong>??</strong></a>).
</td>
</tr>
</tbody>
</table>
<p>The _TS GIS layers can be loaded into QGIS. Once loaded, they will automatically appear in the TUFLOW Viewer Results window, allowing users to view time-series data, as shown in Figure <a href="#fig:fig-TS-Flow">123</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-TS-Flow"></span>
<img src="images/TS-Flow.png" alt="Example of the _TS Layer Flow Output" width="60%" />
<p class="caption">
Figure 123: Example of the _TS Layer Flow Output
</p>
</div>
<p>There are two ways to style the _TS layers. The first way is the default TUFLOW Styling, which displays arrows for velocity and flow, and points for water level. The second way is by using the Stability Checking Styling Tool. This tool styles the _TS layer into categories: likely unstable, possibly stable and stable, as shown in Figure <a href="#fig:fig-stability-style">124</a>. How to use this tool, and the rules applied to the categories are discussed on the <a href="https://wiki.tuflow.com/QGIS_TUFLOW_Apply_Stability_Styling">Stability Checking Styling Tool TUFLOW Wiki page</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-stability-style"></span>
<img src="images/stability-style.png" alt="Example of the _TS Layer Stability Styling" width="60%" />
<p class="caption">
Figure 124: Example of the _TS Layer Stability Styling
</p>
</div>
<p>Note that the output frequency of the time output in _TS GIS layers is automatically adjusted so that the limit of 245 output times is not
exceeded (this limit is the maximum number of attributes allowed in some GIS software). For example, if based on the <a href="#tcfTimeSeriesOutputInterval">Time Series Output
Interval</a> setting there are 400 output times, then every second time will be written to the _TS GIS layer
giving a total of 200 output times, but at least the full hydrograph is displayed!</p>
<p>For models that contain 1D operational structures (refer to Section <a href="#OperationalChannels-2"><strong>??</strong></a>), an additional file (_1d_O.csv)
will be output to the “results\plot\csv” folder containing information on the operation of each structure over time. This file serves as a valuable check for the commands defined within the .toc.</p>
<h3 class="hasAnchor" id="Viewing-WLL-4"><span class="header-section-number">15.3.5</span> 1D Water Level Lines (WLL)<a href="#Viewing-WLL-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As mentioned in Section <a href="#OneDMap-3"><strong>??</strong></a>, 1D domain results can be output in combination with 2D domain(s) by using the 1d_wll GIS layer and the <a href="#ecfReadGISWLL">Read GIS WLL</a> command. When WLL are used, the water level from the 1D node is interpolated into a 2D format when viewing the results (for both mesh and grid outputs). If the 1D WLLs and 2D domains overlap, the 1D results are displayed on top of the 2D results. Viewing of these 2D mesh and raster results is discussed in Section <a href="#view-mesh-3"><strong>??</strong></a> and <a href="#view-raster-3"><strong>??</strong></a>.</p>
<p>Additionally, viewing of 1D results in a 2D domain using the WLL functionality is demonstrated in <a href="https://wiki.tuflow.com/Tutorial_M11_001_Results_QGIS">Tutorial Module 11</a>.</p>
<h2 class="hasAnchor" id="view-2D-2"><span class="header-section-number">15.4</span> 2D Output<a href="#view-2D-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TUFLOW outputs the following 2D outputs:</p>
<ul>
<li>Mesh based outputs (Section <a href="#view-mesh-3"><strong>??</strong></a>)</li>
<li>Grid (raster) based outputs (Section <a href="#view-raster-3"><strong>??</strong></a>)</li>
</ul>
<p>Additionally, time-series data from the 2D domain can be output using plot outputs (Section <a href="#View-PO-3"><strong>??</strong></a>).</p>
<h3 class="hasAnchor" id="view-mesh-3"><span class="header-section-number">15.4.1</span> Mesh Output<a href="#view-mesh-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> (found in the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">QGIS TUFLOW Plugin</a>) can be used to load mesh temporal outputs in QGIS. When loading this data into TUFLOW Viewer, all map outputs specified by the user in the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> will automatically load under the results type panel. Symbology can be set for the outputs by right-clicking on the output in the results panel, in the same way described for raster outputs (Section <a href="#view-raster-3"><strong>??</strong></a>).</p>
<p>Documentation focused on map outputs in the TUFLOW Viewer is contained in the <a href="https://wiki.tuflow.com/TUFLOW_Viewer#Map_Output">TUFLOW Wiki Map Outputs</a> page. Some key pages related to viewing mesh outputs are linked below:</p>
<ul>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Load_Results_-_Map_Outputs">Loading Map Outputs</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Map_Outputs_-_Displaying_Maximum">Display Maximums</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Map_Outputs_-_Saving_Default_Styles">Save Default Styles</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Map_Outputs_-_Plotting_Time_Series">Plotting Time Series</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Map_Outputs_-_Plotting_Cross-Sections_And_Longitudinal_Profiles">Plotting Cross Sections</a></li>
</ul>
<p>An example of loading in an .xmdf file into the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> is shown below.</p>
<center>
<video   width = "1000" autoplay muted id="myVideo">
<source src="videos/loading_xmdf_sml.mp4" type="video/mp4">
</video>
</center>
<p><em>Note: Using <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a>, it is also possible to extract transect flow time-series from the mesh output result (see the <a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Map_Outputs_-_Plotting_Flow">TUFLOW Wiki</a> for details). Unfortunately, map outputs do not include all required information for accurate extraction of this output type. A more accurate way, and the recommended approach, to obtain flow time-series information is to use the 2D plot outputs (Section <a href="#View-PO-3"><strong>??</strong></a>).</em></p>
<h3 class="hasAnchor" id="view-raster-3"><span class="header-section-number">15.4.2</span> Raster Output<a href="#view-raster-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Grid (raster) based outputs can be loaded into QGIS via drag and drop. Once loaded, there is a range of <a href="https://docs.qgis.org/3.34/en/docs/training_manual/rasters/changing_symbology.html#follow-along-singleband-pseudocolor">styling options</a>. An example of setting the symbology for a raster layer is provided in <a href="https://wiki.tuflow.com/Tutorial_Site_Familiarisation_QGIS#Elevation_Data">Tutorial Model 1</a>.</p>
<p>It is also possible to load NetCDF rasters into TUFLOW Viewer (when the <a href="#tcfMapOutputFormat">Map Output Format</a> has been set to NC or HRNC). The <a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Load_Results_-_NetCDF_Grid">Loading NetCDF Grids Wiki page</a> describes this process.</p>
<h3 class="hasAnchor" id="View-PO-3"><span class="header-section-number">15.4.3</span> Plot Output<a href="#View-PO-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The location of plot outputs need to be defined prior to the simulation, as described in Section <a href="#TwoDTS-3"><strong>??</strong></a>. 2D time-series data from plot output (PO) or longitudinal profile (LP) data at locations defined using 2d_po and 2d_lp layers (see Section
<a href="#TwoDTS-3"><strong>??</strong></a>) are output as _PO.csv and _LP&lt; name&gt;.csv files into the “results” folder. These files can be used in spreadsheet software for graphing and time-series analysis. 2D plot outputs can also be loaded and viewed in the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> using the same method described in Section <a href="#view-tpc-3"><strong>??</strong></a>. An example of plotting 2d_po outputs is shown in <a href="https://wiki.tuflow.com/Tutorial_M01_Results_QGIS">Result Viewing - Tutorial 1</a>.</p>
<p>The commands <a href="#tcfStartTimeSeriesOutput">Start Time Series Output</a> and <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a> are used to control the
period and frequency of output.</p>
<p>When writing plot outputs, TUFLOW produces two .csv files, _PO.csv and _POMM.csv. _PO.csv is time-series data over the duration of the simulation. _POMM.csv reports the maximum and minimums. The columns included in the _POMM.csv file are:</p>
<ul>
<li>Output (for example, columns containing summary information for Flow, Water Level and Velocity)</li>
<li>Location (name of the 2d_po point, line or region)</li>
<li>Maximum (Extracted from Time Series)</li>
<li>Time of Maximum</li>
<li>Minimum (Extracted From Time Series)</li>
<li>Time of Minimum</li>
</ul>
<p>Time-series and maximum output in .csv files is also available when using Reporting Locations (see
Section <a href="#ReportingLocation-3"><strong>??</strong></a>) and Structure Groups (see Section <a href="#Structure-3"><strong>??</strong></a>). These two options provide the ability to combine 1D and 2D domain outputs. The .csv files that are produced are listed in Table <a href="#tab:tab-plotFolderplot">127</a>.</p>
<h2 class="hasAnchor" id="Post-Process-2"><span class="header-section-number">15.5</span> Post Processing<a href="#Post-Process-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The open non-proprietary file formats used by TUFLOW for its input and output make it well suited to automation via scripting as a means to improve workflow efficiency. Many modellers develop their own tools to assist in their use of TUFLOW and to automate many tasks. A <a href="https://gitlab.com/tuflow-user-group">GitLab TUFLOW User Group</a> has been established to support the sharing and collaborative development of these tools. These tools include scripts to assist with post-processing of TUFLOW outputs.</p>
<p>Where repeated plotting of results is required during a project, or there are a large number of charts to produce, Python scripts offer an attractive workflow efficient option. For some initial guidance regarding using Python scripts please see our <a href="https://www.tuflow.com/training/training-catalogue/tt052-python-for-tuflow-modellers/">Python
eLearning</a>.</p>
<p>Experienced python coders may also be interested in the <a href="https://wiki.tuflow.com/PyTuflow">PyTUFLOW tools</a>, developed to simplify result analysis and post-processing automation. PyTUFLOW for instance can allow real-time calibration plots to be produced during the course of a simulation.</p>
<p>Additionally, the TUFLOW Utilities offer a range of options for post-processing TUFLOW map and grid output. Some of the more common functions include:</p>
<ul>
<li>Creating a vector GIS (e.g. .shp) file of velocity vectors;<br />
</li>
<li>Creating a grid of the maximum values from two or more input grids; and<br />
</li>
<li>Calculating the affluxes between two grids (see Section <a href="#Impact-Map-2"><strong>??</strong></a>).</li>
</ul>
<p>Refer to Chapter <a href="#Utilities-1"><strong>??</strong></a> and the <a href="https://wiki.tuflow.com/TUFLOW_Utilities">TUFLOW Utilities Wiki Page</a> for further information on the TUFLOW Utilities.</p>
<h2 class="hasAnchor" id="Impact-Map-2"><span class="header-section-number">15.6</span> Impact Mapping<a href="#Impact-Map-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is often necessary to carry out a comparison of results between two or more model simulations. For example, to quantify the impact of a proposed development on the predicted flood extent and flood depths, or assess the sensitivity of the model due to changes in one of the parameters. A number of the TUFLOW utilities (refer to Section <a href="#Utilities-1"><strong>??</strong></a>) may be used to carry out this comparison. For example, the <a href="https://wiki.tuflow.com/ASC_to_ASC">ASC_to_ASC</a> utility may be used to compare the results contained in two grid output file (TIF, FLT or ASC formats). This utility outputs two result grids, shown in Figure <a href="#fig:fig-ImpactMap">125</a>:</p>
<ul>
<li>A difference grid subtracting the second input grid from the first; and<br />
</li>
<li>A second grid with a “_wd” suffix, denoting locations where the model was previously wet and now dry, and vice versa.</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-ImpactMap"></span>
<img src="images/ImpactMap.png" alt="**Impact Mapping**" width="40%" />
<p class="caption">
Figure 125: <strong>Impact Mapping</strong>
</p>
</div>
<p>An example of using the ASC_to_ASC utility to create an impact grid is available in the <a href="https://wiki.tuflow.com/Tutorial_M02#Impact_Assessment">TUFLOW Tutorial Module 2</a>.</p>
<p>Alternatively, the <a href="https://wiki.tuflow.com/RES_to_RES">RES_to_RES</a> utility may be used. Rather than comparing grid output, the RES_to_RES compares mesh result files
(e.g. .xmdf format) for a single timestep or all timesteps in the model simulation. Note, unlike ASC_to_ASC, RES_to_RES is
limited to comparing model results with the same underlying .2dm mesh file.</p>
<p>Further information on ASC_to_ASC, RES_to_RES and the other TUFLOW utilities are discussed in Chapter <a href="#Utilities-1"><strong>??</strong></a>, with more detail and examples via the <a href="https://wiki.tuflow.com/TUFLOW_Utilities">TUFLOW Wiki Utilities page</a>.</p>
<h2 class="hasAnchor" id="Animations-2"><span class="header-section-number">15.7</span> Animations<a href="#Animations-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Result animations can be exported from the <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> for all accepted result types (map outputs, time series, particles etc). The process for animation creation is the same regardless of the result type. The tool will export an image for each timestep in a given range, then use ffmpeg to convert the images into a video file. TUFLOW Viewer offers the additional functionality of adding dynamic plots and dynamic time text. It also offers convenience functionality for adding items such as a legend, images etc, however these can also be added manually in the print layout.</p>
<p>Instructions on how to export animations is found on the <a href="https://wiki.tuflow.com/TUFLOW_Viewer_-_Exporting_An_Animation">TUFLOW Wiki</a> and an example provided in the below video.</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dS4jNLtPBJc?si=Ygh-oLLcWsH9Z4Jv" title="TUFLOW Viewer - Exporting Animations" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>
</iframe>
<p></centre></p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="QualityControl-and-Troubleshooting-1"><span class="header-section-number">16</span> Quality Control and Troubleshooting<a href="#QualityControl-and-Troubleshooting-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="QAIntroduction-2"><span class="header-section-number">16.1</span> Introduction<a href="#QAIntroduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Proficient and effective 1D and 2D hydrodynamic modelling is a skill
that takes time to develop. During the development of these skills, most
modellers may produce “unhealthy” models at some point (i.e. models that are
problematic in that they regularly go unstable, produce strange flow
patterns, etc.). Whilst, in most cases, the reasons for problems are due to
the quality of input data, other reasons include poor model
schematisation, and, of course, human error. With mentoring from
experienced modellers, and/or following an iterative testing process,
unhealthy models can be corrected to become healthy, and hydrodynamic
modelling skill levels greatly enhanced. This section attempts to convey some ways to identify problematic areas within an unhealthy model, and solutions to resolving the problem.</p>
<h2 class="hasAnchor" id="ModelHealth-2"><span class="header-section-number">16.2</span> Model Health<a href="#ModelHealth-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Due to the computational differences associated with the two solvers, TUFLOW Classic and TUFLOW HPC, there are slightly different approaches to assess and deal with model health issues in each. The following sections will outline the characteristics of unhealthy models in TUFLOW Classic and HPC separately, though the general approach to troubleshooting is very similar.</p>
<h3 class="hasAnchor" id="TUFLOWClassicModelHealth-3"><span class="header-section-number">16.2.1</span> TUFLOW Classic<a href="#TUFLOWClassicModelHealth-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unhealthy TUFLOW Classic models usually exhibit one or more of the following
characteristics:</p>
<ul>
<li>The model only remains stable if using a smaller than recommended
timestep.<br />
</li>
<li>Poor mass error (&gt; ±1 %) as indicated by the “CE” percentages
displayed to the Console Window (see Section <a href="#Classic-3"><strong>??</strong></a>), and output
to the various mass balance files as described in
Section <a href="#MB-2"><strong>??</strong></a>.<br />
</li>
<li>“Unnatural” fluctuations of flow in/out and change in volume values
(i.e. the Qi, Qo and dV values displayed to the Console Window)
discussed in Section <a href="#Classic-3"><strong>??</strong></a>.<br />
</li>
<li>Locations in the model that repetitively have negative depth WARNINGs.
These repeatedly appear as a message such as: <em>“<a href="https://wiki.tuflow.com/TUFLOW_Message_2991">WARNING 2991</a> - Negative
U depth at [030;088], Time = 0:01:30, Depth = -0.4…”</em>. The occurrence
of the message several times at a location is usually not an issue
(this means that the model experienced a short and slight numerical
disturbance), however, if it repeatedly occurs for a period of time,
it is good practice to resolve the source of the problem as this numerical
disturbance may cause mass errors, possibly forcing the
use of too small a timestep, and may initiate an instability in a
future simulation.</li>
</ul>
<p>If one or more of the above apply, the model needs to be reviewed and
the cause of the unhealthy behaviour identified. This can be a daunting and difficult task for inexperienced modellers, however, the guidelines in the sections below are hopefully of some assistance.</p>
<h4 class="hasAnchor" id="TUFLOWClassicTimestep-4"><span class="header-section-number">16.2.1.1</span> Timestep<a href="#TUFLOWClassicTimestep-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the majority of TUFLOW Classic flood models, the 2D <a href="#tcfTimestep">Timestep</a> in
seconds should be somewhere between <span class="math inline">\(\frac{1}{2}\)</span> to <span class="math inline">\(\frac{1}{5}\)</span> of
the 2D <a href="#tgcCellSize">Cell Size</a> (in metres). For example, a 10m 2D grid
should use a timestep of between 2 and 5 seconds. 2D domains with
predominantly sub-critical flow usually can have timesteps larger than
those for steeper models with significant areas of supercritical flow.</p>
<p>For coastal models, models with large cell sizes (&gt;50m) or models with
significant areas of deep water (&gt;20m), the above rule-of-thumb may not
apply with the timestep often being smaller. This is due to the Courant
condition described in Section <a href="#TimestepBackground-2"><strong>??</strong></a>.</p>
<p>There is a tendency for hydraulic modellers to “solve” an instability by
reducing the model timestep. Whilst this may “work”, if the required timestep is less than the above mentioned recommended minimums, it is usually not
solving the fundamental cause of the model’s poor hydraulic performance
or instability. Using too small a timestep can mask fundamental problems in the input data, and hide mistakes in the construction of the model. For example, if the user accidentally applies a topography modifier with an elevation -99m below the surrounding cells, a small timestep may “remove” the
instability but does not resolve the issues in the input data.</p>
<p>Using a too large a timestep will cause mass errors. If the model runs
stable without any negative depth warnings, yet the cumulative mass
error is poor throughout the simulation, this is often an indication
that the 1D and/or 2D timesteps are too large.</p>
<h3 class="hasAnchor" id="TUFLOWHPCModelHealth-3"><span class="header-section-number">16.2.2</span> TUFLOW HPC<a href="#TUFLOWHPCModelHealth-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>TUFLOW HPC uses an explicit finite volume scheme. It uses an automatic adaptive timestep routine which is unconditionally stable and provides 100% 2D mass conservation. TUFLOW HPC will not show a mass balance error like TUFLOW Classic but rather, in situations where the stability is threatened, the model timestep is reduced. In recognition of this behaviour, reviewing the minimum timestep is useful in determining the health of a TUFLOW HPC model. For TUFLOW HPC, the *_dt_Min map output file can be used to identify the specific location that is requiring the minimum timestep to achieve simulation stability. This is useful output to help identify where the modeller should be reviewing model inputs and model schematisation.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-DTOutput"></span>
<img src="images/DT_Map_Output.png" alt="**TUFLOW HPC Minimum Timestep (dt) Map Output**" width="70%" />
<p class="caption">
Figure 126: <strong>TUFLOW HPC Minimum Timestep (dt) Map Output</strong>
</p>
</div>
</center>
<p>Unhealthy TUFLOW HPC models usually exhibit one or more of the following
characteristics:</p>
<ul>
<li>A large number of repeat timesteps within the Console Window. The total number of repeated timesteps is recorded in the Simulation Summary section at the end of the .tlf file, and is reported to the _messages layer. Repeated timesteps are an indication that the TUFLOW HPC 2D solution is numerically “on-the-edge”. Models that have a high number of repeated timesteps should be sensitivity tested by reducing the control number limits using the <a href="#tcfControlNumberFactor">Control Number Factor</a> command.<br />
</li>
<li>The model only remains stable if using an excessively small timestep.<br />
</li>
<li>Oscillating timesteps and controls numbers as shown in the <a href="https://wiki.tuflow.com/HPC_Model_Review#HPC_dt_Time_Series_Output_.28.2A.hpc.dt.csv.29">*.hpc.dt.csv</a> output to the log folder.<br />
</li>
<li>“Unnatural” fluctuations of flow in/out and change in volume values
(i.e. the Qi, Qo and dV values displayed to the Console Window)
discussed in Section <a href="#Classic-3"><strong>??</strong></a>.</li>
</ul>
<p>Like TUFLOW Classic, if one or more of the above apply, the model needs to be reviewed, the cause identified and rectified.</p>
<p><strong>Note: Although TUFLOW HPC is 100% mass conservative and will not produce any mass error in the 2D, it is still important to review the Mass Error from a simulation. Mass Error can occur in poorly configured models when coupling HPC with 1D elements (either associated with the 1D/2D linking or in the 1D scheme itself).</strong></p>
<h4 class="hasAnchor" id="TUFLOWHPCTimestep-4"><span class="header-section-number">16.2.2.1</span> Timestep<a href="#TUFLOWHPCTimestep-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The TUFLOW HPC solver, by default, uses adaptive timestepping to progress through the simulation. The timestep is adjusted so that it complies with the mathematical stability criteria of a 2D explicit solution. Due to the underlying solution scheme, TUFLOW HPC typically uses a smaller timestep than Classic. As a general rule, a healthy TUFLOW HPC timestep is roughly <span class="math inline">\(\frac{1}{10}\)</span> of a TUFLOW Classic healthy timestep (i.e. for a cell size of 10m, a healthy TUFLOW Classic timestep would be 2 to 5s, and therefore a healthy TUFLOW HPC timestep would be between 0.2 to 0.5s).</p>
<p>There are three primary processes that determine the maximum timestep that an explicit solution of the Shallow Water Equations can use:</p>
<ul>
<li><strong>Courant Number, Nu:</strong> The Courant number relates to velocity relative to the cell size. Higher velocities will trigger this as the timestep control.</li>
<li><strong>Wave Celerity Number, Nc:</strong> The Celerity Control number relates to water depth relative to cell size. Energy can pass through deeper water faster than shallow water, as such deep water will trigger this control.</li>
<li><strong>Diffusion Number, Nd:</strong> The diffusion control relates diffusion of momentum relating to the sub grid viscosity. Small cells subject to deep water will trigger this control.</li>
</ul>
<p>Further description of these control numbers is provided on the <a href="https://wiki.tuflow.com/HPC_Adaptive_Timestepping">TUFLOW Wiki</a>.</p>
<p>TUFLOW will use the highest timestep possible without exceeding the limits associated with each of the control numbers. The <a href="https://wiki.tuflow.com/HPC_Model_Review#HPC_TUFLOW_Log_File_.28.2Ahpc.tlf.29">.hpc.tlf log file</a> records the model timestep, control numbers and the volume of water in model at each timestep. It also shows repeated timesteps if the control number limits were exceeded or there is a significant change in control numbers (more than 20%). If a model has a sudden change in rainfall between timesteps, or has a warmup period with small flow rate before a large inflow then repeated timesteps are possible. However, if there is a high occurrence of repeating timesteps when the boundary inflows are smooth, this could be an indicator of model instability. The total number of repeated timesteps is also recorded in Simulation Summary of the .tlf file.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HPCrepeatingtimestep"></span>
<img src="images/HPC_repeating_timestep.png" alt="**TUFLOW HPC.TLF Repeating Timesteps**" width="90%" />
<p class="caption">
Figure 127: <strong>TUFLOW HPC.TLF Repeating Timesteps</strong>
</p>
</div>
</center>
<p>It is possible to plot the time-varying control number settings from the <a href="https://wiki.tuflow.com/HPC_Model_Review#HPC_dt_Time_Series_Output_.28.2A.hpc.dt.csv.29">*.hpc.dt.csv</a> that is output to the log folder when running a TUFLOW HPC simulation. This can be done using spreadsheet software such as Excel, or a scripting language such as python. An example using a drag and drop tool, the <a href="https://tuflow-summary-dashboard-7ef3779828a5.herokuapp.com/">TUFLOW Summary Dashboard</a>, is shown in Figure <a href="#fig:fig-HPCDTCSV">128</a>. The tool is available on the <a href="https://gitlab.com/tuflow-user-group">TUFLOW Gitlab User Group</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-HPCDTCSV"></span>
<img src="images/HPC_DT_CSV.png" alt="**Timestep and Control Numbers plotted from the .hpc.dt.csv**" width="90%" />
<p class="caption">
Figure 128: <strong>Timestep and Control Numbers plotted from the .hpc.dt.csv</strong>
</p>
</div>
</center>
<p>The two key features that modellers should look for in the hpc.dt.csv output, is erratic oscillation of the timestep values and extremely low timesteps. If an oscillating timestep or an unusually low timestep is observed in the HPC dt time series, it is important to review the associated value for each control number (Nu, Nc and Nd). This will allow the modeller to determine which hydraulic condition is limiting the timestep. Since the 2023-03 release of TUFLOW, it is also possible to provide map output for the three control number using the <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> command which can also help identify model features leading to reduced timesteps.</p>
<h3 class="hasAnchor" id="TUFLOWQAIndicators-3"><span class="header-section-number">16.2.3</span> Healthy Model Indicators<a href="#TUFLOWQAIndicators-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A summary of healthy model indicators is provided at the end of the simulation on the display console, and at the end of the .tlf file. A selection of these indicators are also written to the “_ TUFLOW Simulations.log” files – see Section <a href="#SimLog-2"><strong>??</strong></a>. The indicators are discussed in Table <a href="#tab:tab-ModelIndicators">129</a> below.</p>
<p><strong>Note, these model health reporting items should be used in
conjunction with good model review practices. They are a set of indicators of various model health parameters. They are not definitive proof that a
simulation was or was not healthy.</strong></p>
<table>
<caption>
<span id="tab:tab-ModelIndicators">Table 129: </span><strong>Simulation Summary Healthy Model Indicators</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Model Health Reporting Item
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Total Negative Depths
</td>
<td style="text-align:left;">
<p>The occurrence of negative depths at 1D nodes or 2D cell sides is an indication that the solution has not converged or has over-stepped at that location and time. <a href="https://wiki.tuflow.com/TUFLOW_Message_1991">WARNING 1991</a> for 1D nodes and <a href="https://wiki.tuflow.com/TUFLOW_Message_2991">WARNING 2991</a> at 2D cell mid-sides are issued each time a negative depth greater than -0.1m occurs. The location of these warnings can be viewed using the _messages GIS layer.</p>
From a healthy model perspective, the occasional negative depth is not necessarily a concern, but repeat occurrences at the same location are an indication of a potential issue. See Section <a href="#tuflowinstability-3"><strong>??</strong></a> for further discussion. Negative depths may often precede an instability.
</td>
<td style="text-align:left;">
Classic/HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
WARNINGs and CHECKs prior to and during simulation
</td>
<td style="text-align:left;">
Number of CHECKs and WARNINGs issued. At key stages of a project, review any CHECKs and WARNINGs, and if needed, resolve any issues, particularly for WARNINGs. If a CHECK or WARNING is not in the _messages layer, this means that it could not be located geographically and only occurs in the .tlf file (search the .tlf file to review them).
</td>
<td style="text-align:left;">
Classic/HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
Peak Flow
In and Out
(m<sup>3</sup>/s)
</td>
<td style="text-align:left;">
Review these numbers in the sense that they are in accordance with your expectations. Usually the “Peak Flow In” exceeds the “Peak Flow Out” for flood simulations due to the flood wave being attenuated as it travels through the model. Note, at boundaries where a circulation develops, there will be flow in and out and these amounts will contribute to the Flow In and Out of the model as reported here and in the _MB.csv files. This behaviour is indicative of a boundary line that is not well aligned (perpendicular to flow) and possibly should be changed.
</td>
<td style="text-align:left;">
Classic
</td>
</tr>
<tr>
<td style="text-align:left;">
Volume
at Start and End
(m<sup>3</sup>)
</td>
<td style="text-align:left;">
The volume of water in the model at the start and end of the simulation. Review these numbers, and confirm they are sensible. A very large residual volume at the end of the simulation may indicate that the simulation was not run for long enough, for example, the flood may not have reached its peak. The time of peak water level is also a good indicator of this, if the time of peak water level is the same as the end time of the simulation, the simulation has likely not run long enough for the flood waters to peak.
</td>
<td style="text-align:left;">
Classic/HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
Volume
In and Out
(m<sup>3</sup>)
</td>
<td style="text-align:left;">
The total volume of water in and out of the model during the simulation. Review these numbers to confirm they make sense. Usually the volume out is less than the volume in, as the model has a residual amount of water left in it at the end of the simulation.
</td>
<td style="text-align:left;">
Classic/HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
Volume Error
(m<sup>3</sup>)
Final Cumulative
ME%
</td>
<td style="text-align:left;">
<p>Volume Error is the loss or gain in water over the course of the simulation. Volume Error is equal to:</p>
<p>(Total Volume In - Total Volume Out) – (Volume at End – Volume at Start)</p>
The Volume Error % value is the Volume Error divided by the Volume In + Out.<br />
The Final Cumulative Mass Error % is calculated throughout the simulation using a similar formula, so should be similar to the Volume Error %. Ideally these values should be less than 1%, but 2 or 3% can be acceptable depending on the objectives of the modelling. Values exceeding 3% usually indicate there are significant problems with the model.
</td>
<td style="text-align:left;">
Classic/HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
Peak +ve and –ve dV
(m<sup>3</sup>)
</td>
<td style="text-align:left;">
dV is the change in volume over the whole model in one timestep, and the values shown here are the peak positive and negative dV values. <b>Note: these values will be different to those shown on the display console or in the _MB.csv files </b> if the <a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a> or <a href="#tcfMassBalanceOutputInterval">Mass Balance Output Interval</a> are not set to the computational timestep.<br />
The time in hours that the Peak dV values occurred is also shown.
</td>
<td style="text-align:left;">
Classic
</td>
</tr>
<tr>
<td style="text-align:left;">
Peak ddV
(m<sup>3</sup>)
(% of Peak dV)
</td>
<td style="text-align:left;">
Peak ddV is the maximum (positive or negative) change in dV over one timestep, and the % value is the % of the maximum Peak dV value. A large ddV value or % indicates the model may have been unsteady at some point. This may not be unusual in a model with complex hydraulics, however, it is another indicator of whether there may be somewhere in the model that needs reviewing.
</td>
<td style="text-align:left;">
Classic
</td>
</tr>
<tr>
<td style="text-align:left;">
Peak Cumulative ME
</td>
<td style="text-align:left;">
The peak CME% value that occurred. As discussed above, ideally this value should be less than 1%, though larger values can be acceptable depending on the objectives of the modelling. For example, higher numbers may occur during the intimal wetting of a Classic model, though still have a negligible impact on the overall model results.
</td>
<td style="text-align:left;">
Classic
</td>
</tr>
<tr>
<td style="text-align:left;">
Values under
“Qi+Qo &gt; 5%”
</td>
<td style="text-align:left;">
The values under “Qi+Qo &gt; 5%” are for the period of the simulation when the flow in and out exceeded 5% of the peak flow in and out, and are representative of the bulk of the simulation once the flood wave has begun flowing. These indicators are designed to exclude an initial period of any unsteadiness at the start of the simulation that may occur in some models.
</td>
<td style="text-align:left;">
Classic
</td>
</tr>
<tr>
<td style="text-align:left;">
HPC HCN Repeated Timesteps
</td>
<td style="text-align:left;">
<p>TUFLOW HPC repeats timesteps if the control number limits are exceeded or if there is a significant change in control numbers (&gt;20%). The three control numbers (Courant Number, Wave Celerity Number and Diffusion Number) determine the maximum timestep for the TUFLOW HPC adaptive timestepping. They are reported in the tlf and in the hpc.dt.csv. In general terms:</p>
<ul>
<li>Courant number relates to velocity relative to the cell size. High velocities will trigger this as the control. The Courant Number should be less than 1;<br />
</li>
<li>Celerity Control number relates to water depth relative to cell size. Energy can pass through deeper water faster than shallow water, as such deep water will trigger this control. The Wave Celerity number should be less than 1;<br />
</li>
<li>Diffusion control relates diffusion of momentum relating to the sub grid viscosity. Small cells in deep water will trigger this one. The diffusion control number should be less than 0.3.</li>
</ul>
A repeat timestep on its own is not necessarily an indication of an unstable model. Oscillating control numbers may be indictive of an unstable TUFLOW HPC model.
</td>
<td style="text-align:left;">
HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
HPC NaN Repeated Timesteps
</td>
<td style="text-align:left;">
Each TUFLOW HPC timestep is tested for the occurrence of a NaN (Not a Number) which can occurs due to undefined mathematical calculations such as a divide by zero or square root of a negative number. The occurrence of a NaN is indicative of a sudden instability.
</td>
<td style="text-align:left;">
HPC
</td>
</tr>
<tr>
<td style="text-align:left;">
HPC NaN Warning 2550
</td>
<td style="text-align:left;">
Provides the cumulative sum of the number of TUFLOW HPC timestep corrections (indicated by <a href="https://wiki.tuflow.com/TUFLOW_Message_2550">WARNING 2550</a>) have been made in order for the TUFLOW HPC solution to remain stable. Whilst not always sign of an unstable model, it is worth reviewing especially in the case of a large number of repeated timesteps.
</td>
<td style="text-align:left;">
HPC
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="QATroubleshooting-2"><span class="header-section-number">16.3</span> Troubleshooting<a href="#QATroubleshooting-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Despite the best efforts of a modeller to be proactive in creating healthy models, some aspect of review and troubleshooting may be required to generate a healthy and robust model.</p>
<p>The most common cause for an unhealthy model is poor underlying
topography. In the case of 2D domains, the quality of the Digital Terrain Model (DTM) is often the problem, therefore, investing time to create truly representative, well-constructed, DTMs is highly recommended from both the modelling perspective and the quality of the inundation mapping.</p>
<p>For 1D domains, topographic inaccuracies in cross-section data and at
structures is often the source of problems, although model schematisation can sometime also be the source of issues. As a general statement, 1D modelling is more of an “art” than 2D modelling, due to the need for user judgement associated with the selection of cross-section locations, and schematisation of the 1D domain.</p>
<p>For 1D-2D models, often poor stability of the 1D domain can lead to instabilities in the combined model at higher flows when flow comes out of bank. Therefore, it is suggested that the 1D model is tested to ensure stability prior to coupling with the 2D domain where possible. Care should also be taken in the schematisation of any 1D-2D linkages.</p>
<p><strong>Tip: Take an iterative approach to solving problems. As a model stability issue may cascade to cause others, when searching through the _messages GIS
file, resolve the problems in order of occurrence (i.e. in the order the
messages appear in a QGIS attributes table, top to bottom). Solving issues earlier may automatically resolve the errors reported later in the simulation </strong></p>
<h3 class="hasAnchor" id="QAGeneralComments-3"><span class="header-section-number">16.3.1</span> General Comments<a href="#QAGeneralComments-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When building a model, be proactive about ensuring the data is as complete as possible and accurately reflects reality. For 1D stormwater pipe network data, use the <a href="https://wiki.tuflow.com/1D_Integrity_Tool">1D Integrity Tool</a> is recommended to ensure data is consistent and free of common errors, prior to use within a TUFLOW model simulation. The TUFLOW ‘test’ mode can also be used to test the data inputs without the simulation phase, see Section <a href="#BatchFileExamples-4"><strong>??</strong></a> for more details. This can be used in the initial model testing phase without using the high specification modelling hardware that is often required for the hydrodynamic simulation.</p>
<p>Problems in the input data that get through this initial integrity check are readily identified by using <a href="#tcfWriteCheckFiles">Write Check Files</a> command in the .tcf file and/or <a href="#ecfWriteCheckFiles">Write Check Files</a> in the .ecf file to generate GIS check files. These files represent the final combination of the 2D and 1D data inputs, and are excellent for identifying data input problems. A detailed description of all available check files is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Check_Files">TUFLOW Wiki</a>.</p>
<p>If the model becomes unstable, TUFLOW writes output data for the last computed timestep. The location of stability is easily found by viewing the results for the last timestep. Very large velocity vectors and/or excessively high or low water levels usually occur in the vicinity of the instability.The instability can also be located using the <strong>_messages.shp / .gpkg files</strong> (see Section <a href="#Messages-3"><strong>??</strong></a>).</p>
<p>Always search the .tlf files for the terms, “UNSTABLE”, “WARNING”, “CHECK” and “ERROR”. ERRORs stop the simulation, while WARNINGs and CHECKs do not.
Note, it is possible that latter errors are caused by earlier warnings, therefore, search through the .tlf files, or start at the beginning of the
attributes within the _messages.shp/.gpkg file, resolve the earlier
errors first, rather than working backwards from the final error which
resulted in the instability.</p>
<p>The Troubleshooting section of the <a href="https://wiki.tuflow.com/TUFLOW_Messages">TUFLOW Wiki</a>
contains a comprehensive database of TUFLOW “CHECK”, “WARNING” and “ERROR”
messages. Each “CHECK”, “WARNING” and “ERROR” message has its own Wiki page documenting a description of the message, and suggestions how to address the message.</p>
<h3 class="hasAnchor" id="tuflowinstability-3"><span class="header-section-number">16.3.2</span> Instability Identification<a href="#tuflowinstability-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Instabilities usually start with one or a few computational points
“bouncing” as a result of poor convergence of the mathematical equations
being solved. To help identify the start of an instability, negative
depth warnings are issued if the depth in a 2D cell (usually TUFLOW Classic only) or a 1D node falls below ‑0.1m. Negative depth warnings are usually a pre-cursor to an instability of the true expected solution. It is not uncommon, particularly in areas of rapid wetting and drying for negative depths to occur before the computational point is made dry (inactive). Hence a buffer of -0.1m is used before reporting a WARNING.</p>
<p>The WARNING messages are sent to the _messages.shp / .gpkg file (see Section
<a href="#Messages-3"><strong>??</strong></a>). Import or open this file in GIS software to identify the location of the negative depth calculation. If the number of these warnings
are substantial (e.g. if a model remains stable but with minor
instabilities), select some of the first negative depth warnings in the
attribute data and display just those. The warnings are in order of
occurrence. By tracing through the negative depth warnings in the
vicinity of the instability, the original source of the instability can
usually be located.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-Warning2551"></span>
<img src="images/unstable_Depths.png" alt="**TUFLOW Warning 2551 Messages in QGIS**" width="70%" />
<p class="caption">
Figure 129: <strong>TUFLOW Warning 2551 Messages in QGIS</strong>
</p>
</div>
</center>
<p>TUFLOW also uses defined 1D and 2D water level threshold values to trigger an instability message. The commands associated with these thresholds are <a href="#ecfDepthLimitFactor">Depth Limit Factor</a> (1D domains)
and <a href="#tcfInstabilityWaterLevel">Instability Water Level</a> (2D domains).</p>
<h4 class="hasAnchor" id="onedinstability-4"><span class="header-section-number">16.3.2.1</span> 1D (ESTRY) Domains<a href="#onedinstability-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As advised in Section <a href="#tuflowinstability-3"><strong>??</strong></a> for 2D domains, the location of an instability should be determined by investigating where the <a href="https://wiki.tuflow.com/TUFLOW_Message_1991">WARNING 1991</a> messages occur. Common options for helping resolve unstable or problematic 1D nodes and channels are:</p>
<ol style="list-style-type: decimal">
<li>If a 1D node or channel has become unstable, causing a simulation to crash yet the water levels appear stable in the results, check the <a href="#ecfDepthLimitFactor">Depth Limit
Factor</a> setting. It may be that the water
level is simply exceeding the maximum depth of the node/channel
times the <a href="#ecfDepthLimitFactor">Depth Limit Factor</a>.<br />
</li>
<li>If a 1D node has repeated <a href="https://wiki.tuflow.com/TUFLOW_Message_1991">WARNING 1991</a> messages, and/or has a mass
error problem, check that the cross-section/structure dimensions of
adjoining channels are correct and appropriate. Common causes are:
<ol style="list-style-type: decimal">
<li>A large change in cross-sectional area for successive channels.
If the channel is natural, then it is likely that one or more of
the cross-sections are not representative of the real situation.<br />
</li>
<li>One or more incorrect upstream and downstream bed levels. Import
the <a href="https://wiki.tuflow.com/Check_Files_1d_inverts">1d_inverts_check</a> GIS file, label the <em>Invert</em> attribute, and cross-check that the inverts are correct.<br />
</li>
<li>A very steep channel entering a gently sloping channel. If this
is the real situation, then additional 1D channels providing a
higher computational resolution may be needed, alternatively inserting a structure at the transition may help.<br />
</li>
<li>If there is a sudden change in 1D flow area, then a more
appropriate and more stable approach would be to insert a
structure representative of the situation to model the energy
losses associated with the contraction and/or expansion of the water.<br />
</li>
<li>Trial using a smaller <a href="#ecfTimestep">1D Timestep</a> to establish
whether the problem is timestep related. If it is not timestep
related, reducing the timestep should have little change in
results. In some problematic models, 1D instabilities may
actually magnify with a reducing timestep.<br />
</li>
<li>A common solution is to add additional storage to the 1D node. This
can be done by using the 1d_nwk Length_or_ANA attribute described in Table <a href="#tab:tab-NodesAttributeDescriptions">47</a> or using <a href="#ecfMinimumNA">Minimum NA</a>, <a href="#ecfStorageAboveStructureObvert">Storage Above
Structure Obvert</a> or <a href="#ecfMinimumChannelStorageLength">Minimum
Channel Storage Length</a>.
Usually adding additional storage at problematic nodes does not
adversely affect the results (unless there are a lot of
problematic nodes), however, this should be checked through
sensitivity testing (this can be carried out by adding even more
storage again and ascertaining the effect on the hydraulic
results).</li>
</ol></li>
</ol>
<p>Besides investigating where the <a href="http://wiki.tuflow.com/TUFLOW_Message_1991">WARNING
1991</a>
messages occur, the most effective approach to identify potential problem locations is to thematically map or
categorise the _TSMB GIS layer using the ME_Avg_Abs attribute.</p>
<h4 class="hasAnchor" id="ClassicInstability-4"><span class="header-section-number">16.3.2.2</span> TUFLOW Classic<a href="#ClassicInstability-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To identify problematic areas within a TUFLOW Classic 2D domain, the most common
approach is to run the model at a reasonable timestep and investigate
where the <a href="https://wiki.tuflow.com/TUFLOW_Message_2991">WARNING 2991</a> messages occur. If mass error is an issue in the
2D domain, the MB1 and MB2 outputs (see <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a> and Table <a href="#tab:tab-ExcludingHazard">102</a> may be of use.</p>
<p>Of particular note, models based on high quality DTMs are
as-a-rule rarely problematic. However, if the DTM is rough or “bumpy”
(as can be the case with air-borne laser DTMs), or has poor triangulation
causing sharp ridges as illustrated in the images below, models based on
these DTMs are much more likely to be problematic in/near these areas.</p>
<center>
<img src="images/image194.png"
style="width:2.83333in;height:2.98958in" />
<img src="images/image195.jpeg" style="width:3.25in;height:2.98958in"
alt="Untitled" />
</center>
<p>The following steps are useful to help identify and resolve the problem.</p>
<ol style="list-style-type: decimal">
<li>Set the <a href="#tcfTimestep">2D Timestep</a> to somewhere between
<span class="math inline">\(\frac{1}{2}\)</span> to <span class="math inline">\(\frac{1}{5}\)</span> of the cell size (in metres).<br />
</li>
<li>Run the model until it becomes unstable or has generated the <a href="https://wiki.tuflow.com/TUFLOW_Message_2991">WARNING
2991</a> messages.<br />
</li>
<li>Import or open the _messages GIS layer.<br />
</li>
<li>Within your chosen GIS package, view the _messages GIS layer in a
tabular format and try to trace back from the
“<a href="http://wiki.tuflow.com/TUFLOW_Message_2999">UNSTABLE 2999</a>”
messages to the initial “<a href="http://wiki.tuflow.com/TUFLOW_Message_2991">WARNING
2991</a>”
messages that were most likely the trigger for the instability.<br />
</li>
<li>Select a few of these WARNINGs and locate them geographically in the GIS
map window.<br />
</li>
<li>Using the various _check GIS layers, carry out some fundamental
checks. For example:
<ol style="list-style-type: decimal">
<li><a href="https://wiki.tuflow.com/Check_Files_2d_zpt">2d_zpt_check</a> or <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z check file</a>: Check the Zpt values are as you would expect. If the Zpt values are particularly “bumpy”, try
smoothing the ones at/near the <a href="https://wiki.tuflow.com/TUFLOW_Message_2991">WARNING 2991</a> messages. Where the
Zpts change in elevation rapidly (e.g. the outside bend of a river), deep ZU and ZV elevations can be problematic. If
modifying the ZU and ZV values, tend to assign an elevation
closer to the higher of the two ZC values either side of the
ZU/ZV point. To modify the Zpts it is recommended to create a
new 2d_zpt or 2d_zsh layer rather than editing the original data
source for quality control purposes.<br />
</li>
<li><a href="https://wiki.tuflow.com/Check_Files_2d_uvpt">2d_uvpt_check</a> or <a href="https://wiki.tuflow.com/Check_Files_2d_grd">2d_grd_check</a>: check the Manning’s n values are
as expected, if not identify why.</li>
</ol></li>
</ol>
<p>For reference, a detailed description of all available check files is provided in the <a href="https://wiki.tuflow.com/TUFLOW_Check_Files">TUFLOW Wiki</a>.</p>
<p>Other points to note for TUFLOW Classic 2D domains are:</p>
<ul>
<li>If the model becomes unstable quickly and the instability location is
near a 2D water level boundary, check that the initial water level
setting is compatible with the starting water level of the boundary.</li>
<li>Direct rainfall modelling on high elevations(&gt;100m) may experience
unacceptable mass errors due to a floating point imprecision
problem. These models need to use the double precision version of
TUFLOW (see Section <a href="#iSPdSP-3"><strong>??</strong></a>). In addition, the default <a href="#tcfCellWetDryDepth">Cell
Wet/Dry Depth</a> may need to be lowered from 0.002m
to 0.0002m (when using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk>US Customary</tblk> the
equivalent would be lowering from the default of 0.007 to 0.0007ft)
due to the substantial amount of sheet flow.</li>
</ul>
<h4 class="hasAnchor" id="HPCInstability-4"><span class="header-section-number">16.3.2.3</span> TUFLOW HPC<a href="#HPCInstability-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To identify problematic areas within a TUFLOW HPC 2D domain, the most common
approach is to output the ‘dt’ map output (see <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a> and Table <a href="#tab:tab-ExcludingHazard">102</a>), and identify the locations where the lowest timestep (dt) values occur (see Figure <a href="#fig:fig-DTOutput">126</a>). For those locations, check files are reviewed to search for data input issues. Of the check files, possibly the most useful for TUFLOW HPC is the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z check file</a> in the location of the <a href="https://wiki.tuflow.com/HPC_Model_Review#dt_Map_Output">_dt_min</a> to assess the topography representation. If the topography doesn’t look realistic, it’s useful to open the <a href="https://wiki.tuflow.com/Check_Files_2d_zsh_zpt">zsh_zpt_check file</a> to assess if there’s any
topographic modifications made in this location, or whether there is an artefact in the input DTM
datasets that is causing the irregularity. The TUFLOW styles can be applied to the <a href="https://wiki.tuflow.com/Check_Files_2d_zsh_zpt">zsh_zpt_check file</a> check file to show different adjustments, red
upwards arrows for increased elevation values, blue downwards arrows for decreased elevation values.</p>
<p>Other points to note for TUFLOW HPC 2D domains are:</p>
<ul>
<li>Non-perpendicular boundaries can provide instabilities in both TUFLOW Classic and HPC. Whereas in TUFLOW Classic they will likely lead to an unstable model, they are more challenging to pick up with TUFLOW HPC because of its unconditionally stability. One approach to review inflow boundaries in a TUFLOW HPC model is to a add 2d_po line immediately downstream of any boundary inputs. The PO results can then be used for detailed review of the model stability in that particular location.</li>
<li>TUFLOW HPC simulates flow depth as its state variable and therefore it does not suffer the same potential loss of precision as TUFLOW Classic when modelling direct rainfall. Therefore, it is not a requirement to run a double precision version of TUFLOW HPC for direct rainfall applications.</li>
</ul>
<h4 class="hasAnchor" id="onedtwodinstability-4"><span class="header-section-number">16.3.2.4</span> 1D/2D Links<a href="#onedtwodinstability-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Some common configuration mistakes associated with 1D/2D links, and recommendations to resolve them are:</p>
<ol style="list-style-type: decimal">
<li>Using a mixture of connected HX and SX lines along a river bank can
cause mass errors. This is not a recommended configuration. In these
situations the 1D and 2D mass error reporting can appear
satisfactory, however the overall model mass error is poor. HX connections are the recommended configuration to connect the 1D open channel to the 2D representation of the floodplain. The _TSMB1d2d GIS layer is useful for identifying mass error
issues across 2D HX lines. Note, the units of the mass error values
for this layer are presently in m<sup>3</sup>s<sup>-1</sup>, not in percent.<br />
</li>
<li>Unrealistic flow patterns occurring across the HX lines, sometimes
causing strange flow patterns and circulations in the 2D domain.
This behaviour may occur due to one of the following reasons:
<ol style="list-style-type: decimal">
<li>Insufficient spatial resolution in the 1D domain. If the
interval between 1D nodes is too large, then the linearly
interpolated 1D water level profile that is transferred from the
1D domain to the 2D domain along the HX line will not accurately
reflect the real situation. This can create recirculation in the
2D and oscillations in the 1D. Check that there is a
sufficiently fine resolution of 1D nodes along the river to be
representative of the river’s longitudinal water surface slope.
Typically, areas where there are significant changes in
longitudinal water surface gradient will require finer 1D
resolution. Additional 1D nodes may be incorporated quickly and
easily in the model through the use of automatically
interpolated cross-sections (refer to Section <a href="#Interpolate-XS-3"><strong>??</strong></a>).</li>
<li>Conversely, having too fine a spatial 1D resolution may cause
stability problems due to insufficient nodal storage. As a
general rule-of-thumb, the node surface area should be similar to the
width of the 1D/2D interface multiplied by 3 to 10 cell widths.<br />
</li>
<li>At a junction of three or more 1D channels, care should be
exercised in how the levels from the side branches are
transferred to the HX line(s). If the side branch has much
higher water levels than the main branch, and a HX line segment
is connected at one end to the side branch and the other end to
the main branch, a steep water level gradient may be applied
along the HX line segment that is not particularly
representative of the real situation.<br />
</li>
<li>Similarly, at 1D structures where there is a significant drop in
water level (for example, across a weir), the HX line may need
to be stopped upstream and restarted downstream of the structure
to prevent a steep gradient being applied across HX cells over
the structure.<br />
</li>
</ol></li>
<li>Instabilities can occur across HX boundaries that are located in
areas of ponding water due to the frequent transfer of water back
and forth between the 1D and 2D domains. Use the <a href="https://wiki.tuflow.com/Check_Files_1d_to_2d_bc">1D_2D_check layer</a>
to view the ZC elevations of the boundary, ensuring the elevations
are appropriate and the boundaries have been digitised on the top of
banks. In some situations the HX boundaries may need to be relocated
and the schematisation of the model revisited to resolve the issue.<br />
</li>
<li>Bumpy topography in the approach to SX boundaries may lead to
instabilities. Smooth out the Zpt elevations where appropriate,
ensuring there is a 2D flow path leading to / departing from the
boundary.<br />
</li>
<li>An inappropriate number of SX boundary cells in relation to the 1D
structure width may cause stability problems. The number of cells
selected should generally always correlate to the 1D structure
width. For example, a 5m wide culvert should be connected to 2-3 SX
boundary cells when the cell size is 2m wide. If the 1D structure
width is less than or equal to a single cell width, two rather than
one boundary cell may need to be selected to achieve stability.</li>
</ol>
<h4 class="hasAnchor" id="othertroublshooting-4"><span class="header-section-number">16.3.2.5</span> Other General Troubleshooting Recommendations<a href="#othertroublshooting-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Futher general suggestions for common situations that are not uniquely specific to TUFLOW 1D, Classic, HPC or 1D/2D linking are provided below.</p>
<ol style="list-style-type: decimal">
<li>If the Console Window does not appear at all when executing a simulation, check for virtual memory congestion (see Section <a href="#ConsoleDisappear-3"><strong>??</strong></a>).<br />
</li>
<li>If the Console Window disappears for no apparent reason, first check
the following:
<ol style="list-style-type: decimal">
<li>You have sufficient disk space on the drive you are writing your
results to and where the .tcf or .ecf files are located (this is
where the .tlf file is written by default).<br />
</li>
<li>Your computer network is/was not down.</li>
<li>If you are executing TUFLOW from a Windows batch file, review the batch file syntax is correct.</li>
</ol></li>
<li>If TUFLOW indicates that GIS objects are not snapped, not connected,
could not be found or are outside the model domain, check that:
<ol style="list-style-type: decimal">
<li>The most recent GIS updates have been saved or exported for use by
TUFLOW.<br />
</li>
<li>The relevant GIS layers are in the correct projection and that
the objects are snapped to each other. Some GIS programs can
handle layers of different projections, however, TUFLOW requires
that all layers be in the same projection. This projection must
be a Cartesian projection (not degrees latitude/longitude) and
is specified using <a href="#tcfSHPProjection">SHP
Projection</a>, <a href="#tcfGPKGProjection">GPKG Projection</a> and/or <a href="#tcfMIProjection">MI Projection</a> in the .tcf file. The default setting is
that all input layers are of the same projection otherwise an
ERROR occurs (see <a href="#tcfGISProjectionCheck">GIS Projection
Check</a>).<br />
</li>
<li>Different GIS software may use a different precision in the
coordinates, this may result in objects being snapped within the
software but not in TUFLOW. The distance which objects are
considered snapped in TUFLOW can be set with the <a href="#tcfSnapTolerance">Snap
Tolerance</a> command in TUFLOW.<br />
</li>
</ol></li>
<li>If you are experiencing instability water levels. Follow the advice
given in Section <a href="#tuflowinstability-3"><strong>??</strong></a> and
<a href="#onedinstability-4"><strong>??</strong></a>. Otherwise, check the
water level that is used for detecting instabilities (<a href="#tcfInstabilityWaterLevel">Instability
Water Level</a>). If every Z point elevation
has not been allocated, the default elevation of 99999 will be
assigned. Provided the default settings for the .tcf command <a href="#tcfZptRangeCheck">Zpt
Range Check</a> have not been altered, TUFLOW will
report an ERROR message. If there are very high Z points in your
geometry (relative to your water levels), this allows any
instabilities to oscillate in a very large range. Consequently, the
instability can become so extreme that floating point errors (i.e.
the computation is unresolvable) may occur before TUFLOW stops the
simulation and declares it unstable. However, in most cases there
should be some water level exceedance warnings at the end of the
.tlf file and/or negative depth warnings in the _messages GIS layer. To remedy the situation use <a href="#tcfInstabilityWaterLevel">Instability Water
Level</a> to set a realistic maximum water
level. This same effect can occur in 1D domains if the maximum
height in a node storage table or a channel cross-section is very
high or the <a href="#ecfDepthLimitFactor">Depth Limit Factor</a> is set
unrealistically high.<br />
If the problem persists, please contact
<a href="mailto:support@tuflow.com">support@tuflow.com</a>.<br />
</li>
<li>If you are having stability problems, check whether the computational
timestep is appropriate (see Section <a href="#TimestepBackground-2"><strong>??</strong></a>, <a href="#TUFLOWClassicTimestep-4"><strong>??</strong></a> and <a href="#onedinstability-4"><strong>??</strong></a>).<br />
</li>
<li>Discontinuous initial water levels, particularly at 1D/2D interfaces
are a common source of instability. If the model is going unstable
near a 1D/2D interface shortly after starting, check that the
initial water levels in the 1D and 2D domains are similar and also equal to any water level timeseries (HT) boundaries included in the model.<br />
</li>
<li>It is not possible to specify a node as a flow boundary as well as
being connected to a 2D SX boundary (which automatically applies a
HX boundary to the node). This combination of flow boundary and
water level (HX) boundary is incompatible. The result is that the HX
boundary overrides the flow boundaries. An ERROR check for this
occurrence is output.<br />
</li>
<li>Deep river bends with “bumpy” topography may cause instabilities in
2D models. Smoothing the topography, rather than reducing the
timestep is recommended.<br />
</li>
<li>Under-sized 1D node storage (NA tables) connected to 2D HX
boundaries may cause instabilities near the 1D/2D interface.
Over-sized storage attenuates the inflow hydrograph. As a
rule-of-thumb, the node surface area should be similar to the width
of the 1D/2D interface multiplied by 3 to 10 cell widths.<br />
</li>
<li>Irregular topography just inside a 2D boundary may cause
instabilities. If problems occur, smooth the rough topography.</li>
</ol>
<h2 class="hasAnchor" id="QAchecklist-2"><span class="header-section-number">16.4</span> QA Check List and Simulation Logging<a href="#QAchecklist-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A quality assurance check of any model used for a project is recommended, even if initial simulation appears to be trouble free and healthy. Table <a href="#tab:tab-CheckList">130</a> presents a helpful shortlist of general quality control checks. This list is <u>not</u>
exhaustive, a more detailed list is available from <a href="https://downloads.tuflow.com/Training/Modelling_Log_and_Review_Template.zip">Modelling Log and Review Template</a>. Model review responsibility should be assigned to
an experienced modeller, not someone who is not familiar with TUFLOW modelling.</p>
<table>
<caption>
<span id="tab:tab-CheckList">Table 130: </span><strong>Quality Control Check List</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Item
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Checked
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Modelling Log
</td>
<td style="text-align:left;">
A modelling log is highly recommended and should be a requirement on all projects. The log may be in Excel, Word or other suitable software. A review of the modelling log is to be made by an experienced modeller. It should contain:<br />
<span class="math inline">\(\cdot\)</span> the TUFLOW executable version used for the modelling;<br />
<span class="math inline">\(\cdot\)</span> Sufficient information to record model versions during development and calibration;<br />
<span class="math inline">\(\cdot\)</span> Observations from simulations;<br />
<span class="math inline">\(\cdot\)</span> Key modelling assumptions; and<br />
<span class="math inline">\(\cdot\)</span> A list of data sources used.<br />
A model version naming and numbering system needs to be designed prior to the modelling. The version numbering system should be reflected in input data filenames to allow traceability and the ability to reproduce an old simulation if needed.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
File Naming, Structure and Management
</td>
<td style="text-align:left;">
A review of the data file management should check:<br />
<span class="math inline">\(\cdot\)</span> Files are named using a logical and appropriate convention that allows easy interpretation of file purpose and content;<br />
<span class="math inline">\(\cdot\)</span> A logical and appropriate system of folders is used to store the files;<br />
<span class="math inline">\(\cdot\)</span> Relative path names are used for input files (e.g. “..\model\geometry.tgc”) so that models are easily moved from one folder to another.<br />
<span class="math inline">\(\cdot\)</span> Documentation of the above in the project Quality Control Document and/or Modelling Log.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
2D Cell Size and 1D resolution
</td>
<td style="text-align:left;">
Check whether the 2D cell size is appropriate to reproduce the topography needed to satisfactorily meet the objectives of the study (see Section <a href="#ModelResolutionDiscretisation-2"><strong>??</strong></a>), and that the 1D spatial resolution is appropriate to reproduce the water longitudinal surface gradient.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Topography
</td>
<td style="text-align:left;">
The topography review should focus on:<br />
<span class="math inline">\(\cdot\)</span> Correct interrogation of Digital Terrain Model (DTM);<br />
<span class="math inline">\(\cdot\)</span> Correct datum;<br />
<span class="math inline">\(\cdot\)</span> Modifications to the base data (e.g. breaklines) have been checked.<br />
Regarding the latter, can be carried out by reviewing the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z check file</a> (see Table <a href="#tab:tab-CheckFiles">120</a>).
Note: Reviewing the elevations in the .2dm file is not appropriate as only the ZH Zpt is represented in the .2dm file (the ZH elevation is not used in the hydrodynamic calculations).<br />
1D cross-section locations and conveyance should be reviewed. As a general rule, conveyance should steadily increase downstream. Sudden changes in conveyance need to be cross-checked (these are often easily identified by sudden changes in velocities of successive channels). Are hydraulic controls such as levees, roads and embankments represented in the model?
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Bed Resistance Values
</td>
<td style="text-align:left;">
Bed resistance values are to be reviewed by an experienced modeller. The review should focus on checking:<br />
<span class="math inline">\(\cdot\)</span> The <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_M">DEM_M check file</a>;<br />
<span class="math inline">\(\cdot\)</span> The Manning_n attribute values in the <a href="https://wiki.tuflow.com/Check_Files_2d_uvpt">uvpt_check file</a> layer created by <a href="#tcfWriteCheckFiles">Write Check Files</a>;<br />
<span class="math inline">\(\cdot\)</span> The Material attribute values in the <a href="https://wiki.tuflow.com/Check_Files_2d_grd">grd_check file</a> created by <a href="#tcfWriteCheckFiles">Write Check Files</a>; or<br />
The reviewer should be looking for:<br />
<span class="math inline">\(\cdot\)</span> Relative consistency between different land-use (material) types; and<br />
<span class="math inline">\(\cdot\)</span> Values are within accepted calibration values.<br />
GIS thematic mapping is an excellent way to visually and quickly review the variation in bed resistance and other parameter values.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Calibration / Validation
</td>
<td style="text-align:left;">
Check that the model calibration or validation is satisfactory in regard to the study objectives. Identify any limitations or areas of potential uncertainty that should be noted when interpreting the study outcomes.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Mass Conservation
</td>
<td style="text-align:left;">
In addition to the mass balance reporting (see Section <a href="#MB-2"><strong>??</strong></a>), it is good practice to carry out independent mass checks. Standard practice is to place 2d_po flow lines (see Section <a href="#PlotOutput-4"><strong>??</strong></a>) in several locations throughout the model. They are typically aligned roughly perpendicular to the flow direction. The locations should include lines just inside each of the boundaries. Other suitable locations are upstream and downstream of key structures, through structures and areas of particular interest.<br />
The flows are graphed and conservation of mass checked (i.e. the amount of water entering the model equals the amount leaving allowing for any retention of water in the model). Ensure that the flows from any 1D channels crossed by a 2d_po line are also included in the mass check, and that the 2d_po flow lines are digitised so that they cross the 1D channel where there is a change in colour of the linked 2D HX cells as shown in the <a href="https://wiki.tuflow.com/Check_Files_1d_to_2d_bc">1d_to_2d_check files</a> or _TSMB1d2d layers.<br />
In dynamic simulations, an exact match between upstream and downstream will not occur due to retention of water, however, examination of the flow lines should reflect this phenomenon.<br />
For steady-state simulations, demonstration of reaching steady flow conditions is demonstrated when the flow entering the model equals the flow leaving the model.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Hydraulic Structures
</td>
<td style="text-align:left;">
Head losses through a structure need to be validated through:<br />
<span class="math inline">\(\cdot\)</span> Calibration to recorded information (if available).<br />
<span class="math inline">\(\cdot\)</span> Desktop calculations based on theory and/or standard publications (e.g. Hydraulics of Bridge Waterways).<br />
<span class="math inline">\(\cdot\)</span> Cross-checking results using other hydraulic software.<br />
Simple checks can be made by calculating the number of dynamic head losses that occur and checking that this is in accordance with what is expected (see Section <a href="#HydraulicStructures-3"><strong>??</strong></a>).<br />
It is important to note that contraction and expansion losses associated with structures are modelled very differently in 1D and 2D schemes. 1D schemes rely on applying form loss coefficients, as they cannot simulate the horizontal or vertical changes in velocity direction and speed. 2D schemes model these horizontal changes and, therefore, do not require the introduction of form losses to the same extent as that required for 1D schemes. However, 2D schemes do not model losses in the vertical or fine-scale horizontal effects (such as around a bridge pier) and, therefore, may require the introduction of additional form losses. See Syme (2001b) for further details.
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Eddy Viscosity
</td>
<td style="text-align:left;">
Check that the eddy viscosity formulation and coefficient is appropriate (see Section <a href="#SGS-3"><strong>??</strong></a>).
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="ExceedingRAM-2"><span class="header-section-number">16.5</span> Models Exceeding Hardware RAM<a href="#ExceedingRAM-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In some situations TUFLOW modellers may experience an error due to the model simulation requiring more Random-Access Memory (RAM) than is available in the computer. When this situation occurs the following message is reported.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-RAMErrorDomainSizeRAM"></span>
<img src="images/image196.png" alt="**TUFLOW RAM Error**" width="40%" />
<p class="caption">
Figure 130: <strong>TUFLOW RAM Error</strong>
</p>
</div>
</center>
<p>The error may be caused by a number of contributing factors. The following sections discuss the common causes and recommended troubleshooting considerations to help resolve the issue.</p>
<h3 class="hasAnchor" id="ComputerRAM-3"><span class="header-section-number">16.5.1</span> Computer RAM<a href="#ComputerRAM-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If a TUFLOW simulation can not allocate sufficient RAM the first check that should be made is the amount of available RAM on
the computer. What are the computers specifications and what is already
being used by other processes? This can be done in Windows Task Manager.
Third party software used to build TUFLOW models and view their results
(such as GIS or CAD packages) can consume large amounts of RAM, leaving
little remaining for the TUFLOW simulation.</p>
<h3 class="hasAnchor" id="TUFLOWVersion-3"><span class="header-section-number">16.5.2</span> TUFLOW Version<a href="#TUFLOWVersion-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The choice of TUFLOW version can influence the amount of RAM needed to
simulate the model. The double precision (DP) versions of TUFLOW utilise
more RAM (up to twice as much) than the single (SP) precision version,
as all real numbers are 8-byte reals in the DP version, rather than 4-byte reals in SP. Refer to
Section <a href="#iSPdSP-3"><strong>??</strong></a> for further information on the difference between
single and double precision versions of TUFLOW.</p>
<h3 class="hasAnchor" id="QAmodeldesign-3"><span class="header-section-number">16.5.3</span> Model Design<a href="#QAmodeldesign-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Key model design items that influence memory allocation, and should be reviewed if simulation RAM requirements need to be reduced, include:</p>
<ul>
<li>The size of the redundant area around the perimeter of the active model domain;<br />
</li>
<li>The number of 2D cells, hence the domain extent and the cell size; and<br />
</li>
<li>Choice of model features utilised.</li>
</ul>
<p>The term, “redundant area” is defined as the difference between the 2D domain
size and the active model area. As discussed in Section <a href="#CellCodes-3"><strong>??</strong></a>, TUFLOW
automatically strips any redundant rows/columns around the active area
of the model to reduce simulation times, this however does not reduce the
amount of RAM consumed by the model. Refer to Sections <a href="#Domain-3"><strong>??</strong></a> and <a href="#CellCodes-3"><strong>??</strong></a> for further information on defining the 2D domain and the active/inactive areas of a model.</p>
<p>Figure <a href="#fig:fig-DomainSizeRAM">131</a> presents two different versions of an example model. The only difference between both models is the size of the 2D domain. The <a href="https://wiki.tuflow.com/Check_Files_2d_dom">2d_dom check file</a> of the models has been overlaid on top of the active area of the model, represented by a magenta polygon (2d_code GIS layer with CD=1).</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-DomainSizeRAM"></span>
<img src="images/image197.png" alt="**Influence of 2D Domain Size on RAM Allocation**" width="70%" />
<p class="caption">
Figure 131: <strong>Influence of 2D Domain Size on RAM Allocation</strong>
</p>
</div>
</center>
<p>In this example, the green coloured <a href="https://wiki.tuflow.com/Check_Files_2d_dom">2d_dom_check</a> in Figure <a href="#fig:fig-DomainSizeRAM">131</a> has been defined using
the .tgc command <tcmd><a href="#tgcGridSizeXY">Grid Size (X,Y)</a> </tcmd><teq>==</teq><tblk> 1800, 2000</tblk>. Its 2D domain extent is significantly larger than the active area
of the model (the magenta polygon).</p>
<p>In contrast the black coloured <a href="https://wiki.tuflow.com/Check_Files_2d_dom">2d_dom_check</a> area in Figure <a href="#fig:fig-DomainSizeRAM">131</a> shows a much better fit to the active area. This model domain has been defined using
the .tgc command <tcmd><a href="#tgcGridSizeXY">Grid Size (X,Y)</a> </tcmd><teq>==</teq><tblk> 800, 1000</tblk>.</p>
<p>The size of the redundant area can be determined by searching within the
.tlf file for the term “redundant”.</p>
<p>For larger (green) domain in the figure above, the tlf file states the following redundant area information.</p>
<p> <em>Isolating redundant perimeter sections of 2D domain Domain_001…</em><br />
 <em>…Reduced computational grid by 79%. Now extends from [5,7] to [196,169].</em><br />
 <em>…Reduced output grid by 79%. Now extends from [5,7] to [196,169].</em></p>
<p>It indicates TUFLOW has reduced the computation grid by 79%, meaning the
active area is only 21% of the size of the 2D domain! A search for “memory” in the .tlf file shows the required memory allocation for the model:</p>
<p> <em>Memory requested for 2D domain Domain_001 = 101 Mb</em><br />
 <em>Total Memory requested thus far = 104 Mb</em></p>
<p>For smaller (black) domain in the figure above, the tlf file states the following redundant area information.</p>
<p> <em>Isolating redundant perimeter sections of 2D domain Domain_001…</em><br />
 <em>…Reduced computational grid by 8%. Now extends from [5,7] to [196,169].</em><br />
 <em>…Reduced output grid by 8%. Now extends from [5,7] to [196,169].</em></p>
<p>The smaller 2D domain also has a noticeable impact on the memory
required to run the model. In this case, reducing it by a factor of 5, from 104Mb to 27Mb.</p>
<p> <em>Memory requested for 2D domain Domain_001 = 23 Mb</em><br />
 <em>Total Memory requested thus far = 27 Mb</em></p>
<p>The 2D cell size dictates the total number of cells within a given
study area, keeping in mind that halving the cell size quadruples the
number of cells. The number of cells has a direct correlation to the
amount of RAM required to run the model. For each cell, TUFLOW stores a
number of variables including depth/water level and velocity components. The
greater the number of cells, the greater the amount of information
stored and therefore the greater the amount of memory needed to simulate
the model. Simulating a variety of models, each with a different cell size during the initial model development stage, will provide a modeller with an understanding of the impact the cell size has on simulation time, memory allocation and also model results. Refer to Section <a href="#CellSizeResultsConvergence-3"><strong>??</strong></a> for discussion on cell size convergence testing.</p>
<p>A number of optional TUFLOW features may also increase the simulation memory
requirements. Common features include:</p>
<ul>
<li><a href="#tcfModelOutputZones">Model Output
Zones</a> (Section <a href="#OutputZones-3"><strong>??</strong></a>). Adding Extra Output Zones will increase the RAM requirement.</li>
<li>TIF, ASC or FLT
grid raster <a href="#tcfMapOutputFormat">Map Output Format</a> (Section <a href="#Format-3"><strong>??</strong></a>). Consider using these grid raster output types for maximum reporting only. Use the XMDF or CC format for time varying dynamic 2D Map Outputs.</li>
<li>Direct rainfall boundary condition inputs defined using the <a href="#tbcReadGISRF">Read GIS RF</a> format can require significant amounts of RAM. Consider using a <a href="https://wiki.tuflow.com/TUFLOW_Rainfall_Control_File_Examples">Rainfall Control File</a> approach to define the input instead. It requires a far smaller amount of memory.</li>
<li>Excessively fine TUFLOW HPC sub-grid sampling resolution.</li>
</ul>
<h3 class="hasAnchor" id="memoryusage-3"><span class="header-section-number">16.5.4</span> Memory Usage Reporting<a href="#memoryusage-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The TUFLOW log file (.tlf) provides a summary of the model’s memory
usage. The memory usage information can be used to
identify which items of a model require the most RAM. An example is provided below:</p>
<p> <em>1D QX and HX BCs automatically detected</em><br />
 <em>1D Geometry data memory …….. 18 Mb</em><br />
 <em>1D Boundary data memory …….. 0 Mb</em><br />
 <em>1D yQ Curves memory ………… 0 Mb</em><br />
 <em>1D Control structures memory … 0 Mb</em><br />
 <em>1D Mesh data memory ………… 3 Mb</em><br />
 <em>1D Results storage memory …… 24 Mb</em><br />
 <em>1D Temporary data memory ……. 8 Mb</em><br />
 <em>1D Computational arrays memory . 0 Mb</em><br />
 <em>Total 1D domain memory (RAM) requested ………… 54 Mb</em><br />
 <em>Total 1D domain character memory (RAM) requested .. 7 Mb</em><br />
 <em>Domain_001 : Allocating Memory Pointers:</em><br />
 <em>Domain_001 : Grid data memory …………… 47 Mb</em><br />
 <em>Domain_001 : Variable Z and Layered FC memory 0 Mb</em><br />
 <em>Domain_001 : Sub-domain linking memory …… 4 Mb</em><br />
 <em>Domain_001 : Flow constrictions memory …… 16 Mb</em><br />
 <em>Domain_001 : Weirs and viscosity factor memory 14 Mb</em><br />
 <em>Domain_001 : Pressure, wind and waves memory 0 Mb</em><br />
 <em>Domain_001 : General Memory …………….. 14 Mb</em><br />
 <em>Domain_001 : Boundary conditions memory ….. 7 Mb</em><br />
 <em>Domain_001 : Wind &amp; waves boundary memory … 0 Mb</em><br />
 <em>Domain_001 : Work arrays memory …………. 115 Mb</em><br />
 <em>Domain_001 : SMS High Res format memory ….. 0 Mb</em></p>
<h3 class="hasAnchor" id="tempmemoryusage-3"><span class="header-section-number">16.5.5</span> Temporary Memory Usage<a href="#tempmemoryusage-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A number of input steps may require additional memory for processing
during model initialisation. For example, when a large DEM is input
(<a href="#tgcReadGridZpts">Read Grid Zpts</a>), this is read into memory and then
processed. This allows for a very rapid processing of the file, though
may consume significant additional memory. The DEM can be tiled to
reduce memory usage at start-up. Other files that consume additional
memory are <a href="#tgcReadGISZShape">Read GIS Z Shape</a>, as TUFLOW tracks the modified elevation and
the change in elevation for all Zpts.</p>
<p>The <a href="#tcfMaximumVertices">Maximum Vertices</a> and <a href="#tcfMaximumPoints">Maximum
Points</a> commands can be used to increase or decrease
the size of a single GIS object and will change the memory required.</p>
<p>For models utilising TUFLOW HPC Sub-Grid Sampling (SGS) with the <a href="#tcfSGSApproach">SGS Approach</a> Method A or B (default prior to 2023-03), the sub-grid sampling was undertaken during the data pre-processing, though the raw input data not retained. In the 2023-03 TUFLOW release, a new and improved Method C approach (default in 2023-03 and later) was introduced. Method C retains the raw sub-grid sampled elevation information from the pre-processing stage for numerous post-processed result features. Whilst Method C can potentially use more RAM, the approach has considerable benefits in terms of preserving sub-grid elevation data at cells/faces partially affected by terrain data layers and allows TUFLOW to produce high-resolution mapping at the SGS sampling resolution.</p>
<p>Sub-grid sampling is a computationally intensive process, particularly for large models with small SGS sample distances. To speed up model initialisation, TUFLOW has been configured to utilise multiple CPU cores. By default, all CPU threads will be used for final SGS elevation pre-processing unless the number of threads (<strong>-nt[thread count]</strong>) command line argument has been specified. For example, to run on 8 threads the command line argument “-nt8” would be used. There is no check for thread licensing used for pre-processing. All threads are used if the number of threads specified in the command line argument exceeds the number of threads available.</p>
<p>In addition to the parallelisation of the final SGS elevation pre-processing, XF files are now supported for SGS Method C. At the end of the .tgc reading, after all elevation datasets have been processed, an XF file is written if the <a href="#tcfXFFiles">XF Files</a> command is set to on (default). This XF file can then be utilised in subsequent simulations, reducing memory requirements and processing time.</p>
<h3 class="hasAnchor" id="GPURAM-3"><span class="header-section-number">16.5.6</span> TUFLOW HPC GPU Module and RAM requirements<a href="#GPURAM-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When running TUFLOW HPC with the GPU Module, TUFLOW Classic carries
out all the pre- and post-processing of the data (setting up the model
and storing and tracking of all output data). These CPU tasks typically consume significantly more memory than that required to carry out the hydraulic computations on the GPU card. Therefore, although the hydrodynamic calculations are carried out on the GPU card/s, significant amounts of CPU RAM are also required. As a rough guide, the CPU RAM requirement is around 4 to 6 times that of the GPU memory (with grid based output active and set to the defaults).</p>
<h2 class="hasAnchor" id="backwardcompatibility-2"><span class="header-section-number">16.6</span> Past Release Version Backward Compatibility<a href="#backwardcompatibility-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--EFC to PAR: please review this-->
<p>TUFLOW uses a unique software build identifier to
track and manage new versions of the software. This identifier has changed in the TUFLOW 2024 release. The build number is in
the format of year-major-minor-precision-bitOS. Where ‘year’ is the year of the release, ‘major’ is the version of the major release starting at 1 and ‘minor’ is the version of the minor release starting at 1. For example, the first build of the 2024 release is ‘2024.1.1. Previously, the versioning system used year-month-xx-precision-bitOS where ’xx’ was the two letters starting at AA then
AB, AC, etc. (for each new build for that month). For precision, iSP = single precision, iDP = double precision. The build number is
written to the first line in the .tlf log files so it is clear what
version of the software was used for a simulation. For example:</p>
<p> <em>Build: 2024.1.1.iSP.w64</em></p>
<p>Advances in science, subsequently built into new release versions may cause slight result differences from one release version to another. In recognition of this, if a project is completed using a specific version of the software, continued future use of that software version for that particular model is recommended to achieve identical results.</p>
<p>During the life of TUFLOW, every effort has been made to
provide full backward compatibility to past release versions. Chapter <a href="#Features-and-Changes-1"><strong>??</strong></a> lists code changes that may cause a change in model result. If a legacy or old model is being upgraded to the latest TUFLOW release, it is recommended that you familiarise yourself with possible changes to the default settings that may change results, and make the necessary changes as appropriate. In nearly all cases a backward compatibility switch is provided so that new builds can reproduce
past build results (see <a href="#tcfDefaults">Defaults</a>). In rare cases exact byte identical replication of a past build result may not be possible using a new release version because different compiler versions were used to create the respective executables.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Utilities-1"><span class="header-section-number">17</span> Utilities<a href="#Utilities-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h2 class="hasAnchor" id="Util-Introduction-2"><span class="header-section-number">17.1</span> Introduction<a href="#Util-Introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The TUFLOW Utilities are a set of tools that can be used to convert
input data for use in a TUFLOW model, or to process / manipulate the raw
2D result files produced from a model simulation. Many of the utilities
are DOS executables similar to the TUFLOW engine, however some are
macros for use in Excel or Python scripts. GIS based utilities have also
been developed for QGIS, ArcGIS, and MapInfo.</p>
<p>The utilities do not require a TUFLOW licence to utilise.</p>
<h2 class="hasAnchor" id="GIS-Utilities-2"><span class="header-section-number">17.2</span> GIS Based Utilities<a href="#GIS-Utilities-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="QGIS-Plugin-3"><span class="header-section-number">17.2.1</span> QGIS TUFLOW Plugin<a href="#QGIS-Plugin-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you are using QGIS as your model development or result viewing environment, we strongly recommend installing the <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin">TUFLOW QGIS Plugin</a>. It includes numerous tools to increase workflow efficiency and powerful result viewing functionality via its <a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a>. After <a href="https://wiki.tuflow.com/TUFLOW_QGIS_Plugin#Installation_of_Plugin">installing</a>, the tools can be found within the TUFLOW QGIS Plugin Menu or the QGIS TUFLOW Processing Toolbox.</p>
<table>
<caption>
<span id="tab:tab-QGISPlugin">Table 131: </span><strong>QGIS TUFLOW Plugin - Tools</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Category
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Tool
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Example
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Editing Tools
</td>
<td style="text-align:left;">
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Create_Project">Create or Configure TUFLOW Project</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Import_Empty">Import Empty (template GIS file)</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Insert_TUFLOW_Attributes_to_Existing_Layer">Insert TUFLOW Attributes to Existing Layer</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Increment_Layer">Increment Selected Layer</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Reload_Data">Reload Data</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Arch_Bridge_Editor">Arch Bridge Editor</a> - shown in example image.</p>
<a href="https://wiki.tuflow.com/QGIS_TUFLOW_Copy_TUFLOW_Command">Copy TUFLOW Command</a>
</td>
<td style="text-align:left;">
<center>
<p>
<img src="images/ArchBgEditor.png">
</p>
</center>
</td>
</tr>
<tr>
<td style="text-align:left;">
Run Tools
</td>
<td style="text-align:left;">
<p><a href="https://wiki.tuflow.com/TUFLOW_Runner">TUFLOW Runner</a> - shown in example image.</p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Run_TUFLOW">Run TUFLOW simulation</a></p>
<a href="https://wiki.tuflow.com/QGIS_TUFLOW_Run_TUFLOW_Utilities">Running TUFLOW Utilities</a>
</td>
<td style="text-align:left;">
<center>
<p>
<img src="images/Runner.png">
</p>
</center>
</td>
</tr>
<tr>
<td style="text-align:left;">
Visualisation Tools
</td>
<td style="text-align:left;">
<p><a href="https://wiki.tuflow.com/TUFLOW_Viewer">TUFLOW Viewer</a> - shown in example image.</p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Styles">Applying TUFLOW styles</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Import_Check_Files_From_Folder">Import Check Files From Folder</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Load_Layers_From_TCF">Load TUFLOW Layers From TCF</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Filter_and_Sort_TUFLOW_Layers">Filter and Sort TUFLOW Layers</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Apply_GPKG_Layer_Names">Apply GPKG Layer Names</a></p>
<p><a href="https://wiki.tuflow.com/QGIS_TUFLOW_Apply_Label_to_Current_Layer">Apply Label to Current Layer</a></p>
<a href="https://wiki.tuflow.com/QGIS_TUFLOW_Apply_Stability_Styling">Apply Stability Styling</a>
</td>
<td style="text-align:left;">
<center>
<p>
<img src="images/QGIS_TUFLOW_Viewer.png">
</p>
</center>
</td>
</tr>
<tr>
<td style="text-align:left;">
Hydrology Tools
</td>
<td style="text-align:left;">
<p><a href="https://wiki.tuflow.com/QGIS_ARR_to_TUFLOW">ARR to TUFLOW</a> - shown in example image.</p>
<p><a href="https://wiki.tuflow.com/QGIS_ReFH2_to_TUFLOW">ReFH2 to TUFLOW</a></p>
<a href="https://wiki.tuflow.com/QGIS_SCS_to_TUFLOW">SCS to TUFLOW</a>
</td>
<td style="text-align:left;">
<center>
<p>
<img src="images/QGIS_ARR_Tool.png">
</p>
</center>
</td>
</tr>
<tr>
<td style="text-align:left;">
Integrity Tools
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/1D_Integrity_Tool">1D Integrity Tool</a> - shown in example image.
</td>
<td style="text-align:left;">
<center>
<p>
<img src="images/QGIS_Integrity_Tool.png">
</p>
</center>
</td>
</tr>
<tr>
<td style="text-align:left;">
Processing Toolbox
</td>
<td style="text-align:left;">
<p><a href="https://wiki.tuflow.com/Convert_TUFLOW_Model_GIS_Format">Convert TUFLOW Model GIS Format</a></p>
<a href="https://wiki.tuflow.com/Package_Model_in_QGIS">Package Model</a> - shown in example image.
</td>
<td style="text-align:left;">
<center>
<p>
<img src="images/QGIS_Package_Model.png">
</p>
</center>
</td>
</tr>
</tbody>
</table>
<p>This QGIS Plugin is actively developed, with new versions released frequently. Please send any feedback, recommendations or new feature ideas to <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<h3 class="hasAnchor" id="ArcGIS-Toolbar-3"><span class="header-section-number">17.2.2</span> ArcGIS Pro Toolbar<a href="#ArcGIS-Toolbar-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ArcGIS Pro Toolbar, shown in Figure <a href="#fig:fig-ArcGISToolbar">132</a>, helps with streamlining the process of creating and editing a TUFLOW model in ArcGIS Pro. It is available for download on the <a href="https://tuflow.com/downloads/#tuflow">TUFLOW Website</a>. For information on installation and the tools available within the ArcGIS Pro Toolbar, see the <a href="https://wiki.tuflow.com/ArcGIS_TUFLOW_Toolbar">TUFLOW Wiki</a>.</p>
<center>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-ArcGISToolbar"></span>
<img src="images/ArcGIS_Toolbar.png" alt="**ArcGIS Pro TUFLOW Toolbar**"  />
<p class="caption">
Figure 132: <strong>ArcGIS Pro TUFLOW Toolbar</strong>
</p>
</div>
</center>
<p>The ArcGIS Pro Toolbar is actively developed. Please send any feedback, recommendations or new feature ideas to <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<h3 class="hasAnchor" id="ArcMap-Toolbox-3"><span class="header-section-number">17.2.3</span> ArcMap Toolbox<a href="#ArcMap-Toolbox-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ArcMap Toolbox is available for ArcMap version 10.1 and newer. The toolbox helps with streamlining the process of creating and editing a TUFLOW model in ArcMap. For more information on the ArcMap Toolbox, see the <a href="https://wiki.tuflow.com/ArcTUFLOW_Toolbox_and_Toolbar">TUFLOW Wiki</a>.</p>
<p>The ArcMap Toolbox is no longer actively developed.</p>
<h3 class="hasAnchor" id="MiTools-3"><span class="header-section-number">17.2.4</span> MiTools<a href="#MiTools-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>MapInfo and TUFLOW Productivity Utilities (miTools) were developed to improve the efficiency of setting up and reviewing TUFLOW models, as well as improving the day to day ease of using MapInfo Professional. For information on miTools, see the <a href="https://wiki.tuflow.com/MiTools_Tips">TUFLOW Wiki</a>.</p>
<p>MiTools are no longer actively developed.</p>
<h2 class="hasAnchor" id="Console-2"><span class="header-section-number">17.3</span> Console Utilities<a href="#Console-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The TUFLOW Console Utilities are like the TUFLOW engine in that they are command window executables with no user interface. They are available for download from the <a href="https://www.tuflow.com/downloads/#utilities">TUFLOW Website</a>.</p>
<p>The <a href="https://wiki.tuflow.com/TUFLOW_Utilities">TUFLOW Wiki</a> provides a comprehensive list of available options for each utility along with further examples.</p>
<p>Please send any feedback, recommendations or suggestions on the Utilities to <a href="mailto:support@tuflow.com" class="email">support@tuflow.com</a>.</p>
<h3 class="hasAnchor" id="Processing-Utilites-3"><span class="header-section-number">17.3.1</span> Pre and Post Processing<a href="#Processing-Utilites-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following utilities are available to assist in pre and post processing:</p>
<ul>
<li><a href="https://wiki.tuflow.com/ASC_to_ASC">ASC_to_ASC</a></li>
<li><a href="https://wiki.tuflow.com/TIN_to_TIN">TIN_to_TIN</a></li>
<li><a href="https://wiki.tuflow.com/XsGenerator">xsGenerator</a></li>
<li><a href="https://wiki.tuflow.com/TUFLOW_to_GIS">TUFLOW_to_GIS</a></li>
<li><a href="https://wiki.tuflow.com/RES_to_RES">RES_to_RES</a></li>
<li><a href="https://wiki.tuflow.com/Convert_to_TS1">Convert_to_TS1</a></li>
<li><a href="https://wiki.tuflow.com/12da_to_from_GIS">12da_to_from_GIS</a></li>
</ul>
<p>These Utilities can also be downloaded and run directly through the <a href="https://wiki.tuflow.com/QGIS_TUFLOW_Run_TUFLOW_Utilities">TUFLOW QGIS Plugin</a>.</p>
<h3 class="hasAnchor" id="Convert-Utilties-3"><span class="header-section-number">17.3.2</span> Convert to TUFLOW<a href="#Convert-Utilties-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following utilities are available to assist in converting model files from other software to TUFLOW:</p>
<ul>
<li><a href="https://wiki.tuflow.com/HEC-RAS_to_TUFLOW">HECRAS_to_TUFLOW</a></li>
<li><a href="https://wiki.tuflow.com/FLO2D_to_TUFLOW">FLO2D_to_TUFLOW</a></li>
<li><a href="https://wiki.tuflow.com/EPA_SWMM_to_TUFLOW">SWMM_to_TUFLOW</a></li>
<li><a href="https://wiki.tuflow.com/Flood_Modeller_to_TUFLOW">Flood_Modeller_to_TUFLOW</a></li>
<li><a href="https://wiki.tuflow.com/MIKE_Flood_to_TUFLOW">MIKE_Flood_to_TUFLOW</a></li>
</ul>
<p>Refer to the relevant pages to view the details with regards to the conversion approach.</p>
<h3 class="hasAnchor" id="Syntax-Highlighting-3"><span class="header-section-number">17.3.3</span> Textfile Syntax Highlighting<a href="#Syntax-Highlighting-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As described in Section <a href="#TheTUFLOWModellingConcept-2"><strong>??</strong></a>, TUFLOW requires the use of control files to bring together the various GIS and tabular datasets as well as TUFLOW specific commands. To assist in the creation and review of the control files, syntax highlighting tools have been developed and are available for the following text file editors:</p>
<ul>
<li><a href="https://wiki.tuflow.com/NotepadPlusPlus_Highlighting">Notepad++</a></li>
<li><a href="https://wiki.tuflow.com/VS_Code_Tips#Install_TUFLOW_Plugin">VSCode</a></li>
<li><a href="https://wiki.tuflow.com/UltraEdit_Colour_Coding">Ultraedit</a></li>
<li><a href="https://wiki.tuflow.com/TextPad_Tips">Textpad</a></li>
</ul>
<p>An example of the syntax highlighting is shown in Figure <a href="#fig:fig-image8">3</a>.</p>
<h3 class="hasAnchor" id="PyTUFLOW-3"><span class="header-section-number">17.3.4</span> PyTUFLOW<a href="#PyTUFLOW-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>PyTUFLOW is a package of Python tools for extracting TUFLOW time series results. It can be used to automate output tasks such as checking model health, goodness-of-fit for model calibration, viewing on-the-fly model output (used in conjunction with <tcmd><a href="#tcfWritePOOnline">Write PO Online</a></tcmd> <teq>==</teq> <blk>ON</tblk>), and high-volume output plotting from production runs. An example of its use for generating calibration plots can be seen <a href="https://www.tuflow.com/insights/2021_05_using-pytuflow-in-your-tuflow-modelling-workflow/">here</a>.</p>
<p>More information about the PyTUFLOW package can be found on the <a href="https://wiki.tuflow.com/PyTuflow">TUFLOW Wiki</a>.</p>
<p>For worked examples demonstrating the use of PyTUFLOW, please register for the free <a href="https://www.tuflow.com/training/training-catalogue/tt004e-introduction-to-python-for-tuflow-elearning/">Introduction to Python for TUFLOW eLearning Course</a>.</p>
<h3 class="hasAnchor" id="Excel-3"><span class="header-section-number">17.3.5</span> Excel Macros<a href="#Excel-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A set of Excel TUFLOW Tools is available for download <a href="https://www.tuflow.com/Download/Miscellaneous/TUFLOW_Tools_v2.0.zip">here</a>. These tools can help with the set up and review of tabular data for input into TUFLOW as well as the review of tabular outputs. Further description of the tools, including setup instructions, is available on the <a href="https://wiki.tuflow.com/Excel_Tips">TUFLOW Wiki</a>.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="Features-and-Changes-1"><span class="header-section-number">18</span> Changelog<a href="#Features-and-Changes-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter contains the changelog since version 2023-03-AF. Section <a href="#changelog-202411"><strong>??</strong></a> includes a description of the new features (linking to where the new features are described within the manual), enhancements and bug fixes. Section <a href="#default-changes"><strong>??</strong></a> lists any changes to default settings made. Released TUFLOW builds can be found on the <a href="https://tuflow.com/downloads/tuflow-classichpc-archive/">TUFLOW Website Downloads</a> page.</p>
<p>The TUFLOW 2024 release changes the version numbering system. From the 2024 release and onwards, releases are denoted by a year and major release version (for example “2024.1”). Builds for each release are now also denoted by a number starting at 1, therefore the first build for the 2024.1 release is called the 2024.1.1 build. Previously, releases were denoted by a year and month (for example “2023-03”), representing when the release was first issued. Builds for each release were denoted by two letters starting at AA, therefore the first build for the 2023-03 release is called the 2023-03-AA build. Subsequent builds will be denoted AB, AC, ….</p>
<p>New releases are typically linked to the release of major new features and/or improvements in the computational hydraulic engines. Whilst some changes in results can be expected between releases due to computational
engine improvements, the intent is not to have any changes in results between the builds for a release. The default settings are also intended to remain unchanged between builds for a release, but can vary between releases to force users to use the latest advancements. However, users can revert to the default settings and prior computational engine approaches – see the “<tcmd><a href="#tcfDefaults">Defaults</a></tcmd><teq> ==</teq>” commands.</p>
<h2 class="hasAnchor" id="changelog-202411"><span class="header-section-number">18.1</span> 2024.1.1 Changelog<a href="#changelog-202411" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<h3 class="hasAnchor" id="NF"><span class="header-section-number">18.1.1</span> New Features<a href="#NF" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>TUFLOW CATCH see Section ???.</li>
<li>Support for advection in 1D, see Section ???.</li>
</ul>
<h3 class="hasAnchor" id="Enhancement"><span class="header-section-number">18.1.2</span> Enhancements<a href="#Enhancement" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Groundwater: support for soil moisture dependent conductivity, see ???</li>
<li>Groundwater: support for Richards equation, see ???</li>
<li>HQ boundary processing was sped up considerably</li>
<li>SWMM: Additional time-series datasets for tracking flows between SWMM and 2D domains, see <a href="#SWMMOutputs-2"><strong>??</strong></a>.</li>
<li>Sped up writing large data to GeoPackage files. Between changes made in 2023-AF and 2024.1.1, the combined time to write the grid, zpt, and uvpt check tables to a GeoPackage file went from about 43 seconds to about 6 seconds. This is about 7 times faster!</li>
</ul>
<h3 class="hasAnchor" id="BF"><span class="header-section-number">18.1.3</span> Bug Fixes<a href="#BF" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Fixed an issue with reading HEC-DSS files for boundary conditions described in <a href="#HECDSS-3"><strong>??</strong></a>. Quadtree models previously gave an error message and now work as expected.</li>
</ul>
<h2 class="hasAnchor" id="default-changes"><span class="header-section-number">18.2</span> Default Changes<a href="#default-changes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Table <a href="#tab:tab-BackwardCompat1">132</a> outlines the changes made to the default settings from the 2023-03-AF TUFLOW build. Some of these have specific commands to revert behaviour, for others these can be reverted by setting “<tcmd><a href="#tcfDefaults">Defaults</a></tcmd><teq> == </teq><tblk> Pre 2024</tblk>”.</p>
<table>
<caption>
<span id="tab:tab-BackwardCompat1">Table 132: </span><strong>Default Changes from 2023-03-AF Release to 2024.1.1 Release</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description of Change
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Section
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Backward Compatibility Command
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
example
</td>
<td style="text-align:left;">
example
</td>
<td style="text-align:left;">
example
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="changes-pre-2023"><span class="header-section-number">18.3</span> Pre 2023-03 Release<a href="#changes-pre-2023" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For default changes between releases prior to the 2023-03 TUFLOW release, please refer to the relevant <a href="https://tuflow.com/downloads/tuflow-classichpc-archive/">TUFLOW Manual</a> and <a href="https://tuflow.com/downloads/tuflow-classichpc-archive/">Release Notes</a> associated with the build of interest. For example, for documentation of the 2017-09 release, refer to the 2016-03 TUFLOW Manual and 2017-09 Release Notes. The <a href="https://wiki.tuflow.com/TUFLOW_Version_Backward_Compatibility">TUFLOW Version Backward Compatibility</a> page of the Wiki also includes a summary of significant changes associated with pre 2018-03 releases.</p>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="unnumbered hasAnchor" id="appendix-appendix">(APPENDIX) Appendix<a href="#appendix-appendix" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<h1 class="hasAnchor" id="TCFCommands-1"><span class="header-section-number">19</span> TCF Commands<a href="#TCFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The TUFLOW Control File (.tcf) is the main control file used to execute a TUFLOW simulation. It includes reference to the second level control files used to consolidate model commands (for geometry, boundaries, 1D domain, events, etc.). It also lists the simulation parameters that define the solver settings, time controls and simulation outputs. The available TCF commands are listed below and detailed in Table <a href="#tab:tab-TCFCommands">133</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tcfADControlFile">AD Control File</a><br />
<a href="#tcfAdjustHeadatESTRYInterface">Adjust Head at ESTRY Interface</a><br />
<a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell Tolerance</a><br />
<a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value Tolerance</a><br />
<a href="#tcfAutoTerminateStartTime">Auto Terminate Start Time</a><br />
<a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell Tolerance</a><br />
<a href="#tcfBCControlFile">BC Control File</a><br />
<a href="#tcfBCDatabase">BC Database</a><br />
<a href="#tcfBCEventName">BC Event Name</a><br />
<a href="#tcfBCEventSource">BC Event Source</a><br />
<a href="#tcfBCEventText">BC Event Text</a><br />
<a href="#tcfBCWetDryMethod">BC Wet/Dry Method</a><br />
<a href="#tcfBCZeroFlow">BC Zero Flow</a><br />
<a href="#tcfBedResistanceCellSides">Bed Resistance Cell Sides</a><br />
<a href="#tcfBedResistanceDepthInterpolation">Bed Resistance Depth Interpolation</a><br />
<a href="#tcfBedResistanceValues">Bed Resistance Values</a><br />
<a href="#tcfBGFLCDefaultApproach">BG FLC Default Approach</a><br />
<a href="#tcfBlankBGFLCApproach">Blank BG FLC Approach</a><br />
<a href="#tcfBlockageAEP">Blockage AEP</a><br />
<a href="#tcfBlockageARI">Blockage ARI</a><br />
<a href="#tcfBlockageDefault">Blockage Default</a><br />
<a href="#tcfBlockageMatrixFile">Blockage Matrix File</a><br />
<a href="#tcfBlockageMatrix">Blockage Matrix</a><br />
<a href="#tcfBlockageMethod">Blockage Method</a><br />
<a href="#tcfBlockageOverride">Blockage Override</a><br />
<a href="#tcfBlockagePMFAEP">Blockage PMF AEP</a><br />
<a href="#tcfBlockagePMFARI">Blockage PMF ARI</a><br />
<a href="#tcfBlockageReturnPeriod">Blockage Return Period</a><br />
<a href="#tcfBlueKenueStartDate">Blue Kenue Start Date</a><br />
<a href="#tcfBoundaryViscosityFactor">Boundary Viscosity Factor</a><br />
<a href="#tcfBSSCutoffDepth">BSS Cutoff Depth</a><br />
<a href="#tcfCalibrationPointsMIFile">Calibration Points MI File</a><br />
<a href="#tcfCellSideWetDryDepth">Cell Side Wet/Dry Depth</a><br />
<a href="#tcfCellSize">Cell Size</a><br />
<a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a><br />
<a href="#tcfChangeZeroMaterialValuestoOne">Change Zero Material Values to One</a><br />
<a href="#tcfCheckInsideGrid">Check Inside Grid</a><br />
<a href="#tcfCheckMISaveDate">Check MI Save Date</a><br />
<a href="#tcfCheckMISaveExt">Check MI Save Ext</a><br />
<a href="#tcfCommandLineProcessing">Command Line Processing</a><br />
<a href="#tcfControlNumberFactor">Control Number Factor</a><br />
<a href="#tcfCPUThreads">CPU Threads</a><br />
<a href="#tcfCSVHeaderLine">CSV Header Line</a><br />
<a href="#tcfCSVMaximumNumberColumns">CSV Maximum Number Columns</a><br />
<a href="#tcfCSVTime">CSV Time</a><br />
<a href="#tcfDefaults">Defaults</a><br />
<a href="#tcfDefineOutputZone">Define Output Zone</a><br />
<a href="#tcfDemoModel">Demo Model</a><br />
<a href="#tcfDensityofAir">Density of Air</a><br />
<a href="#tcfDensityofWater">Density of Water</a><br />
<a href="#tcfDepthRippleHeightFactorLimit">Depth/Ripple Height Factor Limit</a><br />
<a href="#tcfDisplayWaterLevel">Display Water Level</a><br />
<a href="#tcfDistributeHXFlows">Distribute HX Flows</a><br />
<a href="#tcfEnd1DDomain">End 1D Domain</a><br />
<a href="#tcfEnd2DDomain">End 2D Domain</a><br />
<a href="#tcfEndAfterMaximumStartTime">End After Maximum Start Time</a><br />
<a href="#tcfEndAfterMaximum">End After Maximum</a><br />
<a href="#tcfEndDefine">End Define</a><br />
<a href="#tcfEndMapOutput">End Map Output</a><br />
<a href="#tcfEndTime">End Time</a><br />
<a href="#tcfESTRYControlFile">ESTRY Control File</a><br />
<a href="#tcfEventFile">Event File</a><br />
<a href="#tcfExcelStartDate">Excel Start Date</a><br />
<a href="#tcfExternalStressFile">External Stress File</a><br />
<a href="#tcfFEWSGeodatum">FEWS Geodatum</a><br />
<a href="#tcfFEWSInputfile">FEWS Input File</a><br />
<a href="#tcfFileRetryMaxCount">File Retry Max Count</a><br />
<a href="#tcfFileRetryTimeout">File Retry Timeout</a><br />
<a href="#tcfFirstSweepDirection">First Sweep Direction</a><br />
<a href="#tcfForceFileIODisplay">Force File IO Display</a><br />
<a href="#tcfFreeOverfallFactor">Free Overfall Factor</a><br />
<a href="#tcfFreeOverfall">Free Overfall</a><br />
<a href="#tcfFroudeCheck">Froude Check</a><br />
<a href="#tcfFroudeDepthAdjustment">Froude Depth Adjustment</a><br />
<a href="#tcfGAConvergenceValue">GA Convergence Value</a><br />
<a href="#tcfGAMaximumIternations">GA Maximum Iterations</a><br />
<a href="#tcfGeometryControlFile">Geometry Control File</a><br />
<a href="#tcfGISFormat">GIS Format</a><br />
<a href="#tcfGISGridVectorDirection">GIS Grid Vector Direction</a><br />
<a href="#tcfGISGridVectorSF">GIS Grid Vector SF</a><br />
<a href="#tcfGISGridVectorTTF">GIS Grid Vector TTF</a><br />
<a href="#tcfGISGridVectorType">GIS Grid Vector Type</a><br />
<a href="#tcfGISProjectPathFormat">GIS Project Path Format</a><br />
<a href="#tcfGISProjectionCheck">GIS Projection Check</a><br />
<a href="#tcfGISSupportedObjectIgnored">GIS Supported Object Ignored</a><br />
<a href="#tcfGISUnsupportedObject">GIS Unsupported Object</a><br />
<a href="#tcfGlobalFCChFactor">Global FC Ch Factor</a><br />
<a href="#tcfGlobalRainfallUseMaterialLoss">Global Rainfall Use Material Loss</a><br />
<a href="#tcfGlobalWeirFactor">Global Weir Factor</a><br />
<a href="#tcfGPKGCompressionPredictor">GPKG Compression Predictor</a><br />
<a href="#tcfGPKGCompression">GPKG Compression</a><br />
<a href="#tcfGPKGConversionCheck">GPKG Conversion Check</a><br />
<a href="#tcfGPKGInputsReadOnly">GPKG Inputs Read Only</a><br />
<a href="#tcfGPKGProjection">GPKG Projection</a><br />
<a href="#tcfGPUDeviceIDs">GPU Device IDs</a><br />
<a href="#tcfGPUDPCheck">GPU DP Check</a><br />
<a href="#tcfGPUPeertoPeerAccess">GPU Peer to Peer Access</a><br />
<a href="#tcfGPUSolver">GPU Solver</a><br />
<a href="#tcfGPUTemporalScheme">GPU Temporal Scheme</a><br />
<a href="#tcfGridFormat">Grid Format</a><br />
<a href="#tcfGridOutputCellSize">Grid Output Cell Size</a><br />
<a href="#tcfGridOutputOrigin">Grid Output Origin</a><br />
<a href="#tcfGroundwaterBlendThreshold">Groundwater Blend Threshold</a><br />
<a href="#tcfHardware">Hardware</a><br />
<a href="#tcfHEC-DSSStartDate">HEC-DSS Start Date</a><br />
<a href="#tcfHPCWeirParameters">HPC</a><br />
<a href="#tcfHPC1DSynchronisation">HPC 1D Synchronisation</a><br />
<a href="#tcfHPCBoundaryApproach">HPC Boundary Approach</a><br />
<a href="#tcfHPCDeviceSplit">HPC Device Split</a><br />
<a href="#tcfHPCDPCheck">HPC DP Check</a><br />
<a href="#tcfHPCdtWriteInterval">HPC dt Write Interval</a><br />
<a href="#tcfHPCHQBoundaryApproach">HPC HQ Boundary Approach</a><br />
<a href="#tcfHPCHQBoundaryFilterConstant">HPC HQ Boundary Filter Constant</a><br />
<a href="#tcfHPCInfiltrationDryingApproach">HPC Infiltration Drying Approach</a><br />
<a href="#tcfHPCManningsDepthApproach">HPC Mannings Depth Approach</a><br />
<a href="#tcfHPCRestartGeometry">HPC Restart Geometry</a><br />
<a href="#tcfHPCSXMomentumApproach">HPC SX Momentum Approach</a><br />
<a href="#tcfHPCTemporalScheme">HPC Temporal Scheme</a><br />
<a href="#tcfHPCWeirApproach">HPC Weir Approach</a><br />
<a href="#tcfHQBoundaryApproach">HQ Boundary Approach</a><br />
<a href="#tcfHRGridOutputCellSize">HR Grid Output Cell Size</a><br />
<a href="#tcfHRGridOutputUseFaceElevations">HR Grid Output Use Face Elevations</a><br />
<a href="#tcfHRInterpolationApproach">HR Interpolation Approach</a><br />
<a href="#tcfHRThinZLineOutputAdjustment">HR Thin Z Line Output Adjustment</a><br />
<a href="#tcfHXForceWeirEquation">HX Force Weir Equation</a><br />
<a href="#tcfHXZCCheck">HX ZC Check</a><br />
<a href="#tcfIfEvent">If Event</a><br />
<a href="#tcfIfScenario">If Scenario</a><br />
<a href="#tcfIndex1D2DLinks">Index 1D2D Links</a><br />
<a href="#tcfInputDrive">Input Drive</a><br />
<a href="#tcfInsideRegion">Inside Region</a><br />
<a href="#tcfInstabilityWaterLevel">Instability Water Level</a><br />
<a href="#tcfLatitude">Latitude</a><br />
<a href="#tcfLayeredFLCDefaultApproach">Layered FLC Default Approach</a><br />
<a href="#tcfLineCellSelection">Line Cell Selection</a><br />
<a href="#tcfLink2D2DAdjustVelocityHead">Link 2D2D Adjust Velocity Head</a><br />
<a href="#tcfLink2D2DApproach">Link 2D2D Approach</a><br />
<a href="#tcfLink2D2DDistributeFlow">Link 2D2D Distribute Flow</a><br />
<a href="#tcfLink2D2DGlobalStabilityFactor">Link 2D2D Global Stability Factor</a><br />
<a href="#tcfLogFolder">Log Folder</a><br />
<a href="#tcfMapCutoffDepth">Map Cutoff Depth</a><br />
<a href="#tcfMapCutoffSGS">Map Cutoff SGS</a><br />
<a href="#tcfMapCutoffVector">Map Cutoff Vector</a><br />
<a href="#tcfMapOutputCornerInterpolation">Map Output Corner Interpolation</a><br />
<a href="#tcfMapOutputDataTypes">Map Output Data Types</a><br />
<a href="#tcfMapOutputEntireModel">Map Output Entire Model</a><br />
<a href="#tcfMapOutputFormat">Map Output Format</a><br />
<a href="#tcfMapOutputInterval">Map Output Interval</a><br />
<a href="#tcfMassBalanceCorrector">Mass Balance Corrector</a><br />
<a href="#tcfMassBalanceOutputInterval">Mass Balance Output Interval</a><br />
<a href="#tcfMassBalanceOutput">Mass Balance Output</a><br />
<a href="#tcfMaximum1DChannels">Maximum 1D Channels</a><br />
<a href="#tcfMaxCourantNumber">Maximum Courant Number</a><br />
<a href="#tcfMaximumPoints">Maximum Points</a><br />
<a href="#tcfMaximumVelocityCutoffDepth">Maximum Velocity Cutoff Depth</a><br />
<a href="#tcfMaximumVertices">Maximum Vertices</a><br />
<a href="#tcfMaximumsandMinimumsOnlyforGrids">Maximums and Minimums Only for Grids</a><br />
<a href="#tcfMaximumsandMinimumsTimeSeries">Maximums and Minimums Time Series</a><br />
<a href="#tcfMaximumsandMinimums">Maximums and Minimums</a><br />
<a href="#tcfMaximumsApproach">Maximums Approach</a><br />
<a href="#tcfMaximumsStartTrackTime">Maximums Start Track Time</a><br />
<a href="#tcfMaximumsTrackTime">Maximums Track Time</a><br />
<a href="#tcfMeshparts">Meshparts</a><br />
<a href="#tcfMIProjectionIgnoreBounds">MI Projection Check Ignore Bounds</a><br />
<a href="#tcfMIProjection">MI Projection</a><br />
<a href="#tcfModelEvents">Model Events</a><br />
<a href="#tcfModelOutputZones">Model Output Zones</a><br />
<a href="#tcfModelPlatform">Model Platform</a><br />
<a href="#tcfModelPrecision">Model Precision</a><br />
<a href="#tcfModelScenarios">Model Scenarios</a><br />
<a href="#tcfModelTUFLOWBuild">Model TUFLOW Build</a><br />
<a href="#tcfModelTUFLOWRelease">Model TUFLOW Release</a><br />
<a href="#tcfNegativeDepthApproach">Negative Depth Approach</a><br />
<a href="#tcfNetCDFOutputCompression">NetCDF Output Compression</a><br />
<a href="#tcfNetCDFOutputDirection">NetCDF Output Direction</a><br />
<a href="#tcfNetCDFOutputFormat">NetCDF Output Format</a><br />
<a href="#tcfNetCDFOutputStartDate">NetCDF Output Start Date</a><br />
<a href="#tcfNetCDFOutputTimeUnit">NetCDF Output Time Unit</a><br />
<a href="#tcfNon-NewtonianMixingExponent">Non-Newtonian Mixing Exponent</a><br />
<a href="#tcfNullCellChecks">Null Cell Checks</a><br />
<a href="#tcfNumber2D2DLinkIterations">Number 2D2D Link Iterations</a><br />
<a href="#tcfNumberIterations">Number Iterations</a><br />
<a href="#tcfOutputApproach">Output Approach</a><br />
<a href="#tcfOutputDrive">Output Drive</a><br />
<a href="#tcfOutputFiles">Output Files</a><br />
<a href="#tcfOutputFolder">Output Folder</a><br />
<a href="#tcfPause">Pause</a><br />
<a href="#tcfPitDefaultExtrapolateQCurve">Pit Default Extrapolate Q Curve</a><br />
<a href="#tcfPitNo1DConnection">Pit No 1D Connection</a><br />
<a href="#tcfPlotOutputInvalidType">Plot Output Invalid Type</a><br />
<a href="#tcfPOApproach">PO Approach</a><br />
<a href="#tcfProcessAllGrids">Process All Grids</a><br />
<a href="#tcfQuadtreeBCParallelInertiaApproach">Quadtree BC Parallel Inertia Approach</a><br />
<a href="#tcfQuadtreeControlFile">Quadtree Control File</a><br />
<a href="#tcfRainfallBoundaries">Rainfall Boundaries</a><br />
<a href="#tcfRainfallBoundaryFactor">Rainfall Boundary Factor</a><br />
<a href="#tcfRainfallControlFile">Rainfall Control File</a><br />
<a href="#tcfRainfallControlFile">Rainfall Gauges</a><br />
<a href="#tcfRainfallNullValue">Rainfall Null Value</a><br />
<a href="#tcfRAMOptimisation">RAM Optimisation</a><br />
<a href="#tcfReadFile">Read File</a><br />
<a href="#tcfReadGIS12DNetwork">Read GIS 12D Network</a><br />
<a href="#tcfReadGIS12DNodes">Read GIS 12D Nodes</a><br />
<a href="#tcfReadGIS12DWLLPoints">Read GIS 12D WLL Points</a><br />
<a href="#tcfReadGIS12DWLL">Read GIS 12D WLL</a><br />
<a href="#tcfReadGISAutoTerminate">Read GIS Auto Terminate</a><br />
<a href="#tcfReadGISCyclone">Read GIS Cyclone/Hurricane</a><br />
<a href="#tcfReadGISFC">Read GIS FC</a><br />
<a href="#tcfReadGISGLO">Read GIS GLO</a><br />
<a href="#tcfReadGISISISNetwork">Read GIS ISIS Network</a><br />
<a href="#tcfReadGISISISNodes">Read GIS ISIS Nodes</a><br />
<a href="#tcfReadGISISISWLLPoints">Read GIS ISIS WLL Points</a><br />
<a href="#tcfReadGISISISWLL">Read GIS ISIS WLL</a><br />
<a href="#tcfReadGISIWL">Read GIS IWL</a><br />
<a href="#tcfReadGISLP">Read GIS LP</a><br />
<a href="#tcfReadGISOutputZone">Read GIS Output Zone</a><br />
<a href="#tcfReadGISPO">Read GIS PO</a><br />
<a href="#tcfReadGISReportingLocation">Read GIS Reporting Location</a><br />
<a href="#tcfReadGISX1DNetwork">Read GIS X1D Network</a><br />
<a href="#tcfReadGISX1DNodes">Read GIS X1D Nodes</a><br />
<a href="#tcfReadGISX1DWLLPoints">Read GIS X1D WLL Points</a><br />
<a href="#tcfReadGISX1DWLL">Read GIS X1D WLL</a><br />
<a href="#tcfReadGISXPNetwork">Read GIS XP Network</a><br />
<a href="#tcfReadGISXPNodes">Read GIS XP Nodes</a><br />
<a href="#tcfReadGISXPWLLPoints">Read GIS XP WLL Points</a><br />
<a href="#tcfReadGISXPWLL">Read GIS XP WLL</a><br />
<a href="#tcfReadGridRF">Read Grid RF</a><br />
<a href="#tcfReadHazardFile">Read Hazard File</a><br />
<a href="#tcfReadMaterialsFile">Read Materials File</a><br />
<a href="#tcfReadRestartFile">Read Restart File</a><br />
<a href="#tcfReadGISDIWL">Read RowCol IWL</a><br />
<a href="#tcfReadSoilFile">Read Soils File</a><br />
<a href="#tcfRecalculateChezyInterval">Recalculate Chezy Interval</a><br />
<a href="#tcfRecordGaugeDataEXCLUDE">Record Gauge Data EXCLUDE</a><br />
<a href="#tcfRecordGaugeData">Record Gauge Data</a><br />
<a href="#tcfRestartFileIgnoreFields">Restart File Ignore Fields</a><br />
<a href="#tcfReveal1DNodes">Reveal 1D Nodes</a><br />
<a href="#tcfSAminDepth">SA Minimum Depth</a><br />
<a href="#tcfSAPropDepth">SA Proportion to Depth</a><br />
<a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a><br />
<a href="#tcfSetAutoTerminate">Set Auto Terminate</a><br />
<a href="#tcfSetIWL">Set IWL</a><br />
<a href="#tcfSetRouteCutOffType">Set Route Cut Off Type</a><br />
<a href="#tcfSetRouteCutOffValues">Set Route Cut Off Values</a><br />
<a href="#tcfSetVariable">Set Variable</a><br />
<a href="#tcfSGSApproach">SGS Approach</a><br />
<a href="#tcfSGSBreaklineDetectionDelta">SGS Breakline Detection Delta</a><br />
<a href="#tcfSGSDepthOutput">SGS Depth Output</a><br />
<a href="#tcfSGSInfiltrationApproach">SGS Infiltration Approach</a><br />
<a href="#tcfSGSMapExtent">SGS Map Extent <span class="math inline">\(\langle\)</span> Full or Trim <span class="math inline">\(\rangle\)</span></a><br />
<a href="#tcfSGSMaterials">SGS Materials</a><br />
<a href="#tcfSGSMaxSampleFrequency">SGS Max Sample Frequency</a><br />
<a href="#tcfSGSNegativeRainfallApproach">SGS Negative Rainfall Approach</a><br />
<a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a><br />
<a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a><br />
<a href="#tcfSGSSXZFlagApproach">SGS SX Z Flag Approach</a><br />
<a href="#tcfSGSTINMemoryAllocationFactor">SGS TIN Memory Allocation Factor</a><br />
<a href="#tcfSGSVelocityBasedOutputs">SGS Velocity Based Outputs</a><br />
<a href="#tcfSGSZShapeLineApproach">SGS Z Shape Line Approach</a><br />
<a href="#tcfSGSZHSampleRatio">SGS ZH Sample Ratio</a><br />
<a href="#tcfSGSZptMAX/MINApproach">SGS Zpt MAX/MIN Approach</a><br />
<a href="#tcfSGS">SGS</a><br />
<a href="#tcfShallowDepthStabilityFactor">Shallow Depth Stability Factor</a><br />
<a href="#tcfSHPProjectionCheckMethod">SHP Projection Check Method</a><br />
<a href="#tcfSHPProjection">SHP Projection</a><br />
<a href="#tcfSimulationPauseInterval">Simulation Pause Interval</a><br />
<a href="#tcfSimulationPauseStart">Simulation Pause Start</a><br />
<a href="#tcfSimulationsLogFolder">Simulations Log Folder</a><br />
<a href="#tcfSnapTolerance">Snap Tolerance</a><br />
<a href="#tcfSoilInitialLoss">Soil Initial Loss</a><br />
<a href="#tcfSoilNegativeRainfallApproach">Soil Negative Rainfall Approach</a><br />
<a href="#tcfSoilNegativeRainfallFactor">Soil Negative Rainfall Factor</a><br />
<a href="#tcfSolutionScheme">Solution Scheme</a><br />
<a href="#tcfSpatialDatabaseOutput">Spatial Database Output</a><br />
<a href="#tcfSpatialDatabase">Spatial Database</a><br />
<a href="#tcfSQLiteOnOpenSQL">SQLite On Open SQL</a><br />
<a href="#tcfStart1DDomain">Start 1D Domain</a><br />
<a href="#tcfStart2DDomain">Start 2D Domain</a><br />
<a href="#tcfStartMapOutput">Start Map Output</a><br />
<a href="#tcfStartTimeSeriesOutput">Start Time Series Output</a><br />
<a href="#tcfStartTime">Start Time</a><br />
<a href="#tcfSupercritical">Supercritical</a><br />
<a href="#tcfSWMMControlFile">SWMM Control File</a><br />
<a href="#tcfSXFlowDist">SX Flow Distribution Cutoff Depth</a><br />
<a href="#tcfSXFMPUnitTypeError">SX FMP Unit Type Error</a><br />
<a href="#tcfSXHeadAdjustment">SX Head Adjustment</a><br />
<a href="#tcfSXHeadDistributionCutoffDepth">SX Head Distribution Cutoff Depth</a><br />
<a href="#tcfSXStorageApproach">SX Storage Approach</a><br />
<a href="#tcfSXStorageFactor">SX Storage Factor</a><br />
<a href="#tcfSXZCCheck">SX ZC Check</a><br />
<a href="#tcfTIFCompressionPredictor">TIF Compression Predictor</a><br />
<a href="#tcfTIFCompression">TIF Compression</a><br />
<a href="#tcfTIFProjection">TIF Projection</a><br />
<a href="#tcfTimeOutputCornerInterpolation">Time Output Corner Interpolation</a><br />
<a href="#tcfTimeOutputCutoff">Time Output Cutoff</a><br />
<a href="#tcfTimeSeriesNullValue">Time Series Null Value</a><br />
<a href="#tcfTimeSeriesOutputFormat">Time Series Output Format</a><br />
<a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a><br />
<a href="#tcfTimestepInitial">Timestep Initial</a><br />
<a href="#tcfTimestepMaxInc">Timestep Maximum Increase (%)</a><br />
<a href="#tcfTimestepMaximum">Timestep Maximum</a><br />
<a href="#tcfTimestepMinimum">Timestep Minimum</a><br />
<a href="#tcfTimestepMinimum">Timestep Repeats</a><br />
<a href="#tcfTimestep">Timestep</a><br />
<a href="#tcfTSFUpdateInterval">TSF Update Interval</a><br />
<a href="#tcfTutorialModel">Tutorial Model</a><br />
<a href="#tcfUKHazardDebrisFactor">UK Hazard Debris Factor</a><br />
<a href="#tcfUKHazardFormula">UK Hazard Formula</a><br />
<a href="#tcfUKHazardLandUse">UK Hazard Land Use</a><br />
<a href="#tcfUnits">Units</a><br />
<a href="#tcfUnusedHXandSXConnections">Unused HX and SX Connections</a><br />
<a href="#tcfUseForwardSlash">Use Forward Slash</a><br />
<a href="#tcfVerbose">Verbose</a><br />
<a href="#tcfVGZAdjustment">VG Z Adjustment</a><br />
<a href="#tcfViscosityApproach">Viscosity Approach</a><br />
<a href="#tcfViscosityCoefficient">Viscosity Coefficient</a><br />
<a href="#tcfViscosityFormulation">Viscosity Formulation</a><br />
<a href="#tcfWaterLevelChecks">Water Level Checks</a><br />
<a href="#tcfWettingandDrying">Wetting and Drying</a><br />
<a href="#tcfWIBUFIRMCodeSearchOrder">WIBU FIRM Code Search Order</a><br />
<a href="#tcfWindWaveShallowDepths">Wind/Wave Shallow Depths</a><br />
<a href="#tcfWriteCheckFiles">Write Check Files</a><br />
<a href="#tcfWriteEmptyGISFiles">Write Empty GIS Files</a><br />
<a href="#tcfWritePOOnline">Write PO Online</a><br />
<a href="#tcfWriteRestartFileatTime">Write Restart File at Time</a><br />
<a href="#tcfWriteRestartFileInterval">Write Restart File Interval</a><br />
<a href="#tcfWriteRestartFileVersion">Write Restart File Version</a><br />
<a href="#tcfWriteRestartFilename">Write Restart Filename</a><br />
<a href="#tcfWriteX1DCheckFiles">Write X1D Check Files</a><br />
<a href="#tcfXFFilesBoundaries">XF Files Boundaries</a><br />
<a href="#tcfXFFilesIncludeinFilename">XF Files Include in Filename</a><br />
<a href="#tcfXFFilesMergeTINElevations">XF Files Merge TIN Elevations</a><br />
<a href="#tcfXFFiles">XF Files</a><br />
<a href="#tcfXMDFOutputCompression">XMDF Output Compression</a><br />
<a href="#tcfZeroNegativeDepths">Zero Negative Depths</a><br />
<a href="#tcfZeroRainfallCheck">Zero Rainfall Check</a><br />
<a href="#tcfZPHazardCutoffDepth">ZP Hazard Cutoff Depth</a><br />
<a href="#tcfZptRangeCheck">Zpt Range Check</a></p>
</div>
<p><br></p>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<table>
<caption>
<span id="tab:tab-TCFCommands">Table 133: </span><strong>TUFLOW Classic/HPC TCF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfADControlFile"><tcmd>AD Control File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .adcf_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Triggers TUFLOW to execute an AD simulation (see Chapter <a href="#AD-1"><strong>??</strong></a>) and specifies the TUFLOW AD control file name. A TUFLOW AD Module licence is required (see Section <a href="#ADModule-4"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfAdjustHeadatESTRYInterface"><tcmd>Adjust Head at ESTRY Interface </tcmd><teq>==<br></teq></a> <tblk>[ ON | ON Variable | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>This command’s main use is to provide backward compatibility for older models using the previous default of “ON” (pre Build 2006-03-AB) . If set to “ON”, TUFLOW lowers the 1D water level sent to the 2D cells along HX lines by an average of the dynamic head based on the 2D velocities, unless the S Flag is specified for a HX line (see Table <a href="#tab:tab-ConditionsAttribute">78</a>). This can be useful where the 1D water level is more representative of a static water level (1D schemes roughly approximate the variation in water level across a flow path due to the dynamic head). Based on numerous and wide ranging application of HX lines, it is recommended that this command use the default “OFF” setting.</p>
<p>The “ON VARIABLE” option, adjusts the water level on a cell-by-cell basis and is presently not recommended other than for research reasons.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfAutoTerminatedVCellTolerance"><tcmd>Auto Terminate dV Cell Tolerance </tcmd><teq>==<br></teq></a> <tblk>[ {0%} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to set the % of cells tolerance for automated result monitoring to
stop a simulation after the flood peak. This command is used with the stop simulation commands <a href="#tcfSetAutoTerminate">Set Auto
Terminate</a> and <a href="#tcfReadGISAutoTerminate">Read GIS Auto
Terminate</a>.</p>
<p>If set to a value of 1, then up to 1% of monitored cells can be within
the tolerance value without triggering an auto terminate. The larger the
<a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value Tolerance</a>
the further the dV product needs to have dropped from the peak value.</p>
<p>This command is used with the optional commands <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value
Tolerance</a>, <a href="#tcfAutoTerminateStartTime">Auto Terminate Start
Time</a> and <a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell
Tolerance</a>.</p>
<p>Note, the Auto Terminate feature is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
Refer to Section <a href="#AutoTerminateOptions-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfAutoTerminatedVValueTolerance"><tcmd>Auto Terminate dV Value Tolerance </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to set the velocity-depth tolerance for automated result monitoring
to stop a simulation after the flood peak. This command is used with the
mandatory stop simulation commands <a href="#tcfSetAutoTerminate">Set Auto
Terminate</a> and <a href="#tcfReadGISAutoTerminate">Read GIS Auto
Terminate</a>.</p>
<p>For the velocity-depth tolerance, at each output interval the velocity
depth product is compared to the tracked maximum value. If the current
dV product is within the specified tolerance using <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV
Value Tolerance</a>, the cell is within
the range and the simulation is not auto terminated. The total number of
cells that are allowable within the specified range is controlled with
.tcf command <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell
Tolerance</a>.</p>
<p>This command is used with the optional commands <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell
Tolerance</a>, <a href="#tcfAutoTerminateStartTime">Auto Terminate Start
Time</a> and <a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell
Tolerance</a>.</p>
<p>Note, the Auto Terminate feature is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
Refer to Section <a href="#AutoTerminateOptions-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfAutoTerminateStartTime"><tcmd>Auto Terminate Start Time </tcmd><teq>==<br></teq></a> <tblk>[ {Simulation Start Time} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to set the start time when terminate feature commences, after which
result monitoring to stop a simulation after the flood peak is done.
This command is used with the mandatory stop simulation commands <a href="#tcfSetAutoTerminate">Set
Auto Terminate</a> and <a href="#tcfReadGISAutoTerminate">Read GIS Auto
Terminate</a>.</p>
<p>This command is used with the optional commands <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell
Tolerance</a>, <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value
Tolerance</a> and <a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet
Cell Tolerance</a>.</p>
<p>Note, the Auto Terminate feature is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
Refer to Section <a href="#AutoTerminateOptions-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfAutoTerminateWetCellTolerance"><tcmd>Auto Terminate Wet Cell Tolerance </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to set the percentage of cells that have become wet since the <a href="#tcfMapOutputInterval">Map
Output Interval</a> for automated result monitoring
to stop a simulation after the flood peak. This command is used with the
mandatory stop simulation commands <a href="#tcfSetAutoTerminate">Set Auto
Terminate</a> and <a href="#tcfReadGISAutoTerminate">Read GIS Auto
Terminate</a>.</p>
<p>If set to 0, then if any monitored cells have become wet since the last
map output the simulation continues. If set, for example, to a value of
5, then up to 5% of monitored cells can become wet since the last map
output without triggering an auto terminate.</p>
<p>This command is used with the optional commands <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell
Tolerance</a>, <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value
Tolerance</a>, <a href="#tcfAutoTerminateStartTime">Auto Terminate Start
Time</a> and <a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell
Tolerance</a>.</p>
<p>Note, the Auto Terminate feature is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
Refer to Section <a href="#AutoTerminateOptions-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCControlFile"><tcmd>BC Control File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .tbc <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the TUFLOW Boundary Control (.tbc) file (see Section <a href="#TBC-3"><strong>??</strong></a>). The available commands that can be read into a .tbc are listed in Appendix <a href="#TBCCommands-1"><strong>??</strong></a>).</p>
There can only be one .tbc file per 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCDatabase"><tcmd>BC Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .csv <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active BC Database file, as described in Section <a href="#bcdbase-2"><strong>??</strong></a>. The file is usually created using spreadsheet software such as Microsoft Excel.</p>
<p>If the BC Database is specified in the TUFLOW .tcf file, it is set as the active database for both 2D and 1D models. However, the active database can be changed at any stage in the .tbc and .ecf files by repeating the command with the new database set as the <span class="math inline">\(\langle\)</span> .csv <span class="math inline">\(\rangle\)</span>.</p>
<strong>A BC Database must be specified before any of the other BC commands are used.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCEventName"><tcmd>BC Event Name </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> bc_event_name <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tefBCEventSource">BC Event Source</a> instead. Expand to find out more about the legacy settings.
</summary>
<p>Sets the active BC name to be substituted wherever <a href="#tcfBCEventText">BC Event Text</a> values occurs in the BC Database. See Section <a href="#BCEventName-3"><strong>??</strong></a> for a description of how the BC event commands operate and
refer to the command <a href="#tcfBCEventSource">BC Event Source</a>.</p>
<p>If specified in the .tcf file, &lt;bc_event_name&gt; also applies to any 1D models.</p>
<p>The &lt;bc_event_name&gt; value can be changed at any stage by repeating
this command in the .tbc and .ecf files. For example, it may be set to
“Q100” to read in the 100 year catchment inflows, then set as “H010” to
read in the 10 year ocean levels for the downstream boundary. Note that,
in this case, the locations of the catchment inflows and downstream
boundaries would have to be placed in two separate GIS layers.</p>
</bc_event_name></bc_event_name>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCEventSource"><tcmd>BC Event Source </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>bc_event_text<span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span>bc_event_name<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Typically used within <a href="#tefDefineEvent">Define Event</a> blocks in a .tef
file (TUFLOW Event File) – see Section <a href="#Events-3"><strong>??</strong></a>, but can be used
one or more times in a .tcf file.</p>
<p><a href="https://wiki.tuflow.com/TUFLOW_Message_2313">ERROR 2313</a> occurs if &lt;bc_event_text&gt; is not unique for a
simulation.</p>
Combines <a href="#tcfBCEventName">BC Event Name</a> and <a href="#tcfBCEventText">BC Event
Text</a> into one command, and can occur up to 100 times
to allow multiple events within the one simulation. Cannot be used in
conjunction with <a href="#tcfBCEventText">BC Event Text</a>. </bc_event_text>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCEventText"><tcmd>BC Event Text </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>bc_event_text<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tefBCEventSource">BC Event Source</a> instead. Expand to find out more about the legacy settings.
</summary>
<p>Sets the text in the BC Database that is to be substituted by the <a href="#tcfBCEventName">BC
Event Name</a> value. See Section <a href="#BCEventName-3"><strong>??</strong></a> for a
description of how the BC event commands operate.</p>
<p>If specified in the .tcf file, &lt;bc_event_text&gt; also applies to any 1D
models. The &lt;bc_event_text&gt; value can be changed at any stage by
repeating this command in the .tbc and .ecf files, although it is
strongly recommended that the &lt;bc_event_text&gt; value is standardised
across all models and the command is specified only once.</p>
</bc_event_text></bc_event_text></bc_event_text>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCWetDryMethod"><tcmd>BC Wet/Dry Method </tcmd><teq>==<br></teq></a> <tblk>[ PRE 2005-11-AF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Water levels at HX cells are set to be not less than the ZC plus <a href="#tcfCellWetDryDepth">Cell
Wet/Dry Depth</a> value for when the 1D water level
falls below the HX cell. This enhances stability in some situations. For
backward compatibility use the PRE 2005-11-AF option.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBCZeroFlow"><tcmd>BC Zero Flow </tcmd><teq>==<br></teq></a> <tblk>[ {OFF} | START | END | START and END |   ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to START, END or START and END, zeros the start and/or end of 1D
and 2D flow hydrographs (QT, ST, SA) as the option implies. The
hydrograph is modified by adding another row at the start/end of the
hydrograph with a flow value of zero.</p>
<p>The benefit is that should a simulation start before or finish after the
start/end of a hydrograph, the flow from this hydrograph into the model
will be zero. (TUFLOW, by default, extends the first value of all
boundary conditions backwards in time indefinitely, and the last value
forwards in time indefinitely.)</p>
Only applies to hydrographs sourced via the <a href="#tcfBCDatabase">BC
Database</a> file. See Section <a href="#bcdbase-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBedResistanceCellSides"><tcmd>Bed Resistance Cell Sides </tcmd><teq>==<br></teq></a> <tblk>[ AVERAGE M | AVERAGE n | MAXIMUM n | {INTERROGATE} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Defines how the bed resistance value at a 2D cell’s mid-side (i.e. that used in the momentum equation) is calculated.</p>
<p>INTERROGATE (the default) applies the exact value from the material polygons using <a href="#tgcReadGIS">Read GIS Mat</a>. The INTERROGATE option provides a higher resolution sampling of material values compared with
just sampling at the cell centres. This higher resolution sampling is particularly useful in modelling urban areas where frequent and large changes in Manning’s n occurs.</p>
<p>Note the <a href="#tgcReadRowCol">Read RowCol Mat</a> command is incompatible with the INTERROGATE option. If using <a href="#tgcReadRowCol">Read RowCol Mat</a>, use AVERAGE M or AVERAGE n.</p>
<p>The AVERAGE M option (TUFLOW Classic only) takes the average Manning’s M (1/Manning’s n) value of the two adjoining cell centre values.</p>
<p>The AVERAGE n option (TUFLOW Classic only) takes the average Manning’s n values of the cell centres.</p>
<p>The MAXIMUM n option (TUFLOW Classic only) takes the maximum n values of the cell centres either side of the cell side.</p>
<p>See Section <a href="#Bed-Resistance-4"><strong>??</strong></a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBedResistanceDepthInterpolation"><tcmd>Bed Resistance Depth Interpolation </tcmd><teq>==<br></teq></a> <tblk>[ LINEAR M  | {SPLINE n}  | LINEAR n ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Controls how the Manning’s n value is interpolated between the two
depths if using the varying Manning’s n with depth (see <a href="#tcfReadMaterialsFile">Read Materials
File</a>). The default value is SPLINE n which uses
a curved fit so that the n values transition gradually. LINEAR M and
LINEAR n both use a linear interpolation of the M (1/n) and n value
respectively.</p>
<p>The depth taken to interpolate Manning’s n values that vary with depth
is taken as the minimum of the depths at the cell mid-side and the
neighbouring cell centres.</p>
See Section <a href="#Materials-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBedResistanceValues"><tcmd>Bed Resistance Values </tcmd><teq>==<br></teq></a> <tblk>[ {MANNING N}  |  MANNING M  |  CHEZY ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the bed resistance formula to use. The default value is MANNING N. See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBGFLCDefaultApproach"><tcmd>BG FLC Default Approach </tcmd><teq>==<br></teq></a> <tblk>[ {LINEAR}  | LINEAR-CONSTANT |  PARABOLIC | INVERTED-PARABOLIC ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the approach used to calculate the FLC at different depths for the 2d_bg shape (see Section <a href="#bg-layer-4"><strong>??</strong></a>). The default option is LINEAR</p>
It is possible to individually specify the method to be used for each 2d_ bg structure using the ‘Option’ attribute (refer to Table <a href="#tab:tab-BridgeShapeAttributeDescriptions">65</a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlankBGFLCApproach"><tcmd>Blank BG FLC Approach </tcmd><teq>==<br></teq></a> <tblk>[ {NONE}  | METHOD A | METHOD B ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the approach to automatically generate the superstructure FLC value if the SuperS_FLC attribute is not defined. The default option is NONE (i.e. superstructure FLC must be specified manually). Refer to Section <a href="#bg-autoFLC-4"><strong>??</strong></a> and Table <a href="#tab:tab-BridgeShapeAttributeDescriptions">65</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageAEP"><tcmd>Blockage AEP </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> aep value in % <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the AEP (annual exceedance probability) for the current event, this
would typically be defined within an event file (.tef), but can also be
specified in the .tcf.</p>
See Section <a href="#Blockage-4"><strong>??</strong></a> for details of the blockage matrix approach.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageARI"><tcmd>Blockage ARI </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> ari value in years <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the ARI (average recurrence interval) for the current event, this
would typically be defined within an event file (.tef), but can also be
specified in the .tcf.</p>
See Section <a href="#Blockage-4"><strong>??</strong></a> for details of the blockage matrix approach.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageDefault"><tcmd>Blockage Default </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Default Blockage Category <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the blockage category to be used if one is not defined in the
1d_nwk pBlockage attribute. The pBlockage field must be left blank for
this to be used, if a numeric value is specified it is used instead. See Section <a href="#Blockage-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageMatrix"><tcmd>Blockage Matrix </tcmd><teq>==<br></teq></a> <tblk>[ {OFF}  | ON ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Turns on or off the Blockage Matrix of culverts, as described in Section <a href="#Blockage-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageMatrixFile"><tcmd>Blockage Matrix File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> link to blockage .csv file <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the blockage matrix file, as described in Section <a href="#Blockage-4"><strong>??</strong></a>. There can only be a single blockage matrix file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageMethod"><tcmd>Blockage Method </tcmd><teq>==<br></teq></a> <tblk>[ ELM  |  RAM  |  {} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the blockage matrix method to either ELM (energy loss method) or
RAM (reduced area method). If blockage matrix is enabled this command
must be specified.<a href="https://wiki.tuflow.com/TUFLOW_Message_1622">ERROR 1622</a> is returned if Blockage Matrix is on,
though no blockage method is specified.</p>
See Section <a href="#Blockage-4"><strong>??</strong></a> for blockage matrix details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageOverride"><tcmd>Blockage Override </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Blockage Category <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets <strong><u>all</u></strong> culverts to use the specified blockage category.
This overwrites the pBlockage attribute in the 1d_nwk layer. Useful for
sensitivity testing. See Section <a href="#Blockage-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockagePMFAEP"><tcmd>Blockage PMF AEP </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> aep value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the AEP for the PMF. Only required if PMF is defined in the AEP
column of the blockage matrix file. See Section <a href="#Blockage-4"><strong>??</strong></a> for blockage matrix details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockagePMFARI"><tcmd>Blockage PMF ARI </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> ari value in years <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the ARI for the PMF. Only required if PMF is defined in the ARI
column of the blockage matrix file. See Section <a href="#Blockage-4"><strong>??</strong></a> for blockage matrix details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlockageReturnPeriod"><tcmd>Blockage Return Period </tcmd><teq>==<br></teq></a> <tblk>[ AEP  |  ARI ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to set Blockage Matrix return period naming convention to ARI or
AEP. See Section <a href="#Blockage-4"><strong>??</strong></a>.</p>
<p>If this command above is not set, the first occurrence of either
<a href="#tcfBlockageARI">Blockage ARI</a> or <a href="#tcfBlockageAEP">Blockage AEP</a> sets
the return period naming convention.</p>
<p>The return period values in the first column of the matrix file
specified with the .tcf command <a href="#tcfBlockageMatrixFile">Blockage Matrix
File</a> must be in the same convention. For
example, if specifying “<tcmd>Blockage Return Period</tcmd><teq> ==</teq><tblk> AEP</tblk>”, values in the
matrix file must also be specified in AEP.</p>
See Section <a href="#Blockage-4"><strong>??</strong></a> for blockage matrix details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBlueKenueStartDate"><tcmd>Blue Kenue Start Date </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> date in isodate format <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This date is added to the Blue Kenue output files as per the Blue Kenue file format. The date should be specified in ISO 8601 (isodate) format (yyyy-mm-dd). For example, to specify the 5<sup>th</sup> of November 2023 the .tcf command would be: <tcmd>Blue Kenue Start Date </tcmd><teq>==</teq><tblk> 2023-11-05</tblk>. For more information on the Blue Kenue format, see the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf#page=400">2018 TUFLOW Manual</a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBoundaryViscosityFactor"><tcmd>Boundary Viscosity Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.0}  |  <span class="math inline">\(\langle\)</span> factor <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Multiplies the eddy viscosity coefficient by &lt;factor&gt; along all open
(external) boundaries, and 2D and HX links.</p>
For releases prior to 2016-03 the eddy viscosity coefficient was
previously set to zero for the boundary cells (this was because land
boundaries required this and open boundaries were treated in the same
manner). For the 2013-12 release for <tcmd><a href="#tcfLink2D2DApproach">Link 2D2D
Approach</a> </tcmd><teq>==</teq><tblk> METHOD D </tblk>the default is set to 1.0 to
improve the performance in flow patterns along the 2D link lines.
Changing this value in the range of 0.0 to 5.0 (possibly higher) usually
has little effect on results, however, increasing the factor may help
“stabilise” unrealistic circulations along a boundary or 2D / HX link
line without adversely affecting results. Sensitivity test prior to
adopting larger factors. </factor>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfBSSCutoffDepth"><tcmd>BSS Cutoff Depth </tcmd><teq>==<br></teq></a> <tblk>[ {0.1}  |  <span class="math inline">\(\langle\)</span> BSS_cutoff_depth <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Defines the depth threshold (m) below which the Bed Shear Stress (BSS)
and Stream Power (SP) <a href="#tcfMapOutputDataTypes">Map Output Data Types</a>
will linearly reduce to zero. See Table <a href="#tab:tab-ExcludingHazard">102</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCalibrationPointsMIFile"><tcmd>Calibration Points MI File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mif_layer <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Assigns the peak water level calculated during the simulation as an
extra attribute to the .mif/.mid layer. Useful for obtaining peak flood
levels at calibration points and other locations as direct output from
TUFLOW. Up to a maximum of ten (10) files can be specified.</p>
The GIS layer at present must be in the .mif/.mid format and is opened
and closed during the start-up phase so the existence of the layer is
checked (rather than at the end of the simulation as this causes issues
if the layer does not exist or has a save date later than the .tab
file), and also so that the layers are copied if using the -c or -ca
switches (refer to Table <a href="#tab:tab-TUFLOWOptions">116</a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCellSideWetDryDepth"><tcmd>Cell Side Wet/Dry Depth </tcmd><teq>==<br></teq></a> <tblk>[ {0.001}  |  <span class="math inline">\(\langle\)</span> depth_in_m <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>No longer required or recommended for use subsequent to implementation of <tcmd><a href="#tcfWettingandDrying">Wetting and Drying</a> </tcmd><teq>== </teq><tblk>ON METHOD B</tblk>. See <a href="https://www.tuflow.com/Download/TUFLOW/Manuals/TUFLOW%20Manual.2010-10-AB.docx">2010 TUFLOW Manual</a> for details.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCellSize"><tcmd>Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value_in_metres <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command, use the .tgc <a href="#tgcCellSize">Cell Size</a> command instead. Expand to find out more about the legacy settings.
</summary>
<p>Sets the grid cell size in metres. Rarely used; normally specified in the .tgc file (see Section <a href="#Schematisation-3"><strong>??</strong></a> and <a href="#tgcCellSize">Cell Size</a>). If the command exists in both the .tcf and .tgc, the .tgc command will overwrite the .tcf command.</p>
<p>This command is not supported when using the Quadtree TUFLOW HPC functionality (Section <a href="#Quadtree-3"><strong>??</strong></a>) and the command must be placed in the .tgc instead.</p>
<p>As of the 2023-03-AF release, using this command in the TCF will give an error.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCellWetDryDepth"><tcmd>Cell Wet/Dry Depth </tcmd><teq>==<br></teq></a> <tblk>[ {0.002}  |  <span class="math inline">\(\langle\)</span> depth_in_m <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the wet/dry depth for determining when a cell wets and dries. The
default is 0.002m (2mm) or 0.007ft if using <tcmd><a href="#tcfUnits">Units</a></tcmd><teq> == </teq><tblk>US
Customary</tblk>. The depth should be selected according to the magnitude of
flooding depths. For broad-scale models with large cell sizes values of
up to 0.05m (0.16ft) have typically been used, while for models using
the direct rainfall approach, or that have a high proportion of steep
flow, a wet/dry depth of less than a mm (e.g. 0.0002m or 0.0007ft) may
be required due to the substantial amount of shallow sheet flow. A
reduced wet/dry depth of 0.0002m (0.0007ft) is particularly recommended
for direct rainfall models, noting that the cell wet/dry depth cannot be
set to below 0.0002m (0.2mm) or 0.0007ft.</p>
For TUFLOW Classic Multiple 2D Domain (see Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>) models, this command is domain dependent.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfChangeZeroMaterialValuestoOne"><tcmd>Change Zero Material Values to One </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>The default material value is zero which means that every cell must be
assigned a material value (i.e. use <a href="#tgcSetMat">Set Mat</a> as the first
materials command in the .tgc file). For backward compatibility set to
ON. See Section <a href="#Materials-2"><strong>??</strong></a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCheckInsideGrid"><tcmd>Check Inside Grid </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  WARNING  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
By default, some layers, such as the 2d_bc and 2d_po layers, must have
all of their objects fall within the 2D domain they are associated with,
otherwise an ERROR is issued and the simulation stops. Should it be
required that this check be switched off, set to either WARNING (a
WARNING is issued and will be included in the _messages GIS layer) or
OFF (no checks are made). The treatment of objects that fall partly
inside a 2D domain should be cross-checked viewing the check files and
results as to how they were treated.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCheckMISaveDate"><tcmd>Check MI Save Date </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  WARNING  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Checks that the save date of the .mid file is later than the save date
of the GIS layer as defined by <a href="#tcfCheckMISaveExt">Check MI Save Ext</a>.
The two files must be located in the same folder. This command is very
useful for detecting the possibility that a GIS layer has been modified,
but not exported as .mif/.mid files prior to the simulation.</p>
<p>For the ERROR option (the default), the simulation terminates and an
error message is given.</p>
<p>For the WARNING option, a warning is written to the screen and log file,
but the simulation proceeds without pausing. It remains the
responsibility of the user to check for any warnings.</p>
The OFF option disables all checks and no warnings are given.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCheckMISaveExt"><tcmd>Check MI Save Ext </tcmd><teq>==<br></teq></a> <tblk>[ {.tab}  |  <span class="math inline">\(\langle\)</span> ext <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the extension of the GIS file for which <a href="#tcfCheckMISaveDate">Check MI Save
Date</a> uses. The default extension is “.tab”; the
MapInfo primary GIS table file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCommandLineProcessing"><tcmd>Command Line Processing </tcmd><teq>==<br></teq></a> <tblk>[ {2016}  |  Pre 2016  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Relaxes a rule added in the 2016-03 release that will force an ERROR if a
“==” (double =) is not specified for a command. This is to help prevent
issues associated with specifying a single = and the command not being
processed correctly (as could occur prior to the 2016-03 release).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfControlNumberFactor"><tcmd>Control Number Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.0} | <span class="math inline">\(\langle\)</span>CN_value<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>The default HPC courant, shallow wave celerity and diffusion control
number limits can be reduced (or increased – be careful!) to effectively
underclock or overclock the simulation. Using the above command factors
all three control numbers. For example, a value of 0.8 reduces the
limits from 1.0, 1.0, 0.3 to 0.8, 0.8, 0.24, and will increase the run
time by 20%. Reducing the control number limits may be useful if the
simulation is exhibiting erratic behaviour or numerical “noise”,
although testing has found this is rare in real-world models, and if
occurring is more likely to be a sign of poor data or poor model
schematisation. See Section <a href="#TUFLOWHPCTimestep-3"><strong>??</strong></a> for information relating to TUFLOW HPC’s timestep.</p>
Though not recommended, a HPC simulation can be run using a fixed
instead of adaptive timestep by setting the &lt;cn_value&gt; to 0 and
specifying a <a href="#tcfTimestep">Timestep</a>. When running using a fixed
timestep, there are no checks on exceedance of control numbers or
application of the repeated timestep feature. If the control numbers are
exceeded, the simulation has a high risk of going unstable, which is
detected by the occurrence of NaNs (Not a Number) in the calculations.
However, unstable results can occur prior to NaNs being detected,
therefore if no NaNs occur this is not an indication the simulation was
stable. </cn_value>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCPUThreads"><tcmd>CPU Threads </tcmd><teq>==<br></teq></a> <tblk>[ {2.0}  |  <span class="math inline">\(\langle\)</span>number_of_CPU<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>The number of CPU threads used by a TUFLOW HPC simulation. For example,
<tcmd><a href="#tcfCPUthreads">CPU Threads</a> </tcmd><teq>== </teq><tblk>6</tblk> runs the HPC 2D solver across 6 CPU
core, noting that the number of threads requested is limited to the
maximum number of cores available on the machine, and the available
TUFLOW Thread licences. The default number of Thread licences is four times
the number of TUFLOW Engine licences. For example, a Local 4 licence
allows up to a maximum of 16 CPU cores in use at any one time across all
simulations.</p>
For further information see Section <a href="#HardwareCommands-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCSVHeaderLine"><tcmd>CSV Header Line </tcmd><teq>==<br></teq></a> <tblk>[ {}  |  SINGLE  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This is a legacy command that applies to formats prior to the default .csv output for the 2016-03 release.</p>
<p>Specifying SINGLE will only output a single header line in _PO.csv
files, which makes it much easier to use the file for graphing in Excel.
The simulation name is also included in the label so that it’s easy to
distinguish between simulations when graphing comparisons. This is not
the default setting, so this command needs to be specified to activate
the feature.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCSVMaximumNumberColumns"><tcmd>CSV Maximum Number Columns </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>max_col<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This is a legacy command that applies to formats prior to the default .csv output for the
2016-03 release.</p>
<p>Used to specify a maximum number of columns for 1D .csv output files.
The default setting is limitless. Refer also to the .ecf command <a href="#ecfCSVMaximumNumberColumns">CSV
Maximum Number Columns</a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfCSVTime"><tcmd>CSV Time </tcmd><teq>==<br></teq></a> <tblk>[ DAYS  |  {HOURS}  |  MINUTES  |  SECONDS  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the time values of .csv outputs. The default is HOURS.</p>
Will apply to 1D and 2D .csv output. See Section <a href="#TimeSeries-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDefaults"><tcmd>Defaults </tcmd><teq>==<br></teq></a> <tblk>[ PRE <span class="math inline">\(\langle\)</span>Release<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets backward compatibility to the specified release. See Chapter <a href="#Features-and-Changes-1"><strong>??</strong></a>. Options are:</p>
<ul>
<li>2023-03<br />
</li>
<li>2020-10<br />
</li>
<li>2020-01</li>
</ul>
For <strong>PRE 2018-03</strong> and earlier please refer to the <a href="https://downloads.tuflow.com/TUFLOW/Releases/Latest/TUFLOW%20Manual.pdf">2018 TUFLOW Manual</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDefineOutputZone"><tcmd>Define Output Zone </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>oz_name<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Starts a block of .tcf commands for an Output Zone named <span class="math inline">\(\langle\)</span>oz_name<span class="math inline">\(\rangle\)</span>. See Section <a href="#OutputZones-3"><strong>??</strong></a>.
Only one block can be specified for each unique <span class="math inline">\(\langle\)</span>oz_name<span class="math inline">\(\rangle\)</span>.</p>
Use <a href="#tcfEndDefine">End Define</a> to terminate the block. An ERROR occurs
if <a href="#tcfEndDefine">End Define</a> is not specified. Refer also to <a href="#tcfModelOutputZones">Model
Output Zones</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDemoModel"><tcmd>Demo Model </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
When set to ON, allows simulation of the Demo Models (developed for the
2012 Flood Managers Association (FMA) Conference) and also allows Free
Mode for small-scale models without the need for a TUFLOW license. Note
that writing to the _All_TUFLOW_Simulations.log file (see Section
<a href="#SimLog-2"><strong>??</strong></a>) is switched off when this command is set to ON. For
further information on the Demo Models refer to Section <a href="#LicenceFreeDemoMode-3"><strong>??</strong></a> and the <a href="https://wiki.tuflow.com/New_User_Guide_Free_Demo_Version">User Guide Free Demo TUFLOW
Wiki page</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDensityofAir"><tcmd>Density of Air </tcmd><teq>==<br></teq></a> <tblk>[ {1.25}  |  <span class="math inline">\(\langle\)</span>value<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the density of air in kg/m<sup>3</sup>. If a cyclone/hurricane/typhoon
track is used, the density of air can be varied along the track. See Section <a href="#Cyclones-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDensityofWater"><tcmd>Density of Water </tcmd><teq>==<br></teq></a> <tblk>[ {1025}  |  <span class="math inline">\(\langle\)</span>value<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the density of water in kg/m<sup>3</sup>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDepthRippleHeightFactorLimit"><tcmd>Depth/Ripple Height Factor Limit </tcmd><teq>==<br></teq></a> <tblk>[ {10}  |  <span class="math inline">\(\langle\)</span>value<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets an upper limit on the ratio of the water depth over the ripple
height in the formula for calculating Chezy values based on water depth.
The value must be greater than 1/12, and if less than 1/12 is set to the
default value of 10. See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDisplayWaterLevel"><tcmd>Display Water Level </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>X<span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span>Y<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Displays the water level on the screen for the cell located at X,Y where
X and Y are the geographic coordinates in metres. See Section <a href="#Classic-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfDistributeHXFlows"><tcmd>Distribute HX Flows </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Offers an alternative option for distributing the flow across HX lines
to/from the 1D nodes, see Section <a href="#HXBoundary-3"><strong>??</strong></a>. The distribution is based on a linear
interpolation based on the distance of the HX cell from the 1D node.
This option, on some models, has improved model performance if the 1D/2D
interface is being problematic. The feature is still under trial and
should be benchmarked before adopting. It is not available for the Flood
Modeller 1D link as incorrect results presently occur. It has not been
tested with the XP-SWMM 1D link.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEnd1DDomain"><tcmd>End 1D Domain </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Terminates a <a href="#tcfStart1DDomain">Start 1D Domain</a> block of 1D (.ecf) commands in a .tcf file. See Chapter <a href="#OneD-Domains-1"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEnd2DDomain"><tcmd>End 2D Domain </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Indicates the end of a block of commands that define a 2D domain. Must
only occur after a <a href="#tcfStart2DDomain">Start 2D Domain</a> command,
otherwise an error occurs. See Chapter <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEndAfterMaximum"><tcmd>End After Maximum </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>eam<span class="math inline">\(\rangle\)</span>  |  [ {0.001}  |  <span class="math inline">\(\langle\)</span>h_tol<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Terminates the simulation &lt;eam&gt; hours after the last time a new
maximum was recorded anywhere in the model. <a href="#tcfEndTime">End Time</a>
should also still be specified as an upper limit to finish the
simulation.</p>
<p>&lt;h_tol&gt; is an optional second argument that sets a height tolerance
for detecting whether a 1D node or 2D cell has reached its maximum. For
example, “<tcmd>End After Maximum </tcmd><teq>== </teq><tblk>0.25 | 0.01</tblk>” will terminate the
simulation once either <a href="#tcfEndTime">End Time</a> has been reached, or there are no
1D nodes or 2D cells that have increased by 1cm (0.01m) in the last
15mins (0.25h). The % of 1D nodes and 2D cells that have reached their
maximum are displayed after the “Mx” on the console window and in the
.tlf file.</p>
The default for &lt;h_tol&gt; is 0.001m (or 0.001ft), unless “<a href="#tcfDefaults">Defaults ==
PRE 2016”</a> in which case the default is 0.0. Note that
using a 0.0 tolerance may not work as expected due to numerical
precision issues. </h_tol></h_tol></eam>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEndAfterMaximumStartTime"><tcmd>End After Maximum Start Time </tcmd><teq>==<br></teq></a> <tblk>[ {0}  |  <span class="math inline">\(\langle\)</span>time in hours<span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The <a href="#tcfEndAfterMaximum">End After Maximum</a> feature will not commence
monitoring until after a specified time (in hours).</p>
For example, “<tcmd>End After Maximum Start Time </tcmd><teq>== </teq><tblk>12</tblk>” does not commence
monitoring till a simulation time of 12 hours, therefore, the simulation
cannot terminate prior to this time.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEndDefine"><tcmd>End Define </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Ends a <a href="#tcfDefineOutputZone">Define Output Zone</a> block of .tcf commands. This command must be specified if <a href="#tcfDefineOutputZone">Define Output Zone</a> occurs within the .tcf. See Section <a href="#OutputZones-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEndMapOutput"><tcmd>End Map Output </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The simulation time in hours when map output terminates. If the command is omitted, the simulation end time is used.</p>
<p>This command can be defined for different output formats by including the output format extension on the left of the command. For example, to set the end time for XMDF output to 10hrs use:</p>
<p><tcmd>XMDF End Map Output</tcmd><teq> ==</teq><tblk> 10</tblk></p>
<p>This functionality is also available for the commands <a href="#tcfStartMapOutput">Start Map Output</a>, <a href="#tcfMapOutputInterval">Map Output
Interval</a> and <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a>. Refer to Section <a href="#TimeControl-3"><strong>??</strong></a>.</p>
This command can be used within a <a href="#tcfDefineOutputZone">Define Output Zone</a> definition block to
change the setting from that for the entire model map output.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEndTime"><tcmd>End Time </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the finish time of the simulation in hours. Value must be
greater than the start time and can be negative. See Section <a href="#TCF-3"><strong>??</strong></a>.</p>
If the command is omitted, an end time of 1 hour is used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfESTRYControlFile"><tcmd>ESTRY Control File [ {} | AUTO] </tcmd><teq>==<br></teq></a> <tblk>[ {}  |  AUTO] == <span class="math inline">\(\langle\)</span> .ecf_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the TUFLOW 1D / ESTRY control file (.ecf) (see Section <a href="#ECF-3"><strong>??</strong></a>). There can only be one .ecf file.</p>
<p>The AUTO option automatically sets the .ecf filename to the same as the .tcf file (except for the extension).</p>
Note all 1D output filenames are now based on the .tcf filename, not the
.ecf filename. This means that if the .ecf file does not change when
setting up a new simulation based on a previous simulation, there is no
need to make a copy of the .ecf file (i.e. the .ecf file can be treated
in a similar manner to the .tgc and .tbc files).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfEventFile"><tcmd>Event File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .tef_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active event file, see Section <a href="#Events-3"><strong>??</strong></a>. All .tcf and .ecf commands can also be read into a .tef. The additional .tef commands (that cannot be read in to a .tcf or .ecf) are listed in Appendix <a href="#TEFCommands-1"><strong>??</strong></a>.</p>
Whilst this command may be repeated to change the active event file it is recommended that only one event file be created for all simulations.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfExcelStartDate"><tcmd>Excel Start Date </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> days_since_1900 <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Adjusts the time column of time series output (Section <a href="#TimeSeries-2"><strong>??</strong></a>) by the amount specified.
The amount is in days from the year 1900 as used by Microsoft Excel to
manage its date fields. To determine this value, enter the date
corresponding to time zero in the TUFLOW simulation as a date field in
Excel. Change the format of the Excel cell to “Number”, and the number
of days since 1900 is shown. Paste this number into the .tcf file for
&lt;days_since_1900&gt;.</p>
<p>Note, only applies:</p>
<ul>
<li>if <tcmd><a href="#tcfCSVTime">CSV Time</a></tcmd><teq> == </teq><tblk>DAYS</tblk></li>
<li>to 2D timeseries outputs and not 1D timeseries </days_since_1900></li>
</ul>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfExternalStressFile"><tcmd>External Stress File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .tesf_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the external stress control file ( .tesf) (see Section <a href="#TESF-3"><strong>??</strong></a>). There can only be one .tesf file per 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFEWSGeodatum"><tcmd>FEWS Geodatum </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> geodatum string <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Used to write out a FEWS regular grid configuration file (.xml). This .xml file is written if the FEWS Geodatum is specified and the Map Output Format includes the “NC” format. The .xml file is written to same results folder as the grid .nc, and has the file name “Grids.xml”. For further details see the <a href="https://wiki.tuflow.com/TUFLOW_NetCDF_Raster_Output_Format">NetCDF Raster Output Format TUFLOW Wiki</a> page.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFEWSInputfile"><tcmd>FEWS Input File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> FEWS boundary file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reference to a DELFT-FEWS boundary file in .csv or .xml format. This
command can be used to set the duration of the simulation
and the <a href="#tcfNetCDFOutputStartDate">NetCDF Output Start Date</a> for a TUFLOW simulation based on the
information within the DELFT-FEWS file. Refer to Section <a href="#DelftFEWSBoundary-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFileRetryMaxCount"><tcmd>File Retry Max Count </tcmd><teq>==<br></teq></a> <tblk>[ &lt;max count&gt; | {40} ]</max></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
When a file is locked (e.g. due to external use such as during file backups) TUFLOW will retry a set number of times (and for a set period of time - see <a href="#tcfFileRetryTimeout">File Retry Timeout</a> to access the file. The maximum number of retries is capped to prevent an infinite loops if the file is permanently locked. The default number of retries is 40.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFileRetryTimeout"><tcmd>File Retry Timeout </tcmd><teq>==<br></teq></a> <tblk>[ &lt;max time&gt; | {30} ]</max></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
When a file is locked (e.g. due to external use such as during file backups) TUFLOW will retry to access the file for a set period of time (and a set number of retries - see <a href="#tcfFileRetryMaxCount">File Retry Max Count</a>) to access the file. The default timeout value is 30 seconds.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFirstSweepDirection"><tcmd>First Sweep Direction </tcmd><teq>==<br></teq></a> <tblk>[ AUTOMATIC  |  {POSITIVE}  |  NEGATIVE  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Build 2004-05-AD reworked and tested part of the Stelling scheme that can vary the sweep direction depending on the flow regime at the time. In rare situations, this may cause very slight difference in results between two models (e.g. before and after cases) in areas where there should be no difference at all. This was as a result of the unpredictable sweep direction in one part of the scheme. Testing on a number of models showed that by fixing the sweep directions, there was virtually no difference in results. This also solved the rare situation where two models were showing a slight difference in areas they should not have been.</p>
<p>This command is provided for backward compatibility, although it is not considered that this will be necessary in most models. To use the approach prior to Build 2004-05-AD use the AUTOMATIC option.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfForceFileIODisplay"><tcmd>Force File IO Display </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to ON, forces all file opening and closing information to be displayed to the screen and .tlf file. Nearly all file opening and closing is displayed, however some isn’t. For example <tcmd><a href="#tcfWritePOOnline">Write PO Online</a></tcmd> <teq>==</teq> <tblk>ON</tblk> displays a lot of file opening and closing information as the simulation proceeds, so should you wish to activate this for checking purposes set this command to ON.</p>
<strong>Note: This command would mainly be used for debugging a file opening and closing issue.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFreeOverfall"><tcmd>Free Overfall </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  ON WITHOUT WEIRS  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>The default ON option activates the free-overfall method described in <span class="citation">Syme (<a href="#ref-Syme1991">1991</a>)</span>. The method offers better stability; particularly where
major wetting and drying occurs. It also allows large tidal flats to
continue to drain without being cut-off at their edges. This option also
activates the automatic broad-crested weir flow switch between upstream
and downstream controlled flow. Use this option where weir flow occurs
over levees and embankments. This option increases the computation time,
typically by 10 to 30%, depending on the degree of wetting, drying and
weir flow.</p>
<p>Upstream controlled flow is determined by comparison of the upstream and
downstream energy levels. If upstream controlled, the broad-crested weir
formula is used to define the flow across the cell-side. With the
development of the <a href="#tcfSupercritical">Supercritical</a> flow switch, the
automatic weir flow algorithm was enhanced and only applies to
cell-sides that have an adverse slope (i.e. the bed slope from the ZC to
ZU/ZV point is of opposite sign to the water surface slope) - see
Section <a href="#CLA-US-Controlled-3"><strong>??</strong></a>.</p>
<p>The ON WITHOUT WEIRS option activates the free-overfall method without
the automatic weir flow switching. Mainly used for models developed
prior to 1999, which is when the weir flow option became available.</p>
<p>The OFF option deactivates the free-overfall method. Used for models
with little or no wetting and drying, and no upstream controlled weir
flow.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFreeOverfallFactor"><tcmd>Free Overfall Factor </tcmd><teq>==<br></teq></a> <tblk>[ {0.6}  |  <span class="math inline">\(\langle\)</span> value_0.0_to_1.0 <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Sets the free-overfall factor (see <span class="citation">Syme (<a href="#ref-Syme1991">1991</a>)</span>).</p>
The default is 0.6. The value should be less than 1.0 and greater than
0.0.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFroudeCheck"><tcmd>Froude Check </tcmd><teq>==<br></teq></a> <tblk>[ {1}  |  <span class="math inline">\(\langle\)</span> froude_no <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the minimum Froude Number that upstream controlled friction flow
may occur. Only applies if <a href="#tcfSupercritical">Supercritical</a> is set to
ON, otherwise it is not used. Improved stability may occur in steeply
flowing areas if &lt;froude_no&gt; is less than 1. &lt;froude_no&gt; cannot be
below zero and would normally not exceed 1. See Section <a href="#CLA-US-Controlled-3"><strong>??</strong></a>. </froude_no></froude_no>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfFroudeDepthAdjustment"><tcmd>Froude Depth Adjustment </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Switches on or off an additional upstream controlled friction flow check (see Section <a href="#CLA-US-Controlled-3"><strong>??</strong></a>). Set to OFF for backward compatibility for models run prior to Build 2003-01-AF that use the upstream controlled friction feature (i.e. see <a href="#tcfSupercritical">Supercritical</a>).</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGAConvergenceValue"><tcmd>GA Convergence Value </tcmd><teq>==<br></teq></a> <tblk>[ {0.001}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the Green Ampt iteration infiltration convergence test value. The default value is 0.001m. See Section <a href="#green-ampt-ga"><strong>??</strong></a>. The default unit for this command is metres. If <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the unit is feet.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGAMaximumIternations"><tcmd>GA Maximum Iterations </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the limit on the number of iterations for the Green Ampt solution.
The default value is 10. If the number of iterations exceeds this value
a <a href="https://wiki.tuflow.com/TUFLOW_Message_2302">WARNING 2302</a> is issued. See Section <a href="#green-ampt-ga"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGeometryControlFile"><tcmd>Geometry Control File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .tgc_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the geometry control file (.tgc) (see Section <a href="#TGC-3"><strong>??</strong></a>). There can only be one .tgc file per 2D domain.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISFormat"><tcmd>GIS Format </tcmd><teq>==<br></teq></a> <tblk>[ {MIF}  |  SHP  | GPKG ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the output format for GIS check layers and GIS outputs such as the _TS layers. If the command <a href="#tcfGISFormat">GIS Format</a> is not specified, the GIS format used for check layers and other GIS outputs is
based on whether <a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> or <a href="#tcfMIProjection">MI Projection</a> has been specified. If none or all of these commands have been specified, and <a href="#tcfGISFormat">GIS Format</a> has
not been specified, the default of using .mif files is adopted. See Section <a href="#GISBased-4"><strong>??</strong></a>.</p>
<strong>Note that the format of an input layer is solely controlled by the file extension (i.e. .gpkg for the GPKG format, .shp for the SHP format and .mif for the MIF format).</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISGridVectorDirection"><tcmd>GIS Grid Vector Direction </tcmd><teq>==<br></teq></a> <tblk>[ {ANGLE}  |  BEARING  |  VERBOSE  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The magnitude and direction are output as attributes on the GIS object
for output of vector data. This command sets the direction convention.
For the ANGLE option the direction is output in arithmetic format (0
degrees = East). For BEARING this is set to a compass bearing notation
with (0 degrees = North). If set to VERBOSE, the x-direction component,
y-direction component, angle and bearing are all output as attributes on
the GIS layer.</p>
To apply a different setting for different vector data types, inset the
data type before the command. See Section <a href="#GISBased-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISGridVectorSF"><tcmd>GIS Grid Vector SF </tcmd><teq>==<br></teq></a> <tblk>[ {1}  |  <span class="math inline">\(\langle\)</span> scale factor <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Scale factor for the scaling of region objects for GIS output of vector
data. The default value is 1. A value of 1 means a velocity of 1 m/s is
one 2D cell long, therefore, with a scale factor of 2, a vector of
magnitude 1 m/s would be two 2D cells long. A negative value outputs
vectors of fixed length equal to &lt;scale_factor&gt; in metres or feet.</p>
To apply a different setting for different vector data types, inset the
data type before the command. See Section <a href="#GISBased-4"><strong>??</strong></a>. </scale_factor>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISGridVectorTTF"><tcmd>GIS Grid Vector TTF </tcmd><teq>==<br></teq></a> <tblk>[ {0}  |  <span class="math inline">\(\langle\)</span> tail_thickness_factor <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Tail thickness Factor, scales the thickness of the arrow tails (default
= 0). The thickness is the &lt;tail_thickness_factor&gt; times the arrow
length. For some GIS software such as ArcGIS, a zero tail thickness
value may cause issues as the region shape wraps onto itself. To apply a
different setting for different vector data types, inset the data type
before the command. See Section <a href="#GISBased-4"><strong>??</strong></a>. </tail_thickness_factor>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISGridVectorType"><tcmd>GIS Grid Vector Type </tcmd><teq>==<br></teq></a> <tblk>[ {Region}  |  Point  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies whether the vector information (output over a regular grid)
should be as points or region objects. Region objects refer to the
arrows that <a href="https://wiki.tuflow.com/TUFLOW_to_GIS">TUFLOW_to_GIS</a> produces, scaled according to the vector
magnitude. The magnitude and direction are output as attributes to the
layer. The default is regions (as per <a href="https://wiki.tuflow.com/TUFLOW_to_GIS">TUFLOW_to_GIS</a>).</p>
To apply a different setting for different vector data types, inset the
data type before the command. See Section <a href="#GISBased-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISProjectPathFormat"><tcmd>GIS Project Path Format </tcmd><teq>==<br></teq></a> <tblk>[ Absolute | {Relative} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the referencing type for the workspaces output by TUFLOW, for QGIS (.qgs) and MapInfo (.wor). “Relative” (the default) uses relative referencing, this can be changed to absolute by using “Absolute”. See Section <a href="#Workspaces-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISProjectionCheck"><tcmd>GIS Projection Check </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  WARNING  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Checks that the <a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> and/or <a href="#tcfMIProjection">MI Projection</a> setting is the same as the projection for all input layers. See Section <a href="#GISFormats-3"><strong>??</strong></a>. The Coordsys line check removes all spaces, tabs and quotes when making the comparison.</p>
<p>The check includes the “Bounds” values, as having different bounds can
affect the decimal precision used by GIS/CAD software when writing .mif
files, which can affect the TUFLOW test for snapped (connected) objects.</p>
The default setting is ERROR and will prevent TUFLOW from starting the
model simulation. Changing to WARNING output a message to the
_messages GIS layer (Section <a href="#Messages-3"><strong>??</strong></a>) and will allow the model to continue to
compile.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISSupportedObjectIgnored"><tcmd>GIS Supported Object Ignored </tcmd><teq>==<br></teq></a> <tblk>[ ERROR  |  {WARNING}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls the response to GIS object ignored messages (for example, see
<a href="http://wiki.tuflow.com/TUFLOW_Message_2073">Message 2073</a>).
If set to ERROR the simulation is terminated, while is set to WARNING
(the default) the message is issued and the simulation continues. The
default is for a WARNING to be issued as per releases prior to 2016-03.</p>
Note that various TUFLOW inputs expect different GIS object types, so
the behaviour of this reporting varies. For example a 1D boundary
(1d_bc) layer can contain points snapped to the 1D nodes and/or region
objects used to apply flow boundaries to nodes that fall within the
region. So whilst a line is a generally supported object
(see <a href="#tcfGISUnsupportedObject">GIS Unsupported Object</a>) any line
objects in a 1d_bc layer are not used and TUFLOW issues
<a href="http://wiki.tuflow.com/TUFLOW_Message_1099">Message 1099</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGISUnsupportedObject"><tcmd>GIS Unsupported Object </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  WARNING ]  |  [ {1}  |  <span class="math inline">\(\langle\)</span> level <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls the approach for issuing messages in relation to unsupported
GIS objects. GIS software typically store
vector data in three broad geometries:</p>
<ul>
<li>Points</li>
<li>Lines</li>
<li>Regions</li>
</ul>
<p>Within these geometry types, different GIS packages may offer options
for digitising objects. For example, when drawing a line object in
MapInfo the user has the option for a line, a polyline and an arc. From
left to right the editing buttons to digitise a line, polyline and arc
in MapInfo are:</p>
<p><img src="images/image198.png" style="width:0.73958in;height:0.30208in"></p>
<p>These line types are stored differently in the MapInfo .mif file, an
extract of a .mif file which shows a line (with 2 vertices) object (red), a line (with 3 vertices) object
(green) and an arc object (blue) is below.</p>
<p><teq>Line 340604.21 5782377 340612.07 5782369.48<br />
 Pen (1,2,0)</teq><br />
<tgrn>Pline 3<br />
340609.55 5782359.99<br />
340614.35 5782361.73<br />
340623.19 5782363.59<br />
 Pen (1,2,0)<br />
<tcmd>Arc 340630.84 5782358.24 340640.43 5782382.01 180 270<br />
 Pen (1,2,0)</tcmd></p>
<p>Various GIS packages handle the advanced GIS geometries (such as arcs)
differently, for example if converting a MapInfo Arc object using QGIS,
the arc object is converted to a polyline with vertices along the
length. For consistency between packages and to provide better support
across GIS platforms not all GIS geometries are supported by TUFLOW. For
lines, arc objects are not supported (but line and polyline objects are
both recognised). For region objects rectangles, rounded rectangles and
ellipses are not supported.</p>
<p>Two special cases of unsupported geometries are “Text” objects, which
can be used to annotate GIS layers, and “None” or “Null” objects, which
GIS software may add to the layer to indicate deleted objects
(particularly if using the shapefile format).</p>
<p>This command controls TUFLOW’s
response for geometries that are not supported by TUFLOW. The ERROR
option stops the simulation with a
<a href="https://wiki.tuflow.com/TUFLOW_Message_0323">Message 0323</a>,
while WARNING issues
<a href="https://wiki.tuflow.com/TUFLOW_Message_0323">Message 0323</a>
and continues the simulation. There is an optional severity level
component that can be specified as a second argument (separated by a
vertical bar) with the options for &lt;level&gt; being:</p>
<p>The severity levels are:</p>
<ul>
<li>Level 0 – No checks on unsupported geometries (i.e. previous
behaviour)<br />
</li>
<li>Level 1 – Check for ellipses, rectangles, rounded rectangles and arcs
(curved arcs)<br />
</li>
<li>Level 2 – All the level 1 checks as above plus checks for null and
text objects.</li>
</ul>
The default for unsupported objects is ERROR | 1, that is arcs,
ellipses, rectangle and rounded rectangles will cause the simulation to
stop, but any None and Text objects will be ignored. </level></tgrn>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGlobalFCChFactor"><tcmd>Global FC Ch Factor </tcmd><teq>==<br></teq></a> <tblk>[ {0.8}  |  <span class="math inline">\(\langle\)</span> Ch <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
The global C<sub>h</sub> factor applied to flow constrictions when the
flow upstream is submerged and the flow downstream is unsubmerged, using
the pressure flow equation for upstream controlled flow. See Section <a href="#legacy-structures"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGlobalRainfallUseMaterialLoss"><tcmd>Global Rainfall Use Material Loss </tcmd><teq>==<br></teq></a> <tblk>[ OFF  | {ON} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets whether material rainfall losses (Section <a href="#Rainfall-Losses-4"><strong>??</strong></a>) are used when using a global rainfall boundary (Section <a href="#RF-Global-4"><strong>??</strong></a>). Prior to the 2020-10-AA release, if using material rainfall losses in TUFLOW Classic, the losses were not applied to any global rainfall boundaries. This command can be used to turn off material losses. The default for 2020-10-AA and newer is to apply material losses to global rainfall boundaries (in line with TUFLOW HPC).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGlobalWeirFactor"><tcmd>Global Weir Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.0}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Factor that adjusts the broad-crested weir formula (see Section
<a href="#CLA-US-Controlled-3"><strong>??</strong></a>). Testing has shown that a value of 1.0 to 1.1 is needed to
reproduce upstream controlled weir flow <span class="citation">(<a href="#ref-Syme2001b">Syme, 2001b</a>)</span>. This factor is
applied globally, although spatial variation of the factor can be
specified through a GIS layer read by the geometry control file (see
<a href="#tgcReadGISWrF">Read GIS WrF</a>.</p>
Note that the global value and the spatially varying value are
multiplied together (i.e. one does not replace the other).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPKGConversionCheck"><tcmd>GPKG Conversion Check  </tcmd><teq>==<br></teq></a> <tblk>[ WARNING ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<a href="https://wiki.tuflow.com/TUFLOW_Message_0248">ERROR 0248</a> may occur when reading a SHP or MIF file that has been exported from a GKPG layer (see Section <a href="#GISFormats-3"><strong>??</strong></a>). This command can be used to downgrade <a href="https://wiki.tuflow.com/TUFLOW_Message_0248">ERROR 0248</a> to a Warning. Alternatively, ensure the input file follows the correct TUFLOW attributes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPKGProjection"><tcmd>GPKG Projection </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> GPKG layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the geographic projection for all GIS input and output in GeoPackage (.gpkg) file format (see Section <a href="#GISFormats-3"><strong>??</strong></a>). This is used for checking whether input layers are in the same projection, and for setting the projection of all output layers (e.g. check layers).</p>
If a model has a mixture of .gpkg, .shp and .mif files as input, then the projection must be specified for each (e.g. using <a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> and <a href="#tcfMIProjection">MI
Projection</a>)
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPUDeviceIDs"><tcmd>GPU Device IDs </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> list_of_device_ids <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Controls the GPU device or devices to be used for the simulation if
multiple CUDA enabled GPU cards are available in the computer or on the
GPU itself. If you only have one GPU device,
or you wish to use the primary device, this command is not needed. If
there is more than one GPU device, and you wish to run the model across
cards, enter a list of device IDs. For example, if you wanted to run a
model using GPU devices 0 and 2, specify:</p>
<p><tcmd>GPU Device IDs</tcmd><teq> == </teq><tblk>0, 2</tblk></p>
<p>Note that the GPU device numbering starts at 0 rather than at 1.</p>
<p>A GPU licence will be needed for each device ID.</p>
<p>Also refer to the batch switch –pu&lt;id&gt; described in which has the same
function.</p>
For further information see Section <a href="#HardwareCommands-2"><strong>??</strong></a>. </id>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPUDPCheck"><tcmd>GPU DP Check </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>The GPU Solver is a legacy solver.</p>
<p>The default setting of ERROR, causes TUFLOW to stop with <a href="https://wiki.tuflow.com/TUFLOW_Message_2420">ERROR 2420</a>
advising that it is recommended to use the single precision version of
the GPU Solver. Due its explicit formulation and being depth based,
TUFLOW GPU does not usually require to be run in double precision (DP)
mode. Refer to Section <a href="#iSPdSP-3"><strong>??</strong></a> for further information. There can
also be substantial speed gains using single precision (SP) on some GPU
cards, and there is a significantly less memory footprint. If DP is
desired or required for the GPU Module specify <tcmd><a href="#tcfGPUDPCheck">GPU DP Check</a></tcmd> <teq>==</teq> <tblk>OFF</tblk> in the .tcf file, and run using a DP
TUFLOW exe.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPUPeertoPeerAccess"><tcmd>GPU Peer to Peer Access  </tcmd><teq>==<br></teq></a> <tblk>[ DISABLED  | {ENABLED IF AVAILABLE} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
When running a HPC simulation across multiple GPUs, TUFLOW automatically recognises and utilises any peer to peer (p2p) access between GPUs that is possible according to the hardware setup. The user can choose to disable peer to peer GPU by setting this to ‘DISABLE’. This can also be specified using the command line argument -p2p0 to disable, or -p2p1 to enable (if available). The default is to use peer to peer access if available. Peer to peer access in rare occasions has failed to work when a peer connection has been reported as possible by the nVidia console or API. See Section <a href="#HardwareCommands-2"><strong>??</strong></a> and <a href="#GPUNVLink-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRAMOptimisation"><tcmd>RAM Optimisation </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Set to ON to optimise CPU RAM allocation for TUFLOW HPC simulations.
This will cause the CPU RAM requirements to use around 50% less memory.
This command should only be set to OFF to identify whether memory
allocation is the cause of any issues when running the HPC Solver.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPUSolver"><tcmd>GPU Solver </tcmd><teq>==<br></teq></a> <tblk>[ [ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
GPU (pre-2017 HPC release) if set to ON
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Must be set to ON to use the pre 2017 release version of the TUFLOW GPU
Engine. Significant improvements were made to
the GPU solver for the 2017 release. Please use <a href="#tcfSolutionScheme">Solution
Scheme</a> and <a href="#tcfHardware">Hardware</a> commands to use
the improved TUFLOW HPC solver using GPU hardware. If the
command is not specified or set to OFF, the standard TUFLOW Classic CPU
Engine will be used to simulate the model.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPUTemporalScheme"><tcmd>GPU Temporal Scheme </tcmd><teq>==<br></teq></a> <tblk>[ [ 1  | 2 |  {4}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
GPU (pre-2017 HPC release)
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Note: This command relates to the legacy TUFLOW GPU solver. Please use <a href="#tcfSolutionScheme">Solution Scheme</a> and <a href="#tcfHardware">Hardware</a> commands to use the improved TUFLOW HPC solver using GPU hardware.</p>
<p>This command sets the order of the temporal solution for TUFLOW GPU simulations. The default is the recommended 4<sup>th</sup> order temporal solution therefore this command is usually not specified.</p>
<p>Available options are:</p>
<p>1 – First order out of place<br />
2 – Second Order<br />
4 – Fourth Order</p>
<p><strong>We recommend the use of the 4<sup>th</sup> order temporal scheme as it
is unconditionally stable with adaptive timestepping turned on, and has
found to give excellent results. Lower order schemes save a little on
memory requirements, but are more prone to instability and in some cases
unreliable results.</strong></p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGridFormat"><tcmd>Grid Format </tcmd><teq>==<br></teq></a> <tblk>[ ASC  |  FLT | {TIF} | GPKG | NC | TGO | WRR ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the format that TUFLOW uses to write output and check file grids (see Section <a href="#Grid-4"><strong>??</strong></a>). The default is the TIF format. Table <a href="#tab:tab-FormatOptionsGrid">101</a> lists the available formats.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGridOutputCellSize"><tcmd>Grid Output Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_cell_size <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the cell resolution in metres of all grid outputs. For TUFLOW Classic the default output grid resolution is half the smallest 2D cell size (considering that multiple 2D domains may exist). For TUFLOW HPC the default is half the 2D cell size. For HPC models using Quadtree, the output resolution is the smallest 2D cell size. For more information see Section <a href="#Grid-4"><strong>??</strong></a>.</p>
<p>A DEM of the final Zpts is automatically written using this resolution if writing check files unless it is
excluded using <tcmd><a href="#tcfWriteCheckFiles">Write Check Files Exclude</a> </tcmd><teq>== </teq><tblk>DEM_Z</tblk>.</p>
Increasing the grid output cell size will reduce the RAM required and the size of the output files. Therefore, for very large models, consider increasing this value if there are memory (RAM) allocation issues. For more advice on reducing RAM requirements, see the <a href="https://wiki.tuflow.com/TUFLOW_Simulation_Speed">TUFLOW Simulation Speed</a> wiki page.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGridOutputOrigin"><tcmd>Grid Output Origin </tcmd><teq>==<br></teq></a> <tblk>[ {AUTOMATIC}  |  MODEL ORIGIN  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>AUTOMATIC, the default, adjusts the origin for the output grids by
rounding to the <a href="#tcfGridOutputCellSize">Grid Output Cell Size</a> so that
all grids produced from different simulations using different model
extents, and between different Output Zones, are all aligned. See Section <a href="#Grid-4"><strong>??</strong></a>.</p>
If <tcmd><a href="#tcfGridOutputOrigin">Grid Output Origin</a></tcmd> <teq>==</teq> <tblk>MODEL ORIGIN</tblk> is
specified, this sets grid output (e.g. TIF, FLT or ASC) to have its origin
exactly at the model’s lowest left coordinates for map output. Note that
output grids of different origins (due to a change in the model’s
schematisation or addition of 1D WLLs), or from different Output Zones,
may not be aligned.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGroundwaterBlendThreshold"><tcmd>Groundwater Blend Threshold </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> float <span class="math inline">\(\rangle\)</span> | {0.9} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
When a soil is nearly saturated, the level is transitioned from the level in the current layer to the layer above, as this avoids a sudden change in level as the soil reaches capacity. A “groundwater blend threshold” is used to control this, this threshold has a default value of 0.9, meaning that once a soil exceeds 90% of a soil capacity, the level starts to transition to the level in the layer above. The value must be in the range 0-99. See Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHardware"><tcmd>Hardware </tcmd><teq>==<br></teq></a> <tblk>[ {CPU}  |  GPU ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This command defines the hardware to be used for the compute. See Section <a href="#Hardware-1"><strong>??</strong></a>.</p>
<p>CPU will run a simulation using the Central Processing Unit (CPU).</p>
<p>GPU will run the simulation using the Graphics Processor Unit (GPU)
hardware. GPU hardware technology means very large models ($$100 million
cells) with fine grids can now be run within a sensible timeframe.</p>
TUFLOW Classic simulations are only possible using CPU. TUFLOW HPC can
be run using CPU or GPU. TUFLOW HPC CPU simulations can be done using a
standard TUFLOW licence. The GPU Hardware Module is required in addition
to a standard TUFLOW licence to run a simulation on GPU. Refer to
Section <a href="#AddonModules-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHEC-DSSStartDate"><tcmd>HEC-DSS Start Date </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Used to identify the date/time that should be used for time-zero. The date should be in the isodate format: yyyy-mm-dd hh:mm:ss, where the time portions are optional. If this command is not used, the first time in the DSS curve will be treated as time 0.0. See Section <a href="#HECDSS-3"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCWeirParameters"><tcmd>HPC [Thin | Thick] Weir Parameters </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> Ex <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> a <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> b <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
New command for the TUFLOW 2023 release that sets the 2D weir flow parameters in the HPC solver at thin/thick breaklines, see Section <a href="#HPC-US-Controlled-3"><strong>??</strong></a>. These parameters are the weir coefficient (<em>C<sub>d</sub></em>), the weir flow equation exponent (<em>Ex</em>) in the advanced weir equation (Section 5.7.5.3), and the exponents used in the Villemonte equation (<em>a</em> and <em>b</em>). The default values are 0.577, 1.5, 8.55 and 0.566, respectively.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPC1DSynchronisation"><tcmd>HPC 1D Synchronisation </tcmd><teq>==<br></teq></a> <tblk>[ {MAXIMISE 1D TIMESTEP}  |  EVERY 2D TIMESTEP]  |  [{10 ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
The 1D timestep for a HPC 1D/2D linked model is the maximum or limiting
timestep the 1D solver can use. The 1D solver act as an adaptive/varying
timestep solution, and can step at different multiples of steps to the
HPC 2D solver. Both 1D and 2D solutions are always synchronising at the
2D target timestep, or a multiple of the 2D target timestep if the 1D
timestep is sufficiently greater for the 2D to perform more than one
step. If the 1D limiting timestep is less than half the 2D target
timestep, the 1D proceeds in two or more steps eventually synchronising
with the 2D timestep. Where there is not a one-to-one synchronisation of
the 1D and 2D timesteps, a usually negligible mass error may occur and
can be checked by reviewing the CME% values shown on the Console Window (Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>,
the .tlf file (Section <a href="#TLF-3"><strong>??</strong></a>) or the _MB.csv file (Section <a href="#MB-2"><strong>??</strong></a>) in the same manner as Classic. This
command forces the 1D and 2D timestepping to be synchronised one-to-one. For more information on timestepping, see Section <a href="#TimestepBackground-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCBoundaryApproach"><tcmd>HPC Boundary Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | Method B | {Method C} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Used to set which HPC Boundary approach to use, for more information see Section <a href="#HPCEnergyOptions-4"><strong>??</strong></a>. Method C is the default which applies energy corrections for HT, HQ and QT boundaries. Method B applies energy correction for HT, HQ, QT and HX boundaries connected to a single 1D node. Method A, the default for TUFLOW Classic, applies no energy connections.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCDeviceSplit"><tcmd>HPC Device Split </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value1, value2, … <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only (non Quadtree)
</td>
<td style="text-align:left;">
<p>If a model is simulated across multiple GPU devices, one of the devices (usually the one with the most wet cells) will be controlling the speed of the simulation and the other devices will be under-utilised. By default, TUFLOW HPC divides a model equally over multiple GPU devices. It is usual for the GPUs to have an un-equal amount of workload due to the number of active cells and number of wet cells, and this can change throughout the simulation as the model wets and dries. This command allows the user to distribute the workload unequally to the GPU devices.</p>
<p>During a simulation the workload efficiency of each GPU is output to the console and to the .tlf file with a suggested distribution provided at the end of the simulation. A number of iterations may be required to fully optimise the distribution.
For example, a model simulated across four GPU devices reported at the end of the simulation in the .tlf file:</p>
<p><tblk>Relative device loads: 60.3% 100.0% 83.7% 53.2%<br />
HPC Suggested workload balance HPC Device Split == 1.23, 0.74, 0.89, 1.40</tblk></p>
For further information see Section <a href="#HardwareCommands-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCDPCheck"><tcmd>HPC DP Check </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
The default setting of “ERROR”, causes TUFLOW to stop with <a href="https://wiki.tuflow.com/TUFLOW_Message_2420">ERROR 2420</a> (advising that it is recommended to use the single precision version of
the HPC Solver). Due its explicit formulation and being depth based,
TUFLOW HPC does not usually require to be run in double precision (DP)
mode. Refer to Section <a href="#iSPdSP-3"><strong>??</strong></a> and the <a href="https://wiki.tuflow.com/Hardware_Benchmarking_Topic_Single_Precision_VS_Double_Precision">TUFLOW Wiki</a> for further information. There can
also be substantial speed gains using single precision (SP) on some GPU
cards, and there is a significantly less memory footprint. If DP is
desired or required for the HPC (and as such, the GPU Module) specify <tcmd><a href="#tcfGPUDPCheck">HPC DP Check</a></tcmd> <teq>==</teq> <tblk>OFF</tblk> in the .tcf file, and run using a DP
TUFLOW exe.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCdtWriteInterval"><tcmd>HPC dt Write Interval </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> number of timesteps <span class="math inline">\(\rangle\)</span> | {<span class="math inline">\(\langle\)</span> Screen/Log Display Interval <span class="math inline">\(\rangle\)</span>} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Sets the output interval for information written to the .hpc.dt.csv file (Section <a href="#HPCTLF-4"><strong>??</strong></a>). If not set the default is to use the <a href="#tcfScreenLogDisplayInterval">Screen/Log Display Interval</a>. If set to zero of less the file is supressed and not written.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCHQBoundaryApproach"><tcmd>HPC HQ Boundary Approach </tcmd><teq>==<br></teq></a> <tblk>[ CELL | {TOTAL} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
HQ boundary computes the flux across the entire boundary line and uses a rating curve to apply a water level to the model. Each line is treated as a separate boundary and has a stage-discharge relationship, this is consistent with the TUFLOW Classic approach to HQ boundaries. Earlier versions of TUFLOW HPC applied the water surface slope on a cell by cell basis. It is possible to revert to all HQ boundaries using a cell by cell approach by setting this command to ‘CELL’. For more information see Section <a href="#HpcHQApproach-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCHQBoundaryFilterConstant"><tcmd>HPC HQ Boundary Filter Constant </tcmd><teq>==<br></teq></a> <tblk>[ {1} | <span class="math inline">\(\langle\)</span> float <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
For cross-sections with very low longitudinal slope, the stage vs flow (HQ) relationship can become unstable - a small change in flow causes a change in water level that subsequently causes a similar but opposite change in flow. The user may specify the global HQ boundary filter constant using this command, see Section <a href="#HpcHQFilter-4"><strong>??</strong></a> for further details. The default value is 1, which means no filtering (for backward compatibility).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCInfiltrationDryingApproach"><tcmd>HPC Infiltration Drying Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | Method B ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Used to control drying when soil infiltration is present, see Section <a href="#HpcBoundariesOther-4"><strong>??</strong></a>. For models using SGS the default is Method B, otherwise the default is Method A.</p>
<p>Infiltration is only computed for wet cells, consequently if the applied rainfall rate is less than the infiltration rate then the cell will repeatedly dry then wet. This can cause time output results to appear erratic and in rare cases has resolved stability issues if SGS was implemented. Currently infiltration rate is limited to the available water within a cell plus a precision adjustment, allowing the cell to dry. An improved approach (Method B) is to remove the precision adjustment for cells that have positive rainfall, so they remain “wet” but with near zero available water, thus eliminating the cyclical drying and wetting.</p>
For models with SGS on the default approach is to use Method B, while for Non SGS models the default approach is to use Method A for backward compatibility. For non-SGS models there maybe be benefits in switching to Method B noting that this will infinitesimally reduce the amount of infiltration and therefore infinitesimally increase the amount of surface water. For SGS activated models, Method B is recommended for improved stability in rare cases and because the differences between methods is even less due to the much smaller wetted area in the cell at the drying point.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCManningsDepthApproach"><tcmd>HPC Mannings Depth Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Sets the approach used for the bed resistance calculation in the u and v direction (Section <a href="#Solvers-2"><strong>??</strong></a>). “Method B” (the default) upwinds the depth of flow at a face which has found to improve model stability. The previous method is available by setting this command to “Method A”. Note, if using the TUFLOW HPC SGS functionality, this command has no effect.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCRestartGeometry"><tcmd>HPC Restart Geometry </tcmd><teq>==<br></teq></a> <tblk>[ Restart File | {TGC} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Used to specify restart model geometry. From the 2020-10-AB build and onwards, the default option is “TGC”, which uses the bed elevation created by .tgc files. The “TGC” approach is consistent with the Classic solver. The bed elevation from the restart file can be used by selecting the option “Restart File”, this means changes in .tgc files won’t be applied in the restarted model. The “Restart File” approach was the default for HPC models prior to build 2020-10-AB. See Section <a href="#RestartFiles-3"><strong>??</strong></a>. See also <a href="#tcfRestartFileIgnoreFields">Restart File Ignore Fields</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCSXMomentumApproach"><tcmd>HPC SX Momentum Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | Method B ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Sets whether momentum flux is added to SX cells (Method B), which improves the boundary cell flow behaviour by applying appropriate momentum source/sink, or if only mass flux is added to SX cells (Method A). Method A is available for backward compatibility. See Section <a href="#HpcBoundariesOther-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCTemporalScheme"><tcmd>HPC Temporal Scheme </tcmd><teq>==<br></teq></a> <tblk>[ 1 | 2 |  {4} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>This command sets the order of the temporal solution for TUFLOW HPC
simulations, see Section <a href="#HPCGPUCommands-4"><strong>??</strong></a>. The default is the recommended 4<sup>th</sup> order
temporal solution therefore this command is usually not specified.
Available options are:</p>
<p>1 – First order out of place<br />
2 – Second Order<br />
4 – Fourth Order</p>
<strong>We recommend the use of the 4<sup>th</sup> order temporal scheme as it
is unconditionally stable with adaptive timestepping turned on, and has
found to give excellent results. Lower order schemes save a little on
memory requirements, but are more prone to instability and in some cases
unreliable results.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHPCWeirApproach"><tcmd>HPC Weir Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | Method B | {Method B Energy} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>New command for the TUFLOW 2023 release that sets the 2D weir flow approach in the HPC solver at thin/thick breaklines (see Section <a href="#HPC-US-Controlled-3"><strong>??</strong></a>).</p>
<p>Available options are:</p>
<ul>
<li>“Method A”: applies a water level gradient limiter for weir flow approximation.<br />
</li>
<li>“Method B”: applies the weir equation and uses the upstream water level above the weir invert as <em>H<sub>u</sub></em>.<br />
</li>
<li>“Method B Energy” (default): applies the weir equation and uses the upstream energy level above the weir invert as <em>H<sub>u</sub></em>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHQBoundaryApproach"><tcmd>HQ Boundary Approach </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  METHOD B  |  {METHOD C} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the approach to be used for automatically generated 2D HQ boundaries (refer to Section <a href="#TwoDBoundaries-2"><strong>??</strong></a>).</li>
</ul>
<p>METHOD A extends the HQ curve by ten metres (or 32.8 ft if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>) on its last point which can
cause a sudden change in the slope of the curve at this elevation. This
method does not issue <a href="https://wiki.tuflow.com/TUFLOW_Message_2365">WARNING 2365</a> if the top of the curve is exceeded
during a simulation.</p>
<p>METHOD B sets the top level in HQ curve to be that of the highest cell
elevation, and issues <a href="https://wiki.tuflow.com/TUFLOW_Message_2365">WARNING 2365</a> if the top of the curve is exceeded
during the simulation. If the elevation range of the curve is less than
one metre, the top elevation is raised to 1 metre above the lowest 2D
cell. Alternatively the 2d_bc d attribute (refer to Table <a href="#tab:tab-ConditionsAttribute">78</a>) can be used to
specify the max depth to be used for generating the curve (if less than
1m it is set to 1m).</p>
METHOD C (the default) automatically removes consecutive flow values in
automatic 2D HQ boundary tables. For existing models that run with an
automatic 2D HQ boundary, if the change in consecutive flow values is
less than 0.00001 the results may be very slightly affected by this
change. Use of Method B provides backward compatibility if this is an
issue.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHRGridOutputCellSize"><tcmd>HR Grid Output Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ &lt;distance&gt; ]</distance></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
Sets the map output resolution for high resolution grid outputs (Section <a href="#HRGrid-4"><strong>??</strong></a>). If this command is not defined, the default HR Grid Output Cell Size is set based on the distance between SGS points.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHRGridOutputUseFaceElevations"><tcmd>HR Grid Output Use Face Elevations </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
<p>When modelling breaklines in TUFLOW, “thin” breaklines modify the cell face elevations but do not modify the cell storages. When outputting high-resolution outputs (Section <a href="#HRGrid-4"><strong>??</strong></a>) this command sets whether the cell face elevations are used.</p>
<ul>
<li>ON (default): face elevations are used.</li>
<li>OFF: face elevations are not used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHRInterpolationApproach"><tcmd>HR Interpolation Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | Method B | Method C ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
SGS Only.
Sets the HR interpolation approach method. The HR output needs to interpolate cell centre water levels to cell corners. However, the interpolation methods for the standard output (<tcmd><a href="#tcfMapOutputCornerInterpolation">Map Output Corner Interpolation</a></tcmd> <teq>==</teq> <tblk>Method C</tblk>) can produce “bumpy” HR water level output in direct rainfall models with steep terrain, as the water level is linearly interpolated from the cell centres/corners, while the change of sub-grid elevations may not be linear.</li>
</ul>
<p>The following approaches are available for the HR output interpolation:</p>
<ul>
<li>Method A is the default option that applies the same water level interpolation method used for the standard output.</li>
<li>Method B performs sheet flow checks at cell faces and ignores the water level from the upstream cell.</li>
<li>Method C applies the same sheet flow checks as the Method B. In addition, it also uses the number of wet SGS sampled points as a weighting that biases non-sheet flow cells that further improves the mapping to in-stream water levels.</li>
</ul>
See Section <a href="#high-resolution-outputs"><strong>??</strong></a> and the <a href="https://wiki.tuflow.com/TUFLOW_HR_Output">High-Resolution Output TUFLOW Wiki page</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHRThinZLineOutputAdjustment"><tcmd>HR Thin Z Line Output Adjustment </tcmd><teq>==<br></teq></a> <tblk>[ OFF  | {ON CELL SIDES} | ON ALIGNMENT ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
<p>Sets the Z Line Output Adjustment at thin breaklines for HR Outputs (Section <a href="#HRGrid-4"><strong>??</strong></a>). The three options provided are:</p>
<ul>
<li>OFF: Thin breaklines do not affect the HR raster interpolation</li>
<li>ON CELL SIDES (default): This prevents interpolation across cell sides that have thin breaklines.</li>
<li>ON ALIGNMENT: The location of the breakline within the TUFLOW cell resolution is stored and stops interpolation occurring over this topographic barrier.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHXForceWeirEquation"><tcmd>HX Force Weir Equation </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
When set to ON, forces the weir flow equation to be applied across all
active HX cell sides when the flow is upstream controlled (the default
is OFF). This command lowers the HX cell centre elevation by 0.002m
below the lowest active HX cell side elevation to force an adverse
slope. If a value is specified the feature is turned ON and the value is
the amount by which to set the HX cell centre elevation below the lowest
active cell side, for example, <tcmd><a href="#tcfHXForceWeirEquation">HX Force Weir Equation</a></tcmd> <teq>==</teq> <tblk>0.1</tblk> would use 0.1 instead of
0.002. See Section <a href="#CLA-US-Controlled-3"><strong>??</strong></a>.</li>
</ul>
<strong>Note that the default approach uses either weir flow or super-critical
flow when the flow is upstream controlled, depending on whether the
ground surface gradient from HX cell centre to cell side is adverse
(weir flow) or not adverse (super-critical flow). When the flow is
downstream controlled, regardless of the ground surface slope, the full
2D equations are applied including allowance for momentum across the HX
1D/2D link.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfHXZCCheck"><tcmd>HX ZC Check </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>If ON (the default), checks whether the minimum ZC elevation at or along
a HX object (see Table <a href="#tab:tab-twoDBoundary">77</a> and Table <a href="#tab:tab-ConditionsAttribute">78</a>) is above the 1D bed level interpolated between
connected 1D nodes. This is necessary to ensure that there is water in
the nodes when the 2D HX cells start to wet. If the ZC elevation is
lower than the 1D bed level, unexpected flows or a surge of water may
occur into the 2D domain. See Section <a href="#BC-Layers-3"><strong>??</strong></a>.</p>
<p>Using the “Z” flag (see HX in ), the ZC elevation is automatically
raised at each 2D HX cell to slightly above the 1D node bed level. Only
ZC elevations that are below the 1D bed are raised.</p>
<p>The checks and any automatic raising of ZC points includes the <a href="#tcfCellWetDryDepth">Cell
Wet/Dry Depth</a> value so that the ZC elevation is
above the node bed plus the cell wet/dry depth.</p>
If this option is set to OFF, lower ZC elevations are allowed and no
automatic raising of ZC elevations occurs. Turning this check off is not
recommended and may results in mass balance issues.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfIfEvent"><tcmd>If Event </tcmd><teq>==<br></teq></a> <tblk>[  <span class="math inline">\(\langle\)</span> e1 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> e2 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> e3 <span class="math inline">\(\rangle\)</span>  |  … ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls which commands to process for different events, as specified
using the –e run (see Section <a href="#Events-3"><strong>??</strong></a> and Table <a href="#tab:tab-TUFLOWOptions">116</a>) or
<a href="#tcfModelEvents">Model Events</a>.</p>
<p>The “If Event” block must be terminated by “End If”, otherwise an ERROR
occurs.</p>
Optional “Else If Event” and “Else” blocks can be embedded between
“If Event” and “End If”. The first block encountered that refers to a
specified scenario is processed, and all remaining blocks within the “If
Event” to “End If” construct are ignored. If an “Else” block is used it
must occur as the last block (i.e. must occur after any “Else If Event”
blocks) and its commands are only processed if no previous blocks have
been processed.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfIfScenario"><tcmd>If Scenario </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> s1 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> s2 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> s3 <span class="math inline">\(\rangle\)</span>  | … ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls which commands to process for different scenarios, as specified
using the –s run option (see Section <a href="#Scenarios-3"><strong>??</strong></a> and Table <a href="#tab:tab-TUFLOWOptions">116</a>) or <a href="#tcfModelScenarios">Model Scenarios</a>.</p>
<p>The “If Scenario” block must be terminated by “End If”, otherwise an ERROR occurs.</p>
Optional “Else If Scenario” and “Else” blocks can be embedded between
“If Scenario” and “End If”. The first block encountered that refers to a
specified scenario is processed, and all remaining blocks within the “If
Scenario” to “End If” construct are ignored. If an “Else” block is used
it must occur as the last block (i.e. must occur after any “Else If
Scenario” blocks) and its commands are only processed if no previous
blocks have been processed.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfIndex1D2DLinks"><tcmd>Index 1D2D Links </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
A sophisticated indexing system was implemented in release version
2018-03-AA to improve the run times of models with many HX and SX links (see Section <a href="#OneD2dLinking-2"><strong>??</strong></a>.
The improvement in run time is highly dependent on the size of the 2D
domain(s) versus the number of HX and SX connections. It will also be
more noticeable for HPC simulations on high end GPU devices where the
clock time of the 2D computational effort is substantially lower than if
running on a CPU. Improvements in run time vary from around 10% for the
tutorial models to over 4,000% (i.e. over 40 times faster!) for a HPC
model with 30,000 pit SX connections. This feature benefits both Classic
and HPC simulations, and will also benefit links to external 1D schemes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfInputDrive"><tcmd>Input Drive </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> drive_letter <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Changes the drive letter of any input files with a full path specified.
For example “<tcmd>Input Drive</tcmd> <teq>==</teq> <tblk>K</tblk>” changes any input filepaths that have a
drive letter to the K drive. Also see <a href="#tcfOutputDrive">Output Drive</a>. See Section <a href="#Location-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfInsideRegion"><tcmd>Inside Region </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  {METHOD B}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Specifies the method used to assign values to 2D cells or cell mid-sides
that fall within a polygon using commands that process polygons from a GIS layer (e.g. <a href="#tgcReadGISMat">Read GIS Mat</a>).</p>
<p>Method A uses the previous, much slower method, and is provided in case
of backward compatibility issues. Testing thus far has shown the two
methods yield identical results although it is possible that if a 2D
cell centre or mid-side point lies exactly on a polygon boundary
different results may occur.</p>
<p>Method B offers much faster processing than Method A. To appreciate the
increase in start-up time this feature offers, testing on two large
models reduced the start-up time from 20 minutes to 3 minutes for one
model, and from 40 minutes to 5 minutes for the other. The faster
start-up time occurs for any polygon layers being accessed from the .tgc
and .tbc files, particularly those containing large number of vertices.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfInstabilityWaterLevel"><tcmd>Instability Water Level </tcmd><teq>==<br></teq></a> <tblk>[ {see_below}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>The default water level used to detect instabilities higher than the highest cell elevation of all cells (whether wet, dry or
permanently dry). Any unassigned elevations (which are given a value of
99999, are not included). The default value is 10 metres (or 10ft if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).</p>
Alternatively, this command is used to set the instability water level
manually. See Section <a href="#othertroublshooting-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLatitude"><tcmd>Latitude </tcmd><teq>==<br></teq></a> <tblk>[ {0}  |  <span class="math inline">\(\langle\)</span> value_in_degrees_from_equator <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the latitude used for calculating the Coriolis term in the shallow
water equations (Equations <a href="#eq:equ-x-momentum">(35)</a> and <a href="#eq:equ-y-momentum">(36)</a>). A negative value indicates south of the equator. A zero
value disables the Coriolis term. See Section <a href="#CLA-Coriolis-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLayeredFLCDefaultApproach"><tcmd>Layered FLC Default Approach </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  {METHOD B}  |  METHOD C  |  METHOD D ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to specify the settings for layered flow constrictions (see Section <a href="#lfcsh-4"><strong>??</strong></a>). The default setting is METHOD B (PORTION). For releases prior to 2016-03 METHOD A (CUMULATE) was used.</p>
<p>It is possible to individually specify the method to be used for each structure. Specify either METHOD A (CUMULATE), METHOD B (PORTION) or METHOD C in the Shape_Options attribute (refer to Table <a href="#tab:tab-LayeredFlow">67</a>). If none of the options occur, the setting as specified in the command <a href="#tcfLayeredFLCDefaultApproach">Layered FLC Default Approach</a> is used.</p>
<ul>
<li>METHOD A (named CUMULATE in releases prior to 2020-10): Accumulates losses through each of the layers in the 2d_lfcsh as the depth of water increases.</li>
<li>METHOD B (named PORTION in releases prior to 2020-10) – the default: Proportions the losses through each of the layers in the 2d_lfcsh based on the depth of water.</li>
<li>METHOD C: Combines the METHOD A and METHOD B approaches by utilising METHOD A through to the top of Layer 3 and METHOD B above Layer 3.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLineCellSelection"><tcmd>Line Cell Selection </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  METHOD C  |  {METHOD D}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary></li>
</ul>
<p>Sets the method for selecting 2D cells along lines in GIS layers.</p>
<p>Method A (used prior to Build 2006-06-AA) is the original method and is provided for backward compatibility.</p>
<p>Method C (the default up until Build 2007-04-AC), uses the cell “cross-hair” approach where a cell is only selected if the line intersects imaginary “cross-hairs” that extend from cell mid-sides to
cell mid-sides.</p>
<p>Method D (the default) selects cells using the same approach as for
Method C, however differs in that it uses a more advanced approach for
assigning interpolation weightings of 1D node water levels based on the
perpendicular intersection of the 2D cell centre with the boundary line
(similar to that used for Z Lines). This provides a “smoother” water
surface profile along HX lines, offers better stability along 1D/2D HX
interfaces, and is the recommended approach.</p>
<p>Method C and Method D are particularly useful along HX lines that
follow, for example, the top of a levee or flood defence wall, as it
ensures that the same cells selected along the 1D/2D interface are those
raised by the Z line.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLink2D2DAdjustVelocityHead"><tcmd>Link 2D2D Adjust Velocity Head </tcmd><teq>==<br></teq></a> <tblk>[ [{0}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the proportion of the velocity head by which to adjust the water
levels along the 2D link line. A value of zero applies no adjustment
whilst a value of 1.0 adjusts (downwards) the level by V<sup>2</sup>/2g.
The default is 0.0 (no adjustment). Some tidal models demonstrated
improved performance by setting to 1.0, however, where there is rapid
changes in velocities along a 2D link line, for example in an urban
situation where velocities vary considerably from road to garden to
between buildings, this feature may not improve the 2D link performance,
therefore sensitivity test before adopting. See Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLink2D2DApproach"><tcmd>Link 2D2D Approach </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  METHOD B  |  METHOD C  |  {Method D} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Command used to determine the approach used to link multiple 2D domains. See Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.</p>
<p>Method A is the original 2D2D link approach introduced for the 2009-07
release. This command and Method B was also incorporated into the
2009-07 release.</p>
<p>Method B (also introduced for the 2009-07 release) was an improvement
over Method A which was prone to generating flows where the 2D2D link
was located along dry boundaries with “bumpy” topography. Method B is
preferred over Method A.</p>
<p>Method C (introduced for the 2012-05 release) is the same as Method B,
but allocates the storage of the 2D link cells (these cells do not
contribute to the model’s storage so the storage is assigned to the
hidden nodes) more evenly between the hidden nodes and ensures the
nodes’ bed elevation is at or below the lowest connected 2D link cell.</p>
Method D (the default) includes significant enhancements to the 2D/2D
linking of different 2D domains. It is recommended that models utilising
2D/2D linking upgrade to Build 2013-12-AC or later where possible to
make use of these enhancements. For backwards compatibility, specify
<tcmd><a href="#tcfLink2D2DApproach">Link 2D2D Approach</a></tcmd> <teq>==</teq> <tblk>Method B</tblk>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLink2D2DDistributeFlow"><tcmd>Link 2D2D Distribute Flow </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Improves the distribution of flow between 2D cells along 2d_bc 2D link
lines. The default is ON. For 2D/2D linking methods prior to Method D
OFF applies. See Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLink2D2DGlobalStabilityFactor"><tcmd>Link 2D2D Global Stability Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.0}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Will globally factor all 2D link hidden 1D node storages to easily carry
out a quick sensitivity test on the effect of increasing the storage of
the hidden 1D nodes or to globally improve stability along 2D link lines
if needed. The default value is 1.0. Usually, increasing the storage of
the hidden 1D nodes by up to around a factor of 5 has only a slight
effect on results. Note that any factor specified using the 2d_bc “a”
attribute is also applied on top of this factor. Also note that the
default value for the 2d_bc “a” attribute using Method D is 1.0 (prior
methods use 2.0). See Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfLogFolder"><tcmd>Log Folder </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> folder <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Redirects the .tlf and _messages file output to the specified
folder. Typically used to write these files to a folder named log under
the runs folder. For more information, see Section <a href="#SimLogFiles-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapCutoffDepth"><tcmd>Map Cutoff Depth </tcmd><teq>==<br></teq></a> <tblk>[ {0.0}  |  <span class="math inline">\(\langle\)</span> value_in_m <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The minimum depth used as the cutoff that TUFLOW outputs results. Results are only written for cells with depths above the cutoff depth. This feature is particularly useful for direct rainfall modelling where there is a need to differentiate between very shallow sheet flow and flooding. See Section <a href="#Commands-2"><strong>??</strong></a>. The value is in metres (greater than zero), or feet (if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapCutoffSGS"><tcmd>Map Cutoff SGS  </tcmd><teq>==<br></teq></a> <tblk>[ Average  |  {Exact}  |  Median  |  Minimum  |  Percentile ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Use <a href="#tcfSGSDepthOutput">SGS Depth Output</a> instead. Expand to find out more about the legacy settings.
</summary>
<p>SGS Only.</p>
<p>Used to control the elevation below which cells are shown as “dry” in the map output.</p>
<ul>
<li>Average: uses the mean elevation for the cell.</li>
<li>Exact (default): uses the elevation at the exact location of the cell centre. I.e. the elevation that would be sampled if SGS was not used.</li>
<li>Median: uses the median (50th percentile) elevation for the cell.</li>
<li>Minimum: uses the minimum elevation for the cell.<br />
</li>
<li>Percentile: define the cutoff elevation based on a user specified set percentile. This requires a second argument, separated by vertical bar “|”, which is the percentile to use. For example, “<tcmd><a href="#tcfMapCutoffSGS">Map Cutoff SGS</a></tcmd> <teq>==</teq> <tblk>Percentile | 25</tblk>” will use the 25th percentile of the SGS elevations sampled within the cell.</li>
</ul>
<p>For the average, exact, median, and minimum options, a optional second argument can be specified which is the depth above the datum. For example, “<tcmd><a href="#tcfMapCutoffSGS">Map Cutoff SGS</a></tcmd> <teq>==</teq> <tblk>Average | 0.05</tblk>” will use an elevation 0.05m above the average SGS elevation sampled for the cell.</p>
<p>A combination of <a href="#tcfMapCutoffDepth">Map Cutoff Depth</a> and <a href="#tcfMapCutoffSGS">Map Cutoff SGS</a> can be used in conjunction, with the higher elevation used. When SGS is on, the Map Cutoff Depth refers to a depth above the cell minimum elevation. For example:</p>
<p><tcmd><a href="#tcfMapCutoffDepth">Map Cutoff Depth</a></tcmd> <teq>==</teq> <tblk>0.05</tblk></p>
<p><tcmd><a href="#tcfMapCutoffSGS">Map Cutoff SGS</a></tcmd> <teq>==</teq> <tblk>Percentile | 25</tblk></p>
<p>Will use the maximum of 0.05m above the lowest SGS sampled elevation, or the 25th percentile of the SGS elevations sampled within the cell.</p>
<p>The elevation used for setting whether a cell is wet or dry in the map output, is reported in the _grd_check file as the “Z_Map_Cutoff”. This is the SGS Depth Output elevation for each cell plus the map cutoff depth.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapCutoffVector"><tcmd>Map Cutoff Vector </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Default value recommended.</p>
<p>When using <a href="#tcfMapCutoffDepth">Map Cutoff Depth</a> with mesh-based output files (XMDF, DAT), the display of scalar and vector outputs at each mesh is controlled by a 0/1 flag, which is set as 0 if the local depth is below the cutoff depth. This flag disables the vector display in SMS however does not in other GIS programs (e.g. QGIS release version 3.14), and thus the velocity vectors could display everywhere for a global rainfall model even if the <a href="#tcfMapCutoffDepth">Map Cutoff Depth</a> command is specified.</p>
The “ON” option (default) enables the map cutoff depth and sets the vector output value as zero if the cell water depth is below the cutoff depth.
“OFF” option can be used for backward compatibility.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapOutputCornerInterpolation"><tcmd>Map Output Corner Interpolation </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  METHOD B  |  {METHOD C}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>This command determines the approach taken to extrapolate model results
to the cell corners at the wet/dry interface.</p>
<p>Method A (the approach adopted prior to the 2013-12 release) was the
original routine where some issues were found with tracking the maximum
depth related outputs, particularly on steep slopes, at the wet/dry
interface where the depth extrapolated to the cell corners was
exaggerated as it was extrapolated horizontally.</p>
<p>Method B and Method C resolve the issues found in Method A. Method B
will provide slightly better output along thin breaklines where they are
dry or free-overfalling occurs, however, Method C provides the most
consistent extrapolation to cell corners in terms of tracking maximum
values at the wet/dry interface on steep slopes and is the recommended
approach and default setting.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapOutputDataTypes"><tcmd>Map Output Data Types </tcmd><teq>==<br></teq></a> <tblk>[ {h V}  |  <span class="math inline">\(\langle\)</span> data_types <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Defines the data types to be output. Refer to and for a description of
available options. The data types may be specified in any order or
combination and are not case sensitive. Spaces between data types are
optional, however are strongly recommended to ensure there is no
misunderstanding.</p>
<p>For example to output water levels, velocities and unit flow enter the
following line:</p>
<p><tcmd>Map Output Data Types</tcmd> <teq>==</teq> <tblk>h V q</tblk></p>
<p>The default is:</p>
<p><tcmd>Map Output Data Types</tcmd> <teq>==</teq> <tblk>h V</tblk></p>
<p>The format(s) of the map output is controlled by the .tcf command <a href="#tcfMapOutputFormat">Map
Output Format</a> (refer to Section <a href="#Format-3"><strong>??</strong></a> for
further information). Note that not all <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a> are available for all formats due to
limitations or constraints of the format.</p>
<p>This command may also be defined for different output formats by
including the output format extension on the left of the command (refer
to Section <a href="#DataTypes-3"><strong>??</strong></a>). For example, to write the XMDF Map Output Data
Types H and D use:</p>
<p><tcmd>XMDF Map Output Data Types</tcmd> <teq>==</teq> <tblk>h d</tblk></p>
<p>This output format specific functionality is also available for commands
<a href="#tcfStartMapOutput">Start Map Output</a>, <a href="#tcfEndMapOutput">End Map
Output</a> and <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
This command can be used within an Output Zone definition block to
change the setting from that for the entire model map output.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapOutputEntireModel"><tcmd>Map Output Entire Model </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The default is to produce map output for the whole model irrespective of
the number of Output Zones (refer to Section <a href="#OutputZones-3"><strong>??</strong></a>) being
written. Map output commands that occur outside Output Zone definitions
apply to the entire model (i.e. as is the case in previous releases). If
map output for the entire model is not required specify <tcmd><a href="#tcfMapOutputEntireModel">Map Output Entire Model</a></tcmd> <teq>==</teq> <tblk>OFF</tblk>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapOutputFormat"><tcmd>Map Output Format </tcmd><teq>==<br></teq></a> <tblk>[ {XMDF}  |  <span class="math inline">\(\langle\)</span> formats <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the format(s) for TUFLOW map output.</p>
<p>The default setting for the 2023-03 release is the XMDF format. The available output formats are listed in Section <a href="#Format-3"><strong>??</strong></a>. For example, to output formats in XMDF and TIF formats specify:</p>
<p><tcmd>Map Output Format</tcmd> <teq>==</teq> <tblk>XMDF TIF</tblk></p>
<p>This command can be used within a <a href="#tcfDefineOutputZone">Define Output Zone</a> block to change the setting from that for the entire model map output to be different for the output zone.</p>
<p>There is no limit (other than disk space!) on the number of formats specified per model simulation. Output format specific commands (<a href="#tcfMapOutputInterval">Map Output Interval</a>, <a href="#tcfStartMapOutput">Start Map Output</a>, <a href="#tcfEndMapOutput">End Map Output</a> and <a href="#tcfMapOutputDataTypes">Map Output Data Types</a>) can then be used to customise each format type as per the examples below. Refer to Section <a href="#DataTypes-3"><strong>??</strong></a>.</p>
<p>For example, to set the <a href="#tcfMapOutputInterval">Map Output Interval</a> for XMDF output to 6 minutes specify:</p>
<p><tcmd>XMDF Map Output Interval</tcmd> <teq>==</teq> <tblk>360</tblk></p>
<p>Or to only output depths (d) and Bed Shear Stress (BSS) in TIF format specify:</p>
<tcmd>TIF Map Output Data Types</tcmd> <teq>==</teq> <tblk>d BSS</tblk>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMapOutputInterval"><tcmd>Map Output Interval </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The output interval in seconds for map based output. If the command is
omitted, an <a href="https://wiki.tuflow.com/TUFLOW_Message_0045">ERROR 0045</a> is output.</p>
<p>If set to zero (0) no time based map output is produced, and only the
maximums are written (note tracking of maximums must be switched on –
see command <a href="#tcfMaximumsandMinimums">Maximums and Minimums</a>).</p>
<p>This command can be defined for different output formats by including
the output format extension on the left of the command. For example, to
set the Map Output Interval for XMDF output to 6 minutes use:</p>
<p><tcmd>XMDF Map Output Interval</tcmd> <teq>==</teq> <tblk>360</tblk></p>
<p>If only the maximums in TIF format are required, use:</p>
<p><tcmd>TIF Map Output Interval</tcmd> <teq>==</teq> <tblk>0</tblk></p>
<p>This output format specific functionality is also available for commands
<a href="#tcfStartMapOutput">Start Map Output</a>, <a href="#tcfEndMapOutput">End Map
Output</a> and <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a>. Refer to Section <a href="#Map-2"><strong>??</strong></a>.</p>
This command can be used within an Output Zone definition block to
change the setting from that for the entire model map output.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMassBalanceCorrector"><tcmd>Mass Balance Corrector </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>No longer required or recommended for use subsequent to implementation of <tcmd>Wetting and Drying</tcmd> <teq>==</teq> <tblk>ON METHOD B</tblk>. See the <a href="https://www.tuflow.com/Download/TUFLOW/Manuals/TUFLOW%20Manual.2010-10-AB.docx">TUFLOW 2010 Manual</a> for details of command.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMassBalanceOutput"><tcmd>Mass Balance Output </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>If set to ON (the default), outputs the following:</p>
<ul>
<li>_MB.csv and _MB2D.csv files in the .tcf <a href="#tcfOutputFolder">Output
Folder</a> and _MB1D.csv in the .ecf <a href="#ecfOutputFolder">Output
Folder</a>. These files contain mass balance
calculations for the overall model, 1D domains and 2D domains at each
time a line is displayed to the Console Window.<br />
</li>
<li>_MB1 map output for 2D domains only and if specified by <a href="#tcfMapOutputDataTypes">Map Output
Data Types</a>.<br />
</li>
<li>_TSMB and _TSMB1d2d GIS layers in the .ecf <a href="#ecfOutputFolder">Output
Folder</a>. These files contain summary and time based
information on mass errors occurring at all 1D nodes and at 1D nodes
connected to 2D HX links.</li>
</ul>
<p>It is possible to use different timesteps for the mass balance outputs
and those shown on the Console Window. The command <a href="#tcfMassBalanceOutputInterval">Mass Balance Output
Interval</a> is used for setting the
interval in the mass balance outputs whilst <a href="#tcfScreenLogDisplayInterval">Screen/Log Display
Interval</a> sets the interval for the
Console Window. A summary is included at the end of the simulation on
the display console and .tlf file of key model performance indicators
(see Section <a href="#TUFLOWQAIndicators-3"><strong>??</strong></a>).</p>
<p>Setting to OFF does not produce any mass balance information to the
Console Window or data files, and will reduce run-times.</p>
For more information, see Section <a href="#MB-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMassBalanceOutputInterval"><tcmd>Mass Balance Output Interval </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The output interval in seconds for the _MB.csv output files. See Section <a href="#MB-2"><strong>??</strong></a>. If set to
0 (zero), the output interval used is the timestep set by the <a href="#tcfTimestep">Timestep</a> command. If the command is omitted (or set to -1), output is at the lesser of
<a href="#tcfMapOutputInterval">Map Output Interval</a> and <a href="#tcfTimeSeriesOutputInterval">Time Series Output
Interval</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximum1DChannels"><tcmd>Maximum 1D Channels </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mchan <span class="math inline">\(\rangle\)</span>  |  {100000} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Only used during the first pass through the model input files to allocate temporary space. After this pass, the only memory required is for the actual number of channels allocated. The default is 100,000, but can now be increased (or decreased) if required. The upper limit on the number of nodes is set to twice the number of channels. See Section <a href="#Channel-Intro-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaxCourantNumber"><tcmd>Maximum Courant Number </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Cr_max <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>The command is only available for 2D only models.</p>
<p>The <a href="#tcfTimestep">Timestep</a> command is only used to set the initial
timestep if &lt;cr_max&gt; is greater than zero. It is possible to control
the maximum rate at which a timestep can increase by using the command
<a href="#tcfTimestepMaxIncrease">Timestep Maximum Increase</a>. There is no limit to
how quickly the timestep can decrease.</p>
<p>For 2D only models (not supported for 1D/2D linked models or hidden 1D)</p>
</cr_max>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumPoints"><tcmd>Maximum Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mp <span class="math inline">\(\rangle\)</span>  |  {500000}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the maximum number of elevation points that can exist in a GIS
layer referenced by commands such as <a href="#tgcCreateTINZpts">Create TIN
Zpts</a>, <a href="#tgcReadGISZLine">Read GIS Z Line</a>, <a href="#tgcReadGISZHXLine">Read GIS
Z HX Line</a>, <a href="#tgcReadGISZShape">Read GIS Z Shape</a>,
<a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a>, <a href="#tgcReadGISFCShape">Read GIS FC
Shape</a> and <a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC
Shape</a>. If the number of points exceeds the
amount specified, an ERROR occurs and this command needs to be used to
increase the maximum number of points. This value can also be lowered to
reduce RAM requirements. See Section <a href="#elevations-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumVelocityCutoffDepth"><tcmd>Maximum Velocity Cutoff Depth </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> y <span class="math inline">\(\rangle\)</span>  |  {0.1}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This command sets the depth above which the maximum velocity is tracked
as the maximum velocity, rather than the velocity at the peak water
level. See Section <a href="#DataTypes-3"><strong>??</strong></a>.</p>
<ul>
<li>If set to a large number that exceeds the greatest depth (e.g.
99999.), the maximum velocity will be as in releases prior to 2009-07,
(i.e.. based on the velocity at the peak water level).<br />
</li>
<li>If set to 0. (zero), the maximum velocity is tracked as the maximum
velocity irrespective of the velocity at the peak water level.<br />
</li>
<li>If &lt;y&gt; is set to a value greater than zero, the maximum velocity is
based on the velocity at the peak water level for depths below &lt;y&gt;,
while for depths above &lt;y&gt;, the maximum velocity is based on the
maximum velocity.</li>
</ul>
<p>A small value of &lt;y&gt; (e.g. 0.1m which is the default) is recommended,
as high velocities can occur at very shallow depths during the wetting
and drying process.</p>
Note, as a consequence of the velocities now being tracked independently
of the maximum water level (i.e. the maximum water level and maximum
velocity can occur at different times), the maximum unit flow (q) and
energy (E) were disabled. </y></y></y></y>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumVertices"><tcmd>Maximum Vertices </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mp <span class="math inline">\(\rangle\)</span>  |  {100000}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the maximum number of vertices that can exist in a single polyline or polygon in a GIS layer referenced by commands such as <a href="#tgcCreateTINZpts">Create TIN Zpts</a>, <a href="#tgcReadGISZShape">Read
GIS Z Shape</a>, <a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a>, <a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a>, <a href="#tgcReadGISZLine">Read GIS Z Line</a>, <a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a> and <a href="#tgcReadGISFCShape">Read GIS FC Shape</a>. See Section <a href="#elevations-3"><strong>??</strong></a> and Section <a href="#lfcsh-4"><strong>??</strong></a>. If the number
of vertices exceeds the amount specified, an ERROR occurs and this
command needs to be used to increase the maximum number of vertices.
This value can also be lowered to reduce RAM requirements.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumsandMinimums"><tcmd>Maximums and Minimums </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  OFF  |  {ON MAXIMUMS ONLY}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets whether maximums and/or minimums are to be tracked and written as
map output (see Section <a href="#Map-2"><strong>??</strong></a>). The default setting for this command is ON MAXIMUMS ONLY. To
suppress tracking and outputting of maximums for map output set to OFF.</p>
<p>If set to ON or ON MAXIMUMS ONLY, additional information will be
displayed to the Console Window and .tlf file for each <a href="#tcfScreenLogDisplayInterval">Screen/Log
Display Interval</a>. Three numbers are
displayed after “Mx” at the end of each line. The first two numbers are
the percentage of 1D nodes and percentage of 2D cells that reached a new
maximum in the last computational timestep. The third number is the time
in decimal hours since no new maximum was recorded anywhere within the
model. For example, “Mx 10 21 0.0” indicates that 10% of 1D nodes and
21% of 2D cells recorded a new maximum last timestep, and the time since
the last recorded maximum is zero. Once all 1D nodes and 2D cells have
reached their maximums the third (time) value will increase above zero.</p>
This command can be used within an Output Zone definition block to
change the setting from that for the entire model map output.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumsandMinimumsOnlyforGrids"><tcmd>Maximums and Minimums Only for Grids </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Writes only the maximum and minimum grids for specified <a href="#tcfMapOutputDataTypes">Map Output Data Types</a> at the end of a simulation. This command only applies if the “Grid”, “TIF”, “FLT”, and/or “ASC” option is specified for the command <a href="#tcfMapOutputFormat">Map Output Format</a>.</p>
<p>This command is provided for backward compatibility. The preferable command is to use the output format specific functionality <tcmd><a href="#tcfMapOutputInterval">&lt;format&gt; Map Output Interval</a></format></tcmd> <teq>==</teq> <tblk>0</tblk> to output the maximums
only for a specific format type. Refer to Section <a href="#Grid-4"><strong>??</strong></a>.</p>
<p>This command can be used within an Output Zone definition block to change the setting from that for the entire model map output.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumsandMinimumsTimeSeries"><tcmd>Maximums and Minimums Time Series </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON, allows for tracking of maximums and minimums at every timestep for PO and LP outputs. See Section <a href="#TwoDTS-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumsApproach"><tcmd>Maximums Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  |  {Method B}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>This command specifies the approach taken in tracking the maximums for
map outputs.</p>
<p>Method A is the original approach and only provided for backward
compatibility for legacy models.</p>
<p>Method B (the default) introduced for Build 2012-05-AC, fixes a bug that
would not correctly track the maximums if both cell cornered map output
(.xmdf and .dat formats) and the GRID (ASCII grid) output were both
specified. As a consequence of this bug, the approach for tracking
cell-centred output maximum water levels is now used by default for both
cell-centred and cell corner output formats. This may cause a very
slight lowering of maximum water levels (usually a mm or less) in
isolated locations.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumsStartTrackTime"><tcmd>Maximums Start Track Time </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time in hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>If tracking of maximums is enabled (the default), this command can be
used to set a start time for tracking the maximums. For example, if a
model starts at 0 hours, and the user only wants to track maximums after
24 hours of model warmup, <tcmd>Maximums Start Track Time</tcmd> <teq>==</teq> <tblk>24</tblk> can be used. See Section <a href="#Map-2"><strong>??</strong></a>.</p>
This command needs to be used in conjunction with the <a href="#tcfStartMapOutput"><u>&lt;format&gt; Start</format></u> Map Output</a> command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMaximumsTrackTime"><tcmd>Maximums Track Time </tcmd><teq>==<br></teq></a> <tblk>[ {OFF}  |  ON | OFF Completely | Velocity ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Set to “ON” to enable the tracking of time of maximums for any specified hazard outputs, as well as Bed Shear Stress (BSS), Stream Power (SP) and Energy (E).</p>
<p>Set to “OFF” (the default), to track maximum values, but not the time of maximum. This command does not apply to water level output; time of maximum H “Tmax_h” continues to be tracked.</p>
<p>Set to “OFF Completely” to disable the “Tmax_h” output.</p>
<p>TUFLOW Classic Only: Set to “Velocity” to enable the “Tmax_V” output.</p>
See Section <a href="#Map-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMeshparts"><tcmd>Meshparts </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>If set to ON, the SMS mesh .2dm file is split up into different
meshparts. Meshparts are determined as follows:</p>
<ul>
<li>Each 2D domain constitutes one meshpart.<br />
</li>
<li>Each 1d_nwk layer constitutes one meshpart.</li>
</ul>
<p>The benefits of using meshparts are that for recent versions of SMS,
while viewing results different meshparts can be switched on and off.
Can also be useful when using the <a href="https://wiki.tuflow.com/TUFLOW_to_GIS">TUFLOW_to_GIS.exe utility</a> to remove meshparts from the output. An example is to remove the pipe network layer WLLs from the output.</p>
<p>The name allocated to the meshpart is either the 2D Domain Name (see
<a href="#tcfStart2DDomain">Start 2D Domain</a>) or the 1d_nwk layer name. The
meshpart names can be clarified by opening the .2dm file in a text
editor and searching for the “MESHPART” keyword.</p>
See Section <a href="#Commands-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMIProjection"><tcmd>MI Projection </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .mif file <span class="math inline">\(\rangle\)</span>  |  Projection_line_from_MIF_file <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the geographic projection for all GIS input and output in MID/MIF format (see Section <a href="#GISFormats-3"><strong>??</strong></a>). If this command is omitted, TUFLOW searches for a file
“Header.mif” in each folder it opens GIS files, and extracts the projection from this file. The “Header.mif” file is any GIS layer in the
correct projection exported in MID/MIF format. If no “Header.mif” file is found, non-earth coordinates are assumed.</p>
If a model has a mixture of .gpkg, .shp and .mif files as input, then the projection must be specified for each (e.g. using <a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> and <a href="#tcfMIProjection">MI
Projection</a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfMIProjectionIgnoreBounds"><tcmd>MI Projection Check Ignore Bounds  </tcmd><teq>==<br></teq></a> <tblk>[ {OFF}  |  ON  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This sets whether to ignore the MapInfo projection Bounds when the MIF projection check is processed (see Section <a href="#GISFormats-3"><strong>??</strong></a>).</p>
<p>If a MapInfo Projection has been specified using the <a href="#tcfMIProjection">MI Projection</a> command, TUFLOW checks the projection of the input files against the specified projection. If there is a
discrepancy an ERROR is generated, see <a href="#tcfGISProjectionCheck">GIS Projection
Check</a> to change this from an error to a warning
message.</p>
<p>Internally, when TUFLOW compares the projection of the incoming file
against the specified model project, it removes spaces, tabs and quotes
before checking to see if they match. This can occasionally cause issues
as different software may store the projection bounds differently
(causing an ERROR to be generated). For example, the projection line in
a MapInfo text file may look something like the below:</p>
<p>CoordSys Earth Projection 8, 104, “m”, 177, 0, 0.9996, 500000, 10000000
Bounds (-7500000.0, 2000.0) (8800000.0, 20000000.0).</p>
<p>The portion of this projection line to the left of the “Bounds” command
defines the parameters of the projection, the portion of to the right of
the “Bounds” defines a rectangle in which the coordinate system is
valid. Some GIS software will write these bounds differently for
different layers within the same projection. For example, the two
projections below are identical, though with slightly different
projections bounds:</p>
<p>CoordSys Earth Projection 8, 104, “m”, 177, 0, 0.9996, 500000, 10000000
Bounds (-7500000.0, 2000.0) (8800000.0, 20000000.0).</p>
<p>CoordSys Earth Projection 8, 104, “m”, 177, 0, 0.9996, 500000, 10000000
Bounds (-7499999.0, 2000.0) (8800000.0, 20000000.0).</p>
When not using the ignore bounds option, the differences in the
projection lines above would cause the model to stop, if ignoring bounds
the model would continue. The command “<tcmd><a href="#tcfGISProjectionCheck">GIS Projection Check</a></tcmd> <teq>==</teq> <tblk>{ERROR} | WARNING</tblk>” can be used to control whether TUFLOW will halt the
simulation with an error or give a warning and continue the simulation
if there is mis-match in the projection of the GIS file and the
projection of the model.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelEvents"><tcmd>Model Events </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> e1 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> e2 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> e3 <span class="math inline">\(\rangle\)</span>… ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Alternative to using the –e option when running TUFLOW (see Table <a href="#tab:tab-TUFLOWOptions">116</a>). Up to nine (9) separate events that have been defined using <a href="#tefDefineEvent">Define Event</a> can be specified. Separate the event names using vertical bars. The event names specified will be automatically appended to the output filenames if ~e~ or ~eX~ are not in the .tcf filename.</p>
<p>For example:</p>
<p><tcmd>Model Events </tcmd><teq>==</teq><tblk> Q100 | 02h</tblk></p>
Note that using the –e run option will override this command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelOutputZones"><tcmd>Model Output Zones </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> oz_name_1 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> oz_name_2 <span class="math inline">\(\rangle\)</span>  |  ….. ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls which outputs zones are to be used. If this command is omitted,
no output from Output Zones will be written. Separate multiple Output
Zones using a “|”. For example, to output from zones ZoneA and ZoneC
specify:</p>
<p><tcmd>Model Output Zones</tcmd> <teq>==</teq> <tblk>ZoneA | ZoneC</tblk></p>
See Section <a href="#OutputZones-3"><strong>??</strong></a> and the .tcf command <a href="#tcfDefineOutputZone">Define Output
Zone</a> for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelPlatform"><tcmd>Model Platform </tcmd><teq>==<br></teq></a> <tblk>[ w32  |  w64  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Forces the .tcf file to only be run using either a 32-bit (w32) or
64-bit (w64) version. If the command is not specified, the model may be
run in either version. If the w32 version of TUFLOW is specified, and
the w64 version is used, the simulation stops with an error. Similarly,
if w64 is specified, the simulation stops if the w32 version is used.
For further discussion see Section <a href="#InstallOverview-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelPrecision"><tcmd>Model Precision </tcmd><teq>==<br></teq></a> <tblk>[ SINGLE  |  DOUBLE  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to force a model to use either the single or double precision
version of TUFLOW. If the command is not specified, the model may be run
in either version. If SINGLE is specified, and the double precision
version of TUFLOW is used, the simulation stops with an error.
Similarly, if DOUBLE is specified, the simulation stops if the single
precision version is used. For further discussion see Section
<a href="#iSPdSP-3"><strong>??</strong></a>.</p>
This command is useful for ensuring that the same (single or double)
version of TUFLOW is always used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelScenarios"><tcmd>Model Scenarios </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> s1 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> s2 <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> s3 <span class="math inline">\(\rangle\)</span>  |  … ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Alternative to using the –s option when running TUFLOW (see Table <a href="#tab:tab-TUFLOWOptions">116</a>). Up to nine (9) separate scenarios that occur using <a href="#tcfIfScenario">If
Scenario</a> can be specified. Separate the scenarios names
using vertical bars. The scenario names specified will be automatically
appended to the output filenames if ~s~ or ~sX~ are not in the .tcf
filename.</p>
<p>For example:</p>
<p><tcmd>Model Scenarios</tcmd> <teq>==</teq> <tblk>opA | opB</tblk></p>
Note that using the –s run option will override this command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelTUFLOWBuild"><tcmd>Model TUFLOW Build </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> build <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Forces the .tcf file to only be run using the specified build of TUFLOW. See Section <a href="#InstallOverview-3"><strong>??</strong></a>.
&lt;build&gt; must be identical to that displayed in the .tlf file or when
double clicking TUFLOW.exe. The simulation stops with an error if the
specified build is different to that used to run the model.</p>
<p>For example:</p>
<tcmd>Model TUFLOW Build</tcmd> <teq>==</teq> <tblk>2010-10-AA-iSP-w64</tblk><br />
<tcmd>Model TUFLOW Build</tcmd> <teq>==</teq> <tblk>2007-07-DB</tblk> </build>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfModelTUFLOWRelease"><tcmd>Model TUFLOW Release </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> release <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Forces the .tcf file to only be run using a build from a specified release of TUFLOW. See Section <a href="#InstallOverview-3"><strong>??</strong></a>.</p>
<p>The specified release must be one of the following options:</p>
<ul>
<li>2006-06</li>
<li>2007-07</li>
<li>2008-08</li>
<li>2009-07</li>
<li>2010-09</li>
<li>2010-10</li>
<li>2011-09</li>
<li>2012-05</li>
<li>2013-12</li>
<li>2016-03</li>
<li>2017-09</li>
<li>2018-03</li>
<li>2020-01</li>
<li>2020-10</li>
<li>2023-03
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNegativeDepthApproach"><tcmd>Negative Depth Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  |  {Method B}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary></li>
</ul>
<p>Method A represents the case of no special treatment of negative depths.</p>
<p>Method B (the default) provides an improved performance in handling
negative depths (which are a consequence of a non-convergence of the
solution). It is only applied if a cell experiences a depth below zero
at its centre. If the flow across any of the four cell sides is
extracting water from the cell, a high friction is temporarily applied
to that side and the high friction is reduced back to normal within
several timesteps. This tends to stop a cell repeatedly experiencing a
negative depth, which can cause mass errors. The negative depth problem
can be particularly acute where there is very steep (supercritical) flow
with high velocities, combined with some cell sides attempting to switch
into weir flow.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNetCDFOutputCompression"><tcmd>NetCDF Output Compression </tcmd><teq>==<br></teq></a> <tblk>[ OFF  |  {ON}  |  <span class="math inline">\(\langle\)</span> level <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the compression for the output NetCDF file (see Section <a href="#Grid-4"><strong>??</strong></a>). If set to ON (the
default) a compression level of 1 is used. The compression level can
also be set via a number from 1 – 9. Higher levels result in smaller
files but are slower to write/access, with the greater the number the
greater the compression and slower the write/read time. If set to OFF a
NetCDF “classic” format is used without compression. If set to ON a
NetCDF 4 file is used with compression. The compressed version works
well in ArcMap and Matlab but not in QGIS at the time of writing.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNetCDFOutputDirection"><tcmd>NetCDF Output Direction </tcmd><teq>==<br></teq></a> <tblk>[ {ANGLE}  |  BEARING ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
When output in NetCDF raster format (see Section <a href="#Grid-4"><strong>??</strong></a>) any vector outputs (e.g. flow or
velocity) are output as two datasets: magnitude and direction, for
example, magnitude_of_velocity and direction_of_velocity. This command
specifies whether the direction_of NetCDF attribute is in arithmetic (0
degrees east) or geographic (0 degrees north). The default is
arithmetic.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNetCDFOutputFormat"><tcmd>NetCDF Output Format </tcmd><teq>==<br></teq></a> <tblk>[ {Generic}  |  FEWS  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the output format for the NetCDF outputs (see Section <a href="#Grid-4"><strong>??</strong></a>), the outputs are similar
but the FEWS format option outputs the maximum, time of peak, duration
outputs with a time stamp at the beginning of the simulation to ensure
that it loads correctly into FEWS. For the generic output format no
timestep is output with these static datasets. For more information on
the format please see the TUFLOW Wiki page <a href="https://wiki.tuflow.com/TUFLOW_NetCDF_Raster_Output_Format">TUFLOW NetCDF Raster
Format</a>
for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNetCDFOutputStartDate"><tcmd>NetCDF Output Start Date </tcmd><teq>==<br></teq></a> <tblk>[ {2000-01-01 00:00}  |  OFF  |   ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the output units for the NetCDF (see Section <a href="#Grid-4"><strong>??</strong></a>) time variable. If set to OFF or
NONE, the “units” attribute of the .nc file is simply the simulation
time unit (e.g. units = ‘hours’). If a date is provided the NetCDF time
units will be in the format “&lt;unit&gt; since &lt;date&gt;”. For example, unit
= ‘hours since 2000-01-01 00:00’ or ‘days since 2000-01-01 00:00’. The
default setting is ‘2000-01-01 00:00’ as not having a date appears to
cause issues in ArcMap. If a date is specified, it is strongly
recommended that this is in isodate format. TUFLOW <strong><u>does not</u></strong>
check the date is valid, it is simply written to the NetCDF time
variable as entered in this command.</p>
See also <a href="#tcfNetCDFOutputTimeUnit">NetCDF Output Time Unit</a> command
below. </date></unit>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNetCDFOutputTimeUnit"><tcmd>NetCDF Output Time Unit </tcmd><teq>==<br></teq></a> <tblk>[ DAY  |  {HOUR}  |  MINUTE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Set the output time unit for .nc outputs (see Section <a href="#Grid-4"><strong>??</strong></a>). The default is hours (as per
other TUFLOW outputs). See also <a href="#tcfNetCDFOutputStartDate">NetCDF Output Start
Date</a> command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNon-NewtonianMixingExponent"><tcmd>Non-Newtonian Mixing Exponent </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> float <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> float <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> float <span class="math inline">\(\rangle\)</span> | {0, 0, 0} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Used to specify the mixing exponents, m, o, and p to be used, see Section <a href="#NN-Mix-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNullCellChecks"><tcmd>Null Cell Checks </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Switches on and off the checks that ensure null cells occur on one side
of an external boundary. A TUFLOW simulation prior to Build 2001-08-AE
will not proceed unless a null cell occurs on one side of an external
boundary cell (this was used to indicate the inactive side of the
boundary line). Setting this to OFF (the default) allows ESTRY models to
be inserted through the 2D domain with no need to specify null cells
(e.g. a 1D creek flowing through a 2D floodplain). It also allows land
cells, instead of null cells, to be specified against a boundary on the
inactive side.</p>
<p><strong>Note: Prior to Build 2001-08-AE models were checked for the null cells
along boundaries. For models prior to this build, you may need to set
this flag.</strong></p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNumber2D2DLinkIterations"><tcmd>Number 2D2D Link Iterations </tcmd><teq>==<br></teq></a> <tblk>[ {1}  |  <span class="math inline">\(\langle\)</span> no_iterations <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Specifies the number of iterations for setting water levels at control
points along a 2D line in a 2d_bc layer for stitching 2D domains
together. See Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfNumberIterations"><tcmd>Number Iterations </tcmd><teq>==<br></teq></a> <tblk>[ {2}  |  <span class="math inline">\(\langle\)</span> no_iterations <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Specifies the number of iterations per timestep (refer to <span class="citation">Stelling (<a href="#ref-Stelling1984">1984</a>)</span> or <span class="citation">Syme (<a href="#ref-Syme1991">1991</a>)</span>). It is rare this value is changed from 2, the default. Doubling the number of iterations slows down the simulation by
roughly a factor of two. If a value of less than 2 is specified, 2 is used. See Section <a href="#tuflow-classic-2d-solver"><strong>??</strong></a>.</p>
The main exception to the default value of 2 is in the modelling of
rapidly varying flood waves such as dam break hydrographs. For
simulations of this kind, improved convergence and reduced mass error
can be achieved through increasing the number of iterations up to values
as high as 10, although usually 4 should suffice. The recommended
approach is if the simulation is demonstrating unacceptably high mass
error (e.g. &amp;gt;3%), carry out sensitivity tests that increase the number
of iterations to ascertain whether a poor convergence using the default
value of 2 is the cause of the problem. If increasing the number of
iterations has no benefits keep the value at the default value of 2.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfOutputApproach"><tcmd>Output Approach </tcmd><teq>==<br></teq></a> <tblk>[ {DEFAULT 2016}  |  PRE 2016  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Sets the output approach. For the TUFLOW 2016-03 release a new approach
for time-series and summary .csv files was implemented that combines the
1D and 2D plot (time-series) data into a single folder, allowing
utilities such as the QGIS TUFLOW Plugin to provide access to all plot
output under the one folder. Where no output format has been specified, the new
default for the 2016-03 uses the XMDF format. Specifying <tcmd><a href="#tcfDefaults">Defaults</a></tcmd> <teq>==</teq> <tblk>Pre 2016</tblk> or <tcmd><a href="#tcfOutputApproach">Output Approach</a></tcmd> <teq>==</teq> <tblk>Pre 2016</tblk> sets the default to the DAT format.</p>
<p>It is intended that further enhancement of the default settings for map
and other outputs will be added to future releases.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfOutputDrive"><tcmd>Output Drive </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> drive_letter <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Changes the drive letter of any output files with a full path specified.
For example “<tcmd>Output Drive</tcmd> <teq>==</teq> <tblk>K</tblk>” changes any output filepaths that have a
drive letter to the K drive. Also see <a href="#tcfInputDrive">Input Drive</a>. See Section <a href="#Location-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfOutputFiles"><tcmd>Output Files [ {ALL} | NONE | INCLUDE | EXCLUDE ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> output type list <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Can be used to suppress or include certain time series and 1D output (see Section <a href="#view-1D-2"><strong>??</strong></a>).
Whilst this command currently only applies to 1D output it is assigned
to the .tcf commands as is intended to extend to other output files in
future releases that may contain 2D output.</p>
<p>The EXCLUDE or INCLUDE options allow for a space delimited list of file
extensions or prefixes to be specified to exclude or include output
files and GIS layers from being written. The notation must be the same
as those used by TUFLOW. For example, “eof” would apply to the .eof
file. To exclude/include more than one layer ensure there are spaces
between the prefixes. If EXCLUDE or INCLUDE occurs more than once, the
latter occurrence prevails.</p>
<p>Note that for the .eof file, this only affects the writing of results
output to this file. The header information and input data written to
the .eof file will still be output.</p>
<p>Valid options to include or exclude are: EOF, 1d_mmH, 1d_mmQ, 1d_mmV, 1d_CCA, TS, TSF, TSL, TSMB, TSMB1D2D.</p>
<p>Examples:</p>
<p><tcmd>Output Files EXCLUDE</tcmd> <teq>==</teq> <tblk>EOF TSMB TSMB1D2D</tblk><br />
<tcmd>Output Files INCLUDE</tcmd> <teq>==</teq> <tblk>TS, 1d_CCA</tblk><br />
<tcmd>Output Files ALL</tcmd><br />
<tcmd>Output Files NONE</tcmd></p>
The ALL and NONE options require no file type list. All output files
will be written, specification of the ALL or NONE option will nullify
any prior occurrence of an EXCLUDE or INCLUDE list; this is useful if
you wish to write no or all output files for one particular run – simply
add Output Files ALL to the end of the .tcf file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfOutputFolder"><tcmd>Output Folder </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> folder <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Redirects all TUFLOW output data except the log and summary files to
&lt;folder&gt;. See Section <a href="#Location-2"><strong>??</strong></a>. Typically used to write output to your local C: or D: drive
instead of filling up the network drive, or to keep results separate to
the input data. A URL can be used (e.g.
<a href="file://bmtserv/Computer001/tuflow/results">\bmtserv</a>),
which is useful for running simulations on other computers, but with the
output directed to your local drive or other location (your drive will
need to be shared).</p>
This command can be used within an Output Zone definition block to
change the setting from that for the entire model map output. </folder>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfPause"><tcmd>Pause </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> message <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Causes TUFLOW to stop whenever it encounters it. It can also be used to
pause the simulation and display a given message. The user has the
option to continue or discontinue the simulation via a dialog window. See Section <a href="#Scenarios-3"><strong>??</strong></a>.</p>
<p>Example:</p>
<tcmd>Pause</tcmd> <teq>==</teq> <tblk>Invalid Scenario specified.</tblk>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfPitDefaultExtrapolateQCurve"><tcmd>Pit Default Extrapolate Q Curve </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Q and VPI pit curves are automatically extrapolated using the orifice flow equation. To cap flow at the last value in a depth discharge curve (i.e. not extrapolate), this command can be set to “OFF”. See Section <a href="#DD-Database-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfPitNo1DConnection"><tcmd>Pit No 1D Connection </tcmd><teq>==<br></teq></a> <tblk>[ {CHECK}  |  {ERROR}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Unconnected pits (see Section <a href="#Pits-3"><strong>??</strong></a>) will by default be simulated and will extract water from a 2D domain (i.e. they are treated as a virtual pipe pit). A <a href="https://wiki.tuflow.com/TUFLOW_Message_1625">CHECK 1625</a> message is issued for unconnected pits (excluding VPI and VPO pits), alerting the modeller to the possibility of a pit possibly being inadvertently not snapped or within the <a href="#ecfPitSearchDistance">Pit Search Distance</a>.  Prior to Build 2018-03-AA an ERROR would occur for unconnected pits such as “<a href="https://wiki.tuflow.com/TUFLOW_Message_1353">ERROR 1353</a> - No NA data for Node Pit1. If all the pits should be connected (excluding VPI and VPO pits)”, the user can specify the .ecf command <a href="#ecfPitSearchDistance">Pit Search Distance</a> ERROR to force an <a href="https://wiki.tuflow.com/TUFLOW_Message_1626">ERROR 1626</a> in the case of a pit not being connected by snapping or within the <a href="#ecfPitSearchDistance">Pit Search Distance</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfPlotOutputInvalidType"><tcmd>Plot Output Invalid Type </tcmd><teq>==<br></teq></a> <tblk>[ ERROR  | {WARNING} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>When a plot output type (Section <a href="#TimeSeries-2"><strong>??</strong></a>) has been assigned to an invalid geometry type, TUFLOW will output <a href="https://wiki.tuflow.com/TUFLOW_Message_2136">WARNING 2136</a>. For example, plot output type “Q” (flow) is valid on a line but not a point.</p>
This can be escalated to an ERROR by setting to “ERROR”.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfPOApproach"><tcmd>PO Approach </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A  |  {METHOD B}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>METHOD A is the original 2d_po flow lines approach and only provided as
a precaution for legacy models. Method A and Method B should give the
same results, but Method B is much faster and can substantially reduce
simulation times if numerous 2d_po flow lines exist.</p>
<p>METHOD B (the default) utilises a substantially faster approach for
2d_po flow lines, which will not slow down a simulation if numerous
2d_po flow lines exist, as was occurring with old releases.</p>
<p>The previous approach can be used by specifying<tcmd><a href="#tcfPOApproach">PO Approach</a></tcmd> <teq>==</teq> <tblk>Method A</tblk> however, this should only be
necessary in the event of a problem arising in which case please email
<support>.</p>
</support>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfProcessAllGrids"><tcmd>Process All Grids </tcmd><teq>==<br></teq></a> <tblk>[ {OFF}  |  ON  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>By default the input grid extents for any grids read using the <a href="#tgcReadGrid">Read Grid &lt;grid type&gt;</a> command are compared with the TUFLOW model extent
and if the input GIS raster is entirely outside of the model area these
are skipped to reduce the simulation start-up time. This can be
particularly useful if the DEM data is across many tiles, of which only
some tiles fall within the 2D domain. In other words, the .tgc file can
reference all tiles (e.g. for the whole of the UK), but only those
required for the 2D domain are accessed.</p>
<p>To process all grids, regardless of the grid extents, the following .tcf
file command can be included.</p>
<p><tcmd>Process All Grids</tcmd> <teq>==</teq> <tblk>ON</tblk></p>
Processing of all input grids is set to “ON” if the previous defaults
are used (e.g. “<tcmd>Defaults</tcmd> <teq>==</teq> <tblk>Pre 2017</tblk>”). </grid>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfQuadtreeBCParallelInertiaApproach"><tcmd>Quadtree BC Parallel Inertia Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>TUFLOW HPC Quadtree Only.</p>
Controls the handling of inertia parallel at head boundaries for Quadtree simulations. “Method B” provides consistency with TUFLOW Classic and single level HPC. “Method A” is available for backward compatibility. The default approach is recommended.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfQuadtreeControlFile"><tcmd>Quadtree Control File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .qcf_file <span class="math inline">\(\rangle\)</span> | Single Level ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Specifies the quadtree control file (.qcf), see Section <a href="#Quadtree-3"><strong>??</strong></a>. The keyword “Single Level” can be used instead of a control file to run the Quadtree solver on a single grid model (i.e.. a fixed cell size).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRainfallBoundaries"><tcmd>Rainfall Boundaries </tcmd><teq>==<br></teq></a> <tblk>[ {STEPPED}  |  SMOOTHED  |  SMOOTHED TIME CENTRED  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The SMOOTHED TIME CENTRED option “smooths” the rainfall histogram by
converting it into a “hydrograph” shaped curve rather than a histogram
shape as is usually adopted for rainfall hyetographs.</p>
<p>If TIME CENTRED is omitted (i.e. SMOOTHED option), the timing is such
that the first rainfall occurs at the time of the first rainfall but
because of the smoothing the volume of rainfall is delayed in time.</p>
<p>The STEPPED option (the default) holds the rainfall constant for the
time interval (i.e. the rainfall has a histogram stair-step shape). This
means, for example, the second rainfall value in the time-series is
applied as a constant rainfall from the first time value to the second
time value. As with all rainfall boundaries, the first and last rainfall
entries should be set to zero (otherwise these rainfall values are
applied as a constant rainfall if the simulation starts before or
extends beyond the first and last time values in the rainfall
time-series).</p>
See Section <a href="#Rainfall-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRainfallBoundaryFactor"><tcmd>Rainfall Boundary Factor </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value {1.0} <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets a global multiplication factor for all rainfall boundaries, including:</p>
<ul>
<li>Global Rainfall (Section <a href="#RF-Global-4"><strong>??</strong></a>)<br />
</li>
<li>Read GIS RF (Section <a href="#RF-Layers-4"><strong>??</strong></a>)<br />
</li>
<li>Read GIS SA RF (Section <a href="#RFOption-4"><strong>??</strong></a>)<br />
</li>
<li>Gridded rainfalls (Section <a href="#GriddedRainfall-4"><strong>??</strong></a>)
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRainfallControlFile"><tcmd>Rainfall Control File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .trfc_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the text rainfall control file, if using time vary, gridded
rainfall inputs for the model. See Section <a href="#TRFC-File-4"><strong>??</strong></a> for a description of the
rainfall control file. Appendix <a href="#TRFCCommands-1"><strong>??</strong></a> contains a full list of all the
rainfall control file commands.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRainfallControlFile"><tcmd>Rainfall Gauges </tcmd><teq>==<br></teq></a> <tblk>[ One per Cell  |  {Unlimited per Cell}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If each cell is only to be assigned one rainfall time-series (Section <a href="#RF-Layers-4"><strong>??</strong></a>) use the
“One per Cell” option. If One per Cell is set, an <a href="https://wiki.tuflow.com/TUFLOW_Message_2070">ERROR 2070</a> is issued
if a 2D cell is assigned rainfall from more than one RF input (e.g. from
overlapping RF polygons) as this would cause a duplication of rainfall
on that cell, and so is a good quality control check.</li>
</ul>
Note that if the common boundary of adjoining polygons intersects
exactly at a 2D cell’s centre, this ERROR can be produced (slightly
re-shape the polygons around the cell’s centre to fix this). This option
can also reduce the amount of RAM needed for direct rainfall models, as
a separate grid is not needed for each RF input.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRainfallNullValue"><tcmd>Rainfall Null Value </tcmd><teq>==<br></teq></a> <tblk>[ {-99}  |  <span class="math inline">\(\langle\)</span> null value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Rainfall timeseries read in via the <a href="#tcfRainfallControlFile">Rainfall Control File</a> (.trfc) (Section <a href="#TRFC-File-4"><strong>??</strong></a>) can have a null value, which is user defined using this command. The default null value is -99, and only applies to the IDW rainfall interpolation approach. If a null value is detected at a point location, the IDW interpolation is revised to ignore the location. If all locations have a null value at a boundary time, an <a href="https://wiki.tuflow.com/TUFLOW_Message_2642">ERROR 2642</a> is generated. Note, prior to release 2020-10 the default null value was -99999, not -99.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadFile"><tcmd>Read File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Directs input to another file. When finished reading &lt;file&gt;, TUFLOW
returns to reading the .tcf file. See Section <a href="#ReadFile-3"><strong>??</strong></a>.</p>
<p>This command is particularly useful for projects with a large number of
simulations. Repetitive commands are grouped and placed in another text
file. If one of these commands changes, the command only has to be
edited once, rather than in every .tcf file. The command can be used to
redirect file(s) up to a maximum of ten levels.</p>
Also available in .tgc and .ecf files. </file>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISAutoTerminate"><tcmd>Read GIS Auto Terminate </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>TUFLOW simulations can be stopped after the peak flood using the Auto Terminate feature. <a href="#tcfSetAutoTerminate">Set Auto Terminate</a> is used to turn on this feature.</p>
<p>The 2D cells that are monitored are controlled by specifying a value of 0 (exclude) or 1 (include). <a href="#tcfSetAutoTerminate">Set Auto Terminate</a> defines the value over the <u>entire grid</u>. <a href="#tcfReadGISAutoTerminate">Read GIS Auto Terminate</a> is used to vary the monitoring
location spatially.</p>
<p>At each <a href="#tcfMapOutputInterval">Map Output Interval</a> the monitored cells are compared against two criteria:</p>
<ol style="list-style-type: decimal">
<li>The percentage of the wet cells that have become wet since the last
map output interval.<br />
</li>
<li>The velocity-depth product at the current timestep compared to the
maximum.</li>
</ol>
<p>This command is used with the optional commands <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell
Tolerance</a>, <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value
Tolerance</a>, <a href="#tcfAutoTerminateStartTime">Auto Terminate Start
Time</a> and <a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell
Tolerance</a>.</p>
<p>Note, the Auto Terminate feature is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
Refer to Section <a href="#AutoTerminateOptions-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISCyclone"><tcmd>Read GIS Cyclone/Hurricane [ {} | NO PRESSURE ] [ {} | NO WIND ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Reads a cyclone or hurricane track, as discussed in Section <a href="#Cyclones-2"><strong>??</strong></a>. The attributes of the GIS layer are
listed in Table <a href="#tab:tab-CycloneAttributes">86</a>. Only the first
line in the layer is read and used for the track. Points are snapped
to the line wherever attribute data are to be assigned. It is not
necessary to have points snapped to every vertex of the line – values
will be interpolated between the digitised points. There must be points
with attribute data snapped to the start and end of the polyline track.</p>
<p>The optional NO PRESSURE and NO WIND options deactivate the
pressure/wind fields respectively.</p>
Note that <a href="#tcfLatitude">Latitude</a> must be specified so as to
distinguish between southern and northern hemispheres.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISFC"><tcmd>Read GIS FC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>It is recommended to use the .tgc command <a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a> in preference to this command.</p>
<p>Opens a GIS layer containing details on flow constrictions to model bridges, box culverts, etc, see Section <a href="#CLA-FC-4"><strong>??</strong></a>. This command may be used any number of times.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISGLO"><tcmd>Read GIS GLO </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Opens a GIS layer containing details on gauge level output (2d_glo) locations (refer to Section <a href="#GaugeLevel-3"><strong>??</strong></a>).
GLO controls map output based on the height of the water at a specified
location – this is useful for producing a series of output based on
gauge heights for flood warning purposes. It can also be used to display
the height of the water at the gauge location to the screen.</p>
<p>A buffer has been incorporated so that GLO only repeats at a level once
the water level has moved at least 0.1m from the gauge level (this stops
repetitive output if the model is “hovering” or “bouncing” around a
gauge level.</p>
Only the last occurrence of this command is used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISIWL"><tcmd>Read GIS IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Opens a GIS file defining the water level at the start of the simulation. This option allows the water level to vary spatially in height, for example, to set water levels of lakes. This
command may be used any number of times. Note that if the water level of a cell is specified more than once, the last occurrence prevails.</p>
<p><strong>Note: This command overwrites any IWL values set in the .tgc file for the same 2D cells.</strong></p>
For details see Section <a href="#IWL-3"><strong>??</strong></a>. Initial water levels may also be read directly from a grid file using the command <a href="#tgcReadGridIWL">Read Grid IWL</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISLP"><tcmd>Read GIS LP </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Opens a GIS layer containing details on longitudinal profile output (LP)
locations (see Section <a href="#LongProfile-4"><strong>??</strong></a>). This command may be used any
number of times.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISOutputZone"><tcmd>Read GIS Output Zone </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads a GIS layer containing a polygon that defines the
region to be output. The attributes of the layer are not used. Refer to
Section <a href="#OutputZones-3"><strong>??</strong></a> for further information on Model Output Zones.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISPO"><tcmd>Read GIS PO </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Opens a GIS layer containing details on plot output (PO) locations (see
Section <a href="#View-PO-3"><strong>??</strong></a>). This command may be used any number of times.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISReportingLocation"><tcmd>Read GIS Reporting Location </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads GIS points and lines for time series result from 1D and 2D
sections of the model. This feature has the ability to combine flows,
and track maximums, across 1D and 2D domains. See Section <a href="#ReportingLocation-3"><strong>??</strong></a>
for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISX1DNetwork"><tcmd>Read GIS X1D Network </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads the location of external 1D scheme nodes and channels. Supported
1D schemes are Flood Modeller (formerly known as ISIS), XP-SWMM or 12D
Solution’s DDA. 1D Nodes and Channels are referred to as Nodes and Units
in Flood Modeller; Nodes and Links in XP-SWMM; and Pits and Pipes in
12D). The nodes in the GIS layer(s) are required for linking the
external 1D scheme to TUFLOW. The channels are required only if using
<a href="#tcfReadGISISISWLL">Read GIS X1D WLL</a> to integrate 1D and 2D results in
the map output. The only attribute required is the ID of the Flood
Modeller node/unit, XP-SWMM node/link and 12D pit/pipe. See Section
<a href="#oneD2DFMLinking2D-3"><strong>??</strong></a> for details on linking an external 1D scheme to TUFLOW, and
Section <a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results.</p>
For linking with TUFLOW, the linked nodes must occur in this layer or in
a <a href="#tcfReadGISISISNodes">Read GIS X1D Nodes</a> layer. The nodes and
channels (links) can be placed in separate layers, and split over
several layers if desired. If desired, and the WLL feature is not being
used, the layer can solely contain linked nodes and no channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISX1DNodes"><tcmd>Read GIS X1D Nodes </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This command is superseded by <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a>, but continues to be supported for
legacy models. It is now redundant as the nodes can be placed in a <a href="#tcfReadGISISISNetwork">Read
GIS X1D Network</a> layer (the <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a> layer can only contain the nodes, and no
channels, if so desired).</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISX1DWLL"><tcmd>Read GIS X1D WLL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLLs. See Section
<a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results. The GIS layer is identical
to that used for <a href="#ecfReadGISWLL">Read GIS WLL</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISX1DWLLPoints"><tcmd>Read GIS X1D WLL Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLL points for setting
elevations and materials at points along WLLs. See Section <a href="#OneDMap-3"><strong>??</strong></a>
for integrating 1D and 2D results for more details. The GIS layer is
identical to that used for <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGridRF"><tcmd>Read Grid RF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .csv_file <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> .nc_file <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads a comma-delimited or NetCDF (.nc) file to define the rainfall
applied directly to 2D cells over time. The .csv file is an index file
that references the grids in either ESRI ASCII (.asc) or a binary (.flt)
format. The .nc file contains all the rainfall grids over time within
the one file. Refer to Section <a href="#GriddedRainfall-4"><strong>??</strong></a> for further information.</p>
<strong>Note that the <a href="#tcfReadGridRF">Read Grid RF</a> command is located within
the .tcf file, unlike the <a href="#tbcReadGISRF">Read GIS RF</a> and <a href="#tbcReadRowColRF">Read RowCol
RF</a> commands which are located within the .tbc file.</strong>
This allows for the rainfall to be applied across all domains if
multiple 2D domains are being used. The <a href="#tcfReadGridRF">Read Grid RF</a>
command is not domain dependent whilst the .tbc file is.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadMaterialsFile"><tcmd>Read Materials File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span>  |  [ {1.0}  |  <span class="math inline">\(\langle\)</span> n_factor <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads a text file containing Manning’s n values for different materials
(land-use types).</p>
<p>Two file formats (.csv and .tmf) are available and are discussed in
detail in Section <a href="#Materials-2"><strong>??</strong></a>. Multiple materials files are also able to be
specified.</p>
<p>If a second argument, &lt;n_factor&gt; is provided, this value is used to
factor all Manning’s n values. For example, to increase all Manning’s n
values by 10%, enter “
<tcmd>Materials File</tcmd> <teq>==</teq> <tblk>My_Materials.tmf | 1.1</tblk>”.</p>
Only available for
<tcmd>Bed Resistance Values</tcmd> <teq>==</teq> <tblk>MANNING N</tblk> based bed resistance
values. </n_factor>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadRestartFile"><tcmd>Read Restart File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .trf_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads a restart file written from a previous simulation (see <a href="#tcfWriteRestartFileatTime">Write
Restart File at Time</a> and <a href="#tcfWriteRestartFileInterval">Write Restart
File Interval</a>). The file must have the
.trf extension, and if a 1D/2D model there must be a corresponding .erf
file.</p>
<p>The water levels, velocities, wetting and drying status and other
information saved in the restart file are used as the initial conditions
for the simulation.</p>
<p>Note that the simulation start time needs to be changed to be the same
as the time of the restart file.</p>
Refer to Section <a href="#RestartFiles-3"><strong>??</strong></a> for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISDIWL"><tcmd>Read RowCol IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .mid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Use <a href="#tcfReadGISIWL">Read GIS IWL</a> or <a href="#tgcReadGridIWL">Read Grid IWL</a> instead. Expand to find out more about the legacy settings.
</summary>
<p>Opens a .mid file defining the water level in each cell at the start of
the simulation. This option allows the water level to vary spatially in
height, for example, to set water levels of lakes. This command may be
used any number of times. Note that if the water level of a cell is
specified more than once, the last occurrence prevails.</p>
<p><strong>Note: This command overwrites any IWL values set in the .tgc file for
the same 2D cells.</strong></p>
<p>For details see Section <a href="#IWL-3"><strong>??</strong></a>. Initial water levels may also be read directly from a grid using the command <a href="#tgcReadGridIWL">Read Grid IWL</a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadSoilFile"><tcmd>Read Soils File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file.tsoilf <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads a text file containing an integer soil ID, infiltration method and
soil parameters for different soil types. Refer to Section <a href="#Infiltration-2"><strong>??</strong></a> for more
information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRecalculateChezyInterval"><tcmd>Recalculate Chezy Interval </tcmd><teq>==<br></teq></a> <tblk>[ {0}  |  <span class="math inline">\(\langle\)</span> timesteps <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p><strong>Warning:</strong> This command overwrites any previous use of <a href="#tcfBedResistanceValues">Bed Resistance
Values</a> by setting CHEZY.</p>
Sets the number of timesteps between recalculation of Chezy values based
on the ripple height. The default value of zero indicates Chezy values
are not recalculated (i.e. remain constant throughout the simulation). See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRecordGaugeData"><tcmd>Record Gauge Data </tcmd><teq>==<br></teq></a> <tblk>[ RLP | RLL | Gauge ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets whether to automatically include reporting location lines, reporting location points, and gauge locations (PO ‘G_’ type) when processing gauge receptor objects, see Section <a href="#Receptors-3"><strong>??</strong></a>. The default is to include all reporting location lines, points and gauges.</p>
<p>The options are:</p>
<ul>
<li>“RLP”: reporting location points</li>
<li>“RLL”: reporting location lines</li>
<li>“Gauge”: gauge locations (2d_po ’G_ type)
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRecordGaugeDataEXCLUDE"><tcmd>Record Gauge Data EXCLUDE </tcmd><teq>==<br></teq></a> <tblk>[ RLP | RLL | Gauge ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets whether to automatically exclude reporting location lines, reporting location points, and gauge locations (PO ‘G_’ type) when processing gauge receptor objects, see Section <a href="#Receptors-3"><strong>??</strong></a>. The default is to include all reporting location lines, points and gauges.</li>
</ul>
<p>The options are:</p>
<ul>
<li>“RLP”: reporting location points</li>
<li>“RLL”: reporting location lines</li>
<li>“Gauge”: gauge locations (2d_po ’G_ type)
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfRestartFileIgnoreFields"><tcmd>Restart File Ignore Fields </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> field <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Used to specify which fields to ignore for restart files.</li>
</ul>
<p>The fields are any combination of:</p>
<ul>
<li>Geometry (elevations and Manning’s n values)</li>
<li>Groundwater (groundwater depths and groundwater tracer concentrations)<br />
</li>
<li>Maximum (scalar and vector maximums; both values and times, minimum timestep)<br />
</li>
<li>Rainfall (cumulative rainfall, cumulative rainfall material losses and cumulative cell wet time)<br />
</li>
<li>TimeOutputCutoff (Time Output Cutoff; time of first inundation and cumulative time inundated)<br />
</li>
<li>Tracer (surface and groundwater tracer concentrations)<br />
</li>
<li>Velocity (velocity and turbulence values)<br />
</li>
<li>WaterLevel (water level)</li>
</ul>
<p>For example: “<tcmd>Restart File Ignore Fields</tcmd> <teq> == </teq> <tblk>Geometry Groundwater</tblk>” will ignore the geometry and groundwater information in the restart file (for these, the values set in the control files are used).</p>
<p>By default (without the command above) the geometry information in the restart file is ignored and the .tgc information is used instead. See also <tcmd>HPC Restart Geometry</tcmd> <teq> == </teq> <tblk>Restart File | {TGC} </tblk> command. If the “<tcmd>Restart File Ignore Fields</tcmd> <teq> ==</teq>” command is included, but does not include geometry then message “<a href="https://wiki.tuflow.com/TUFLOW_Message_2902">WARNING 2902</a> -‘Restart File Ignore Field’ does not include geometry, overwriting geometry in .tgc with restart file” is issued.</p>
Note: Only one of “<tcmd>Restart File Ignore Fields</tcmd>” or “<tcmd>HPC Restart Geometry</tcmd>” should be used, an error is given if both commands are present in a control file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReveal1DNodes"><tcmd>Reveal 1D Nodes </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
When set to ON, displays the hidden 1D nodes within a 2d_bc 2D link line
for models containing multiple 2D domains and for QT boundaries. Refer
to Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSAminDepth"><tcmd>SA Minimum Depth </tcmd><teq>==<br></teq></a> <tblk>[ {-99999}  |  <span class="math inline">\(\langle\)</span> depth in m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the minimum depth a wet cell must have to apply an SA Inflow (see Section <a href="#SA-Layers-3"><strong>??</strong></a>). This
can resolve a problem that has occurred where large SA inflows onto very
shallow, high roughness, areas can appear to gradually flow up hill.
This was being caused by the SA inflow being greater than the rate at
which the flow was travelling overland and the water would slowly creep
up the dry slope at the edge of the flooded area. In such situations
using a SA Minimum Depth of around 0.1m will ensure that this does not
occur. Note that the only cases this problem has been seen to occur was
when modelling an extreme flood event (PMF) on gently sloping high
roughness areas.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSAPropDepth"><tcmd>SA Proportion to Depth </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This command proportions the SA inflows according to the depth of water (see Section <a href="#SA-Layers-3"><strong>??</strong></a>).
This feature also enhances SA inflows by applying an inflow in
proportion to the depths of water of the wet cells contained within the
SA polygon. Where the SA hydrographs have been derived by a hydrologic
model that has already included routing effects, this feature will tend
to place more inflows in the deeper areas (i.e. the creeks, rivers and
downstream areas of the SA region), and hence reduce any routing
duplication effects.</p>
Proportioning to depth provides improved performance if using as a side
inflow, especially for dam break type analyses, and reduces the effect
of any duplicated routing when applying local hydrographs from a
hydrology model.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfScreenLogDisplayInterval"><tcmd>Screen/Log Display Interval </tcmd><teq>==<br></teq></a> <tblk>[ {1}  | {10}  | {100}  |  <span class="math inline">\(\langle\)</span>timesteps<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the frequency for display of output to the computer screen and log (.tlf) file (see Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>). The default display frequency for TUFLOW Classic is 1, TUFLOW HPC on CPU is 10 and TUFLOW HPC on GPU is 100.</p>
A value of zero is treated the same as for a value of 1. A value of ‑2 suppresses the display except for any negative depth warnings. A value of ‑3 suppresses all timestep displays.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSetAutoTerminate"><tcmd>Set Auto Terminate </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> 0 <span class="math inline">\(\rangle\)</span>  | 1 ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>TUFLOW simulations can be stopped after the peak flood using the Auto Terminate feature. <a href="#tcfSetAutoTerminate">Set Auto Terminate</a> is used to turn on this feature.</p>
<p>The 2D cells that are monitored are controlled by specifying a value of 0 (exclude) or 1 (include). <a href="#tcfSetAutoTerminate">Set Auto Terminate</a> defines the value over the <u>entire grid</u>. <a href="#tcfReadGISAutoTerminate">Read GIS Auto Terminate</a> is used to vary the monitoring
location spatially.</p>
<p>At each <a href="#tcfMapOutputInterval">Map Output Interval</a> the monitored cells are compared
against two criteria:</p>
<ol style="list-style-type: decimal">
<li>The percentage of the wet cells that have become wet since the last
map output interval.<br />
</li>
<li>The velocity-depth product at the current timestep compared to the
maximum.</li>
</ol>
<p>This command is used with the optional commands <a href="#tcfAutoTerminatedVCellTolerance">Auto Terminate dV Cell
Tolerance</a>, <a href="#tcfAutoTerminatedVValueTolerance">Auto Terminate dV Value
Tolerance</a>, <a href="#tcfAutoTerminateStartTime">Auto Terminate Start
Time</a> and <a href="#tcfAutoTerminateWetCellTolerance">Auto Terminate Wet Cell
Tolerance</a>.</p>
<p>Note, the Auto Terminate feature is only assessed at every <a href="#tcfMapOutputInterval">Map Output
Interval</a>.</p>
Refer to Section <a href="#AutoTerminateOptions-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSetIWL"><tcmd>Set IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  |  AUTO  |  {0.0} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If a &lt;value&gt; is specified, sets the initial water level for all cells in the 2D domain to the value, see Section <a href="#IWL-3"><strong>??</strong></a>. Initial water levels for individual cells can be overwritten using <a href="#tcfReadGISIWL">Read GIS IWL</a> or <a href="#tgcReadGridIWL">Read Grid IWL</a>.</p>
<p>If AUTO is specified, sets the IWL in 1D and 2D domains to the value of the water level boundary in the model at the start of the simulation. If the model has more than one water level boundary, and the starting level
is different, an <a href="http://wiki.tuflow.com/index.php?title=TUFLOW_Message_0037">ERROR 0037</a>
occurs. This feature only works for HT and HS boundaries. Note that the
initial water level is only applied to 1D nodes and 2D cells that have
been allocated a zero IWL (this is the default value).  This means that
<a href="#tcfReadGISIWL">Read GIS IWL</a> can still be used to set the IWL in other
parts of the model, such as a lake.  Note that if <a href="#tcfReadGISIWL">Read GIS
IWL</a> sets a zero IWL, then this will be overridden by the
AUTO value.</p>
<strong>Note: This command overwrites any IWL values set in the .tgc file for
the same 2D domain.</strong> </value>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSetRouteCutOffType"><tcmd>Set Route Cut Off Type </tcmd><teq>==<br></teq></a> <tblk>[ {Depth}  |  Velocity or V  |  Hazard or VxD or Z0  |  Energy ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Sets the cutoff value type for evacuation routes if the Cut_Off_Type
attribute in the <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a> layer
is blank. Depth, velocity and hazard options are available. The cutoff
values are set using <a href="#tcfSetRouteCutOffValues">Set Route Cut Off
Values</a> in the .tcf and/or .tgc file, and
evacuation routes are described in Section <a href="#EvaculationRoutes-3"><strong>??</strong></a> and set using
the .tgc file command <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a>.</p>
This command may be used in either the .tcf and/or .tgc file. If used in
the .tcf it is the global default setting when the .tgc file is
processed. If used in the .tgc file its location in the file is
important in that it only applies to subsequent evacuation route
commands. It may be used any number of times in the .tgc file so as to
change the evacuation route settings at different points within the .tgc
file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSetRouteCutOffValues"><tcmd>Set Route Cut Off Values </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> y1, y2, … <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Sets the cutoff values for the evacuation route feature (see Section <a href="#EvaculationRoutes-3"><strong>??</strong></a>) if the Cut_Off_Values attribute in the <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape
Route</a> layer is blank. The type of cutoff values
is set using <a href="#tcfSetRouteCutOffType">Set Route Cut Off Type</a> and
evacuation routes are set using the .tgc file command <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape
Route</a>.</p>
This command may be used in either the .tcf and/or .tgc file. If used in
the .tcf it is the global default setting when the .tgc file is
processed. If used in the .tgc file its location in the file is
important in that it only applies to subsequent evacuation route
commands. It may be used any number of times in the .tgc file so as to
change the evacuation route settings at different points within the .tgc
file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSetVariable"><tcmd>Set Variable </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>In any TUFLOW control file use of this command defines a variable’s name
and value (Section <a href="#Variables-3"><strong>??</strong></a>). Wherever you want to refer to the variable, the variable’s
name must be bounded by “&lt;&lt; and “&gt;&gt;” characters.</p>
<p><strong>Note, that when using <a href="#tcfSetVariable">Set Variable</a> do not use
&lt;&lt;…&gt;&gt; to bound the variable’s name as is required to reference the
variable in the control files.</strong></p>
<p>Any scenarios and events are automatically set as a variable that can be
used within your control files. For example, if your model results are
to be output to different folders depending on Scenario 1 (~s1~), enter
the following into the .tcf file noting the use of <span class="math inline">\(\langle\langle\)</span> and <span class="math inline">\(\rangle\rangle\)</span> to
delineate the variable name.</p>
<p><tcmd>Output Folder</tcmd> <teq>==</teq> <tblk>..\results\&lt;&lt;~s1~&gt;&gt;</tblk></p>
<p>In the case above, if Scenario ~s1~ is set to “OpA”, TUFLOW
automatically sets a variable named “~s1~” to a value of “OpA”, and the
output will be directed to “..\results\OpA”.</p>
<p>As an extension to the example above if the output folder is to also
include the first event name, which, for example, is the return period
of the flood, the following could be used:</p>
<p><tcmd>Output Folder</tcmd> <teq>==</teq> <tblk>..\results\&lt;&lt;~e1~&gt;&gt;_&lt;&lt;~s1~&gt;&gt;</tblk></p>
<p>If Event ~e1~ is set to “Q100”, the output will be directed to ..\results\Q100_OpA.</p>
<p>Variables may be set to any characters and can be referred to as often
as needed in any control file and in other files such as the .tmf and
.toc files. At present you can’t use variables in the bc_dbase.csv
files, but future builds may offer this feature.</p>
<p>For example the lines below give some idea of how you could use
variables that explains how scenarios and events are automatically set
as available variables. The commands below set the model’s cell size,
timestep and output interval, and sets the folders for outputting check
files and results according to Scenario 1 which is the model’s grid
resolution (cell size), i.e.. one of “0.5m”, “1.0m” or “2.0m”.</p>
<p><strong>.tcf file entries:</strong></p>
<p><tcmd>If Scenario</tcmd> <teq>==</teq> <tblk>0.5m</tblk><br />
 <tcmd>Set Variable 2D_CELL_SIZE</tcmd> <teq>==</teq> <tblk>0.5</tblk><br />
 <tcmd>Set Variable 2D_Timestep</tcmd> <teq>==</teq> <tblk>0.25</tblk><br />
 <tcmd>Set Variable Log_Int</tcmd> <teq>==</teq> <tblk>60</tblk><br />
<tcmd>Else If Scenario</tcmd> <teq>==</teq> <tblk>1.0m</tblk><br />
 <tcmd>Set Variable 2D_CELL_SIZE</tcmd> <teq>==</teq> <tblk>1.</tblk><br />
 <tcmd>Set Variable 2D_Timestep</tcmd> <teq>==</teq> <tblk>0.5</tblk><br />
 <tcmd>Set Variable Log_Int</tcmd> <teq>==</teq> <tblk>60</tblk><br />
<tcmd>Else If Scenario</tcmd> <teq>==</teq> <tblk>2.0m</tblk><br />
 <tcmd>Set Variable 2D_CELL_SIZE</tcmd> <teq>==</teq> <tblk>2.</tblk><br />
 <tcmd>Set Variable 2D_Timestep</tcmd> <teq>==</teq> <tblk>1.0</tblk><br />
 <tcmd>Set Variable Log_Int</tcmd> <teq>==</teq> <tblk>30</tblk><br />
<tcmd>End If</tcmd><br />
<tgrn>! Set times</tgrn><br />
<tcmd>Start Time</tcmd> <teq>==</teq> <tblk>0</tblk><br />
<tcmd>End Time</tcmd> <teq>==</teq> <tblk>0.5</tblk><br />
<tcmd>Timestep</tcmd> <teq>==</teq> <tblk>&lt;&lt;2D_Timestep&gt;&gt;</tblk><br />
<tcmd>Write Check Files</tcmd> <teq>==</teq> <tblk>..\check\&lt;&lt;~s1~&gt;&gt;\</tblk><br />
<tcmd>Output Folder</tcmd> <teq>==</teq> <tblk>..\results\&lt;&lt;~s1~&gt;&gt;\</tblk><br />
<tcmd>Screen/Log Display Interval</tcmd> <teq>==</teq> <tblk> &lt;&lt; Log_Int &gt;&gt; </tblk></p>
<p><strong>.tgc file entry:</strong></p>
<p><tcmd>Cell Size</tcmd> <teq>==</teq> <tblk>&lt;&lt;2D_CELL_SIZE&gt;&gt;</tblk></p>
Note that <a href="#tcfIfScenario">If Scenario</a> and <a href="#tcfIfEvent">If Event</a>
operate at a higher level than <a href="#tcfSetVariable">Set Variable</a>, so that
they can be used to set different values for the same variable.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGS"><tcmd>SGS </tcmd><teq>==<br></teq></a> <tblk>[ ON  | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>To implement sub-grid sampling (SGS) the only command required is <tcmd><a href="#tcfSGS">SGS</a></tcmd> <teq>== </teq><tblk>ON</tblk>.</p>
For information on SGS see Section <a href="#SGS-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSApproach"><tcmd>SGS Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method B | {Method C} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
<p>Sets the approach for Sub-grid Sampling when <a href="#tcfSGS">SGS</a> is used. See Section <a href="#SGS-3"><strong>??</strong></a>.</p>
<ul>
<li>Method C (default): retains the SGS elevations in memory throughout the pre-processing stage and performs the generation of the curves only at the end of the pre-processing of all elevation data. Whilst this method can potentially use more memory (CPU RAM) there are considerable benefits in terms of preserving sub-grid elevation data at cells/faces partially affected by terrain data layers and allows TUFLOW to produce high-resolution mapping at the SGS sampling resolution.</li>
<li>Method B (legacy): elevations are processed into elevation-volume curves (for cells) and elevation-flow area/width curves (cell faces) after reading each elevation dataset. SGS elevations are discarded after processing the dataset for memory efficiency.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSBreaklineDetectionDelta"><tcmd>SGS Breakline Detection Delta </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> maximum delta value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
SGS Only.</li>
</ul>
<p>Used to activate the SGS breakline detection delta check. See Section <a href="#SGS-Advanced-5"><strong>??</strong></a>.</p>
<p>The SGS breakline detection check processes each 2D cell to identify the minimum water surface elevation needed for a continuous wet connection through the cell traversing between left to right and between top to bottom. The maximum invert elevation of the left and right faces is subtracted from the left-right minimum water level and reports it as “uDelta”. Similarly, the top to bottom value is reported as “vDelta”. uDelta and vDelta represent the depth of water over the cell face inverts by which a natural ridge (break) line would block any flow. If either uDelta or vDelta exceeds the &lt;maximum delta value&gt; a spatial (GIS) <a href="https://wiki.tuflow.com/TUFLOW_Message_3542">CHECK 3542</a> message is issued at the cell location.</p>
This command can add significant time to the initialisation process, it is recommended to perform this check during model set up and to turn off once the creation of breaklines is complete. </maximum>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSDepthOutput"><tcmd>SGS Depth Output </tcmd><teq>==<br></teq></a> <tblk>[ EXACT |  {CELL AVERAGE} |  MEAN  |  MEDIAN  |  MINIMUM | PERCENTILE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
<p>Controls how map output values that use water depth are calculated for mesh based outputs (e.g. XMDF, DAT) if SGS is used. See Section <a href="#sgs-output-5"><strong>??</strong></a>.</p>
<ul>
<li>CELL AVERAGE (default): calculates the depth by dividing the cell volume by cell area.</li>
<li>EXACT: calculates the depth using the ZC and ZH elevations that would be sampled at their respective locations if SGS was not used, i.e. the elevations that would be sampled exactly at the cell centre (ZC) and cell corner (ZH) locations if SGS was not applied.</li>
<li>MEAN: uses the average Z value assigned to the cell centre and the cell corners from the SGS sampling, i.e. the map output shows the average depth within a cell / around a cell corner (also see SGS ZH Sample Ratio below).<br />
</li>
<li>MEDIAN: uses the median (50th percentile) elevation for the cell.</li>
<li>MINIMUM: uses the minimum Z value, i.e. the map output shows the maximum depth within a cell / around a cell corner (also see <a href="#tcfSGSZHSampleRatio">SGS ZH Sample Ratio</a>).</li>
<li>PERCENTILE: uses an elevation based on the specified set percentile. This requires a second argument, separated by vertical bar “|”, which is the percentile to use. For example, “<tcmd><a href="#tcfSGSDepthInterpolationApproach">SGS Depth Interpolation Approach</a></tcmd> <teq>==</teq> <tblk>Percentile | 25</tblk>” will use the 25th percentile of the SGS elevations sampled within the cell.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSInfiltrationApproach"><tcmd>SGS Infiltration Approach </tcmd><teq>==<br></teq></a> <tblk>[ {AUTO}  |  TOTAL AREA  |  WETTED AREA ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
SGS Only.</li>
</ul>
<p>Sets the infiltration approach when SGS is enabled. See Section <a href="#SGS-Advanced-5"><strong>??</strong></a>.</p>
<ul>
<li>Total Area: the infiltration rate used is the raw value computed from
the infiltration model regardless of whether the cell is fully wet or
partially wet. This is the best option for models with long periods of
direct rainfall leading to thin sheet flow.</li>
<li>Wetted Area: the infiltration rate used is factored down according to
the set area fraction of the cell. This the best option to use for the
infiltration of ponded water under no rain conditions.</li>
<li>Auto (default): enables the solver to choose between Total Area and Wetted Area
for each cell depending on whether or not the cell has rainfall applied
at that timestep. If rainfall is non-zero then the raw infiltration rate
is used (Total Area option), and if the rainfall is zero the
infiltration is factored down by the wet area ratio (Wetted Area
option).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSMapExtent"><tcmd>SGS Map Extent  <span class="math inline">\(\langle\)</span> Full or Trim <span class="math inline">\(\rangle\)</span> </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> map data types <span class="math inline">\(\rangle\)</span> | {ALL} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
SGS Only.</li>
</ul>
<p>Can be used to change the default trimming option (see Section <a href="#sgs-output-5"><strong>??</strong></a>. The following options are available:</p>
<ul>
<li>TRIM (default): sets which map data types are presented as “wet” for partially inundated cells and which data types are trimmed based on the <a href="#tcfMapCtoffSGS">Map Cutoff SGS</a>.<br />
</li>
<li>FULL: partially wet cells are shown as wet in the map output.</li>
</ul>
<p>For example:</p>
<ul>
<li>“<tcmd>SGS Map Extent Trim</tcmd> <teq>==</teq> <tblk>All</tblk>” will trim all mapped data types the Map Cutoff extents. This is the default and trims all output data types to the <a href="#tcfMapCtoffSGS">Map Cutoff SGS</a> extents.</li>
<li>“<tcmd>SGS Map Extent Full</tcmd> <teq>==</teq> <tblk>h v hazard</tblk>” will set the water level, velocity and any hazard outputs to the full extent, while all other data types will be trimmed.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSMaterials"><tcmd>SGS Materials </tcmd><teq>==<br></teq></a> <tblk>[ {OFF} | ON ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary></li>
</ul>
<p>SGS Only.</p>
<p>Used to enable or disable the sub-grid sampling of materials (land-use). In the 2023-03 Release this functionality has been disabled and TUFLOW will report <a href="https://wiki.tuflow.com/TUFLOW_Message_2568">ERROR 2568</a>. It was included in the 2020-10 Release as beta functionality.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSMaxSampleFrequency"><tcmd>SGS Max Sample Frequency </tcmd><teq>==<br></teq></a> <tblk>[  <span class="math inline">\(\langle\)</span> maximum frequency <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
Sampling frequency in SGS models is capped at 31 sampling points per cell face by default. This command can be used to increase this limit.
Note, a hard limit of 127 per face still applies. See Section <a href="#SGS-Distance-5"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSNegativeRainfallApproach"><tcmd>SGS Negative Rainfall Approach  </tcmd><teq>==<br></teq></a> <tblk>[ TOTAL AREA  |  {WETTED AREA} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
<p>Controls the cell area used when negative rainfall is applied in conjunction with SGS. See Section <a href="#SGS-Advanced-5"><strong>??</strong></a>.</p>
<ul>
<li>Total Area: uses the whole cell area, regardless of the portion of the cell that is wet.<br />
</li>
<li>Wetted Area (default): option uses only the wetted portion of the cell.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSSampleFrequency"><tcmd>SGS Sample Frequency </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> frequency <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
SGS Only.</li>
</ul>
<p>The “frequency” sets the number of sample locations per face. See Section <a href="#SGS-Distance-5"><strong>??</strong></a>. If a quadtree mesh is used (Section <a href="#Quadtree-3"><strong>??</strong></a>), different frequencies can be defined for each nesting level (e.g. <tcmd><a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a></tcmd> <teq>==</teq> <tblk>21, 11, 5</tblk>).</p>
If neither <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> nor <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> is set, a scan of the Geometry Control File (.tgc) is performed to find the minimum raster grid resolution used in <a href="#tgcReadGridZpt">Read Grid Zpt</a> commands, and this is used as the sampling target distance to compute the sampling frequency.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSSampleTargetDistance"><tcmd>SGS Sample Target Distance </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> distance<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
Sets the sampling target distance in meters or feet (if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>). This is the recommended approach to set the SGS sample distance. TUFLOW requires an odd number of sample locations across a cell face. For example, using a cell size of 10m and a sample target distance of 1m, TUFLOW will use 11 sample points along the cell face. If the target distance specified gives an even number, TUFLOW will round up to the next odd number. See Section <a href="#SGS-Distance-5"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSSXZFlagApproach"><tcmd>SGS SX Z Flag Approach  </tcmd><teq>==<br></teq></a> <tblk>[ Method A  |  {Method B}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
If set to Method A, cells that are lowered by the “Z” flag on SX connections are assumed flat (i.e. as per the approach for no SGS). The default Method B retains the SGS information, but shifts it all to match the lowered elevation. See Section <a href="#SGS-Advanced-5"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSTINMemoryAllocationFactor"><tcmd>SGS TIN Memory Allocation Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.02} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
Occasionally points modified by TINs exceed the size of temporary memory allocated. This command can be used to increase this temporary memory allocation. For example using a value of ‘1.1’ will increase the temporary memory allocation by 10%.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSVelocityBasedOutputs"><tcmd>SGS Velocity Based Outputs </tcmd><teq>==<br></teq></a> <tblk>[ {CELL AVERAGE DEPTH}  |  SGS DEPTH OUTPUT ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
Sets how the depth is determined for output data types that use a combination of depth and velocity in the calculation. The velocity used for these outputs should usually be the cell average velocity. For consistency a cell average depth (default) is applied for these output types regardless of the “<a href="#tcfSGSDepthOutput">SGS Depth Output</a>” setting. However, if desired, this can be changed by using “SGS Depth Output” which will use the depth set by the “<a href="#tcfSGSDepthOutput">SGS Depth Output</a>” command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSZShapeLineApproach"><tcmd>SGS Z Shape Line Approach  </tcmd><teq>==<br></teq></a> <tblk>[ Method A  |  {Method B}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
If set to Method A, cell faces are assumed flat (i.e. SGS is not applied and a rectangular section / flat cell is used). The default, Method B, applies a gradient along the face based on the cell corners and cell side Zpt values and for thick lines uses the ZC, ZU, ZV and ZH values to apply a sloping cell area for the cell volume. See Section <a href="#SGS-Advanced-5"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSZHSampleRatio"><tcmd>SGS ZH Sample Ratio </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> ratio <span class="math inline">\(\rangle\)</span> | {1} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>SGS Only.</p>
Used to control the area used for SGS at ZH locations. The area is set to <span class="math inline">\(\langle ratio \rangle \times cell\_area\)</span> to sample and generate Z values around a cell corner (the sampled elevations are not used in the hydraulic computations, only for map output). The default setting for this command is 1.0. The corner elevations are also used to enable the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Zmin">_DEM_Zmin</a> check file to be written. See Section <a href="#sgs-output-5"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSGSZptMAX/MINApproach"><tcmd>SGS Zpt MAX/MIN Approach  </tcmd><teq>==<br></teq></a> <tblk>[ IGNORE  |  {MINIMUM}  |  MEDIAN  |  CENTRE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>SGS Only.</p>
<p>When MAX/MIN options are used in SGS .tgc commands, the minimum elevations are used to determine whether the new elevation is higher/lower than the previous one (default option, MINIMUM). However occasionally the new elevation has a median elevation lower than the previous elevation, and in some situations, should be considered as the “lower” elevation. This command allows users to specify which elevation is used for the geometry updates using the MIN or MAX settings.</p>
<ul>
<li>Ignore: ignores the MAX/MIN options and always applies the new elevations.</li>
<li>Minimum (default): uses the minimum elevation for comparison.</li>
<li>Median: uses the median elevation for the comparison.</li>
<li>Centre: uses the cell centre / face mid-point elevations for the comparison.</li>
</ul>
<p>Only available using the legacy “<tcmd><a href="#tcfSGSApproach">SGS Approach</a></tcmd> <teq>==</teq> <tblk>Method B</tblk>”.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfShallowDepthStabilityFactor"><tcmd>Shallow Depth Stability Factor </tcmd><teq>==<br></teq></a> <tblk>[  <span class="math inline">\(\langle\)</span> SF <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Legacy command. No longer required or recommended for use
subsequent to implementation of <tcmd><a href="#tcfWettingandDrying">Wetting and Drying</a></tcmd> <teq>==</teq> <tblk>ON METHOD B</tblk>. See <a href="https://www.tuflow.com/Download/TUFLOW/Manuals/TUFLOW%20Manual.2010-10-AB.docx">TUFLOW 2010 Manual</a> for
details.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSHPProjection"><tcmd>SHP Projection </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> SF <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the geographic projection for all GIS input and output in Shapefile (.shp) file format (see Section <a href="#GISFormats-3"><strong>??</strong></a>). This is used for checking whether input layers are in the same projection, and for setting the projection of all output layers (e.g. check layers).</p>
If a model has a mixture of .gpkg, .shp and .mif files as input, then the projection must be specified for each (e.g. using <a href="#tcfGPKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> and <a href="#tcfMIProjection">MI
Projection</a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSHPProjectionCheckMethod"><tcmd>SHP Projection Check Method  </tcmd><teq>==<br></teq></a> <tblk>[ SIMPLE  | {PARSED} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the method for processing of the shapefile format projection (.prj) file to ensure an input is the same as the model projection (see Section <a href="#GISFormats-3"><strong>??</strong></a>). Setting to PARSED (default) parses the parameter data into number values and compares each of these numbers to check they are consistent. Setting to ‘SIMPLE’ will read in the file as a character string. Note, using ‘SIMPLE’ could cause issues if moving between GIS platforms (e.g. between ArcMap and QGIS), as these could write the .prj files slightly differently, particularly with a different number of decimal places. For example, consider the two extracts from .prj files; “PARAMETER[”latitude_of_origin”,0]” and “PARAMETER[”latitude_of_origin”,0.0]”. A string compare would highlight these as not matching.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSimulationsLogFolder"><tcmd>Simulations Log Folder  </tcmd><teq>==<br></teq></a> <tblk>[  <span class="math inline">\(\langle\)</span> folder <span class="math inline">\(\rangle\)</span>  | Do Not Use ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command is optional and can be used to sets the folder that the “_ All TUFLOW Simulations.log” is written to (see Section <a href="#GlobalLog-3"><strong>??</strong></a>). The default folder is “C:\ProgramData\TUFLOW\log”. Setting this command to ‘Do Not Use’ will supress the writing of the “_ All TUFLOW Simulations.log”.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSimulationPauseInterval"><tcmd>Simulation Pause Interval </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Time interval in hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command can be used to pause a TUFLOW simulation at set intervals during the simulation. This will create a Console pause (Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>) requiring a carriage return (enter key) to be pressed before the simulation will continue.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSimulationPauseStart"><tcmd>Simulation Pause Start </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Model time in hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command can be used to pause a TUFLOW simulation at a set time during the simulation. This will create a Console pause (Section <a href="#ConsoleDisplay-2"><strong>??</strong></a>) requiring a carriage return (enter key) to be pressed before the simulation will continue.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSnapTolerance"><tcmd>Snap Tolerance </tcmd><teq>==<br></teq></a> <tblk>[ {0.001}  |  <span class="math inline">\(\langle\)</span> snap_distance <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the search distance in metres or feet for detecting whether two GIS
objects are connected (snapped), see Section <a href="#othertroublshooting-4"><strong>??</strong></a>. Note that this command can be repeated
to change the tolerance only for a single layer. For example the below
could be used set the tolerance and then return it to the default value:</p>
<tcmd>Snap Tolerance</tcmd> <teq>==</teq> <tblk>0.01</tblk><br />
<tcmd>Read GIS Network</tcmd> <teq>==</teq> <tblk>..\1d_nwk_example_L.shp</tblk><br />
<tcmd>Snap Tolerance</tcmd> <teq>==</teq> <tblk>0.001</tblk>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSoilInitialLoss"><tcmd>Soil Initial Loss </tcmd><teq>==<br></teq></a> <tblk>[ {Ignore Material Impervious}  |  Use Material Impervious ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Provides flexibility in the handling of material imperviousness when applying soil initial losses, either using ILCL or Horton soil
infiltration methods (Section <a href="#Infiltration-2"><strong>??</strong></a>).</p>
<p>The initial losses can be used to model interception losses (i.e. water
that does not reach the soil), in which case the use of a material’s
imperviousness is not warranted and the default “<tcmd>Soil Initial Loss</tcmd> <teq>==</teq> <tblk>Ignore Material Impervious</tblk>” is preferred.</p>
For the “<tcmd>Soil Initial Loss</tcmd> <teq>==</teq> <tblk>Use Material Impervious</tblk>” option, the
initial loss is reduced by the material’s fraction imperviousness.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSoilNegativeRainfallApproach"><tcmd>Soil Negative Rainfall Approach  </tcmd><teq>==<br></teq></a> <tblk>[ {None}  |  Factor ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Provides the ability for negative rainfall to draw from the topmost
groundwater layer under surface layer cells that are dry, mimicking
evapotranspiration. Refer to Section <a href="#top-gw-drying-4"><strong>??</strong></a> for more information.</p>
“Factor” applies the defined negative rainfall at a (globally) factored
rate. To set the rate, see <a href="#tcfSoilNegativeRainfallFactor">Soil Negative Rainfall Factor</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSoilNegativeRainfallFactor"><tcmd>Soil Negative Rainfall Factor  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> factor <span class="math inline">\(\rangle\)</span>  |  {1}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Sets the factor value when <a href="#tcfSoilNegativeRainfallApproach">Soil Negative Rainfall Approach</a> has been
set to “factor”. The default factor is 1, meaning that the full value of
the negative rainfall is applied. Refer to Section <a href="#top-gw-drying-4"><strong>??</strong></a> for more
information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSolutionScheme"><tcmd>Solution Scheme  </tcmd><teq>==<br></teq></a> <tblk>[ {CLASSIC}  |  HPC  |  HPC 1st ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This command defines the 2D solution scheme to be used for a simulation.</p>
<p>Options are:</p>
<ul>
<li>CLASSIC: the simulation will use TUFLOW’s finite difference implicit 2<sup>nd</sup> order solver (the default option).</li>
<li>HPC: the simulation will use TUFLOW HPC’s finite volume explicit 2<sup>nd</sup> order solver.</li>
<li>HPC 1st: uses TUFLOW HPC’s finite volume explicit 1<sup>st</sup> order solver. When using HPC, the 2<sup>nd</sup> order solver is recommended over the 1<sup>st</sup> order alternative due to its greater accuracy.</li>
</ul>
Refer to Section <a href="#tuflow-hpc-2d-solver"><strong>??</strong></a> for a description of TUFLOW HPC and Section <a href="#tuflow-classic-2d-solver"><strong>??</strong></a> for a description of TUFLOW Classic.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSpatialDatabase"><tcmd>Spatial Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> GPKG database <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the database to use for subsequent inputs when using the GeoPackage format. For more information see Section <a href="#GPKG-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSpatialDatabaseOutput"><tcmd>Spatial Database Output </tcmd><teq>==<br></teq></a> <tblk>[ SEPARATE | {GROUPED} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets how the outputs are written when using GeoPackages, see Section <a href="#GPKG-output-4"><strong>??</strong></a>.</p>
<p>Options are:</p>
<ul>
<li>Grouped (default): outputs will be grouped by folder location. For example all check file outputs will be contained within one database.</li>
<li>Separate: outputs will be grouped by geometry only.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfStart1DDomain"><tcmd>Start 1D Domain </tcmd></a></li>
</ul>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Indicates the start of a block of 1D Commands (see Appendix <a href="#ECFCommands-1"><strong>??</strong></a>) in the .tcf file. Block must be terminated by using <a href="#tcfEnd1DDomain">End 1D Domain</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfStart2DDomain"><tcmd>Start 2D Domain </tcmd><teq>==<br></teq></a> <tblk>[ {}  |  <span class="math inline">\(\langle\)</span> 2d_domain_name <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Indicates the start of a block of commands that define a 2D domain (see Section <a href="#TwoD2DLinkingM2D-3"><strong>??</strong></a>). If no 2d_domain_name is specified, the 2D domain is automatically assigned
a name. The name is solely used for reporting in the .tlf file and
elsewhere. Also see <a href="#tcfEnd2DDomain">End 2D Domain</a>. If there is only one 2D domain, this command is optional.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfStartMapOutput"><tcmd>Start Map Output </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The simulation time in hours when map output commences. If the command
is omitted, the simulation start time is used.</p>
<p>This command can be defined for different output formats by including
the output format extension on the left of the command. For example, to
set the start time for XMDF output to 1hr use:</p>
<p><tcmd>XMDF Start Map Output</tcmd> <teq>==</teq> <tblk>1</tblk></p>
<p>This output format specific functionality is also available for commands
<a href="#tcfEndMapOutput">End Map Output</a>, <a href="#tcfMapOutputInterval">Map Output
Interval</a> and <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a>. Refer to Section <a href="#Map-2"><strong>??</strong></a>.</p>
This command can be used within an Output Zone definition block to
change the setting from that for the entire model map output.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfStartTime"><tcmd>Start Time </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Specifies the start time of the simulation in hours (see Section <a href="#TCF-3"><strong>??</strong></a>). Value can be
negative and it is recommended that it be relative to midnight for
historical events.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfStartTimeSeriesOutput"><tcmd>Start Time Series Output </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The simulation time in hours when time series (PO and LP) output commences (see Section <a href="#TwoDTS-3"><strong>??</strong></a>). If the command is omitted, the simulation start time is used.
Also see <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSupercritical"><tcmd>Supercritical </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  |  PRE 2002-11-AD ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>Sets the supercritical flow mode. If set to ON (the default), flow
automatically switches into upstream controlled friction flow, allowing
the supercritical flow conditions on steep slopes to be modelled. See
Section <a href="#CLA-US-Controlled-3"><strong>??</strong></a> and <a href="#tcfFroudeCheck">Froude Check</a> for more
details.</p>
<p>If set to OFF, and <a href="#tcfFreeOverfall">Free Overfall</a> is set to ON, the
broad-crested weir formula applies where flow conditions are predicted
to be upstream controlled.</p>
Setting to PRE 2002-11-AD provides backward compatibility for
simulations carried out using supercritical flow prior to Build
2002-11-AD. In Build 2002-11-AD, additional checks using the Froude
Number specified by <a href="#tcfFroudeCheck">Froude Check</a> were incorporated in
addition to the downstream/upstream controlled flow check comparison.
This may produce different results in some flow conditions. The ON
option is to be used in preference to the PRE 2002-11-AD option.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSWMMControlFile"><tcmd>SWMM Control File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .tscf_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the TUFLOW SWMM control file (.tscf), see Section <a href="#TSCF-3"><strong>??</strong></a> for details. See Appendix <a href="#TSCFCommands-1"><strong>??</strong></a> for a list of the SWMM control file commands.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXFlowDist"><tcmd>SX Flow Distribution Cutoff Depth </tcmd><teq>==<br></teq></a> <tblk>[ {AUTO}  |  <span class="math inline">\(\langle\)</span> depth_m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Sets the depth of water below which an SX boundary cell will not receive
flows from the connected 1D element. The default value {AUTO} equals
three times 1.5 times the <a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a>.</p>
<p>Prior to the 2016-03 TUFLOW release this was set to 0.0, as soon as the
cell was wet, flow was applied. Set to 0.0 for backward compatibility.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXFMPUnitTypeError"><tcmd>SX FMP Unit Type Error </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  Off ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>For 2D SX connections linked to Flood Modeller Pro (FMP) (Section <a href="#OneD2DLinkingFM-2"><strong>??</strong></a>) a check is
performed that the FMP node has been assigned as a HTBDY node. If this
is not the case, a spatial message (<a href="https://wiki.tuflow.com/TUFLOW_Message_2043">ERROR 2043</a>) is issued and the
simulation is stopped.</p>
This error message can be set to a warning with the .tcf command “<tcmd>SX FMP Unit Type Error</tcmd> <teq>==</teq> <tblk>OFF</tblk>”. If set to off, the above will cause a <a href="https://wiki.tuflow.com/TUFLOW_Message_2043">WARNING
2043</a> to be issued, but the simulation will be allowed to continue.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXHeadAdjustment"><tcmd>SX Head Adjustment </tcmd><teq>==<br></teq></a> <tblk>[ ON |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If OFF (the default), makes no adjustment for energy compatibility (i.e.
the 1D water level and 2D water level are set as equal to each other at
the 2D SX link). See Section <a href="#SXBoundary-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXHeadDistributionCutoffDepth"><tcmd>SX Head Distribution Cutoff Depth </tcmd><teq>==<br></teq></a> <tblk>[ {AUTO}  |  <span class="math inline">\(\langle\)</span> depth_m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>At an SX link (see Section <a href="#SXBoundary-3"><strong>??</strong></a>), the water level sent through to the 1D node is based on
the water levels of the wet SX cells. Prior to the 2017 release, this
level was simply the average of the wet cells. This approach can cause
issues where there are a slightly wet SX cells that are elevated above
the SX cells within the main flow path. This primarily occurs if using
direct rainfall, or if there is some side flow cascading down the higher
SX cells.</p>
<p>For the 2017 release onwards, the default is to calculate the 1D water
level based on proportioning to the SX cell depth. This means that the
water level transferred to the 1D node is biased to that of the deeper
cells.</p>
If depth_m is set to AUTO or is greater than 0.0001, any wet SX cells
with a depth less than depth_m is excluded, and the 1D water level is
calculated as a depth weighted average of the remaining wet SX cells.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXStorageApproach"><tcmd>SX Storage Approach </tcmd><teq>==<br></teq></a> <tblk>[ {1D NODE AVERAGE}  |  Cell Only ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>As of the 2017-09 release the default is to distribute the average 1D
node storage across connected SX cells (see Section <a href="#SXBoundary-3"><strong>??</strong></a>). For backward compatibility in
legacy models, and to not assign additional storage to the 2D SX cells
based on the 1D node details, set the SX Storage Approach to Cell Only.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXStorageFactor"><tcmd>SX Storage Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.0, 20.0}  |  <span class="math inline">\(\langle\)</span> sxs_factor <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> sxs_limits <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
&lt;sxs_factor&gt; is a multiplier that globally adjusts all additional
storages applied to SX cells (see Section <a href="#SXBoundary-3"><strong>??</strong></a>). &lt;sxs_limits&gt; sets the limit by which an
SX cell can have its storage increased in addition to its own storage.
By default, this is a factor of 20, in which case, if a 1D node’s
storage increases an SX cell’s additional storage by more than 20, the
factor is limited to 20. </sxs_limits></sxs_factor>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSXZCCheck"><tcmd>SX ZC Check </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  |  <span class="math inline">\(\langle\)</span> dZ_limit_in_m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If ON (the default), checks whether the minimum ZC elevation at or along a SX object (see Section <a href="#SXBoundary-3"><strong>??</strong></a>) is below the connected or snapped 1D node bed level. This is necessary to ensure that the channels connected to the
node only start flowing once the 2D SX cell is wet and the water level
in the cell is above the lowest channel bed. If the ZC elevation is
higher than the lowest channel, unexpected flows or a surge of water may
occur in the 1D channels.</p>
<p>Using the “Z” flag (see SX in Table <a href="#tab:tab-ConditionsAttribute">78</a>), the ZC elevation is
automatically lowered at each cell associated with a SX object to below
the connected or snapped 1D node bed level. Only ZC elevations that are
above the node are lowered. The checks and any automatic lowering of ZC
points includes the <a href="#tcfCellWetDryDepth">Cell Wet/Dry Depth</a> value so
that the ZC elevation is below the node bed less the cell wet/dry depth.</p>
<p>If OFF, higher ZC elevations are allowed and no automatic lowering of ZC
elevations occurs.</p>
A value may be entered to set a maximum permitted change in ZC elevation
caused by the use of any “Z” flags for 2D SX links. For example, if <tcmd><a href="#tcfSXZCCheck">SX ZC Check</a></tcmd> <teq>==</teq> <tblk>0.5</tblk> is specified, then if any 2D cell is
lowered by more than 0.5m an <a href="https://wiki.tuflow.com/TUFLOW_Message_2050">ERROR 2050</a> occurs. This allows the modeller
to automatically lower 2D cells within the specified limit, but flag an <a href="https://wiki.tuflow.com/TUFLOW_Message_2050">ERROR 2050</a> if there is a substantial change, which usually indicates
there is something inconsistent between the 1D channel bed and the 2D
topography. <strong>It is strongly recommended that if using the SX Z flag,
that this option is specified.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTIFCompression"><tcmd>TIF Compression </tcmd><teq>==<br></teq></a> <tblk>[ NONE | LZW | {DEFLATE} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the compression for output GeoTIFF grids (see Section <a href="#Grid-4"><strong>??</strong></a>). The following compression methods are available:</p>
<ul>
<li>LZW (Read/Write)</li>
<li>DEFLATE (Read/Write) - default</li>
</ul>
Set to “NONE” to disable compression.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTIFCompressionPredictor"><tcmd>TIF Compression Predictor </tcmd><teq>==<br></teq></a> <tblk>[ NONE | {Horizontal Differencing} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the compression predictor, used to improve the compression ratio for TIF outputs (see Section <a href="#Grid-4"><strong>??</strong></a>). Testing has shown that using deflate compression with “horizontal differencing” (default) will typically achieve better compression than the typical method of using a ZIP file on the same uncompressed data. Can be turned off using “NONE”.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTIFProjection"><tcmd>TIF Projection </tcmd><teq>==<br></teq></a> <tblk>[ /path/to/geotiff ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the .tif file projection for setting the projection of all output layers (e.g. check and result layers), see Section <a href="#GISFormats-3"><strong>??</strong></a>. Currently there is no input projection checking of raster layers.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimeOutputCornerInterpolation"><tcmd>Time Output Corner Interpolation </tcmd><teq>==<br></teq></a> <tblk>[ {VALUE | <span class="math inline">\(\langle\)</span> user specified value <span class="math inline">\(\rangle\)</span>}  |  WET  |  START | <span class="math inline">\(\langle\)</span> Offset <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The tracking of the time of exceedance and duration (e.g. <tcmd>Time Output Cutoff Depths</tcmd> <teq>==</teq> <tblk>0.35, 0.50</tblk>) is completed at each computational
timestep at both the cell centres and the cell corners (Section <a href="#Format-3"><strong>??</strong></a>). This command
allows the user to control how the cell corner values are treated. This
may alter result display on the flood fringe.</p>
<p>VALUE|&lt;user specified value&gt;: The cell corners are given a fixed
value which is user specified. Using this option any cell corners that have
not been exceeded will be given the output value of ‑99. This value
can be used to improve the output contouring. This is the default with a
specified value of -99.</p>
<p>WET: The cell corner values are based on an interpolation of the
surrounding wet cells. Note, this can mask the presence of thin
breaklines in the output.</p>
START | &lt;offset&gt;: The cell corners are given a fixed value based on
the simulation start time plus an offset. </offset></user>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimeOutputCutoff"><tcmd>Time Output Cutoff [Depths | VxD |  <span class="math inline">\(\langle\)</span>Hazard<span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ [ {OFF}  |  <span class="math inline">\(\langle\)</span> v1, v2, … <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If one or more comma or space delimited values are specified using this command, the map output (Section <a href="#Map-2"><strong>??</strong></a>) will contain additional time output in hours for each value v1, v2, … as follows. The type of the values is controlled by the [ Depths | VxD | <span class="math inline">\(\langle\)</span>Hazard<span class="math inline">\(\rangle\)</span> ] setting (only one of these can be specified).</p>
<ul>
<li>Depths is the depth of water</li>
<li>VxD is the velocity times depth product, and</li>
<li>&lt;hazard&gt; must be one of the hazard categories as documented in Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>. VxD and Z0 are one in the same.</li>
</ul>
<ol style="list-style-type: decimal">
<li>The time that a cell first experiences a value greater than each of
<v1 v2>, the simulation time of exceedance is retained, and
included in the map output. If using the .xmdf output format, the
data is accessed using a simulation time of 100,000 + v in the .xmdf
file, where v is v1, v2…. This output is useful for mapping flood
warning times for different depths of inundation or when VxD or
hazard categories are exceeded. When output as a grid (.asc or .flt)
map output format, the file extension given to this output is
_TExc_<cutoff>.<br />
</li>
<li>The duration of time that a cell is inundated above each of <v1 v2> is also retained. For .xmdf file map output the durations
are stored under the time of 200,000 + v, where v is v1, v2…. This
output is useful for mapping duration of inundation above v1, v2, ….
When output as a grid (.asc or .flt) map output format, the file
extension given to this output is _TDur_<cutoff>.</li>
</ol>
Note: If this command is specified more than once, the last one will
prevail. </cutoff></v1></cutoff></v1></hazard>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimeSeriesNullValue"><tcmd>Time Series Null Value </tcmd><teq>==<br></teq></a> <tblk>[ {cell elevation}  |  <span class="math inline">\(\langle\)</span> null value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
A user specified output null value for water level plot outputs if a
cell is dry (see Section <a href="#TimeSeries-2"><strong>??</strong></a>). For other PO outputs, such as; flow, flow area, velocity,
a value of 0.0 is output if a cell is dry.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimeSeriesOutputFormat"><tcmd>Time Series Output Format </tcmd><teq>==<br></teq></a> <tblk>[ {csv} | NC ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This command controls the format of time series outputs written to the results/plot folder. There are two formats available for time series outputs (Section <a href="#TimeSeries-2"><strong>??</strong></a>): comma-separated values (.csv) and NetCDF (.nc).</p>
One of the advantages of NetCDF is all the timeseries output is in a single compressed .nc file, rather than multiple uncompressed .csv files. This can be useful for large 1D models or large amounts of 2d_po data.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimeSeriesOutputInterval"><tcmd>Time Series Output Interval </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The output interval in seconds for time series based output (PO and LP) (see Section <a href="#TwoDTS-3"><strong>??</strong></a>).</p>
Either <a href="#ecfOutputInterval">Output Interval</a> (s) or <a href="#tcfTimeSeriesOutputInterval">Time Series Output
Interval</a> must be specified otherwise an
ERROR 0046 message is output. The default values for these intervals is
the computational timestep, and by not specifying values can cause
excessive amounts of memory to be allocated, sometimes causing
undesirable results!
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimestep"><tcmd>Timestep </tcmd><teq>==<br></teq></a> <tblk>[ {1.0}  |  <span class="math inline">\(\langle\)</span> timestep_in_seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the computation timestep of the simulation in seconds. Value
must be greater than zero. Timesteps that divide equally into one minute
or one hour are recommended. For example, 0.5, 1, 2, 3, 5, 6, 7.5, 10,
12, 15, 20, 30, 45, 60, etc. seconds.</p>
<p>Different timesteps can be specified for different 1D and 2D domains. If
the command is specified outside a <a href="#tcfStart2DDomain">Start 2D Domain</a>
/ <a href="#tcfEnd2DDomain">End 2D Domain</a> block, the timestep will apply to any
2D domain that is not given a timestep. If it is specified within a
<a href="#tcfStart2DDomain">Start 2D Domain</a> / <a href="#tcfEnd2DDomain">End 2D Domain</a>
block it only applies to that 2D domain.</p>
<p>For TUFLOW Classic simulations, the specified value sets the fixed
timestep for the simulation.</p>
<p>For TUFLOW HPC simulations, the specified value sets the initial
timestep for the simulation. All subsequent timesteps are automatically
calculated using an adaptive timestep approach based on control number
criterion.</p>
Refer to Section <a href="#TimestepBackground-2"><strong>??</strong></a> for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimestepInitial"><tcmd>Timestep Initial </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> initial timestep_in_seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>The standard <a href="#tcfTimestep">Timestep</a> command is only used by the HPC
solver for the first timestep if using adaptive timestepping mode, see Section <a href="#TUFLOWHPCTimestep-3"><strong>??</strong></a>. For
consistency with typical Classic timesteps, this timestep is divided by
10 to provide a timestep commensurate with the explicit solution scheme
used by HPC. Therefore, the general advice if using the
<a href="#tcfTimestep">Timestep</a> command is to specify the same timestep as
would typically be used when running the Classic solver. This is usually
one fifth to half of the 2D cell size in metres.</p>
As of the 2017-09-AC Build the <a href="#tcfTimestepInitial">Timestep Initial</a>
command can be used to set the HPC initial timestep directly (i.e. the
timestep is not divided by 10).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimestepMaximum"><tcmd>Timestep Maximum </tcmd><teq>==<br></teq></a> <tblk>[ {Auto}  | <span class="math inline">\(\langle\)</span> max timestep in seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Sets a maximum timestep for the simulation, see Section <a href="#TUFLOWHPCTimestep-3"><strong>??</strong></a>. Particularly useful when running a model with significant periods in which all cells were dry, as the timestep can increase to the map output interval leading to stability issues when the model first wets after a dry period (as the timestep has to reduce rapidly).</p>
<p>If not specified, or set to “Auto”, the maximum timestep is based on the shallow water wave celerity where the wave speed is calculated based on c=√gh where the cell wet/dry depth is used as a water depth (h). The max timestep is calculate as max⁡dt=dx/√gh, so for a 5m cell size with a 2mm wet/dry depth the maximum timestep is 35.7 seconds.</p>
For models with infiltration and direct rainfall with a similar magnitude, it may be desirable to reduce the maximum timestep to avoid repeat timesteps.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimestepMaxInc"><tcmd>Timestep Maximum Increase (%) </tcmd><teq>==<br></teq></a> <tblk>[ {0.5}  |  <span class="math inline">\(\langle\)</span> value_as_a_% <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This command controls the maximum rate at which an adaptive timestep,
using the command <a href="#tcfMaxCourantNumber">Maximum Courant Number</a>, can
increase. There is no limit to how quickly the timestep can decrease.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimestepMinimum"><tcmd>Timestep Minimum </tcmd><teq>==<br></teq></a> <tblk>[ {AUTO }  |  <span class="math inline">\(\langle\)</span> minimun timestep (seconds) <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
The minimum permissible target timestep allowed by the HPC solver (see Section <a href="#TUFLOWHPCTimestep-3"><strong>??</strong></a>). By
default this is set to the minimum of 0.1 seconds or the cell size
divided by 200 m/s. In most cases, where there is no erroneous data or
poor model setup, the target timestep will always be well above the
default minimum timestep. The timestep Minimum value can be manually
specified if desired.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTimestepMinimum"><tcmd>Timestep Repeats </tcmd><teq>==<br></teq></a> <tblk>[ {10 }  |  <span class="math inline">\(\langle\)</span> n_allowed_repeats <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
This command allows the user flexibility to change the allowable number
of TUFLOW HPC repeated timesteps prior to an instability being
triggered (see Section <a href="#TUFLOWHPCTimestep-3"><strong>??</strong></a>). One situation where this might be useful is if a 2D only
model remains totally dry for some time the timestep can become very
large, and then needs to be rapidly reduced once inflows commence.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTSFUpdateInterval"><tcmd>TSF Update Interval </tcmd><teq>==<br></teq></a> <tblk>[ {0}  |  <span class="math inline">\(\langle\)</span> interval_in_sec <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the interval in seconds to update the .tsf file (Section <a href="#TSF-3"><strong>??</strong></a>) while a simulation
is running. If set to 0 or less (the default) the .tsf file is only
updated at the start and the end of the hydrodynamic calculations.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfTutorialModel"><tcmd>Tutorial Model </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
When set to ON, allows simulation of the Tutorial Models without the
need for a TUFLOW license. For further information refer to Section
<a href="#TutorialModels-3"><strong>??</strong></a> and the <a href="https://wiki.tuflow.com/Tutorial_Introduction">Tutorial Introduction TUFLOW Wiki page</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfUKHazardDebrisFactor"><tcmd>UK Hazard Debris Factor </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> DF <span class="math inline">\(\rangle\)</span>  |  {1} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the debris factor (DF) value for calculating the flood hazard
output for options ZUK0 and ZUK1 (see Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>) for <a href="#tcfUKHazardFormula">UK Hazard
Formula</a> == D*(V+0.5)+DF. If a <a href="#tcfUKHazardLandUse">UK Hazard Land
Use</a> is specified, DF is determined from the debris
factor land use table (see <a href="#tcfUKHazardLandUse">UK Hazard Land Use</a>).</p>
The default value is 1.0.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfUKHazardFormula"><tcmd>UK Hazard Formula </tcmd><teq>==<br></teq></a> <tblk>[ [ D<em>(V+1.5)  |  {D</em>(V+0.5)+DF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the formula to be used for calculating the flood hazard output for
options ZUK0 and ZUK1 (see Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>), where D is depth, V velocity and DF Debris Factor
(see <a href="#tcfUKHazardDebrisFactor">UK Hazard Debris Factor</a>). If a <a href="#tcfUKHazardLandUse">UK
Hazard Land Use</a> is set, the D(V+0.5)+DF option is
used irrespective of this command.</p>
<p>ZUK0 produces a .xmdf file containing the actual value from applying the
UK Hazard Formula, while ZUK1 outputs a .xmdf file containing an integer
as per:</p>
<ul>
<li>0 = No Hazard (H <span class="math inline">\(\le\)</span> 0)<br />
</li>
<li>1 = Low Hazard (H <span class="math inline">\(\le\)</span> 0.75)<br />
</li>
<li>2 = Moderate Hazard (H <span class="math inline">\(\le\)</span> 1.25)<br />
</li>
<li>3 = Significant Hazard (H <span class="math inline">\(\le\)</span> 2.5)<br />
</li>
<li>4 = Extreme Hazard (H <span class="math inline">\(\ge\)</span> 2.5)</li>
</ul>
Formulae based on the <span class="citation">DEFRA (<a href="#ref-DEFRA2006">2006a</a>)</span>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfUKHazardLandUse"><tcmd>UK Hazard Land Use </tcmd><teq>==<br></teq></a> <tblk>[ PASTURE  |  WOODLAND  |  URBAN  |  {CONSERVATIVE}  |  NOT SET ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the land use category for varying debris factors with depth and
velocity as specified in DEFRA R&amp;D Outputs: Flood Risks to People Phase
Two Draft FD2321/ TR2, Table 3.1 as shown below. Use NOT SET to ignore
the land use setting and allow use of <a href="#tcfUKHazardDebrisFactor">UK Hazard Debris
Factor</a> and <a href="#tcfUKHazardFormula">UK Hazard
Formula</a> commands. See Table <a href="#tab:tab-MapOutputHazardZTypes">103</a>.</p>
<p>If the <a href="#tcfUKHazardLandUse">UK Hazard Land Use</a> is not specified, and
the default <a href="#tcfUKHazardFormula">UK Hazard Formula</a> is used, the debris
factors for the CONSERVATIVE land use are assumed.</p>
<p>In the table below, the V <span class="math inline">\(\rangle\)</span> 2m/s criteria in the last row is applied at
all depths greater than 0.1m. Occasionally, as a 2D cell wets, a high
velocity may occur, hence the 0.1m cut-off for applying the V <span class="math inline">\(\rangle\)</span>  2m/s
criteria.</p>
<p><strong>Guidance on debris factors (DF) for different flood depths, velocities
and dominant land uses</strong></p>
<table>
<colgroup>
<col width="26%" />
<col width="23%" />
<col width="16%" />
<col width="12%" />
<col width="20%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Depths</strong></td>
<td><strong>Pasture/Arable</strong></td>
<td><strong>Woodland</strong></td>
<td><strong>Urban</strong></td>
<td><strong>Conservative</strong></td>
</tr>
<tr class="even">
<td>0 to 0.25 m</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td>0.25 to 0.75 m</td>
<td>0</td>
<td>0.5</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>d<span class="math inline">\(\rangle\)</span> 0.75 m and/or v<span class="math inline">\(\rangle\)</span> 2</td>
<td>0.5</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
Ref: <span class="citation">DEFRA (<a href="#ref-DEFRA2006b">2006b</a>)</span> Table 3.1.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfUnits"><tcmd>Units </tcmd><teq>==<br></teq></a> <tblk>[ {METRIC}  |  ENGLISH  |  IMPERIAL  |  US Customary ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>By default, TUFLOW uses metric units. Full support for US Customary Units (English or Imperial – they are identical) is available by setting <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq> <tblk>US Customary</tblk>, <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq> <tblk>English</tblk> or <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq> <tblk>Imperial</tblk>. The default settings for all inputs are
the same as for metric, but converted to their US Customary units’ equivalent. Where the manual refers to a default value in metric, TUFLOW will use the equivalent value in US Customary Units. The input and
output units are as follows:</p>
<ul>
<li>Length: feet<br />
</li>
<li>Area: square feet<br />
</li>
<li>Rainfall, Initial Loss and Continuing Loss(/h): inches<br />
</li>
<li>Catchment Area: square miles<br />
</li>
<li>Constant eddy viscosity value: ft<sup>2</sup>/s<br />
</li>
<li>For determination of hazard categories (Z0 and ZUK0) the values are based on using feet and seconds.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfUnusedHXandSXConnections"><tcmd>Unused HX and SX Connections </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  WARNING ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to “ERROR” (the default), any unconnected or redundant CN objects
in 2d_bc layers are treated as an ERROR. This error is typically due to
a CN object not being snapped to a HX or SX object in the same 2d_bc
layer, or the use of two CN objects at either end of a SX line (only one
CN object is required to connect a SX line, thereby making the other one
redundant). See Section <a href="#TwoDBoundaries-2"><strong>??</strong></a>.</li>
</ul>
Setting to “WARNING” will issue a WARNING message but allow TUFLOW to
continue to run. It is not recommended that the WARNING option be used
other than for backward compatibility.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfUseForwardSlash"><tcmd>Use Forward Slash </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON, forward slash (/), rather than backslash (\, is used in
the text output files contain file paths (e.g. .tlf, .qgis, .tpc, .wor).
For LINUX systems forward slash must be used, while for Windows either
can be used. See Section <a href="#FilePath-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfVerbose"><tcmd>Verbose </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  OFF  |  {LOW}  |  HIGH ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls the amount of information displayed on the DOS console window and written to the .tlf. The options are:</p>
<ul>
<li><p>OFF: lowest level volume of content.<br />
</p></li>
<li><p>LOW: a medium level of reporting (the default).<br />
</p></li>
<li><p>ON: highest level volume of content.<br />
</p></li>
<li><p>HIGH: controls the amount of information displayed on the DOS
console window. It is the highest level of reporting, in addition DOS
consult window test associated with the ON option, all input commands
will also be echoed. They will be prefixed with “&lt;&lt;”. When HIGH is
used the .tlf write verbose setting is LOW.</p>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<p><a id="tcfVGZAdjustment"><tcmd>VG Z Adjustment </tcmd><teq>==<br></teq></a> <tblk>[ {MAX ZC}  |  ZC  |  ZH ]</tblk><br></p>
</td>
<td style="text-align:left;vertical-align:top;">
<p>Classic Only</p>
</td>
<td style="text-align:left;">
<p>When using the VG boundary (Section <a href="#TwoDBoundaries-2"><strong>??</strong></a>). Options are:</p></li>
<li><p>MAX ZC (the default setting): This forces the adjusted ZU/ZV and ZH points to be set to the maximum
ZC value rather than an interpolated ZC value. This option provides significant enhancements in some
situations to the stability of the flow over the breach.<br />
</p></li>
<li><p>The ZC option adjusts ZU/ZV and ZH points to be the average of the neighbouring ZC elevations.<br />
</p></li>
<li><p>The ZH option provides backward compatibility for models using the original VG adjustment of Zpts based on changing the ZH values.</p>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<p><a id="tcfViscosityApproach"><tcmd>Viscosity Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A  | {Method B} ]</tblk><br></p>
</td>
<td style="text-align:left;vertical-align:top;">
<p>HPC Only</p>
</td>
<td style="text-align:left;">
<p>Sets the viscosity approach, from the 2020 release onwards “Method B” is the default (which is based on the approach developed for TUFLOW Classic). For backward compatibility, the previous approach “Method A” can be used.</p>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<p><a id="tcfViscosityCoefficient"><tcmd>Viscosity Coefficient </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value1, value2, … <span class="math inline">\(\rangle\)</span> ]</tblk><br></p>
</td>
<td style="text-align:left;vertical-align:top;">
<p>Classic and HPC</p>
</td>
<td style="text-align:left;">
<p>Sets the viscosity coefficient(s) for the chosen <a href="#tcfViscosityFormulation">Viscosity Formulation</a> (see Sections <a href="#turbulence-overview"><strong>??</strong></a>, <a href="#HPC-Turbulence-3"><strong>??</strong></a> and <a href="#CLA-Turbulence-3"><strong>??</strong></a>).</p></li>
</ul>
<p>Options are:</p>
<ul>
<li>“CONSTANT”: reads one value for the constant viscosity. The default value is 0.05 m<sup>2</sup>/s for Metric Units and 0.5382 ft<sup>2</sup>/s for US Customary Units.<br />
</li>
<li>“SMAGORINSKY”: reads two values, the first being the Smagorinsky coefficient, and the second (optional) the constant eddy viscosity component. The
default values are 0.5 and 0.05 m<sup>2</sup>/s respectively for
Metric units and 0.5 and 0.5382 ft<sup>2</sup>/s for US customary
units (note that the Smagorinsky coefficient is dimensionless).<br />
</li>
<li>“WU”: reads up to three values, the first being the Wu3D coefficient,
the second being the Wu2D coefficient, and the third (optional) being
the Manning’s upper limit for the 3D component of the calculation. The default values
are 7.0, 0.0, and 0.1 respectively regardless of units.<br />
</li>
<li>“NON-NEWTONIAN”: reads 5 values (refer Section <a href="#NN-3"><strong>??</strong></a>). These are <em>k</em>, <em>n</em>, <span class="math inline">\(\mu_{low}\)</span>,
<span class="math inline">\(\mu_{high}\)</span>, and <span class="math inline">\(\tau_{0}\)</span>. There are no default values, the
coefficients must be specified if the non-Newtonian viscosity
formulation is selected. Note these values must be specified in the
system of units selected.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfViscosityFormulation"><tcmd>Viscosity Formulation </tcmd><teq>==<br></teq></a> <tblk>[ CONSTANT  |  SMAGORINSKY  |  WU  |  NONNEWTONIAN ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the viscosity formulation (see Sections <a href="#turbulence-overview"><strong>??</strong></a>, <a href="#HPC-Turbulence-3"><strong>??</strong></a> and <a href="#CLA-Turbulence-3"><strong>??</strong></a>).</li>
</ul>
<p>Options are:</p>
<ul>
<li>“CONSTANT”: the viscosity coefficient remains constant<br />
</li>
<li>“SMAGORINSKY”: applies a hybrid approach that includes elements of both the Constant and Smagorinsky approaches<br />
</li>
<li>“WU”: applies the WU model with 3D and 2D coefficients<br />
</li>
<li>“NON-NEWTONIAN”: selects the non-Newtonian calculation</li>
</ul>
<p>TUFLOW Classic only supports CONSTANT and SMAGORINSKY, with the default being SMAGORINSKY</p>
TUFLOW HPC supports all, with the default being WU.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWaterLevelChecks"><tcmd>Water Level Checks </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
The default ON option carries out checks on water levels to detect any
significant instabilities. Instabilities are triggered when a water
level exceeds the <a href="#tcfInstabilityWaterLevel">Instability Water Level</a>
or falls below the negative of the <a href="#tcfInstabilityWaterLevel">Instability Water
Level</a>. Switching this option off reduces the
computation time very slightly. See Section <a href="#tuflowinstability-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWettingandDrying"><tcmd>Wetting and Drying </tcmd><teq>==<br></teq></a> <tblk>[ {ON METHOD B}  |  ON  |  ON NO SIDE CHECKS  |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Controls the wetting and drying method.</p>
<p>The ON METHOD B approach (default) introduced an enhanced wetting
algorithm in the 2012-05 release that provides significant improvement
to inflows on steep areas (e.g. direct rainfall models), whilst
maintaining low mass error, greater stability and often larger
timesteps. Use of this approach does not require use of the <a href="#tcfShallowDepthStabilityFactor">Shallow
Depth Stability Factor</a> that was
previously automatically invoked for direct rainfall models. This method
makes an estimate of the likely velocity that will occur when a cell
side first wets and feeds this information into the solution matrices.
Previously, the velocity used was that from the previous timestep which
was zero as the cell side was dry. The zero velocity essentially created
a frictionless slope and would cause a surge of water, albeit very
shallow, when the cell side first wets. This was not usually a major
issue, however, with direct rainfall models all cell sides can become
wet in one timestep and if the terrain is steep a significant surge and
unacceptable mass errors would occur. This method largely overcomes this
effect.</p>
<p>The (pre 2012-05 default) ON approach dries cells once the cell water
depth falls below the cell wet/dry depth (see <a href="#tcfCellWetDryDepth">Cell Wet/Dry
Depth</a> and <a href="#tcfCellSideWetDryDepth">Cell Side Wet/Dry
Depth</a>). A cell becomes wet once an adjoining
cell’s water level is higher than the cell’s wet/dry depth. This method
only considers adjoining wet cells that share a common cell side that is
wet.</p>
<p>The ON NO SIDE CHECKS option is as described above, except that drying
at the cell sides is not considered. All four adjoining cells are always
considered.</p>
<p>The OFF option disables wetting and drying. This should only be used for
models that have no cells likely to wet and/or dry.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWIBUFIRMCodeSearchOrder"><tcmd>WIBU FIRM Code Search Order </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> list of firm codes <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to control the search order in the TUFLOW_licence_settings.lcf (not
the TCF) the command specified is “<tcmd>WIBU Firm Code Search Order</tcmd> <teq>==</teq> <tblk><list of firm codes></list></tblk>”. See Section <a href="#DongleAccessProtocols-4"><strong>??</strong></a>.</p>
<p>With numerous licencing options available, setting the preferred licence
type can speed simulation start-up. The licence search order can be set
via a licence control file “TUFLOW_licence_settings.lcf”, this replaces
the TUFLOW_Dongle_Settings.dcf. Note that this file can occur in several
locations. When looking for a licence setting file TUFLOW searches in
the following locations:</p>
<ul>
<li>A “TUFLOW_licence_settings.lcf” in the same location as the TUFLOW
&gt; executable. This is given the highest priority.<br />
</li>
<li>C:_WBM_Licence_Settings.lcf<br />
</li>
<li>C:_WBM_Dongle_Settings.dcf</li>
</ul>
<p>The firm codes used below are unique identifiers used by Wibu.</p>
<table>
<thead>
<tr class="header">
<th>Vendor / Licence Description</th>
<th>Wibu Firm Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BMT physical dongle</td>
<td>101139</td>
</tr>
<tr class="even">
<td>BMT software licence</td>
<td>6000224</td>
</tr>
<tr class="odd">
<td>Aquaveo physical licence</td>
<td>101394</td>
</tr>
<tr class="even">
<td>Jacobs physical licence</td>
<td>101987</td>
</tr>
<tr class="odd">
<td>Jacobs software licence</td>
<td>5000219</td>
</tr>
</tbody>
</table>
<p>If multiple firmcodes are to be used these are entered with a space
between the values. For example, in the below, this sets the search
order to BMT software lock licences, then BMT hardware lock (dongle)
licences.</p>
<p><tcmd>WIBU Firm Code Search Order</tcmd> <teq>==</teq> <tblk>6000224 101139</tblk></p>
<p>Any firm codes not listed are not used. For example to search for only
an Aquaveo hardware lock licence, the .lcf command would be:</p>
<tcmd>WIBU Firm Code Search Order</tcmd> <teq>==</teq> <tblk>101394</tblk>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWindWaveShallowDepths"><tcmd>Wind/Wave Shallow Depths </tcmd><teq>==<br></teq></a> <tblk>[ {0.2, 1.0}  |  <span class="math inline">\(\langle\)</span> y1, y2 <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Sets the depth of water when the wind and/or wave stress (Section <a href="#ExternalStress-2"><strong>??</strong></a>) are reduced to
zero. This command is necessary to avoid a divide by zero error in the numerical calculation, and model
instabilities when high wind/wave stresses are applied to very
shallow depths. Below y1, the stress is set to zero, above y2 the full
stress is applied, and between y1 and y2 the stress is interpolated. y1
and y2 are in metres (or feet if using <tcmd>
<a href="#tcfUnits">Units</a>
</tcmd>
<teq>==</teq><tblk>US Customary</tblk>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteCheckFiles"><tcmd>Write Check Files [ {ALL} | NONE | INCLUDE | EXCLUDE ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> prefix_list_or_file_prefix <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Creates GIS check files in the format specified by the <a href="#tcfGISFormat">GIS Format</a> command and text .csv files
for quality control checking of model input data. Refer to Section <a href="#CheckLayers-2"><strong>??</strong></a> for further details on the check files produced. The
options available for this command can be used to control which check
layers are written.</p>
<p>The EXCLUDE or INCLUDE options allow for a space delimited list of file
prefixes to be specified to exclude or include GIS layers from being
written. Prefixes must be the same as those used by TUFLOW. For example,
“zpt” would apply to the zpt_check layer. To exclude/include more than
one layer ensure there are spaces between the prefixes. If EXCLUDE or
INCLUDE occurs more than once, the latter occurrence prevails.</p>
<p><strong>Examples:</strong></p>
<p><tcmd>Write Check Files EXCLUDE</tcmd> <teq>==</teq> <tblk>zpt uvpt</tblk> <tgrn>! excludes writing of the zpt_check and uvpt_check layer</tgrn></p>
<p><tcmd>Write Check Files INCLUDE</tcmd> <teq>==</teq> <tblk>DEM_Z</tblk> <tgrn>! will only write the Grid of the model’s ground elevations to the same location as the .tcf file.</tgrn></p>
<p>The ALL option requires no prefix list. All check files will be written
to the same folder as the .tcf file. Specification of the ALL option
will nullify any prior occurrence of an EXCLUDE or INCLUDE list; this is
useful if you wish to write no or all check files for one particular run
– simply add Write Check Files ALL to the end of the .tcf file.</p>
<p>Alternatively, the Write Check Files command may be used without options
to add a prefix to all check files or specify a location in which to
write the files. If &lt;file_prefix&gt; is omitted or ends in a “\ to
indicate a folder, the .tcf filename (without the .tcf extension) is
prefixed to each check file. &lt;prefix_list&gt; can include a folder path
that is normally set to the check folder. See the examples below for
this subtle difference.</p>
<p><strong>Examples:</strong></p>
<p><tcmd>Write Check Files ALL</tcmd> <tgrn>! writes all check files with no prefix to the same location as the .tcf file.</tgrn></p>
<p><tcmd>Write Check Files</tcmd> <teq>==</teq> <tblk>C:\tuflow\check\2d</tblk> <tgrn>! writes all check files to the folder “C:\tuflow\check” and prefixes them with “2d”</tgrn></p>
<p><tcmd>Write Check Files</tcmd> <teq>==</teq> <tblk>C:\tuflow\check</tblk> <tgrn>! writes all check files to the folder “C:\tuflow\check” and prefixes with the .tcf filename</tgrn></p>
<p><tcmd>Write Check Files</tcmd> <teq>==</teq> <tblk>C:\tuflow\check</tblk> <tgrn>! writes all check files to the folder “C:\tuflow” and prefixes with “check”</tgrn></p>
<p>The NONE option is similar to the ALL option and requires no prefix
list. No check files will be written and specification of the NO option
will nullify any prior occurrence of an EXCLUDE or INCLUDE list.</p>
<p><strong>Examples:</strong></p>
<p><tcmd>Write Check Files NONE</tcmd> <tgrn>! will suppress the writing of all check files</tgrn></p>
<p>Specifying the <a href="#tcfWriteCheckFiles">Write Check Files</a> command in the
.tcf file will now automatically also write the 1D check files. There is
no need to specify <a href="#ecfWriteCheckFiles">Write Check Files</a> in the .ecf
file unless a different folder path for the files is desired.</p>
This command can be used within an Output Zone definition block to
change list of check files to exclude or include for the Output Zone.
However, the output path of the check files cannot be specified for
Output Zones. </prefix_list></file_prefix>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteEmptyGISFiles"><tcmd>Write Empty GIS Files </tcmd><teq>==<br></teq></a> <tblk>[ {}  |  <span class="math inline">\(\langle\)</span> folder <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> file_format <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Creates empty (template) 1D and 2D GIS files in the format specified by the <a href="#tcfGISFormat">GIS Format</a> command. If no <a href="#tcfGISFormat">GIS Format</a> has been set, the empty files will be in MIF format by default. Each empty layer as described in Table <a href="#tab:tab-RecommendedPrefixes2DDomain">6</a> and Table <a href="#tab:tab-RecommendedPrefixes1DDomain">7</a> is produced with the required attribute definitions pre-defined, but containing no geographic objects. Provided the <a href="#tcfGKGProjection">GPKG Projection</a>, <a href="#tcfSHPProjection">SHP Projection</a> or <a href="#tcfMIProjection">MI Projection</a> command has been previously specified, each layer has the correct GIS projection.</p>
<p>The layers are prefixed using the prefixes defined in Table <a href="#tab:tab-RecommendedPrefixes2DDomain">6</a> and Table <a href="#tab:tab-RecommendedPrefixes1DDomain">7</a>, and are given a suffix of “_empty”.</p>
<p>If &lt;folder&gt; is specified, the GIS files are located in the folder. If the folder does not already exist, it will be created.</p>
<p>It is possible to add a second argument after defining the folder, which can also be used to set the required format of the empty files, as shown in the second example below.</p>
<p><strong>Examples:</strong></p>
<p><tcmd>Write Empty GIS Files </tcmd><teq>==</teq><tblk> ..\model\gis\empty </tblk></p>
<p><tcmd>Write Empty GIS Files </tcmd><teq>==</teq><tblk> ..\model\gis\empty | SHP </tblk></p>
After writing the files, TUFLOW stops executing. </folder>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWritePOOnline"><tcmd>Write PO Online </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON writes the 1D and 2D time-series data files as the
simulation progresses (see Section <a href="#TimeSeries-2"><strong>??</strong></a>). The _TS GIS file is only written if there is a
1D domain in the model. The files are closed off so that they can be
opened in Excel or other software for viewing during a simulation,
however, opening the files in some software (e.g. Excel) may cause
TUFLOW to pause at the next output time until the files are closed. If
set to OFF the files are not written until the simulation finishes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteRestartFileatTime"><tcmd>Write Restart File at Time </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets when to write the restart file (Section <a href="#RestartFiles-3"><strong>??</strong></a>) in hours. The restart files are
written to the results folder.</p>
<p>The restart file is given the extension .trf. An .erf file is also
written for the 1D components if there is 1D/2D dynamic linking. The
.trf file is a binary file and not readable by a text editor. The .erf
file is a text file and is readable by a text editor. The first line of
the .erf file shows the time when the restart files were written. The
time(s) when the restart files are written are displayed in the log
file(s).</p>
If the time is before the simulation start, the start time is used. Only
the last occurrence of this command is used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteRestartFileInterval"><tcmd>Write Restart File Interval </tcmd><teq>==<br></teq></a> <tblk>[ {0}  |  <span class="math inline">\(\langle\)</span> interval_in_hours <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the interval in hours between writing the restart file (Section <a href="#RestartFiles-3"><strong>??</strong></a>). The restart
file is overwritten every &lt;interval_in_hours&gt; after the first restart
file write. This is useful if a simulation is going unstable. A restart
file is written prior to the instability, and is used to restart the
simulation after modification of the topography to control the
instability – thereby saving time in reaching the time of instability.</p>
<p>If set to zero, the default, or is negative, the restart file is written
only once at the write restart file time. Only the last occurrence of
this command is used.</p>
<p>The restart files are written in a result folder called “trf”.</p>
Refer also to the command <a href="#tcfWriteRestartFilename">Write Restart
Filename</a>. </interval_in_hours>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteRestartFileVersion"><tcmd>Write Restart File Version </tcmd><teq>==<br></teq></a> <tblk>[ 2 ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Uses a more detailed dump of the 2D domains that will result in a more
precise restart (see Section <a href="#RestartFiles-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteRestartFilename"><tcmd>Write Restart Filename </tcmd><teq>==<br></teq></a> <tblk>[ {INCLUDE TIME}  |  OVERWRITE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Command to control whether restart files (Section <a href="#RestartFiles-3"><strong>??</strong></a>) are overwritten or are time-stamped.</p>
<p>If INCLUDE TIME (the default) is specified, .trf and .erf filenames are
time-stamped and written for each restart output time.</p>
<p>OVERWRITE is the case for all prior versions of TUFLOW where the .trf
and .erf files are overwritten each time restart files are written. If
<tcmd><a href="#tcfDefaults">Defaults</a></tcmd> <teq>==</teq> <tblk>PRE 2013</tblk> is set the default setting is
OVERWRITE.</p>
To output restart files at regular intervals use the command <a href="#tcfWriteRestartFileInterval">Write
Restart File Interval</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfWriteX1DCheckFiles"><tcmd>Write X1D Check Files </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to ON, writes out check_x1D_H_to_2D.csv and check_2D_Q_to_x1D.csv
files that contain the water levels sent to the 2D and the flows sent by
the 2D to/from an external 1D scheme such as Flood Modeller or XP-SWMM. See Section <a href="#oneD2DFMLinking2D-3"><strong>??</strong></a>.</p>
Note that <a href="#tcfWriteCheckFiles">Write Check Files</a> must be also be
specified (and not set to NONE).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfXFFiles"><tcmd>XF Files </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the global default for whether or not to automatically generate XF
files. See Section <a href="#XF-Files-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfXFFilesBoundaries"><tcmd>XF Files Boundaries </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
XF files (Section <a href="#XF-Files-2"><strong>??</strong></a>) are used to speed up the reading of boundary data in both .csv and .ts1 file formats. This works for data referenced from the “<a href="#tcfBCDatabase">BC Database</a>” and “<a href="#ecfPitInletDatabase">Pit Inlet Database</a>”. As with other .xf files
created by TUFLOW (for example using “<a href="#tgcReadGridZpts">Read Grid Zpts</a>”), the save date of the .xf file is compared to the save date of the original data file (.csv or .ts1). If the original dataset has been modified since the .xf
file was created the original dataset is re-read and the .xf file
regenerated. XF files can be turned off globally with the .tcf command:
<a href="#tcfXFFiles">XF Files</a>, or just for the new boundary/pit database files
using
<tcmd>XF Files Boundaries</tcmd> <teq>==</teq> <tblk>OFF</tblk>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfXFFilesIncludeinFilename"><tcmd>XF Files Include in Filename </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> text <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Appends &lt;text&gt; to the end of XF filenames (see Section <a href="#XF-Files-2"><strong>??</strong></a>). This command prevents the
reprocessing of the DEM each time a different model utilising the same
DEM is run. </text>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfXMDFOutputCompression"><tcmd>XMDF Output Compression </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF  |  <span class="math inline">\(\langle\)</span> level <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the file compression level of XMDF map output files (Section <a href="#MeshBased-4"><strong>??</strong></a>). If set to ON,
the default, compression level 1 is applied. A maximum compression level
of 9 is allowed. The greater the compression the smaller the file sizes,
but the slower the access speed when writing and reading the file.
Testing has indicated that a compression level of 1 reduces file sizes
by 70 to 80% with little change in access speeds.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfZeroNegativeDepths"><tcmd>Zero Negative Depths </tcmd><teq>==<br></teq></a> <tblk>[ {ON}  |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>This is a legacy command provided for backward compatibility. Setting to
ON zeroes depths at cell corners for map output if negative. The
negative depth could arise in old builds of TUFLOW when interpolating
the water level at the cell corners from the surrounding cell centres,
due to the ZH Zpt being higher than the interpolated water level.</p>
<p>Setting to OFF disables this command and should only be effective if the
original cell interpolation method (<tcmd><a href="#tcfMapOutputCornerInterpolation">Map Output Corner Interpolation</a></tcmd> <teq>==</teq> <tblk>METHOD A</tblk>) applies. Using the OFF
option is not recommended.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfZeroRainfallCheck"><tcmd>Zero Rainfall Check </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR}  |  WARNING ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Introduced for the 2016-03 release to set the level for <a href="https://wiki.tuflow.com/TUFLOW_Message_2460">Message 2460</a> that reports whether the f1 and/or f2 attribute is set to zero for a 2d_rf
layer (see Section <a href="#RF-Layers-4"><strong>??</strong></a>). For the 2016-03 release the message is treated as an ERROR and
the simulation will terminate, unless <tcmd><a href="#tcfDefaults">Defaults</a></tcmd> <teq>==</teq> <tblk>PRE 2016</tblk> is set or this command is set to WARNING.</p>
Prior to the 2016-03 release this message was only issued as a WARNING.
For further information see the <a href="https://wiki.tuflow.com/TUFLOW_Message_2460">Message 2460 Wiki
Page</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfZPHazardCutoffDepth"><tcmd>ZP Hazard Cutoff Depth </tcmd><teq>==<br></teq></a> <tblk>[ {0.01}  |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  |  <span class="math inline">\(\langle\)</span> value_ZPA <span class="math inline">\(\rangle\)</span> <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>_ZPC <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>_ZPI ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
<p>This command can be used when specifying the ZPA, ZPC, and ZPI hazard
map outputs, based on the People Hazard categories within the Australian
Rainfall and Runoff (ARR) Project 10 Stage One report <span class="citation">(<a href="#ref-CoxShard2010">Cox et al., 2010</a>)</span>. Refer to Table <a href="#tab:tab-MapOutputHazardZTypes">103</a> for more
information.</p>
If one value is specified, the cutoff depth to define when the Safe
category applies is the same for ZPA, ZPC and ZPI. If three values are
specified, these are the cutoff depths for ZPA, ZPC and ZPI
respectively. The default is 0.01m (i.e. if the depth is below 0.01m
(1cm), the hazard category is Safe for ZPA, ZPC and ZPI).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfZptRangeCheck"><tcmd>Zpt Range Check </tcmd><teq>==<br></teq></a> <tblk>[ {-9998, 99998}  |  <span class="math inline">\(\langle\)</span> zmin <span class="math inline">\(\rangle\)</span>,<span class="math inline">\(\langle\)</span> zmax <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>Reports an <a href="https://wiki.tuflow.com/TUFLOW_Message_2444">ERROR 2444</a> (<a href="https://wiki.tuflow.com/TUFLOW_Message_2444">WARNING 2444</a> if <tcmd><a href="#tcfDefaults">Defaults</a></tcmd> <teq>==</teq> <tblk>Pre 2012</tblk>) if any final Zpt is less than zmin or greater than zmax. The
defaults for zmin and zmax are -9998 and 99998 (-9998 is used for the
minimum value as some 3D surface software use -9999 as the null value).
Useful for checking there are no Zpts with inappropriate values. This
check is only carried out once on the final Zpt values just before the
simulation starts, and after writing the <a href="https://wiki.tuflow.com/Check_Files_2d_zpt">_zpt_check</a> layer. In the
unlikely event of an invalid or NaN Zpt occurring an <a href="https://wiki.tuflow.com/TUFLOW_Message_2445">ERROR 2445</a> (or
<a href="https://wiki.tuflow.com/TUFLOW_Message_2445">WARNING 2445</a>) is issued.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfSQLiteOnOpenSQL"><tcmd>SQLite On Open SQL [ {} | Read | Write ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> SQL Pragma Command <span class="math inline">\(\rangle\)</span> | {} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Executes SQL command(s) when a GPKG database is initially opened. This command is intended to be used to change general SQLite database settings without the need for TUFLOW to provide custom commands for each setting. Typically these would be what SQLite calls ‘PRAGMA’ commands. Database settings can be changed outside of TUFLOW and by default TUFLOW won’t change these when reading from a GPKG, however some applications could be making changes without the user being aware (e.g. QGIS will change the journal mode depending on whether the user is viewing the data or making edits to it) so this command forces certain settings to be used when TUFLOW accesses the database.</p>
<p>The addition of key words ‘Read’ or ‘Write’ can provide further context to the command to apply specifically when TUFLOW is reading or writing from a database. If neither ‘Read’ or ‘Write’ is provided, the command will be applied to both read and write contexts.</p>
<p>Multiple SQL commands can be specified by separating the commands by a semicolon ‘;’. If this command is used multiple times, the last instance will be used and the command itself does not stack. The exception to this is separate commands can be used for ‘Read’ and ‘Write’ contexts.</p>
<p>A typical example of using this command would to change the SQLite journal mode which can be helpful to stop database locks when multiple simulations are reading from the same database. This can happen when the journal mode is set to Write Ahead Log (WAL) and one simulation closes the database at the exact same instance another one is trying to open it. This occurs because the WAL method forces the creation of a new file (‘.WAL’) which is deleted when the database is closed (and no other processes are accessing the database). A temporary lock is placed on the database when the WAL is deleted and therefore stops any other process from opening it. In this example the user could force TUFLOW to change the journal mode to ‘delete’ which adopts a rollback journal and stops any database locks from being placed when simply reading from the database. The command to do this would be:</p>
<tcmd>SQLite On Open SQL Read</tcmd><teq> == </teq><tblk>PRAGMA journal_mode = DELETE;</tblk>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPKGCompressionPredictor"><tcmd>GPKG Compression Predictor </tcmd><teq>==<br></teq></a> <tblk>[ NONE | {Horizontal Differencing} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
By default, TUFLOW will also use a compression predictor to improve the compression ratio, this can be turned off by setting this command to ‘NONE’. See Section <a href="#Grid-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPKGCompression"><tcmd>GPKG Compression </tcmd><teq>==<br></teq></a> <tblk>[ NONE | {LZW} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The GPKG raster format supports LZW compression of the data. The data is compressed by default, however, can be turned off by setting this command to ‘NONE’. See Section <a href="#Grid-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadHazardFile"><tcmd>Read Hazard File </tcmd><teq>==<br></teq></a> <tblk>[  <span class="math inline">\(\langle\)</span>file_name<span class="math inline">\(\rangle\)</span>.csv ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads in a hazard file with a defined hazard threshold. The csv file should contain three (3) columns defining the thresholds for depth, velocity, and depth <span class="math inline">\(\times\)</span> velocity product respectively. See Section <a href="#Hazards-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISISISWLL"><tcmd>Read GIS ISIS WLL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLLs. See Section
<a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results. The GIS layer is identical
to that used for <a href="#ecfReadGISWLL">Read GIS WLL</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISXPWLL"><tcmd>Read GIS XP WLL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLLs. See Section
<a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results. The GIS layer is identical
to that used for <a href="#ecfReadGISWLL">Read GIS WLL</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGIS12DWLL"><tcmd>Read GIS 12D WLL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLLs. See Section
<a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results. The GIS layer is identical
to that used for <a href="#ecfReadGISWLL">Read GIS WLL</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGIS12DWLLPoints"><tcmd>Read GIS 12D WLL Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLL points for setting
elevations and materials at points along WLLs. See Section <a href="#OneDMap-3"><strong>??</strong></a>
for integrating 1D and 2D results for more details. The GIS layer is
identical to that used for <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISISISWLLPoints"><tcmd>Read GIS ISIS WLL Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLL points for setting
elevations and materials at points along WLLs. See Section <a href="#OneDMap-3"><strong>??</strong></a>
for integrating 1D and 2D results for more details. The GIS layer is
identical to that used for <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISXPWLLPoints"><tcmd>Read GIS XP WLL Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location of an external 1D scheme’s WLL points for setting
elevations and materials at points along WLLs. See Section <a href="#OneDMap-3"><strong>??</strong></a>
for integrating 1D and 2D results for more details. The GIS layer is
identical to that used for <a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISISISNodes"><tcmd>Read GIS ISIS Nodes </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This command is superseded by <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a>, but continues to be supported for
legacy models. It is now redundant as the nodes can be placed in a <a href="#tcfReadGISISISNetwork">Read
GIS X1D Network</a> layer (the <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a> layer can only contain the nodes, and no
channels, if so desired).</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISXPNodes"><tcmd>Read GIS XP Nodes </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This command is superseded by <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a>, but continues to be supported for
legacy models. It is now redundant as the nodes can be placed in a <a href="#tcfReadGISISISNetwork">Read
GIS X1D Network</a> layer (the <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a> layer can only contain the nodes, and no
channels, if so desired).</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGIS12DNodes"><tcmd>Read GIS 12D Nodes </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy command. Expand to find out more about the legacy settings.
</summary>
<p>This command is superseded by <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a>, but continues to be supported for
legacy models. It is now redundant as the nodes can be placed in a <a href="#tcfReadGISISISNetwork">Read
GIS X1D Network</a> layer (the <a href="#tcfReadGISISISNetwork">Read GIS X1D
Network</a> layer can only contain the nodes, and no
channels, if so desired).</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISISISNetwork"><tcmd>Read GIS ISIS Network </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads the location of external 1D scheme nodes and channels. Supported
1D schemes are Flood Modeller (formerly known as ISIS), XP-SWMM or 12D
Solution’s DDA. 1D Nodes and Channels are referred to as Nodes and Units
in Flood Modeller; Nodes and Links in XP-SWMM; and Pits and Pipes in
12D). The nodes in the GIS layer(s) are required for linking the
external 1D scheme to TUFLOW. The channels are required only if using
<a href="#tcfReadGISISISWLL">Read GIS X1D WLL</a> to integrate 1D and 2D results in
the map output. The only attribute required is the ID of the Flood
Modeller node/unit, XP-SWMM node/link and 12D pit/pipe. See Section
<a href="#oneD2DFMLinking2D-3"><strong>??</strong></a> for details on linking an external 1D scheme to TUFLOW, and
Section <a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results.</p>
For linking with TUFLOW, the linked nodes must occur in this layer or in
a <a href="#tcfReadGISISISNodes">Read GIS X1D Nodes</a> layer. The nodes and
channels (links) can be placed in separate layers, and split over
several layers if desired. If desired, and the WLL feature is not being
used, the layer can solely contain linked nodes and no channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGISXPNetwork"><tcmd>Read GIS XP Network </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads the location of external 1D scheme nodes and channels. Supported
1D schemes are Flood Modeller (formerly known as ISIS), XP-SWMM or 12D
Solution’s DDA. 1D Nodes and Channels are referred to as Nodes and Units
in Flood Modeller; Nodes and Links in XP-SWMM; and Pits and Pipes in
12D). The nodes in the GIS layer(s) are required for linking the
external 1D scheme to TUFLOW. The channels are required only if using
<a href="#tcfReadGISISISWLL">Read GIS X1D WLL</a> to integrate 1D and 2D results in
the map output. The only attribute required is the ID of the Flood
Modeller node/unit, XP-SWMM node/link and 12D pit/pipe. See Section
<a href="#oneD2DFMLinking2D-3"><strong>??</strong></a> for details on linking an external 1D scheme to TUFLOW, and
Section <a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results.</p>
For linking with TUFLOW, the linked nodes must occur in this layer or in
a <a href="#tcfReadGISISISNodes">Read GIS X1D Nodes</a> layer. The nodes and
channels (links) can be placed in separate layers, and split over
several layers if desired. If desired, and the WLL feature is not being
used, the layer can solely contain linked nodes and no channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfReadGIS12DNetwork"><tcmd>Read GIS 12D Network </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads the location of external 1D scheme nodes and channels. Supported
1D schemes are Flood Modeller (formerly known as ISIS), XP-SWMM or 12D
Solution’s DDA. 1D Nodes and Channels are referred to as Nodes and Units
in Flood Modeller; Nodes and Links in XP-SWMM; and Pits and Pipes in
12D). The nodes in the GIS layer(s) are required for linking the
external 1D scheme to TUFLOW. The channels are required only if using
<a href="#tcfReadGISISISWLL">Read GIS X1D WLL</a> to integrate 1D and 2D results in
the map output. The only attribute required is the ID of the Flood
Modeller node/unit, XP-SWMM node/link and 12D pit/pipe. See Section
<a href="#oneD2DFMLinking2D-3"><strong>??</strong></a> for details on linking an external 1D scheme to TUFLOW, and
Section <a href="#OneDMap-3"><strong>??</strong></a> for integrating 1D and 2D results.</p>
For linking with TUFLOW, the linked nodes must occur in this layer or in
a <a href="#tcfReadGISISISNodes">Read GIS X1D Nodes</a> layer. The nodes and
channels (links) can be placed in separate layers, and split over
several layers if desired. If desired, and the WLL feature is not being
used, the layer can solely contain linked nodes and no channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfXFFilesMergeTINElevations"><tcmd>XF Files Merge TIN Elevations </tcmd><teq>==<br></teq></a> <tblk>[ {Reprocess}  | Use XF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Introduced in the 2023-03-AF build as an enhancement to the XF file feature by reusing the TIN structure in the XF files, but updating the TIN vertex elevations from the new simulations. ‘Reprocess’ is the default approach for the 2023-03-AF build and onwards that reprocesses the TIN vertex elevations for each simulation, while ‘Use XF’ is the original method, used for builds prior to 2023-03-AF, that applies the TIN vertex elevations stored in XF files.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tcfGPKGInputsReadOnly"><tcmd>GPKG Inputs Read Only </tcmd><teq>==<br></teq></a> <tblk>[ ON | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Introduced in the 2023-03-AF build, if set to “ON”, this command forces TUFLOW to open GPKG input databases in a stricter read only mode. This should reduce the chance of database locks occuring from concurrent access from simultaneous TUFLOW simulations.</p>
The ‘read only’ mode has some limitations, for example, “.gpkg-WAL” and “.gpkg-SHM” files won’t be cleaned up if these are created. It also won’t be possible to change some of the database settings if this command is used in conjunction with <a href="#tcfSQLiteOnOpenSQL">SQLite On Open SQL</a>.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="ECFCommands-1"><span class="header-section-number">20</span> ECF Commands<a href="#ECFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW ESTRY Control File (.ecf) includes commands and data inputs to build the 1D ESTRY domain, it is read into the .tcf using the <a href="#tcfESTRYControlFile">ESTRY Control File</a> command. For more information on the .ecf, see Section <a href="#ECF-3"><strong>??</strong></a>. Building the 1D domain is discussed in Chapter <a href="#OneD-Domains-1"><strong>??</strong></a>. The available ECF commands are listed below and are detailed in Table <a href="#tab:tab-ECFCommands">134</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#ecfArchBridgeMinimumBlockage">Arch Bridge Minimum Blockage (%)</a><br />
<a href="#ecfBCDatabase">BC Database</a><br />
<a href="#ecfBCEventName">BC Event Name</a><br />
<a href="#ecfBCEventText">BC Event Text</a><br />
<a href="#ecfBridgeFlow">Bridge Flow</a><br />
<a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a><br />
<a href="#ecfConveyanceCalculation">Conveyance Calculation</a><br />
<a href="#ecfCreateNodes">Create Nodes</a><br />
<a href="#ecfCSVFormat">CSV Format</a><br />
<a href="#ecfCSVMaximumNumberColumns">CSV Maximum Number Columns</a><br />
<a href="#ecfCSVTime">CSV Time</a><br />
<a href="#ecfCulvertCriticalHD">Culvert Critical H/D</a><br />
<a href="#ecfCulvertFlow">Culvert Flow</a><br />
<a href="#ecfCulvertZeroCoefficients">Culvert Zero Coefficients</a><br />
<a href="#ecfDepthDischargeDatabase">Depth Discharge Database</a><br />
<a href="#ecfDepthLimitFactor">Depth Limit Factor</a><br />
<a href="#ecfFlowArea">Flow Area</a><br />
<a href="#ecfFlowCalculation">Flow Calculation</a><br />
<a href="#ecfFroudeCheck">Froude Check</a><br />
<a href="#ecfFroudeDepthAdjustment">Froude Depth Adjustment</a><br />
<a href="#ecfHeadRateCreepFactor">Head Rate Creep Factor</a><br />
<a href="#ecfHeadRateLimitMinimum">Head Rate Limit Minimum</a><br />
<a href="#ecfHeadRateLimit">Head Rate Limit</a><br />
<a href="#ecfInterpolateCrossSections">Interpolate Cross-Sections</a><br />
<a href="#ecfInterpolateCulvertInverts">Interpolate Culvert Inverts</a><br />
<a href="#ecfMChannelApproach">M Channel Approach</a><br />
<a href="#ecfM11Network">M11 Network</a><br />
<a href="#ecfManholeApproach">Manhole Approach</a><br />
<a href="#ecfManholeDefaultCExitCoefficient">Manhole Default C Exit Coefficient</a><br />
<a href="#ecfManholeDefaultLossApproach">Manhole Default Loss Approach</a><br />
<a href="#ecfManholeDefaultRExitCoefficient">Manhole Default R Exit Coefficient</a><br />
<a href="#ecfManholeDefaultSideClearance">Manhole Default Side Clearance</a><br />
<a href="#ecfManholeDefaultType">Manhole Default Type</a><br />
<a href="#ecfManholeKMaximumBendDrop">Manhole K Maximum Bend/Drop</a><br />
<a href="#ecfManholeMinimumDimension">Manhole Minimum Dimension</a><br />
<a href="#ecfManholesatAllCulvertJunctions">Manholes at All Culvert Junctions</a><br />
<a href="#ecfMaximumOperationalControls">Maximum Operational Controls</a><br />
<a href="#ecfMinimumChannelConveyanceLength">Minimum Channel Conveyance Length</a><br />
<a href="#ecfMinimumChannelStorageLength">Minimum Channel Storage Length</a><br />
<a href="#ecfMinimumNAPit">Minimum NA Pit</a><br />
<a href="#ecfMinimumNA">Minimum NA</a><br />
<a href="#ecfMomentumEquation">Momentum Equation</a><br />
<a href="#ecfOrderOutput">Order Output</a><br />
<a href="#ecfOutputDataTypes">Output Data Types</a><br />
<a href="#ecfOutputFolder">Output Folder</a><br />
<a href="#ecfOutputInterval">Output Interval</a><br />
<a href="#ecfOutputTimesSameas2D">Output Times Same as 2D</a><br />
<a href="#ecfPitChannelOffset">Pit Channel Offset</a><br />
<a href="#ecfPitDefault2DConnection">Pit Default 2D Connection</a><br />
<a href="#ecfPitDefaultExtrapolateQCurve">Pit Default Extrapolate Q Curve</a><br />
<a href="#ecfPitDefaultRoadCrossfall">Pit Default Road Crossfall</a><br />
<a href="#ecfPitInletDatabase">Pit Inlet Database</a><br />
<a href="#ecfPitSearchDistance">Pit Search Distance</a><br />
<a href="#ecfReadFile">Read File</a><br />
<a href="#ecfReadGISBC">Read GIS BC</a><br />
<a href="#ecfReadGISIWL">Read GIS IWL</a><br />
<a href="#ecfReadGISManhole">Read GIS Manhole</a><br />
<a href="#ecfReadGISNetwork">Read GIS Network</a><br />
<a href="#ecfReadGISNode">Read GIS Node</a><br />
<a href="#ecfReadGISPit">Read GIS Pits</a><br />
<a href="#ecfReadGISTableLinks">Read GIS Table Links</a><br />
<a href="#ecfReadGISWLLPoints">Read GIS WLL Points</a><br />
<a href="#ecfReadGISWLL">Read GIS WLL</a><br />
<a href="#ecfReadOperatingControlsFile">Read Operating Controls File</a><br />
<a href="#ecfSChannelApproach">S Channel Approach</a><br />
<a href="#ecfSetIWL">Set IWL</a><br />
<a href="#ecfSetVariable">Set Variable <span class="math inline">\(\langle\)</span>name<span class="math inline">\(\rangle\)</span></a><br />
<a href="#ecfSpatialDatabase">Spatial Database</a><br />
<a href="#ecfStartOutput">Start Output</a><br />
<a href="#ecfStorageAboveStructureObvert">Storage Above Structure Obvert</a><br />
<a href="#ecfStructureFlowLevels">Structure Flow Levels</a><br />
<a href="#ecfStructureLossesApproach">Structure Losses Approach</a><br />
<a href="#ecfStructureLossesSX">Structure Losses SX</a><br />
<a href="#ecfStructureLosses">Structure Losses</a><br />
<a href="#ecfStructureRoutines">Structure Routines</a><br />
<a href="#ecfTaperClosedNATable">Taper Closed NA Table</a><br />
<a href="#ecfTimestep">Timestep</a><br />
<a href="#ecfTrimXZProfiles">Trim XZ Profiles</a><br />
<a href="#ecfCreepFactor">Vel Rate Creep Factor</a><br />
<a href="#ecfVelRateLimitMinimum">Vel Rate Limit Minimum</a><br />
<a href="#ecfVelRateLimit">Vel Rate Limit</a><br />
<a href="#ecfWeirApproach">Weir Approach</a><br />
<a href="#ecfWeirFlow">Weir Flow</a><br />
<a href="#ecfWLLApproach">WLL Approach</a><br />
<a href="#ecfWLLAutomatic">WLL Automatic</a><br />
<a href="#ecfWLLNoWeirs">WLL No Weirs</a><br />
<a href="#ecfWLLVerticalOffset">WLL Vertical Offset</a><br />
<a href="#ecfWLLpInterpolateBed">WLLp Interpolate Bed</a><br />
<a href="#ecfWriteCheckFiles">Write Check Files</a><br />
<a href="#ecfXSDatabase">XS Database</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-ECFCommands">Table 134: </span><strong>TUFLOW Classic/HPC ECF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfArchBridgeMinimumBlockage"><tcmd>Arch Bridge Minimum Blockage (%) </tcmd><teq>==<br></teq></a> <tblk>[  {5} | <span class="math inline">\(\langle\)</span> min_pblockage <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the minimum blockage applied in the arch bridge flow calculation (see Section <a href="#BArch-Min-Blc-4"><strong>??</strong></a>). The default value is 5 (%).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfBCDatabase"><tcmd>BC Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .csv_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active BC Database file, as described in Section <a href="#bcdbase-2"><strong>??</strong></a>. The
file is usually created using spreadsheet software such as Microsoft
Excel.</p>
<p>If the BC Database is specified in the TUFLOW .tcf file, it is set as
the active database for both 2D and 1D models. However, the active
database can be changed at any stage in the .tbc and .ecf files by
repeating the command with the new database set as the <span class="math inline">\(\langle\)</span> .csv_file <span class="math inline">\(\rangle\)</span>.</p>
<strong>A BC Database must be specified before any of the other BC commands
are used.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfBCEventName"><tcmd>BC Event Name </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> bc_event_name <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active BC name to be substituted where <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> (see <a href="#ecfBCEventText">BC Event Text</a>) occurs in the BC Database. See Section <a href="#BCEventName-3"><strong>??</strong></a> for a description of how the BC event commands operate.</p>
<p>This command is normally specified in the .tcf file, and is only used in the .ecf file if the event boundaries vary by event within the model.
For example, it may be set to “Q100” to read in the 100 year catchment inflows, then set as “H010” to read in the 10 year ocean levels for the
downstream boundary. Note that, in this case, the locations of the catchment inflows and downstream boundaries would have to be placed in
two separate GIS layers, with each layer read using <a href="#ecfReadGISBC">Read GIS BC</a> after the relevant <a href="#ecfBCEventName">BC Event
Name</a> command as shown below:</p>
<tcmd>BC Event Name</tcmd><teq> == </teq><tblk>H010</tblk><br />
<tcmd>Read GIS BC</tcmd><teq> == </teq><tblk>gis\1d_bc_head_boundaries.shp</tblk><br />
<tcmd>BC Event Name</tcmd><teq> == </teq><tblk>Q100</tblk><br />
<tcmd>Read GIS BC</tcmd><teq> == </teq><tblk>gis\1d_bc_flow_boundaries.shp</tblk>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfBCEventText"><tcmd>BC Event Text </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the text in the BC Database that is to be substituted by the <a href="#ecfBCEventName">BC
Event Name</a> command value. See Section <a href="#BCEventName-3"><strong>??</strong></a> for
a description of how the BC event commands operate.</p>
<p>For 1D/2D models this command only needs to be specified in the .tcf
file. It would only be used in the .ecf file for 1D only models or if
for some reason the <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> value needs to change prior to
reading the 1D BCs. Also see <a href="#tcfBCEventText">BC Event Text</a> for the
.tcf file if the model is 1D/2D.</p>
The <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> value can be changed at any stage by repeating
this command in the .ecf file, although it is strongly recommended that
the <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> value is standardised across all models and the
command is only specified once.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfBridgeFlow"><tcmd>Bridge Flow </tcmd><teq>==<br></teq></a> <tblk>[ Method A | {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Controls the method for calculating bridge flows.</p>
<p>Method A uses the original ESTRY bridge routine. Method B (the default),
is based on Method A, but provides improved stability particularly when
the bridge is flowing at shallow depths or is wetting and drying. Method
B also does not force the loss coefficient to be a minimum of 1.5625
once the bridge obvert is surcharged (Method B uses the value as
specified in the BG table).</p>
Refer to Section <a href="#BridgeIntro-4"><strong>??</strong></a> for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfBridgeZeroCoefficients"><tcmd>Bridge Zero Coefficients </tcmd><teq>==<br></teq></a> <tblk>[ {DEFAULT} |  OFF | <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> DLC <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> ELC <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> XLC <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Changes the default BB bridge (Section <a href="#BB-Bridge-4"><strong>??</strong></a>) channel coefficients applied to zero (0.0)
attribute values in the 1d_nwk layer(s). This command is not used for B
bridge channels.</p>
<p>The four values and their associated 1d_nwk attributes are:</p>
<ul>
<li>Cd: Bridge deck pressure flow surcharge coefficient specified by the
HConF_or_WC attribute (Default = 0.8).<br />
</li>
<li>DLC: Bridge deck energy loss coefficient when fully submerged and not
under pressure flow. Specified by the WConF_or_WEx attribute (Default =
0.5).<br />
</li>
<li>ELC: Unadjusted entrance loss coefficient specified by the EntryC_or_WSa
attribute (Default = 0.5). The entrance loss coefficient applied is
adjusted every timestep according to the approach velocity, as discussed
in Section <a href="#BB-Bridge-4"><strong>??</strong></a>.<br />
</li>
<li>XLC: Unadjusted exit loss coefficient specified by the ExitC_or_WSb
attribute (Default = 1.0). The exit loss coefficient applied is adjusted
every timestep according to the departure velocity, as discussed in
Section <a href="#BB-Bridge-4"><strong>??</strong></a>.</li>
</ul>
<p>For example, <tcmd><a href="#ecfBridgeZeroCoefficients">Bridge Zero Coefficients</a></tcmd><teq> ==</teq><tblk>
0.75, 0.3, 0.5, 0.8</tblk> changes the default value for Cd, DLC, ELC and XLC
used for any zero (0) attribute values in 1d_nwk layer(s).</p>
<p>DEFAULT (which is the default setting) will set any zero values to the
default values mentioned above.</p>
OFF will allow a zero value to be applied to the ELC and XLC loss
coefficients. Cd and DLC cannot be non-zero, therefore, if OFF is
specified these will always have their default value above applied if
the 1d_nwk attribute is zero.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfConveyanceCalculation"><tcmd>Conveyance Calculation </tcmd><teq>==<br></teq></a> <tblk>[ CHANGE IN RESISTANCE  | {ALL PARALLEL} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to CHANGE IN RESISTANCE, the parallel channel analysis splits the
cross-section into separate parallel channels based on wherever there is
a change in resistance (due to different relative resistance, material
type or Manning’s n values).</p>
<p>If set to ALL PARALLEL (the default), a parallel channel is created for
every X (distance across section) value. This approach does not cause
conveyance reducing with height warnings.</p>
Refer to Section <a href="#Parallel-Channel-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCreateNodes"><tcmd>Create Nodes </tcmd><teq>==<br></teq></a> <tblk>[ {ON} | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If no node is found snapped to the end of a channel a new node is
automatically created. The ID of the node is the first ten characters of
the channel ID with a “.1” or “.2” extension. “.1” is used if the node
is at the start of the channel and “.2” if at the end. If more than one
channel is connected to the created node, the channel ID that occurs
first alphanumerically is used.</p>
<p>The automatic creation of nodes can be switched off using the OFF
option.</p>
For further information see Section <a href="#Auto-Node-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCSVFormat"><tcmd>CSV Format </tcmd><teq>==<br></teq></a> <tblk>[ HORIZONTAL | {VERTICAL} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to HORIZONTAL, writes the 1D .csv output file (Section <a href="#view-1D-2"><strong>??</strong></a>) with the
head/flow/velocity values for a node/channel in rows. The default is to
write the values in columns.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCSVMaximumNumberColumns"><tcmd>CSV Maximum Number Columns </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> max_col <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>This is a legacy command that applies to formats prior to the default .csv output for the 2016-03 release.</p>
<p>Used to specify a maximum number of columns for 1D .csv output files. The default setting is limitless. Refer also to the .tcf command <a href="#tcfCSVMaximumNumberColumns">CSV Maximum Number Columns</a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCSVTime"><tcmd>CSV Time </tcmd><teq>==<br></teq></a> <tblk>[ {DAYS} | HOURS | MINUTES | SECONDS ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Use the .tcf <a href="#tcfCSVTime">CSV Time</a> command instead. Expand to find out more about the legacy settings.
</summary>
<p>Specifies the time values of 1D .csv outputs. The default is DAYS but can be changed to HOURS, MINUTES or SECONDS.</p>
<p>The .tcf command <a href="#tcfCSVTime">CSV Time</a> can be specified to apply to both 1D and 2D .csv outputs.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCulvertCriticalHD"><tcmd>Culvert Critical H/D </tcmd><teq>==<br></teq></a> <tblk>[  {OFF} | <span class="math inline">\(\langle\)</span> critical_h/d <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> v1 <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> v2 <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> v3 <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the H/D value to be used for determining whether outlet control
Regimes E and F take preference over the inlet control Regimes B or L. H
is the upstream head above the culvert sill and D is the culvert height.
If H/D exceeds <span class="math inline">\(\langle\)</span> critical_h/d <span class="math inline">\(\rangle\)</span> Regime E or F is used, otherwise the
regime with the lower discharge (along with other tests) is used.</p>
<p>The default is OFF (i.e. infinitely large H/D). Three options are
additionally available:</p>
<ul>
<li>v1 = Critical H/D value at culvert inlets connected to at least one
open channel.<br />
</li>
<li>v2 = Critical H/D value at culvert inlets connected to a pit channel
(and not connected to any open channels).<br />
</li>
<li>v3 = Critical H/D value at culvert inlets at culvert only junctions
(no open channels or pits).<br />
</li>
<li>Default values are 99999. (i.e. no critical H/D values applied). If
only one value is specified, this is applied to all three. Specifying
OFF applies 99999 to all three values.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCulvertFlow"><tcmd>Culvert Flow </tcmd><teq>==<br></teq></a> <tblk>[ {Method E} | Method <span class="math inline">\(\langle\)</span>letter<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the method for calculating culvert flows.</li>
</ul>
<p>Options include:</p>
<ul>
<li>Method A is the original ESTRY culvert routines.<br />
</li>
<li>Method B is an adaptation of Method A to include regimes K and L (see Figure <a href="#fig:fig-image19">25</a>). Method B also offers improved stability, smoother transitions between flow regimes and corrects very occasional mass conservation errors under certain flow regimes.<br />
</li>
<li>Method C is a slight improvement on Method B for flow Regime C (see Figure <a href="#fig:fig-image19">25</a>).<br />
</li>
<li>Method D includes further improvements on Method C and corrects a bug for Regime E.<br />
</li>
<li>Method E is the current default and incorporates minor improvements for transitioning between Regimes A and B, and between inlet and outlet controlled regimes, for circular culverts.<br />
</li>
<li>Method G (introduced in the 2023-03-AC release) includes an enhancement to adverse slope culvert flux calculation. Prior to 2023-03-AC, significant exit loss could be applied at the exit of an adverse slope culvert if the outlet node is dry or close to dry. This is caused by the misrepresentation exit flow area and exit velocity. Method G fixes this.</li>
</ul>
Methods A, B, C and D are provided for backward compatibility only.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCulvertZeroCoefficients"><tcmd>Culvert Zero Coefficients </tcmd><teq>==<br></teq></a> <tblk>[ DEFAULT | {OFF} | v1, v2, v3, v4, v5 ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the default culvert coefficients if they are set to zero (0) in the
1d_nwk layer(s). The five affected attribute values are as per the following:</p>
<ul>
<li>v1 Circular culvert inlet controlled contraction coefficient (Width_Cont
attribute).<br />
</li>
<li>v2 Rectangular and irregular culvert height contraction coefficient
(Height_Cont attribute).<br />
</li>
<li>v3 Rectangular and irregular culvert width contraction coefficient
(Width_Cont attribute).<br />
</li>
<li>v4 Culvert inlet loss coefficient (Entry_Loss attribute).<br />
</li>
<li>v5 Culvert outlet loss coefficient (Exit_Loss attribute).</li>
</ul>
<p>For example, <tcmd><a href="#ecfCulvertZeroCoefficients">Culvert Zero Coefficients</a></tcmd><teq> ==</teq><tblk>
1.0, 0.6, 0.9, 0.5, 1.0</tblk> sets any zero (0) and NULL coefficient values in
1d_nwk layers to the corresponding value from this command. Any non-zero
and non-NULL values remain unchanged.</p>
<p>DEFAULT sets zero coefficients to the default values of 1.0, 0.6, 0.9, 0.5 and 1.0.</p>
<p>OFF (default) doesn’t apply this feature and if the 1d_nwk attributes are empty (See Table <a href="#tab:tab-CrossAttributeDescriptions">21</a>):</p>
<ul>
<li>For a circular culvert 1,1,0,0 is used.</li>
<li>For a rectangular culvert 0.6,0.9,0,0 is used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfDepthDischargeDatabase"><tcmd>Depth Discharge Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> depth_discharge_dbase.csv <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the depth discharge database file that references the
depth-discharge curves for non-operated Q channels. Mandatory if the
model has any Q channels. Performs the same function as <a href="#ecfPitInletDatabase">Pit Inlet
Database</a>. The same database file can be used for
both Q channels, Q pits and pump channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfDepthLimitFactor"><tcmd>Depth Limit Factor </tcmd><teq>==<br></teq></a> <tblk>[ {10} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the depth limit for detecting instabilities. The default is set to
10, therefore the water level must exceed ten times the depth of the CS
or NA table before an instability is triggered. See Section Section <a href="#Obvert-3"><strong>??</strong></a>.</li>
</ul>
<p>Specifying a value greater than one extends the cross-section hydraulic
properties and nodal storages above the highest elevation. For example,
if a value of 2 is specified, this will allow water levels to reach
twice the depth where depth is the difference between the highest and
lowest elevations in the table.</p>
<p>Cross-section hydraulic properties above the highest elevation are
calculated based on the flow width remaining constant at the width of
the highest elevation in the table. If the hydraulic properties are
calculated from a cross-section profile, it uses the effective flow
width as shown in the .eof file (it does not use the storage width) –
this preserves the effect of any variation in relative roughness across
the cross-section. All other hydraulic property sources use the storage
width, and any relative roughness effects are ignored once the water
level exceeds the highest elevation. Also note that the wetted perimeter
remains constant above the highest elevation; ie. it is not increased on
the vertical as the flood level rises. Cross-section properties of
bridge channels are not affected by this command.</p>
Nodal storage properties extend upwards by keeping the surface area
constant above the highest elevation in the table.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfFlowArea"><tcmd>Flow Area </tcmd><teq>==<br></teq></a> <tblk>[ {EFFECTIVE} | TOTAL ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the default method for calculating flow area at a channel
cross-section when ESTRY calculates the hydraulic properties from a
cross-section XZ profile table. The default is EFFECTIVE area, which
means that the flow area is the sum of the areas divided by the relative
resistance factor. TOTAL area ignores the relative resistance factor
when calculating area, but uses it to set the wetted perimeter and
hydraulic radius values. Either method gives the same channel
conveyance. If the relative resistance across the profile is not
specified or constant at a value of one, effective and total area are
the same.</p>
<p>The effective area method produces a velocity that applies to the main
channel (where the relative resistance is set to one). The total area
approach produces a velocity depth and width averaged, and typically
underestimates the main channel velocity. The recommended approach is to
use effective area.</p>
See Section <a href="#Eff-vs-Total-3"><strong>??</strong></a> for a more detailed discussion.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfFlowCalculation"><tcmd>Flow Calculation </tcmd><teq>==<br></teq></a> <tblk>[ Method A | {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Method A is the original ESTRY channel flow routine.</p>
<p>Method B corrects an anomaly that would sometimes incorrectly output 1D
flow values where the channel flow regimes are oscillating every half
timestep (for example, between super and sub-critical flow regimes).
Where the channel is switching flow regimes between timesteps (nearly
always the case), the correct flow is calculated. This fix also affects
the flow in/out of 2D SX connections if the connected 1D channel is
oscillating every half timestep. The fix does not change 1D water level
and velocity results, unless they are influenced by changes due to any
effects on SX flows.</p>
Use Method A only for backward compatibility.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfFroudeCheck"><tcmd>Froude Check </tcmd><teq>==<br></teq></a> <tblk>[ {1} | <span class="math inline">\(\langle\)</span> froude_no <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the minimum Froude Number that upstream controlled friction flow
may occur in “S” channels. Improved stability may occur in steeply
flowing areas if <span class="math inline">\(\langle\)</span> froude_no <span class="math inline">\(\rangle\)</span> is less than 1. <span class="math inline">\(\langle\)</span> froude_no <span class="math inline">\(\rangle\)</span> cannot be
below zero and would normally not exceed 1.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfFroudeDepthAdjustment"><tcmd>Froude Depth Adjustment </tcmd><teq>==<br></teq></a> <tblk>[ {ON} | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Switches ON or OFF an additional upstream controlled friction flow check
for S channels (a similar check is used for 2D domains – see Section
<a href="#CLA-US-Controlled-3"><strong>??</strong></a>).</p>
Only set to OFF for backward compatibility.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfHeadRateCreepFactor"><tcmd>Head Rate Creep Factor </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  | {1.2} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies rate at which the <a href="#ecfHeadRateLimit">Head Rate
Limit</a> value changes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfHeadRateLimit"><tcmd>Head Rate Limit </tcmd><teq>==<br></teq></a> <tblk>[ ON | {OFF} | <span class="math inline">\(\langle\)</span> hrl <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the head rate limit applied to nodes. This feature can be used
to stabilise problematic 1D nodes, but should be used with caution and
mass balance checks must be made to ensure there is no significant mass
loss or gain. It is particularly useful where a node “bounces”
temporarily and is prevented from becoming unstable. The maximum amount
the water level can change in half a timestep is the <span class="math inline">\(\langle\)</span> hrl <span class="math inline">\(\rangle\)</span> value after
any adjustment by the <a href="#ecfHeadRateCreepFactor">Head Rate Creep Factor</a>.
The <span class="math inline">\(\langle\)</span> hrl <span class="math inline">\(\rangle\)</span> is adjusted up and down depending on the stability of the
node in a similar approach used for <a href="#ecfVelRateLimit">Vel Rate Limit</a>.
If the ON option is used, the <span class="math inline">\(\langle\)</span> hrl <span class="math inline">\(\rangle\)</span> value is set to 0.1.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfHeadRateLimitMinimum"><tcmd>Head Rate Limit Minimum </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> hrlmin <span class="math inline">\(\rangle\)</span> |  {0.001} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the minimum head rate limit that can occur. See <a href="#ecfHeadRateLimit">Head Rate
Limit</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfInterpolateCrossSections"><tcmd>Interpolate Cross-Sections </tcmd><teq>==<br></teq></a> <tblk>[ {ON} |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON (the default), any channels that don’t have a cross-section
have their cross-section properties interpolated using the nearest
cross-sections attached to other channels. See Section <a href="#Interpolate-XS-3"><strong>??</strong></a> for
details on the process used. Set to OFF to disable this feature and
force every channel to have a cross-section.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfInterpolateCulvertInverts"><tcmd>Interpolate Culvert Inverts </tcmd><teq>==<br></teq></a> <tblk>[ {ON} |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON (the default), any culverts that don’t have an invert (i.e.
a -99999 value was assigned to the invert attribute(s) and there were no
inverts assigned via any pits or nodes snapped to the culvert ends) have
their invert(s) interpolated using the nearest assigned inverts of
connected culverts/pipes. Set to OFF to disable this feature.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMChannelApproach"><tcmd>M Channel Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A |  {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the matrix interpolation approach for M channel data (Section <a href="#M-Channel-3"><strong>??</strong></a>).</p>
<p>Method A is the original interpolation approach which uses a 4 value
interpolation routine that, especially along the 0 flow diagonal, might
not interpolate as accurately as using a triangular (3 point) technique.
The main issue with the 4 point routine is that a slightly positive or
negative flow of the wrong sign may result when interpolating close to
the zero flow diagonal.</p>
Method B uses an improved method. It uses a triangular interpolation with the long side of the triangle
parallel to the zero flow diagonal, and does not experience the problems
Method A has when interpolating close to the zero flow diagonal.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfM11Network"><tcmd>M11 Network </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .nwk11_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more about the legacy settings.
</summary>
<p>Sets the active MIKE 11 network file as <span class="math inline">\(\langle\)</span> .nwk11_file <span class="math inline">\(\rangle\)</span>. The file is
used to extract link, cross-section and other information using 1d_nwk
attributes. Topo_ID must be set to “$Link”. For more details see the <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf">2018 TUFLOW Manual</a>.
This command must be specified before the relevant <a href="#ecfReadGISNetwork">Read GIS
Network</a> command. The command may be used at any point
to change the active MIKE 11 network file.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeApproach"><tcmd>Manhole Approach </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A |  METHOD B |  {METHOD C} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the automatic manhole definition approach. See Section <a href="#Auto-MH-4"><strong>??</strong></a>.</p>
<p>Method A is the original approach which has been found to be too
conservative (i.e. higher losses and therefore higher flood levels) as
indicated by users.</p>
<p>Method B, incorporates a few bug fixes found in Method A.</p>
<p>Method C (the default) incorporates further bug fixes affecting manholes
using the Engelund approach for calculating losses.</p>
If using METHOD B, sensitivity testing the effects of METHOD C versus
METHOD B should be carried out to check for any unacceptable
differences.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeDefaultCExitCoefficient"><tcmd>Manhole Default C Exit Coefficient </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> K<sub>CE</sub> <span class="math inline">\(\rangle\)</span> |  {0.25} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
For C (circular) manholes, sets the default K coefficient for flow out
of the manhole and into the out flowing culvert(s). The default value is
0.25. See Section <a href="#Manholes-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeDefaultLossApproach"><tcmd>Manhole Default Loss Approach </tcmd><teq>==<br></teq></a> <tblk>[ NONE |  {ENGELUND} |  FIXED ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the default loss approach to be used at automatically generated
manholes, and manholes where no loss approach is specified. The default
is ENGELUND (see Section <a href="#Manholes-3"><strong>??</strong></a> for a description on the
different approaches).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeDefaultRExitCoefficient"><tcmd>Manhole Default R Exit Coefficient </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> K<sub>RE</sub> <span class="math inline">\(\rangle\)</span> |  {0.5} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
For R (rectangular) manholes, sets the default K coefficient for flow
out of the manhole and into the out flowing culvert(s). The default
value is 0.5. See Section <a href="#Manholes-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeDefaultSideClearance"><tcmd>Manhole Default Side Clearance </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value_m <span class="math inline">\(\rangle\)</span> |  {0.3} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>For C (circular) manholes, sets the default side clearance in metres
from the side of the largest culvert to the side of the manhole chamber
(i.e. if the diameter of the chamber is not specified, the diameter is
set to the width/diameter of the largest culvert plus twice the side
clearance).</p>
<p>For R (rectangular) manholes, sets the default side clearance from the
side of the culvert(s) to the side of the manhole chamber. If the width
of the chamber is not specified, the width is set to the greatest
incoming or outgoing width, where the width is calculated as the sum of
the incoming/outgoing culvert widths/diameters, plus twice the side
clearance for the sides, plus twice the side clearance for the space
between each incoming/outgoing culvert if more than one incoming or
outgoing culvert exists.</p>
The default side clearance value can be overridden by specifying a
negative width for a manhole in a 1d_mh layer. The side clearance
applied will be the absolute value of the 1d_mh Width attribute, and the
above approach will be used to determine the manhole width/diameter. See Section <a href="#Manholes-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeDefaultType"><tcmd>Manhole Default Type </tcmd><teq>==<br></teq></a> <tblk>[ C |  J |  R |  CR |  {CJR} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the default type of manhole to be used at automatically generated
manholes, and manholes where no type approach is specified.</p>
<ul>
<li>C is for circular manholes;<br />
</li>
<li>R for rectangular manholes;<br />
</li>
<li>J for junctions (i.e. no chamber); and<br />
</li>
<li>CR and CJR are for a combination of C, R and J depending on the
size/configuration of the connecting culverts (see Section
<a href="#Manholes-3"><strong>??</strong></a> for further details). The default is CJR.</li>
</ul>
<p>CR assigns an R type if one or more of the below are true, otherwise a C
type is assigned.</p>
<ul>
<li>The number of barrels of any culvert is greater than one.<br />
</li>
<li>There are any parallel culverts (i.e. two or more culverts with the
same nodes and the culverts are digitised in the same direction).<br />
</li>
<li>The diameter of at least one circular culvert (C channel) exceeds
1.2m.<br />
</li>
<li>The width of at least one rectangular culvert (R channel) exceeds
0.45m.</li>
</ul>
<p>CJR uses the same logic as described above for CR, however, it will
assign a J type instead of a C or R if all of the below are true. The J
type in this case is to cover the situation where access is possible via
the culverts, rather than via a manhole.</p>
<ul>
<li>The number of barrels of all connected culverts must be one, and there
are no parallel culverts (i.e. two or more culverts with the same
nodes and the culverts are digitised in the same direction).<br />
</li>
<li>There is only one inlet and one outlet culvert.<br />
</li>
<li>The diameter of at least one circular culvert exceeds 1.8m, or the
width and height of at least one rectangular culvert exceeds 1.2m and
1.8m.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeKMaximumBendDrop"><tcmd>Manhole K Maximum Bend/Drop </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> max_K_bd |  {4.0} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the maximum K energy loss coefficient that can occur for the sum of
the loss coefficients for bends and drops at a manhole when using the
Engelund approach. See Section <a href="#Engelund-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholeMinimumDimension"><tcmd>Manhole Minimum Dimension </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> min_width_m |  {1.05} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the minimum diameter for C manholes and minimum width and length
for R manholes. The value is usually controlled by the minimum
dimensions needed for access to manhole chambers, not by any hydraulic
efficiency requirements. See Section <a href="#Manholes-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfManholesatAllCulvertJunctions"><tcmd>Manholes at All Culvert Junctions </tcmd><teq>==<br></teq></a> <tblk>[ {ON} | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON (the default), manholes are automatically created at all
culvert junctions. See Section <a href="#Manholes-3"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMaximumOperationalControls"><tcmd>Maximum Operational Controls </tcmd><teq>==<br></teq></a> <tblk>[ {1000} | <number of operational channels definitions> ]</number></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the maximum number of operational control channels (Section <a href="#OperationalChannels-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMinimumChannelConveyanceLength"><tcmd>Minimum Channel Conveyance Length </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Automatically increases the conveyance (and storage) length to
<span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span> if the channel’s length is less than <span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span>. The
default setting is zero (i.e. no change to any channel’s length). Does
not apply to pit channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMinimumChannelStorageLength"><tcmd>Minimum Channel Storage Length </tcmd><teq>==<br></teq></a> <tblk>[ {0} |  <span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If a channel’s length is less than <span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span>, then <span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span> is
used for calculating any storage contributions from the channel widths.
It does not affect the channels bed resistance, conveyance or slope. Can
be useful to add additional storage for stability reasons to nodes at
the ends of very short channels. If using this command, care must be
taken not to excessively add additional storage causing results to be distorted. Generally, adding an appropriate
amount of storage for stability reasons does not distort results,
however, it is strongly recommended that sensitivity tests are carried
out to cross-check the effect of any additional storage, and that any
adverse effects are corrected.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMinimumNA"><tcmd>Minimum NA </tcmd><teq>==<br></teq></a> <tblk>[ {1} |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the minimum surface area (m<sup>2</sup>) in all NA tables (except
for the upstream (ground) nodes of pit channels). The default value is
one (1m<sup>2</sup>). This command is useful for stabilising 1D nodes
that have very small storages, particularly at shallow depths. If using
this command, care must be taken not to excessively add additional
storage causing results to be distorted.
Generally, adding an appropriate amount of storage for stability reasons
does not distort results, however, it is strongly recommended that
sensitivity tests are carried out to cross-check the effect of any
additional storage, and that any adverse effects are corrected.</li>
</ul>
The percentage (%) option is provided which sets the minimum NA value
for each node based on a percentage of the maximum nodal area value for
the node.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMinimumNAPit"><tcmd>Minimum NA Pit </tcmd><teq>==<br></teq></a> <tblk>[ {1} |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the minimum surface area (m<sup>2</sup>) of the upstream (ground)
nodes of all pit channels. The default value is one (1m<sup>2</sup>).
This command was introduced to differentiate upstream pit channel nodes
from the <a href="#ecfMinimumNA">Minimum NA</a> setting. If the pit channel is
connected to a 2D domain, this storage has no influence on the hydraulic
computations, and increasing the value has no stability benefits.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfMomentumEquation"><tcmd>Momentum Equation </tcmd><teq>==<br></teq></a> <tblk>[ PRE 2003-08-AD ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Sets treatment of the effective flow width above the top of a
cross-section to the method used prior to Build 2003‑08‑AD to provide backward
compatibility. After this build, the effective flow width at the top of
a cross-section is stored and used to extend the effective flow area
above the highest point in the cross-section. Prior to this build, the
top storage width was used for the effective flow width for flows above
the top of the cross-section. This may only affect results where
relative resistance varies across a cross-section, and flow occurs above
the top of the cross-section, and effective flow area is being used.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfOrderOutput"><tcmd>Order Output </tcmd><teq>==<br></teq></a> <tblk>[ {ON} | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Alphanumerically orders 1D output according to the node and channel IDs.
The exception is the boundary condition data in the .eof file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfOutputDataTypes"><tcmd>Output Data Types </tcmd><teq>==<br></teq></a> <tblk>[ {H Q S V} |  <span class="math inline">\(\langle\)</span> data_types <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Similar to the .tcf map output command <a href="#tcfMapOutputDataTypes">Map Output Data
Types</a>, this command controls which 1D data
types to output, The options are:</p>
<ul>
<li><strong>A</strong> for flow area at channels (m<sup>2</sup>)</li>
<li><strong>E</strong> for energy (m)</li>
<li><strong>H</strong> for water level (m<sup>3</sup>)</li>
<li><strong>Q</strong> for flow at channels (m<sup>3</sup>/s)</li>
<li><strong>Qi</strong> integral flow at channels (m<sup>3</sup>)</li>
<li><strong>S</strong> for structure and grouped structure output (see Section <a href="#Structure-3"><strong>??</strong></a>)<br />
</li>
<li><strong>V</strong> for velocity (m/s)</li>
<li><strong>Vol</strong> volume at nodes (m<sup>3</sup>)
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfOutputFolder"><tcmd>Output Folder </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> folder <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Redirects all ESTRY (1D) output data to another folder. Typically used
to write output to your local drive instead of filling up the network or
to keep results separate to the input data. A URL path can be used (e.g.
\bmtserv\Computer001\tuflow\results),
which is useful for running simulations on other computers, but having
the output directed to your local drive or other location (your drive
will need to be shared).</li>
</ul>
The default location for 1D output is that specified using <a href="#tcfOutputFolder">Output
Folder</a> in the .tcf file for 1D/2D models.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfOutputInterval"><tcmd>Output Interval </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Use the .tcf <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a> command instead. Expand to find out more about the legacy settings.
</summary>
<p>The output interval for ESTRY output. The default units are hours;
however, seconds may be used if the “(s)” option is specified. If the
command is omitted, output is at every computational timestep.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfOutputTimesSameas2D"><tcmd>Output Times Same as 2D </tcmd><teq>==<br></teq></a> <tblk>[ {ON} |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>For 1D/2D models, the times for 1D output are, by default, the same as
that of the 2D domain(s) time series output (see <a href="#tcfStartTimeSeriesOutput">Start Time Series
Output</a> and <a href="#tcfTimeSeriesOutputInterval">Time Series Output
Interval</a>), unless no 2D time series
output (2d_po layers) has been specified, in which case <a href="#ecfStartOutput">Start
Output</a> and <a href="#ecfOutputInterval">Output Interval</a> are
used. For backward compatibility or to use different times for 1D time
series output, set to OFF.</p>
<p>This change was made so that both 1D and 2D time series data could be
output to the_TS. file, allowing graphing of 1D and 2D time series
data within a GIS (see Section <a href="#TS-GIS-3"><strong>??</strong></a>).</p>
This command is ignored for 1D only (ESTRY) models.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfPitChannelOffset"><tcmd>Pit Channel Offset </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> length_m <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the display, not computed, length in metres of pit channels in 1D output and the<a href="https://wiki.tuflow.com/Check_Files_1d_nwk_C">1d_nwk check files</a>. The channel is displayed on a north to south alignment. See Section <a href="#Pits-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfPitDefault2DConnection"><tcmd>Pit Default 2D Connection </tcmd><teq>==<br></teq></a> <tblk>[ {} |  <span class="math inline">\(\langle\)</span> Conn_1D_2D <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the default value for the 1d_nwk Conn_1D_2D attribute. For example, if set to SX, then if the 1d_nwk Conn_1D_2D attribute for a pit is empty, SX will be used, saving the user to specify SX at pits. To
disconnect a pit NO can be used for the Conn_1D_2D attribute. It is also possible to have the L and Z options at the one pit (e.g. SXLZ). See Section <a href="#Pits-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfPitDefaultExtrapolateQCurve"><tcmd>Pit Default Extrapolate Q Curve </tcmd><teq>==<br></teq></a> <tblk>[ {ON} |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
TUFLOW automatically extrapolates Q and VPI pits depth discharge
information beyond the last value in the depth-discharge curve using an
orifice flow equation. To not extrapolate the depth-discharge curve the
1D command “<tcmd><a href="#ecfPitDefaultExtrapolateQCurve">Pit Default Extrapolate Q Curve</a> </tcmd><teq>==</teq><tblk> OFF</tblk>” can be used. See Section <a href="#Pits-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfPitDefaultRoadCrossfall"><tcmd>Pit Default Road Crossfall </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> slope <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Increases the depth at Q pits based on the height of an imaginary
triangle of the road cross-section with a crossfall slope of <span class="math inline">\(\langle\)</span> slope <span class="math inline">\(\rangle\)</span>.
<span class="math inline">\(\langle\)</span> slope <span class="math inline">\(\rangle\)</span> is Vertical/Horizontal as a fraction (not percentage).</p>
The imaginary triangle has the same area as the vertical flow area in
the 2D cell the pit is connected to (i.e. the triangle’s area is the
depth in the 2D cell times the width of the cell). Once the horizontal
width of the triangle is greater than the width of the 2D cell, the
formula changes to give an equivalent area based on a trapezoid
consisting of the triangle plus a rectangle for the remaining area in
excess of the triangle. See Section <a href="#Xfall-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfPitInletDatabase"><tcmd>Pit Inlet Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> pit_inlet_dbase.csv <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Specifies the pit inlet database file that references the
depth-discharge curves for Q pit channels. Mandatory if the model has
any Q pit channels.</p>
<p>Performs the same function as <a href="#ecfDepthDischargeDatabase">Depth Discharge
Database</a>. The same database file can be
used for both Q channels and Q pits.</p>
See Section <a href="#DD-Database-3"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfPitSearchDistance"><tcmd>Pit Search Distance </tcmd><teq>==<br></teq></a> <tblk>[ {0.0} |  <span class="math inline">\(\langle\)</span> psd_m <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Set the distance (radius) in metres to search for the closest node to
automatically connect pits into the 1D network where pits are not
snapped to channel ends. Pits connected via this feature are displayed
in the 1d_nwk_C_check layer as occurring from the location of the pit to
the node, ie. <a href="#ecfPitChannelOffset">Pit Channel Offset</a> is not used to
display the pit channels created. The pits are also displayed in the
1d_nwk_N_check layer using a different colour to those pits that are
snapped directly to a channel end.</p>
This command may be used several times in the .ecf file with the most
recent occurrence applying at the time a pit is processed. A value of
0.0 (the default), disables the pit search feature. See Section <a href="#Pits-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadFile"><tcmd>Read File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Directs input to another file. When finished reading <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span>, ESTRY
returns to reading the .ecf file.</p>
<p>This command is particularly useful for projects with a large number of
simulations. Repetitive commands are grouped and placed in another text
file. If one of these commands changes, the command only has to be
edited once, rather than in every .ecf file.</p>
This command can be used to redirect file(s) up to a maximum of ten
levels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISBC"><tcmd>Read GIS BC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location and attributes of 1D model boundary conditions, as
described in Section <a href="#OneDBoundaries-2"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISIWL"><tcmd>Read GIS IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads initial water level elevations at nodes from a 1d_iwl GIS layer.
The 1d_iwl layer contains points snapped to nodes in the 1d_nwk
layer(s). The first attribute of the layer must be the initial water
level as a number (float or decimal). The layer can define any number of
the nodes (it does not need to define all the nodes). The command can be
used any number of times to access more than one 1d_iwl layer. The
command can be used in the .tcf and .tef files as 1D Read GIS IWL.</p>
See Section <a href="#IWL-1D-4"><strong>??</strong></a> for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISManhole"><tcmd>Read GIS Manhole </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads manhole locations and attributes from a GIS 1d_mh layer as
described in Section <a href="#OneD-mh-4"><strong>??</strong></a>. Any number of 1d_mh layers may be
read by repeating this command. Manholes that occur in the same location
will override each other with the last manhole processed prevailing.
Manholes processed using this command will overwrite any automatically
generated manholes. Automatically generated manholes may be individually
disabled by digitising points and specifying “NO” for the Loss_Approach
attribute – see Table <a href="#tab:tab-Manhole">45</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISNetwork"><tcmd>Read GIS Network </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads channel and node locations and attributes from a GIS 1d_nwk layer
as described in Sections <a href="#OneD-nwk-2"><strong>??</strong></a> and <a href="#Nodes-2"><strong>??</strong></a>. Any number of 1d_nwk
layers may be read by repeating this command. If accessing external
cross-section databases such as MIKE 11 .txt file, the <a href="#ecfXSDatabase">XS
Database</a> command must be specified before this command
to set the active cross-section database.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISNode"><tcmd>Read GIS Node </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads node locations and attributes from a GIS 1d_nd layer as described
in Table <a href="#tab:tab-DescriptionsNodes">48</a>. Any number of 1d_na layers may be read by
repeating this command. This is an alternative option to the 1d_nwk
<a href="#ecfReadGISNetwork">Read GIS Network</a> command, but applies to 1D nodes
only.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISPit"><tcmd>Read GIS Pits </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads virtual pipe locations and attributes from a GIS 1d_pit layer, as described in Section <a href="#Virtual-Pipes-2"><strong>??</strong></a>. If using the virtual pipe functionality a <a href="#ecfPitInletDatabase">Pit Inlet Database</a> is required.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISTableLinks"><tcmd>Read GIS Table Links </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads links to tabular input of cross-section profiles (1d_xs – see Section <a href="#XS-2"><strong>??</strong></a>), nodal surface areas (1d_na – see Section <a href="#NA-Table-4"><strong>??</strong></a>) or bridge loss coefficients (1d_bg – see Section <a href="#Bridges-3"><strong>??</strong></a>). The first attribute is the filename (can include a file path) of the .csv or similar file containing the table. This attribute can be setup as a hotlink, allowing the file to be opened in spreadsheet software via a GIS program.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISWLL"><tcmd>Read GIS WLL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads water level lines (WLL) and polygons for defining 1D map output, see Section <a href="#OneDMap-3"><strong>??</strong></a> for further information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadGISWLLPoints"><tcmd>Read GIS WLL Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
For <a href="#ecfWLLApproach">WLL Approach</a> Method B, reads elevation and
material points generated from the WLLs. This allows more accurate
velocity and flood hazard mapping. See Section <a href="#WLLp-4"><strong>??</strong></a> for more
information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfReadOperatingControlsFile"><tcmd>Read Operating Controls File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .toc_filename <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Directs input to the Operational Controls file (.toc) containing
operating rules applied to hydraulic structures, pumps and other
controllable devices. More than one .toc file can be created and accessed
should there be a need to break the control definitions into several
files (for example, all pump controls could be placed in one file and
sluice gate controls in another).</p>
Refer to Section <a href="#OperationalChannels-2"><strong>??</strong></a> for more information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfSChannelApproach"><tcmd>S Channel Approach </tcmd><teq>==<br></teq></a> <tblk>[ PRE 2004-06-AA |  METHOD A |  {METHOD B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>PRE 2004-06-AA provides backward compatibility of S channel types
for pre 2004-06-AA models.</p>
<p>METHOD A improved the S channel algorithm after Build 2004-06-AA. The
new approach utilises the approach used by G channels for handling
situations when the downstream end of a channel is dry or free-overfalling.</p>
METHOD B (the default) was introduced for the 2010-10 release after
rigorous testing on steep, fast flowing channels showed improved
performance over METHOD A. METHOD B only applies the G channel approach
in adverse flow conditions (i.e. when the water surface gradient is of
opposite slope to the channel bed slope), whereas METHOD A tests for and
may apply the G channel algorithm on any S channel, and was found in
extreme situations to cause some minor choking of the flow down the
channel.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfSetIWL"><tcmd>Set IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> IWL <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the initial water level at all nodes to <span class="math inline">\(\langle\)</span> IWL <span class="math inline">\(\rangle\)</span>. Initial water
levels different to <span class="math inline">\(\langle\)</span> IWL <span class="math inline">\(\rangle\)</span>, for example in a lake, can be set using the
“<a href="#tcfReadGISIWL">Read GIS IWL</a>” command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfSetVariable"><tcmd>Set Variable <span class="math inline">\(\langle\)</span>name<span class="math inline">\(\rangle\)</span> </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>value<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Define user variables for use within the control files, see <a href="#tcfSetVariable">Set Variable</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfSpatialDatabase"><tcmd>Spatial Database </tcmd><teq>==<br></teq></a> <tblk>[ OFF | TCF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Optional when using the GeoPackage input format. Sets the database to use for subsequent inputs. For more information see Section <a href="#GPKG-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStartOutput"><tcmd>Start Output </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> time_in_hours <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Use the .tcf <a href="#tcfTimeSeriesOutputInterval">Time Series Output Interval</a> command instead. Expand to find out more about the legacy settings.
</summary>
<p>The simulation time in hours when output commences. If the command is
omitted, the simulation start time is used.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStorageAboveStructureObvert"><tcmd>Storage Above Structure Obvert </tcmd><teq>==<br></teq></a> <tblk>[ CHANNEL WIDTH |  <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> |  {5} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Defines how the surface area is to be contributed to the NA table above
the obvert of B, C and R channels, it does not apply to manually defined
NA tables. The default is to apply 5% of the maximum surface area.</p>
<p>The CHANNEL WIDTH option uses the top width of B and R channels and the
diameter for C channels (see Section <a href="#Obvert-3"><strong>??</strong></a>). Older models that
used CHANNEL WIDTH (the default prior to 2006-03-AB) and require it for
stability, will most likely need to adopt a smaller 1D
<a href="#ecfTimestep">Timestep</a>. Alternatively, use of CHANNEL WIDTH is
acceptable provided the additional storage that it adds to the model is
relatively minor, or it can be demonstrated to not significantly
influence results.</p>
<p>If a value is specified, the channels width by half the channel length
is applied (provided the UCS attribute is left blank or set to “Y” (yes)
or “T” (true) between the invert and obvert, with <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> applied
above the obvert. If the (%) option is specified (the default), the
value applied above the obvert is the percentage of the structure’s
maximum surface area. The default setting is to use 5% of the
structure’s maximum surface area above the obvert. If the (%) option is
not specified, the value is in m<sup>2</sup> and is applied as a
constant above the obvert.</p>
<p>For C channels, the correct flow width in the section is applied (rather
than the diameter), and for C and R channels, the Number_of attribute in
the 1d_nwk layer is also used. Use this option where the storage
contributed by B, C and/or R channels is significant (e.g. pipe model).</p>
Note, the reason a storage value of zero is not automatically used above
the obvert is that a node cannot have zero storage. A value of zero can
be used provided storages at the nodes is contributed by other channels,
or a pit storage is applied or commands such as <a href="#ecfMinimumNA">Minimum
NA</a> are used. If the only channels connected to a node
are B, C and R channels, the NA table is extended vertically by 10m
(32.8ft) above the highest obvert. Should water levels exceed this
height, use <a href="#ecfDepthLimitFactor">Depth Limit Factor</a> to extend the
table further.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStructureFlowLevels"><tcmd>Structure Flow Levels </tcmd><teq>==<br></teq></a> <tblk>[ {ENERGY} |  WATER | ENERGY UPSTREAM ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
For calculating structure flows sets, defines whether to use energy or water surface levels as the global default in the flow calculations. The default is to use ENERGY (upstream and downstream). As of the 2023-03 Release “ENERGY UPSTREAM” can be used, which uses energy for the upstream and water level for the downstream. The global default can be overridden channel by channel using the “E”, “H”, or “EH” optional flag for the 1d_nwk Type attribute (see Table <a href="#tab:tab-LineTypesOptionalFlags">19</a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStructureLosses"><tcmd>Structure Losses </tcmd><teq>==<br></teq></a> <tblk>[ {ADJUST {EXCEPT BG TABLE}} |  FIX  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to ADJUST, the entrance and exit losses of culverts and the
bridge loss coefficients are adjusted according to the approach and
departure velocities upstream and downstream of the structure. See
Section  for details.</p>
<p>This setting can be overridden using an A (adjust) or F (fix) flag for
B, C and R channels.</p>
<p>If set to ADJUST EXCEPT BG TABLE (the default) only adjusts losses for
culverts and automatically generated BG tables noting that in the latter
it is only the deck loss component that is adjusted as the component
specified via the 1d_nwk Form_Loss attribute is always treated as fixed.
Any manually specified BG tables are not adjusted unless the “A” flag is
used in the 1d_nwk Type attribute or “Structure Losses == ADJUST” is
used without specifying “EXCEPT BG TABLE”.</p>
See Section <a href="#LossAdjustment-3"><strong>??</strong></a> for details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStructureLossesApproach"><tcmd>Structure Losses Approach </tcmd><teq>==<br></teq></a> <tblk>[ METHOD A |  {METHOD B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>METHOD A is the original ESTRY routine.</p>
METHOD B (the default) is an enhancement over METHOD A. It is the same
as METHOD A, except that if reverse flow occurs in the approach or
departure primary channels (reverse flow is when flow is in the opposite
direction to the channel’s digitised direction), the adjustment of
entrance and exit losses is based on the flow direction, not the
digitised direction.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStructureLossesSX"><tcmd>Structure Losses SX </tcmd><teq>==<br></teq></a> <tblk>[ ADJUST | ADJUST SKEW | {FIX} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Extends the adjustment of contraction and expansion losses for 1D culverts and bridges to automatically adjust at 1D/2D SX connections.</p>
<ul>
<li><p>The “FIX” option is the default and is the approach taken in prior builds, i.e. no adjustment of the losses.<br />
</p></li>
<li><p>The “ADJUST” (beta function) option takes the depth averaged velocities at SX cells and applies them as the approaching/departure velocities to adjust the entrance/exit loss coefficients of a 1D structure in the same manner as for a 1D/1D connection (see Section <a href="#LossAdjustment-3"><strong>??</strong></a>).</p></li>
<li><p>The “ADJUST SKEW” (beta function) option also considers the skew angle of the 2D velocity relative to the 1D structure entrance/exit. By default, the geographical angle of a 1D structure entrance/exit is automatically calculated from the 1d_nwk GIS layer to calculate the normal velocity:</p>
<p><span class="math inline">\(𝑉_{a𝑝𝑟𝑜𝑎𝑐ℎ} = u \times 𝑐𝑜𝑠(skew\ angle) + v \times sin(skew\ angle)\)</span></p>
<p>The skew angle can be also specified manually using the “B” attribute in a 2d_bc SX layer with the
following rules:</p>
<ul>
<li>If B = 0.01° ~ 360°, B defines the geometric angle of 1D structure entrance/exit.</li>
<li>If B = -0.01° ~ -90°, B defines the absolute skew angle, i.e.: <span class="math inline">\(𝑉_{a𝑝𝑟𝑜𝑎𝑐ℎ} = \sqrt{u^2 + v^2} \times 𝑐𝑜𝑠(skew\ angle)\)</span><br />
</li>
<li>B attribute is normally left as zero, and in such case, the automatically calculated geometric angle of the connected 1D GIS network is used.</li>
<li>To manually define a 0° angle, “B = 0.01°” can be specified where “0.01°” is rounded down to a geometric angle of 0°, while “B = -0.01°” is rounded up to an absolute angle of 0°. The “Zero Skew Angle” command can be used to make the cut-off value smaller than 0.01, in order to apply an even smaller user specified angle.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfStructureRoutines"><tcmd>Structure Routines </tcmd><teq>==<br></teq></a> <tblk>[ ORIGINAL |  {2013} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Default value recommended. Expand to find out more about the legacy settings.
</summary></li>
</ul></li>
</ul>
<p>ORIGINAL only allows structures available prior to Build 2013-12-AA to
be available to force users to limit their use of structures in a legacy
model.</p>
<p>2013 allows the use of the original structures, plus the many new
structures introduced for Build 2013-12-AA. This includes access to
operational structures and any other new structures added since Build
2013-12-AA.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfTaperClosedNATable"><tcmd>Taper Closed NA Table </tcmd><teq>==<br></teq></a> <tblk>[ {ON} |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reduces the second last surface area value gradually over 3 additional
levels for nodes connected to only closed channels such as bridges and
culverts. Also, for B and R channels, starts to reduce storage a 20% of
the structures total depth below the obvert, to prevent a sudden change
in surface area. This command is still to be further tested, but may
offer additional stability in urban models with many closed structures.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfTimestep"><tcmd>Timestep </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> timestep_in_seconds <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p><u>1D/2D TUFLOW Classic or 1D Only ESTRY Simulations</u></p>
<p>Specifies the fixed computational timestep of the simulation in seconds.
Value must be greater than zero. Timesteps that divide equally into one
minute or one hour are recommended. For example, 0.5, 1, 2, 3, 5, 6,
7.5, 10, 12, 15, 20, 30, 45, 60, etc. seconds.</p>
<p>A 1D timestep different to the timesteps of the 2D domains may be
specified for 1D/2D models, however the 1D timestep must not be greater
than the smallest timestep of the 2D domains.</p>
<p>If the 1D timestep is not equally divisible into the smallest 2D
timestep, the 1D timestep is reduced automatically so that it is equally
divisible. If this command is not specified in the .ecf file, the
smallest 2D timestep is used. See Section <a href="#OneDDomainsTimestep-3"><strong>??</strong></a> for details.</p>
<p><u>1D/2D TUFLOW HPC Simulations</u></p>
The 1D timestep for a HPC 1D/2D linked model represents the maximum
limiting timestep the 1D solver can use. ESTRY uses an adaptive/varying
timestep solution when used with the HPC solver. Both 1D and 2D
solutions are always synchronising at the 2D target timestep, or a
multiple of the 2D target timestep if the 1D timestep is sufficiently
greater for the 2D to perform more than one step. If the 1D limiting
timestep is less than half the 2D target timestep, the 1D proceeds in
two or more steps eventually synchronising with the 2D timestep. Where
there is not a one to one synchronisation of the 1D and 2D timesteps, a
usually negligible mass error may occur and can be checked by reviewing
the CME% values shown on the Console Window, the .tlf file or the
_MB.csv file in the same manner as Classic. . See Section <a href="#OneDDomainsTimestep-3"><strong>??</strong></a> for details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfTrimXZProfiles"><tcmd>Trim XZ Profiles </tcmd><teq>==<br></teq></a> <tblk>[ ON |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Trims the XZ profile extracted from Flood Modeller .dat files so that
the treatment at the ends of the cross-section profile is similar to
that used by Flood Modeller. If set to OFF the whole XZ profile is
stored with the sections of the profile before and after the left and
right markers disabled. However, the active end of the cross-section
profile will extend to midway between the first/last disabled point and
the last/first active point at either end of the profile. If set to ON,
the points before and after the left and right markers are not stored,
and the cross-section extent is not extended to midway to the first/last
points nearest the left and right markers.</p>
<strong>To have similar compatibility with Flood Modeller, this command should
be set to ON.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfCreepFactor"><tcmd>Vel Rate Creep Factor </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> |  {1.2} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies rate at which the <a href="#ecfVelRateLimit">Vel Rate Limit</a> value
changes. This value is rarely changed from its default value of 1.2. See
<a href="#ecfVelRateLimit">Vel Rate Limit</a> for further discussion.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfVelRateLimit"><tcmd>Vel Rate Limit </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> vrl <span class="math inline">\(\rangle\)</span> |  {0.2}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the velocity rate limit applied to non-inertial channels
(structures). This value is rarely changed from its default value of
0.2. During a computation this value is adjusted downwards if a
structure becomes unstable and upwards if stable using the <a href="#ecfCreepFactor">Vel Rate
Creep Factor</a> value. An “L” is shown in the second
space after velocity and flow time output in the .eof file, and also in
the_TSF output, indicating if the velocity rate limit algorithm
was applied. If a structure frequently has the velocity rate limit
applied to it, checks should be made on structure configuration and on
the results at the structure. For example, check the flow through the
structure based on the upstream and downstream water levels is similar
to that using desktop calculations or other software.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfVelRateLimitMinimum"><tcmd>Vel Rate Limit Minimum </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> vrlmin <span class="math inline">\(\rangle\)</span> |  {0.0001}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the minimum velocity rate limit that can occur. See <a href="#ecfVelRateLimit">Vel Rate
Limit</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWeirApproach"><tcmd>Weir Approach </tcmd><teq>==<br></teq></a> <tblk>[ {Method A} |  Method B  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This command specifies the approach taken to calculate submerged flow
for ‘W’ type weirs (refer to Section <a href="#W-Weir-4"><strong>??</strong></a>). For all other weir types, the approaches
used are discussed in Section <a href="#Adv-Weir-4"><strong>??</strong></a>.</p>
<p>Method A (the default) utilises the Bradley submergence approach which
after further analysis is the preferred approach.</p>
Method B was initially introduced to provide better stability for weirs
embedded within 2D domains. In some situations, this approach was found
to not converge very well and caused large head drops.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWeirFlow"><tcmd>Weir Flow </tcmd><teq>==<br></teq></a> <tblk>[ Method A | Method B |  {Method C} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Method A is the original ESTRY routine and only applies to W weirs.</p>
<p>Method B is not recommended – only applies to W weirs.</p>
<p>Method C (the default and introduced for the 2016-03 release), applies
Method A for the original W weirs, provides some minor improvement to WW
weirs, and otherwise has no influence for all other weir types
introduced for the 2013-12 release.</p>
Note that for the 2016-03 release there is a general improvement to all
new weirs introduced for the 2013-12 release when the weirs became
drowned out. Previously it was possible for an instability (usually
associated with a large head drop) and/or presence of NaNs in the
results. The new approach does not experience this issue and is
significantly more stable. There is no backward compatibility switch for
this change.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWLLApproach"><tcmd>WLL Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A |  {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to Method A uses the simpler approach for incorporating 1D output
into SMS and GIS map output. Method B (the default) allows the use of
elevation points and material values to more accurately map and animate
1D results. See Section <a href="#OneDMap-3"><strong>??</strong></a> for details on Method B and the
<a href="https://www.tuflow.com/Download/TUFLOW/Manuals/TUFLOW%20Manual.2010-10-AB.docx">TUFLOW 2010
Manual</a>
on Method A (noting that Method A is no longer supported).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWLLAutomatic"><tcmd>WLL Automatic </tcmd><teq>==<br></teq></a> <tblk>[ CULVERTS |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to CULVERTS, automatically generates 1D WLLs along culverts (C, R
and I channels). The WLL will have the same width as the culvert width,
and can save a lot of digitising for large pipe models! WLLs are placed
a short distance from each end of the culvert channel, and also at each
vertices along the channel line.</p>
See Section <a href="#OneDMap-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWLLNoWeirs"><tcmd>WLL No Weirs </tcmd><teq>==<br></teq></a> <tblk>[ ON | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to ON, TUFLOW will not assign any WLLs to 1D weir channels. This
is useful where weir channels modelling flow over a bridge or culvert
(especially those using the BW, CW or RW channel type) is in parallel to
a B, C or R channel. In this instance, it is not known whether the B, C
or R channel, or the W channel will be selected for assigning results to
WLLs. To guarantee that the B, C or R channel is selected use this
command with the ON option.</p>
See Section <a href="#OneDMap-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWLLVerticalOffset"><tcmd>WLL Vertical Offset </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> dZ <span class="math inline">\(\rangle\)</span> |  {10} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the vertical adjustment of WLL elevations in the mesh .2dm file. The
value of 10 generally means that the 1D WLL output sits above the 2D
cell output and is more visible (which presents data in order of
increasing height). However, in 3D the 1D appears perched on top of the
2D. To show the WLL mesh at its correct height for 3D displays specify a
dZ value of 0.0.</p>
<p>This command only affects the .2dm file, so can be applied to a
temporary .tcf file used solely to generate an alternative .2dm file
(i.e. there is no need to carry out the hydraulic calculations).</p>
See Section <a href="#OneDMap-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWLLpInterpolateBed"><tcmd>WLLp Interpolate Bed </tcmd><teq>==<br></teq></a> <tblk>[ {ON} |  OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If set to ON (the default), sets the centre WLL point to the channel bed
based on the processed data (rather than use any value from a WLLp
layer). This forces the bed profiles in longitudinal profile plots using
the ‑lp switch in the TUFLOW_to_GIS utility (see Section <a href="#Utilities-1"><strong>??</strong></a>) to
be based on that modelled, rather than that a DTM using WLLp values
(which may sometimes occur above the water surface!). Also helps to show
where the WLLp elevations are inconsistent with the channel bed when
viewing in SMS or using TUFLOW_to_GIS.</p>
<p>Doesn’t apply to culverts and bridges which use this approach
regardless, and only applies to <tcmd><a href="#ecfWLLApproach">WLL Approach</a></tcmd><teq> ==</teq><tblk>
Method B</tblk>.</p>
See Section <a href="#OneDMap-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfWriteCheckFiles"><tcmd>Write Check Files [Exclude | Include | None | ALL] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> prefix_list_or_file_prefix <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Creates GIS check files and text .csv files
for quality control checking of model input data. A list of check files
written are described in Section <a href="#CheckLayers-2"><strong>??</strong></a>. Refer to the <a href="#tcfWriteCheckFiles">Write Check Files</a> command in the
.tcf file for an explanation of the various options and for examples.</p>
Specifying the <a href="#tcfWriteCheckFiles">Write Check Files</a> command in the
.tcf file will automatically also write the 1D check files for 1D/2D
linked models. There is no need to specify <a href="#ecfWriteCheckFiles">Write Check
Files</a> in the .ecf file unless a different folder
path for the files is desired.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="ecfXSDatabase"><tcmd>XS Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active cross-section database as <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span>. The extension of the file determines its format as follows:</p>
<ul>
<li>.txt indicates a MIKE 11 .txt processed data import/export file. The file must contain processed cross-section data; any raw data is ignored.<br />
</li>
<li>.dat indicates a Flood Modeller data file containing XZ cross-section profiles – also see <a href="#ecfTrimXZProfiles">Trim XZ Profiles</a>.<br />
</li>
<li>.pro indicates a Flood Modeller processed cross-section data file.<br />
</li>
<li>other file formats including a generic .csv format are planned to be incorporated.</li>
</ul>
<p>The assignment of cross-sections is carried out using 1d_nwk attributes as discussed in Section <a href="#XS-2"><strong>??</strong></a>.</p>
This command must be specified before a <a href="#ecfReadGISNetwork">Read GIS Network</a> command. The command may be used at any point to change the active cross-section database.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TGCCommands-1"><span class="header-section-number">21</span> TGC Commands<a href="#TGCCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW Geometry Control File (.tgc) includes commands and geometric / topographic data inputs to build the 2D domain. It is read into the .tcf using the <a href="#tcfGeometryControlFile">Geometry Control File</a> command. For more information on the .tgc, see Section <a href="#TGC-3"><strong>??</strong></a>. Building the 2D domain is discussed in Chapter <a href="#TwoD-Domains-1"><strong>??</strong></a>. The available TGC commands are listed below and are detailed in Table <a href="#tab:tab-TGCCommands">135</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tgc12DAReadApproach">12DA Read Approach</a><br />
<a href="#tgcAllowDanglingZLines">Allow Dangling Z Lines</a><br />
<a href="#tgcCellSize">Cell Size</a><br />
<a href="#tgcCreateTINZpts">Create TIN Zpts</a><br />
<a href="#tgcDefaultLandZ">Default Land Z</a><br />
<a href="#tgcGridApproach">Grid Approach</a><br />
<a href="#tgcGridSizeNM">Grid Size (N,M)</a><br />
<a href="#tgcGridSizeXY">Grid Size (X,Y)</a><br />
<a href="#tgcIfScenario">If Scenario</a><br />
<a href="#tgcInterpolateZC">Interpolate ZC</a><br />
<a href="#tgcInterpolateZHC">Interpolate ZHC</a><br />
<a href="#tgcInterpolateZUV">Interpolate ZUV</a><br />
<a href="#tgcInterpolateZUVC">Interpolate ZUVC</a><br />
<a href="#tgcInterpolateZUVH">Interpolate ZUVH</a><br />
<a href="#tgcOrientationAngle">Orientation Angle</a><br />
<a href="#tgcOrientation">Orientation</a><br />
<a href="#tgcOrigin">Origin</a><br />
<a href="#tgcPauseWhenPolylineDoesNotFindZpt">Pause When Polyline Does Not Find Zpt</a><br />
<a href="#tgcReadFile">Read File</a><br />
<a href="#tgcReadGIS">Read GIS <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span></a><br />
<a href="#tgcReadGISBGShape">Read GIS BG Shape</a><br />
<a href="#tgcReadGISCnM">Read GIS CnM</a><br />
<a href="#tgcReadGISCode">Read GIS Code</a><br />
<a href="#tgcReadGISCWF">Read GIS CWF</a><br />
<a href="#tgcReadGISFCShape">Read GIS FC Shape</a><br />
<a href="#tgcReadGISFLC/L">Read GIS FLC/L</a><br />
<a href="#tgcReadGISFLC">Read GIS FLC</a><br />
<a href="#tgcReadGISFRIC">Read GIS FRIC</a><br />
<a href="#tgcReadGISGWD">Read GIS GWD</a><br />
<a href="#tgcReadGISGWL">Read GIS GWL</a><br />
<a href="#tgcReadGISIGWConc">Read GIS IGW Conc Layer N1,N2,..N Tracer M1,M2,..M</a><br />
<a href="#tgcReadGISIGWDepth">Read GIS IGW Depth</a><br />
<a href="#tgcReadGISIGWLevel">Read GIS IGW Level</a><br />
<a href="#tgcReadGISIWL">Read GIS IWL</a><br />
<a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a><br />
<a href="#tgcReadGISLocation">Read GIS Location</a><br />
<a href="#tgcReadGISMat">Read GIS Mat</a><br />
<a href="#tgcReadGISObjects">Read GIS Objects</a><br />
<a href="#tgcReadGISReceptors">Read GIS Receptors</a><br />
<a href="#tgcReadGISSoil">Read GIS Soil</a><br />
<a href="#tgcReadGISSoilBaseElevation">Read GIS Soil Base Elevation</a><br />
<a href="#tgcReadGISSoilThickness">Read GIS Soil Thickness</a><br />
<a href="#tgcReadGISSRF">Read GIS SRF</a><br />
<a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a><br />
<a href="#tgcReadGISWrF">Read GIS WrF</a><br />
<a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a><br />
<a href="#tgcReadGISZLine">Read GIS Z Line</a><br />
<a href="#tgcReadGISZShape">Read GIS Z Shape</a><br />
<a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a><br />
<a href="#tgcReadGISZpt">Read GIS Zpts</a><br />
<a href="#tgcReadGISZptModifyConveyance">Read GIS Zpts Modify Conveyance</a><br />
<a href="#tgcReadGrid">Read Grid <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span></a><br />
<a href="#tgcReadGridCnM">Read Grid CnM</a><br />
<a href="#tgcReadGridCode">Read Grid Code</a><br />
<a href="#tgcReadGridCWF">Read Grid CWF</a><br />
<a href="#tgcReadGridFLC/L">Read Grid FLC/L</a><br />
<a href="#tgcReadGridFLC">Read Grid FLC</a><br />
<a href="#tgcReadGridGWD">Read Grid GWD</a><br />
<a href="#tgcReadGridGWL">Read Grid GWL</a><br />
<a href="#tgcReadGridIGWConc">Read Grid IGW Conc Layer N1,N2,..N Tracer M1,M2,..M</a><br />
<a href="#tgcReadGridIGWDepth">Read Grid IGW Depth</a><br />
<a href="#tgcReadGridIGWLevel">Read Grid IGW Level</a><br />
<a href="#tgcReadGridIWL">Read Grid IWL</a><br />
<a href="#tgcReadGridLocation">Read Grid Location</a><br />
<a href="#tgcReadGridMat">Read Grid Mat</a><br />
<a href="#tgcReadGridSoil">Read Grid Soil</a><br />
<a href="#tgcReadGridSoilBaseElevation">Read Grid Soil Base Elevation</a><br />
<a href="#tgcReadGridSoilThickness">Read Grid Soil Thickness</a><br />
<a href="#tgcReadGridSRF">Read Grid SRF</a><br />
<a href="#tgcReadGridWrF">Read Grid WrF</a><br />
<a href="#tgcReadGridZpts">Read Grid Zpts</a><br />
<a href="#tgcReadRowCol">Read RowCol <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span></a><br />
<a href="#tgcReadRowColWrF">Read RowCol WrF</a><br />
<a href="#tgcReadRowColGrid">Read RowCol Zpts</a><br />
<a href="#tgcReadTINZpts">Read TIN Zpts</a><br />
<a href="#tgcSet">Set <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span></a><br />
<a href="#tgcSetCnM">Set CnM</a><br />
<a href="#tgcSetCode">Set Code</a><br />
<a href="#tgcSetCodeandCleanZpt">Set Code and Clean Zpt</a><br />
<a href="#tgcSetCWF">Set CWF</a><br />
<a href="#tgcSetFLC/L">Set FLC/L</a><br />
<a href="#tgcSetFLC">Set FLC</a><br />
<a href="#tgcSetFRIC">Set FRIC</a><br />
<a href="#tgcSetGWD">Set GWD</a><br />
<a href="#tgcSetGWL">Set GWL</a><br />
<a href="#tgcSetIGWConc">Set IGW Conc Layer N1,N2,..N Tracer M1,M2,..M</a><br />
<a href="#tgcSetIGWDepth">Set IGW Depth</a><br />
<a href="#tgcSetIGWLevel">Set IGW Level</a><br />
<a href="#tgcSetIWL">Set IWL</a><br />
<a href="#tgcSetMat">Set Mat</a><br />
<a href="#tgcSetRouteCutOffType">Set Route Cut Off Type</a><br />
<a href="#tgcSetRouteCutOffValues">Set Route Cut Off Values</a><br />
<a href="#tgcSetSoil">Set Soil</a><br />
<a href="#tgcSetSoilBaseElevation">Set Soil Base Elevation</a><br />
<a href="#tgcSetSoilThickness">Set Soil Thickness</a><br />
<a href="#tgcSetSRF">Set SRF</a><br />
<a href="#tgcSetVariable">Set Variable <span class="math inline">\(\langle\)</span>name<span class="math inline">\(\rangle\)</span></a><br />
<a href="#tgcSetWrF">Set WrF</a><br />
<a href="#tgcSetZpt">Set Zpt</a><br />
<a href="#tgcSGSSampleDistance">SGS</a><br />
<a href="#tgcSGSGridMaxNullFrac">SGS Grid Max Null Frac</a><br />
<a href="#tgcSGSPartialGridUpdateNullFrac">SGS Partial Grid Update Null Frac</a><br />
<a href="#tgcSpatialDatabase">Spatial Database</a><br />
<a href="#tgcStop">Stop</a><br />
<a href="#tgcTINAngles">Thin Line as Thick</a><br />
<a href="#tgcTINAngles">TIN Angles</a><br />
<a href="#tgcTINCoincidentPointDistance">TIN Coincident Point Distance</a><br />
<a href="#tgcWriteGISDomain">Write GIS Domain</a><br />
<a href="#tgcWriteGISGrid">Write GIS Grid</a><br />
<a href="#tgcWriteGISZpt">Write GIS Zpts</a><br />
<a href="#tgcZC">ZC</a><br />
<a href="#tgcZeroZPoint">Zero Z Point</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TGCCommands">Table 135: </span><strong>TUFLOW Classic/HPC TGC Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgc12DAReadApproach"><tcmd>12DA Read Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A | {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Defines the approach used to read the 12DA file format. Method B (default) supports super TINs. This method for reading 12da TIN files however may require slightly more memory (RAM) than the previous method. Set this command to Method A to revert to the previous method for reading 12da files. See Section <a href="#GISFormats-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcAllowDanglingZLines"><tcmd>Allow Dangling Z Lines </tcmd><teq>==<br></teq></a> <tblk>[ ON  |  {OFF}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Only applicable to superseded <a href="#tgcReadGISZLine">Read GIS Z Line</a> command. Expand to find out more.
</summary>
<p>If a breakline using the <a href="#tgcReadGISZLine">Read GIS Z Line</a> command does not find a snapped point at the end (i.e. the end is dangling), but the line has at least one snapped point elsewhere along the line, this command when set to ON, assigns the elevation of the nearest snapped point to the dangling end. This command may be used several times through a .tgc file to change the setting before different <a href="#tgcReadGISZLine">Read GIS Z Line</a> commands. Elevations applied to dangling ends are displayed to the check and log file.</p>
<p>The default (OFF) option does not allow dangling breaklines. In which case, <a href="https://wiki.tuflow.com/TUFLOW_Message_2075">WARNING 2075</a> is written to the tlf and the elevation adopted is that given to the line (i.e. all snapped points are ignored).</p>
<p>Note, if the Z attribute of the line is NULL, <a href="https://wiki.tuflow.com/TUFLOW_Message_2073">WARNING 2073</a> is produce and the line ignored.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcCellSize"><tcmd>Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the grid’s cell size in metres (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>). See Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcCreateTINZpts"><tcmd>Create TIN Zpts [ {} | WRITE TIN ] [ XF ON | XF OFF ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Creates a TIN for each polygon in the GIS layer, and assigns elevations
to any Zpts falling within the TIN. Any points and lines falling within
the polygon are used for creating the TIN surface. Lines can have points
snapped to them to create a 3D breakline effect through the TIN. For
more information and examples, see Section <a href="#ztin-4"><strong>??</strong></a>.</p>
<p>If WRITE TIN is specified, a SMS .tin file is written to the same
location as the GIS layer. The TIN can be viewed/checked in SMS, edited
and modified if needed. <a href="#tgcReadTINZpts">Read TIN Zpts</a> can be used to
assign Zpt values resulting from the modified TIN. If <a href="#tcfWriteCheckFiles">Write Check
Files</a> is active and WRITE TIN is specified, the
triangles are written to the 2d_sh_obj_check layer.</p>
XF ON and XF OFF switch the automatic generation of XF files ON or OFF
specifically for <span class="math inline">\(\langle\)</span> zpt_file <span class="math inline">\(\rangle\)</span>. The global default for using XF files is
ON and can be changed using <a href="#tcfXFFiles">XF Files</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcDefaultLandZ"><tcmd>Default Land Z </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> elevation <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets any previously unspecified ZH, ZU, ZV or ZC Zpts to the value for
land cells only (code value of “0”, see Section <a href="#CellCodes-3"><strong>??</strong></a>). Is useful where all the land cells and their Zpts have
been removed from the GIS layers to keep file sizes to a minimum.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcGridApproach"><tcmd>Grid Approach </tcmd><teq>==<br></teq></a> <tblk>[ Method A |  {Method B} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Default value recommended. Expand to find out more about the legacy settings.
</summary>
<p>Method A: for iSP (single precision) builds, this method was found to occasionally generate a NaN (not a number) at a Zpt due to precision issues. This has been fixed for Method B.</p>
<p>Method B (default): assigns values to Zpts that fall within the outer half of the DEM cells around the DEM perimeter. Previously, if processing a group of DEM tiles (i.e. using multiple <a href="#tgcReadGridZpts">Read Grid Zpt</a> commands, one for each tile), any Zpts lying within the outer half of the DEM perimeter cells were not assigned a value. The new approach assigns values to Zpts around the DEM perimeter based on an interpolation of the two DEM cells the Zpt lies nearest to. Provided tiled DEMs have a common edge (or overlapping edge), all Zpts near the DEM edges should now be assigned a value.</p>
<p>The Grid Approach command may be used any number of times within the .tgc file with the latest setting prevailing when a <a href="#tgcReadGrid">Read Grid</a> command is processed. If associated .xf files exist from previous simulations, and <a href="#tgcGridApproach">Grid Approach</a> set to Method B is applied, TUFLOW will automatically resample and replace the existing .xf files. The Zpt values will essentially be identical or very similar except for around the perimeter of the DEM as discussed above. This also applies for all <a href="#tgcReadGrid">Read Grid</a> options (e.g. also applies to “Read Grid Mat”).</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcGridSizeNM"><tcmd>Grid Size (N,M) </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> rows <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> columns <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the dimensions of the grid based on the number of rows and columns. The values entered must be integer values. See Section <a href="#Domain-3"><strong>??</strong></a>.</p>
See also the command <a href="#tgcReadGridLocation">Read GRID Location</a>, which defines the size and location of a 2D domain based on a DEM.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcGridSizeXY"><tcmd>Grid Size (X,Y) </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> X_length <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> Y_length <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the dimensions of the grid using a distance along the grid’s X‑axis (<span class="math inline">\(\langle\)</span> X_length <span class="math inline">\(\rangle\)</span>) and Y‑axis (<span class="math inline">\(\langle\)</span> Y_length <span class="math inline">\(\rangle\)</span>). The number of columns and rows is rounded to
the nearest integer, therefore, <span class="math inline">\(\langle\)</span> X_length <span class="math inline">\(\rangle\)</span> and <span class="math inline">\(\langle\)</span> Y_length <span class="math inline">\(\rangle\)</span> do not have to be an
exact multiple of the cell size. See Section <a href="#Domain-3"><strong>??</strong></a>.</p>
See also the command <a href="#tgcReadGridLocation">Read GRID Location</a>, which
defines the size and location of a 2D domain based on a DEM.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcIfScenario"><tcmd>If Scenario </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> s1 <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> s2 <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> s3 <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls which commands to process for different scenarios, as specified using the –s run option (see Section <a href="#Scenarios-3"><strong>??</strong></a> and Table <a href="#tab:tab-TUFLOWOptions">116</a>) or <a href="#tcfModelScenarios">Model Scenarios</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcInterpolateZC"><tcmd>Interpolate ZC [ {} | ALL ] [ {} | LOWER ] </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Interpolates ZC elevations where they have not been specified. If ALL
occurs at the end of the command, then all ZC elevations are
interpolated. Note: If a value already exists (for example, from previous <a href="#tgcReadGISZpt">Read GIS
Zpts</a> commands) it will not be affected unless the ALL
option is specified.</p>
<p>The LOWER option sets the ZC value to the average of the two lowest of
the four ZU and ZV points. This is useful in models with highly variable
or bumpy topography (e.g. of urban areas with buildings incorporated),
as it will open up and smooth some flow paths that were blocked by a
high ZC value. The default is to set the ZC value to the average of the
four ZU and ZV values. Note, only applies to topography commands below this command in the .tgc
file.</p>
Also see <a href="#tgcInterpolateZHC">Interpolate ZHC</a>, <a href="#tgcInterpolateZUV">Interpolate
ZUV</a>, <a href="#tgcInterpolateZUVC">Interpolate ZUVC</a>,
<a href="#tgcInterpolateZUVH">Interpolate ZUVH</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcInterpolateZHC"><tcmd>Interpolate ZHC [ {} | ALL ] </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Interpolates ZH and ZC elevations where they have not been specified. If
ALL occurs at the end of the command, then all ZH and ZC elevations are
interpolated. The values are a linear interpolation of the ZU and ZV
values.</p>
<p>This command can provide some “smoothing” of the cell centre and corner
elevations that may be desirable in a model, particularly if the DTM
data is “bumpy”, such as occurs from airborne laser surveys.</p>
<p>Note, only applies to topography commands below this command in the .tgc
file.</p>
Also see <a href="#tgcInterpolateZC">Interpolate ZC</a>, <a href="#tgcInterpolateZUV">Interpolate
ZUV</a>, <a href="#tgcInterpolateZUVC">Interpolate ZUVC</a>,
<a href="#tgcInterpolateZUVH">Interpolate ZUVH</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcInterpolateZUV"><tcmd>Interpolate ZUV [ {} | ALL ] [ {} | MAX ] </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Interpolates ZU and ZV elevations where they have not been specified. If
ALL occurs at the end of the command, then all ZU and ZV elevations are
interpolated. The ZU and ZV values are a linear interpolation of the
neighbouring ZC values.</p>
<p>This command can provide some “smoothing” of the cell side elevations
that may be desirable in a model, particularly if the DTM data is
“bumpy”, such as occurs from airborne laser surveys.</p>
<p>The MAX option sets the ZU and ZV values to the higher of the
neighbouring ZC values (rather than a linear interpolation). This option
is experimental and is not recommended for practical use.</p>
<p>Note, only applies to topography commands below this command in the .tgc
file.</p>
Also see <a href="#tgcInterpolateZC">Interpolate ZC</a>, <a href="#tgcInterpolateZHC">Interpolate
ZHC</a>, <a href="#tgcInterpolateZUVC">Interpolate ZUVC</a>,
<a href="#tgcInterpolateZUVH">Interpolate ZUVH</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcInterpolateZUVC"><tcmd>Interpolate ZUVC [ {} | ALL ] </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Interpolates ZC, ZU and ZV elevations where they have not been
specified. If ALL occurs at the end of the command, then all ZC, ZU and
ZV elevations are interpolated. The ZU and ZV values are a linear
interpolation of the neighbouring ZH values, while the ZC value is the
average of the four surrounding ZH values (this was the standard
approach of earlier versions of TUFLOW where only the Zpts at the H
location were specified).</p>
<p>Note, only applies to topography commands below this command in the .tgc
file.</p>
Also see <a href="#tgcInterpolateZC">Interpolate ZC</a>, <a href="#tgcInterpolateZHC">Interpolate
ZHC</a>, <a href="#tgcInterpolateZUV">Interpolate ZUV</a>,
<a href="#tgcInterpolateZUVH">Interpolate ZUVH</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcInterpolateZUVH"><tcmd>Interpolate ZUVH [ {} | ALL ] [ {} | MAX ] </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Interpolates ZH, ZU and ZV elevations where they have not been
specified. If ALL occurs at the end of the command, then all ZH, ZU and
ZV elevations are interpolated. The ZU and ZV values are a linear
interpolation of the neighbouring ZC values, while the ZH value is the
average of the four surrounding ZC values. This option is particularly
useful for converting MIKE 21 models where the elevations are only
specified at the cell centres.</p>
<p>The MAX option sets the ZU and ZV values to the higher of the
neighbouring ZC values (rather than a linear interpolation). This option
is experimental and is not recommended for practical use.</p>
<p>Note, only applies to topography commands below this command in the .tgc
file.</p>
Also see <a href="#tgcInterpolateZC">Interpolate ZC</a>, <a href="#tgcInterpolateZHC">Interpolate
ZHC</a>, <a href="#tgcInterpolateZUV">Interpolate ZUV</a>,
<a href="#tgcInterpolateZUVC">Interpolate ZUVC</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcOrientation"><tcmd>Orientation </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> XX <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> YX <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the geographical orientation of the grid in metres (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>) using another point along
the bottom (X-axis) of the grid with coordinates <span class="math inline">\(\langle\)</span> XX <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> YX <span class="math inline">\(\rangle\)</span>. To set
the grid’s origin see <a href="#tgcOrigin">Origin</a>. See Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcOrientationAngle"><tcmd>Orientation Angle </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> angle <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the geographical orientation of the grid using an angle. The angle is in degrees relative to east (e.g. X-axis directly north would be 90°). See Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcOrigin"><tcmd>Origin </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> OX <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> OY <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the geographical origin of the grid, the origin being the lower
left corner of the lower left cell. <span class="math inline">\(\langle\)</span> OX <span class="math inline">\(\rangle\)</span> is the X‑coordinate and <span class="math inline">\(\langle\)</span> OY <span class="math inline">\(\rangle\)</span> the Y‑coordinate in metres (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>). See Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcPauseWhenPolylineDoesNotFindZpt"><tcmd>Pause When Polyline Does Not Find Zpt </tcmd><teq>==<br></teq></a> <tblk>[ ON  | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Only applicable to superseded <a href="#tgcReadGISZLine">Read GIS Z Line</a> command. Expand to find out more.
</summary>
<p>If a breakline using the <a href="#tgcReadGISZLine">Read GIS Z Line</a> command does not find a Zpt, the default (OFF) option produces <a href="https://wiki.tuflow.com/TUFLOW_Message_2075">WARNING 2075</a> in the tlf and the elevation adopted is the value assigned to the line (i.e. all snapped points are ignored). Note, if the Z attribute of the line is NULL, <a href="https://wiki.tuflow.com/TUFLOW_Message_2073">WARNING 2073</a> is produce and the line ignored. The ‘OFF’ option is useful where there are very short breaklines (for example, survey lines imported from another software which has lost the connectivity between line segments), which do not affect any Zpts.</p>
<p>By setting this command to ON, if a breakline using the <a href="#tgcReadGISZLine">Read GIS Z Line</a> command does not find a Zpt, TUFLOW will pause (with a warning message) and waits for a return key to be entered.</p>
<p>This command may be used several times through a file to change the setting before different <a href="#tgcReadGISZLine">Read GIS Z Line</a> commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadFile"><tcmd>Read File </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Directs input to another file. When finished reading <span class="math inline">\(\langle\)</span> file <span class="math inline">\(\rangle\)</span>, TUFLOW returns to reading the .tgc file. See Section <a href="#ReadFile-3"><strong>??</strong></a>.</p>
<p>This command is particularly useful for projects with a large number of
.tgc files. Repetitive commands are grouped and placed in another text
file. If one of these commands changes, the command only has to be
edited once, rather than in every .tgc file.</p>
<p>For example, as the grid size, location and orientation commands are
likely to be the same for all runs, placing these commands in their own
text file could be advantageous if ever the grid’s size, location and/or
orientation changes (i.e. only one file would have to be edited).</p>
This command can be used in redirected file(s) up to a maximum of ten levels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGIS"><tcmd>Read GIS <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span> </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The following Read GIS options are available:</p>
<ul>
<li><a href="#tgcReadGISBGShape">Read GIS BG Shape</a></li>
<li><a href="#tgcReadGISCnM">Read GIS CnM</a></li>
<li><a href="#tgcReadGISCode">Read GIS Code</a></li>
<li><a href="#tgcReadGISCWF">Read GIS CWF</a></li>
<li><a href="#tgcReadGISFCShape">Read GIS FC Shape</a></li>
<li><a href="#tgcReadGISFLC">Read GIS FLC</a></li>
<li><a href="#tgcReadGISFLC/L">Read GIS FLC/L</a></li>
<li><a href="#tgcReadGISFRIC">Read GIS FRIC</a></li>
<li><a href="#tgcReadGISGWD">Read GIS GWD</a></li>
<li><a href="#tgcReadGISGWL">Read GIS GWL</a></li>
<li><a href="#tgcReadGISIGWConc">Read GIS IGW Conc Layer N1,N2,..N Tracer M1,M2,..M</a></li>
<li><a href="#tgcReadGISIGWDepth">Read GIS IGW Depth</a></li>
<li><a href="#tgcReadGISIGWLevel">Read GIS IGW Level</a></li>
<li><a href="#tgcReadGISIWL">Read GIS IWL</a></li>
<li><a href="#tgcReadGISLayeredFCShape">Read GIS Layered FC Shape</a></li>
<li><a href="#tgcReadGISLocation">Read GIS Location</a></li>
<li><a href="#tgcReadGISMat">Read GIS Mat</a></li>
<li><a href="#tgcReadGISObjects">Read GIS Objects</a></li>
<li><a href="#tgcReadGISSoil">Read GIS Soil</a></li>
<li><a href="#tgcReadGISSoilBaseElevation">Read GIS Soil Base Elevation</a></li>
<li><a href="#tgcReadGISSoilThickness">Read GIS Soil Thickness</a></li>
<li><a href="#tgcReadGISSRF">Read GIS SRF</a></li>
<li><a href="#tgcReadGISVariableZShape">Read GIS Variable Z Shape</a></li>
<li><a href="#tgcReadGISWrF">Read GIS WrF</a></li>
<li><a href="#tgcReadGISZHXLine">Read GIS Z HX Line</a></li>
<li><a href="#tgcReadGISZLine">Read GIS Z Line</a></li>
<li><a href="#tgcReadGISZShape">Read GIS Z Shape</a></li>
<li><a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a></li>
<li><a href="#tgcReadGISZptModifyConveyance">Read GIS Zpts Modify Conveyance</a></li>
<li><a href="#tgcReadGISZpt">Read GIS Zpts</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISBGShape"><tcmd>Read GIS BG Shape </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Used to read in a 2D bridge object (2d_bg) GIS layer which constricts the flow across a 2D cell side. See Section <a href="#bg-layer-4"><strong>??</strong></a>.</li>
</ul>
This command was introduced in the 2023-03 release.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISCnM"><tcmd>Read GIS CnM </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Bed resistance value. CnM is a Chezy C, Manning’s n or Manning’s M value as set by <a href="#tcfBedResistanceValues">Bed Resistance Values</a>. Uses 2d_mat GIS layer. See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISCode"><tcmd>Read GIS Code  [ {} | BC | Invert | BC Invert ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to specify the cell code (see Section <a href="#CellCodes-3"><strong>??</strong></a>). Uses 2d_code GIS layer.</p>
<p>The following values can be specified:</p>
<ul>
<li>0: Inactive cells (e.g. land or redundant cells);<br />
</li>
<li>1: Active cells (e.g. water);<br />
</li>
<li>2: Boundary cells (e.g. active cells with an external boundary);</li>
<li>-1: Inactive cells within the active domain.</li>
</ul>
<p>Any values great than 2 will be treated as active cells (cell code of 1). Any values less than -1 will be treated as inactive cells (cell code of 0).</p>
<p>When using “Read GIS Code BC”, code values are extracted from objects in a 2d_bc layer that have a Type attribute of “CD” (instead of the 2d_code), the code value is taken from the 2d_bc f attribute. See Table <a href="#tab:tab-ConditionsAttribute">78</a>.</p>
If INVERT is specified (e.g.”Read GIS Code Invert” or “Read GIS Code BC Invert”), the active/inactive status of any Code polygons are reversed (ie. a Code of 1 becomes 0, and a Code of -1 or 0 becomes 1). This means that the same layer can be used by both .tgc and .tbc files when linking 2D domains using TUFLOW Classic Multiple 2D Domain Module.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISCWF"><tcmd>Read GIS CWF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the cell flow width (see Section <a href="#CWF-4"><strong>??</strong></a>) based on the input GIS layer. The value entered for CWF is a factor to adjust the 2D cell flow widths (in the same manner as 2D flow constrictions (2d_fc)), noting that the changed flow width applies to all depths. For example 0.1 will limit the flow width to 10%.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISFCShape"><tcmd>Read GIS FC Shape [ {} | Write TIN ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
Command to read in a flow constriction shape (2d_fcsh) GIS layer which constricts the flow across a 2D cell side. See Section <a href="#CLA-FC-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISFLC"><tcmd>Read GIS FLC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Applies the form loss attribute values to all cells within each
region. Uses 2d_flc GIS layer. See Section <a href="#flc-4"><strong>??</strong></a>.</p>
Note, the FLC values will need to be changed if the 2D cell size
changes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISFLC/L"><tcmd>Read GIS FLC/L </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Applies a form loss per unit length to all cells within each region. Uses 2d_flc GIS layer.
The effect of applying the FLC in this manner is 2D cell size
independent. See Section <a href="#flc-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISFRIC"><tcmd>Read GIS FRIC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Ripple height. See Section <a href="#CLA-mat-3"><strong>??</strong></a>. Uses 2d_mat GIS layer.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISGWD"><tcmd>Read GIS GWD </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcReadGISSoilThickness">Read GIS Soil Thickness</a> instead. Expand to find out more.
</summary>
<p>Groundwater depth (see Section <a href="#IGW-3"><strong>??</strong></a>). Uses 2d_gw GIS layer. This command may only be specified following <a href="#tgcSetSoil">Set Soil</a>, <a href="#tgcReadGISSoil">Read GIS Soil</a> and/or <a href="#tgcReadGridSoil">Read Grid Soil</a> commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISGWL"><tcmd>Read GIS GWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcReadGISSoilBaseElevation">Read GIS Soil Base Elevation</a> instead. Expand to find out more.
</summary>
<p>Groundwater level (see Section <a href="#IGW-3"><strong>??</strong></a>). Uses 2d_gw GIS layer. This command may only be specified following <a href="#tgcSetSoil">Set Soil</a>, <a href="#tgcReadGISSoil">Read GIS Soil</a> and/or <a href="#tgcReadGRIDSoil">Read GRID Soil</a> commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISIGWConc"><tcmd>Read GIS IGW Conc Layer N1,N2,..N Tracer M1,M2,..M </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Sets the initial concentration of one or more tracers in one or more groundwater layers of the model based on the input GIS layer. Where N1,N2,..N are the groundwater layer numbers and M1,M2,..M are the tracer numbers. If a layer number is not referenced, it is assumed to apply to layer 1. Likewise, if a tracer number is not referenced it is assumed to apply to the first tracer. For more information see Section <a href="#GW-initial-conditions"><strong>??</strong></a>. Uses 2d_gw GIS layer.</p>
Note, the order that ‘Layer’ and ‘Tracer’ appear in the command does not matter (i.e. tracer numbers could be listed before layer numbers).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISIGWDepth"><tcmd>Read GIS IGW Depth [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial water depth in the Nth subsurface layer in meters (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>) based on the input GIS layer. Assumed to be the depth of water in the soil (water content divided by porosity). If <a href="#tgcReadGISIGWDepth">Read GIS IGW Depth Layer N</a> is used with the <a href="#tgcReadGISIGWLevel">Read GIS IGW Level Layer N</a> the highest initial condition will be adopted.
If using multiple soil layers (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>), the initial conditions do not automatically cascade into layers below (i.e. setting the initial water depth in the top layer will not automatically set the layers below to be 100% saturated).
Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf. Uses 2d_gw GIS layer.
For more information see Section <a href="#IGW-3"><strong>??</strong></a>.</p>
Note, multiple soil layers in the vertical are only supported using TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISIGWLevel"><tcmd>Read GIS IGW Level [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial water level in the Nth subsurface layer in meters (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>) based on the input GIS layer. If <a href="#tgcReadGISIGWDepth">Read GIS IGW Depth Layer N</a> is used with the <a href="#tgcReadGISIGWLevel">Read GIS IGW Level Layer N</a> the highest initial condition will be adopted.
The initial conditions do not automatically cascade into layers below (i.e. setting the initial water level in the top layer will not automatically set the layers below to be 100% saturated).
Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf. Uses 2d_gw GIS layer.
For more information see Section <a href="#IGW-3"><strong>??</strong></a>.</p>
Note, multiple soil layers in the vertical are only supported using TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISIWL"><tcmd>Read GIS IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial water level (see Section <a href="#IWL-3"><strong>??</strong></a>) based on the input (2d_iwl) GIS layer. The units are metres (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>).</p>
Note: IWLs can also be set in the .tcf file (see <a href="#tcfSetIWL">Set IWL</a>). This is
preferable if the initial water levels vary from simulation to
simulation as it removes the necessity to create a new .tgc file each
time the initial water levels change. Any IWL values set in the .tcf
file override those specified in the .tgc file for the same
cells.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISLayeredFCShape"><tcmd>Read GIS Layered FC Shape [ {} | Write TIN ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Offers the ability to vary flow constriction (FC) parameters with height as a method to model obstructions, such as bridges and above ground pipeline infrastructure, in 2D at all flow heights. Uses 2d_lfcsh GIS layer. See Section <a href="#flc-4"><strong>??</strong></a> for details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISLocation"><tcmd>Read GIS Location </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the geographical origin and orientation of the grid based on the
first line or region found in <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span>. Uses 2d_loc GIS layer. The orientation
is based on the first point in the line or region being located at the
bottom left corner of the grid.</p>
<p>If a line is used the second point is located anywhere along
the bottom of the grid to set the orientation of the grid – it does not
determine the length of the grid along the X-axis (use <a href="#tgcGridSizeNM">Grid Size
(N,M)</a> or <a href="#tgcGridSizeXY">Grid Size (X,Y)</a> to set the
size of the grid). A line must only have two vertices, if more than two are used (i.e. a polyline) TUFLOW stops with an error.</p>
<p>If a region is used it must have four sides digitised clockwise. The
second vertex is located at or close to the top left corner of the 2D
grid. The distance from the first to second vertices determines the
length of the grid’s Y-axis. The third vertex is not used. The fourth
vertex is located at the bottom right corner of the grid. The distance
from the first to fourth vertices determines the length of the grid’s
X-axis. The grid’s orientation is determined from the line passing from
the first vertex to the fourth vertex.</p>
For more information see Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISMat"><tcmd>Read GIS Mat </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the Material ID (see Section <a href="#Materials-2"><strong>??</strong></a>), using the 2d_mat GIS layer. The Material ID value must correspond to a value within the Materials Definition File <a href="#tcfReadMaterialsFile">Read Materials File</a>.
If <tcmd><a href="#tcfBedResistanceCellSides">Bed Resistance Cell Sides</a></tcmd><teq>==</teq><tblk> INTERROGATE</tblk> (the default), the material values are directly sampled
at the cell mid-sides. This gives a higher resolution definition of the
materials data, thereby giving improved flow patterns where Manning’s n
values vary significantly such as in an urban environment.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISObjects"><tcmd>Read GIS Objects [ RECORD GAUGE DATA [ {} | USE ZC | ZPTS ] ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
<p>References a 2d_obj (Read GIS objects) or 2d_rec (Read GIS receptors) GIS layer
containing points or polygons representing receptors such as properties
or buildings. At present the only option is to use the RECORD GAUGE DATA
feature, with more options to record or value add information to
receptors planned for future releases.</p>
<p>RECORD GAUGE DATA records the flood level and simulation time at one or
more gauge(s) when the receptor is first inundated above a trigger
inundation level (e.g. floor level). Gauges are defined as a point
within a 2d_po GIS layer with type “G_” (see Section<a href="#TwoDTS-3"><strong>??</strong></a>). The levels from all gauges are recorded at each receptor once
inundated.</p>
<p>At present up to 20 different layers may be read in by repeating this
command (let us know if you want to input more than 20 layers!).</p>
<p>The first attribute in the GIS layer is used to set the trigger
inundation elevation (e.g. floor level) to record the gauge level(s)
unless the USE ZC option is specified.</p>
<p>The USE ZC option, sets the trigger inundation level to either the ZC
elevation of the cell (for digitised point objects) or the lowest ZC
elevation within the polygon (for digitised polygon objects). In this
case the first attribute is not used as the trigger inundation level.</p>
<p>The ZPTS option allows TUFLOW to adjust the Zpts within the polygon or
whole cell at a point object, essentially merging the functionality of
the <a href="#tgcReadGISZpt">Read GIS Zpts</a> command with <a href="#tgcReadGISObjects">Read GIS
Objects</a>. In this case, the first attribute is used
to set the value of the Zpts within each polygon. If there is a second
attribute, this is used to define the trigger inundation level,
otherwise the first attribute is used for this level.</p>
<p>Refer to Section <a href="#OneDMap-3"><strong>??</strong></a> for further information.</p>
Alias: <a href="#tgcReadGISReceptors">Read GIS Receptors</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISSoil"><tcmd>Read GIS Soil  [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the soil ID (see Section <a href="#Infiltration-2"><strong>??</strong></a>) based on the input GIS layer (2d_soil). The Soil ID value must correspond to a value within the .tsoilf file. (refer to <a href="#tcfReadSoilFile">Read Soils File</a>). Multiple soil layers are supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The layer(s) that this command applies
to can be optionally defined using
<tcmd>Set Soil Layer &lt;N[,N2,N3…]&gt;</tcmd><teq> ==</teq><tblk>
&lt;value&gt;</tblk>
In the absence of a layer definition the command applies to layer
1.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISSoilBaseElevation"><tcmd>Read GIS Soil Base Elevation  [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the base elevation of the Nth subsurface layer in meters (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>) based on the input GIS layer. Uses 2d_gw GIS layer. Note, multiple soil layers are only supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). If the <a href="#tgcSetSoilThickness">Soil Thickness</a> or <a href="#tgcSetSoilBaseElevation">Base Elevation</a> is not set for a given layer, it is assumed to be infinite. If both methods are specified for a given cell the highest of the two will be adopted. For more information see Section <a href="#infiltration-layer-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISSoilThickness"><tcmd>Read GIS Soil Thickness  [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the thickness in the vertical of the Nth subsurface layer in meters (or feet if using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>) based on the input GIS layer. Uses 2d_gw GIS layer. Note, multiple soil layers are only supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The thickness is set from the layer above. If the <a href="#tgcSetSoilThickness">Soil Thickness</a> or <a href="#tgcSetSoilBaseElevation">Base Elevation</a> is not set for a given layer, it is assumed to be infinite. If both methods are specified for a given cell the highest of the two will be adopted. For more information see Section <a href="#infiltration-layer-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISSRF"><tcmd>Read GIS SRF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the storage reduction factor from the input GIS layer (2d_srf). The storage of 2D cells may be reduced (for example to model hypothetical filling, or reduced storage from buildings), or increased. For example, if a cell has a Storage Reduction Factor (SRF) value of 0.1, then its storage (surface area) is reduced by 10%. If the SRF value is less than zero, the storage is increased. The default SRF value is zero (i.e. no change in storage). For more information see Section <a href="#srf-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISVariableZShape"><tcmd>Read GIS Variable Z Shape [ XF ON | XF OFF | Write TIN ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Used to define the final 3D shape of the Zpts at the completion of a
breach, or other change in topographic shape, during a simulation. See Section <a href="#elevations-3"><strong>??</strong></a>.
Similar to <a href="#tgcReadGISZShape">Read GIS Z Shape</a>, but with additional
attributes to control the trigger mechanism and time period of the
failure. For examples and detailed description of the 2d_vzsh GIS layer
attributes, see Section <a href="#vzsh-4"><strong>??</strong></a>.</p>
The XF ON and XF OFF switch the automatic generation of XF files ON or
OFF specifically for <span class="math inline">\(\langle\)</span> vzsh_file <span class="math inline">\(\rangle\)</span>. The global default for using XF
files is ON and can be changed using <a href="#tcfXFFiles">XF Files</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISWrF"><tcmd>Read GIS WrF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Applies the WrF value to all cell faces based on the input 2d_wrf GIS layer. The global value <a href="#tcfGlobalWeirFactor">Global Weir Factor</a> and the spatially varying value are multiplied together (i.e. one does not replace the other).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISZHXLine"><tcmd>Read GIS Z HX Line [ {} | RIDGE or MAX or RAISE ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Uses HX lines and ZP points from a 2d_bc (or 2d_hx) layer to set the
cell elevations along HX lines. There must be at least one “ZP” (Type)
point snapped to each HX line in the 2d_bc layer (alternatively a
separate points layer can be used - see Section <a href="#point-only-5"><strong>??</strong></a>). The
2d_bc “f” attribute is used to set the elevation and the “d” attribute
is used to adjust the elevation (i.e. if d = 0, the elevation remains
unchanged – useful if you wish to raise the line by, say, 0.2m) - see Table <a href="#tab:tab-ConditionsAttribute">78</a> .</p>
<p>If no “ZP” points are snapped to the HX line then no Zpts are adjusted
along that line and a CHECK is issued stating this.</p>
<p>When adjusting the cell heights, the THICK approach described for <a href="#tgcReadGISZLine">Read
GIS Z Line</a> is used (i.e. the whole cell is modified).</p>
If RIDGE or MAX or RAISE (they all perform the same function!) are
specified this becomes the default setting for the treatment of all HX
lines. Alternatively, the “R” Flag can be used to force the ridge option
for that line. If RIDGE or MAX or RAISE is specified the “R” flag on a
HX line is redundant - see . An “A” flag adjusts all elevations
irrespective of whether RIDGE, MAX or RAISE are used.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISZLine"><tcmd>Read GIS Z Line </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcReadGISZShape">Read GIS Z Shape</a> instead. Expand to find out more.
</summary>
<p>Reads a 2d_z_ GIS layer (e.g. .gpkg, .shp or .mif) containing lines that are
treated as breaklines in the model’s bathymetry. The breakline can vary
in height along its length (i.e. a 3D breakline).</p>
<p>This is a powerful feature for quickly and easily entering a breakline
feature such as a road, railway, levee, creek, drain, etc. It is
particularly useful where TUFLOW’s fixed grid discretisation does not
guarantee that the crest along, for example, a road, is picked up from
the DTM, or the lowest point along a drain. It saves having to
incorporate roads, levees, etc. into the DTM.</p>
<p>The modified Zpts, except for the GULLY option, are output to the
2d_zln_zpt_check layer (see <u>Table 12‑2</u>) if <a href="#tcfWriteCheckFiles">Write Check
Files</a> has been set.</p>
<p>The approach uses the polylines in the layer to set the nearest Zpt
values in the TUFLOW grid to the polyline’s height.</p>
<p>A variable height polyline is created in the GIS by snapping the
polyline to points in the same layer. The first attribute column must be
a number (real or integer) representing the elevation of the points.
Other attributes are ignored. If the polyline is not snapped with a
point at its beginning and end, the polyline is assumed to be horizontal
(the height is taken from the polyline’s attribute). Otherwise, the
polyline’s grade is determined by the height of the points snapped to
the polyline nodes. It is not necessary to snap a point at every
polyline node – the minimum requirement is a point snapped to each
polyline end. Height values for nearby TUFLOW Z-points are interpolated.</p>
<p>The default is to modify a “thin” line following the ZH, ZU and ZV Zpts.
If the THICK option occurs, interpolated Z values are applied to whole
cells (i.e. at the cell centres, all cell sides and cell corners).</p>
<p>If the RIDGE option is specified, the Z values are only modified where
the polyline height is higher than the current Z values. This is useful
where, for example, a weir occurs in a river and it is easier to just
digitise the weir from bank to bank without having to determine where it
should exactly end. The keyword MAX can be substituted for RIDGE.</p>
<p>Conversely, the GULLY option adjusts the ZU, ZV and ZC values where the
polyline is lower than the current Z value. This option is useful for
ensuring low flow paths such as small creeks or drains are modelled
without “dams” across their path. <strong>The GULLY option should not be seen
as a method to accurately define the shape of a waterway.</strong> The keyword
MIN can be substituted for GULLY. <strong>Note: The</strong> THICK <strong>option is not
available with the</strong> GULLY <strong>option.</strong></p>
<p><strong>If <a href="#tcfLineCellSelection">Line Cell Selection</a> is set to Method C
(the default), a more advanced approach for the RIDGE option is used to
interpolate Zpt values.</strong> The approach interpolates from the Zpt to the
nearest intersection of the Z line (i.e. the perpendicular), or if there
is no perpendicular intersection, the nearest vertex on the Z line. The
previous approaches used a more simplistic approach of intersecting the
polyline with a line extending perpendicular to the cell side, and ZC
and ZH values were an average of the modified ZU and ZV values. The new
approach produces “smoother” Zpts, and is not prone to unpredictable
final elevations where multiple Z lines cross through a cell. For RIDGE,
the highest value of the Z lines that intersect with the “cross-hairs”
is chosen, even if there are closer Z lines. If RIDGE (or MAX) is not
specified, the value from the closest eligible Z line is used. ADD works
for both scenarios.</p>
<p>The GULLY option takes the intersection of the polyline with the cell
side to determine elevations.</p>
<p>If neither the RIDGE nor GULLY option is specified, the Z values are
adjusted along the entire polyline length, irrespective of whether the
height of the line is higher or lower than the current Zpt values. The
RIDGE (not the GULLY) methodology is used in determining which Zpts are
selected for modification.</p>
<p>The ADD option adds (use negative values to subtract) the height value
along the polyline to the current Zpt values.</p>
<p>See also <a href="#tgcAllowDanglingZLines">Allow Dangling Z
Lines</a> and <a href="#tgcPauseWhenPolylineDoesNotFindZpt">Pause When
Polyline Does Not Find Zpt</a>
commands). See Section <a href="#elevations-3"><strong>??</strong></a>.</p>
<p>This feature is also incorporated into <a href="#tgcReadGISZShape">Read GIS Z
Shape</a>, <a href="#tgcReadGISVariableZShape">Read GIS Variable Z
Shape</a> and other shape commands. These
commands offer more flexible application of Z lines in that a layer can
contain a mixture of thin and thick lines, a mixture of RIDGE, GULLY and
ADD options, and a width in metres can be applied to lines if more than
one cell width is needed to be raised/lowered/added. See
Section <a href="#zln-4"><strong>??</strong></a> for further information.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISZShape"><tcmd>Read GIS Z Shape [ {} | RIDGE or MAX or RAISE | GULLY or MIN or LOWER ]
[ XF ON | XF OFF | Write TIN]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Command that offers powerful options for modifying Zpt elevations using
points, lines and polygons to define 3D shapes. For examples and
detailed description of the options available see Section <a href="#elevations-3"><strong>??</strong></a>.
The full functionality (and more) of <a href="#tgcReadGISZLine">Read GIS Z Line</a>
is incorporated into this command. Uses 2d_zsh GIS layer.</p>
<p>If RIDGE or MAX or RAISE (they all perform the same function!) are
specified this becomes the default setting for the treatment of lines
unless the Shape_Options attribute for a line overrides this setting.
Similarly if GULLY or MIN or LOWER is specified.</p>
<p>The <a href="https://wiki.tuflow.com/Check_Files_2d_sh_obj">_sh_obj_check</a> layer may be used to view the buffer polygons of
wide Z Lines.</p>
XF ON and XF OFF switch the automatic generation of XF files ON or OFF
specifically for <span class="math inline">\(\langle\)</span> zsh_file <span class="math inline">\(\rangle\)</span>. The global default for using XF files is
ON and can be changed using <a href="#tcfXFFiles">XF Files</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISZShapeRoute"><tcmd>Read GIS Z Shape Route [ {} | RIDGE or MAX or RAISE | GULLY or MIN or LOWER | Write TIN ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
<p>Command that provides output on the degree of inundation along routes,
and helps define evacuation routes, warning times, risks and durations
that routes are cut off. It also performs the same adjustment to Zpts as
per <a href="#tgcReadGISZShape">Read GIS Z Shape</a>.</p>
See section <a href="#EvaculationRoutes-3"><strong>??</strong></a> for a description of this feature. Also see <a href="#tcfSetRouteCutOffValues">Set Route
Cut Off Values</a> and <a href="#tcfSetRouteCutOffType">Set Route Cut Off
Type</a>. Uses 2d_zshr GIS layer.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISZptModifyConveyance"><tcmd>Read GIS Zpts Modify Conveyance </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span>k_factor <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> water_level_grid <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Can be used to modify the elevation for a series of cells based on an increase or decrease in conveyance. Three inputs are required for this operation.</p>
<p>These are:</p>
<ul>
<li>A GIS layer containing a region / polygon object within which the modification will apply;</li>
<li>A conveyance multiplication factor; and</li>
<li>A water level grid.</li>
</ul>
Uses 2d_z_ GIS layer. For more information, see Section <a href="#mod-conveyance-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISZpt"><tcmd>Read GIS Zpts [ {} | ADD | MAX | MIN ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads the Zpt values from a GIS layer (e.g. .gpkg, .shp or .mif). See Section <a href="#elevations-3"><strong>??</strong></a>. Uses the 2d_z_ GIS layer. If other format files are used, the first attribute (column) must be the Zpt value attached to
the GIS objects. Any other attribute columns are ignored.</p>
<p>Any Zpt (ZC, ZU, ZV and ZH) falling within a region object is assigned
the object’s first attribute value. Topography modifications defined
using point or line objects will update the ZC values.</p>
<p>The ADD option adds the first attribute value of the object to the Zpts.
Use a negative value to subtract.</p>
The MAX option will only raise a Zpt from its existing value, while the
MIN option will only lower the Zpt value from its existing value.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGrid"><tcmd>Read Grid <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span> </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The following options are available:</p>
<ul>
<li><a href="#tgcReadGridCnM">Read Grid CnM</a></li>
<li><a href="#tgcReadGridCWF">Read Grid CWF</a></li>
<li><a href="#tgcReadGridCode">Read Grid Code</a></li>
<li><a href="#tgcReadGridFLC">Read Grid FLC</a></li>
<li><a href="#tgcReadGridFLC/L">Read Grid FLC/L</a></li>
<li><a href="#tgcReadGridGWD">Read Grid GWD</a></li>
<li><a href="#tgcReadGridGWL">Read Grid GWL</a></li>
<li><a href="#tgcReadGridIWL">Read Grid IWL</a></li>
<li><a href="#tgcReadGridLocation">Read Grid Location</a></li>
<li><a href="#tgcReadGridMat">Read Grid Mat</a></li>
<li><a href="#tgcReadGridSoil">Read Grid Soil</a></li>
<li><a href="#tgcReadGridSoilThickness">Read Grid Soil Thickness</a></li>
<li><a href="#tgcReadGridSoilBaseElevation">Read Grid Soil Base Elevation</a></li>
<li><a href="#tgcReadGridIGWConc">Read Grid IGW Conc</a></li>
<li><a href="#tgcReadGridIGWDepth">Read Grid IGW Depth</a></li>
<li><a href="#tgcReadGridIGWLevel">Read Grid IGW Level</a></li>
<li><a href="#tgcReadGridSRF">Read Grid SRF</a></li>
<li><a href="#tgcReadGridWrF">Read Grid WrF</a></li>
<li><a href="#tgcReadGridZpts">Read Grid Zpts</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridCWF"><tcmd>Read Grid CWF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the cell flow width (see Section <a href="#CWF-4"><strong>??</strong></a>) based on the input grid. The value entered for CWF is a factor to adjust the 2D cell flow widths (in the same manner as 2D flow constrictions (2d_fc)), noting that the changed flow width applies to all depths. For example 0.1 will limit the flow width to 10%. Uses 2d_cwf GIS layer.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridCnM"><tcmd>Read Grid CnM </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Bed resistance value. CnM is a Chezy C, Manning’s n or Manning’s M value as set by <a href="#tcfBedResistanceValues">Bed Resistance Values</a>. See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridCode"><tcmd>Read Grid Code </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Used to specify the cell code (see Section <a href="#CellCodes-3"><strong>??</strong></a>).</li>
</ul>
<p>The following values can be specified:</p>
<ul>
<li>0: Inactive cells (e.g. land or redundant cells);<br />
</li>
<li>1: Active cells (e.g. water);<br />
</li>
<li>2: Boundary cells (e.g. active cells with an external boundary);</li>
<li>-1: Inactive cells within the active domain.</li>
</ul>
<p>Any values great than 2 will be treated as active cells (cell code of 1). Any values less than -1 will be treated as inactive cells (cell code of 0).</p>
Note, this command is not supported when using the TUFLOW HPC Quadtree functionality (Section <a href="#Quadtree-3"><strong>??</strong></a>). Please use <a href="#tgcReadGISCode">Read GIS Code</a> instead.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridFLC"><tcmd>Read Grid FLC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Applies the form loss attribute values to all cells within each
region. See Section <a href="#flc-4"><strong>??</strong></a>.</p>
Note that FLC values will need to be changed if the 2D cell size
changes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridFLC/L"><tcmd>Read Grid FLC/L </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Applies form losses per unit length to all cells. The effect of applying the FLC in this manner is 2D cell size independent. See Section <a href="#flc-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridGWD"><tcmd>Read Grid GWD </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcReadGridSoilThickness">Read Grid Soil Thickness</a> instead. Expand to find out more.
</summary>
<p>Groundwater depth (see Section <a href="#IGW-3"><strong>??</strong></a>). The <a href="#tgcReadGridGWD">Read Grid GWD</a> command may only be specified following <a href="#tgcSetSoil">Set Soil</a>, <a href="#tgcReadGISSoil">Read GIS Soil</a> and/or <a href="#tgcReadGridSoil">Read Grid Soil</a> commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridGWL"><tcmd>Read Grid GWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcReadGridSoilBaseElevation">Read Grid Soil Base Elevation</a> instead. Expand to find out more.
</summary>
<p>Groundwater level (see Section <a href="#IGW-3"><strong>??</strong></a>). The <a href="#tgcReadGridGWL">Read
Grid GWL</a> command may only be specified following <a href="#tgcSetSoil">Set Soil</a>, <a href="#tgcReadGISSoil">Read GIS Soil</a>
and/or <a href="#tgcReadGridSoil">Read Grid Soil</a> commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridIGWConc"><tcmd>Read Grid IGW Conc Layer N1,N2,..N Tracer M1,M2,..M </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Sets the initial concentration of one or more tracers in one or more groundwater layers of the model based on the input grid. Where N1,N2,..N are the groundwater layer numbers and M1,M2,..M are the tracer numbers. If a layer number is not referenced, it is assumed to apply to layer 1. Likewise, if a tracer number is not referenced it is assumed to apply to the first tracer. For more information, see Section <a href="#GW-initial-conditions"><strong>??</strong></a>.</p>
Note, the order that ‘Layer’ and ‘Tracer’ appear in the command does not matter (i.e. tracer numbers could be listed before layer numbers).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridIGWDepth"><tcmd>Read Grid IGW Depth [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial water depth in the Nth subsurface layer in meters or feet based on the input grid. Assumed to be the depth of water in the soil (water content divided by porosity). If <a href="#tgcReadGridIGWDepth">Read Grid IGW Depth Layer N</a> is used with the <a href="#tgcReadGridIGWLevel">Read Grid IGW Level Layer N</a> the highest initial condition will be adopted.
If using multiple soil layers (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>), the initial conditions do not automatically cascade into layers below (i.e. setting the initial water depth in the top layer will not automatically set the layers below to be 100% saturated).
Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf.
For more information see Section <a href="#IGW-3"><strong>??</strong></a>.</p>
Note, multiple soil layers in the vertical are only supported using TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridIGWLevel"><tcmd>Read Grid IGW Level [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial water level in the Nth subsurface layer in meters or feet based on the input grid. If <a href="#tgcReadGridIGWDepth">Read Grid IGW Depth Layer N</a> is used with the <a href="#tgcReadGridIGWLevel">Read Grid IGW Level Layer N</a> the highest initial condition will be adopted.
If using multiple soil layers (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>), the initial conditions do not automatically cascade into layers below (i.e. setting the initial water level in the top layer will not automatically set the layers below to be 100% saturated).
Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf.</p>
Note, multiple soil layers in the vertical are only supported using TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridIWL"><tcmd>Read Grid IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial water level (see Section <a href="#IWL-3"><strong>??</strong></a>) based on the input grid.</p>
Note: IWLs can also be set in the .tcf file (see <a href="#tcfSetIWL">Set IWL</a>). This is
preferable if the initial water levels vary from simulation to
simulation as it removes the necessity to create a new .tgc file each
time the initial water levels change. Any IWL values set in the .tcf
file override those specified in the .tgc file for the same
cells.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridLocation"><tcmd>Read Grid Location </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the size and location of a 2D domain based on the input grid. The dimensions of the grid is used
to set the 2D domain’s origin and X,Y dimensions (i.e. replaces
<a href="#tgcOrigin">Origin</a> and <a href="#tgcGridSizeXY">Grid Size (X,Y)</a> or <a href="#tgcReadGISLocation">Read GIS
Location</a>. The orientation angle is set to zero
(i.e. the 2D domain will be orientated north-south). Useful where the
model extent is the same as the DEM. Cell Size still needs to be
specified and can be different to the DEM’s cell size.</p>
For more information see Section <a href="#Domain-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridMat"><tcmd>Read Grid Mat </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Material ID (see Section <a href="#Materials-2"><strong>??</strong></a>). The Material ID value must correspond to a value within the Materials Definition File <a href="#tcfReadMaterialsFile">Read Materials File</a>.
If <tcmd><a href="#tcfBedResistanceCellSides">Bed Resistance Cell Sides</a></tcmd><teq>==</teq><tblk> INTERROGATE</tblk> (the default), the material values are directly sampled
at the cell mid-sides. This gives a higher resolution definition of the
materials data, thereby giving improved flow patterns where Manning’s n
values vary significantly such as in an urban environment.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridSoil"><tcmd>Read Grid Soil   [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the soil ID (see Section <a href="#Infiltration-2"><strong>??</strong></a>) based on the input grid. The Soil ID value must correspond to a value within the .tsoilf file. (refer to <a href="#tcfReadSoilFile">Read Soils File</a>). Multiple soil layers are supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The layer(s) that this command applies
to can be optionally defined using
<tcmd>Set Soil Layer &lt;N[,N2,N3…]&gt; </tcmd><teq>==</teq><tblk>
&lt;value&gt;</tblk>.
In the absence of a layer definition the command applies to layer
1.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridSoilBaseElevation"><tcmd>Read Grid Soil Base Elevation   [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the base elevation of the Nth subsurface layer in meters or feet based on the input grid. Note, multiple soil layers are only supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). If the <a href="#tgcSetSoilThickness">Soil Thickness</a> or <a href="#tgcSetSoilBaseElevation">Base Elevation</a> is not set for a given layer, it is assumed to be infinite. If both methods are specified for a given cell the highest of the two will be adopted. For more information see Section <a href="#infiltration-layer-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridSoilThickness"><tcmd>Read Grid Soil Thickness   [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the thickness in the vertical of the Nth subsurface layer in meters or feet based on the input grid layer. Note, multiple soil layers are only supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The thickness is set from the layer above. If the <a href="#tgcSetSoilThickness">Soil Thickness</a> or <a href="#tgcSetSoilBaseElevation">Base Elevation</a> is not set for a given layer, it is assumed to be infinite. If both methods are specified for a given cell the highest of the two will be adopted. For more information see Section <a href="#infiltration-layer-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridSRF"><tcmd>Read Grid SRF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the storage reduction factor from the input raster grid. The storage of 2D cells may be reduced (for example to model hypothetical filling, or reduced storage from buildings), or increased. For example, if a cell has a Storage Reduction Factor (SRF) value of 0.1, then its storage (surface area) is reduced by 10%. If the SRF value is less than zero, the storage is increased. The default SRF value is zero (i.e. no change in storage). For more information see Section <a href="#srf-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridWrF"><tcmd>Read Grid WrF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Applies the WrF value to all cell faces based on the input grid. The global value <a href="#tcfGlobalWeirFactor">Global Weir Factor</a> and the spatially varying value are multiplied together (i.e. one does not replace the other).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGridZpts"><tcmd>Read Grid Zpts [ {} | ADD | MAX | MIN ] [ {XF ON} | XF OFF ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> grid_file <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Directly interrogates an input grid to set the Zpt elevations. See Section <a href="#elevations-3"><strong>??</strong></a>.</p>
<p>The use of this command has significant advantages over the previous
method of manually carrying out a point inspection on an empty 2d_zpt
layer. It will allow for the model to (very likely) become cell size
independent. Changing a 2D domain’s orientation and dimensions is also
much simpler without the need to regenerate and point inspect a 2d_zpt
layer. See Section for more details.</p>
<p>The ADD option adds the value interrogated from the grid to the Zpts.
Use a negative value to subtract.</p>
<p>The MAX option will only raise a Zpt from its existing value, while the
MIN option will only lower the Zpt value from its existing value.</p>
<p>The XF ON and XF OFF options can be used to switch the writing of XF
files (see Section ) on or off for individual inputs.</p>
<p>This command permits a second argument, specifying a GIS layer
containing one or more polygons to clip the area of Zpts to be
inspected. Elevations will only be assigned to Zpts lying inside
polygons within the GIS layer. See Section for more details.</p>
<p>Like other .tgc commands, <a href="#tgcReadGridZpts">Read Grid Zpts</a> may be
specified more than once. You can also specify ADD, MIN or MAX in the
same way as for other similar commands.</p>
See also the .tgc command <a href="#tgcGridApproach">Grid Approach</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadRowCol"><tcmd>Read RowCol <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span>  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more.
</summary>
<p>This is a legacy command. It is suggested to use the corresponding <a href="#tgcReadGIS">Read GIS</a> or <a href="#tgcReadGRID">Read GRID</a> command instead .</p>
<p>Reads the code, material, IWL, CnM, fric, WrF or FLC values from a .mid or similarly formatted (comma delimited) file. The first three columns in the file must be “n, m, <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>”, where n and m are the 2D grid
row, column and <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> is the value of the <span class="math inline">\(\langle\)</span> option <span class="math inline">\(\rangle\)</span> as listed the <a href="https://downloads.tuflow.com/TUFLOW/Releases/Latest/TUFLOW%20Manual.pdf">2018 TUFLOW Manual</a>.</p>
<p>This command is not supported when using the TUFLOW HPC Quadtree functionality.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadRowColWrF"><tcmd>Read RowCol WrF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more.
</summary>
<p>This is a legacy command. It is suggested to use <a href="#tgcReadGISWrF">Read GIS WrF</a> or <a href="#tgcReadGRIDWrF">Read GRID WrF</a> command instead.</p>
<p>Reads the weir factor from a .mid or similarly formatted (comma delimited) file. The first three columns in the file must be “n, m, <wrf>”, where n and m are the 2D grid row, column and <wrf> is the weir factor value.
The global value <a href="#tcfGlobalWeirFactor">Global Weir Factor</a> and the spatially varying value are multiplied together (i.e. one does not replace the other).</p>
<p>This command is not supported when using the TUFLOW HPC Quadtree functionality.</p>
</wrf></wrf>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadRowColGrid"><tcmd>Read RowCol Zpts [ {} | ADD | MAX | MIN ] [ XF ON | XF OFF ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> zpt_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more.
</summary>
<p>This is a legacy command. It is suggested to use the <a href="#tgcReadGISZpts">Read GIS Zpts</a> or <a href="#tgcReadGRIDZpts">Read GRID Zpts</a> command instead.</p>
<p>Reads in Zpt elevation data. The .mid file must be the same format as
that produced by the <a href="#tgcWriteGISZpt">Write GIS Zpts</a> command.</p>
<p>The ADD option adds the Zpt value to the current Zpt value.</p>
<p>The MAX and MIN options only modify the current Zpt value if the value
is higher (MAX option) or lower (MIN option) than the existing value.</p>
<p>The GIS layer can be trimmed to contain either only H values or only U
and V values to minimise the size of the file. In this case use an
<a href="#tgcInterpolate">Interpolate</a> command to interpolate other Z values.</p>
<p>XF ON and XF OFF switch the automatic generation of XF files ON or OFF
specifically for <span class="math inline">\(\langle\)</span> zpt_file <span class="math inline">\(\rangle\)</span>. The global default for using XF files is
ON and can be changed using <a href="#tcfXFFiles">XF Files</a>.</p>
<p>This command is not supported when using the TUFLOW HPC Quadtree functionality.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadTINZpts"><tcmd>Read TIN Zpts [ {} | ADD | MAX | MIN ] [ {XF ON} | XF OFF  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> tin_file <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Use to read a triangulation file (TIN) to assign elevation values to
Zpts. See Section <a href="#elevations-3"><strong>??</strong></a>. The following is a list of accepted TINs. The type of TIN is
determined by the file extension:</p>
<ul>
<li>SMS .tin files<br />
</li>
<li>SMS .2dm files. This may be useful for quickly setting up a TUFLOW
model based on a flexible mesh model that uses a .2dm file.<br />
</li>
<li>12D TINs as a .12da file in ANSI format.<br />
</li>
<li>.xml TINs that are readily exported from 3D surface TIN software such
as Autodesk’s Civil3D. The format should be LandXML saved with line
endings. The format with line endings may be referred to as “Pretty
Print” format.</li>
</ul>
<p>ADD adds the TIN value to the Zpt elevations.</p>
<p>MAX only changes the value of a Zpt if the TIN value is greater than the
current Zpt value.</p>
<p>MIN only changes the value of a Zpt if the TIN value is less than the
current Zpt value.</p>
<p>Also see <a href="#tgcCreateTINZpts">Create TIN Zpts</a> to have TUFLOW create and
write out a TIN.</p>
<p>This command permits a second argument, specifying a GIS layer
containing one or more polygons to clip the area of Zpts to be
inspected. Elevations will only be assigned to Zpts lying inside
polygons within the GIS layer. See Section for more details.</p>
<p>By default, an XF file of the Zpts assigned an elevation from a <a href="#tgcReadTINZpts">Read
TIN Zpts</a> command is created so that loading up the
Zpts is pretty well instantaneous for subsequent runs using that TIN. If
the TIN is updated, TUFLOW will automatically resample the Zpts and
create a new XF file.</p>
The XF file can be switched on or off from the global default settings
using <a href="#tcfXFFiles">XF Files</a> or specifically for this layer using
“<a href="#tgcReadTINZpts">Read TIN Zpts</a> XF OFF == …”.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSet"><tcmd>Set <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span> </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The following global options are available:</p>
<ul>
<li><a href="#tgcSetCnM">Set CnM</a></li>
<li><a href="#tgcSetCode">Set Code</a></li>
<li><a href="#tgcSetCodeandCleanZpt">Set Code and Clean Zpt</a></li>
<li><a href="#tgcSetCWF">Set CWF</a></li>
<li><a href="#tgcSetFLC">Set FLC</a></li>
<li><a href="#tgcSetFLC/L">Set FLC/L</a></li>
<li><a href="#tgcSetFRIC">Set FRIC</a></li>
<li><a href="#tgcSetGWD">Set GWD</a></li>
<li><a href="#tgcSetGWL">Set GWL</a></li>
<li><a href="#tgcSetIGWConc">Set IGW Conc</a></li>
<li><a href="#tgcSetIGWDepth">Set IGW Depth</a></li>
<li><a href="#tgcSetIGWLevel">Set IGW Level</a></li>
<li><a href="#tgcSetIWL">Set IWL</a></li>
<li><a href="#tgcSetMat">Set Mat</a></li>
<li><a href="#tgcSetRouteCutOffType">Set Route Cut Off Type</a></li>
<li><a href="#tgcSetRouteCutOffValues">Set Route Cut Off Values</a></li>
<li><a href="#tgcSetSoil">Set Soil</a></li>
<li><a href="#tgcSetSoilBaseElevation">Set Soil Base Elevation</a></li>
<li><a href="#tgcSetSoilThickness">Set Soil Thickness</a></li>
<li><a href="#tgcSetSRF">Set SRF</a></li>
<li><a href="#tgcSetVariable">Set Variable <span class="math inline">\(\langle\)</span>name<span class="math inline">\(\rangle\)</span></a></li>
<li><a href="#tgcSetWrF">Set WrF</a></li>
<li><a href="#tgcSetZpt">Set Zpt</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetCnM"><tcmd>Set CnM </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Global bed resistance value. CnM is a Chezy C, Manning’s n or Manning’s M value as set by <a href="#tcfBedResistanceValues">Bed Resistance Values</a>. See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetCode"><tcmd>Set Code [ {} | ZERO ABOVE ZC ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> ZC <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Used to globally set the 2D cell code. See Section <a href="#CellCodes-3"><strong>??</strong></a> for more information.</li>
</ul>
<p>The Cell code options are:</p>
<ul>
<li>0: Inactive cells (e.g. land or redundant cells);<br />
</li>
<li>1: Active cells (e.g. water);<br />
</li>
<li>2: Boundary cells (e.g. active cells with an external boundary);</li>
<li>-1: Inactive cells within the active domain.</li>
</ul>
<p>Any values great than 2 will be treated as active cells (cell code of 1). Any values less than -1 will be treated as inactive cells (cell code of 0).</p>
The ZERO ABOVE ZC option for <a href="#tgcSetCode">Set Code</a> applies a Code value of zero
(0) to all cells that have a ZC value greater than the <span class="math inline">\(\langle\)</span>ZC<span class="math inline">\(\rangle\)</span> value
specified for this command. For example, “<tcmd>Set Code Zero Above ZC </tcmd><teq>==</teq><tblk> 50</tblk>.”
applies a Code 0 (inactive) to all 2D cells in the domain that have a ZC
value above 50 (this includes any unassigned ZC values, as the default
value is 99999. Also, if any ZU, ZV or ZH points on that cell have not
yet been assigned an elevation by any previous Zpt commands, they are
set to the ZC value of a cell they are attached to, thereby removing any
99999 elevations around the edge of the model. As this option is
dependent on the Zpt values, the location of this command relative to
the Zpt commands within the .tgc file is important. It should occur
after the Zpts have been assigned elevations. You may also not want to
use the <a href="#tgcSetZpt">Set Zpt</a> command so that the automatic
trimming of ZU, ZV and ZH points occurs. This command is very useful for
setting the active area for direct rainfall models where the DEM has
been trimmed to the catchment boundary.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetCodeandCleanZpt"><tcmd>Set Code and Clean Zpt </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Z_inactive <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Assigns cells as active (Code 1) or inactive (Code 0) (see Section <a href="#CellCodes-3"><strong>??</strong></a>) based on whether
the cell has been assigned an elevation or not. Also extrapolates Z
values to any unassigned Zpt values in cells assigned as active. The
value of <span class="math inline">\(\langle\)</span> Z_inactive <span class="math inline">\(\rangle\)</span> is used to assign an elevation to unassigned
Zpts. This command negates the need to digitise active/inactive code
polygons where:</p>
<ol style="list-style-type: decimal">
<li>The DEM used to assign elevations has been trimmed to the catchment
boundary or model extent (i.e. all null areas of the DEM will be
assigned an inactive code as these Zpts have not been assigned an
elevation); or<br />
</li>
<li>Reading a .2dm file from another model to assign elevations (refer
to the command <a href="#tgcReadTINZpts">Read TIN Zpt</a>).</li>
</ol>
<p>Note: This command must occur after the Zpts have been assigned their
elevations from the DEM or 2dm file. Do not use the <a href="#tgcSetZpt">Set
Zpt</a> command as this assigns every Zpt a value, and
therefore all Zpts have been assigned a value and this command will not
work.</p>
This command is not supported when using the TUFLOW HPC Quadtree (Section <a href="#Quadtree-3"><strong>??</strong></a> or SGS (Section <a href="#SGS-3"><strong>??</strong></a>) functionality.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetCWF"><tcmd>Set CWF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets the cell flow width (see Section <a href="#CWF-4"><strong>??</strong></a>). The value entered for CWF is a factor to adjust the 2D cell flow widths (in the same manner as 2D flow constrictions (2d_fc)), noting that the changed flow width applies to all depths. For example 0.1 will limit the flow width to 10%.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetFLC"><tcmd>Set FLC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Globally applies a form loss to all cells. See Section <a href="#flc-4"><strong>??</strong></a>.</p>
Note, FLC values will need to be changed if the 2D cell size changes.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetFLC/L"><tcmd>Set FLC/L </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally applies a form loss per unit length to all cells. The effect of
applying the FLC in this manner is 2D cell size independent. See Section <a href="#flc-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetFRIC"><tcmd>Set FRIC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
Global ripple height command. See Section <a href="#CLA-mat-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetGWD"><tcmd>Set GWD </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcSetSoilThickness">Set Soil Thickness</a> instead. Expand to find out more.
</summary>
<p>Used to set global groundwater depth (see Section <a href="#infiltration-layer-4"><strong>??</strong></a>). The default is for the GWD/GWL
to be infinitely deep. If a cell has both a GWD and GWL specified, the
higher of the two (elevation wise) prevails. This can be checked by
viewing the Map Output Data Type dGW, which shows the depth to
groundwater (from the ground surface) in metres or feet.
The <a href="#tgcSet">Set GWD</a> command may only be specified
following <a href="#tgcSet">Set Soil</a>, <a href="#tgcReadGIS">Read GIS
Soil</a> and/or <a href="#tgcReadGrid">Read GRID Soil</a>
commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetGWL"><tcmd>Set GWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tgcSetSoilBaseElevation">Set Soil Base Elevation</a> instead. Expand to find out more.
</summary>
<p>Used to set global groundwater level (see Section <a href="#infiltration-layer-4"><strong>??</strong></a>). The default is for the GWD/GWL
to be infinitely deep. If a cell has both a GWD and GWL specified, the
higher of the two (elevation wise) prevails. This can be checked by
viewing the Map Output Data Type dGW, which shows the depth to
groundwater (from the ground surface) in metres or feet.
The <a href="#tgcSetGWL">Set GWL</a> command may only be specified
following <a href="#tgcSetSoil">Set Soil</a>, <a href="#tgcReadGISSoil">Read GIS
Soil</a> and/or <a href="#tgcReadGridSoil">Read GRID Soil</a>
commands.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetIGWConc"><tcmd>Set IGW Conc Layer N1,N2,..N Tracer M1,M2,..M </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> file_path <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Globally sets the initial concentration of one or more tracers in one or more groundwater layers of the model. Where N1,N2,..N are the groundwater layer numbers and M1,M2,..M are the tracer numbers. If a layer number is not referenced, it is assumed to apply to layer 1. Likewise, if a tracer number is not referenced it is assumed to apply to the first tracer. For more information, see Section <a href="#GW-initial-conditions"><strong>??</strong></a>.</p>
Note, the order that ‘Layer’ and ‘Tracer’ appear in the command does not matter (i.e. tracer numbers could be listed before layer numbers).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetIGWDepth"><tcmd>Set IGW Depth [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> file_path <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Globally sets the initial water depth in the Nth subsurface layer in meters or feet. Assumed to be the depth of water in the soil (water content divided by porosity). If <a href="#tgcSetIGWDepth">Set IGW Depth Layer N</a> is used with the <a href="#tgcSetIGWLevel">Set IGW Level Layer N</a> the highest initial condition will be adopted.
If using multiple soil layers (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>), the initial conditions do not automatically cascade into layers below (i.e. setting the initial water depth in the top layer will not automatically set the layers below to be 100% saturated).
Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf.
For more information see Section <a href="#IGW-3"><strong>??</strong></a>.</p>
Note, multiple soil layers in the vertical are only supported using TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetIGWLevel"><tcmd>Set IGW Level [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> file_path <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<p>Globally sets the initial water level in the Nth subsurface layer in meters or feet. If <a href="#tgcSetIGWDepth">Set IGW Depth Layer N</a> is used with the <a href="#tgcSetIGWLevel">Set IGW Level Layer N</a> the highest initial condition will be adopted.
If using multiple soil layers (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>), the initial conditions do not automatically cascade into layers below (i.e. setting the initial water level in the top layer will not automatically set the layers below to be 100% saturated).
Setting the initial conditions in the .tgc for any given grid cell will override the “Initial Moisture” parameter set in the .tsoilf. The difference between the methods is that the .tsoilf sets the initial moisture by soil type, whereas setting the initial conditions in the .tgc allows spatial distribution. If no initial conditions are set in the .tgc for a given grid cell, the initial conditions will be determined by the “Initial Moisture” defined in the .tsoilf.</p>
Note, multiple soil layers in the vertical are only supported using TUFLOW HPC.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetIWL"><tcmd>Set IWL </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Globally sets initial water level (see Section <a href="#IWL-3"><strong>??</strong></a>).</p>
Note: IWLs can also be set in the .tcf file (see <a href="#tcfSetIWL">Set IWL</a>). This is
preferable if the initial water levels vary from simulation to
simulation as it removes the necessity to create a new .tgc file each
time the initial water levels change. Any IWL values set in the .tcf
file override those specified in the .tgc file for the same
cells.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetMat"><tcmd>Set Mat </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets Material ID (see Section <a href="#Materials-2"><strong>??</strong></a>). The Material ID value must correspond to a value within the Materials Definition File <a href="#tcfReadMaterialsFile">Read Materials File</a>.
If <tcmd><a href="#tcfBedResistanceCellSides">Bed Resistance Cell Sides</a></tcmd><teq>==</teq><tblk> INTERROGATE</tblk> (the default), the material values are directly sampled
at the cell mid-sides. This gives a higher resolution definition of the
materials data, thereby giving improved flow patterns where Manning’s n
values vary significantly such as in an urban environment.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetRouteCutOffType"><tcmd>Set Route Cut Off Type </tcmd><teq>==<br></teq></a> <tblk>[ {Depth} |  Velocity or V |  Hazard or VxD or Z0 |  Energy ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
<p>Globally sets the cutoff value type for evacuation routes if the Cut_Off_Type
attribute in the <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a> layer
is blank. Depth, velocity and hazard options are available. The cutoff
values are set using <a href="#tcfSetRouteCutOffValues">Set Route Cut Off
Values</a> in the .tcf and/or .tgc file, and
evacuation routes are described in Section <a href="#EvaculationRoutes-3"><strong>??</strong></a> and set using
the .tgc file command <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape Route</a>.</p>
This command may be used in either the .tcf and/or .tgc file. If used in
the .tcf it is the global default setting when the .tgc file is
processed. If used in the .tgc file its location in the file is
important in that it only applies to subsequent evacuation route
commands. It may be used any number of times in the .tgc file so as to
change the evacuation route settings at different points within the .tgc
file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetRouteCutOffValues"><tcmd>Set Route Cut Off Values </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> y1, y2, … <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
<p>Globally sets the cutoff values for the evacuation route feature (see Section <a href="#EvaculationRoutes-3"><strong>??</strong></a>) if the Cut_Off_Values attribute in the <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape
Route</a> layer is blank. The type of cutoff values
is set using <a href="#tcfSetRouteCutOffType">Set Route Cut Off Type</a> and
evacuation routes are set using the .tgc file command <a href="#tgcReadGISZShapeRoute">Read GIS Z Shape
Route</a>.</p>
This command may be used in either the .tcf and/or .tgc file. If used in
the .tcf it is the global default setting when the .tgc file is
processed. If used in the .tgc file its location in the file is
important in that it only applies to subsequent evacuation route
commands. It may be used any number of times in the .tgc file so as to
change the evacuation route settings at different points within the .tgc
file.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetSoil"><tcmd>Set Soil   [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets Soil ID (see Section <a href="#Infiltration-2"><strong>??</strong></a>). The Soil ID value must correspond to a value within the .tsoilf file (refer to <a href="#tcfReadSoilFile">Read Soils File</a>). Multiple soil layers are supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The layer(s) that this command applies
to can be optionally defined using
<tcmd>Set Soil Layer &lt;N[,N2,N3…]&gt;</tcmd><teq> ==</teq><tblk> &lt;value&gt;</tblk>.
In the absence of a layer definition the command applies to layer
1.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetSoilBaseElevation"><tcmd>Set Soil Base Elevation   [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> file_path <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets the base elevation of the Nth subsurface layer in meters or feet. Note, multiple soil layers are only supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). If the <a href="#tgcSetSoilThickness">Soil Thickness</a> or <a href="#tgcSetSoilBaseElevation">Base Elevation</a> is not set for a given layer, it is assumed to be infinite. If both methods are specified for a given cell the highest of the two will be adopted. For more information see Section <a href="#infiltration-layer-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetSoilThickness"><tcmd>Set Soil Thickness  [{} | <span class="math inline">\(\langle\)</span> Layer N <span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> | <span class="math inline">\(\langle\)</span> file_path <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets the thickness in the vertical of the Nth subsurface layer in meters or feet. Note, multiple soil layers are only supported when using TUFLOW HPC (see Section <a href="#HPC-Groundwater-3"><strong>??</strong></a>). The thickness is set from the layer above. If the <a href="#tgcSetSoilThickness">Soil Thickness</a> or <a href="#tgcSetSoilBaseElevation">Base Elevation</a> is not set for a given layer, it is assumed to be infinite. If both methods are specified for a given cell the highest of the two will be adopted. For more information see Section <a href="#infiltration-layer-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetSRF"><tcmd>Set SRF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets the storage reduction factor. The storage of 2D cells may be reduced (for example to model hypothetical filling, or reduced storage from buildings), or increased. For example, if a cell has a Storage Reduction Factor (SRF) value of 0.1, then its storage (surface area) is reduced by 10%. If the SRF value is less than zero, the storage is increased. The default SRF value is zero (i.e. no change in storage). For more information see Section <a href="#srf-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetVariable"><tcmd>Set Variable <span class="math inline">\(\langle\)</span>name<span class="math inline">\(\rangle\)</span> </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span>value<span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Define user variables for use within the control files, see <a href="#tcfSetVariable">Set Variable</a> and Section <a href="#Variables-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetWrF"><tcmd>Set WrF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> WrF value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally applies the same WrF value to all cell faces. The global value <a href="#tcfGlobalWeirFactor">Global Weir Factor</a> and the spatially varying value are multiplied together (i.e. one does not replace the other).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSetZpt"><tcmd>Set Zpt </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> elevation_in_metres <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Globally sets <u>all</u> ZC, ZU, ZV and ZH Zpts to the value specified. This is typically used to set a global elevation for active cells before reading in a DEM (using <a href="#tgcReadGridZpts">Read Grid Zpts</a>). Reviewing the <a href="https://wiki.tuflow.com/Check_Files_2d_DEM_Z">_DEM_Z</a> check file and searching for the global value used is an easy way to identify if there are any gaps in the DEM dataset that were not expected (these should be fixed).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSGSSampleDistance"><tcmd>SGS [ Grid | TIN ] Sample Distance  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> distance in metres / feet <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Use <a href="#tcfSGSSampleFrequency">SGS Sample Frequency</a> or <a href="#tcfSGSSampleTargetDistance">SGS Sample Target Distance</a> instead. Expand to find out more about the legacy settings.
</summary>
<p>Available when using SGS (Method B) only (Section <a href="#SGS-3"><strong>??</strong></a>).</p>
<p>Sets the sample distance to be used for both input grid and TIN files.</p>
<ul>
<li>If set to Grid the sample distance only applies to grids.</li>
<li>If set to TIN the sample distance only apples to TINs.</li>
</ul>
<p>For grid inputs, if no sample distance has been set the resolution of the DEM is used by default. For TIN datasets, the sample distance must be set. The sample ‘frequency’ set by this command is capped at 31 by default to avoid to avoid long pre-processing time. In general, a sample frequency smaller than 31 is sufficient for most of natural water ways or artificial structures, and users may not benefit from applying a super fine sample distance against the model cell size. This upper limit can be increased by using a second argument in the “SGS Sample Distance” command, e.g. “<tcmd><a href="#tgcSGSSampleDistance">SGS Sample Distance</a> </tcmd><teq>==</teq><tblk> 1 | 51</tblk>” sets the sampling distance to 1 m and the frequency limit to 51 sample points per face (2601 per cell). However, a hard limit of 127 per face (16,129 per cell) still applies.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSGSGridMaxNullFrac"><tcmd>SGS Grid Max Null Frac  </tcmd><teq>==<br></teq></a> <tblk>[ Maximum Null Fraction  |  <span class="math inline">\(\langle\)</span> 0.5 <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more about the legacy settings.
</summary>
<p>Available when using SGS (Method B) only (see <tcmd><a href="#tcfSGSApproach">SGS Approach</a></tcmd><teq> == </teq><tblk>Method B</tblk>). This command controls the behaviour if the input grid only has partial coverage and the existing elevation in the cell has not been initialised either with a <a href="#tgcSetZpts">Set Zpts</a> command or with an elevation in a previous dataset. If the fraction of the cell that has no value (null) in the input grid is above this value then the zpt is not updated.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSGSPartialGridUpdateNullFrac"><tcmd>SGS Partial Grid Update Null Frac  </tcmd><teq>==<br></teq></a> <tblk>[ Lower Limit, Upper limit  |  <span class="math inline">\(\langle\)</span> 0.1, 0.9 <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more about the legacy settings.
</summary>
<p>Available when using SGS (Method B) only (see <tcmd><a href="#tcfSGSApproach">SGS Approach</a></tcmd><teq> == </teq><tblk>Method B</tblk>). This command controls the behaviour if the input grid only has partial coverage and the cell has been initialised either with a <a href="#tgcSetZpts">Set Zpts</a> command or with an elevation in a previous dataset. This sets lower and upper limits for the fraction of the SGS values that can be null in the grid. This applies to both cells and cell faces. The default values for the lower limit is 0.1 and for the upper limit 0.9.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcSpatialDatabase"><tcmd>Spatial Database </tcmd><teq>==<br></teq></a> <tblk>[ OFF | TCF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Optional when using the GeoPackage input format. Sets the database to use for subsequent inputs. For more information see Section <a href="#GPKG-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcStop"><tcmd>Stop </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more.
</summary>
Stops TUFLOW (useful while just developing the model grid and Zpts).
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcTINAngles"><tcmd>Thin Line as Thick </tcmd><teq>==<br></teq></a> <tblk>[ ON |  {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more.
</summary>
If set to ON, treats all thin Z lines as thick. The default is OFF.
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcTINAngles"><tcmd>TIN Angles </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> point_angle <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> edge_angle <span class="math inline">\(\rangle\)</span> |  {55, 30} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Provides the user with the ability to vary the formation of triangles in
TINs created from <a href="#tgcReadGISZShape">Read GIS Z Shape</a> polygons. See Section <a href="#ztin-4"><strong>??</strong></a>.</p>
<p><span class="math inline">\(\langle\)</span> point_angle <span class="math inline">\(\rangle\)</span> controls the minimum angle from an internal point to two
vertices on the triangulation perimeter to be used. The smaller the
angle the greater the priority given to triangulating to an internal
point.</p>
<p><span class="math inline">\(\langle\)</span> edge_angle <span class="math inline">\(\rangle\)</span> controls the formation of triangles from vertices along
internal boundary of the TIN as it is created. The greater the angle the
greater the priority given to triangulating using boundary vertices
only.</p>
The command maybe repeated within the .tgc file to change the angles for
different commands.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcTINCoincidentPointDistance"><tcmd>TIN Coincident Point Distance </tcmd><teq>==<br></teq></a> <tblk>[  <span class="math inline">\(\langle\)</span> dist_in_m <span class="math inline">\(\rangle\)</span> |  {0.001}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Changes the distance used for removing coincident points prior to
creating a TIN. Can be used several times within the .tgc file to apply
different distances for different layers/commands. Applies to any
polygon shape or command that generates a TIN. See Section <a href="#ztin-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcWriteGISDomain"><tcmd>Write GIS Domain </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Creates _dom GIS (e.g. .shp) file containing a rectangular region representing the extent of the 2D domain. Useful for cross-checking the 2D domain’s extent in the GIS rather than generating a large <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> file using <a href="#tgcWriteGISGrid">Write GIS Grid</a>.</p>
A <a href="https://wiki.tuflow.com/Check_Files_2d_dom">_dom_check</a> layer is also created using <a href="#tcfWriteCheckFiles">Write Check Files</a>, however, it will contain a rectangular region for all 2D domains.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcWriteGISGrid"><tcmd>Write GIS Grid </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Creates a GIS file (e.g. .shp) representing the 2D domain’s grid based on the dimensions, origin and orientation. The grid is a mesh of square polygons.</p>
<p>All information relating to grid cells as defined by any previous commands up until that point within the .tgc file is included. The output layer has the same attributes as a <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> layer.</p>
<p>Tip: Use this command to check that the grid’s data (code, material, etc.) is setup correctly by writing to temporary GIS file (e.g. .shp), and importing and viewing in the GIS at different stages in the .tgc file (this command can be used any number of times within a .tgc
file – remember to specify a different filename each time though!).</p>
A <a href="https://wiki.tuflow.com/Check_Files_2d_grd">_grd_check</a> layer is also created using <a href="#tcfWriteCheckFiles">Write Check Files</a>, however, it will contain the active cells of all 2D domains.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcWriteGISZpt"><tcmd>Write GIS Zpts </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Writes a GIS file (e.g. .shp) containing the points where Zpts (model elevation) values are defined.</p>
Tip: Use this command to check that the model’s elevation data is correct. After building the topography use this command to write a temporary GIS file (e.g. .shp). Import into the GIS and check the elevations are as expected.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcZC"><tcmd>ZC </tcmd><teq>==<br></teq></a> <tblk>[ MIN(ZU,ZV) ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the ZC Zpt equal to the minimum of the two ZU and two ZV Zpts
either side and above and below it.</p>
This essentially allows a grid cell to wet and dry according to when
water first enters and last leaves the cell. It may provide enhanced
stability in models with severe wetting and drying.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcZeroZPoint"><tcmd>Zero Z Point </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR} |  WARNING ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ERROR, causes an <a href="https://wiki.tuflow.com/TUFLOW_Message_2049">ERROR 2049</a> message if a snapped point to a Z Line, or inside or on the perimeter of a Shape region has a zero value.<br />
If set to WARNING, a warning message is issued and the simulation does not stop.<br />
If the ADD option is used, no ERRORs or WARNINGs are issued except in the case of points snapped to TIN lines.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tgcReadGISReceptors"><tcmd>Read GIS Receptors [ RECORD GAUGE DATA [ {} | USE ZC | ZPTS ] ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic
</td>
<td style="text-align:left;">
See <a href="#tgcReadGISObjects">Read GIS Objects</a> for command description.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TBCCommands-1"><span class="header-section-number">22</span> TBC Commands<a href="#TBCCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW Boundary Control File (.tbc) includes commands and data inputs to set boundaries and initial conditions, it is read into the .tcf using the <a href="#tcfBoundaryControlFile">Boundary Control File</a> command. For more information on the .tbc see Section <a href="#TBC-3"><strong>??</strong></a>. Boundaries and initial conditions are discussed in Chapter <a href="#Boundaries-InitialConditions-1"><strong>??</strong></a>. The available TBC commands are listed below and are detailed in Table <a href="#tab:tab-TBCCommands">136</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tbcBCDatabase">BC Database</a><br />
<a href="#tbcBCEventName">BC Event Name</a><br />
<a href="#tbcBCEventText">BC Event Text</a><br />
<a href="#tbcBlankBCType">Blank BC Type</a><br />
<a href="#tbcBlankHQSlope">Blank HQ Slope</a><br />
<a href="#tbcBlankBCType">Global Rainfall Area Factor</a><br />
<a href="#tbcGlobalRainfallBC">Global Rainfall BC</a><br />
<a href="#tbcGlobalRainfallContinuingLoss">Global Rainfall Continuing Loss</a><br />
<a href="#tbcGlobalRainfallInitialLoss">Global Rainfall Initial Loss</a><br />
<a href="#tbcIfScenario">If Scenario</a><br />
<a href="#tbcReadGISBC">Read GIS BC</a><br />
<a href="#tbcReadGISRF">Read GIS RF</a><br />
<a href="#tbcReadGISSA">Read GIS SA</a><br />
<a href="#tbcReadGISStreams">Read GIS Streams</a><br />
<a href="#tbcReadRowColRF">Read RowCol RF</a><br />
<a href="#tbcSetVariable">Set Variable</a><br />
<a href="#tbcSpatialDatabase">Spatial Database</a><br />
<a href="#tbcUnusedHXandSXConnections">Unused HX and SX Connections</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TBCCommands">Table 136: </span><strong>TUFLOW Classic/HPC TBC Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcBCDatabase"><tcmd>BC Database </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> .csv_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active BC Database file as described in Section <a href="#bcdbase-2"><strong>??</strong></a>. The
file is usually created using spreadsheet software such as Microsoft
Excel.</p>
<p>If the BC Database is specified in the TUFLOW .tcf file, it is set as
the active database for both 2D and 1D models. However, the active
database can be changed at any stage in the .tbc and .ecf files by
repeating the command with the new database set as the <span class="math inline">\(\langle\)</span> .csv_file <span class="math inline">\(\rangle\)</span>.</p>
<strong>A BC Database must be specified before any of the other BC commands
are used.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcBCEventName"><tcmd>BC Event Name </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> bc_event_name <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the active BC name to be substituted where <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> (see
<a href="#tbcBCEventText">BC Event Text</a>) occurs in the BC Database. See Section
<a href="#BCEventName-3"><strong>??</strong></a> for a description of how the BC event commands operate.</p>
<p>This command is normally specified in the .tcf file, and only used in
the .tbc file if the event boundaries vary by event within the model.
For example, it may be set to “Q100” to read in the 100 year catchment
inflows, then set as “H010” to read in the 10 year ocean levels for the
downstream boundary. Note that, in this case, the locations of the
catchment inflows and downstream boundaries would have to be placed in
two separate GIS layers, with each layer read using <a href="#tbcReadGISBC">Read GIS
BC</a> after the relevant <a href="#tbcBCEventName">BC Event Name</a>
command as shown below:</p>
<p><tcmd>BC Event Name</tcmd><teq> == </teq><tblk>H010</tblk><br />
<tcmd>Read GIS BC</tcmd><teq> == </teq><tblk>gis\2d_bc_head_boundaries.shp</tblk><br />
<tcmd>BC Event Name</tcmd><teq> == </teq><tblk>Q100</tblk><br />
<tcmd>Read GIS BC</tcmd><teq> == </teq><tblk>gis\2d_bc_flow_boundaries.shp</tblk></p>
<strong>This command has been superseded by the .tcf <a href="#tcfBCEventSource">BC Event Source</a> command. It combines the functionality of <a href="#tbcBCEventName">BC Event Name</a> and <a href="#tbcBCEventText">BC Event Text</a> into a single command.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcBCEventText"><tcmd>BC Event Text </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the text in the BC Database that is to be substituted by the <a href="#tcfBCEventName">BC
Event Name</a> command value. See Section <a href="#BCEventName-3"><strong>??</strong></a> for
a description of how the BC event commands operate.</p>
<p>This command is normally specified in the .tcf file, and only used in
the .tbc file if for some reason the <span class="math inline">\(\langle\)</span> bc_event_text <span class="math inline">\(\rangle\)</span> value needs to
change (this should be very unlikely unless wanting to split the
different boundaries into groups). Also see <a href="#tcfBCEventText">BC Event
Text</a> for the .tcf file.</p>
<strong>This command has been superseded by the .tcf <a href="#tcfBCEventSource">BC Event Source</a> command. It combines the functionality of <a href="#tbcBCEventName">BC Event Name</a> and <a href="#tbcBCEventText">BC Event Text</a> into a single command.</strong>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcBlankBCType"><tcmd>Blank BC Type </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> bc_type <span class="math inline">\(\rangle\)</span> | {NONE} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>If a blank BC type occurs the value entered is used. If NONE (the
default) is specified, a BC type must be assigned to every object in
2d_bc layers.</p>
<p>This command can be repeated within the .tbc file as per the example
lines below.</p>
<tcmd>BLANK BC TYPE </tcmd><teq>==</teq><tblk> SX</tblk><br />
<tcmd>Read GIS BC </tcmd><teq>==</teq><tblk> gis\2d_bc_M02_culverts_TD15006.shp</tblk><br />
<tcmd>BLANK BC TYPE </tcmd><teq>==</teq><tblk> NONE</tblk><tgrn>  !will revert back to an error</tgrn>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcBlankHQSlope"><tcmd>Blank HQ Slope </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> slope <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
A default HQ slope can be specified directly in the .tbc, and can be
repeated prior to reading different HQ boundaries (in separate layers).
Note, <span class="math inline">\(\langle\)</span> slope <span class="math inline">\(\rangle\)</span> will only be used if no boundary name is specified for
the 2d_bc HQ boundary (as a specified for the HQ boundary slope is given
preference over the name).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcBlankBCType"><tcmd>Global Rainfall Area Factor </tcmd><teq>==<br></teq></a> <tblk>[ {1.0} | <span class="math inline">\(\langle\)</span> area_factor <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the factor applied to the global rainfall after the initial loss
and continuing losses have been applied. This is useful if you wish to
increase the rainfall within the area covered by the active (Code 1)
cells to compensate for areas that contribute to the runoff that out not included in the active model area
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcGlobalRainfallBC"><tcmd>Global Rainfall BC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> BC_name <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the BC name in the BC database that defines the global rainfall.
Using metric units (default), the rainfall is specified as mm versus time in hours. This is converted
to m<sup>3</sup>/s and applied as a source versus time (ST). Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the units are inches verses time. TUFLOW converts it to ft<sup>3</sup>/s</p>
<p>This command applies rainfall to all active cells. Therefore, if the
rainfall being applied is the same for all cells, this command negates
the need to use a 2d_rf layer.</p>
<p>If used in conjunction with the commands <a href="#tbcGlobalRainfallInitialLoss">Global Rainfall Initial
Loss</a> and <a href="#tbcGlobalRainfallContinuingLoss">Global Rainfall Continuing
Loss</a> to apply initial and continuing
losses, The <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a> command must
occur after the two preceding commands as shown in the example below
else no losses will be applied:</p>
<p><tcmd>Global Rainfall Initial Loss </tcmd><teq>==</teq><tblk> 10</tblk><br />
<tcmd>Global Rainfall Continuing Loss </tcmd><teq>==</teq><tblk> 2 </tblk><br />
<tcmd>Global Rainfall BC </tcmd><teq>==</teq><tblk> rainfall</tblk></p>
<p>Note rainfall losses in the materials files are not applied to global
rainfall boundaries.</p>
See also the command <a href="#tbcBlankBCType">Global Rainfall Area Factor</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcGlobalRainfallContinuingLoss"><tcmd>Global Rainfall Continuing Loss </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> CL <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the continuing loss rate for any global rainfall (note does
not apply to rainfall via <a href="#tbcReadGISRF">Read GIS RF</a> or <a href="#tcfRainfallControlFile">Rainfall
Control File</a>). Using metric units (default) the rate is mm/h. Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the rate is inch/h.</p>
This command must occur prior
to the command <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a> else no losses
will be applied.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcGlobalRainfallInitialLoss"><tcmd>Global Rainfall Initial Loss </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> IL <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the initial loss rate for any global rainfall (note does
not apply to rainfall via <a href="#tbcReadGISRF">Read GIS RF</a> or <a href="#tcfRainfallControlFile">Rainfall
Control File</a>). Using metric units (default) the value is in mm. Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the value is in inches.</p>
This command must occur prior
to the command <a href="#tbcGlobalRainfallBC">Global Rainfall BC</a> else no losses
will be applied.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcIfScenario"><tcmd>If Scenario </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls which commands to process for different scenarios as specified
using the –s run option (see Section <a href="#Scenarios-3"><strong>??</strong></a> and Table <a href="#tab:tab-TUFLOWOptions">116</a>)
or <a href="#tcfModelScenarios">Model Scenarios</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcReadGISBC"><tcmd>Read GIS BC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads the location and attributes of 2D model boundary conditions as
described in Section <a href="#BC-Layers-3"><strong>??</strong></a>. Uses 2d_bc GIS layers, as described in Table <a href="#tab:tab-ConditionsAttribute">78</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcReadGISRF"><tcmd>Read GIS RF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads the polygons for applying rainfall directly to 2D cells, as
described by RF in Table <a href="#tab:tab-twoDBoundary">77</a>. Uses 2d_rf GIS layers, as described in Table <a href="#tab:tab-DirectRainfall">84</a>.</p>
<p>Also refer to the .tbc command <a href="#tbcReadRowColRF">Read RowCol RF</a> and
the .tcf command <a href="#tcfReadGridRF">Read Grid RF</a>.</p>
Negative rainfall values when using <a href="#tbcReadGISRF">Read GIS RF</a> are treated as a loss (e.g. evaporation). No IL/CL values that apply to positive rainfall are applied to negative values. Previously negative values were treated as
zero.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcReadGISSA"><tcmd>Read GIS SA [ {} | <span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span> ] </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Available <tcmd><span class="math inline">\(\langle\)</span>option<span class="math inline">\(\rangle\)</span></tcmd> are: “ALL”, “PITS”, “STREAM ONLY”, “STREAM IGNORE”, “RF”, “PO” and “TRIGGER”.</p>
<p>Reads the polygons for distributing source flows over the 2D domain(s) as described in Section <a href="#SA-Layers-3"><strong>??</strong></a>. Usually used for specifying rainfall runoff (flow) directly onto the 2D domain(s).</p>
<p>The “ALL” option is available to apply the flow or rainfall to all Code 1 cells (wet or dry active cells) within the polygon. Not applied to any inactive or water level boundary condition or HX 1D/2D linkage cells. If
using the “ALL” option the double precision version may be needed as this is a similar approach to direct rainfall modelling.</p>
<p>The “PITS” option directs the inflow only to 2D cells that are connected to a 1D pit or node connected to the 2D domain using “SX” for the Conn_1D_2D (previously Topo_ID) 1d_nwk attribute. The inflow is spread
equally over the applicable 2D cells. An ERROR occurs if no 2D cells are found within the region.</p>
<p>Two options are available for controlling streamlines (refer to <a href="#tbcReadGISStreams">Read GIS Streams</a>), as described in Section <a href="#Streamlines-4"><strong>??</strong></a>:</p>
<ul>
<li>The “STREAM ONLY” option will only apply the SA inflows to the
streamline cells (i.e. no non-streamline wet cells in the SA region
will receive an inflow). Note, this is the default approach adopted by
the original, and no longer supported, TUFLOW GPU (not HPC) solver.<br />
</li>
<li>The “STREAM IGNORE” option will ignore all streamline cells within the
SA region(s) and distribute the inflows using the standard approach
for SA inflows (i.e. lowest cell if all wet, otherwise distributed
over the wet cells).</li>
</ul>
<p>The “RF” (rainfall) option is available to specify rainfall hyetographs (mm versus hours: metric units / inches versus hours: US customary units) instead of flow hydrographs. See Section <a href="#RFOption-4"><strong>??</strong></a> for more information. Negative rainfall values when using <a href="#tbcReadGISSA">Read GIS SA RF</a> are treated as a loss (e.g. evaporation). No IL/CL values that apply to positive rainfall are applied to negative values. Previously negative values were treated as
zero.</p>
<p>The “TRIGGER” option allows the initiation of inflow hydrographs based on a flow or water level trigger so that, for example, reservoir failures can be initiated based on when the flood wave reaches the reservoir rather than at a fixed time. See Section <a href="#TriggerOption-4"><strong>??</strong></a> for more details.</p>
The “PO” option models seepage or infiltration based on a varying water level or flow rate elsewhere in the model. This feature is used to model the seepage of groundwater into a coastal lagoon that was dependent on the water level in the lagoon as observed from long-term historical measurements. See Section <a href="#FlowFeature-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcReadGISStreams"><tcmd>Read GIS Streams </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Streamlines, as described in Section <a href="#Streamlines-4"><strong>??</strong></a>, allow the user to apply SA inflows along the waterways
rather than to the lowest cell (when all cells are dry within the SA
region).</p>
<p>The <a href="#tbcReadGISStreams">Read GIS Streams</a> command can be used one or
more times in the .tbc file to define streamline cells. Streamlines are
typically line objects, usually representing the path of the
waterways. One attribute is required, being the Stream Order as an
integer. GIS and other software have the ability to generate streamlines
from DEMs, and usually assign a stream order to each stream line. If
needed, rearrange (or copy) the attributes so that the first attribute
is the stream order one.</p>
<p>Point and region objects are also recognised, for a point object the
cell in which the point falls is designated as a stream cell. For a
region object, all cells with the cell centre (ZC) within the polygon
are assigned as stream cells. The stream cells within SA regions are
output in the <a href="http://wiki.tuflow.com/Check_Files_2d_sac">SAC Check
file</a>.</p>
<p><strong>Note only streams with a stream order greater than zero (0) are used
by TUFLOW. Therefore, streams that are not to be used for applying SA
inflows can be assigned a stream order of 0 or deleted from the layer.</strong></p>
<p>If <tcmd><a href="#tcfSAPropDepth">SA Proportion to Depth</a></tcmd><teq> == </teq><tblk>ON</tblk> (default setting),
the distribution of SA inflows according to depth only applies to wet
non-streamline cells. The approach adopted is as follows:</p>
<ul>
<li>The total inflow assigned to streamline cells within a SA region is
proportioned according to the number of streamline cells versus wet
non-streamline cells.<br />
</li>
<li>The distribution of the inflow allocated to streamline cells is
weighted equally between cells.<br />
</li>
<li>The distribution of the inflow allocated to wet non-streamline cells
is weighted according to the depth of water in the cells.</li>
</ul>
By default, any wet cells that are not streamline cells are also
included in the distribution of the SA inflow. See <a href="#tbcReadGISSA">Read GIS SA STREAM
ONLY</a> and <a href="#tbcReadGISSA">Read GIS SA STREAM IGNORE</a>
options for controlling streamline inflows.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcReadRowColRF"><tcmd>Read RowCol RF </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> mid_file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<details>
<summary>
Legacy Command. Expand to find out more about the legacy settings.
</summary>
<p>Reads the rainfall cell by cell using just the .mid file (in a similar manner to other <a href="#tgcReadRowCol">Read RowCol</a> commands). The first two attributes of the .mid file must be the row and column of the 2D cell
and the next three attributes must be as described in <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf#page=329">Table 7‑7 of the 2018 TUFLOW Manual</a>.
To create this layer, select all ZC points from a 2d_zpt layer, save the
selection as another layer, restructure the attributes so that row (n)
and column (m) remain as the first two, remove the other attributes, and
add the attributes as described in <a href="https://downloads.tuflow.com/_archive/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03.pdf#page=329">Table 7‑7 of the 2018 TUFLOW Manual</a>. Update the Name
attribute to one or more rainfall boundaries. Different proportions of
different rainfall hyetographs can be applied by duplicating the layer
and having one layer for each rainfall boundary.</p>
<p>Also refer to the .tbc command <a href="#tbcReadGISRF">Read GIS RF</a> and the .tcf
command <a href="#tcfReadGridRF">Read Grid RF</a>.</p>
</details>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcSetVariable"><tcmd>Set Variable </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
See Section <a href="#Variables-3"><strong>??</strong></a>. If <a href="#tcfSetVariable">Set Variable</a> is used in the .tcf, if you wish to refer to the variable in the .tbc, the variable’s
name must be bounded by “<span class="math inline">\(\langle\)</span><span class="math inline">\(\langle\)</span>” and “<span class="math inline">\(\rangle\)</span><span class="math inline">\(\rangle\)</span>” characters.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcUnusedHXandSXConnections"><tcmd>Unused HX and SX Connections </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR} | WARNING ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
See <a href="#tcfUnusedHXandSXConnections">Unused HX and SX Connections</a> under
.tcf file commands. The command can be used several times in a .tbc file
to change from ERROR to WARNING and vice versa if a different level of
checking is required for different 2d_bc layers. When reading and
checking a 2d_bc layer, the latest occurrence of this command applies.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tbcSpatialDatabase"><tcmd>Spatial Database </tcmd><teq>==<br></teq></a> <tblk>[ OFF  | TCF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This is an optional command when using the GeoPackage input format. It sets the GeoPackage database to use for subsequent GIS inputs.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TOCCommands-1"><span class="header-section-number">23</span> TOC Commands<a href="#TOCCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW Operations Control (.toc) contains operating rules for structures, it is read into the .tcf using the <a href="#tcfReadOperatingControlFile">Read Operating Control File</a> command. For more information on the .toc see Section <a href="#TOC-3"><strong>??</strong></a>. Using operated structures is discussed in Section <a href="#OperationalChannels-2"><strong>??</strong></a>. The available TOC commands are listed below and are detailed in Table <a href="#tab:tab-TOCCommands">137</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tocBreachOpening">Breach Opening</a><br />
<a href="#tocCdIntactFailed">Cd Failed</a><br />
<a href="#tocCdGateSubmerged">Cd Gate Submerged</a><br />
<a href="#tocCdGate">Cd Gate</a><br />
<a href="#tocCdIntactFailed">Cd Intact</a><br />
<a href="#tocCdSpillway">Cd Spillway</a><br />
<a href="#tocCd">Cd</a><br />
<a href="#tocCfIntactFailed">Cf Failed</a><br />
<a href="#tocCfIntactFailed">Cf Intact</a><br />
<a href="#tocCf">Cf</a><br />
<a href="#tocDefineControl">Define</a><br />
<a href="#tocDepthBreached">Depth Breached</a><br />
<a href="#tocDepthCollapse">Depth Collapse</a><br />
<a href="#tocDepthFullyBreached">Depth Fully Breached</a><br />
<a href="#tocDischargeCurveType">Discharge Curve Type</a><br />
<a href="#tocEndfDefine">End Define</a><br />
<a href="#tocExIntactFailed">Ex Failed</a><br />
<a href="#tocExIntactFailed">Ex Intact</a><br />
<a href="#tocGateHeightFullyOpen">Gate Height Fully Open</a><br />
<a href="#tocGateOpening">Gate Opening</a><br />
<a href="#tocGateSeatVerticalOffset">Gate Seat Vertical Offset</a><br />
<a href="#tocGateSpeed">Gate Speed</a><br />
<a href="#tocGateType">Gate Type</a><br />
<a href="#tocGateWidthFullyOpen">Gate Width Fully Open</a><br />
<a href="#tocKaIntact">Ka Intact</a><br />
<a href="#tocKa">Ka</a><br />
<a href="#tocKpIntact">Kp Intact</a><br />
<a href="#tocKp">Kp</a><br />
<a href="#tocMethod">Method</a><br />
<a href="#tocNumberofPiers">Number of Piers</a><br />
<a href="#tocOperation">Operation</a><br />
<a href="#tocOrificeHeightFullyOpen">Orifice Height Fully Open</a><br />
<a href="#tocOrificeOpening">Orifice Opening</a><br />
<a href="#tocOrificeShape">Orifice Shape</a><br />
<a href="#tocOrificeWidthFullyOpen">Orifice Width Fully Open</a><br />
<a href="#tocPeriodCollapse">Period Collapse</a><br />
<a href="#tocPeriodFailure">Period Failure</a><br />
<a href="#tocPeriodOpeningClosing">Period Opening/Closing</a><br />
<a href="#tocPeriodStartupShutdown">Period Startup/Shutdown</a><br />
<a href="#tocPumpCapacity">Pump Capacity</a><br />
<a href="#tocPumpNumber">Pump Number</a><br />
<a href="#tocPumpOperation">Pump Operation</a><br />
<a href="#tocSaIntactFailed">Sa Failed</a><br />
<a href="#tocSaIntactFailed">Sa Intact</a><br />
<a href="#tocSbIntactFailed">Sb Failed</a><br />
<a href="#tocSbIntactFailed">Sb Intact</a><br />
<a href="#tocSideSlopeDegree">Side Slope (degree)</a><br />
<a href="#tocTopWidthBreached">Top Width Breached</a><br />
<a href="#tocTopWidthCollapse">Top Width Collapse</a><br />
<a href="#tocTopWidthFullyBreached">Top Width Fully Breached</a><br />
<a href="#tocWeirHeight">Weir Height</a><br />
<a href="#tocWeirHeightSpeed">Weir Height Speed</a><br />
<a href="#tocWeirTypeIntactFailed">Weir Type Failed</a><br />
<a href="#tocWeirTypeIntactFailed">Weir Type Intact</a><br />
<a href="#tocWeirWidth">Weir Width</a><br />
<a href="#tocWeirWidthSpeed">Weir Width Speed</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TOCCommands">Table 137: </span><strong>TUFLOW Classic/HPC TOC Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocBreachOpening"><tcmd>Breach Opening </tcmd><teq>==<br></teq></a> <tblk>[ {CLOSE}  |  OPEN  |  NO CHANGE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The breach status of a Dam Failure Channel. CLOSE will keep the breach
fully closed, while OPEN will start the breaching process. NO
CHANGE means that the DF channel operation remains unchanged. The
default status is CLOSE. See Section
<a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCd"><tcmd>Cd </tcmd><teq>==<br></teq></a> <tblk>[ {0.75 or 0.6} |  <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>For RO culverts, sets the discharge coefficient used in the <span class="citation">(<a href="#ref-Nair2003">Ansar M. and Nair S., 2003</a>)</span>
equation. The default value is 0.75 for RO culverts. See Section <a href="#RO-3"><strong>??</strong></a>.</p>
For PF channels, sets the discharge coefficient used in the orifice flow
equation <a href="#eq:equ-orifice-flow">(31)</a>. The default value is 0.6 for PF channels.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCdGate"><tcmd>Cd Gate </tcmd><teq>==<br></teq></a> <tblk>[ {0.6 or 0.75} |  <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the discharge coefficient of the gate. For sluice gates the default value is 0.6 (see Section <a href="#SG-SGO-3"><strong>??</strong></a>). For gated spillways the default is set to the default for <a href="#tocCdSpillway">Cd Spillway</a>, which is 0.75 (see Section <a href="#SPO-3"><strong>??</strong></a>).
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCdGateSubmerged"><tcmd>Cd Gate Submerged </tcmd><teq>==<br></teq></a> <tblk>[ {0.8} |  <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the discharge coefficient of the gate when fully submerged. The
default value is 0.8. See Section <a href="#SG-SGO-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCdIntactFailed"><tcmd>Cd Failed </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<a href="#tocCdIntactFailed">Cd Intact</a> sets the weir coefficient (Cd) for the
un-breached section of the DF channel, while <a href="#tocCdIntactFailed">Cd
Failed</a> sets Cd for the breached section of the DF
channel. This command overwrites the default Cd values set by the <a href="#tocWeirTypeIntactFailed">Weir
Type Intact/Failed</a> command. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCdIntactFailed"><tcmd>Cd Intact </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Cd <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<a href="#tocCdIntactFailed">Cd Intact</a> sets the weir coefficient (Cd) for the
un-breached section of the DF channel, while <a href="#tocCdIntactFailed">Cd
Failed</a> sets Cd for the breached section of the DF
channel. This command overwrites the default Cd values set by the <a href="#tocWeirTypeIntactFailed">Weir
Type Intact/Failed</a> command. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCdSpillway"><tcmd>Cd Spillway </tcmd><teq>==<br></teq></a> <tblk>[ {0.75} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the discharge coefficient of the spillway. Default = 0.75. Prior to the 2016-03 release the default was 0.5 due to a different version of the weir
equation being used. See Section <a href="#SPO-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCf"><tcmd>Cf </tcmd><teq>==<br></teq></a> <tblk>[ {1.0} |  <span class="math inline">\(\langle\)</span> Cf <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Weir calibration factor. The default value is 1.0. See Section <a href="#Weirs-Operational-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCfIntactFailed"><tcmd>Cf Failed </tcmd><teq>==<br></teq></a> <tblk>[ {1.0} |  <span class="math inline">\(\langle\)</span> Cf <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the weir calibration factor for DF channels. The default values are 1.0. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocCfIntactFailed"><tcmd>Cf Intact </tcmd><teq>==<br></teq></a> <tblk>[ {1.0} |  <span class="math inline">\(\langle\)</span> Cf <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the weir calibration factor for DF channels. The default values are 1.0. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocDefineControl"><tcmd>Define [<span class="math inline">\(\langle\)</span>structure_type<span class="math inline">\(\rangle\)</span>]  Control </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> control_id <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Available structure types (<tcmd><span class="math inline">\(\langle\)</span>structure_type<span class="math inline">\(\rangle\)</span></tcmd>) include: “Culvert”, “Pump”, “Q Channel”, “Sluice”, “Spillway”, “Weir”, “Pipe Failure” or “Dambreak”.</p>
<p>Each Define Control block consists of three sections:</p>
<ul>
<li>The default settings for the control’s commands, which are usually
placed at the top of the definition and prior to the logical rules.
The default settings are the values used for a command in the event
the command is not used within the logic rules.<br />
</li>
<li>User defined variables – see Section <a href="#UserDef-4"><strong>??</strong></a></li>
<li>One or more logical rules – see Section <a href="#Logic-4"><strong>??</strong></a></li>
</ul>
<p>Within the control definition, commands specific to the type of
structure/device can be used to adjust the structure/device’s operation.
Further information can be found in Section <a href="#TOC-Define-4"><strong>??</strong></a>.</p>
<p><span class="math inline">\(\langle\)</span> control_id <span class="math inline">\(\rangle\)</span> is a unique control definition name. For a 1d_nwk channel
to use the control, <span class="math inline">\(\langle\)</span> control_id <span class="math inline">\(\rangle\)</span> must be entered into the 1d_nwk
Inlet_Type attribute. As mentioned above, more than one channel can
reference the same control. For example, several pumps may utilise the
same operational control logic.</p>
Use <a href="#tocEndfDefine">End Define</a> to terminate the block. An ERROR occurs
if <a href="#tocEndfDefine">End Define</a> is not specified.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocDepthCollapse"><tcmd>Depth Collapse </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> depth_collapse <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the depth that the dam crest collapse during the <a href="#tocPeriodCollapse">Period
Collapse</a> at the beginning of the dam break. The
default value is zero (0). See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocDepthFullyBreached"><tcmd>Depth Fully Breached </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> depth_fully_breached <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the height (not elevation) of the dam failure opening when fully
breached. The default value is zero (0). See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocEndfDefine"><tcmd>End Define </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Ends a <a href="#tocDefineControl">Define Control</a> block of .toc commands for
the operating rules applied to hydraulic structures, pumps and other
controllable devices. See Section <a href="#TOC-Define-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocExIntactFailed"><tcmd>Ex Failed </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Ex <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets Ex for the breached section of the DF
channel. See Section <a href="#DF-4"><strong>??</strong></a>. This command overwrites the default Ex values set by the <a href="#tocWeirTypeIntactFailed">Weir
Type Intact/Failed</a> command. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocExIntactFailed"><tcmd>Ex Intact </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Ex <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<a href="#tocExIntactFailed">Ex Intact</a> sets Ex (the weir flow equation
exponent) for the un-breached section of the DF channel. See Section <a href="#DF-4"><strong>??</strong></a>. This command overwrites the default Ex values set by the <a href="#tocWeirTypeIntactFailed">Weir
Type Intact/Failed</a> command. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocGateHeightFullyOpen"><tcmd>Gate Height Fully Open </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> height <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
For vertically moving gates the height (not elevation) of the gate when
fully open above the gate’s seat. If not set, the 1d_nwk “Height”
attribute is used. Metric units (default) are metres. Using <tcmd><a href="#tcfUnits">Units</a> </tcmd><teq>==</teq><tblk> US Customary</tblk>, the units are feet.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocGateOpening"><tcmd>Gate Opening [ {} | (%) ]  </tcmd><teq>==<br></teq></a> <tblk>[ [ ++| –| {}]  | <span class="math inline">\(\langle\)</span> opening <span class="math inline">\(\rangle\)</span> |  {CLOSE} |  OPEN |  NO CHANGE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The position the gate is to be operated towards. A “++” or “–” before
<span class="math inline">\(\langle\)</span> opening <span class="math inline">\(\rangle\)</span> will incrementally open or close the gate by the value of
<span class="math inline">\(\langle\)</span> opening <span class="math inline">\(\rangle\)</span>, otherwise <span class="math inline">\(\langle\)</span> opening <span class="math inline">\(\rangle\)</span> is taken as the absolute position.
The units of <span class="math inline">\(\langle\)</span> opening <span class="math inline">\(\rangle\)</span> are in m or ft, unless “(%)” is specified, where
it is the percentage of the fully gate open position. CLOSE will start
moving the gate to the fully closed position, while OPEN will start
moving the gate to the fully open position. NO CHANGE means that the
gate operation remains unchanged. The default setting is CLOSE.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocGateSeatVerticalOffset"><tcmd>Gate Seat Vertical Offset </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> offset <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The difference in height in metres (or feet if <a href="#tcfUnits">Units</a> == US
Customary) between the spillway crest and the seat of the gate.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocGateSpeed"><tcmd>Gate Speed [ {} | (min) ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> speed <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The speed at which the gate moves. Units are m/s or ft/s or if “(min)”
is specified in m/min or ft/min. See Sections <a href="#QO-3"><strong>??</strong></a>, <a href="#RO-3"><strong>??</strong></a>, <a href="#SG-SGO-3"><strong>??</strong></a> and <a href="#SPO-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocGateType"><tcmd>Gate Type </tcmd><teq>==<br></teq></a> <tblk>[ VERTICAL UNDERFLOW |  VERTICAL OVERFLOW |  HORIZONTAL SINGLE |  HORIZONTAL DOUBLE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the type of gate arrangement. VERTICAL/HORIZONTAL indicates the
direction of the gate movement. SINGLE is a single gate, while DOUBLE
are two gates that move in/out from either side. See Section <a href="#RO-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocGateWidthFullyOpen"><tcmd>Gate Width Fully Open </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> width <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
For horizontally moving gates the width of the gate(s) when fully open.
Units are m or ft. If not set, the 1d_nwk “Width_or_Dia” attribute is
used. See Section <a href="#RO-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocMethod"><tcmd>Method </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> method <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets which method to use for the hydraulic calculations. As
of the 2013-12 release this command does not need to be applied, as it is intended
for use should alternative equations become available for a structure in
future releases.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocOperation"><tcmd>Operation </tcmd><teq>==<br></teq></a> <tblk>[ NO CHANGE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Keep the operation of the structure unchanged. UNCHANGED can also be
used instead of NO CHANGE. This function can be applied to all operational structures types.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocOrificeHeightFullyOpen"><tcmd>Orifice Height Fully Open </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> height <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Optional command to set the height of the piping orifice when fully
breached. If omitted, the value set by 1d_nwk Height_or_WF attribute is
used. See Section <a href="#PF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocOrificeOpening"><tcmd>Orifice Opening </tcmd><teq>==<br></teq></a> <tblk>[ {CLOSE} |  OPEN |  NO CHANGE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The breach status of a Pipe Failure Channel. CLOSE will keep the breach
to the fully closed, while OPEN will start the breaching process. NO
CHANGE means that the DF channel operation remains unchanged. The
default status is CLOSE. See Section <a href="#PF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocOrificeWidthFullyOpen"><tcmd>Orifice Width Fully Open </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> width <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Optional command to set the width of the piping orifice when fully
breached. If omitted, the value set by 1d_nwk Width_or_Dia attribute is
used. See Section <a href="#PF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPeriodCollapse"><tcmd>Period Collapse [ {} | (min) | (s) ]  </tcmd><teq>==<br></teq></a> <tblk>[ {0.0} |  <span class="math inline">\(\langle\)</span> period <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>For PF channels, sets the time in hour taken to ‘shut close’ the piping
failure channel after it reaches the full extend. The default value is 0
(i.e. no collapsing at the end of pipe failure). See Section <a href="#PF-4"><strong>??</strong></a>.</p>
<p>For DF channels, sets the time in hour taken to rapidly change the dam
breach opening at the beginning of the dam break. The default value for
DF channels is 0 (i.e. no collapsing at the beginning dam failure). See Section <a href="#DF-4"><strong>??</strong></a>.</p>
Units are in hours by default, but minutes or seconds can be used if
“(min)” or “(s)” is specified.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPeriodFailure"><tcmd>Period Failure [ {} | (min) | (s)  </tcmd><teq>==<br></teq></a> <tblk>[ {0.0167} |  <span class="math inline">\(\langle\)</span> period <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>For PF channels, Sets the time in hours taken to reach the full size of piping failure. The default value is 0.0166667 (i.e. 60 seconds). See Section <a href="#PF-4"><strong>??</strong></a>.</p>
<p>For DF channels, Sets the time in hours taken to reach the full size of dam failure. The default value is 0.0166667 (i.e. 60 seconds). See Section <a href="#DF-4"><strong>??</strong></a>.</p>
Units are in hours by default, but minutes or seconds can be used if
“(min)” or “(s)” is specified.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPeriodOpeningClosing"><tcmd>Period Opening/Closing [ {} | (min) | (s) ] </tcmd><teq>==<br></teq></a> <tblk>[ {0.167} |  <span class="math inline">\(\langle\)</span> period <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The time taken to fully open a closed gate or to fully close an open gate or the time taken to start the pump up or shut it down. Units are in hours by default, but minutes or seconds can be used if “(min)” or “(s)” is specified. For example, specifying either of the commands below will set the time taken to open/close the gate to half an hour:</p>
<p><tcmd>Period Opening/Closing </tcmd><teq>==</teq><tblk> 0.5 </tblk><br />
<tcmd>Period Opening/Closing (min) </tcmd><teq>==</teq><tblk> 30 </tblk><br />
<tcmd>Period Opening/Closing (s) </tcmd><teq>==</teq><tblk> 1800 </tblk></p>
<p>If this command is omitted the default opening/closing period is 0.167hrs.</p>
This command is identical to <a href="#tocPeriodStartupShutdown">Period Startup/Shutdown</a> and the two can be used
interchangeably.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPeriodStartupShutdown"><tcmd>Period Startup/Shutdown [ {} | (min) | (s) ] </tcmd><teq>==<br></teq></a> <tblk>[ {0.167} |  <span class="math inline">\(\langle\)</span> period <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The time taken to fully open a closed
gate or to fully close an open gate or the time taken to start the pump
up or shut it down. Units are in hours by default, but minutes or
seconds can be used if “(min)” or “(s)” is specified. For example,
specifying either of the commands below will set the time taken to
open/close the gate to half an hour:</p>
<p><tcmd>Period Opening/Closing </tcmd><teq>==</teq><tblk> 0.5 </tblk><br />
<tcmd>Period Opening/Closing (min) </tcmd><teq>==</teq><tblk> 30 </tblk><br />
<tcmd>Period Opening/Closing (s) </tcmd><teq>==</teq><tblk> 1800 </tblk></p>
<p>If this command is omitted the default opening/closing period is
0.167hrs.</p>
This command is identical to <a href="#tocPeriodOpeningClosing">Period Opening/Closing</a> and the two can be used
interchangeably.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPumpCapacity"><tcmd>Pump Capacity </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> flow <span class="math inline">\(\rangle\)</span> |  <span class="math inline">\(\langle\)</span> discharge_curve <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The flow capacity of the pump either as a constant flow or reference to
a dep. If a constant flow rate, specify <span class="math inline">\(\langle\)</span> flow <span class="math inline">\(\rangle\)</span>. If a head-discharge
curve specify the name of the curve in the <a href="#ecfDepthDischargeDatabase">Depth Discharge
Database</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPumpNumber"><tcmd>Pump Number </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> no_pumps <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Number of pumps in parallel.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocPumpOperation"><tcmd>Pump Operation </tcmd><teq>==<br></teq></a> <tblk>[ ON |  OFF |  NO CHANGE ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Turns the operation of the pump on or off, or keeps the current operation unchanged.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocSaIntactFailed"><tcmd>Sa Failed </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Sa <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets Sa (the Villemonte equation
coefficient <em>a</em>) for the breached section of the
DF channel. See Section <a href="#DF-4"><strong>??</strong></a>. This command overwrites the default Sa values set by the
<a href="#tocWeirTypeIntactFailed">Weir Type Intact/Failed</a> command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocSaIntactFailed"><tcmd>Sa Intact </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Sa <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets Sa (the Villemonte equation
coefficient <em>a</em>) for the un-breached section of the DF channel. See Section <a href="#DF-4"><strong>??</strong></a>. This command overwrites the default Sa values set by the
<a href="#tocWeirTypeIntactFailed">Weir Type Intact/Failed</a> command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocSbIntactFailed"><tcmd>Sb Failed </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Sb <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets Sb (the Villemonte equation
coefficient <em>b</em>) for the breached section of the
DF channel. See Section <a href="#DF-4"><strong>??</strong></a>. This command overwrites the default Ex values set by the
<a href="#tocWeirTypeIntactFailed">Weir Type Intact/Failed</a> command.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocSbIntactFailed"><tcmd>Sb Intact </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> Sb <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<a href="#tocSbIntactFailed">Sb Intact</a> sets Sb (the Villemonte equation
coefficient <em>b</em>) for the un-breached section of the DF channel. See Section <a href="#DF-4"><strong>??</strong></a>. This command overwrites the default Ex values set by the
<a href="#tocWeirTypeIntactFailed">Weir Type Intact/Failed</a> command. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocSideSlopeDegree"><tcmd>Side Slope (degree) </tcmd><teq>==<br></teq></a> <tblk>[ 90 |  <span class="math inline">\(\langle\)</span> slope_in_degree <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the angle of side slope in degree. This is used for bottom width
and flow area calculation. The default value is 90°, i.e. vertical side
walls. See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocTopWidthCollapse"><tcmd>Top Width Collapse </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> top_width <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the top width that opens up during the <a href="#tocPeriodCollapse">Period
Collapse</a>. This command is optional. If not defined,
the collapse width is set proportionally as <a href="#tocTopWidthFullyBreached">Top Width Fully
Breached</a>* <a href="#tocDepthCollapse">Depth
Collapse</a> / <a href="#tocDepthFullyBreached">Depth Fully
Breached</a>. See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocTopWidthFullyBreached"><tcmd>Top Width Fully Breached </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> top_width <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the top width of the dam failure channel opening when fully
breached. Note that the total flow with of the DF channel is set by the
1d_nwk Width_or_Dia attribute. This value can be set smaller than the
Width_or_Dia if the maximum breach width does not reach the total width
of the dam crest. See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocWeirHeight"><tcmd>Weir Height [ {} | % ]  </tcmd><teq>==<br></teq></a> <tblk>[ [++| –|**| //] | <span class="math inline">\(\langle\)</span> weir_height <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The height (not elevation) of the weir above its fully down (open) state
to operate towards. The % option allows the specification of the
percentage of the weir height that is up (0% would indicate completely
lowered and 100% completely raised).</p>
Note that the height of the weir above the crest when fully up is set by
the 1d_nwk Height_or_WF attribute.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocWeirHeightSpeed"><tcmd>Weir Height Speed [ {} | (min)  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> speed <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The speed at which the weir moves in the vertical. Units are m/s or ft/s
or if “(min)” is specified in m/min or ft/min.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocWeirTypeIntactFailed"><tcmd>Weir Type Failed </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> weir_type <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the weir parameters for the DF channel based on Table <a href="#tab:tab-WeirTypes">31</a>. The
default <a href="#tocWeirTypeIntactFailed">Weir Type Intact</a> is “WB”, and the
default <a href="#tocWeirTypeIntactFailed">Weir Type Failed</a> is “WW”. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocWeirTypeIntactFailed"><tcmd>Weir Type Intact </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> weir_type <span class="math inline">\(\rangle\)</span>  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the weir parameters for the DF channel based on Table <a href="#tab:tab-WeirTypes">31</a>. The
default <a href="#tocWeirTypeIntactFailed">Weir Type Intact</a> is “WB”, and the
default <a href="#tocWeirTypeIntactFailed">Weir Type Failed</a> is “WW”. See Table <a href="#tab:tab-WeirFlowTOCCommands">40</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocWeirWidth"><tcmd>Weir Width [ {} | % ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> weir_width <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>The width (not elevation) of the weir to operate towards. The % option
allows the specification of the percentage of the weir width that is
open (0% would indicate completely closed and 100% completely open). See Section <a href="#Weirs-Operational-3"><strong>??</strong></a>.</p>
Note that the full width of the weir is set by the 1d_nwk Width_or_Dia
attribute.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocWeirWidthSpeed"><tcmd>Weir Width Speed [ {} | (min) ]  </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> speed <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The speed at which the weir moves in the horizontal. Units are m/s or
ft/s or if “(min)” is specified in m/min or ft/min. See Section <a href="#Weirs-Operational-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocOrificeShape"><tcmd>Orifice Shape </tcmd><teq>==<br></teq></a> <tblk>[ {Rectangular} | Circular ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the shape of the orifice, the default shape is rectangular. See Section <a href="#PF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocNumberofPiers"><tcmd>Number of Piers </tcmd><teq>==<br></teq></a> <tblk>[ {0} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the number of piers over a weir. For operational weirs, see Section <a href="#Weirs-Operational-3"><strong>??</strong></a>. For dam failure modelling, applying the <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span> approach, see Section <a href="#DF-4"><strong>??</strong></a>. The default value is 0.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocKp"><tcmd>Kp </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the pier contraction coefficient. See Section <a href="#Weirs-Operational-3"><strong>??</strong></a>.</p>
<p>The default value is set to zero (0) for backward compatibility. The following values for the pier contraction coefficient Kp are recommended by <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>:</p>
<ul>
<li>Square-nosed piers with corners rounded on a radius equal to approximately 0.1 of the pier thickness: Kp = 0.02.</li>
<li>Round-nosed piers: Kp = 0.01.</li>
<li>Pointed-nose piers: Kp = 0.0.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocKa"><tcmd>Ka </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the abutment contraction coefficient. See Section <a href="#Weirs-Operational-3"><strong>??</strong></a>.</li>
</ul>
<p>The default value is set to zero (0) for backward compatibility. The recommended values, by <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>, for the abutment contraction coefficient Ka are:</p>
<ul>
<li>Square abutments with headwall at 90° to direction of flow: Ka = 0.20.<br />
</li>
<li>Rounded abutments with headwall at 90° to direction of flow, when 0.15H0≤ r≤ 0.5H0: Ka = 0.10.<br />
</li>
<li>Rounded abutments where r <span class="math inline">\(\rangle\)</span> 0.5H0, and headwall is placed not more than 45° to direction of flow: Ka = 0.0.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocKpIntact"><tcmd>Kp Intact </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the pier contraction coefficient. See Section <a href="#DF-4"><strong>??</strong></a> for details.</li>
</ul>
<p>The default value is set to zero (0) for backward compatibility. The following values for the pier contraction coefficient Kp are recommended by <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>.</p>
<ul>
<li>Square-nosed piers with corners rounded on a radius equal to approximately 0.1 of the pier thickness: Kp = 0.02</li>
<li>Round-nosed piers: Kp = 0.01</li>
<li>Pointed-nose piers: Kp = 0.0
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocKaIntact"><tcmd>Ka Intact </tcmd><teq>==<br></teq></a> <tblk>[ {0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the abutment contraction coefficient. See Section <a href="#DF-4"><strong>??</strong></a> for details.</li>
</ul>
<p>The default value is set to zero (0) for backward compatibility. The recommended values, by <span class="citation">USBR (<a href="#ref-USBR1987">1987</a>)</span>, for the abutment contraction coefficient Ka are:</p>
<ul>
<li><p>Square abutments with headwall at 90° to direction of flow: Ka = 0.20.</p></li>
<li><p>Rounded abutments with headwall at 90° to direction of flow, when 0.15H0≤ r≤ 0.5H0: Ka = 0.10.</p></li>
<li><p>Rounded abutments where r <span class="math inline">\(\rangle\)</span> 0.5H0, and headwall is placed not more than 45° to direction of flow: Ka = 0.0.</p>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<p><a id="tocDischargeCurveType"><tcmd>Discharge Curve Type </tcmd><teq>==<br></teq></a> <tblk>[ {Upstream Depth}  |  Head Difference  |  Pump ]</tblk><br></p>
</td>
<td style="text-align:left;vertical-align:top;">
<p>Classic and HPC</p>
</td>
<td style="text-align:left;">
<p>Used to specify how the depth/head discharge curves are calculated in QO channels. See Section <a href="#QO-3"><strong>??</strong></a>.</p>
<ul>
<li>Upstream Depth: (default) Uses the upstream depth above the channel invert for the depth discharge curve regardless of the downstream water level.</li>
<li>Head Difference: Uses the difference in upstream and downstream water levels to calculate flow rates from head discharge curves. This option is more appropriate for hydraulic structures that experience downstream controlled flow regimes.</li>
<li>Pump: Similar to a 1D pump channel, this option uses the pumping head (i.e., downstream water level minus upstream water level to calculate flow rates from head discharge curves). The flow is always in the direction the channel is digitised. Typically, the curve has decreasing flows with increasing pumping head.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocDepthBreached"><tcmd>Depth Breached </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> initial breach depth <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the initial breach status of the DF channel. Metric units (default) are metres. Using <tcmd><a href="#tcfUnits">Units</a> </tcmd><teq>==</teq><tblk> US Customary</tblk>, the units are feet. See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tocTopWidthBreached"><tcmd>Top Width Breached </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> initial breach depth <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the initial breach status of the DF channel. Metric units (default) are metres. Using <tcmd><a href="#tcfUnits">Units</a> </tcmd><teq>==</teq><tblk> US Customary</tblk>, the units are feet. See Section <a href="#DF-4"><strong>??</strong></a>.
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TRFCCommands-1"><span class="header-section-number">24</span> TRFC Commands<a href="#TRFCCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW Rainfall Control File (.trfc) contains commands used to generate rainfall grids based on point rainfall gauges, it is read into the .tcf using the <a href="#tcfRainfallControlFile">Rainfall Control File</a> command. For more information on the .trfc see Section <a href="#TRFC-3"><strong>??</strong></a>. Generating and using rainfall grids is discussed in Section <a href="#TRFC-File-4"><strong>??</strong></a>. The
<a href="https://wiki.tuflow.com/TUFLOW_Rainfall_Control_File_Examples">TUFLOW Wiki</a> also includes some useful discussion on this subject. The available TRFC commands are listed below and are detailed in Table <a href="#tab:tab-TRFCCommands">138</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#trfcfIDWExponent">IDW Exponent</a><br />
<a href="#trfcfIDWMaximumDistance">IDW Maximum Distance</a><br />
<a href="#trfcfIDWMaximumPoints">IDW Maximum Points</a><br />
<a href="#trfcfMaximumHyetographPoints">Maximum Hyetograph Points</a><br />
<a href="#trfcfMaximumRFLocations">Maximum RF Locations</a><br />
<a href="#trfcfReadGISRFPoint">Read GIS RF Point</a><br />
<a href="#trfcfReadGISRFPolygon">Read GIS RF Polygons</a><br />
<a href="#trfcfReadGISRFTriangle">Read GIS RF Triangles</a><br />
<a href="#trfcfRFGridCellSize">RF Grid Cell Size</a><br />
<a href="#trfcfRFGridFormat">RF Grid Format</a><br />
<a href="#trfcfRFGridOrigin">RF Grid Origin</a><br />
<a href="#trfcfRFGridSize">RF Grid Size (N,M)</a><br />
<a href="#trfcfRFGridSize">RF Grid Size (X,Y)</a><br />
<a href="#trfcfRFInterpolationMethod">RF Interpolation Method</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TRFCCommands">Table 138: </span><strong>TUFLOW Classic/HPC TRFC Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfIDWExponent"><tcmd>IDW Exponent </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> p <span class="math inline">\(\rangle\)</span>  |  {2}  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If using the <tcmd><a href="#trfcfRFInterpolationMethod">RF Interpolation Method</a></tcmd><teq> == </teq><tblk>IDW</tblk> the exponent in the IDW equation can be changed from the default value of 2. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfIDWMaximumDistance"><tcmd>IDW Maximum Distance </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> max_dist <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If using the <tcmd><a href="#trfcfRFInterpolationMethod">RF Interpolation Method</a></tcmd><teq> == </teq><tblk>IDW</tblk> the maximum distance for a point to be considered in the IDW interpolation can be set using this command. If not specified, no maximum distance is considered. Using metric units (default), the distance is in metres. Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the units are feet. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfIDWMaximumPoints"><tcmd>IDW Maximum Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> max_points <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If using the <tcmd><a href="#trfcfRFInterpolationMethod">RF Interpolation Method</a></tcmd><teq> == </teq><tblk>IDW</tblk> the maximum number of points
considered in the interpolation can be specified. This may reduce memory
usage if a very large number of rainfall points are used. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfMaximumHyetographPoints"><tcmd>Maximum Hyetograph Points </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> max_pts <span class="math inline">\(\rangle\)</span> |  {1,000} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the temporary memory allocated for reading / storing the
rainfall data. If more the 1,000 points occur in the rainfall
hyetograph, this can be increased. Can also be reduced to decrease
temporary memory allocation. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfMaximumRFLocations"><tcmd>Maximum RF Locations </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> max_rf_gauges <span class="math inline">\(\rangle\)</span> |  {1,000} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the temporary memory allocated for reading / storing the
rainfall data. If more the 1,000 point rainfall locations are used, this
can be increased. Can also be reduced to decrease temporary memory
allocation. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfReadGISRFPoint"><tcmd>Read GIS RF Point </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Read the point rainfall locations in the 2d_rf file format. For each
point the attributes are Name, f1 and f2 factors. If the rainfall
factors f1 and/or f2 are zero (or less than zero), these are changed to
1 and <a href="http://wiki.tuflow.com/TUFLOW_Message_2618">WARNING 2618</a> is
issued. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfReadGISRFPolygon"><tcmd>Read GIS RF Polygons </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The GIS layer contains a series of polygons or regions in the 2d_rf
format. These polygons can either have the rainfall boundary Name (and
f1 and f2 factors) specified on the polygon objects, or if these
attributes are blank TUFLOW looks for rainfall points (specified with
the <a href="#trfcfReadGISRFPoint">Read GIS RF Point</a>s) that fall within the
polygons. If the Name attribute in the polygon layer is blank and no
points fall within the polygon an <a href="http://wiki.tuflow.com/TUFLOW_Message_2619">ERROR
2619</a>
occurs. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfReadGISRFTriangle"><tcmd>Read GIS RF Triangles </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis_layer <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Reads in a GIS layer containing the triangulation of the rainfall
points. The GIS objects should be polygons or regions with three
vertices, with each vertex snapped to a rainfall point location as
specified by <a href="#trfcfReadGISRFPoint">Read GIS RF Point</a>s. The layer is
typically produced by other software specialising in the interpolation
of rainfall, but can be manually created when only a small number of
rainfall locations exist. The attributes of the GIS layer are not used.
For each grid cell in the rainfall output grids, the rainfall depth is
based on the planar (linear) interpolation of the three rainfall depths
at the vertices of the bounding triangle. An example of a triangulation
polygon layer (red) connecting the rainfall point locations (blue) is
shown below. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.</p>
<img src="images/image199.png" style="width:2.70833in;height:2.02257in">
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfRFGridCellSize"><tcmd>RF Grid Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the cell size for the generated rainfall grids. If omitted, a value
10 times the 2D domain cell size is used. Typically the rainfall can
be satisfactorily represented on a much coarser resolution than that
required for the hydraulic calculations, therefore, using high
resolution rainfall grids is not required and unnecessarily consumes
memory and disk space, and may slow down the simulation. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfRFGridFormat"><tcmd>RF Grid Format </tcmd><teq>==<br></teq></a> <tblk>[ ASC |  FLT |  NC | TIF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>This mandatory command sets the output grid format. Options are TIF (GeoTIFF - extension .tif) , FLT (ESRI binary grid – extension
.flt), ASC (ESRI asc grid – extension .asc), or NC (NetCDF extension .nc).</p>
<p>The rainfall grids are output to a separate folder (RFG\
<span class="math inline">\(\langle\)</span> rainfall_grid <span class="math inline">\(\rangle\)</span>) in the location of the .trfc file. If the .trfc file
is in the bc_dbase\ folder, a new folder “bc_dbase\” is created
containing the output grids.</p>
<p>The output formats from the rainfall interpolation are compatible with
the formats used by the .tcf <a href="#tcfReadGridRF">Read Grid RF</a>, therefore,
once the rainfall grids have been generated this command can be used to
apply the rainfall, rather than regenerate the rainfall grids using the
.trfc file (should the .trfc input files remain unchanged).</p>
<p><strong>NC:</strong> If NetCDF output is specified a single output file (.nc)
containing all timesteps in a single file is created. This is given the
simulation name: TUFLOW_dbase\simulation_name <span class="math inline">\(\rangle\)</span>.nc ensuring that
the dataset is not accidentally overwritten as the simulation is
running. There is no limit to the number of rainfall timesteps that are
included in the NetCDF format.</p>
<p>A total rainfall depth is also output, however, this is not used by
TUFLOW during the simulation, and it can be used for checking purposes.
For more information see <a href="https://wiki.tuflow.com/index.php?title=TUFLOW_NetCDF_Rainfall_Format">TUFLOW NetCDF Rainfall
Format</a>
Wiki Page.</p>
<p><strong>TIF, FLT and ASC:</strong> A series of grids are written (one
for each hyetograph timestep) in the specified formats. Due to the
large number of grids that may be written, these are separated into a
sub-folder under the RFG\ folder, for example:<br />
_dbase\simulation_name <span class="math inline">\(\rangle\)</span>\simulation_name <span class="math inline">\(\rangle\)</span>_t<span class="math inline">\(\langle\)</span> time <span class="math inline">\(\rangle\)</span>.tif</p>
<p>An index file containing a list of the times and rainfall grid filenames
is written in .csv file format in the same folder, for example:<br />
_dbase\simulation_name <span class="math inline">\(\rangle\)</span>\simulation_name <span class="math inline">\(\rangle\)</span>_rf_index.csv</p>
A limit of 1,000 grids exists if using the TIF, FLT or ASC format, if more than 1,000 grids are required the NetCDF format should be
used. Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfRFGridOrigin"><tcmd>RF Grid Origin </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> OX <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> OY <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the origin for the output rainfall grid. If this command is omitted
the rainfall grid origin is based on the origin of the TUFLOW 2D
domain(s). Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfRFGridSize"><tcmd>RF Grid Size (N,M) </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> rows <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> columns <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the size of the output rainfall grids. Similar to the .tgc <a href="#tgcGridSizeNM">Grid
Size (N,M)</a> command. If omitted the rainfall grid size is based on the dimensions
in the TUFLOW 2D domain(s). Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfRFGridSize"><tcmd>RF Grid Size (X,Y) </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> X_length <span class="math inline">\(\rangle\)</span>, <span class="math inline">\(\langle\)</span> Y_length <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the size of the output rainfall grids. Similar to the .tgc <a href="#tgcGridSizeXY">Grid Size (X,Y)</a>
command. If omitted the rainfall grid size is based on the dimensions
in the TUFLOW 2D domain(s). Refer to Section <a href="#TRFC-File-4"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="trfcfRFInterpolationMethod"><tcmd>RF Interpolation Method </tcmd><teq>==<br></teq></a> <tblk>[ IDW |  POLYGON |  TIN ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Sets the interpolation approach between rainfall locations. This command
must be specified with one of the options as described below.</p>
<p><strong>IDW:</strong> An inverse distance weighting approach is used to calculate the
rainfall depth based on the distance to the surrounding rainfall points
(specified by <a href="#trfcfReadGISRFPoint">Read GIS RF Point</a>s).</p>
<p><img src="images/image200.png" style="width:1.2354in;height:1.05208in"></p>
<p>The exponent (p) can be changed from its default value of 2 using <a href="#trfcfIDWExponent">IDW
Exponent</a>. Other commands that affect the IDW
interpolation are <a href="#trfcfIDWMaximumDistance">IDW Maximum Distance</a> and
<a href="#trfcfIDWMaximumPoints">IDW Maximum Points</a>.</p>
<p><strong>POLYGON:</strong> A series of GIS polygons are specified and the rainfall for
each polygon comes from the point rainfall. This can be used to apply
distributions such as Thiessen polygons generated from other software.
The regions or polygons are read in the 2d_rf format, and can either
have the rainfall boundary Name (and F1 and F2 factors) specified via
the polygon attributes, or if the attributes are blank TUFLOW will look
for rainfall points (specified by <a href="#trfcfReadGISRFPoint">Read GIS RF
Point</a>s) that fall within the polygons. If the
Name attribute in the polygon layer is blank and no points fall within
the polygon an <a href="http://wiki.tuflow.com/index.php?title=TUFLOW_Message_2619">ERROR
2619</a>
occurs.</p>
<p>This method is similar to using a series of rainfall polygons read in
via the .tbc <a href="#tbcReadGISRF">Read GIS RF</a> command. By pre-processing
using a .trfc file, however significant more memory efficiency occurs,
particularly if a large number of rainfall boundaries is used.</p>
<strong>TIN:</strong> A TIN (Triangulated Irregular Network) is specified via <a href="#trfcfReadGISRFTriangle">Read
GIS RF Triangles</a> which connects the rainfall
point locations.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TESFCommands-1"><span class="header-section-number">25</span> TESF Commands<a href="#TESFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The External Stress File (.tesf) allows the definition of time varying global or spatially varying external forcing such as wind or wave radiation stresses, it is read into the .tcf using the <a href="#tcfExternalStressFile">External Stress File</a> command. For more information on the .tesf see Section <a href="#TESF-3"><strong>??</strong></a>. Applying external stresses is discussed in Section <a href="#ExternalStress-2"><strong>??</strong></a>. The available TESF commands are listed below and are detailed in Table <a href="#tab:tab-TESFCommands">139</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tesfGlobalWindBC">Global Wind BC</a><br />
<a href="#tesfGridInterpolationMethod">Grid Interpolation Method</a><br />
<a href="#tesfIDWExponent">IDW Exponent</a><br />
<a href="#tesfIDWMaximumDistance">IDW Maximum Distance</a><br />
<a href="#tesfIDWMaximumPoint">IDW Maximum Point</a><br />
<a href="#tesfOutputGridCellSize">Output Grid Cell Size</a><br />
<a href="#tesfOutputGridFormat">Output Grid Format</a><br />
<a href="#tesfOutputGridOrigin">Output Grid Origin</a><br />
<a href="#tesfReadGISWindPoint">Read GIS Wind Point</a><br />
<a href="#tesfReadGISWindPoly">Read GIS Wind Poly</a><br />
<a href="#tesfReadGriddedTau">Read Gridded Tau</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TESFCommands">Table 139: </span><strong>TUFLOW Classic/HPC TESF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfGlobalWindBC"><tcmd>Global Wind BC </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> boundary name <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command defines the Wind BC name in the BC Database (Section <a href="#bcdbase-2"><strong>??</strong></a>). It invokes a global wind boundary in a model. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfGridInterpolationMethod"><tcmd>Grid Interpolation Method </tcmd><teq>==<br></teq></a> <tblk>[ IWD | Poly | {no default} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Defines the external stress grid interpolation method. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfIDWExponent"><tcmd>IDW Exponent </tcmd><teq>==<br></teq></a> <tblk>[ {2.0} | <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the exponent term to be used in the external stress IDW
interpolation. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfIDWMaximumDistance"><tcmd>IDW Maximum Distance </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This can be used to set the maximum distance for a point to be
considered in the external stress IDW interpolation, any points further
than this are not used in the IDW interpolation. If not specified no
maximum distance is considered. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfIDWMaximumPoint"><tcmd>IDW Maximum Point </tcmd><teq>==<br></teq></a> <tblk>[ {all} | <span class="math inline">\(\langle\)</span> maximum points <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the maximum number of points considered in the external stress
IDW interpolation. By default, all point locations will be used. If a
very large number of point locations are provided this command can be
used to reduce the memory usage. For example, if 100 wind locations are
provided, and the IDW Maximum Point is set to 20 at each output grid
interpolation point only the closest 20 points are used. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfOutputGridCellSize"><tcmd>Output Grid Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> value <span class="math inline">\(\rangle\)</span> | {10 x the smallest 2D cell size} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the grid size for the generated stress grids. If omitted, a value
of 10 times the smallest 2D cell size is used. Typically, wind stresses
can be satisfactorily represented on a much coarser resolution than that
required for the hydraulic computations, therefore, using high
resolution stress grids is typically not required and may unnecessarily
increase memory usage, disk space and may slow down the simulation. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfOutputGridFormat"><tcmd>Output Grid Format </tcmd><teq>==<br></teq></a> <tblk>[ ASC | FLT | {NC} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the output grid format to be used if interpolating point data to a
stress grid. The default is to use NetCDF as this packages all output
grid data for the simulation into a single .nc file. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfOutputGridOrigin"><tcmd>Output Grid Origin </tcmd><teq>==<br></teq></a> <tblk>[ x, y ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the origin for the output stress grids. If this command is omitted,
the model origin is used. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfReadGISWindPoint"><tcmd>Read GIS Wind Point </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command defines spatially varying wind BC name information, as
referenced in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>). This command invokes
external stress grid interpolation. Uses 2d_ws GIS layers, as described in Table <a href="#tab:tab-WindStress">87</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfReadGISWindPoly"><tcmd>Read GIS Wind Poly </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis file <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command defines spatially varying wind BC name information, as
referenced in the BC Database (see Section <a href="#bcdbase-2"><strong>??</strong></a>). This command invokes
external stress grid interpolation. See Section <a href="#TESF-3"><strong>??</strong></a>. Uses 2d_ws GIS layers, as described in Table <a href="#tab:tab-WindStress">87</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tesfReadGriddedTau"><tcmd>Read Gridded Tau </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> path to .nc or grid index .csv <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command is used to reference a user defined external stress file. See Section <a href="#TESF-3"><strong>??</strong></a>.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="QCFCommands-1"><span class="header-section-number">26</span> QCF Commands<a href="#QCFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The Quadtree Control File (.qcf) is used to define the grid refinement areas and optionally the model location and extent, it is read into the .tcf using the <a href="#tcfQuadtreeControlFile">Quadtree Control File</a> command. For more information on the .qcf see Section <a href="#QCF-3"><strong>??</strong></a>. Setting up a quadtree grid is discussed in Section <a href="#Quadtree-3"><strong>??</strong></a>. The available QCF commands are listed below and are detailed in Table <a href="#tab:tab-QCFCommands">140</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#qcfBaseCellSize">Base Cell Size</a><br />
<a href="#qcfModelOriginandExtent">Model Origin and Extent</a><br />
<a href="#qcfOrientationAngle">Orientation Angle</a><br />
<a href="#qcfQuadtreeMeshProcessingMethod">Quadtree Mesh Processing Method</a><br />
<a href="#qcfReadGISNesting">Read GIS Nesting</a><br />
<a href="#qcfSpatialDatabase">Spatial Database</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-QCFCommands">Table 140: </span><strong>TUFLOW HPC QCF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="qcfBaseCellSize"><tcmd>Base Cell Size </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> cell size<span class="math inline">\(\rangle\)</span>  | {TGC} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Used to set the Level 1 (parent) cell size. If set to “TGC”, then the cell size defined in the .tgc is used. If set to a numerical value, can be used to override the cell size command in the .tgc file. Using metric units (default) the value is in metres. Using <tcmd><a href="#tcfUnits">Units</a></tcmd> <teq>==</teq><tblk> US Customary</tblk>, the value is in feet. See Section <a href="#Quadtree-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="qcfOrientationAngle"><tcmd>Orientation Angle </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> angle <span class="math inline">\(\rangle\)</span>  | Optimise  |  {TGC} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
If set to a numerical value (in degrees) defines the model orientation angle and overwrites any angle / location .tgc commands. If Set to “Optimise” the parent Level 1 polygon is used to optimise the angle of the mesh. As such the GIS nesting polygon must have a Level 1 polygon defined. See Section <a href="#Quadtree-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="qcfModelOriginandExtent"><tcmd>Model Origin and Extent </tcmd><teq>==<br></teq></a> <tblk>[ {Auto} | TGC ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
If set to “Auto” the extents of the Level 1 GIS polygon are used to define the model origin and extents. If set to “TGC”, the model is located as per the commands in the .tgc file. Note the angle of the model is defined with the Orientation Angle command below. Also note, if set to “Auto” the GIS nesting polygons must have a Level 1 polygon defined, otherwise an ERROR is generated. The default setting is “TGC” if <tcmd><a href="#tcfQuadtreeControlFile">Quadtree Control File</a></tcmd><teq> ==</teq><tblk> Single Level</tblk> and “Auto” if a .qcf (e.g. <tcmd><a href="#tcfQuadtreeControlFile">Quadtree Control File</a></tcmd><teq> == </teq><tblk><span class="math inline">\(\langle\)</span> .qcf<span class="math inline">\(\rangle\)</span></tblk>) is specified. See Section <a href="#Quadtree-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="qcfReadGISNesting"><tcmd>Read GIS Nesting </tcmd><teq>==<br></teq></a> <tblk>[ <span class="math inline">\(\langle\)</span> gis file in 2d_qnl format <span class="math inline">\(\rangle\)</span> ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Used to define polygons of mesh refinement (different levels). Uses 2d_qnl GIS layers, as described Section <a href="#QDT-mesh-4"><strong>??</strong></a>. See Section <a href="#Quadtree-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="qcfQuadtreeMeshProcessingMethod"><tcmd>Quadtree Mesh Processing Method </tcmd><teq>==<br></teq></a> <tblk>[ {FAST}  | Memory Efficient  ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
When pre-processing the Quadtree mesh, a hidden 2D domain is used for areas of refinement to allow fast processing of geometry on a regular grid. The default approach, “FAST”, treats each nesting level as a domain, therefore with 3 levels of nesting the geometry control file is processed 3 times. To reduce initialisation memory demands it is possible to treat each GIS polygon in the 2d_qnl as a separate domain for the processing of geometry inputs by setting this command to “Memory Efficient”. Whilst being more memory efficient during mesh creation, this may be slower to initialise. It has no effect on the speed of the hydraulic computations or the memory demand during the hydraulic calculations. See Section <a href="#Quadtree-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="qcfSpatialDatabase"><tcmd>Spatial Database </tcmd><teq>==<br></teq></a> <tblk>[ OFF | TCF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
HPC Only
</td>
<td style="text-align:left;">
Optional when using the GeoPackage input format. Sets the database to use for subsequent inputs. See Section <a href="#GPKG-3"><strong>??</strong></a>.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TSCFCommands-1"><span class="header-section-number">27</span> TSCF Commands<a href="#TSCFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW SWMM Control File (.tscf) contains the SWMM input commands, it is read into the .tcf using the <a href="#tcfSWMMControlFile">SWMM Control File</a> command. For more information on the .tscf, see Section <a href="#TSCF-3"><strong>??</strong></a>. Setting up a SWMM-TUFLOW model is discussed in Chapter <a href="#OneD-SWMM-1"><strong>??</strong></a>. The available TSCF commands are listed below and are detailed in Table <a href="#tab:tab-TSCFCommands">141</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tscfCheckINPSaveDate">Check INP Save Date</a><br />
<a href="#tscfInletSurchargeOrificeCoefficient">Inlet Surcharge Orifice Coefficient</a><br />
<a href="#tscfMaximumInletPondedDepth">Maximum Inlet Ponded Depth</a><br />
<a href="#tscfOutputFolder">Output Folder</a><br />
<a href="#tscfREADBC">READ BC &lt;TYPE&gt;</a><br />
<a href="#tscfReadGISSWMMInletUsage">Read GIS SWMM Inlet Usage</a><br />
<a href="#tscfReadSWMM">Read SWMM</a><br />
<a href="#tscfSWMMIterations">SWMM Iterations</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TSCFCommands">Table 141: </span><strong>TUFLOW Classic/HPC TSCF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfCheckINPSaveDate"><tcmd>Check INP Save Date </tcmd><teq>==<br></teq></a> <tblk>[ {ERROR} | WARNING | OFF ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Checks that the save date of the SWMM .inp file is later than the save date of the equivalent SWMM GeoPackage GIS layer. This command is very useful for detecting the possibility that a GIS layer has been modified, but not exported as an .inp prior to the simulation. For this check to function, both the .inp and GIS files must be located in the same folder.</p>
<p>For the ERROR option (the default), the simulation terminates and an error message is reported.</p>
<p>For the WARNING option, a warning is written to the screen and log file, but the simulation proceeds without pausing. It remains the responsibility of the user to check for any warnings.</p>
<p>The OFF option disables all checks and no warnings are given.</p>
Refer to Section <a href="#SWMMGISTools-2"><strong>??</strong></a> for SWMM GeoPackage GIS layer information.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfInletSurchargeOrificeCoefficient"><tcmd>Inlet Surcharge Orifice Coefficient </tcmd><teq>==<br></teq></a> <tblk>[ {0.16} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Specifies the orifice equation coefficient that is used when a 1D SWMM inlet overflows to 2D TUFLOW (1D SWMM pressure head is higher than the 2D TUFLOW water surface elevation). See Section <a href="#OneD2DSWMMPipeNetwork-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfMaximumInletPondedDepth"><tcmd>Maximum Inlet Ponded Depth </tcmd><teq>==<br></teq></a> <tblk>[ {999} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command prevents unrealistic SWMM ponding elevations when using SWMM hydrology to convey subcatchment flows directly to pipe network nodes connected to the 2D TUFLOW domain. When the 1D SWMM domain water depth at the node inlet is above the specified value, the ponded volume above this threshold will be transferred to the 2D TUFLOW domain in the next SWMM timestep. Without this command, flows from the 1D to the 2D domain are determined based on the orifice equation. In that form, because of the unrealistic nature of adding the flows directly to the pipe network, this can lead to unrealistically high water levels in ponded SWMM nodes. See Section <a href="#OneD2DSWMMPipeNetwork-3"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfOutputFolder"><tcmd>Output Folder </tcmd><teq>==<br></teq></a> <tblk>[ &lt;folder&gt; ]</folder></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
The default location for 1D SWMM output is the folder location specified using the .tcf <a href="#tcfOutputFolder">Output Folder</a> command. This command redirects the SWMM combined inp file and all SWMM output data to a non-default folder location.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfREADBC"><tcmd>READ BC &lt;type&gt; </type></tcmd><teq>==<br></teq></a> <tblk>[ &lt;input_curve_1&gt; | &lt;input_curve_2&gt; | … ]</input_curve_2></input_curve_1></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Reads curves from the BC database using the Name lookup (similar to what would be used in the 2d_bc) and writes them to the SWMM .inp file used for the simulation, into the [TIMESERIES] section if “TIMESERIES” is provided, or otherwise into the generic curves section. For generic curves, the type specified before the “==” becomes the Type specified in the inp. Valid types (&lt;type&gt;) are STORAGE, SHAPE, DIVERSION, TIDAL, PUMP1, PUMP2, PUMP3, PUMP4, PUMP5, RATING, CONTROL, or WEIR. Multiple commands can be used as needed and the simulation events will be used as appropriate. See Section <a href="#SWMM-BCDB-3"><strong>??</strong></a> for more details. </type>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfReadGISSWMMInletUsage"><tcmd>Read GIS SWMM Inlet Usage </tcmd><teq>==<br></teq></a> <tblk>[ &lt;swmm_inlet_usage_filename&gt; ]</swmm_inlet_usage_filename></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command reads a SWMM inlet usage filename to identify locations and attributes of inlets (pits) that connect the 2D TUFLOW and 1D SWMM models. This feature uses swmm_iu_ GIS layers, as described in Table <a href="#tab:tab-SWMMinletusage">98</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfReadSWMM"><tcmd>Read SWMM </tcmd><teq>==<br></teq></a> <tblk>[ &lt;swmm_inp_filename&gt; ]</swmm_inp_filename></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
This command defines the SWMM input (.inp) file for the SWMM simulation. This command can be duplicated to read in multiple SWMM input files. TUFLOW automatically combines the multiple .inp files into a single file for the simulation. If duplicate items, in terms of SWMM item location and “Name”, or alternatively Project–Options, are included in multiple different inp files, the entry that is referenced lowest in the TUFLOW SWMM Control File (TSCF) will be used. See Section <a href="#SWMM-Introduction-2"><strong>??</strong></a> for more details.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tscfSWMMIterations"><tcmd>SWMM Iterations </tcmd><teq>==<br></teq></a> <tblk>[ {1} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Controls the number of SWMM iterations that are run for each 2D timestep. Increasing the number decreases the timestep used by SWMM, potentially improving model stability, though increasing 1D simulation run time. See Section <a href="#OneD2DLinkingSWMM-2"><strong>??</strong></a> for more details.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="ADCFCommands-1"><span class="header-section-number">28</span> ADCF Commands<a href="#ADCFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW Advection Dispersion Control File (.adcf) contains commands related to the TUFLOW Advection Dispersion (AD) Module for simulating depth-averaged, constituent fate and transport. It is read into the .tcf using the <a href="#tcfADControlFile">AD Control File</a> command. For more information on the .tesf see Section <a href="#ADCF-3"><strong>??</strong></a>. The Advection Dispersion module is discussed in Chapter <a href="#AD-1"><strong>??</strong></a>. The available ADCF commands are listed below and are detailed in Table <a href="#tab:tab-ADCFCommands">142</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#adcfADBCDatabase">AD BC Database</a><br />
<a href="#adcfADGlobalDatabase">AD Global Database</a><br />
<a href="#adcfWriteCFL">Write CFL</a><br />
<a href="#adcfWriteIterations">Write Iterations</a><br />
<a href="#adcfWriteMassUnit">Write Mass Unit</a><br />
<a href="#adcfWriteMass">Write Mass</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-ADCFCommands">Table 142: </span><strong>TUFLOW Classic/HPC ADCF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="adcfADGlobalDatabase"><tcmd>AD Global Database </tcmd><teq>==<br></teq></a> <tblk>[ &lt;file&gt; ]</file></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
A pointer to a file containing constituent information (e.g. name and dispersion coefficients). See Section <a href="#ADConstituentProp-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="adcfADBCDatabase"><tcmd>AD BC Database </tcmd><teq>==<br></teq></a> <tblk>[ &lt;file&gt; ]</file></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
A pointer to a file containing boundary database information (e.g. names of boundary files as mapped to GIS datasets read by TUFLOW). See Section <a href="#ADBoundaryConditions-3"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="adcfWriteMass"><tcmd>Write Mass </tcmd><teq>==<br></teq></a> <tblk>[ ON | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
If set to ON, generates a mass conservation commentary output file. See Section <a href="#ADLogMass-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="adcfWriteMassUnit"><tcmd>Write Mass Unit </tcmd><teq>==<br></teq></a> <tblk>[ Kg (or Kilogram) | {Tonne} | Gram ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
Sets the unit for the mass output file if <a href="#adcfWriteMass">Write Mass</a> is set to ON. See Section <a href="#ADLogMass-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="adcfWriteCFL"><tcmd>Write CFL </tcmd><teq>==<br></teq></a> <tblk>[ ON | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
If set to ON, generates a _ADcfl.csv output file with commentary on CFL and Peclet numbers, maximum dispersion coefficients and number of sub-step iterations. See Section <a href="#ADCFLLogFile-4"><strong>??</strong></a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="adcfWriteIterations"><tcmd>Write Iterations </tcmd><teq>==<br></teq></a> <tblk>[ ON | {OFF} ]</tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic Only
</td>
<td style="text-align:left;">
If set to ON, shows information regarding the simulation time for each constituent. In particular, the number of AD sub-steps needed to be
executed to maintain stability under CFL and Peclet conditions is
reported. Additional rows are added as required by the number of
constituents simulated. See Section <a href="#AD-Computational-Timestep-3"><strong>??</strong></a>.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="TEFCommands-1"><span class="header-section-number">29</span> TEF Commands<a href="#TEFCommands-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- Table properties -->
<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<p>The TUFLOW Event File (.tef) contains commands related to Event Management functionality. It is read into the .tcf using the <a href="#tcfEventFile">Event File</a> command. For more information on the .tef, see Section <a href="#TEF-3"><strong>??</strong></a>. Event management is discussed in Section <a href="#Events-3"><strong>??</strong></a>. All commands listed in Appendix <a href="#TCFCommands-1"><strong>??</strong></a> and Appendix <a href="#ECFCommands-1"><strong>??</strong></a> can be read into the .tef. The additional .tef specific commands are listed below and are detailed in Table <a href="#tab:tab-TEFCommands">143</a>.</p>
<!-- lists all commands in table-->
<div style="columns: 3;">
<p><a href="#tefDefineEvent">Define Event</a><br />
<a href="#tefEndDefine">End Define</a></p>
</div>
<p><br></p>
<table>
<caption>
<span id="tab:tab-TEFCommands">Table 143: </span><strong>TUFLOW Classic/HPC TEF Commands</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Command
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Solver
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tefDefineEvent"><tcmd>Define Event </tcmd><teq>==<br></teq></a> <tblk>[ &lt;event_name&gt; ]</event_name></tblk><br>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Starts a block of .tcf and .ecf commands for an event named &lt;event_name&gt;. Only one block can be specified for each unique event_name. Use <a href="#tefEndDefine">End Define</a> to terminate the block. An ERROR occurs
if <a href="#tefEndDefine">End Define</a> is not specified.</p>
For information on Events, see Section <a href="#Events-3"><strong>??</strong></a>. An example of using Events is given in the <a href="https://wiki.tuflow.com/Tutorial_M09">TUFLOW Wiki Tutorial 9</a>. </event_name>
</td>
</tr>
<tr>
<td style="text-align:left;width: 10em; max-width: 24em; vertical-align:top;">
<a id="tefEndDefine"><tcmd>End Define </tcmd></a>
</td>
<td style="text-align:left;vertical-align:top;">
Classic and HPC
</td>
<td style="text-align:left;">
<p>Ends the <a href="#tefDefineEvent">Define Event</a> block of commands. This command must be specified if <a href="#tefDefineEvent">Define Event</a> occurs within the .tef.</p>
For information on Events, see Section <a href="#Events-3"><strong>??</strong></a>. An example of using Events is given in the <a href="https://wiki.tuflow.com/Tutorial_M09">TUFLOW Wiki Tutorial 9</a>.
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="hasAnchor" id="SWMMGeopackage-1"><span class="header-section-number">30</span> SWMM GeoPackage Format<a href="#SWMMGeopackage-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This appendix contains the layers and attributes used in the SWMM GeoPackage format which can be converted to and from EPA SWMM inp files, as discussed in Section <a href="#SWMMGPKGFormat-3"><strong>??</strong></a>.</p>
<h2 class="hasAnchor" id="swmm-geopackage-layer-list"><span class="header-section-number">30.1</span> SWMM GeoPackage Layer List<a href="#swmm-geopackage-layer-list" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Summary">Table 144: </span><strong>SWMM Input layers</strong>
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Category
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Input
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Geometry
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Table
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 2cm; ">
BC
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Inflows">Inflows</a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies external hydrographs and pollutographs that enter the drainage system at specific nodes.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Inflows">145</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Curves
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Curves">Curves </a>
</td>
<td style="text-align:left;width: 7cm; ">
Describes a relationship between two variables in tabular format.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Curves">146</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Curves
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Timeseries">Timeseries </a>
</td>
<td style="text-align:left;width: 7cm; ">
Describes how a quantity varies over time.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Timeseries">147</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Groundwater
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Aquifers">Aquifers </a>
</td>
<td style="text-align:left;width: 7cm; ">
Supplies parameters for each unconfined groundwater aquifer in the study area. Aquifers consist of two
zones – a lower saturated zone and an upper unsaturated zone with a moving boundary between the
two.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Aquifers">148</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Groundwater
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Groundwater">Groundwater </a>
</td>
<td style="text-align:left;width: 7cm; ">
Supplies parameters that determine the rate of groundwater flow between the aquifer underneath a
subcatchment and a node of the conveyance system.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Groundwater">149</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Groundwater
</td>
<td style="text-align:left;width: 2cm; ">
<a id="GWF">GWF </a>
</td>
<td style="text-align:left;width: 7cm; ">
Defines custom groundwater flow equations for specific subcatchments.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-GWF">150</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Adjustments">Adjustments </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies optional monthly adjustments to be made to temperature, evaporation rate, rainfall intensity
and hydraulic conductivity in each time period of a simulation.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Adjustments">151</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Evaporation">Evaporation </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies how daily potential evaporation rates vary with time for the study area.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Evaporation">152</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Hydrographs">Hydrographs </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the shapes of the triangular unit hydrographs that determine the amount of rainfall-dependent infiltration/inflow (RDII) entering the drainage system.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Hydrographs">153</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Patterns">Patterns </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies time patterns of dry weather flow or quality in the form of adjustment factors applied as multipliers to baseline values.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Patterns">154</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Raingages">Raingages </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each rain gage that provides rainfall data for the study area.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Raingages">155</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="RDII">RDII </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the parameters that describe rainfall-dependent infiltration/inflow (RDII) entering the drainage system at specific nodes.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-RDII">156</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Snowpacks">Snowpacks </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies parameters that govern how snowfall accumulates and melts on the plowable, impervious and pervious surfaces of subcatchments.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Snowpacks">157</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Temperature">Temperature </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies daily air temperatures, monthly wind speed, and various snowmelt parameters for the study area. Required only when snowmelt is being modeled or when evaporation rates are computed from daily temperatures or are read from an external climate file.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Temperature">158</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Inlets
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Inlet Usage">Inlet Usage </a>
</td>
<td style="text-align:left;width: 7cm; ">
Assigns inlet structures to specific street and open channel conduits.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Inlet-Usage">159</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Inlets
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Inlets">Inlets </a>
</td>
<td style="text-align:left;width: 7cm; ">
Defines inlet structure designs used to capture street and channel flow that are sent to below ground sewers.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Inlets">160</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
LID
</td>
<td style="text-align:left;width: 2cm; ">
<a id="LidControls">Lid_controls </a>
</td>
<td style="text-align:left;width: 7cm; ">
Defines scale-independent LID controls that can be deployed within subcatchments.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-LID-Controls">161</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
LID
</td>
<td style="text-align:left;width: 2cm; ">
<a id="LidUsage">Lid_usage </a>
</td>
<td style="text-align:left;width: 7cm; ">
Deploys LID controls within specific subcatchment areas.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-LID-Usage">162</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Conduits">Conduits </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each conduit link of the drainage system. Conduits are pipes or channels that convey water from one node to another.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Conduits">163</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Controls">Controls </a>
</td>
<td style="text-align:left;width: 7cm; ">
Determines how pumps and regulators will be adjusted based on simulation time or conditions at specific nodes and links.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Controls">164</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Losses">Losses </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies minor head loss coefficients, flap gates, and seepage rates for conduits.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Contained within Table <a href="#tab:tab-SWMM-Input-Conduits">163</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Orifices">Orifices </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each orifice link of the drainage system. An orifice link serves to limit the flow exiting a node
and is often used to model flow diversions and storage node outlets.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Orifices">165</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Outlets">Outlets </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each outlet flow control device of the drainage system. These are devices used to model
outflows from storage units or flow diversions that have a user-defined
relationship between flow rate and
water depth.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Outlets">166</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Pumps">Pumps </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each pump link of the drainage system.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Pumps">167</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Streets">Streets </a>
</td>
<td style="text-align:left;width: 7cm; ">
Describes the cross-section geometry of conduits that represent streets.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Streets">168</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Transects">Transects </a>
</td>
<td style="text-align:left;width: 7cm; ">
Describes the cross-section geometry of natural channels or conduits with irregular shapes following the HEC-2 data format.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Transects">169</a> and Table <a href="#tab:tab-SWMM-Input-Transects-Coords">170</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Weirs">Weirs </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each weir link of the drainage system. Weirs are used to model flow diversions and storage
node outlets.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Weirs">171</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Links
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Xsections">Xsections </a>
</td>
<td style="text-align:left;width: 7cm; ">
Provides cross-section
geometric data for conduit and regulator links of the drainage system.
</td>
<td style="text-align:left;width: 2cm; ">
Line
</td>
<td style="text-align:left;width: 2cm; ">
Contained within Table <a href="#tab:tab-SWMM-Input-Conduits">163</a>, Table <a href="#tab:tab-SWMM-Input-Orifices">165</a> and Table <a href="#tab:tab-SWMM-Input-Weirs">171</a>.
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Nodes
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Dividers">Dividers </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each flow divider node of the drainage system. Flow dividers are junctions with exactly two outflow conduits where the total outflow is divided between the two in a prescribed manner.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Dividers">172</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Nodes
</td>
<td style="text-align:left;width: 2cm; ">
<a id="DWF">DWF </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies dry weather flow and its quality entering the drainage system at specific nodes.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-DWF">173</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Nodes
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Junctions">Junctions </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each junction node of the drainage system. Junctions are points in space where channels and pipes connect together. For sewer systems they can be either connection fittings or manholes.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Junctions">174</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Nodes
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Outfalls">Outfalls </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each outfall node (i.e., final downstream boundary) of the drainage system and the corresponding water stage elevation. Only one link can be incident on an outfall node.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Outfalls">175</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Nodes
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Storage">Storage </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each storage node of the drainage system. Storage nodes can have any shape as specified by a surface area versus water depth relation.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Storage">176</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Project
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Files">Files </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies optional interface files used or saved by a run.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Files">177</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Project
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Options">Options </a>
</td>
<td style="text-align:left;width: 7cm; ">
Provides values for various analysis options.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Options">178</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Project
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Report">Report </a>
</td>
<td style="text-align:left;width: 7cm; ">
Describes the contents of the report file that SWMM produces.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Report">179</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Project
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Title">Title </a>
</td>
<td style="text-align:left;width: 7cm; ">
Attaches a descriptive title to the project being analyzed.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Title">180</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Infiltration">Infiltration </a>
</td>
<td style="text-align:left;width: 7cm; ">
Supplies infiltration parameters for each subcatchment. Rainfall lost to infiltration only occurs over the
pervious subarea
of a subcatchment.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Contained within Table <a href="#tab:tab-SWMM-Input-Subcatchments">181</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Subareas">Subareas </a>
</td>
<td style="text-align:left;width: 7cm; ">
Supplies information about pervious and impervious areas for each subcatchment. Each subcatchment
can consist of a pervious subarea,
an impervious subarea
with depression storage, and an impervious
subarea
without depression storage.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Contained within Table <a href="#tab:tab-SWMM-Input-Subcatchments">181</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
Hydrology
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Subcatchments">Subcatchments </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies each subcatchment within the study area. Subcatchments are land area units that generate
runoff from rainfall.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Subcatchments">181</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Buildup">Buildup </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the rate that pollutants build up over different land uses between rain events.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Buildup">182</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Coverages">Coverages </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the percentage of a subcatchment’s area that is covered by each category of land use.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Coverages">183</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Landuses">Landuses </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies the various categories of land uses within the drainage area. Each subcatchment area can be assigned a different mix of land uses. Each land use can be subjected to a different street sweeping schedule. Land uses are only used in conjunction with pollutant buildup and wash off.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Landuses">184</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Loadings">Loadings </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the pollutant buildup that exists on each subcatchment at the start of a simulation.
</td>
<td style="text-align:left;width: 2cm; ">
Region
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Loadings">185</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Pollutants">Pollutants </a>
</td>
<td style="text-align:left;width: 7cm; ">
Identifies the pollutants being analyzed.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Pollutants">186</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Treatment">Treatment </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the degree of treatment received by pollutants at specific nodes of the drainage system.
</td>
<td style="text-align:left;width: 2cm; ">
Point
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Treatment">187</a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2cm; ">
WQ
</td>
<td style="text-align:left;width: 2cm; ">
<a id="Washoff">Washoff </a>
</td>
<td style="text-align:left;width: 7cm; ">
Specifies the rate at which pollutants are washed off from different land uses during rain events.
</td>
<td style="text-align:left;width: 2cm; ">
No Geometry
</td>
<td style="text-align:left;width: 2cm; ">
Table <a href="#tab:tab-SWMM-Input-Washoff">188</a>
</td>
</tr>
</tbody>
</table>
<h2 class="hasAnchor" id="swmm-geopackage-layer-descriptions"><span class="header-section-number">30.2</span> SWMM GeoPackage Layer Descriptions<a href="#swmm-geopackage-layer-descriptions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Inflows">Table 145: </span><strong>Inflows</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the node where external inflow enters.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
FLOW or &lt;name of a pollutant&gt;. </name>
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Tseries
</td>
<td style="text-align:left;width: 8cm; ">
Name of a time series in the <a href="#Timeseries">TIMESERIES</a> section describing how external flow or pollutant loading varies with time.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
PollutType
</td>
<td style="text-align:left;width: 8cm; ">
<p>&lt;name of a pollutant&gt;:</p>
<ul>
<li>CONCEN: if pollutant inflow is described as a concentration (default).</li>
<li>MASS: if it is described as a mass flow rate.</li>
</ul>
FLOW: Not Used. </name>
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Mfactor
</td>
<td style="text-align:left;width: 8cm; ">
The factor that converts the inflow’s mass flow rate units into the project’s mass units per second, where the project’s mass units are those specified for the pollutant in the <a href="#Pollutants">POLLUTANTS</a> section (default is 1.0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
SeriesType
</td>
<td style="text-align:left;width: 8cm; ">
CONCEN if pollutant is described as a concentration, MASS if it is described as a mass flow rate (default is CONCEN)
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Factor1
</td>
<td style="text-align:left;width: 8cm; ">
Generally 1 for FLOW; Mfactor for Pollutant - the factor that converts the inflow’s mass flow rate units into the project’s mass units per second, where the project’s mass units are those specified for the pollutant in the [POLLUTANTS] section (default is 1.0)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Sfactor
</td>
<td style="text-align:left;width: 8cm; ">
A scaling factor that multiplies the recorded time series values (default is 1.0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Base
</td>
<td style="text-align:left;width: 8cm; ">
A constant baseline value added to the time series value (default is 0.0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Pat
</td>
<td style="text-align:left;width: 8cm; ">
Name of an optional time pattern in the <a href="#Patterns">PATTERNS</a> section used to adjust the baseline value on a periodic basis.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Curves">Table 146: </span><strong>Curves</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the curve.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
The type of curve being defined: STORAGE / SHAPE / DIVERSION / TIDAL / PUMP1 / PUMP2 / PUMP3 / PUMP4 / PUMP5 / RATING / CONTROL / WEIR.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
xval
</td>
<td style="text-align:left;width: 8cm; ">
An X (independent variable) value.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
yval
</td>
<td style="text-align:left;width: 8cm; ">
The Y (dependent variable) value corresponding to X.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Timeseries">Table 147: </span><strong>Timeseries</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the time series.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Frame
</td>
<td style="text-align:left;width: 8cm; ">
The name of a file in which the time series data are stored.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Date
</td>
<td style="text-align:left;width: 8cm; ">
Date in Month/Day/Year format (e.g., June 15, 2001 would be 6/15/2001).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Time
</td>
<td style="text-align:left;width: 8cm; ">
Hours since the start of the simulation, expressed as a decimal number or as hours:minutes (where hours can be greater than 24).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Value
</td>
<td style="text-align:left;width: 8cm; ">
A value corresponding to the specified date and time.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Aquifers">Table 148: </span><strong>Aquifers</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to aquifer.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Por
</td>
<td style="text-align:left;width: 8cm; ">
Soil porosity (pore space volume / total volume).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
WP
</td>
<td style="text-align:left;width: 8cm; ">
Soil wilting point (moisture content of a fully dried soil).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
FC
</td>
<td style="text-align:left;width: 8cm; ">
Soil field capacity (moisture content of a fully drained soil).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Ksat
</td>
<td style="text-align:left;width: 8cm; ">
Saturated hydraulic conductivity (in/hr or mm/hr).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Kslope
</td>
<td style="text-align:left;width: 8cm; ">
Slope of the logarithm of hydraulic conductivity versus moisture deficit (porosity minus moisture content) curve (dimensionless).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Tslope
</td>
<td style="text-align:left;width: 8cm; ">
Slope of soil tension versus moisture content curve (inches or mm).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
ETu
</td>
<td style="text-align:left;width: 8cm; ">
Fraction of total evaporation available for evapotranspiration in the upper unsaturated zone.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
ETs
</td>
<td style="text-align:left;width: 8cm; ">
Maximum depth into the lower saturated zone over which evapotranspiration can occur (ft or m).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Seep
</td>
<td style="text-align:left;width: 8cm; ">
Seepage rate from saturated zone to deep groundwater when water table is at ground surface (in/hr or mm/hr).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Ebot
</td>
<td style="text-align:left;width: 8cm; ">
Elevation of the bottom of the aquifer (ft or m). Local values can be assigned to specific subcatchments in the <a href="#Groundwater">GROUNDWATER</a> section.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Egw
</td>
<td style="text-align:left;width: 8cm; ">
Groundwater table elevation at start of simulation (ft or m). Local values can be assigned to specific subcatchments in the <a href="#Groundwater">GROUNDWATER</a> section.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Umc
</td>
<td style="text-align:left;width: 8cm; ">
Unsaturated zone moisture content at start of simulation (volumetric fraction). Local values can be assigned to specific subcatchments in the <a href="#Groundwater">GROUNDWATER</a> section.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
ETupat
</td>
<td style="text-align:left;width: 8cm; ">
Name of optional monthly time pattern used to adjust the upper zone evaporation fraction for different months of the year.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Groundwater">Table 149: </span><strong>Groundwater</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Subcatchment
</td>
<td style="text-align:left;width: 8cm; ">
Subcatchment name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Aquifer
</td>
<td style="text-align:left;width: 8cm; ">
Name of groundwater aquifer underneath the subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of a node in the conveyance system exchanging groundwater with the aquifer.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Esurf
</td>
<td style="text-align:left;width: 8cm; ">
Surface elevation of the subcatchment (ft or m).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
A1
</td>
<td style="text-align:left;width: 8cm; ">
Groundwater flow coefficient (see Equation <a href="#eq:equ-SWMM-lateral-GW-flow">(70)</a> below).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
B1
</td>
<td style="text-align:left;width: 8cm; ">
Groundwater flow exponent (see Equation <a href="#eq:equ-SWMM-lateral-GW-flow">(70)</a> below).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
A2
</td>
<td style="text-align:left;width: 8cm; ">
Surface water flow coefficient (see Equation <a href="#eq:equ-SWMM-lateral-GW-flow">(70)</a> below).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
B2
</td>
<td style="text-align:left;width: 8cm; ">
Surface water flow exponent (see Equation <a href="#eq:equ-SWMM-lateral-GW-flow">(70)</a> below).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
A3
</td>
<td style="text-align:left;width: 8cm; ">
Surface water – groundwater interaction coefficient (see Equation <a href="#eq:equ-SWMM-lateral-GW-flow">(70)</a> below).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Dsw
</td>
<td style="text-align:left;width: 8cm; ">
Fixed depth of surface water at the receiving node (ft or m) (set to zero if surface water depth will vary as computed by flow routing).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Egwt
</td>
<td style="text-align:left;width: 8cm; ">
Threshold groundwater table elevation which must be reached before any flow occurs (ft or m). Leave blank (or enter *) to use the elevation of the receiving node’s invert.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Ebot
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Elevation of the bottom of the aquifer (ft or m). Can be used to override the values supplied for the subcatchment’s aquifer.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Wgr
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Groundwater table elevation at the start of the simulation (ft or m). Can be used to override the values supplied for the subcatchment’s aquifer.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
Umc
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Unsaturated zone moisture content at start of simulation (volumetric fraction). Can be used to override the values supplied for the subcatchment’s aquifer.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<p>The flow coefficients are used in the following equation that determines the lateral groundwater flow rate based on groundwater and surface water elevations:</p>
<span class="math display" id="eq:equ-SWMM-lateral-GW-flow">\[\begin{equation}
Q_{L}  =  A1 (H_{gw}  –  H_{cb})^{B1}  –  A2 (H_{sw}  –  H_{cb})^{B2}  +  A3 H_{gw} H_{sw}
\tag{70}
\end{equation}\]</span>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Q_{L}\)</span> = lateral groundwater flow (cfs per acre or cms per hectare),</li>
<li><span class="math inline">\(H_{gw}\)</span> = height of saturated zone above the bottom of the aquifer (ft or m),</li>
<li><span class="math inline">\(H_{sw}\)</span> = height of surface water at the receiving node above the aquifer bottom (ft or m),</li>
<li><span class="math inline">\(H_{cb}\)</span> = height of the channel bottom above the aquifer bottom (ft or m).</li>
</ul>
<table>
<caption>
<span id="tab:tab-SWMM-Input-GWF">Table 150: </span><strong>GWF</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Subcatchment
</td>
<td style="text-align:left;width: 8cm; ">
Subcatchment name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
<p>Lateral: to designate an expression for Lateral groundwater flow (to a node of the conveyance network).</p>
Deep: for vertical loss to Deep groundwater
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Expr
</td>
<td style="text-align:left;width: 8cm; ">
<p>A math formula expressing the rate of groundwater flow (in cfs per acre for lateral flow or in/hr for deep flow (cms per hectare and mm/hr if using metric units) as a function of the following variables:</p>
<ul>
<li>Hgw: for height of the groundwater table</li>
<li>Hsw: for height of the surface water</li>
<li>Hcb: for height of the channel bottom</li>
<li>Hgs: for height of ground surface</li>
</ul>
<p>Where all heights are relative to the aquifer bottom and have units of either feet or meters (if using metric units):</p>
<ul>
<li>Ks: for saturated hydraulic conductivity in in/hr or mm/hr</li>
<li>K: for unsaturated hydraulic conductivity in in/hr or mm/hr</li>
<li>Theta: for moisture content of the unsaturated zone</li>
<li>Phi: for aquifer soil porosity</li>
<li>Fi: for infiltration rate from the ground surface in in/hr or mm/hr</li>
<li>Fu: for percolation rate from the upper unsaturated zone in in/hr or mm/hr</li>
<li>A: for subcatchment area in acres or hectares
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table></li>
</ul>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Adjustments">Table 151: </span><strong>Adjustments</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Format
</td>
<td style="text-align:left;width: 8cm; ">
<p>Temperature: t1..t12</p>
<p>Evaporation: e1..e12</p>
<p>Rainfall: r1..r12</p>
Conductivity: c1..c12
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Month1
</td>
<td style="text-align:left;width: 8cm; ">
<p>t1: adjustments to temperature in January, as plus or minus degrees F (degrees C if using metric units).</p>
<p>e1: adjustments to evaporation rate in January, as plus or minus in/day (mm/day if using metric units).</p>
<p>r1: multipliers applied to precipitation rate in January.</p>
c1: multipliers applied to soil hydraulic conductivity in January used in either Horton or Green-Ampt infiltration.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Month2
</td>
<td style="text-align:left;width: 8cm; ">
As above, for February.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Month3
</td>
<td style="text-align:left;width: 8cm; ">
As above, for March.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Month4
</td>
<td style="text-align:left;width: 8cm; ">
As above, for April.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Month5
</td>
<td style="text-align:left;width: 8cm; ">
As above, for May.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Month6
</td>
<td style="text-align:left;width: 8cm; ">
As above, for June.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Month7
</td>
<td style="text-align:left;width: 8cm; ">
As above, for July.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Month8
</td>
<td style="text-align:left;width: 8cm; ">
As above, for August.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Month9
</td>
<td style="text-align:left;width: 8cm; ">
As above, for September.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Month10
</td>
<td style="text-align:left;width: 8cm; ">
As above, for October.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Month11
</td>
<td style="text-align:left;width: 8cm; ">
As above, for November.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Month12
</td>
<td style="text-align:left;width: 8cm; ">
As above, for December.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Evaporation">Table 152: </span><strong>Evaporation</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Format
</td>
<td style="text-align:left;width: 8cm; ">
<p>CONSTANT: applies a constant evaporation rate.</p>
<p>MONTHLY: applies a constant evaporation rate per month.</p>
<p>TIMESERIES: applies the specified timeseries.</p>
<p>TEMPERATURE: indicates that evaporation rates will be computed from the daily air temperatures contained in an external climate file whose name is provided in the <a href="#Temperature">TEMPERATURE</a> section. This method also uses the site’s latitude, which can also be specified in the <a href="#Temperature">TEMPERATURE</a> section.</p>
<p>FILE: indicates that evaporation data will be read directly from the same external climate file used for air temperatures as specified in the <a href="#Temperature">TEMPERATURE</a> section. Supplying monthly pan coefficients for these data is optional.</p>
<p>RECOVERY: identifies an optional monthly time pattern of multipliers used to modify infiltration recovery rates during dry periods. For example, if the normal infiltration recovery rate was 1% during a specific time period and a pattern factor of 0.8 applied to this period, then the actual recovery rate would be 0.8%.</p>
<p>DRY_ONLY: determines if evaporation only occurs during periods with no precipitation. The default is NO.</p>
Note: The evaporation rates provided in this section are potential rates. The actual amount of water evaporated will depend on the amount available as a simulation progresses.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Evap
</td>
<td style="text-align:left;width: 8cm; ">
CONSTANT: constant evaporation rate (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
e1
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in January (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
e2
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in February (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
e3
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in March (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
e4
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in April (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
e5
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in May (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
e6
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in June (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
e7
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in July (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
e8
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in August (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
e9
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in September (in/day or mm/day).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
e10
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in October (in/day or mm/day if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
e11
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in November (in/day or mm/day if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
e12
</td>
<td style="text-align:left;width: 8cm; ">
MONTHLY: evaporation rate in December (in/day or mm/day if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
Tseries
</td>
<td style="text-align:left;width: 8cm; ">
TIMESERIES: name of a time series in the <a href="#Timeseries">TIMESERIES</a> section with evaporation data.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
p1
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for January.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
p2
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for February.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
p3
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for March.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
19
</td>
<td style="text-align:left;width: 2cm; ">
p4
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for April.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
20
</td>
<td style="text-align:left;width: 2cm; ">
p5
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for May.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
21
</td>
<td style="text-align:left;width: 2cm; ">
p6
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for June.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
22
</td>
<td style="text-align:left;width: 2cm; ">
p7
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for July.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
23
</td>
<td style="text-align:left;width: 2cm; ">
p8
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for August.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
24
</td>
<td style="text-align:left;width: 2cm; ">
p9
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for September.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
25
</td>
<td style="text-align:left;width: 2cm; ">
p10
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for October.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
26
</td>
<td style="text-align:left;width: 2cm; ">
p11
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for November.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
27
</td>
<td style="text-align:left;width: 2cm; ">
p12
</td>
<td style="text-align:left;width: 8cm; ">
FILE: pan coefficient for December.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
28
</td>
<td style="text-align:left;width: 2cm; ">
patternID
</td>
<td style="text-align:left;width: 8cm; ">
RECOVERY: Name of a monthly time pattern.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
29
</td>
<td style="text-align:left;width: 2cm; ">
Value
</td>
<td style="text-align:left;width: 8cm; ">
DRY_ONLY: Yes or No. Determines if evaporation only occurs during periods with no precipitation. The Default is No. 
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Hydrographs">Table 153: </span><strong>Hydrographs</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to a unit hydrograph group.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
RaingageOrMonth
</td>
<td style="text-align:left;width: 8cm; ">
Name of the rain gage used by the unit hydrograph group or month of the year (e.g., JAN, FEB, etc. or ALL for all months).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Term
</td>
<td style="text-align:left;width: 8cm; ">
<p>Three separate unit hydrographs, that represent the short-term, medium-term, and long-term RDII responses, can be defined for each month (or all months taken together).</p>
Use either SHORT, MEDIUM, or LONG.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
R
</td>
<td style="text-align:left;width: 8cm; ">
Response ratio for the unit hydrograph. The response ratio (R) is the fraction of a unit of rainfall depth that becomes RDII. The sum of the ratios for a set of three hydrographs does not have to equal 1.0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
T
</td>
<td style="text-align:left;width: 8cm; ">
Time to peak (hours) for the unit hydrograph.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
K
</td>
<td style="text-align:left;width: 8cm; ">
Recession limb ratio for the unit hydrograph. The recession limb ratio (K) is the ratio of the duration of the hydrograph’s recession limb to the time to peak (T) making the hydrograph time base equal to T*(1+K) hours. The area under each unit hydrograph is 1 inch (or mm if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Dmax
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Maximum initial abstraction depth available (in rain depth units). If not supplied then the default is no initial abstraction.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Drec
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Initial abstraction recovery rate (in rain depth units per day). If not supplied then the default is no initial abstraction.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
D0
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Initial abstraction depth already filled at the start of the simulation (in rain depth units). If not supplied then the default is no initial abstraction.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Patterns">Table 154: </span><strong>Patterns</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name used to identify the pattern.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Interval
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: Used to set monthly pattern factors for dry weather flow constituents.</p>
<p>DAILY: Used to set dry weather pattern factors for each day of the week, where Sunday is day 1.</p>
<p>HOURLY: Used to set dry weather factors for each hour of the day starting from midnight.</p>
<p>WEEKEND: If these factors are different for weekend days than for weekday days then the WEEKEND format can be used to specify hourly adjustment factors just for weekends.</p>
More than one line can be used to enter a pattern’s factors by repeating the pattern’s name (but not the pattern type) at the beginning of each additional line. The pattern factors are applied as multipliers to any baseline dry weather flows or quality concentrations supplied in the <a href="#DWF">DWF</a> section.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Factor1
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for January</p>
<p>DAILY: factor for Sunday</p>
HOURLY: factor for 0:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Factor2
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for February</p>
<p>DAILY: factor for Monday</p>
HOURLY: factor for 1:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Factor3
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for March</p>
<p>DAILY: factor for Tuesday</p>
HOURLY: factor for 2:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Factor4
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for April</p>
<p>DAILY: factor for Wednesday</p>
HOURLY: factor for 3:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Factor5
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for May</p>
<p>DAILY: factor for Thursday</p>
HOURLY: factor for 4:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Factor6
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for June</p>
<p>DAILY: factor for Friday</p>
HOURLY: factor for 5:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Factor7
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for July</p>
<p>DAILY: factor for Saturday</p>
HOURLY: factor for 6:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Factor8
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for August</p>
<p>DAILY: not used.</p>
HOURLY: factor for 7:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Factor9
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for September</p>
<p>DAILY: not used.</p>
HOURLY: factor for 8:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Factor10
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for October</p>
<p>DAILY: not used.</p>
HOURLY: factor for 9:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Factor11
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for November</p>
<p>DAILY: not used.</p>
HOURLY: factor for 10:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
Factor12
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY: factor for December</p>
<p>DAILY: not used.</p>
HOURLY: factor for 11:00AM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
Factor13
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 12:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
Factor14
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 13:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
Factor15
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 14:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
Factor16
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 15:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
19
</td>
<td style="text-align:left;width: 2cm; ">
Factor17
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 16:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
20
</td>
<td style="text-align:left;width: 2cm; ">
Factor18
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 17:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
21
</td>
<td style="text-align:left;width: 2cm; ">
Factor19
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 18:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
22
</td>
<td style="text-align:left;width: 2cm; ">
Factor20
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 19:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
23
</td>
<td style="text-align:left;width: 2cm; ">
Factor21
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 20:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
24
</td>
<td style="text-align:left;width: 2cm; ">
Factor22
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 21:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
25
</td>
<td style="text-align:left;width: 2cm; ">
Factor23
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 22:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
26
</td>
<td style="text-align:left;width: 2cm; ">
Factor24
</td>
<td style="text-align:left;width: 8cm; ">
<p>MONTHLY and DAILY: not used.</p>
HOURLY: factor for 23:00PM.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Raingages">Table 155: </span><strong>Raingages</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to rain gage.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Form
</td>
<td style="text-align:left;width: 8cm; ">
Form of recorded rainfall, either INTENSITY, VOLUME or CUMULATIVE.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Intvl
</td>
<td style="text-align:left;width: 8cm; ">
Time interval between gage readings in decimal hours or hours:minutes format (e.g., 0:15 for 15-minute readings).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
SnowCatchDeficiency
</td>
<td style="text-align:left;width: 8cm; ">
Snow catch deficiency correction factor (use 1.0 for no adjustment).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Format
</td>
<td style="text-align:left;width: 8cm; ">
Either TIMESERIES or FILE.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Tseries
</td>
<td style="text-align:left;width: 8cm; ">
TIMESERIES: Name of a time series in the <a href="#Timeseries">TIMESERIES</a> section with rainfall data.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Fname
</td>
<td style="text-align:left;width: 8cm; ">
FILE: Name of an external file with rainfall data. Enclose the external file name in double quotes if it contains spaces and include its full path if it resides in a different directory than the SWMM input file.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Sta
</td>
<td style="text-align:left;width: 8cm; ">
FILE: Name of the recording station in a user-prepared formatted rain file. Only required when using a user-prepared formatted rainfall file.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Units
</td>
<td style="text-align:left;width: 8cm; ">
FILE: Rain depth units for the data in a user-prepared formatted rain file, either inches or millimeters if using metric units. Only required when using a user-prepared formatted rainfall file.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-RDII">Table 156: </span><strong>RDII</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of a node receiving RDII flow.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
UHgroup
</td>
<td style="text-align:left;width: 8cm; ">
Name of an RDII unit hydrograph group appearing in the <a href="#Hydrographs">HYDROGRAPHS</a> section.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
SewerArea
</td>
<td style="text-align:left;width: 8cm; ">
Area of the sewershed that contributes RDII to the node (acres or hectares if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Snowpacks">Table 157: </span><strong>Snowpacks</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to snowpack parameter set .
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE: contains parameters for the impervious area of a subcatchment that is subject to snow removal by plowing but not to areal depletion. This area is the fraction SNN0 of the total impervious area.</p>
<p>IMPERVIOUS: contains parameter values for the remaining impervious area.</p>
<p>PERVIOUS: contains parameter values for the entire pervious area.</p>
<p>REMOVAL: describes how snow removed from the plowable area is transferred onto other areas.</p>
The various transfer fractions should sum to no more than 1.0. If the line is omitted then no snow removal takes place.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Cmin
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE, IMPERVIOUS and PERVIOUS: Minimum melt coefficient (in/hr-deg F or mm/hr-deg C if using metric units).</p>
REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Cmax
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE, IMPERVIOUS and PERVIOUS: Maximum melt coefficient (in/hr-deg F or mm/hr-deg C if using metric units).</p>
REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Tbase
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE, IMPERVIOUS and PERVIOUS: Snow melt base temperature (deg F or deg C if using metric units).</p>
REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
FWF
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE, IMPERVIOUS and PERVIOUS: Ratio of free water holding capacity to snow depth (fraction).</p>
REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
SD0
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE, IMPERVIOUS and PERVIOUS: Initial snow depth (water equivalent in or mm if using metric units).</p>
REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
FW0
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE, IMPERVIOUS and PERVIOUS: Initial free water in pack (in or mm if using metric units).</p>
REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
SNN0
</td>
<td style="text-align:left;width: 8cm; ">
<p>PLOWABLE: Fraction of impervious area that can be plowed.</p>
IMPERVIOUS, PERVIOUS and REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
SD100
</td>
<td style="text-align:left;width: 8cm; ">
<p>IMPERVIOUS and PERVIOUS: Snow depth above which there is 100% cover (water equivalent in or mm if using metric units).</p>
PLOWABLE and REMOVAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Dplow
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Depth of snow on plowable areas at which snow removal begins (in or mm if using metric units).</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Fout
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Fraction of snow on plowable area transferred out of watershed.</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Fimp
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Fraction of snow on plowable area transferred to impervious area by plowing.</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
Fperv
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Fraction of snow on plowable area transferred to pervious area by plowing.</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
Fimelt
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Fraction of snow on plowable area converted into immediate melt.</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
Fsub
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Fraction of snow on plowable area transferred to pervious area in another subcatchment.</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
Scatch
</td>
<td style="text-align:left;width: 8cm; ">
<p>REMOVAL: Name of subcatchment receiving the Fsub fraction of transferred snow.</p>
PLOWABLE, IMPERVIOUS and PERVIOUS: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Temperature">Table 158: </span><strong>Temperature</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Option
</td>
<td style="text-align:left;width: 8cm; ">
<p>Available options:</p>
<ul>
<li>FILE</li>
<li>WINDSPEED MONTHLY</li>
<li>SNOWMELT</li>
<li>ADC IMPERVIOUS</li>
<li>ADC PERVIOUS
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Value
</td>
<td style="text-align:left;width: 8cm; ">
Name of file or relevent value. Add additional value columns when required.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table></li>
</ul>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Inlet-Usage">Table 159: </span><strong>Inlet Usage</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Conduit
</td>
<td style="text-align:left;width: 8cm; ">
Name of a street or open channel conduit containing the inlet.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Inlet
</td>
<td style="text-align:left;width: 8cm; ">
Name of an inlet structure (from the <a href="#Inlets">INLETS</a> section) to use.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the sewer node receiving flow captured by the inlet.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Number
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Number of replicate inlets placed on each side of the street. Default is 1 (for each side of a two-sided street).
</td>
<td style="text-align:left;width: 1cm; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
PctClogged
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Degree to which inlet capacity is reduced due to clogging (%). Default is 0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Qmax
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Maximum flow that the inlet can capture (flow units). A Qmax value of 0 indicates that the inlet has no flow restriction. Default is 0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
aLocal
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Height of local gutter depression (in or mm). Default is 0. The local gutter depression applies only over the length of the inlet unlike the continuous depression for a STREET cross section which exists over the full curb length.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
wLocal
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Width of local gutter depression (ft or m). Default is 0. The local gutter depression applies only over the length of the inlet unlike the continuous depression for a STREET cross section which exists over the full curb length.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Placement
</td>
<td style="text-align:left;width: 8cm; ">
Optional. AUTOMATIC, ON_GRADE, or ON_SAG. The default inlet placement is AUTOMATIC, meaning that the program uses the network topography to determine whether an inlet operates on-grade or on-sag. On-grade means the inlet is located on a continuous grade. On-sag means the inlet is located at a sag or sump point where all adjacent conduits slope towards the inlet leaving no place for water to flow except into the inlet.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Inlets">Table 160: </span><strong>Inlets</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the inlet structure.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
Set either GRATE, DROP_GRATE, CURB, DROP_CURB, SLOTTED or CUSTOM.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Grate_Length
</td>
<td style="text-align:left;width: 8cm; ">
GRATE: length of the inlet parallel to the street curb (ft or m).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Grate_Width
</td>
<td style="text-align:left;width: 8cm; ">
GRATE: width of a GRATE inlet (ft or m).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Grate_Type
</td>
<td style="text-align:left;width: 8cm; ">
<p>GRATE: type of GRATE used, options availabe:</p>
<ul>
<li>P_BAR-50: Parallel bar grate with bar spacing 1-7/8-in on center.</li>
<li>P_BAR-50X100: Parallel bar grate with bar spacing 1-7/8-in on center and 3/8-in diameter lateral rods spaced at 4-in on center.</li>
<li>P_BAR-30: Parallel bar grate with 1-1/8-in on center bar spacing.</li>
<li>CURVED_VANE: Curved vane grate with 3-1/4-in longitudinal bar and 4-1/4-in transverse bar spacing on center.</li>
<li>TILT_BAR-45: 45 degree tilt bar grate with 2-1/4-in longitudinal bar and 4-in transverse bar spacing on center.</li>
<li>TILT_BAR-30: 30 degree tilt bar grate with 3-1/4-in and 4-in on center longitudinal and lateral bar spacing respectively.</li>
<li>RETICULINE: “Honeycomb” pattern of lateral bars and longitudinal bearing bars.</li>
<li>GENERIC: A generic grate design.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Grate_Aopen
</td>
<td style="text-align:left;width: 8cm; ">
GRATE: if type is GENERIC, fraction of grate’s area that is open.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Grate_vsplash
</td>
<td style="text-align:left;width: 8cm; ">
GRATE: if type is GENERIC, splash over velocity (ft/s or m/s if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Curb_Length
</td>
<td style="text-align:left;width: 8cm; ">
CURB: length of the inlet parallel to the street curb (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Curb_Height
</td>
<td style="text-align:left;width: 8cm; ">
CURB: height of a opening inlet (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Curb_Throat
</td>
<td style="text-align:left;width: 8cm; ">
CURB: the throat angle of a CURB opening inlet (HORIZONTAL, INCLINED or VERTICAL).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Slotted_Length
</td>
<td style="text-align:left;width: 8cm; ">
SLOTTED: length of a SLOTTED inlet (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Slotted_Width
</td>
<td style="text-align:left;width: 8cm; ">
SLOTTED: width of a SLOTTED inlet (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Custom_Curve
</td>
<td style="text-align:left;width: 8cm; ">
CUSTOM: name of a Rating-type curve (captured flow v. water depth).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table></li>
</ul>
<p><link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css"></p>
<script type="text/javascript" charset="utf8" src="js/jquery.dataTables.js">
<script src="js/jquery-2.1.2.min.js"></script>
<script type="text/javascript">
         $(document).ready(function() {
             $("table").DataTable( {
              "pageLength": -1
             });
         } );
</script>
<table>
<caption>
<span id="tab:tab-SWMM-Input-LID-Controls">Table 161: </span><strong>LID Controls</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to LID process.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC for bio-retention cell</p>
<p>RG for rain garden</p>
<p>GR for green roof</p>
<p>IT for infiltration trench</p>
<p>PP for permeable pavement</p>
<p>RB for rain barrel</p>
<p>RD for rooftop disconnection</p>
VS for vegetative swale
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
surface_StorHt
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, IT, PP, RD, VS: When confining walls or berms are present this is the maximum depth to which water can pond above the surface of the unit before overflow occurs (in inches or mm). For LIDs that experience overland flow it is the height of any surface depression storage. For swales, it is the height of its trapezoidal cross-section.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
surface_VegFrac
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, IT, PP, RD, VS: Fraction of the surface storage volume that is filled with vegetation.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
surface_Rough
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, IT, PP, RD, VS: Manning’s coefficient (n) for overland flow over surface soil cover, pavement, roof surface or a vegetative swale. Use 0 for other types of LIDs. If value is 0 then any ponded water that exceeds the surface storage depth is assumed to completely overflow the LID control within a single time step.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
surface_Slope
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, IT, PP, RD, VS: slope of a roof surface, pavement surface or vegetative swale (percent). Use 0 for other types of LIDs. If value is 0 then any ponded water that exceeds the surface storage depth is assumed to completely overflow the LID control within a single time step.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
surface_Xslope
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, IT, PP, RD, VS: slope (run over rise) of the side walls of a vegetative swale’s cross-section. Use 0 for other types of LIDs.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
soil_Thick
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Thickness of the soil layer (inches or mm if using metric units). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
soil_Por
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Soil porosity (pore space volume / total volume). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
soil_FC
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Soil field capacity (moisture content of a fully drained soil). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
soil_WP
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Soil wilting point (moisture content of a fully dried soil). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
soil_Ksat
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Soil’s saturated hydraulic conductivity (in/hr or mm/hr if using metric units). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
soil_Kcoeff
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Slope of the curve of log (conductivity) versus soil moisture deficit (porosity minus soil moisture) (dimensionless). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
soil_Suct
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, RG, GR, PP: Soil capillary suction (in or mm if using metric units). Optional for PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
pavement_Thick
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: Thickness of the pavement layer (inches or mm if using metric units).</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
pavement_Vratio
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: Void ratio (volume of void space relative to the volume of solids in the pavement for continuous systems or for the fill material used in modular systems). Note that porosity = void ratio / (1 + void ratio).</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
pavement_FracImp
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: Ratio of impervious paver material to total area for modular systems; 0 for continuous porous pavement systems.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
pavement_Perm
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: Permeability of the concrete or asphalt used in continuous systems or hydraulic conductivity of the fill material (gravel or sand) used in modular systems (in/hr or mm/hr).</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
19
</td>
<td style="text-align:left;width: 2cm; ">
pavement_Vclog
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: the number of pavement layer void volumes of runoff treated it takes to completely clog the pavement. Use a value of 0 to ignore clogging.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
20
</td>
<td style="text-align:left;width: 2cm; ">
pavement_Treg
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: The number of days that the pavement layer is allowed to clog before its permeability is restored, typically by vacuuming its surface. A value of 0 (the default) indicates that no permeability regeneration occurs.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
21
</td>
<td style="text-align:left;width: 2cm; ">
pavement_Freg
</td>
<td style="text-align:left;width: 8cm; ">
<p>PP: The fractional degree to which the pavement’s permeability is restored when a regeneration interval is reached. The default is 0 (no restoration) while a value of 1 indicates complete restoration to the original permeability value. Once regeneration occurs the pavement begins to clog once again at a rate determined by Vclog.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
22
</td>
<td style="text-align:left;width: 2cm; ">
storage_Height
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, IT, PP, RB: Thickness of the storage layer or height of a rain barrel (inches or mm if using metric units).</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
23
</td>
<td style="text-align:left;width: 2cm; ">
storage_Vratio
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, IT, PP, RB: void ratio (volume of void space relative to the volume of solids in the layer). Note that porosity = void ratio / (1 + void ratio).</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
24
</td>
<td style="text-align:left;width: 2cm; ">
storage_Seepage
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, IT, PP, RB: The rate at which water seeps from the layer into the underlying native soil when first constructed (in/hr or mm/hr if using metric units). If there is an impermeable floor or liner below the layer then use a value of 0.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
25
</td>
<td style="text-align:left;width: 2cm; ">
storage_Vclog
</td>
<td style="text-align:left;width: 8cm; ">
BC, IT, PP, RB: Number of storage layer void volumes of runoff treated it takes to completely clog the layer. Use a value of 0 to ignore clogging.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
26
</td>
<td style="text-align:left;width: 2cm; ">
storage_Covrd
</td>
<td style="text-align:left;width: 8cm; ">
<p>BC, IT, PP, RB: YES (the default) if a rain barrel is covered, NO if it is not.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
27
</td>
<td style="text-align:left;width: 2cm; ">
drain_Coeff
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: Coefficient C that determines the rate of flow through the drain as a function of height of stored water above the drain bottom. For Rooftop Disconnection it is the maximum flow rate (in inches/hour or mm/hour if using metric units) that the roof’s gutters and downspouts can handle before overflowing. Optional for BC, IT, PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
28
</td>
<td style="text-align:left;width: 2cm; ">
drain_Expon
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: Exponent n that determines the rate of flow through the drain as a function of height of stored water above the drain outlet. Optional for BC, IT, PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
29
</td>
<td style="text-align:left;width: 2cm; ">
drain_Offset
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: Height of the drain line above the bottom of the storage layer or rain barrel (inches or mm if using metric units). Optional for BC, IT, PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
30
</td>
<td style="text-align:left;width: 2cm; ">
drain_Delay
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: Number of dry weather hours that must elapse before the drain line in a rain barrel is opened (the line is assumed to be closed once rainfall begins). A value of 0 signifies that the barrel’s drain line is always open and drains continuously.  This parameter is ignored for other types of LIDs.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
31
</td>
<td style="text-align:left;width: 2cm; ">
drain_Hopen
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: The height of water  (in inches or mm) in the drain’s Storage Layer that causes the drain to automatically open. Use 0 to disable this feature. Optional for BC, IT, PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
32
</td>
<td style="text-align:left;width: 2cm; ">
drain_Hclose
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: The height of water (in inches or mm) in the drain’s Storage Layer that causes the drain to automatically close. Use 0 to disable this feature. Optional for BC, IT, PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
33
</td>
<td style="text-align:left;width: 2cm; ">
drain_Qcrv
</td>
<td style="text-align:left;width: 8cm; ">
<p>RB, RD, BC, IT, PP: The name of an optional Control Curve that adjusts the computed drain flow as a function of the head of water above the drain. Leave blank if not applicable. Optional for BC, IT, PP.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
34
</td>
<td style="text-align:left;width: 2cm; ">
drainmat_Thick
</td>
<td style="text-align:left;width: 8cm; ">
<p>GR: Thickness of the drainage mat (inches or mm if using metric units).</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
35
</td>
<td style="text-align:left;width: 2cm; ">
drainmat_Vratio
</td>
<td style="text-align:left;width: 8cm; ">
<p>GR: Ratio of void volume to total volume in the mat.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
36
</td>
<td style="text-align:left;width: 2cm; ">
drainmat_Rough
</td>
<td style="text-align:left;width: 8cm; ">
<p>GR: Manning’s coefficient (n) used to compute the horizontal flow rate of drained water through the mat.</p>
All other types: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-LID-Usage">Table 162: </span><strong>LID Usage</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Subcatchment
</td>
<td style="text-align:left;width: 8cm; ">
Name of the subcatchment using the LID process.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
LID
</td>
<td style="text-align:left;width: 8cm; ">
Name of a LID process defined in the <a href="#LidControls">LID_CONTROLS</a> section.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Number
</td>
<td style="text-align:left;width: 8cm; ">
Number of replicate LID units deployed.
</td>
<td style="text-align:left;width: 1cm; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Area
</td>
<td style="text-align:left;width: 8cm; ">
Area of each replicate unit (ft<sup>2</sup> or m<sup>2</sup> if using metric units)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Width
</td>
<td style="text-align:left;width: 8cm; ">
Width of the outflow face of each identical LID unit (in ft or m if using metric units). This parameter applies to roofs, pavement, trenches, and swales that use overland flow to convey surface runoff off of the unit. It can be set to 0 for other LID processes, such as bio-retention cells, rain gardens, and rain barrels that simply spill any excess captured runoff over their berms.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
InitSat
</td>
<td style="text-align:left;width: 8cm; ">
The percent to which the LID’s soil, storage, and drain mat zones are initially filled with water. For soil zones 0 % saturation corresponds to the wilting point moisture content while 100 % saturation has the moisture content equal to the porosity.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
FromImp
</td>
<td style="text-align:left;width: 8cm; ">
The percent of the impervious portion of the subcatchment’s non-LID area whose runoff is treated by the LID practice. (E.g., if rain barrels are used to capture roof runoff and roofs represent 60% of the impervious area, then the impervious area treated is 60%). If the LID unit treats only direct rainfall, such as with a green roof, then this value should be 0. If the LID takes up the entire subcatchment then this field is ignored.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
ToPerv
</td>
<td style="text-align:left;width: 8cm; ">
A value of 1 indicates that the surface and drain flow from the LID unit should be routed back onto the pervious area of the subcatchment that contains it. This would be a common choice to make for rain barrels, rooftop disconnection, and possibly green roofs. The default value is 0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
RptFile
</td>
<td style="text-align:left;width: 8cm; ">
Optional name of a file to which detailed time series results for the LID will be written. Enclose the name in double quotes if it contains spaces and include its full path if it resides in a different directory than the SWMM input file. Use ’*’ if not applicable and an entry for DrainTo or FromPerv follows
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
DrainTo
</td>
<td style="text-align:left;width: 8cm; ">
Optional name of subcatchment or node that receives flow from the unit’s drain line, if different from the outlet of the subcatchment that the LID is placed in. Use ’*’ if not applicable and an entry for FromPerv follows.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
FromPerv
</td>
<td style="text-align:left;width: 8cm; ">
Optional percent of the pervious portion of the subcatchment’s non-LID area whose runoff is treated by the LID practice. The default value is 0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Conduits">Table 163: </span><strong>Conduits</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to conduit link.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
From Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the conduit’s upstream node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
To Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the conduit’s downstream node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Length
</td>
<td style="text-align:left;width: 8cm; ">
Conduit length (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Roughness
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s roughness coefficient (n).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
InOffset
</td>
<td style="text-align:left;width: 8cm; ">
Offset of the conduit’s upstream end above the invert of its upstream node (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
OutOffset
</td>
<td style="text-align:left;width: 8cm; ">
Offset of the conduit’s downstream end above the invert of its downstream node (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
InitFlow
</td>
<td style="text-align:left;width: 8cm; ">
Flow in the conduit at the start of the simulation (flow units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
MaxFlow
</td>
<td style="text-align:left;width: 8cm; ">
Maximum flow allowed in the conduit (flow units) (default is no limit).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
xsec_XsecType
</td>
<td style="text-align:left;width: 8cm; ">
<p>A cross-section shape, the available shapes include:</p>
Circular, Force_main, Filled_circular2, Rect_closed, Rect_open, Trapezoidal, Triangular, Horiz_ellipse, Vert_ellipse, Arch, Parabolic, Power, Rect_triangular, Rect_round, Modbaskethandle, Egg, Horseshoe, Gothic, Catenary, Semielliptical, Baskethandle, Semicircular, Custom.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom1
</td>
<td style="text-align:left;width: 8cm; ">
<p>Circular, Force_main, Filled_circular2: Diameter (ft or m if using metric units)</p>
All other shapes: Full height of the cross-section (ft or m if using metric units)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom2
</td>
<td style="text-align:left;width: 8cm; ">
<p>Modbaskethandle and Trapezoidal: Base Width</p>
<p>Arch, Horiz_ellipse and Vert_ellipse: Max. Width</p>
<p>Force_main: Roughness</p>
<p>Filled_circular2: Sediment depth</p>
<p>Custom: Shape curve</p>
<p>Parabolic, Power, Rect_closed, Rect_open, Rect_round, Rect_triangular, Triangular: Top width</p>
All other shapes: Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom3
</td>
<td style="text-align:left;width: 8cm; ">
<p>Rect_Round: Bottom Radius</p>
<p>Power: Exponent</p>
<p>Trapezoidal: Left Slope</p>
<p>Vert_ellipse and Horiz_ellipse: Size Code</p>
<p>Arch: Size Code</p>
<p>ModBasketHandle: Top Radius</p>
<p>Rect_Triangular: Triangle Height</p>
All other shapes: Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom4
</td>
<td style="text-align:left;width: 8cm; ">
<p>Trapezoidal: Right slope</p>
All other shapes: Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Barrels
</td>
<td style="text-align:left;width: 8cm; ">
Number of barrels (i.e., number of parallel pipes of equal size, slope, and roughness) associated with a conduit (default is 1).
</td>
<td style="text-align:left;width: 1cm; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Culvert
</td>
<td style="text-align:left;width: 8cm; ">
Code number from Table A.10 for the conduit’s inlet geometry if it is a culvert subject to possible inlet flow control (leave blank otherwise).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Curve
</td>
<td style="text-align:left;width: 8cm; ">
Name of a Shape Curve in the <a href="#Curves">CURVES</a> section that defines how cross-section width varies with depth.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Tsect
</td>
<td style="text-align:left;width: 8cm; ">
Name of an entry in the <a href="#Transects">TRANSECTS</a> section that describes the cross-section geometry of an irregular channel.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
19
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Street
</td>
<td style="text-align:left;width: 8cm; ">
Name of an entry in the <a href="#Streets">STREETS</a> section that describes the cross-section geometry of a street.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
20
</td>
<td style="text-align:left;width: 2cm; ">
losses_Kentry
</td>
<td style="text-align:left;width: 8cm; ">
Minor head loss coefficient at the conduit’s entrance.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
21
</td>
<td style="text-align:left;width: 2cm; ">
losses_Kexit
</td>
<td style="text-align:left;width: 8cm; ">
Minor head loss coefficient at the conduit’s exit.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
22
</td>
<td style="text-align:left;width: 2cm; ">
losses_Kavg
</td>
<td style="text-align:left;width: 8cm; ">
Average minor head loss coefficient across the length of the conduit.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
23
</td>
<td style="text-align:left;width: 2cm; ">
losses_Flap
</td>
<td style="text-align:left;width: 8cm; ">
YES if the conduit has a flap valve that prevents back flow, NO otherwise. (Default is NO).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
24
</td>
<td style="text-align:left;width: 2cm; ">
losses_Seepage
</td>
<td style="text-align:left;width: 8cm; ">
Rate of seepage loss into the surrounding soil (in/hr or mm/hr if using metric units). (Default is 0.)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Controls">Table 164: </span><strong>Controls</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Text
</td>
<td style="text-align:left;width: 8cm; ">
Determines how pumps and regulators will be adjusted based on simulation time or conditions at specific nodes and links.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Orifices">Table 165: </span><strong>Orifices</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to orifice link.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
From Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the orifice’s inlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
To Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the orifice’s outlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
The type of orifice - either SIDE if oriented in a vertical plane or BOTTOM if oriented in a horizontal plane.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Offset
</td>
<td style="text-align:left;width: 8cm; ">
Amount that a Side Orifice’s bottom or the position of a Bottom Orifice is offset above the invert of inlet node (ft or m, expressed as either a depth or as an elevation, depending on the LINK_OFFSETS option setting).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Qcoeff
</td>
<td style="text-align:left;width: 8cm; ">
Discharge coefficient (unitless).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Gated
</td>
<td style="text-align:left;width: 8cm; ">
YES if a flap gate prevents reverse flow, NO if not (default is NO).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
CloseTime
</td>
<td style="text-align:left;width: 8cm; ">
Time in decimal hours to open a fully closed orifice (or close a fully open one). Use 0 if the orifice can open/close instantaneously.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
xsec_XsecType
</td>
<td style="text-align:left;width: 8cm; ">
The only allowable shapes are CIRCULAR and RECT_CLOSED (closed rectangular).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom1
</td>
<td style="text-align:left;width: 8cm; ">
<p>Circular: Diameter (ft or m)</p>
Rect_Closed: Full height of the cross-section (ft or m if using metric units)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom2
</td>
<td style="text-align:left;width: 8cm; ">
<p>Circular: Not used</p>
Rect_closed: Top width
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom3
</td>
<td style="text-align:left;width: 8cm; ">
Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom4
</td>
<td style="text-align:left;width: 8cm; ">
Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Barrels
</td>
<td style="text-align:left;width: 8cm; ">
Number of barrels (i.e., number of parallel pipes of equal size, slope, and roughness) associated with a conduit (default is 1).
</td>
<td style="text-align:left;width: 1cm; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Culvert
</td>
<td style="text-align:left;width: 8cm; ">
Code number from Table A.10 for the conduit’s inlet geometry if it is a culvert subject to possible inlet flow control (leave blank otherwise).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Curve
</td>
<td style="text-align:left;width: 8cm; ">
Name of a Shape Curve in the <a href="#Curves">CURVES</a> section that defines how cross-section width varies with depth.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Tsect
</td>
<td style="text-align:left;width: 8cm; ">
Name of an entry in the <a href="#Transects">TRANSECTS</a> section that describes the cross-section geometry of an irregular channel.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Street
</td>
<td style="text-align:left;width: 8cm; ">
Name of an entry in the <a href="#Streets">STREETS</a> section that describes the cross-section geometry of a street.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Outlets">Table 166: </span><strong>Outlets</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to outlet link.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
From Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the outlet’s inlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
To Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the outlet’s outlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Offset
</td>
<td style="text-align:left;width: 8cm; ">
Amount that the outlet is offset above the invert of its inlet node (ft or m, expressed as either a depth or as an elevation, depending on the LINK_OFFSETS option setting).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
TABULAR/DEPTH, TABULAR/HEAD, FUNCTIONAL/DEPTH, FUNCTIONAL/HEAD
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
QCurve
</td>
<td style="text-align:left;width: 8cm; ">
Name of the rating curve listed in the <a href="#Curves">CURVES</a> section that describes outflow rate (flow units) as a function of:
- water depth above the offset elevation at the inlet node (ft or m if using metric units) for a TABULAR/DEPTH outlet.
- head difference (ft or m) between the inlet and outflow nodes for a TABULAR/HEAD outlet.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
C1
</td>
<td style="text-align:left;width: 8cm; ">
Coefficient of a power function that relates outflow to:
- water depth (ft or m if using metric units) above the offset elevation at the inlet node for a FUNCTIONAL/DEPTH outlet.
- head difference  (ft or m if using metric units) between the inlet and outflow nodes for a FUNCTIONAL/HEAD outlet.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
C2
</td>
<td style="text-align:left;width: 8cm; ">
Exponent of a power function that relates outflow to:
- water depth (ft or m if using metric units) above the offset elevation at the inlet node for a FUNCTIONAL/DEPTH outlet.
- head difference  (ft or m if using metric units) between the inlet and outflow nodes for a FUNCTIONAL/HEAD outlet.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Gated
</td>
<td style="text-align:left;width: 8cm; ">
YES if a flap gate prevents reverse flow, NO if not (default is NO).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Pumps">Table 167: </span><strong>Pumps</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to pump link.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
From Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the pump’s inlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
To Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the pump’s outlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Pcurve
</td>
<td style="text-align:left;width: 8cm; ">
<p>Name of a pump curve listed in the <a href="#Curves">CURVES</a> section of the input. A pump curve describes the relation between a pump’s flow rate and conditions at its inlet and outlet nodes. The following types of pump curves are supported:</p>
<ul>
<li>Type1: An off-line pump with a wet well where flow increases incrementally with available wet well volume.</li>
<li>Type2: An in-line pump where flow increases incrementally with inlet node depth.</li>
<li>Type3: An in-line pump where flow varies continuously with head difference between the inlet and outlet nodes.</li>
<li>Type4: A variable speed in-line pump where flow varies continuously with inlet node depth.</li>
<li>Type5: A variable speed version of the Type3 pump where the head v. flow curve shifts position as the speed setting changes.</li>
<li>Ideal: A transfer pump that does not require a pump curve and is used mainly for preliminary design. Its flow rate equals the inflow rate to its inlet node no matter what the head difference is between its inlet and outlet nodes. Use an asterisk (*) as the value for Pcurve.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Status
</td>
<td style="text-align:left;width: 8cm; ">
Pump’s status at the start of the simulation (either ON or OFF; default is ON).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Startup
</td>
<td style="text-align:left;width: 8cm; ">
Depth at the inlet node when the pump turns on (ft or m if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Shutoff
</td>
<td style="text-align:left;width: 8cm; ">
Depth at inlet node when the pump shuts off (ft or m if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table></li>
</ul>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Streets">Table 168: </span><strong>Streets</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the street cross-section.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Tcrown
</td>
<td style="text-align:left;width: 8cm; ">
Distance from street’s curb to its crown (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Hcurb
</td>
<td style="text-align:left;width: 8cm; ">
Curb height (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Sx
</td>
<td style="text-align:left;width: 8cm; ">
Street cross slope (%).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
nRoad
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s roughness coefficient (n) of the road surface
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
a
</td>
<td style="text-align:left;width: 8cm; ">
Gutter depression height (in or mm if using metric units) (default = 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
W
</td>
<td style="text-align:left;width: 8cm; ">
Depressed gutter width (ft or m if using metric units) (default = 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Sides
</td>
<td style="text-align:left;width: 8cm; ">
1 for single sided street or 2 for two-sided street (default = 2).
</td>
<td style="text-align:left;width: 1cm; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Tback
</td>
<td style="text-align:left;width: 8cm; ">
Street backing width (ft or m if using metric units) (default = 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Sback
</td>
<td style="text-align:left;width: 8cm; ">
Street backing slope (%) (default = 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
nBack
</td>
<td style="text-align:left;width: 8cm; ">
Street backing Manning’s roughness coefficient (n) (default = 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Transects">Table 169: </span><strong>Transects</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the transect.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Xleft
</td>
<td style="text-align:left;width: 8cm; ">
Station position which ends the left overbank portion of the channel (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Xright
</td>
<td style="text-align:left;width: 8cm; ">
Station position which begins the right overbank portion of the channel (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Lfactor
</td>
<td style="text-align:left;width: 8cm; ">
Meander modifier that represents the ratio of the length of a meandering main channel to the length of the overbank area that surrounds it (use 0 if not applicable).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Wfactor
</td>
<td style="text-align:left;width: 8cm; ">
Factor by which distances between stations should be multiplied to increase (or decrease) the width of the channel (enter 0 if not applicable).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Eoffset
</td>
<td style="text-align:left;width: 8cm; ">
Amount to be added (or subtracted) from the elevation of each station (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Nleft
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s roughness coefficient (n) of right overbank portion of channel (use 0 if no change from previous NC line).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Nright
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s roughness coefficient (n) of right overbank portion of channel (use 0 if no change from previous NC line.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Nchan1
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s roughness coefficient (n) of main channel portion of channel (use 0 if no change from previous NC line.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Transects-Coords">Table 170: </span><strong>Transects Coordinates</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the transect.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Elev
</td>
<td style="text-align:left;width: 8cm; ">
Elevation of the channel bottom at a cross-section station relative to some fixed reference (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Station
</td>
<td style="text-align:left;width: 8cm; ">
Distance of a cross-section station from some fixed reference (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Weirs">Table 171: </span><strong>Weirs</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to weir link.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
From Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the weir’s inlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
To Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the weir’s outlet node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
TRANSVERSE, SIDEFLOW, V-NOTCH, TRAPEZOIDAL or ROADWAY.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
CrestHt
</td>
<td style="text-align:left;width: 8cm; ">
Amount that the weir’s opening is offset above the invert of inlet node (ft or m if using metric units, expressed as either a depth or as an elevation, depending on the LINK_OFFSETS option setting).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Cd
</td>
<td style="text-align:left;width: 8cm; ">
Weir discharge coefficient (for CFS if using US flow units or CMS if using metric flow units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Gated
</td>
<td style="text-align:left;width: 8cm; ">
YES if a flap gate prevents reverse flow, NO if not (default is NO).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
EC
</td>
<td style="text-align:left;width: 8cm; ">
Number of end contractions for a TRANSVERSE or TRAPEZOIDAL weir (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Cd2
</td>
<td style="text-align:left;width: 8cm; ">
Discharge coefficient for the triangular ends of a TRAPEZOIDAL weir (for CFS if using US flow units or CMS if using metric flow units) (default is the value of Cd).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Sur
</td>
<td style="text-align:left;width: 8cm; ">
YES if the weir can surcharge (have an upstream water level higher than the height of the weir’s opening); NO if it cannot (default is YES).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Road_Width
</td>
<td style="text-align:left;width: 8cm; ">
Applies only to ROADWAY weirs. Width of road lanes and shoulders for a ROADWAY weir (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Road_Surf
</td>
<td style="text-align:left;width: 8cm; ">
Applies only to ROADWAY weirs. Type of road surface for a ROADWAY weir: PAVED or GRAVEL.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
xsec_XsecType
</td>
<td style="text-align:left;width: 8cm; ">
<p>A cross-section shape. The following shapes must be used with each type of weir:</p>
<ul>
<li>Transverse: RECT_OPEN</li>
<li>Sideflow: RECT_OPEN</li>
<li>V-Notch: TRIANGULAR</li>
<li>Trapezoidal: TRAPEZOIDAL</li>
<li>Roadway: RECT_OPEN</li>
</ul>
The ROADWAY weir is a broad crested rectangular weir used model roadway crossings usually in conjunction with culvert-type conduits. It uses the FHWA HDS-5 method to determine a discharge coefficient as a function of flow depth and roadway width and surface. If no roadway data are provided then the weir behaves as a TRANSVERSE weir with Cd as its discharge coefficient. Note that if roadway data are provided, then values for the other optional weir parameters (NO for Gated, 0 for EC, 0 for Cd2, and NO for Sur) must be entered even though they do not apply to ROADWAY weirs.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom1
</td>
<td style="text-align:left;width: 8cm; ">
Full height of the cross-section (ft or m if using metric units)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom2
</td>
<td style="text-align:left;width: 8cm; ">
<p>Trapezoidal: Base Width</p>
Rect_open and Triangular: Top width
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom3
</td>
<td style="text-align:left;width: 8cm; ">
<p>Trapezoidal: Left Slope</p>
Rect_open and Triangular: Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Geom4
</td>
<td style="text-align:left;width: 8cm; ">
<p>Trapezoidal: Right slope</p>
All other shapes: Not used
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Barrels
</td>
<td style="text-align:left;width: 8cm; ">
Number of barrels (i.e., number of parallel pipes of equal size, slope, and roughness) associated with a conduit (default is 1).
</td>
<td style="text-align:left;width: 1cm; ">
Integer
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
19
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Culvert
</td>
<td style="text-align:left;width: 8cm; ">
Code number from Table A.10 for the conduit’s inlet geometry if it is a culvert subject to possible inlet flow control (leave blank otherwise).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
20
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Curve
</td>
<td style="text-align:left;width: 8cm; ">
Name of a Shape Curve in the <a href="#Curves">CURVES</a> section that defines how cross-section width varies with depth.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
21
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Tsect
</td>
<td style="text-align:left;width: 8cm; ">
Name of an entry in the <a href="#Transects">TRANSECTS</a> section that describes the cross-section geometry of an irregular channel.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
22
</td>
<td style="text-align:left;width: 2cm; ">
xsec_Street
</td>
<td style="text-align:left;width: 8cm; ">
Name of an entry in the <a href="#Streets">STREETS</a> section that describes the cross-section geometry of a street.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Dividers">Table 172: </span><strong>Dividers</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to divider node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Elev
</td>
<td style="text-align:left;width: 8cm; ">
Node’s invert elevation (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
DivLink
</td>
<td style="text-align:left;width: 8cm; ">
Name of the link to which flow is diverted.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
OVERFLOW:
CUTOFF:
TABULAR:
WEIR:
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Qmin
</td>
<td style="text-align:left;width: 8cm; ">
<p>CUTOFF and WEIR: flow at which diversion begins (flow units).</p>
OVERFLOW and TABULAR: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Dcurve
</td>
<td style="text-align:left;width: 8cm; ">
<p>TABULAR: name of a curve that relates diverted flow to total flow.</p>
OVERFLOW, CUTOFF and WEIR: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Ht
</td>
<td style="text-align:left;width: 8cm; ">
<p>WEIR: height of a WEIR divider (ft or m).</p>
OVERFLOW, CUTOFF and TABULAR: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
Cd
</td>
<td style="text-align:left;width: 8cm; ">
<p>WEIR: discharge coefficient for a WEIR divider.</p>
OVERFLOW, CUTOFF and TABULAR: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
Ymax
</td>
<td style="text-align:left;width: 8cm; ">
OVERFLOW, CUTOFF, TABULAR and WEIR: depth from the ground to the node’s invert elevation (ft or m if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Y0
</td>
<td style="text-align:left;width: 8cm; ">
OVERFLOW, CUTOFF, TABULAR and WEIR: water depth at the start of the simulation (ft or m if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Ysur
</td>
<td style="text-align:left;width: 8cm; ">
OVERFLOW, CUTOFF, TABULAR and WEIR: maximum additional pressure head above the ground elevation that the node can sustain under surcharge conditions (ft or m if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Apond
</td>
<td style="text-align:left;width: 8cm; ">
OVERFLOW, CUTOFF, TABULAR and WEIR: area subjected to surface ponding once water depth exceeds Ymax + Ysur  (ft<sup>2</sup> or m<sup>2</sup> if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-DWF">Table 173: </span><strong>DWF</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of a node where dry weather flow enters.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
Keyword FLOW for flow or a pollutant name for a quality constituent.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Base
</td>
<td style="text-align:left;width: 8cm; ">
Average baseline value for corresponding constituent  (flow or concentration units). The actual dry weather input will equal the product of the baseline value and any adjustment factors supplied by the specified patterns. If not supplied, an adjustment factor defaults to 1.0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Pat1
</td>
<td style="text-align:left;width: 8cm; ">
Name of first time pattern appearing in the <a href="#Patterns">PATTERNS</a> section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the <a href="#Patterns">PATTERNS</a> section for more details.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Pat2
</td>
<td style="text-align:left;width: 8cm; ">
Name of second time pattern appearing in the <a href="#Patterns">PATTERNS</a> section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the <a href="#Patterns">PATTERNS</a> section for more details.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Pat3
</td>
<td style="text-align:left;width: 8cm; ">
Name of third time pattern appearing in the <a href="#Patterns">PATTERNS</a> section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the <a href="#Patterns">PATTERNS</a> section for more details.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Pat4
</td>
<td style="text-align:left;width: 8cm; ">
Name of fourth time pattern appearing in the <a href="#Patterns">PATTERNS</a> section. The patterns can be any combination of monthly, daily, hourly and weekend hourly patterns, listed in any order. See the <a href="#Patterns">PATTERNS</a> section for more details.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Junctions">Table 174: </span><strong>Junctions</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to junction node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Elev
</td>
<td style="text-align:left;width: 8cm; ">
Elevation of the junction’s invert (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Ymax
</td>
<td style="text-align:left;width: 8cm; ">
<p>Depth from ground to invert elevation (ft or m if using metric units). Default is 0.</p>
If Ymax is 0 then SWMM sets the junction’s maximum depth to the distance from its invert to the top of the highest connecting link.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Y0
</td>
<td style="text-align:left;width: 8cm; ">
Water depth at the start of the simulation (ft or m if using metric units). Default is 0.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Ysur
</td>
<td style="text-align:left;width: 8cm; ">
<p>Maximum additional pressure head above the ground elevation that the junction can sustain under surcharge conditions (ft or m if using metric units). Default is 0.</p>
If the junction is part of a force main section of the system then set Ysur to the maximum pressure that the system can sustain.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Apond
</td>
<td style="text-align:left;width: 8cm; ">
<p>Area subjected to surface ponding once water depth exceeds Ymax + Ysur (ft<sup>2</sup> or m<sup>2</sup> if using metric units). Default is 0.</p>
Surface ponding can only occur when Apond is non-zero and the ALLOW_PONDING analysis option is turned on.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Outfalls">Table 175: </span><strong>Outfalls</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to outfall node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Elev
</td>
<td style="text-align:left;width: 8cm; ">
Node’s invert elevation (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Type
</td>
<td style="text-align:left;width: 8cm; ">
Use either FREE, NORMAL, FIXED, TIDAL or TIMESERIES.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Stage
</td>
<td style="text-align:left;width: 8cm; ">
<p>FIXED: Elevation of a fixed stage outfall (ft or m).</p>
FREE, NORMAL, TIDAL and TIMESERIES: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
Tcurve
</td>
<td style="text-align:left;width: 8cm; ">
<p>TIDAL: Name of a curve in the <a href="#Curves">CURVES</a> section containing tidal height (i.e., outfall stage) v. hour of day over a complete tidal cycle.</p>
FREE, NORMAL, FIXED and TIMESERIES: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Tseries
</td>
<td style="text-align:left;width: 8cm; ">
<p>TIMESERIES: Name of a time series in <a href="#Timeseries">TIMESERIES</a> section that describes how outfall stage varies with time.</p>
FREE, NORMAL, FIXED and TIDAL: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Gated
</td>
<td style="text-align:left;width: 8cm; ">
YES or NO depending on whether a flap gate is present that prevents reverse flow. The default is NO.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
RouteTo
</td>
<td style="text-align:left;width: 8cm; ">
Optional. Name of a subcatchment that receives the outfall’s discharge. The default is not to route the outfall’s discharge.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Storage">Table 176: </span><strong>Storage</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to storage node.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Elev
</td>
<td style="text-align:left;width: 8cm; ">
Node’s invert elevation (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Ymax
</td>
<td style="text-align:left;width: 8cm; ">
Water depth when the storage node is full (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Y0
</td>
<td style="text-align:left;width: 8cm; ">
Water depth at the start of the simulation (ft or m if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
TYPE
</td>
<td style="text-align:left;width: 8cm; ">
<p>TABULAR:</p>
<p>FUNCTIONAL:</p>
<p>CYLINDRICAL:</p>
<p>CONICAL:</p>
<p>PARABOLOID:</p>
PYRAMIDAL:
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Acurve
</td>
<td style="text-align:left;width: 8cm; ">
Name of a curve in the <a href="#Curves">CURVES</a> section that relates surface area (ft<sup>2</sup> or m<sup>2</sup> if using metric units) to depth (ft or m if using metric units) for TABULAR geometry.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
A1
</td>
<td style="text-align:left;width: 8cm; ">
Coefficient of a FUNCTIONAL relation between surface area and depth. Where Area = A0 + A1*Depth<sup>A2</sup>.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
A2
</td>
<td style="text-align:left;width: 8cm; ">
Exponent of a FUNCTIONAL relation between surface area and depth.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
A0
</td>
<td style="text-align:left;width: 8cm; ">
Constant of a FUNCTIONAL relation between surface area and depth.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
L
</td>
<td style="text-align:left;width: 8cm; ">
<p>CYLINDRICAL: major axis length</p>
<p>CONICAL: major axis length of base</p>
<p>PARABOLOID: major axis length at full height</p>
PYRAMIDAL: base length
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
W
</td>
<td style="text-align:left;width: 8cm; ">
<p>CYLINDRICAL: major axis width</p>
<p>CONICAL: major axis width of base</p>
<p>PARABOLOID: minor axis width at full height</p>
PYRAMIDAL: base width
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Z
</td>
<td style="text-align:left;width: 8cm; ">
<p>CYLINDRICAL: Not Used.</p>
<p>CONICAL: side slope (run/rise)</p>
<p>PARABOLOID: full height</p>
PYRAMIDAL: side slope (run/rise)
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Ysur
</td>
<td style="text-align:left;width: 8cm; ">
Maximum additional pressure head above full depth that a closed storage unit can sustain under surcharge conditions (ft or m if using metric units) (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
Fevap
</td>
<td style="text-align:left;width: 8cm; ">
Fraction of potential evaporation from the storage unit’s water surface realized (default is 0).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
Psi
</td>
<td style="text-align:left;width: 8cm; ">
Optional seepage parameters for soil surrounding the storage unit. Suction head (inches or mm if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
Ksat
</td>
<td style="text-align:left;width: 8cm; ">
Optional seepage parameters for soil surrounding the storage unit. Saturated hydraulic conductivity  (in/hr or mm/hr if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
IMD
</td>
<td style="text-align:left;width: 8cm; ">
Optional seepage parameters for soil surrounding the storage unit. Initial moisture deficit (porosity minus moisture content) (fraction).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Files">Table 177: </span><strong>Files</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Operation
</td>
<td style="text-align:left;width: 8cm; ">
<p>Set if the interface file is to be used or saved by a run:</p>
<ul>
<li><p>USE</p></li>
<li><p>SAVE</p>
</td>
<td style="text-align:left;width: 1cm; ">
<p>Char</p>
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
<p>2</p>
</td>
<td style="text-align:left;width: 2cm; ">
<p>Filetype</p>
</td>
<td style="text-align:left;width: 8cm; ">
<p>The different types of interface files that are currently available include:</p></li>
<li><p>RAINFALL: rainfall interface file (USE / SAVE operation)</p></li>
<li><p>RUNOFF: runoff interface file (USE / SAVE operation)</p></li>
<li><p>HOTSTART: hot start file (USE / SAVE operation)</p></li>
<li><p>RDII: RDII interface file (USE / SAVE operation)</p></li>
<li><p>INFLOWS: routing interface files (USE operation only)</p></li>
<li><p>OUTFLOWS: routing interface files (SAVE operation only)</p></li>
</ul>
Rainfall, Runoff, and RDII files can either be used or saved in a run, but not both. A run can both use and save a Hot Start file (with different names).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Filename
</td>
<td style="text-align:left;width: 8cm; ">
The name of an interface file. Enclose the external file name in double quotes if it contains spaces and include its full path if it resides in a different directory than the SWMM input file.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Options">Table 178: </span><strong>Options</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Option
</td>
<td style="text-align:left;width: 8cm; ">
<p>FLOW_UNITS makes a choice of flow units. Selecting a US flow unit means that all other quantities will be expressed in US customary units, while choosing a metric flow unit will force all quantities to be expressed in SI metric units. (Exceptions are pollutant concentration and Manning’s roughness coefficient (n) which are always in metric units). The default is CFS.</p>
<p>INFILTRATION selects a model for computing infiltration of rainfall into the upper soil zone of subcatchments. The default model is HORTON.</p>
<p>FLOW_ROUTING determines which method is used to route flows through the drainage system. STEADY refers to sequential steady state routing (i.e. hydrograph translation), KINWAVE to kinematic wave routing, DYNWAVE to dynamic wave routing. The default routing method is DYNWAVE.</p>
<p>LINK_OFFSETS determines the convention used to specify the position of a link offset above the invert of its connecting node. DEPTH indicates that offsets are expressed as the distance between the node invert and the link while ELEVATION indicates that the absolute elevation of the offset is used. The default is DEPTH.</p>
<p>FORCE_MAIN_EQUATION establishes whether the Hazen-Williams (H-W) or the Darcy-Weisbach (D-W) equation will be used to compute friction losses for pressurized flow in conduits that have been assigned a Circular Force Main cross-section shape. The default is H-W.</p>
<p>IGNORE_RAINFALL is set to YES if all rainfall data and runoff calculations should be ignored. In this case SWMM only performs flow and pollutant routing based on user-supplied direct and dry weather inflows. The default is NO.</p>
<p>IGNORE_SNOWMELT is set to YES if snowmelt calculations should be ignored when a project file contains snow pack objects. The default is NO.</p>
<p>IGNORE_GROUNDWATER is set to YES if groundwater calculations should be ignored when a project file contains aquifer objects. The default is NO.</p>
<p>IGNORE_RDII is set to YES if rainfall dependent inflow/infiltration should be ignored when RDII unit hydrographs and RDII inflows have been supplied to a project file. The default is NO.</p>
<p>IGNORE_ROUTING is set to YES if only runoff should be computed even if the project contains drainage system links and nodes. The default is NO.</p>
<p>IGNORE_QUALITY is set to YES if pollutant washoff, routing, and treatment should be ignored in a project that has pollutants defined. The default is NO.</p>
<p>ALLOW_PONDING determines whether excess water is allowed to collect atop nodes and be re-introduced into the system as conditions permit. The default is NO ponding. In order for ponding to actually occur at a particular node, a non-zero value for its Ponded Area attribute must be used.</p>
<p>SKIP_STEADY_STATE should be set to YES if flow routing computations should be skipped during steady state periods of a simulation during which the last set of computed flows will be used. A time step is considered to be in steady state if the percent difference between total system inflow and total system outflow is below the SYS_FLOW_TOL and the percent difference between current and previous lateral inflows are below the LAT_FLOW_TOL. The default for this option is NO.</p>
<p>SYS_FLOW_TOL is the maximum percent difference between total system inflow and total system outflow which can occur in order for the SKIP_STEADY_STATE option to take effect. The default is 5 percent.</p>
<p>LAT_FLOW_TOL is the maximum percent difference between the current and previous lateral inflow at all nodes in the conveyance system in order for the SKIP_STEADY_STATE option to take effect. The default is 5 percent.</p>
<p>START_DATE is the date when the simulation begins. If not supplied, a date of 2004-01-01 is used.</p>
<p>START_TIME is the time of day on the starting date when the simulation begins. The default is 12 midnight (0:00:00).</p>
<p>END_DATE is the date when the simulation is to end. The default is the start date.</p>
<p>END_TIME is the time of day on the ending date when the simulation will end. The default is 24:00:00.</p>
<p>REPORT_START_DATE is the date when reporting of results is to begin. The default is the simulation start date.</p>
<p>REPORT_START_TIME is the time of day on the report starting date when reporting is to begin. The default is the simulation start time of day.</p>
<p>SWEEP_START is the day of the year (month/day) when street sweeping operations begin. The default is 1/1.</p>
<p>SWEEP_END is the day of the year (month/day) when street sweeping operations end. The default is 12/31.</p>
<p>DRY_DAYS is the number of days with no rainfall prior to the start of the simulation. The default is 0.</p>
<p>REPORT_STEP is the time interval for reporting of computed results. The default is 0:15:00.</p>
<p>WET_STEP is the time step length used to compute runoff from subcatchments during periods of rainfall or when ponded water still remains on the surface. The default is 0:05:00.</p>
<p>DRY_STEP is the time step length used for runoff computations (consisting essentially of pollutant buildup) during periods when there is no rainfall and no ponded water. The default is 1:00:00.</p>
<p>ROUTING_STEP is the time step length in seconds used for routing flows and water quality constituents through the conveyance system. The default is 20 sec. This can be increased if dynamic wave routing is not used. Fractional values (e.g., 2.5) are permissible as are values entered in hours:minutes:seconds format.</p>
<p>LENGTHENING_STEP is a time step, in seconds, used to lengthen conduits under dynamic wave routing, so that they meet the Courant stability criterion under full-flow conditions (i.e., the travel time of a wave will not be smaller than the specified conduit lengthening time step). As this value is decreased, fewer conduits will require lengthening. A value of 0 (the default) means that no conduits will be lengthened.</p>
<p>VARIABLE_STEP is a safety factor applied to a variable time step computed for each time period under dynamic wave flow routing. The variable time step is computed so as to satisfy the Courant stability criterion for each conduit and yet not exceed the ROUTING_STEP value. If the safety factor is 0 (the default), then no variable time step is used.</p>
<p>MINIMUM_STEP is the smallest time step allowed when variable time steps are used for dynamic wave flow routing. The default value is 0.5 seconds.</p>
<p>INERTIAL_DAMPING indicates how the inertial terms in the Saint Venant momentum equation will be handled under dynamic wave flow routing. Choosing NONE maintains these terms at their full value under all conditions. Selecting PARTIAL (the default) will reduce the terms as flow comes closer to being critical (and ignores them when flow is supercritical). Choosing FULL will drop the terms altogether.</p>
<p>NORMAL_FLOW_LIMITED specifies which condition is checked to determine if flow in a conduit is supercritical and should thus be limited to the normal flow. Use SLOPE to check if the water surface slope is greater than the conduit slope, FROUDE to check if the Froude number is greater than 1.0, BOTH to check both conditions or NONE if no checks are made. The default is BOTH.</p>
<p>SURCHARGE_METHOD selects which method will be used to handle surcharge conditions. The EXTRAN option uses a variation of the Surcharge Algorithm from previous versions of SWMM to update nodal heads when all connecting links become full. The SLOT option uses a Preissmann Slot to add a small amount of virtual top surface width to full flowing pipes so that SWMM’s normal procedure for updating nodal heads can continue to be used. The default is EXTRAN.</p>
<p>MIN_SURFAREA is a minimum surface area used at nodes when computing changes in water depth under dynamic wave routing. If 0 is entered, then the default value of 12.566 ft<sup>2</sup> (1.167 m<sup>2</sup>) (i.e., the area of a 4-ft diameter manhole) is used.</p>
<p>MIN_SLOPE is the minimum value allowed for a conduit’s slope (%). If zero (the default) then no minimum is imposed (although SWMM uses a lower limit on elevation drop of 0.001 ft (0.00035 m) when computing a conduit slope).</p>
<p>MAX_TRIALS is the maximum number of trials allowed during a time step to reach convergence when updating hydraulic heads at the conveyance system’s nodes. The default value is 8.</p>
<p>HEAD_TOLERANCE is the difference in computed head at each node between successive trials below which the flow solution for the current time step is assumed to have converged. The default tolerance is 0.005 ft (0.0015 m).</p>
THREADS is the number of parallel computing threads to use for dynamic wave flow routing on machines equipped with multi-core processors. The default is 1.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Value
</td>
<td style="text-align:left;width: 8cm; ">
<p>FLOW_UNITS: CFS / GPM / MGD / CMS / LPS / MLD</p>
<p>INFILTRATION: HORTON / MODIFIED_HORTON / GREEN_AMPT / MODIFIED_GREEN_AMPT / CURVE_NUMBER</p>
<p>FLOW_ROUTING: STEADY / KINWAVE / DYNWAVE</p>
<p>LINK_OFFSETS: DEPTH / ELEVATION</p>
<p>FORCE_MAIN_EQUATION: H-W / D-W</p>
<p>IGNORE_RAINFALL: YES / NO</p>
<p>IGNORE_SNOWMELT: YES / NO</p>
<p>IGNORE_GROUNDWATER: YES / NO</p>
<p>IGNORE_RDII: YES / NO</p>
<p>IGNORE_ROUTING: YES / NO</p>
<p>IGNORE_QUALITY: YES / NO</p>
<p>ALLOW_PONDING: YES / NO</p>
<p>SKIP_STEADY_STATE: YES / NO</p>
<p>SYS_FLOW_TOL: value</p>
<p>LAT_FLOW_TOL: value</p>
<p>START_DATE: yyyy-mm-dd (default) or month/day/year</p>
<p>START_TIME: hours:minutes</p>
<p>END_DATE: yyyy-mm-dd (default) or month/day/year</p>
<p>END_TIME: hours:minutes</p>
<p>REPORT_START_DATE: yyyy-mm-dd (default) or month/day/year</p>
<p>REPORT_START_TIME: hours:minutes</p>
<p>SWEEP_START: month/day</p>
<p>SWEEP_END: month/day</p>
<p>DRY_DAYS: days</p>
<p>REPORT_STEP: hours:minutes:seconds</p>
<p>WET_STEP: hours:minutes:seconds</p>
<p>DRY_STEP: hours:minutes:seconds</p>
<p>ROUTING_STEP: seconds</p>
<p>LENGTHENING_STEP: seconds</p>
<p>VARIABLE_STEP: value</p>
<p>MINIMUM_STEP: seconds</p>
<p>INERTIAL_DAMPING: NONE / PARTIAL / FULL</p>
<p>NORMAL_FLOW_LIMITED: SLOPE / FROUDE / BOTH / NONE</p>
<p>SURCHARGE_METHOD: EXTRAN / SLOT</p>
<p>MIN_SURFAREA: value</p>
<p>MIN_SLOPE: value</p>
<p>MAX_TRIALS: value</p>
<p>HEAD_TOLERANCE: value</p>
THREADS: value
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Report">Table 179: </span><strong>Report</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Format
</td>
<td style="text-align:left;width: 8cm; ">
<p>INPUT specifies whether or not a summary of the input data should be provided in the output report. The default is NO.</p>
<p>CONTINUITY specifies whether continuity checks should be reported or not. The default is YES.</p>
<p>FLOWSTATS specifies whether summary flow statistics should be reported or not. The default is YES.</p>
<p>CONTROLS specifies whether all control actions taken during a simulation should be listed or not. The default is NO.</p>
<p>SUBCATCHMENTS gives a list of subcatchments whose results are to be reported. The default is NONE.</p>
<p>NODES gives a list of nodes whose results are to be reported. The default is NONE.</p>
<p>LINKS gives a list of links whose results are to be reported. The default is NONE.</p>
<p>LID specifies that the LID control Name in subcatchment Subcatch should have a detailed performance report for it written to file Fname.</p>
The SUBCATCHMENTS, NODES, LINKS, and LID lines can be repeated multiple times.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Value
</td>
<td style="text-align:left;width: 8cm; ">
<p>INPUT: YES / NO</p>
<p>CONTINUITY: YES / NO</p>
<p>FLOWSTATS: YES / NO</p>
<p>CONTROLS: YES / NO</p>
<p>SUBCATCHMENTS: ALL / NONE / <list of subcatchment names></p>
<p>NODES: ALL / NONE / <list of node names></p>
<p>LINKS: ALL / NONE / <list of link names></p>
LID: Name Subcatch Fname </list></list></list>
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Title">Table 180: </span><strong>Title</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Title
</td>
<td style="text-align:left;width: 8cm; ">
Any number of lines may be entered. The first line will be used as a page header in the output report.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Subcatchments">Table 181: </span><strong>Subcatchments</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to the subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Rain Gage
</td>
<td style="text-align:left;width: 8cm; ">
Name of a rain gage in the <a href="#Raingages">RAINGAGES</a> section assigned to the subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Outlet
</td>
<td style="text-align:left;width: 8cm; ">
Name of the node or subcatchment that receives runoff from the subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Area
</td>
<td style="text-align:left;width: 8cm; ">
Area of the subcatchment (acres or hectares if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
PctImperv
</td>
<td style="text-align:left;width: 8cm; ">
Percentage of the subcatchment’s area that is impervious.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Width
</td>
<td style="text-align:left;width: 8cm; ">
Characteristic width of the subcatchment (ft or m, if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
PctSlope
</td>
<td style="text-align:left;width: 8cm; ">
The subcatchment’s slope (percent).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
CurbLen
</td>
<td style="text-align:left;width: 8cm; ">
Total curb length (any length units) used to describe pollutant buildup. Use 0 if not applicable.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
SnowPack
</td>
<td style="text-align:left;width: 8cm; ">
Optional name of a snow pack object (from the <a href="#Snowpacks">SNOWPACKS</a> section) that characterizes snow accumulation and melting over the subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_Nimp
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s coefficient (n) for overland flow over the impervious sub-area.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_Nperv
</td>
<td style="text-align:left;width: 8cm; ">
Manning’s coefficient (n) for overland flow over the pervious sub-area.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
12
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_Simp
</td>
<td style="text-align:left;width: 8cm; ">
Depression storage for the impervious sub-area (inches or mm, if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
13
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_Sperv
</td>
<td style="text-align:left;width: 8cm; ">
Depression storage for the pervious sub-area (inches or mm, if using metric units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
14
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_PctZero
</td>
<td style="text-align:left;width: 8cm; ">
Percent of impervious area with no depression storage.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
15
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_RouteTo
</td>
<td style="text-align:left;width: 8cm; ">
IMPERVIOUS if pervious area runoff runs onto impervious area, PERVIOUS if impervious runoff runs onto pervious area, or OUTLET if both areas drain to the subcatchment’s outlet (default = OUTLET).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
16
</td>
<td style="text-align:left;width: 2cm; ">
Subareas_PctRouted
</td>
<td style="text-align:left;width: 8cm; ">
Percent of runoff routed from one type of area to another (default = 100).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
17
</td>
<td style="text-align:left;width: 2cm; ">
Infiltration_p1
</td>
<td style="text-align:left;width: 8cm; ">
<p>HORTON and MODIFIED_HORTON: maximum infiltration rate on the Horton curve (in/hr or mm/hr).</p>
<p>GREEN-AMPT and MODIFIED_GREEN_AMPT: soil capillary suction (in or mm if using metric units).</p>
CURVE_NUMBER: SCS Curve Number.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
18
</td>
<td style="text-align:left;width: 2cm; ">
Infiltration_p2
</td>
<td style="text-align:left;width: 8cm; ">
<p>HORTON and MODIFIED_HORTON: minimum infiltration rate on the Horton curve (in/hr or mm/hr if using metric units).</p>
<p>GREEN-AMPT and MODIFIED_GREEN_AMPT: soil saturated hydraulic conductivity (in/hr or mm/hr if using metric units).</p>
CURVE_NUMBER: no longer used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
19
</td>
<td style="text-align:left;width: 2cm; ">
Infiltration_p3
</td>
<td style="text-align:left;width: 8cm; ">
<p>HORTON and MODIFIED_HORTON: decay rate constant of the Horton curve (1/hr).</p>
<p>GREEN-AMPT and MODIFIED_GREEN_AMPT: initial soil moisture deficit (porosity minus moisture content) (fraction).</p>
CURVE_NUMBER: time it takes for a fully saturated soil to dry (days).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
20
</td>
<td style="text-align:left;width: 2cm; ">
Infiltration_p4
</td>
<td style="text-align:left;width: 8cm; ">
<p>HORTON and MODIFIED_HORTON: time it takes for a fully saturated soil to dry (days).</p>
GREEN-AMPT, MODIFIED_GREEN_AMPT and CURVE_NUMBER: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
21
</td>
<td style="text-align:left;width: 2cm; ">
Infiltration_p5
</td>
<td style="text-align:left;width: 8cm; ">
<p>HORTON and MODIFIED_HORTON: maximum infiltration volume possible (0 if not applicable) (in or mm if using metric units).</p>
GREEN-AMPT, MODIFIED_GREEN_AMPT and CURVE_NUMBER: Not Used.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
22
</td>
<td style="text-align:left;width: 2cm; ">
Infiltration_Method
</td>
<td style="text-align:left;width: 8cm; ">
<p>Either HORTON, MODIFIED_HORTON, GREEN_AMPT, MODIFIED_GREEN_AMPT, or CURVE_NUMBER.</p>
If not specified then the infiltration method supplied in the <a href="#Options">OPTIONS</a> section is used.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Buildup">Table 182: </span><strong>Buildup</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Landuse
</td>
<td style="text-align:left;width: 8cm; ">
Land use name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Pollutant
</td>
<td style="text-align:left;width: 8cm; ">
Pollutant name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
FuncType
</td>
<td style="text-align:left;width: 8cm; ">
<p>Buildup function type.</p>
<p>POW (Power): Min(C1, C2*t<sup>C3</sup>)</p>
<p>EXP (Exponential): C1<em>(1-exp(-C2</em>t))</p>
<p>SAT (Saturation): (C1*t)/(C3+t)</p>
EXT (External): C1 is the maximum possible buildup (mass per area or curb length), C2 is a scaling factor, and C3 is the name of a Time Series that contains buildup rates (as mass per area or curb length per day) as a function of time.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
C1
</td>
<td style="text-align:left;width: 8cm; ">
Buildup function parameters (see FuncType).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
C2
</td>
<td style="text-align:left;width: 8cm; ">
Buildup function parameters (see FuncType).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
C3
</td>
<td style="text-align:left;width: 8cm; ">
Buildup function parameters (see FuncType).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
PerUnit
</td>
<td style="text-align:left;width: 8cm; ">
AREA if buildup is per unit area, CURBLENGTH if per length of curb.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Coverages">Table 183: </span><strong>Coverages</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Subcatchment
</td>
<td style="text-align:left;width: 8cm; ">
Subcatchment name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Landuse
</td>
<td style="text-align:left;width: 8cm; ">
Land use name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Percent
</td>
<td style="text-align:left;width: 8cm; ">
Percent of the subcatchment’s area covered by the land use
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Landuses">Table 184: </span><strong>Landuses</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Land use name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
SweepIntervalDays
</td>
<td style="text-align:left;width: 8cm; ">
Days between street sweeping.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
AvailabilityFract
</td>
<td style="text-align:left;width: 8cm; ">
Fraction of pollutant buildup available for removal by street sweeping.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
LastSweepDays
</td>
<td style="text-align:left;width: 8cm; ">
Days since last sweeping at the start of the simulation.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Loadings">Table 185: </span><strong>Loadings</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Subcatchment
</td>
<td style="text-align:left;width: 8cm; ">
Name of a subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Landuse
</td>
<td style="text-align:left;width: 8cm; ">
Name of a pollutant.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Percent
</td>
<td style="text-align:left;width: 8cm; ">
Initial buildup of the pollutant (lbs/acre or kg/hectare). If an initial buildup is not specified for a pollutant, then its initial buildup is computed by applying the DRY_DAYS option (specified in the <a href="#Options">OPTIONS</a> section) to the pollutant’s buildup function for each land use in the subcatchment.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Pollutants">Table 186: </span><strong>Pollutants</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Name
</td>
<td style="text-align:left;width: 8cm; ">
Name assigned to a pollutant. Note, FLOW is a reserved word and cannot be used to name a pollutant.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Units
</td>
<td style="text-align:left;width: 8cm; ">
Concentration units (MG/L for milligrams per liter, UG/L for micrograms per liter, or #/L for direct count per liter).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Crain
</td>
<td style="text-align:left;width: 8cm; ">
Concentration of the pollutant in rainfall (concentration units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Cgw
</td>
<td style="text-align:left;width: 8cm; ">
Concentration of the pollutant in groundwater (concentration units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
cii
</td>
<td style="text-align:left;width: 8cm; ">
Concentration of the pollutant in inflow/infiltration (concentration units).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
Kdecay
</td>
<td style="text-align:left;width: 8cm; ">
First-order decay coefficient (1/days).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
Sflag
</td>
<td style="text-align:left;width: 8cm; ">
YES if pollutant buildup occurs only when there is snow cover, NO otherwise (default is NO).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
8
</td>
<td style="text-align:left;width: 2cm; ">
CoPoll
</td>
<td style="text-align:left;width: 8cm; ">
Name of a co-pollutant (default is no co-pollutant designated by a *).
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
9
</td>
<td style="text-align:left;width: 2cm; ">
CoFract
</td>
<td style="text-align:left;width: 8cm; ">
Fraction of the co-pollutant’s concentration (default is 0). When pollutant X has a co-pollutant Y, it means that fraction CoFract of pollutant Y’s runoff concentration is added to pollutant X’s runoff concentration when wash off from a subcatchment is computed.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
10
</td>
<td style="text-align:left;width: 2cm; ">
Cdwf
</td>
<td style="text-align:left;width: 8cm; ">
Pollutant concentration in dry weather flow (default is 0). If there is no co-pollutant but non-default values, then enter an asterisk (*) for the co-pollutant name. The dry weather flow concentration can be overridden for any specific node of the conveyance system by editing the node’s Inflows property (see the <a href="#Inflows">INFLOWS</a> section).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
11
</td>
<td style="text-align:left;width: 2cm; ">
Cinit
</td>
<td style="text-align:left;width: 8cm; ">
Pollutant concentration throughout the conveyance system at the start of the simulation (default is 0). If there is no co-pollutant but non-default values, then enter an asterisk (*) for the co-pollutant name.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Treatment">Table 187: </span><strong>Treatment</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Node
</td>
<td style="text-align:left;width: 8cm; ">
Name of the node where treatment occurs.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Pollut
</td>
<td style="text-align:left;width: 8cm; ">
Name of pollutant receiving treatment.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
Result
</td>
<td style="text-align:left;width: 8cm; ">
<p>Result computed by treatment function. Choices are:</p>
<p>C  (function computes effluent concentration)</p>
R  (function computes fractional removal)
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
4
</td>
<td style="text-align:left;width: 2cm; ">
Func
</td>
<td style="text-align:left;width: 8cm; ">
<p>Mathematical function expressing treatment result in terms of pollutant concentrations, pollutant removals, and other standard variables. Treatment functions can be any well-formed mathematical expression involving:</p>
<ul>
<li><p>inlet pollutant concentrations (use the pollutant name to represent a concentration)</p></li>
<li><p>removal of other pollutants (use R_ pre-pended to the pollutant name to represent removal)</p></li>
<li><p>process variables which include:</p>
<ul>
<li><p>FLOW: for flow rate into node (user’s flow units)</p></li>
<li><p>DEPTH: for water depth above node invert (ft or m)</p></li>
<li><p>AREA: for node surface area (ft<sup>2</sup> or m<sup>2</sup>)</p></li>
<li><p>DT: for routing time step (seconds)</p></li>
<li><p>HRT: for hydraulic residence time (hours)</p>
</td>
<td style="text-align:left;width: 1cm; ">
<p>Char</p>
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul>
<table>
<caption>
<span id="tab:tab-SWMM-Input-Washoff">Table 188: </span><strong>Washoff</strong>
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
No. 
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Default GIS Attribute Name
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Description
</th>
<th style="text-align:left;font-weight: bold;color: WHITE !important;background-color: #1ABDC9 !important;">
Type
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;width: 0.5cm; ">
1
</td>
<td style="text-align:left;width: 2cm; ">
Landuse
</td>
<td style="text-align:left;width: 8cm; ">
Land use name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
2
</td>
<td style="text-align:left;width: 2cm; ">
Pollutant
</td>
<td style="text-align:left;width: 8cm; ">
Pollutant name.
</td>
<td style="text-align:left;width: 1cm; ">
Char
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
3
</td>
<td style="text-align:left;width: 2cm; ">
FuncType
</td>
<td style="text-align:left;width: 8cm; ">
<p>Washoff function type. Each washoff function expresses its results in different units. Available types:</p>
<ul>
<li><p>EXP (Exponential): C1(runoff)<sup>C2 </sup>(buildup) [Mass/hour]. Runoff variable is expressed in catchment depth per unit of time (in/hr or mm/hr if using metric units).</p></li>
<li><p>RC (Rating Curve): C1(runoff)<sup>C2</sup> [Mass/sec]. Runoff variable is in whatever flow units were specified in the OPTIONS section of the input file (e.g. CFS, CMS, etc.).</p></li>
<li><p>EMC (Event Mean Concentration) C1 [Mass/Liter].</p>
</td>
<td style="text-align:left;width: 1cm; ">
<p>Char</p>
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
<p>4</p>
</td>
<td style="text-align:left;width: 2cm; ">
<p>C1</p>
</td>
<td style="text-align:left;width: 8cm; ">
<p>Washoff function coefficients. See FuncType.</p></li>
</ul>
<p>EXP: units are (in/hr)<sup>-C2</sup> per hour or (mm/hr)<sup>-C2</sup> per hour if using metric units.</p>
<p>RC: units depend on the flow units employed.</p>
EMC: concentration units.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
5
</td>
<td style="text-align:left;width: 2cm; ">
C2
</td>
<td style="text-align:left;width: 8cm; ">
Washoff function coefficients. See FuncType.
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
6
</td>
<td style="text-align:left;width: 2cm; ">
SweepRmv1
</td>
<td style="text-align:left;width: 8cm; ">
Street sweeping removal efficiency (percent).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
<tr>
<td style="text-align:right;width: 0.5cm; ">
7
</td>
<td style="text-align:left;width: 2cm; ">
BmpRmv1
</td>
<td style="text-align:left;width: 8cm; ">
BMP removal efficiency (percent).
</td>
<td style="text-align:left;width: 1cm; ">
Float
</td>
</tr>
</tbody>
</table>
<p><img src="images/WQFooter.jpg" width="100%" /></p>

<h1 class="unnumbered hasAnchor" id="references">References<a href="#references" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="1" line-spacing="2">
<div class="csl-entry">
Ansar M. and Nair S. (2003). <em>Flow Computations at STA-1 West Gated Spillways</em>. South Florida Water Management District.
</div>
<div class="csl-entry">
Australian Emergency Management Institute. (2014). <em>Australian Emergency Management Handbook 7: Managing Floodplain Best Practice in Flood Risk Management in Australia</em>. <a href="https://knowledge.aidr.org.au/media/3521/adr-handbook-7.pdf">https://knowledge.aidr.org.au/media/3521/adr-handbook-7.pdf</a>
</div>
<div class="csl-entry">
Austroads. (1994). <em>Waterway Design - a Guide to the Hydraulic Design of Bridges, Culverts and Floodways</em>. <a href="https://austroads.com.au/">https://austroads.com.au/</a>
</div>
<div class="csl-entry">
Austroads. (2018). <em>Guide to Bridge Technology Part 8, Hydraulic Design of Waterway Structures</em>. <a href="https://austroads.com.au/">https://austroads.com.au/</a>
</div>
<div class="csl-entry">
Babister, M., &amp; Barton, C. (2012). <em>Two Dimensional Modelling in Urban and Rural Floodplains Stage 1 &amp; 2 Report</em>. <a href="https://arr.ga.gov.au/__data/assets/pdf_file/0019/40573/ARR_Project15_TwoDimensional_Modelling_DraftReport.pdf">https://arr.ga.gov.au/__data/assets/pdf_file/0019/40573/ARR_Project15_TwoDimensional_Modelling_DraftReport.pdf</a>
</div>
<div class="csl-entry">
Barton, C. (2001). <em>Flow Through an Abrupt Constriction – 2D Hydrodynamic Model Performance and Influence of Spatial Resolution</em> (C. Barton, Ed.) [M.Eng.Sc Master Thesis]. <a href="https://tuflow.com/media/4983/2001-flow-through-an-abrupt-constriction-2d-hydrodynamic-performance-and-influence-of-spatial-resolution-barton-thesis.pdf">https://tuflow.com/media/4983/2001-flow-through-an-abrupt-constriction-2d-hydrodynamic-performance-and-influence-of-spatial-resolution-barton-thesis.pdf</a>
</div>
<div class="csl-entry">
Benham, S., &amp; Rogencamp, G. (2003). Appliction of 2D Flood Models with 1D Drainage Elements. <em>NSW FMA Conference</em>. <a href="https://?">?</a>
</div>
<div class="csl-entry">
Bos, M. (1976). <em>Discharge Measurement Structures</em> (Publication No. 161). Delft Hydraulic Laboratory. <a href="https://www.samsamwater.com/library/pub20.pdf">https://www.samsamwater.com/library/pub20.pdf</a>
</div>
<div class="csl-entry">
Bos, M. (1989). <em>Discharge Measurement Structures</em> (3rd revised edition.). International Institute for Land Reclamation; Improvement. <a href="https://www.samsamwater.com/library/pub20.pdf">https://www.samsamwater.com/library/pub20.pdf</a>
</div>
<div class="csl-entry">
Boyte, C. (2014). <em>The Application of Direct Rainfall Models as Hydrologic Models Incorporating Hydraulic Resistance at Shallow Depths</em> [B.Eng Thesis]. <a href="https://tuflow.com/media/5009/2014-the-application-of-direct-rainfall-models-as-hydrologic-models-incorporating-hydraulic-resistance-at-shallow-depths-boyte-thesis.pdf">https://tuflow.com/media/5009/2014-the-application-of-direct-rainfall-models-as-hydrologic-models-incorporating-hydraulic-resistance-at-shallow-depths-boyte-thesis.pdf</a>
</div>
<div class="csl-entry">
Bradley, J. (1978). <em>Hydraulics of Bridge Waterways</em> (HDS 1, FIWA). Bridge Division. <a href="https://www.fhwa.dot.gov/engineering/hydraulics/pubs/hds1.pdf">https://www.fhwa.dot.gov/engineering/hydraulics/pubs/hds1.pdf</a>
</div>
<div class="csl-entry">
CIWEM. (2009). <em>Integrated Urban Drainage Modelling Guide</em>. CIWEM.
</div>
<div class="csl-entry">
Collecutt, G., Baeumer, U., Gao, S., &amp; Syme, W. (2022). Bridge Deck Afflux Modelling – Benchmarking of CFD and SWE Codes to Real-World Data. <em>Hydrology &amp; Water Resources Symposium</em>. <a href="https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf">https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf</a>
</div>
<div class="csl-entry">
Collecutt, G., Gao, S., &amp; Syme, W. (2020). Mesh-Size Insensitive Turbulence Modelling for the 2D Shallow Water Equations. <em>River Flow 2020</em>, pp. 1–9. <a href="https://tuflow.com/media/5023/2020-mesh-size-insensitive-turbulence-modelling-for-the-2d-shallow-water-equations-collecutt-et-al-iahr-river-flow-delft.pdf">https://tuflow.com/media/5023/2020-mesh-size-insensitive-turbulence-modelling-for-the-2d-shallow-water-equations-collecutt-et-al-iahr-river-flow-delft.pdf</a>
</div>
<div class="csl-entry">
Collecutt, G., &amp; Syme, B. (2017). Experimental Benchmarking of Mesh Size and Time-Step Convergence for a 1st and 2nd Order SWE Finite Volume Scheme. <em>Proceedings of the 37th IAHR World Congress</em>.<a href="
https://www.tuflow.com/Download/Publications/07-31-1369.pdf">
https://www.tuflow.com/Download/Publications/07-31-1369.pdf</a>
</div>
<div class="csl-entry">
Cox, R., Shard, T., &amp; Blacka, M. (2010). <em>Australian Rainfall and Runoff Revision Project 10: Appropriate Safety Criteria for People</em>. Austalian Institute of Engineers. <a href="https://arr.ga.gov.au/__data/assets/pdf_file/0006/40578/ARR_Project_10_Stage1_report_Final.pdf">https://arr.ga.gov.au/__data/assets/pdf_file/0006/40578/ARR_Project_10_Stage1_report_Final.pdf</a>
</div>
<div class="csl-entry">
CSIRO. (2000). <em>Floodplain Management in Australia Best Practice Principles and Guidelines</em>. CSIRO Publishing.
</div>
<div class="csl-entry">
DEFRA. (2006a). <em>DEFRA r&amp;d Outputs: Flood Risks to People Phase Two Draft FD2321/TR1 and TR2</em>. DEFRA. <a href="https://assets.publishing.service.gov.uk/media/602bbc3de90e07055f646148/Flood_risks_to_people_-_Phase_2_Guidance_Document_Technical_report.pdf">https://assets.publishing.service.gov.uk/media/602bbc3de90e07055f646148/Flood_risks_to_people_-_Phase_2_Guidance_Document_Technical_report.pdf</a>
</div>
<div class="csl-entry">
DEFRA. (2006b). <em>Flood Risks to People Phase 2 FD2321/TR1 the Flood Risks to People Methodology</em>. DEFRA. <a href="https://assets.publishing.service.gov.uk/media/602bbc768fa8f50383c41f80/Flood_risks_to_people_-_Phase_2_The_flood_risks_to_people_methodology_technical_report.pdf">https://assets.publishing.service.gov.uk/media/602bbc768fa8f50383c41f80/Flood_risks_to_people_-_Phase_2_The_flood_risks_to_people_methodology_technical_report.pdf</a>
</div>
<div class="csl-entry">
DHI. (2009). <em>MOUSE PIPE FLOW – Reference Manual</em>. Danish Hydraulic Institute. <a href="https://manuals.mikepoweredbydhi.help/2017/Cities/MOUSEPipeFlowReference.pdf">https://manuals.mikepoweredbydhi.help/2017/Cities/MOUSEPipeFlowReference.pdf</a>
</div>
<div class="csl-entry">
Environment Agency. (2004). <em>Tidal Thames Embayment Inundation Study</em>. EA, Halcrow, TUFLOW.
</div>
<div class="csl-entry">
Environment Agency. (2006). <em>UK FD2321 Technical Report - Flood Risks to People: Phase 2 Project Record</em>. UK Government; <a href="https://assets.publishing.service.gov.uk/media/602bbb768fa8f50386a7f8aa/Flood_risks_to_people_-_Phase_2_Project_Record.pdf" class="uri">https://assets.publishing.service.gov.uk/media/602bbb768fa8f50386a7f8aa/Flood_risks_to_people_-_Phase_2_Project_Record.pdf</a>.
</div>
<div class="csl-entry">
Environment Agency. (2008). <em>Explanatory Note for FD2320 and FD2321 Project Record</em>. <a href="https://assets.publishing.service.gov.uk/media/602bbdcfe90e070561b31432/Explanatory_note_for_FD2320_and_FD2321_project_record.pdf" class="uri">https://assets.publishing.service.gov.uk/media/602bbdcfe90e070561b31432/Explanatory_note_for_FD2320_and_FD2321_project_record.pdf</a>.
</div>
<div class="csl-entry">
Environment Agency. (2010). <em>The Fluvial Design Guide</em>. Environment Agency.
</div>
<div class="csl-entry">
Falconer, R. A., Lin, B., &amp; Kashefipour, S. M. (2005). Modelling Water Quality Processes in Estuaries. In P. B. Bates, S. N. Lane, &amp; R. I. Furguson (Eds.), <em>Computational fluid dynamics: Applications in environmental hydraulics</em>. John Wiley; Sons.
</div>
<div class="csl-entry">
Gao, S., Ryan, P., Syme, W., &amp; Collecutt, G. (2022). The End of the 1D Open Channel Cross-Section? <em>Hydrology &amp; Water Resources Symposium</em>. <a href="https://tuflow.com/media/7547/2022-the-end-of-the-1d-open-channel-cross-section-gao-et-al-hwrs.pdf">https://tuflow.com/media/7547/2022-the-end-of-the-1d-open-channel-cross-section-gao-et-al-hwrs.pdf</a>
</div>
<div class="csl-entry">
GHD. (2011). <em>MBRC Storm Tide Management Study: Stage 1 – Scoping Report</em>.
</div>
<div class="csl-entry">
Hamilton City Council. (2012). <em>Flood Mapping</em>. <a href="https://hamilton.govt.nz/property-rates-and-building/district-plan/flood-mapping/" class="uri">https://hamilton.govt.nz/property-rates-and-building/district-plan/flood-mapping/</a>.
</div>
<div class="csl-entry">
Henderson, F. (1966). <em>Open Channel Flow</em>. Macmillan.
</div>
<div class="csl-entry">
Holland, G. J. (1980). An Analytic Model of the Wind and Pressure Profiles in Hurricanes. <em>Monthly Weather Review</em>, <em>108</em>(8), 1212–1218. <a href="https://doi.org/10.1175/1520-0493(1980)108&lt;1212:AAMOTW&gt;2.0.CO;2">https://doi.org/10.1175/1520-0493(1980)108&lt;1212:AAMOTW&gt;2.0.CO;2</a>
</div>
<div class="csl-entry">
HR Wallingford. (1988). <em>Afflux at Arch Bridges</em>. <a href="https://eprints.hrwallingford.com/219/1/SR182-Afflux-arch-bridges-HRWallingford.pdf">https://eprints.hrwallingford.com/219/1/SR182-Afflux-arch-bridges-HRWallingford.pdf</a>
</div>
<div class="csl-entry">
Huxley, C. (2004). <em>TUFLOW Testing and Validation</em> (B. ENG. Christopher Dylan Huxley, Ed.) [Thesis]. <a href="https://www.tuflow.com/Download/Publications/TUFLOW%20Validation%20and%20Testing,%20Huxley,%202004.pdf">https://www.tuflow.com/Download/Publications/TUFLOW%20Validation%20and%20Testing,%20Huxley,%202004.pdf</a>
</div>
<div class="csl-entry">
Huxley, C., Syme, W., Ryan, P., &amp; Collecutt, G. (2022). Hydraulic Modelling 2D Cell Size Result Convergence – Comparing the Performance of Different Shallow Water Equation Solution Schemes. <em>Hydrology and Water Resources Symposium, Engineers Australia</em>. <a href="https://www.tuflow.com/media/7555/2022-hydraulic-modelling-2d-cell-size-result-convergence-huxley-et-al-hwrs.pdf">https://www.tuflow.com/media/7555/2022-hydraulic-modelling-2d-cell-size-result-convergence-huxley-et-al-hwrs.pdf</a>
</div>
<div class="csl-entry">
Kitts, D., Syme, W., Gao, S., Collecutt, G., &amp; Ryan, P. (2020). Mesh Orientation and Cell Size Sensitivity in 2D SWE Solvers. <em>IAHR River Flow Conference</em>. <a href="https://tuflow.com/media/5022/2020-mesh-orientation-and-cell-size-sensitivity-in-2d-swe-solvers-kitts-et-al-iahr-river-flow-delft.pdf">https://tuflow.com/media/5022/2020-mesh-orientation-and-cell-size-sensitivity-in-2d-swe-solvers-kitts-et-al-iahr-river-flow-delft.pdf</a>
</div>
<div class="csl-entry">
Leonard, B. P. (1991). The ULTIMATE Conservative Difference Scheme Applied to Unsteady One-Dimensional Advection. <em>Computer Methods in Applied Mechanics and Engineering</em>, <em>88</em>(1), 17–74.
</div>
<div class="csl-entry">
Leonard, B. P., MacVean, M. K., &amp; Lock, A. P. (1993). <em>Positivity-Preserving Numerical Schemes for Multidimensional Advection</em> (No. 93N27091). <span>NASA Centre for Aerospace Information</span>.
</div>
<div class="csl-entry">
Leonard, B. P., &amp; Niknafs, H. S. (1991). <em>Cost-Effective Accurate Coarse-Grid Method for Highly Convective Multidimensional Unsteady Flows</em> (No. 91N21075). <span>NASA Centre for Aerospace Information</span>.
</div>
<div class="csl-entry">
McDonnell, B., Wu, J. X., Ratliff, K., Mullapudi, A., &amp; Tryby, M. (2021). <em>Open Water Analytics Stormwater Management Model</em> (Version 5.1.13). Zenodo. <a href="https://doi.org/10.5281/zenodo.5484299">https://doi.org/10.5281/zenodo.5484299</a>
</div>
<div class="csl-entry">
Melbourne Water. (2016). <em>Flood Mapping Projects Guidelines and Technical Specifications</em> (Version 1).
</div>
<div class="csl-entry">
Miller, D. (1994). <em>Discharge Characteristics IAHR Hydraulic Structures Design Manual</em> (No. No.8; pp. 249 pages). Hydraulic Design Considerations, Balkema Publ.
</div>
<div class="csl-entry">
Morrison, W., &amp; Smith, P. (1978). <em>A Practical Application of a Network Model Numerical Simulation of Fluid Motion</em>. North Holland Publishing Company.
</div>
<div class="csl-entry">
Neelz, S., &amp; Pender, G. (2013). <em>Benchmarking the Latest Generation of 2D Hydaulic Modeling Packages</em>. Environment Agency. <a href="https://doi.org/SC120002/R">https://doi.org/SC120002/R</a>
</div>
<div class="csl-entry">
NSW Goverment. (2005a). <em>Floodplain Development Manual: The Management of Flood Liable Land</em> (pp. 149 pages). Department of Infrastructure, Planning; Natural Resources (NSW Government).<a href="
https://www.environment.nsw.gov.au/-/media/OEH/Corporate-Site/Documents/Water/Floodplains/floodplain-development-manual.pdf">
https://www.environment.nsw.gov.au/-/media/OEH/Corporate-Site/Documents/Water/Floodplains/floodplain-development-manual.pdf</a>
</div>
<div class="csl-entry">
NSW Goverment. (2005b). <em>Floodplain Management Manual</em>. NSW Department of Land; Water Conservation (NSW Government).
</div>
<div class="csl-entry">
Ollett, P., &amp; Syme, B. (2016). <em>ARR blockage: Numerical implementation and three case studies</em>. <a href="http://www.hydralinc.com/wp-content/uploads/Ollett-Syme-2016-ARR-Blockage.pdf">http://www.hydralinc.com/wp-content/uploads/Ollett-Syme-2016-ARR-Blockage.pdf</a>
</div>
<div class="csl-entry">
Port Macquarie-Hastings Council. (2018). <em>PORT MACQUARIE-HASTINGS COUNCIL FLOOD POLICY</em>. <a href="https://www.pmhc.nsw.gov.au/files/assets/public/v/1/document-files/your-council/publications/policies/port-macquarie-hastings-council-flood-adopted-2018-12-12.pdf" class="uri">https://www.pmhc.nsw.gov.au/files/assets/public/v/1/document-files/your-council/publications/policies/port-macquarie-hastings-council-flood-adopted-2018-12-12.pdf</a>.
</div>
<div class="csl-entry">
Queensland Government. (2001). <em>Queensland Climate Change and Community Vulnerability to Tropical Cyclones - Ocean Hazrds Assessment</em>. <a href="https://www.systemsengineeringaustralia.com.au/download/Ocean_Hazards_Assess_Stage1A_revised.pdf">https://www.systemsengineeringaustralia.com.au/download/Ocean_Hazards_Assess_Stage1A_revised.pdf</a>
</div>
<div class="csl-entry">
Queensland Reconstruction Authority. (2012). <em>Planning for Stronger, More Resilient Fl Oodplains: Part 2</em>. <a href="https://www.qra.qld.gov.au/sites/default/files/2018-10/resilient-floodplains-part2-full_0.pdf" class="uri">https://www.qra.qld.gov.au/sites/default/files/2018-10/resilient-floodplains-part2-full_0.pdf</a>.
</div>
<div class="csl-entry">
Rawls, W., Brakesiek, J., &amp; Miller, N. (1983). Green-Ampt Infiltration Parameters from Soils Data. <em>Journal of Hydraulic Engineering</em>, <em>vol 109</em>, 62–71.
</div>
<div class="csl-entry">
Ryan, P., Syme, W., Gao, S., &amp; Collecutt, G. (2022). Irect Rainfall Hydraulic Model Validation. <em>Hydrology &amp; Water Resources Symposium</em>. <a href="https://www.tuflow.com/media/7545/2022-direct-rainfall-hydraulic-model-validation-ryan-et-al-hwrs.pdf">https://www.tuflow.com/media/7545/2022-direct-rainfall-hydraulic-model-validation-ryan-et-al-hwrs.pdf</a>
</div>
<div class="csl-entry">
Stelling, G. (1984). <em>On the Construction of Computational Methods for Shallow Water Flow Problems</em>. Rijkswaterstaat Communications.
</div>
<div class="csl-entry">
Syme, W. (1991). <em>Dynamically Linked Two Dimensional / One-Dimensional Hydrodynamic Modelling Program for Rivers, Estuaries and Coastal Waters</em> (W. Syme, Ed.) [M.Eng.Sc(100% Research) Thesis]. Dept of Civil Engineering. <a href="https://tuflow.com/media/4982/1991-tuflow-dynamically-linked-2d-and-1d-hydrodynamic-modelling-syme-thesis.pdf">https://tuflow.com/media/4982/1991-tuflow-dynamically-linked-2d-and-1d-hydrodynamic-modelling-syme-thesis.pdf</a>
</div>
<div class="csl-entry">
Syme, W. (2001a). Modelling of Bends and Hydraulic Structures in a Two-Dimensional Scheme. <em>The Institution of Engineers, Australia Conference on Hydraulics in Civil Engineering</em>. <a href="https://tuflow.com/media/4984/2001-modelling-of-bends-and-hydraulic-structures-in-a-2d-scheme-syme.pdf">https://tuflow.com/media/4984/2001-modelling-of-bends-and-hydraulic-structures-in-a-2d-scheme-syme.pdf</a>
</div>
<div class="csl-entry">
Syme, W. (2001b). TUFLOW – Two &amp; One-Dimensional Unsteady FLOW Software for Rivers, Estuaries and Coastal Waters. <em>The Institution of Engineers, Australia 2D Seminar</em>. <a href="https://tuflow.com/media/4985/2001-tuflow-two-and-one-dimensional-unsteady-flow-software-for-rivers-estuaries-and-coastal-waters-syme.pdf">https://tuflow.com/media/4985/2001-tuflow-two-and-one-dimensional-unsteady-flow-software-for-rivers-estuaries-and-coastal-waters-syme.pdf</a>
</div>
<div class="csl-entry">
Syme, W. (2008). Flooding in Urban Areas - 2D Modelling Approaches for Buildings and Fences. <em>Engineers Australia, 9th National COnference on Hydraulics in Water Enginnering</em>. <a href="https://tuflow.com/media/4997/2008-flooding-in-urban-areas-2d-modelling-approaches-for-buildings-and-fences-syme-hwe-aus.pdf">https://tuflow.com/media/4997/2008-flooding-in-urban-areas-2d-modelling-approaches-for-buildings-and-fences-syme-hwe-aus.pdf</a>
</div>
<div class="csl-entry">
Syme, W., Nielsen, C., &amp; Charteris, A. (1998). Comparison of Two-Dimensional Hydrodynamic Modelling Systems Part One - Flow Through a Constriction. <em>International Conference on Hydraulics in Civil Engineering</em>.
</div>
<div class="csl-entry">
TUFLOW. (2018). <em>TUFLOW Classic/HPC User Manual Build 2018-03-AD</em>. <a href="https://downloads.tuflow.com/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03-AD.pdf">https://downloads.tuflow.com/TUFLOW/Releases/2018-03/TUFLOW%20Manual.2018-03-AD.pdf</a>
</div>
<div class="csl-entry">
TUFLOW. (2020). <em>TUFLOW Classic and HPC 2020-01 and 2020-10 Release Notes</em>. <a href="https://downloads.tuflow.com/TUFLOW/Releases/2020-10/TUFLOW%20Release%20Notes.2020-10-AF.pdf">https://downloads.tuflow.com/TUFLOW/Releases/2020-10/TUFLOW%20Release%20Notes.2020-10-AF.pdf</a>
</div>
<div class="csl-entry">
Tullis, B., &amp; Robinson, S. (2008). Quantifying Culvert Exit Loss. <em>Journal of Irrigation and Drainage Engineering</em>, <em>Vol. 134</em>(No. 2), pp. 263–266.
</div>
<div class="csl-entry">
USACE. (1977). <em>Hydraulic Design Criteria-Sheets 312</em>. US Army Corp of Engineers. <a href="https://apps.dtic.mil/sti/tr/pdf/ADA092238.pdf">https://apps.dtic.mil/sti/tr/pdf/ADA092238.pdf</a>
</div>
<div class="csl-entry">
USACE. (1987). <em>Hydraulic Design Criteria-Sheets 111-1 to 111-14</em>. US Army Corp of Engineers. <a href="https://apps.dtic.mil/sti/tr/pdf/ADA092237.pdf">https://apps.dtic.mil/sti/tr/pdf/ADA092237.pdf</a>
</div>
<div class="csl-entry">
USBR. (1987). <em>Design of Small Dams</em> [Technology &amp; Engineering]. U.S. Dept. of the Interior, Bureau of Reclamation, 1987-. <a href="https://www.usbr.gov/tsc/techreferences/mands/mands-pdfs/SmallDams.pdf">https://www.usbr.gov/tsc/techreferences/mands/mands-pdfs/SmallDams.pdf</a>
</div>
<div class="csl-entry">
Weeks, W., Barthelmess, A., Rigby, E., Witheridge, G., &amp; Adamson, R. (2009). <em>Australian Rainfall and Runoff Revision Project 11: Blockage of Hydraulic Structures</em>. Austalian Institute of Engineers. <a href="https://doi.org/P11/S1/007">https://doi.org/P11/S1/007</a>
</div>
<div class="csl-entry">
Weeks, W., Witheridge, G., Rigby, E., Barthelmess, A., &amp; O’Loughlin, G. (2013). <em>Australian Rainfall and Runoff Revision Project 11: Blockage of Hydraulic Structures</em>. Austalian Institute of Engineers. <a href="https://doi.org/P11/S2/021">https://doi.org/P11/S2/021</a>
</div>
<div class="csl-entry">
Witheridge, G. (2009). <em>Hydraulic Analysis of the Debris Blockage of Culvert Inlets</em>. Catchments &amp; Creek Pty Ltd.
</div>
<div class="csl-entry">
Wu, J. (1980). Wind-Stress Coefficients over Sea Surface Near Neutral Conditions—a Revisit. <em>Journal of Physical Oceanography</em>, <em>Vol. 10</em>(5), pp. 727–740. https://doi.org/<a href="https://doi.org/10.1175/1520-0485(1980)010&lt;0727:WSCOSS&gt;2.0.CO;2">https://doi.org/10.1175/1520-0485(1980)010&lt;0727:WSCOSS&gt;2.0.CO;2</a>
</div>
<div class="csl-entry">
Wu, J. (1982). Wind-Stress Coefficients over Sea Surface from Breeze to Hurricane. <em>Journal of Geophysical Research</em>, <em>Vol. 87</em>(C12), pp. 9704–9706. https://doi.org/<a href="https://doi.org/10.1029/JC087iC12p09704">https://doi.org/10.1029/JC087iC12p09704</a>
</div>
<div class="csl-entry">
Wu, W., Shields Jr., F. D., Bennett, S. J., &amp; Wang, S. S. Y. (2005). A Depth-Averaged Two-Dimensional Model for Flow, Sediment Transport, and Bed Topography in Curved Channels with Riparian Vegetation. <em>Water Resources Research</em>, <em>41</em>(3). https://doi.org/<a href="https://doi.org/10.1029/2004WR003730">https://doi.org/10.1029/2004WR003730</a>
</div>
<div class="csl-entry">
Wu, &amp; Falconer, R. A. (2000). A Mass Conservative 3-d Numerical Model for Predicting Solute Fluxes in Estuarine Waters. <em>Advances in Water Resources</em>, <em>23</em>(5), 531–543.
</div>
</div>







<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="1" line-spacing="2">
<div id="ref-Nair2003" class="csl-entry">
Ansar M. and Nair S. (2003). <em>Flow Computations at STA-1 West Gated Spillways</em>. South Florida Water Management District.
</div>
<div id="ref-AEMI2014" class="csl-entry">
Australian Emergency Management Institute. (2014). <em>Australian Emergency Management Handbook 7: Managing Floodplain Best Practice in Flood Risk Management in Australia</em>. <a href="https://knowledge.aidr.org.au/media/3521/adr-handbook-7.pdf">https://knowledge.aidr.org.au/media/3521/adr-handbook-7.pdf</a>
</div>
<div id="ref-Austroads1994" class="csl-entry">
Austroads. (1994). <em>Waterway Design - a Guide to the Hydraulic Design of Bridges, Culverts and Floodways</em>. <a href="https://austroads.com.au/">https://austroads.com.au/</a>
</div>
<div id="ref-Austroads2018" class="csl-entry">
Austroads. (2018). <em>Guide to Bridge Technology Part 8, Hydraulic Design of Waterway Structures</em>. <a href="https://austroads.com.au/">https://austroads.com.au/</a>
</div>
<div id="ref-BabisterBarton2012" class="csl-entry">
Babister, M., &amp; Barton, C. (2012). <em>Two Dimensional Modelling in Urban and Rural Floodplains Stage 1 &amp; 2 Report</em>. <a href="https://arr.ga.gov.au/__data/assets/pdf_file/0019/40573/ARR_Project15_TwoDimensional_Modelling_DraftReport.pdf">https://arr.ga.gov.au/__data/assets/pdf_file/0019/40573/ARR_Project15_TwoDimensional_Modelling_DraftReport.pdf</a>
</div>
<div id="ref-Barton2001" class="csl-entry">
Barton, C. (2001). <em>Flow Through an Abrupt Constriction – 2D Hydrodynamic Model Performance and Influence of Spatial Resolution</em> (C. Barton, Ed.) [M.Eng.Sc Master Thesis]. <a href="https://tuflow.com/media/4983/2001-flow-through-an-abrupt-constriction-2d-hydrodynamic-performance-and-influence-of-spatial-resolution-barton-thesis.pdf">https://tuflow.com/media/4983/2001-flow-through-an-abrupt-constriction-2d-hydrodynamic-performance-and-influence-of-spatial-resolution-barton-thesis.pdf</a>
</div>
<div id="ref-Bos1989" class="csl-entry">
Bos, M. (1989). <em>Discharge Measurement Structures</em> (3rd revised edition.). International Institute for Land Reclamation; Improvement. <a href="https://www.samsamwater.com/library/pub20.pdf">https://www.samsamwater.com/library/pub20.pdf</a>
</div>
<div id="ref-Boyte2014" class="csl-entry">
Boyte, C. (2014). <em>The Application of Direct Rainfall Models as Hydrologic Models Incorporating Hydraulic Resistance at Shallow Depths</em> [B.Eng Thesis]. <a href="https://tuflow.com/media/5009/2014-the-application-of-direct-rainfall-models-as-hydrologic-models-incorporating-hydraulic-resistance-at-shallow-depths-boyte-thesis.pdf">https://tuflow.com/media/5009/2014-the-application-of-direct-rainfall-models-as-hydrologic-models-incorporating-hydraulic-resistance-at-shallow-depths-boyte-thesis.pdf</a>
</div>
<div id="ref-Bradley1978" class="csl-entry">
Bradley, J. (1978). <em>Hydraulics of Bridge Waterways</em> (HDS 1, FIWA). Bridge Division. <a href="https://www.fhwa.dot.gov/engineering/hydraulics/pubs/hds1.pdf">https://www.fhwa.dot.gov/engineering/hydraulics/pubs/hds1.pdf</a>
</div>
<div id="ref-UrbanGuide2009" class="csl-entry">
CIWEM. (2009). <em>Integrated Urban Drainage Modelling Guide</em>. CIWEM.
</div>
<div id="ref-BridgeDeckAfflux" class="csl-entry">
Collecutt, G., Baeumer, U., Gao, S., &amp; Syme, W. (2022). Bridge Deck Afflux Modelling – Benchmarking of CFD and SWE Codes to Real-World Data. <em>Hydrology &amp; Water Resources Symposium</em>. <a href="https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf">https://tuflow.com/media/7554/2022-bridge-deck-afflux-modelling-benchmarking-of-cfd-and-swe-codes-to-real-world-data-collecutt-et-al-hwrs.pdf</a>
</div>
<div id="ref-Collecutt2020" class="csl-entry">
Collecutt, G., Gao, S., &amp; Syme, W. (2020). Mesh-Size Insensitive Turbulence Modelling for the 2D Shallow Water Equations. <em>River Flow 2020</em>, pp. 1–9. <a href="https://tuflow.com/media/5023/2020-mesh-size-insensitive-turbulence-modelling-for-the-2d-shallow-water-equations-collecutt-et-al-iahr-river-flow-delft.pdf">https://tuflow.com/media/5023/2020-mesh-size-insensitive-turbulence-modelling-for-the-2d-shallow-water-equations-collecutt-et-al-iahr-river-flow-delft.pdf</a>
</div>
<div id="ref-CollecuttSyme2017" class="csl-entry">
Collecutt, G., &amp; Syme, B. (2017). Experimental Benchmarking of Mesh Size and Time-Step Convergence for a 1st and 2nd Order SWE Finite Volume Scheme. <em>Proceedings of the 37th IAHR World Congress</em>.<a href="
https://www.tuflow.com/Download/Publications/07-31-1369.pdf">
<div id="ref-CoxShard2010" class="csl-entry">
Cox, R., Shard, T., &amp; Blacka, M. (2010). <em>Australian Rainfall and Runoff Revision Project 10: Appropriate Safety Criteria for People</em>. Austalian Institute of Engineers. <a href="https://arr.ga.gov.au/__data/assets/pdf_file/0006/40578/ARR_Project_10_Stage1_report_Final.pdf">https://arr.ga.gov.au/__data/assets/pdf_file/0006/40578/ARR_Project_10_Stage1_report_Final.pdf</a>
</div>
<div id="ref-CSIRO2000" class="csl-entry">
CSIRO. (2000). <em>Floodplain Management in Australia Best Practice Principles and Guidelines</em>. CSIRO Publishing.
</div>
<div id="ref-DEFRA2006" class="csl-entry">
DEFRA. (2006a). <em>DEFRA r&amp;d Outputs: Flood Risks to People Phase Two Draft FD2321/TR1 and TR2</em>. DEFRA. <a href="https://assets.publishing.service.gov.uk/media/602bbc3de90e07055f646148/Flood_risks_to_people_-_Phase_2_Guidance_Document_Technical_report.pdf">https://assets.publishing.service.gov.uk/media/602bbc3de90e07055f646148/Flood_risks_to_people_-_Phase_2_Guidance_Document_Technical_report.pdf</a>
</div>
<div id="ref-DEFRA2006b" class="csl-entry">
DEFRA. (2006b). <em>Flood Risks to People Phase 2 FD2321/TR1 the Flood Risks to People Methodology</em>. DEFRA. <a href="https://assets.publishing.service.gov.uk/media/602bbc768fa8f50383c41f80/Flood_risks_to_people_-_Phase_2_The_flood_risks_to_people_methodology_technical_report.pdf">https://assets.publishing.service.gov.uk/media/602bbc768fa8f50383c41f80/Flood_risks_to_people_-_Phase_2_The_flood_risks_to_people_methodology_technical_report.pdf</a>
</div>
<div id="ref-DHI2009" class="csl-entry">
DHI. (2009). <em>MOUSE PIPE FLOW – Reference Manual</em>. Danish Hydraulic Institute. <a href="https://manuals.mikepoweredbydhi.help/2017/Cities/MOUSEPipeFlowReference.pdf">https://manuals.mikepoweredbydhi.help/2017/Cities/MOUSEPipeFlowReference.pdf</a>
</div>
<div id="ref-UKFloodRisks2006" class="csl-entry">
Environment Agency. (2006). <em>UK FD2321 Technical Report - Flood Risks to People: Phase 2 Project Record</em>. UK Government; <a href="https://assets.publishing.service.gov.uk/media/602bbb768fa8f50386a7f8aa/Flood_risks_to_people_-_Phase_2_Project_Record.pdf" class="uri">https://assets.publishing.service.gov.uk/media/602bbb768fa8f50386a7f8aa/Flood_risks_to_people_-_Phase_2_Project_Record.pdf</a>.
</div>
<div id="ref-UKExplanatoryNote2008" class="csl-entry">
Environment Agency. (2008). <em>Explanatory Note for FD2320 and FD2321 Project Record</em>. <a href="https://assets.publishing.service.gov.uk/media/602bbdcfe90e070561b31432/Explanatory_note_for_FD2320_and_FD2321_project_record.pdf" class="uri">https://assets.publishing.service.gov.uk/media/602bbdcfe90e070561b31432/Explanatory_note_for_FD2320_and_FD2321_project_record.pdf</a>.
</div>
<div id="ref-EAGuide2010" class="csl-entry">
Environment Agency. (2010). <em>The Fluvial Design Guide</em>. Environment Agency.
</div>
<div id="ref-Falconer2005" class="csl-entry">
Falconer, R. A., Lin, B., &amp; Kashefipour, S. M. (2005). Modelling Water Quality Processes in Estuaries. In P. B. Bates, S. N. Lane, &amp; R. I. Furguson (Eds.), <em>Computational fluid dynamics: Applications in environmental hydraulics</em>. John Wiley; Sons.
</div>
<div id="ref-GHD2011" class="csl-entry">
GHD. (2011). <em>MBRC Storm Tide Management Study: Stage 1 – Scoping Report</em>.
</div>
<div id="ref-Henderson1966" class="csl-entry">
Henderson, F. (1966). <em>Open Channel Flow</em>. Macmillan.
</div>
<div id="ref-Holland1980" class="csl-entry">
Holland, G. J. (1980). An Analytic Model of the Wind and Pressure Profiles in Hurricanes. <em>Monthly Weather Review</em>, <em>108</em>(8), 1212–1218. <a href="https://doi.org/10.1175/1520-0493(1980)108&lt;1212:AAMOTW&gt;2.0.CO;2">https://doi.org/10.1175/1520-0493(1980)108&lt;1212:AAMOTW&gt;2.0.CO;2</a>
</div>
<div id="ref-HRWallingford1988" class="csl-entry">
HR Wallingford. (1988). <em>Afflux at Arch Bridges</em>. <a href="https://eprints.hrwallingford.com/219/1/SR182-Afflux-arch-bridges-HRWallingford.pdf">https://eprints.hrwallingford.com/219/1/SR182-Afflux-arch-bridges-HRWallingford.pdf</a>
</div>
<div id="ref-Huxley2004" class="csl-entry">
Huxley, C. (2004). <em>TUFLOW Testing and Validation</em> (B. ENG. Christopher Dylan Huxley, Ed.) [Thesis]. <a href="https://www.tuflow.com/Download/Publications/TUFLOW%20Validation%20and%20Testing,%20Huxley,%202004.pdf">https://www.tuflow.com/Download/Publications/TUFLOW%20Validation%20and%20Testing,%20Huxley,%202004.pdf</a>
</div>
<div id="ref-Huxley2022" class="csl-entry">
Huxley, C., Syme, W., Ryan, P., &amp; Collecutt, G. (2022). Hydraulic Modelling 2D Cell Size Result Convergence – Comparing the Performance of Different Shallow Water Equation Solution Schemes. <em>Hydrology and Water Resources Symposium, Engineers Australia</em>. <a href="https://www.tuflow.com/media/7555/2022-hydraulic-modelling-2d-cell-size-result-convergence-huxley-et-al-hwrs.pdf">https://www.tuflow.com/media/7555/2022-hydraulic-modelling-2d-cell-size-result-convergence-huxley-et-al-hwrs.pdf</a>
</div>
<div id="ref-Kitts2020" class="csl-entry">
Kitts, D., Syme, W., Gao, S., Collecutt, G., &amp; Ryan, P. (2020). Mesh Orientation and Cell Size Sensitivity in 2D SWE Solvers. <em>IAHR River Flow Conference</em>. <a href="https://tuflow.com/media/5022/2020-mesh-orientation-and-cell-size-sensitivity-in-2d-swe-solvers-kitts-et-al-iahr-river-flow-delft.pdf">https://tuflow.com/media/5022/2020-mesh-orientation-and-cell-size-sensitivity-in-2d-swe-solvers-kitts-et-al-iahr-river-flow-delft.pdf</a>
</div>
<div id="ref-Leonard1991" class="csl-entry">
Leonard, B. P. (1991). The ULTIMATE Conservative Difference Scheme Applied to Unsteady One-Dimensional Advection. <em>Computer Methods in Applied Mechanics and Engineering</em>, <em>88</em>(1), 17–74.
</div>
<div id="ref-Leonard1993" class="csl-entry">
Leonard, B. P., MacVean, M. K., &amp; Lock, A. P. (1993). <em>Positivity-Preserving Numerical Schemes for Multidimensional Advection</em> (No. 93N27091). <span>NASA Centre for Aerospace Information</span>.
</div>
<div id="ref-LeonardNiknafs1991" class="csl-entry">
Leonard, B. P., &amp; Niknafs, H. S. (1991). <em>Cost-Effective Accurate Coarse-Grid Method for Highly Convective Multidimensional Unsteady Flows</em> (No. 91N21075). <span>NASA Centre for Aerospace Information</span>.
</div>
<div id="ref-mcdonnell_bryant_2021_5484299" class="csl-entry">
McDonnell, B., Wu, J. X., Ratliff, K., Mullapudi, A., &amp; Tryby, M. (2021). <em>Open Water Analytics Stormwater Management Model</em> (Version 5.1.13). Zenodo. <a href="https://doi.org/10.5281/zenodo.5484299">https://doi.org/10.5281/zenodo.5484299</a>
</div>
<div id="ref-MW2016" class="csl-entry">
Melbourne Water. (2016). <em>Flood Mapping Projects Guidelines and Technical Specifications</em> (Version 1).
</div>
<div id="ref-IAHRManual1994" class="csl-entry">
Miller, D. (1994). <em>Discharge Characteristics IAHR Hydraulic Structures Design Manual</em> (No. No.8; pp. 249 pages). Hydraulic Design Considerations, Balkema Publ.
</div>
<div id="ref-MorrisonSmith1978" class="csl-entry">
Morrison, W., &amp; Smith, P. (1978). <em>A Practical Application of a Network Model Numerical Simulation of Fluid Motion</em>. North Holland Publishing Company.
</div>
<div id="ref-EnvAgency2013" class="csl-entry">
Neelz, S., &amp; Pender, G. (2013). <em>Benchmarking the Latest Generation of 2D Hydaulic Modeling Packages</em>. Environment Agency. <a href="https://doi.org/SC120002/R">https://doi.org/SC120002/R</a>
</div>
<div id="ref-NSWManual2005" class="csl-entry">
NSW Goverment. (2005b). <em>Floodplain Management Manual</em>. NSW Department of Land; Water Conservation (NSW Government).
</div>
<div id="ref-OllettSyme2016" class="csl-entry">
Ollett, P., &amp; Syme, B. (2016). <em>ARR blockage: Numerical implementation and three case studies</em>. <a href="http://www.hydralinc.com/wp-content/uploads/Ollett-Syme-2016-ARR-Blockage.pdf">http://www.hydralinc.com/wp-content/uploads/Ollett-Syme-2016-ARR-Blockage.pdf</a>
</div>
<div id="ref-PortMacquarieFloodPolicy2018" class="csl-entry">
Port Macquarie-Hastings Council. (2018). <em>PORT MACQUARIE-HASTINGS COUNCIL FLOOD POLICY</em>. <a href="https://www.pmhc.nsw.gov.au/files/assets/public/v/1/document-files/your-council/publications/policies/port-macquarie-hastings-council-flood-adopted-2018-12-12.pdf" class="uri">https://www.pmhc.nsw.gov.au/files/assets/public/v/1/document-files/your-council/publications/policies/port-macquarie-hastings-council-flood-adopted-2018-12-12.pdf</a>.
</div>
<div id="ref-QG2001" class="csl-entry">
Queensland Government. (2001). <em>Queensland Climate Change and Community Vulnerability to Tropical Cyclones - Ocean Hazrds Assessment</em>. <a href="https://www.systemsengineeringaustralia.com.au/download/Ocean_Hazards_Assess_Stage1A_revised.pdf">https://www.systemsengineeringaustralia.com.au/download/Ocean_Hazards_Assess_Stage1A_revised.pdf</a>
</div>
<div id="ref-QRAResilientFloodplains2018" class="csl-entry">
Queensland Reconstruction Authority. (2012). <em>Planning for Stronger, More Resilient Fl Oodplains: Part 2</em>. <a href="https://www.qra.qld.gov.au/sites/default/files/2018-10/resilient-floodplains-part2-full_0.pdf" class="uri">https://www.qra.qld.gov.au/sites/default/files/2018-10/resilient-floodplains-part2-full_0.pdf</a>.
</div>
<div id="ref-Ryan2022" class="csl-entry">
Ryan, P., Syme, W., Gao, S., &amp; Collecutt, G. (2022). Irect Rainfall Hydraulic Model Validation. <em>Hydrology &amp; Water Resources Symposium</em>. <a href="https://www.tuflow.com/media/7545/2022-direct-rainfall-hydraulic-model-validation-ryan-et-al-hwrs.pdf">https://www.tuflow.com/media/7545/2022-direct-rainfall-hydraulic-model-validation-ryan-et-al-hwrs.pdf</a>
</div>
<div id="ref-Stelling1984" class="csl-entry">
Stelling, G. (1984). <em>On the Construction of Computational Methods for Shallow Water Flow Problems</em>. Rijkswaterstaat Communications.
</div>
<div id="ref-Syme1991" class="csl-entry">
Syme, W. (1991). <em>Dynamically Linked Two Dimensional / One-Dimensional Hydrodynamic Modelling Program for Rivers, Estuaries and Coastal Waters</em> (W. Syme, Ed.) [M.Eng.Sc(100% Research) Thesis]. Dept of Civil Engineering. <a href="https://tuflow.com/media/4982/1991-tuflow-dynamically-linked-2d-and-1d-hydrodynamic-modelling-syme-thesis.pdf">https://tuflow.com/media/4982/1991-tuflow-dynamically-linked-2d-and-1d-hydrodynamic-modelling-syme-thesis.pdf</a>
</div>
<div id="ref-Syme2001a" class="csl-entry">
Syme, W. (2001a). Modelling of Bends and Hydraulic Structures in a Two-Dimensional Scheme. <em>The Institution of Engineers, Australia Conference on Hydraulics in Civil Engineering</em>. <a href="https://tuflow.com/media/4984/2001-modelling-of-bends-and-hydraulic-structures-in-a-2d-scheme-syme.pdf">https://tuflow.com/media/4984/2001-modelling-of-bends-and-hydraulic-structures-in-a-2d-scheme-syme.pdf</a>
</div>
<div id="ref-Syme2001b" class="csl-entry">
Syme, W. (2001b). TUFLOW – Two &amp; One-Dimensional Unsteady FLOW Software for Rivers, Estuaries and Coastal Waters. <em>The Institution of Engineers, Australia 2D Seminar</em>. <a href="https://tuflow.com/media/4985/2001-tuflow-two-and-one-dimensional-unsteady-flow-software-for-rivers-estuaries-and-coastal-waters-syme.pdf">https://tuflow.com/media/4985/2001-tuflow-two-and-one-dimensional-unsteady-flow-software-for-rivers-estuaries-and-coastal-waters-syme.pdf</a>
</div>
<div id="ref-Syme2008" class="csl-entry">
Syme, W. (2008). Flooding in Urban Areas - 2D Modelling Approaches for Buildings and Fences. <em>Engineers Australia, 9th National COnference on Hydraulics in Water Enginnering</em>. <a href="https://tuflow.com/media/4997/2008-flooding-in-urban-areas-2d-modelling-approaches-for-buildings-and-fences-syme-hwe-aus.pdf">https://tuflow.com/media/4997/2008-flooding-in-urban-areas-2d-modelling-approaches-for-buildings-and-fences-syme-hwe-aus.pdf</a>
</div>
<div id="ref-SymeNielsen1998" class="csl-entry">
Syme, W., Nielsen, C., &amp; Charteris, A. (1998). Comparison of Two-Dimensional Hydrodynamic Modelling Systems Part One - Flow Through a Constriction. <em>International Conference on Hydraulics in Civil Engineering</em>.
</div>
<div id="ref-TullisRobinson2008" class="csl-entry">
Tullis, B., &amp; Robinson, S. (2008). Quantifying Culvert Exit Loss. <em>Journal of Irrigation and Drainage Engineering</em>, <em>Vol. 134</em>(No. 2), pp. 263–266.
</div>
<div id="ref-USACE1977" class="csl-entry">
USACE. (1977). <em>Hydraulic Design Criteria-Sheets 312</em>. US Army Corp of Engineers. <a href="https://apps.dtic.mil/sti/tr/pdf/ADA092238.pdf">https://apps.dtic.mil/sti/tr/pdf/ADA092238.pdf</a>
</div>
<div id="ref-USBR1987" class="csl-entry">
USBR. (1987). <em>Design of Small Dams</em> [Technology &amp; Engineering]. U.S. Dept. of the Interior, Bureau of Reclamation, 1987-. <a href="https://www.usbr.gov/tsc/techreferences/mands/mands-pdfs/SmallDams.pdf">https://www.usbr.gov/tsc/techreferences/mands/mands-pdfs/SmallDams.pdf</a>
</div>
<div id="ref-WeeksWitheridge2013" class="csl-entry">
Weeks, W., Witheridge, G., Rigby, E., Barthelmess, A., &amp; O’Loughlin, G. (2013). <em>Australian Rainfall and Runoff Revision Project 11: Blockage of Hydraulic Structures</em>. Austalian Institute of Engineers. <a href="https://doi.org/P11/S2/021">https://doi.org/P11/S2/021</a>
</div>
<div id="ref-Witheridge2009" class="csl-entry">
Witheridge, G. (2009). <em>Hydraulic Analysis of the Debris Blockage of Culvert Inlets</em>. Catchments &amp; Creek Pty Ltd.
</div>
<div id="ref-Wu1980" class="csl-entry">
Wu, J. (1980). Wind-Stress Coefficients over Sea Surface Near Neutral Conditions—a Revisit. <em>Journal of Physical Oceanography</em>, <em>Vol. 10</em>(5), pp. 727–740. https://doi.org/<a href="https://doi.org/10.1175/1520-0485(1980)010&lt;0727:WSCOSS&gt;2.0.CO;2">https://doi.org/10.1175/1520-0485(1980)010&lt;0727:WSCOSS&gt;2.0.CO;2</a>
</div>
<div id="ref-Wu1982" class="csl-entry">
Wu, J. (1982). Wind-Stress Coefficients over Sea Surface from Breeze to Hurricane. <em>Journal of Geophysical Research</em>, <em>Vol. 87</em>(C12), pp. 9704–9706. https://doi.org/<a href="https://doi.org/10.1029/JC087iC12p09704">https://doi.org/10.1029/JC087iC12p09704</a>
</div>
<div id="ref-Wu2005" class="csl-entry">
Wu, W., Shields Jr., F. D., Bennett, S. J., &amp; Wang, S. S. Y. (2005). A Depth-Averaged Two-Dimensional Model for Flow, Sediment Transport, and Bed Topography in Curved Channels with Riparian Vegetation. <em>Water Resources Research</em>, <em>41</em>(3). https://doi.org/<a href="https://doi.org/10.1029/2004WR003730">https://doi.org/10.1029/2004WR003730</a>
</div>
<div id="ref-Wu2000" class="csl-entry">
Wu, &amp; Falconer, R. A. (2000). A Mass Conservative 3-d Numerical Model for Predicting Solute Fluxes in Estuarine Waters. <em>Advances in Water Resources</em>, <em>23</em>(5), 531–543.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Figure courtesy of University of Texas <a href="https://www.caee.utexas.edu/prof/mckinney/ce374k/Overheads/10-Infiltration.pdf#page=20" class="uri">https://www.caee.utexas.edu/prof/mckinney/ce374k/Overheads/10-Infiltration.pdf#page=20</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Figure courtesy of University of Texas <a href="https://www.caee.utexas.edu/prof/mckinney/ce374k/Overheads/10-Infiltration.pdf#page=20" class="uri">https://www.caee.utexas.edu/prof/mckinney/ce374k/Overheads/10-Infiltration.pdf#page=20</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": false,
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
